function Ix(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var oB=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mx(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var El={},Rx={get exports(){return El},set exports(t){El=t}},dc={},N={},Ox={get exports(){return N},set exports(t){N=t}},Z={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Co=Symbol.for("react.element"),kx=Symbol.for("react.portal"),Nx=Symbol.for("react.fragment"),Fx=Symbol.for("react.strict_mode"),Dx=Symbol.for("react.profiler"),zx=Symbol.for("react.provider"),Bx=Symbol.for("react.context"),Ux=Symbol.for("react.forward_ref"),Vx=Symbol.for("react.suspense"),jx=Symbol.for("react.memo"),Gx=Symbol.for("react.lazy"),fp=Symbol.iterator;function Wx(t){return t===null||typeof t!="object"?null:(t=fp&&t[fp]||t["@@iterator"],typeof t=="function"?t:null)}var pv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},mv=Object.assign,yv={};function Kr(t,e,n){this.props=t,this.context=e,this.refs=yv,this.updater=n||pv}Kr.prototype.isReactComponent={};Kr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Kr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function vv(){}vv.prototype=Kr.prototype;function id(t,e,n){this.props=t,this.context=e,this.refs=yv,this.updater=n||pv}var rd=id.prototype=new vv;rd.constructor=id;mv(rd,Kr.prototype);rd.isPureReactComponent=!0;var hp=Array.isArray,_v=Object.prototype.hasOwnProperty,sd={current:null},wv={key:!0,ref:!0,__self:!0,__source:!0};function Ev(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)_v.call(e,i)&&!wv.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:Co,type:t,key:s,ref:o,props:r,_owner:sd.current}}function Hx(t,e){return{$$typeof:Co,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function od(t){return typeof t=="object"&&t!==null&&t.$$typeof===Co}function $x(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var dp=/\/+/g;function nu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?$x(""+t.key):e.toString(36)}function qa(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Co:case kx:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+nu(o,0):i,hp(r)?(n="",t!=null&&(n=t.replace(dp,"$&/")+"/"),qa(r,e,n,"",function(c){return c})):r!=null&&(od(r)&&(r=Hx(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(dp,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",hp(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+nu(s,a);o+=qa(s,e,n,l,r)}else if(l=Wx(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+nu(s,a++),o+=qa(s,e,n,l,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ia(t,e,n){if(t==null)return t;var i=[],r=0;return qa(t,i,"","",function(s){return e.call(n,s,r++)}),i}function Xx(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ke={current:null},Ka={transition:null},Yx={ReactCurrentDispatcher:Ke,ReactCurrentBatchConfig:Ka,ReactCurrentOwner:sd};Z.Children={map:ia,forEach:function(t,e,n){ia(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ia(t,function(){e++}),e},toArray:function(t){return ia(t,function(e){return e})||[]},only:function(t){if(!od(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Z.Component=Kr;Z.Fragment=Nx;Z.Profiler=Dx;Z.PureComponent=id;Z.StrictMode=Fx;Z.Suspense=Vx;Z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Yx;Z.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=mv({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=sd.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)_v.call(e,l)&&!wv.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:Co,type:t.type,key:r,ref:s,props:i,_owner:o}};Z.createContext=function(t){return t={$$typeof:Bx,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:zx,_context:t},t.Consumer=t};Z.createElement=Ev;Z.createFactory=function(t){var e=Ev.bind(null,t);return e.type=t,e};Z.createRef=function(){return{current:null}};Z.forwardRef=function(t){return{$$typeof:Ux,render:t}};Z.isValidElement=od;Z.lazy=function(t){return{$$typeof:Gx,_payload:{_status:-1,_result:t},_init:Xx}};Z.memo=function(t,e){return{$$typeof:jx,type:t,compare:e===void 0?null:e}};Z.startTransition=function(t){var e=Ka.transition;Ka.transition={};try{t()}finally{Ka.transition=e}};Z.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Z.useCallback=function(t,e){return Ke.current.useCallback(t,e)};Z.useContext=function(t){return Ke.current.useContext(t)};Z.useDebugValue=function(){};Z.useDeferredValue=function(t){return Ke.current.useDeferredValue(t)};Z.useEffect=function(t,e){return Ke.current.useEffect(t,e)};Z.useId=function(){return Ke.current.useId()};Z.useImperativeHandle=function(t,e,n){return Ke.current.useImperativeHandle(t,e,n)};Z.useInsertionEffect=function(t,e){return Ke.current.useInsertionEffect(t,e)};Z.useLayoutEffect=function(t,e){return Ke.current.useLayoutEffect(t,e)};Z.useMemo=function(t,e){return Ke.current.useMemo(t,e)};Z.useReducer=function(t,e,n){return Ke.current.useReducer(t,e,n)};Z.useRef=function(t){return Ke.current.useRef(t)};Z.useState=function(t){return Ke.current.useState(t)};Z.useSyncExternalStore=function(t,e,n){return Ke.current.useSyncExternalStore(t,e,n)};Z.useTransition=function(){return Ke.current.useTransition()};Z.version="18.2.0";(function(t){t.exports=Z})(Ox);const Zx=Mx(N);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qx=N,Kx=Symbol.for("react.element"),Qx=Symbol.for("react.fragment"),Jx=Object.prototype.hasOwnProperty,eT=qx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,tT={key:!0,ref:!0,__self:!0,__source:!0};function xv(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)Jx.call(e,i)&&!tT.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:Kx,type:t,key:s,ref:o,props:r,_owner:eT.current}}dc.Fragment=Qx;dc.jsx=xv;dc.jsxs=xv;(function(t){t.exports=dc})(Rx);const xl=El.jsx,nT=El.jsxs;var Ef={},Ks={},iT={get exports(){return Ks},set exports(t){Ks=t}},pt={},xf={},rT={get exports(){return xf},set exports(t){xf=t}},Tv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(z,j){var H=z.length;z.push(j);e:for(;0<H;){var fe=H-1>>>1,ce=z[fe];if(0<r(ce,j))z[fe]=j,z[H]=ce,H=fe;else break e}}function n(z){return z.length===0?null:z[0]}function i(z){if(z.length===0)return null;var j=z[0],H=z.pop();if(H!==j){z[0]=H;e:for(var fe=0,ce=z.length,Xi=ce>>>1;fe<Xi;){var Lt=2*(fe+1)-1,rs=z[Lt],nn=Lt+1,we=z[nn];if(0>r(rs,H))nn<ce&&0>r(we,rs)?(z[fe]=we,z[nn]=H,fe=nn):(z[fe]=rs,z[Lt]=H,fe=Lt);else if(nn<ce&&0>r(we,H))z[fe]=we,z[nn]=H,fe=nn;else break e}}return j}function r(z,j){var H=z.sortIndex-j.sortIndex;return H!==0?H:z.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,f=null,h=3,d=!1,p=!1,_=!1,x=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(z){for(var j=n(c);j!==null;){if(j.callback===null)i(c);else if(j.startTime<=z)i(c),j.sortIndex=j.expirationTime,e(l,j);else break;j=n(c)}}function T(z){if(_=!1,w(z),!p)if(n(l)!==null)p=!0,is(b);else{var j=n(c);j!==null&&$i(T,j.startTime-z)}}function b(z,j){p=!1,_&&(_=!1,y(C),C=-1),d=!0;var H=h;try{for(w(j),f=n(l);f!==null&&(!(f.expirationTime>j)||z&&!V());){var fe=f.callback;if(typeof fe=="function"){f.callback=null,h=f.priorityLevel;var ce=fe(f.expirationTime<=j);j=t.unstable_now(),typeof ce=="function"?f.callback=ce:f===n(l)&&i(l),w(j)}else i(l);f=n(l)}if(f!==null)var Xi=!0;else{var Lt=n(c);Lt!==null&&$i(T,Lt.startTime-j),Xi=!1}return Xi}finally{f=null,h=H,d=!1}}var P=!1,L=null,C=-1,M=5,R=-1;function V(){return!(t.unstable_now()-R<M)}function W(){if(L!==null){var z=t.unstable_now();R=z;var j=!0;try{j=L(!0,z)}finally{j?G():(P=!1,L=null)}}else P=!1}var G;if(typeof m=="function")G=function(){m(W)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,At=q.port2;q.port1.onmessage=W,G=function(){At.postMessage(null)}}else G=function(){x(W,0)};function is(z){L=z,P||(P=!0,G())}function $i(z,j){C=x(function(){z(t.unstable_now())},j)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(z){z.callback=null},t.unstable_continueExecution=function(){p||d||(p=!0,is(b))},t.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<z?Math.floor(1e3/z):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(z){switch(h){case 1:case 2:case 3:var j=3;break;default:j=h}var H=h;h=j;try{return z()}finally{h=H}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(z,j){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var H=h;h=z;try{return j()}finally{h=H}},t.unstable_scheduleCallback=function(z,j,H){var fe=t.unstable_now();switch(typeof H=="object"&&H!==null?(H=H.delay,H=typeof H=="number"&&0<H?fe+H:fe):H=fe,z){case 1:var ce=-1;break;case 2:ce=250;break;case 5:ce=1073741823;break;case 4:ce=1e4;break;default:ce=5e3}return ce=H+ce,z={id:u++,callback:j,priorityLevel:z,startTime:H,expirationTime:ce,sortIndex:-1},H>fe?(z.sortIndex=H,e(c,z),n(l)===null&&z===n(c)&&(_?(y(C),C=-1):_=!0,$i(T,H-fe))):(z.sortIndex=ce,e(l,z),p||d||(p=!0,is(b))),z},t.unstable_shouldYield=V,t.unstable_wrapCallback=function(z){var j=h;return function(){var H=h;h=j;try{return z.apply(this,arguments)}finally{h=H}}}})(Tv);(function(t){t.exports=Tv})(rT);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sv=N,dt=xf;function O(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var bv=new Set,Qs={};function Vi(t,e){Or(t,e),Or(t+"Capture",e)}function Or(t,e){for(Qs[t]=e,t=0;t<e.length;t++)bv.add(e[t])}var vn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Tf=Object.prototype.hasOwnProperty,sT=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,gp={},pp={};function oT(t){return Tf.call(pp,t)?!0:Tf.call(gp,t)?!1:sT.test(t)?pp[t]=!0:(gp[t]=!0,!1)}function aT(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function lT(t,e,n,i){if(e===null||typeof e>"u"||aT(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Qe(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Fe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Fe[t]=new Qe(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Fe[e]=new Qe(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Fe[t]=new Qe(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Fe[t]=new Qe(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Fe[t]=new Qe(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Fe[t]=new Qe(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Fe[t]=new Qe(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Fe[t]=new Qe(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Fe[t]=new Qe(t,5,!1,t.toLowerCase(),null,!1,!1)});var ad=/[\-:]([a-z])/g;function ld(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(ad,ld);Fe[e]=new Qe(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(ad,ld);Fe[e]=new Qe(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(ad,ld);Fe[e]=new Qe(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Fe[t]=new Qe(t,1,!1,t.toLowerCase(),null,!1,!1)});Fe.xlinkHref=new Qe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Fe[t]=new Qe(t,1,!1,t.toLowerCase(),null,!0,!0)});function cd(t,e,n,i){var r=Fe.hasOwnProperty(e)?Fe[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(lT(e,n,r,i)&&(n=null),i||r===null?oT(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Pn=Sv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ra=Symbol.for("react.element"),sr=Symbol.for("react.portal"),or=Symbol.for("react.fragment"),ud=Symbol.for("react.strict_mode"),Sf=Symbol.for("react.profiler"),Pv=Symbol.for("react.provider"),Av=Symbol.for("react.context"),fd=Symbol.for("react.forward_ref"),bf=Symbol.for("react.suspense"),Pf=Symbol.for("react.suspense_list"),hd=Symbol.for("react.memo"),zn=Symbol.for("react.lazy"),Lv=Symbol.for("react.offscreen"),mp=Symbol.iterator;function hs(t){return t===null||typeof t!="object"?null:(t=mp&&t[mp]||t["@@iterator"],typeof t=="function"?t:null)}var me=Object.assign,iu;function Cs(t){if(iu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);iu=e&&e[1]||""}return`
`+iu+t}var ru=!1;function su(t,e){if(!t||ru)return"";ru=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{ru=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Cs(t):""}function cT(t){switch(t.tag){case 5:return Cs(t.type);case 16:return Cs("Lazy");case 13:return Cs("Suspense");case 19:return Cs("SuspenseList");case 0:case 2:case 15:return t=su(t.type,!1),t;case 11:return t=su(t.type.render,!1),t;case 1:return t=su(t.type,!0),t;default:return""}}function Af(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case or:return"Fragment";case sr:return"Portal";case Sf:return"Profiler";case ud:return"StrictMode";case bf:return"Suspense";case Pf:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Av:return(t.displayName||"Context")+".Consumer";case Pv:return(t._context.displayName||"Context")+".Provider";case fd:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case hd:return e=t.displayName||null,e!==null?e:Af(t.type)||"Memo";case zn:e=t._payload,t=t._init;try{return Af(t(e))}catch{}}return null}function uT(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Af(e);case 8:return e===ud?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ri(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Cv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function fT(t){var e=Cv(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function sa(t){t._valueTracker||(t._valueTracker=fT(t))}function Iv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=Cv(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Tl(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Lf(t,e){var n=e.checked;return me({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function yp(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=ri(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Mv(t,e){e=e.checked,e!=null&&cd(t,"checked",e,!1)}function Cf(t,e){Mv(t,e);var n=ri(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?If(t,e.type,n):e.hasOwnProperty("defaultValue")&&If(t,e.type,ri(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function vp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function If(t,e,n){(e!=="number"||Tl(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Is=Array.isArray;function Sr(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+ri(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Mf(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(O(91));return me({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function _p(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(O(92));if(Is(n)){if(1<n.length)throw Error(O(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ri(n)}}function Rv(t,e){var n=ri(e.value),i=ri(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function wp(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Ov(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Rf(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Ov(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var oa,kv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(oa=oa||document.createElement("div"),oa.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=oa.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Js(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Fs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},hT=["Webkit","ms","Moz","O"];Object.keys(Fs).forEach(function(t){hT.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Fs[e]=Fs[t]})});function Nv(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Fs.hasOwnProperty(t)&&Fs[t]?(""+e).trim():e+"px"}function Fv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=Nv(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var dT=me({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Of(t,e){if(e){if(dT[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(O(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(O(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(O(61))}if(e.style!=null&&typeof e.style!="object")throw Error(O(62))}}function kf(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Nf=null;function dd(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ff=null,br=null,Pr=null;function Ep(t){if(t=Ro(t)){if(typeof Ff!="function")throw Error(O(280));var e=t.stateNode;e&&(e=vc(e),Ff(t.stateNode,t.type,e))}}function Dv(t){br?Pr?Pr.push(t):Pr=[t]:br=t}function zv(){if(br){var t=br,e=Pr;if(Pr=br=null,Ep(t),e)for(t=0;t<e.length;t++)Ep(e[t])}}function Bv(t,e){return t(e)}function Uv(){}var ou=!1;function Vv(t,e,n){if(ou)return t(e,n);ou=!0;try{return Bv(t,e,n)}finally{ou=!1,(br!==null||Pr!==null)&&(Uv(),zv())}}function eo(t,e){var n=t.stateNode;if(n===null)return null;var i=vc(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(O(231,e,typeof n));return n}var Df=!1;if(vn)try{var ds={};Object.defineProperty(ds,"passive",{get:function(){Df=!0}}),window.addEventListener("test",ds,ds),window.removeEventListener("test",ds,ds)}catch{Df=!1}function gT(t,e,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Ds=!1,Sl=null,bl=!1,zf=null,pT={onError:function(t){Ds=!0,Sl=t}};function mT(t,e,n,i,r,s,o,a,l){Ds=!1,Sl=null,gT.apply(pT,arguments)}function yT(t,e,n,i,r,s,o,a,l){if(mT.apply(this,arguments),Ds){if(Ds){var c=Sl;Ds=!1,Sl=null}else throw Error(O(198));bl||(bl=!0,zf=c)}}function ji(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function jv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function xp(t){if(ji(t)!==t)throw Error(O(188))}function vT(t){var e=t.alternate;if(!e){if(e=ji(t),e===null)throw Error(O(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return xp(r),t;if(s===i)return xp(r),e;s=s.sibling}throw Error(O(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(O(189))}}if(n.alternate!==i)throw Error(O(190))}if(n.tag!==3)throw Error(O(188));return n.stateNode.current===n?t:e}function Gv(t){return t=vT(t),t!==null?Wv(t):null}function Wv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Wv(t);if(e!==null)return e;t=t.sibling}return null}var Hv=dt.unstable_scheduleCallback,Tp=dt.unstable_cancelCallback,_T=dt.unstable_shouldYield,wT=dt.unstable_requestPaint,_e=dt.unstable_now,ET=dt.unstable_getCurrentPriorityLevel,gd=dt.unstable_ImmediatePriority,$v=dt.unstable_UserBlockingPriority,Pl=dt.unstable_NormalPriority,xT=dt.unstable_LowPriority,Xv=dt.unstable_IdlePriority,gc=null,en=null;function TT(t){if(en&&typeof en.onCommitFiberRoot=="function")try{en.onCommitFiberRoot(gc,t,void 0,(t.current.flags&128)===128)}catch{}}var zt=Math.clz32?Math.clz32:PT,ST=Math.log,bT=Math.LN2;function PT(t){return t>>>=0,t===0?32:31-(ST(t)/bT|0)|0}var aa=64,la=4194304;function Ms(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Al(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=Ms(a):(s&=o,s!==0&&(i=Ms(s)))}else o=n&~r,o!==0?i=Ms(o):s!==0&&(i=Ms(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-zt(e),r=1<<n,i|=t[n],e&=~r;return i}function AT(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function LT(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-zt(s),a=1<<o,l=r[o];l===-1?(!(a&n)||a&i)&&(r[o]=AT(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function Bf(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Yv(){var t=aa;return aa<<=1,!(aa&4194240)&&(aa=64),t}function au(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Io(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-zt(e),t[e]=n}function CT(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-zt(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function pd(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-zt(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var ee=0;function Zv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var qv,md,Kv,Qv,Jv,Uf=!1,ca=[],Yn=null,Zn=null,qn=null,to=new Map,no=new Map,Un=[],IT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sp(t,e){switch(t){case"focusin":case"focusout":Yn=null;break;case"dragenter":case"dragleave":Zn=null;break;case"mouseover":case"mouseout":qn=null;break;case"pointerover":case"pointerout":to.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":no.delete(e.pointerId)}}function gs(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=Ro(e),e!==null&&md(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function MT(t,e,n,i,r){switch(e){case"focusin":return Yn=gs(Yn,t,e,n,i,r),!0;case"dragenter":return Zn=gs(Zn,t,e,n,i,r),!0;case"mouseover":return qn=gs(qn,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return to.set(s,gs(to.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,no.set(s,gs(no.get(s)||null,t,e,n,i,r)),!0}return!1}function e_(t){var e=xi(t.target);if(e!==null){var n=ji(e);if(n!==null){if(e=n.tag,e===13){if(e=jv(n),e!==null){t.blockedOn=e,Jv(t.priority,function(){Kv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Qa(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Vf(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Nf=i,n.target.dispatchEvent(i),Nf=null}else return e=Ro(n),e!==null&&md(e),t.blockedOn=n,!1;e.shift()}return!0}function bp(t,e,n){Qa(t)&&n.delete(e)}function RT(){Uf=!1,Yn!==null&&Qa(Yn)&&(Yn=null),Zn!==null&&Qa(Zn)&&(Zn=null),qn!==null&&Qa(qn)&&(qn=null),to.forEach(bp),no.forEach(bp)}function ps(t,e){t.blockedOn===e&&(t.blockedOn=null,Uf||(Uf=!0,dt.unstable_scheduleCallback(dt.unstable_NormalPriority,RT)))}function io(t){function e(r){return ps(r,t)}if(0<ca.length){ps(ca[0],t);for(var n=1;n<ca.length;n++){var i=ca[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Yn!==null&&ps(Yn,t),Zn!==null&&ps(Zn,t),qn!==null&&ps(qn,t),to.forEach(e),no.forEach(e),n=0;n<Un.length;n++)i=Un[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Un.length&&(n=Un[0],n.blockedOn===null);)e_(n),n.blockedOn===null&&Un.shift()}var Ar=Pn.ReactCurrentBatchConfig,Ll=!0;function OT(t,e,n,i){var r=ee,s=Ar.transition;Ar.transition=null;try{ee=1,yd(t,e,n,i)}finally{ee=r,Ar.transition=s}}function kT(t,e,n,i){var r=ee,s=Ar.transition;Ar.transition=null;try{ee=4,yd(t,e,n,i)}finally{ee=r,Ar.transition=s}}function yd(t,e,n,i){if(Ll){var r=Vf(t,e,n,i);if(r===null)yu(t,e,i,Cl,n),Sp(t,i);else if(MT(r,t,e,n,i))i.stopPropagation();else if(Sp(t,i),e&4&&-1<IT.indexOf(t)){for(;r!==null;){var s=Ro(r);if(s!==null&&qv(s),s=Vf(t,e,n,i),s===null&&yu(t,e,i,Cl,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else yu(t,e,i,null,n)}}var Cl=null;function Vf(t,e,n,i){if(Cl=null,t=dd(i),t=xi(t),t!==null)if(e=ji(t),e===null)t=null;else if(n=e.tag,n===13){if(t=jv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Cl=t,null}function t_(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ET()){case gd:return 1;case $v:return 4;case Pl:case xT:return 16;case Xv:return 536870912;default:return 16}default:return 16}}var Gn=null,vd=null,Ja=null;function n_(){if(Ja)return Ja;var t,e=vd,n=e.length,i,r="value"in Gn?Gn.value:Gn.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return Ja=r.slice(t,1<i?1-i:void 0)}function el(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function ua(){return!0}function Pp(){return!1}function mt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?ua:Pp,this.isPropagationStopped=Pp,this}return me(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=ua)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=ua)},persist:function(){},isPersistent:ua}),e}var Qr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_d=mt(Qr),Mo=me({},Qr,{view:0,detail:0}),NT=mt(Mo),lu,cu,ms,pc=me({},Mo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wd,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ms&&(ms&&t.type==="mousemove"?(lu=t.screenX-ms.screenX,cu=t.screenY-ms.screenY):cu=lu=0,ms=t),lu)},movementY:function(t){return"movementY"in t?t.movementY:cu}}),Ap=mt(pc),FT=me({},pc,{dataTransfer:0}),DT=mt(FT),zT=me({},Mo,{relatedTarget:0}),uu=mt(zT),BT=me({},Qr,{animationName:0,elapsedTime:0,pseudoElement:0}),UT=mt(BT),VT=me({},Qr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),jT=mt(VT),GT=me({},Qr,{data:0}),Lp=mt(GT),WT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},HT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$T={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function XT(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=$T[t])?!!e[t]:!1}function wd(){return XT}var YT=me({},Mo,{key:function(t){if(t.key){var e=WT[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=el(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?HT[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wd,charCode:function(t){return t.type==="keypress"?el(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?el(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),ZT=mt(YT),qT=me({},pc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Cp=mt(qT),KT=me({},Mo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wd}),QT=mt(KT),JT=me({},Qr,{propertyName:0,elapsedTime:0,pseudoElement:0}),eS=mt(JT),tS=me({},pc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),nS=mt(tS),iS=[9,13,27,32],Ed=vn&&"CompositionEvent"in window,zs=null;vn&&"documentMode"in document&&(zs=document.documentMode);var rS=vn&&"TextEvent"in window&&!zs,i_=vn&&(!Ed||zs&&8<zs&&11>=zs),Ip=String.fromCharCode(32),Mp=!1;function r_(t,e){switch(t){case"keyup":return iS.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function s_(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ar=!1;function sS(t,e){switch(t){case"compositionend":return s_(e);case"keypress":return e.which!==32?null:(Mp=!0,Ip);case"textInput":return t=e.data,t===Ip&&Mp?null:t;default:return null}}function oS(t,e){if(ar)return t==="compositionend"||!Ed&&r_(t,e)?(t=n_(),Ja=vd=Gn=null,ar=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return i_&&e.locale!=="ko"?null:e.data;default:return null}}var aS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Rp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!aS[t.type]:e==="textarea"}function o_(t,e,n,i){Dv(i),e=Il(e,"onChange"),0<e.length&&(n=new _d("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Bs=null,ro=null;function lS(t){y_(t,0)}function mc(t){var e=ur(t);if(Iv(e))return t}function cS(t,e){if(t==="change")return e}var a_=!1;if(vn){var fu;if(vn){var hu="oninput"in document;if(!hu){var Op=document.createElement("div");Op.setAttribute("oninput","return;"),hu=typeof Op.oninput=="function"}fu=hu}else fu=!1;a_=fu&&(!document.documentMode||9<document.documentMode)}function kp(){Bs&&(Bs.detachEvent("onpropertychange",l_),ro=Bs=null)}function l_(t){if(t.propertyName==="value"&&mc(ro)){var e=[];o_(e,ro,t,dd(t)),Vv(lS,e)}}function uS(t,e,n){t==="focusin"?(kp(),Bs=e,ro=n,Bs.attachEvent("onpropertychange",l_)):t==="focusout"&&kp()}function fS(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return mc(ro)}function hS(t,e){if(t==="click")return mc(e)}function dS(t,e){if(t==="input"||t==="change")return mc(e)}function gS(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Vt=typeof Object.is=="function"?Object.is:gS;function so(t,e){if(Vt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Tf.call(e,r)||!Vt(t[r],e[r]))return!1}return!0}function Np(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Fp(t,e){var n=Np(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Np(n)}}function c_(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?c_(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function u_(){for(var t=window,e=Tl();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Tl(t.document)}return e}function xd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function pS(t){var e=u_(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&c_(n.ownerDocument.documentElement,n)){if(i!==null&&xd(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=Fp(n,s);var o=Fp(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var mS=vn&&"documentMode"in document&&11>=document.documentMode,lr=null,jf=null,Us=null,Gf=!1;function Dp(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Gf||lr==null||lr!==Tl(i)||(i=lr,"selectionStart"in i&&xd(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Us&&so(Us,i)||(Us=i,i=Il(jf,"onSelect"),0<i.length&&(e=new _d("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=lr)))}function fa(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var cr={animationend:fa("Animation","AnimationEnd"),animationiteration:fa("Animation","AnimationIteration"),animationstart:fa("Animation","AnimationStart"),transitionend:fa("Transition","TransitionEnd")},du={},f_={};vn&&(f_=document.createElement("div").style,"AnimationEvent"in window||(delete cr.animationend.animation,delete cr.animationiteration.animation,delete cr.animationstart.animation),"TransitionEvent"in window||delete cr.transitionend.transition);function yc(t){if(du[t])return du[t];if(!cr[t])return t;var e=cr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in f_)return du[t]=e[n];return t}var h_=yc("animationend"),d_=yc("animationiteration"),g_=yc("animationstart"),p_=yc("transitionend"),m_=new Map,zp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ci(t,e){m_.set(t,e),Vi(e,[t])}for(var gu=0;gu<zp.length;gu++){var pu=zp[gu],yS=pu.toLowerCase(),vS=pu[0].toUpperCase()+pu.slice(1);ci(yS,"on"+vS)}ci(h_,"onAnimationEnd");ci(d_,"onAnimationIteration");ci(g_,"onAnimationStart");ci("dblclick","onDoubleClick");ci("focusin","onFocus");ci("focusout","onBlur");ci(p_,"onTransitionEnd");Or("onMouseEnter",["mouseout","mouseover"]);Or("onMouseLeave",["mouseout","mouseover"]);Or("onPointerEnter",["pointerout","pointerover"]);Or("onPointerLeave",["pointerout","pointerover"]);Vi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Vi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Vi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Vi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Vi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Vi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_S=new Set("cancel close invalid load scroll toggle".split(" ").concat(Rs));function Bp(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,yT(i,e,void 0,t),t.currentTarget=null}function y_(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;Bp(r,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;Bp(r,a,c),s=l}}}if(bl)throw t=zf,bl=!1,zf=null,t}function oe(t,e){var n=e[Yf];n===void 0&&(n=e[Yf]=new Set);var i=t+"__bubble";n.has(i)||(v_(e,t,2,!1),n.add(i))}function mu(t,e,n){var i=0;e&&(i|=4),v_(n,t,i,e)}var ha="_reactListening"+Math.random().toString(36).slice(2);function oo(t){if(!t[ha]){t[ha]=!0,bv.forEach(function(n){n!=="selectionchange"&&(_S.has(n)||mu(n,!1,t),mu(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ha]||(e[ha]=!0,mu("selectionchange",!1,e))}}function v_(t,e,n,i){switch(t_(e)){case 1:var r=OT;break;case 4:r=kT;break;default:r=yd}n=r.bind(null,e,n,t),r=void 0,!Df||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function yu(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=xi(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}Vv(function(){var c=s,u=dd(n),f=[];e:{var h=m_.get(t);if(h!==void 0){var d=_d,p=t;switch(t){case"keypress":if(el(n)===0)break e;case"keydown":case"keyup":d=ZT;break;case"focusin":p="focus",d=uu;break;case"focusout":p="blur",d=uu;break;case"beforeblur":case"afterblur":d=uu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=Ap;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=DT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=QT;break;case h_:case d_:case g_:d=UT;break;case p_:d=eS;break;case"scroll":d=NT;break;case"wheel":d=nS;break;case"copy":case"cut":case"paste":d=jT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=Cp}var _=(e&4)!==0,x=!_&&t==="scroll",y=_?h!==null?h+"Capture":null:h;_=[];for(var m=c,w;m!==null;){w=m;var T=w.stateNode;if(w.tag===5&&T!==null&&(w=T,y!==null&&(T=eo(m,y),T!=null&&_.push(ao(m,T,w)))),x)break;m=m.return}0<_.length&&(h=new d(h,p,null,n,u),f.push({event:h,listeners:_}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",h&&n!==Nf&&(p=n.relatedTarget||n.fromElement)&&(xi(p)||p[_n]))break e;if((d||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,d?(p=n.relatedTarget||n.toElement,d=c,p=p?xi(p):null,p!==null&&(x=ji(p),p!==x||p.tag!==5&&p.tag!==6)&&(p=null)):(d=null,p=c),d!==p)){if(_=Ap,T="onMouseLeave",y="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(_=Cp,T="onPointerLeave",y="onPointerEnter",m="pointer"),x=d==null?h:ur(d),w=p==null?h:ur(p),h=new _(T,m+"leave",d,n,u),h.target=x,h.relatedTarget=w,T=null,xi(u)===c&&(_=new _(y,m+"enter",p,n,u),_.target=w,_.relatedTarget=x,T=_),x=T,d&&p)t:{for(_=d,y=p,m=0,w=_;w;w=Zi(w))m++;for(w=0,T=y;T;T=Zi(T))w++;for(;0<m-w;)_=Zi(_),m--;for(;0<w-m;)y=Zi(y),w--;for(;m--;){if(_===y||y!==null&&_===y.alternate)break t;_=Zi(_),y=Zi(y)}_=null}else _=null;d!==null&&Up(f,h,d,_,!1),p!==null&&x!==null&&Up(f,x,p,_,!0)}}e:{if(h=c?ur(c):window,d=h.nodeName&&h.nodeName.toLowerCase(),d==="select"||d==="input"&&h.type==="file")var b=cS;else if(Rp(h))if(a_)b=dS;else{b=fS;var P=uS}else(d=h.nodeName)&&d.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(b=hS);if(b&&(b=b(t,c))){o_(f,b,n,u);break e}P&&P(t,h,c),t==="focusout"&&(P=h._wrapperState)&&P.controlled&&h.type==="number"&&If(h,"number",h.value)}switch(P=c?ur(c):window,t){case"focusin":(Rp(P)||P.contentEditable==="true")&&(lr=P,jf=c,Us=null);break;case"focusout":Us=jf=lr=null;break;case"mousedown":Gf=!0;break;case"contextmenu":case"mouseup":case"dragend":Gf=!1,Dp(f,n,u);break;case"selectionchange":if(mS)break;case"keydown":case"keyup":Dp(f,n,u)}var L;if(Ed)e:{switch(t){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else ar?r_(t,n)&&(C="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(C="onCompositionStart");C&&(i_&&n.locale!=="ko"&&(ar||C!=="onCompositionStart"?C==="onCompositionEnd"&&ar&&(L=n_()):(Gn=u,vd="value"in Gn?Gn.value:Gn.textContent,ar=!0)),P=Il(c,C),0<P.length&&(C=new Lp(C,t,null,n,u),f.push({event:C,listeners:P}),L?C.data=L:(L=s_(n),L!==null&&(C.data=L)))),(L=rS?sS(t,n):oS(t,n))&&(c=Il(c,"onBeforeInput"),0<c.length&&(u=new Lp("onBeforeInput","beforeinput",null,n,u),f.push({event:u,listeners:c}),u.data=L))}y_(f,e)})}function ao(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Il(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=eo(t,n),s!=null&&i.unshift(ao(t,s,r)),s=eo(t,e),s!=null&&i.push(ao(t,s,r))),t=t.return}return i}function Zi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Up(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,r?(l=eo(n,s),l!=null&&o.unshift(ao(n,l,a))):r||(l=eo(n,s),l!=null&&o.push(ao(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var wS=/\r\n?/g,ES=/\u0000|\uFFFD/g;function Vp(t){return(typeof t=="string"?t:""+t).replace(wS,`
`).replace(ES,"")}function da(t,e,n){if(e=Vp(e),Vp(t)!==e&&n)throw Error(O(425))}function Ml(){}var Wf=null,Hf=null;function $f(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Xf=typeof setTimeout=="function"?setTimeout:void 0,xS=typeof clearTimeout=="function"?clearTimeout:void 0,jp=typeof Promise=="function"?Promise:void 0,TS=typeof queueMicrotask=="function"?queueMicrotask:typeof jp<"u"?function(t){return jp.resolve(null).then(t).catch(SS)}:Xf;function SS(t){setTimeout(function(){throw t})}function vu(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),io(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);io(e)}function Kn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Gp(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Jr=Math.random().toString(36).slice(2),Qt="__reactFiber$"+Jr,lo="__reactProps$"+Jr,_n="__reactContainer$"+Jr,Yf="__reactEvents$"+Jr,bS="__reactListeners$"+Jr,PS="__reactHandles$"+Jr;function xi(t){var e=t[Qt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[_n]||n[Qt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Gp(t);t!==null;){if(n=t[Qt])return n;t=Gp(t)}return e}t=n,n=t.parentNode}return null}function Ro(t){return t=t[Qt]||t[_n],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ur(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(O(33))}function vc(t){return t[lo]||null}var Zf=[],fr=-1;function ui(t){return{current:t}}function le(t){0>fr||(t.current=Zf[fr],Zf[fr]=null,fr--)}function re(t,e){fr++,Zf[fr]=t.current,t.current=e}var si={},We=ui(si),nt=ui(!1),Ci=si;function kr(t,e){var n=t.type.contextTypes;if(!n)return si;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function it(t){return t=t.childContextTypes,t!=null}function Rl(){le(nt),le(We)}function Wp(t,e,n){if(We.current!==si)throw Error(O(168));re(We,e),re(nt,n)}function __(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(O(108,uT(t)||"Unknown",r));return me({},n,i)}function Ol(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||si,Ci=We.current,re(We,t),re(nt,nt.current),!0}function Hp(t,e,n){var i=t.stateNode;if(!i)throw Error(O(169));n?(t=__(t,e,Ci),i.__reactInternalMemoizedMergedChildContext=t,le(nt),le(We),re(We,t)):le(nt),re(nt,n)}var fn=null,_c=!1,_u=!1;function w_(t){fn===null?fn=[t]:fn.push(t)}function AS(t){_c=!0,w_(t)}function fi(){if(!_u&&fn!==null){_u=!0;var t=0,e=ee;try{var n=fn;for(ee=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}fn=null,_c=!1}catch(r){throw fn!==null&&(fn=fn.slice(t+1)),Hv(gd,fi),r}finally{ee=e,_u=!1}}return null}var hr=[],dr=0,kl=null,Nl=0,wt=[],Et=0,Ii=null,dn=1,gn="";function _i(t,e){hr[dr++]=Nl,hr[dr++]=kl,kl=t,Nl=e}function E_(t,e,n){wt[Et++]=dn,wt[Et++]=gn,wt[Et++]=Ii,Ii=t;var i=dn;t=gn;var r=32-zt(i)-1;i&=~(1<<r),n+=1;var s=32-zt(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,dn=1<<32-zt(e)+r|n<<r|i,gn=s+t}else dn=1<<s|n<<r|i,gn=t}function Td(t){t.return!==null&&(_i(t,1),E_(t,1,0))}function Sd(t){for(;t===kl;)kl=hr[--dr],hr[dr]=null,Nl=hr[--dr],hr[dr]=null;for(;t===Ii;)Ii=wt[--Et],wt[Et]=null,gn=wt[--Et],wt[Et]=null,dn=wt[--Et],wt[Et]=null}var ft=null,ut=null,ue=!1,Ot=null;function x_(t,e){var n=xt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function $p(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ft=t,ut=Kn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ft=t,ut=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ii!==null?{id:dn,overflow:gn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=xt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ft=t,ut=null,!0):!1;default:return!1}}function qf(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Kf(t){if(ue){var e=ut;if(e){var n=e;if(!$p(t,e)){if(qf(t))throw Error(O(418));e=Kn(n.nextSibling);var i=ft;e&&$p(t,e)?x_(i,n):(t.flags=t.flags&-4097|2,ue=!1,ft=t)}}else{if(qf(t))throw Error(O(418));t.flags=t.flags&-4097|2,ue=!1,ft=t}}}function Xp(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ft=t}function ga(t){if(t!==ft)return!1;if(!ue)return Xp(t),ue=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!$f(t.type,t.memoizedProps)),e&&(e=ut)){if(qf(t))throw T_(),Error(O(418));for(;e;)x_(t,e),e=Kn(e.nextSibling)}if(Xp(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(O(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ut=Kn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ut=null}}else ut=ft?Kn(t.stateNode.nextSibling):null;return!0}function T_(){for(var t=ut;t;)t=Kn(t.nextSibling)}function Nr(){ut=ft=null,ue=!1}function bd(t){Ot===null?Ot=[t]:Ot.push(t)}var LS=Pn.ReactCurrentBatchConfig;function Mt(t,e){if(t&&t.defaultProps){e=me({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Fl=ui(null),Dl=null,gr=null,Pd=null;function Ad(){Pd=gr=Dl=null}function Ld(t){var e=Fl.current;le(Fl),t._currentValue=e}function Qf(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Lr(t,e){Dl=t,Pd=gr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(tt=!0),t.firstContext=null)}function bt(t){var e=t._currentValue;if(Pd!==t)if(t={context:t,memoizedValue:e,next:null},gr===null){if(Dl===null)throw Error(O(308));gr=t,Dl.dependencies={lanes:0,firstContext:t}}else gr=gr.next=t;return e}var Ti=null;function Cd(t){Ti===null?Ti=[t]:Ti.push(t)}function S_(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Cd(e)):(n.next=r.next,r.next=n),e.interleaved=n,wn(t,i)}function wn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Bn=!1;function Id(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function b_(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function mn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Qn(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Q&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,wn(t,n)}return r=i.interleaved,r===null?(e.next=e,Cd(i)):(e.next=r.next,r.next=e),i.interleaved=e,wn(t,n)}function tl(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,pd(t,n)}}function Yp(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function zl(t,e,n,i){var r=t.updateQueue;Bn=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var f=r.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,d=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:d,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,_=a;switch(h=e,d=n,_.tag){case 1:if(p=_.payload,typeof p=="function"){f=p.call(d,f,h);break e}f=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=_.payload,h=typeof p=="function"?p.call(d,f,h):p,h==null)break e;f=me({},f,h);break e;case 2:Bn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else d={eventTime:d,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=d,l=f):u=u.next=d,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(1);if(u===null&&(l=f),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Ri|=o,t.lanes=o,t.memoizedState=f}}function Zp(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(O(191,r));r.call(i)}}}var P_=new Sv.Component().refs;function Jf(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:me({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var wc={isMounted:function(t){return(t=t._reactInternals)?ji(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Ze(),r=ei(t),s=mn(i,r);s.payload=e,n!=null&&(s.callback=n),e=Qn(t,s,r),e!==null&&(Bt(e,t,r,i),tl(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Ze(),r=ei(t),s=mn(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Qn(t,s,r),e!==null&&(Bt(e,t,r,i),tl(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ze(),i=ei(t),r=mn(n,i);r.tag=2,e!=null&&(r.callback=e),e=Qn(t,r,i),e!==null&&(Bt(e,t,i,n),tl(e,t,i))}};function qp(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!so(n,i)||!so(r,s):!0}function A_(t,e,n){var i=!1,r=si,s=e.contextType;return typeof s=="object"&&s!==null?s=bt(s):(r=it(e)?Ci:We.current,i=e.contextTypes,s=(i=i!=null)?kr(t,r):si),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=wc,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function Kp(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&wc.enqueueReplaceState(e,e.state,null)}function eh(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=P_,Id(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=bt(s):(s=it(e)?Ci:We.current,r.context=kr(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Jf(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&wc.enqueueReplaceState(r,r.state,null),zl(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function ys(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(O(309));var i=n.stateNode}if(!i)throw Error(O(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;a===P_&&(a=r.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(O(284));if(!n._owner)throw Error(O(290,t))}return t}function pa(t,e){throw t=Object.prototype.toString.call(e),Error(O(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Qp(t){var e=t._init;return e(t._payload)}function L_(t){function e(y,m){if(t){var w=y.deletions;w===null?(y.deletions=[m],y.flags|=16):w.push(m)}}function n(y,m){if(!t)return null;for(;m!==null;)e(y,m),m=m.sibling;return null}function i(y,m){for(y=new Map;m!==null;)m.key!==null?y.set(m.key,m):y.set(m.index,m),m=m.sibling;return y}function r(y,m){return y=ti(y,m),y.index=0,y.sibling=null,y}function s(y,m,w){return y.index=w,t?(w=y.alternate,w!==null?(w=w.index,w<m?(y.flags|=2,m):w):(y.flags|=2,m)):(y.flags|=1048576,m)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,m,w,T){return m===null||m.tag!==6?(m=Pu(w,y.mode,T),m.return=y,m):(m=r(m,w),m.return=y,m)}function l(y,m,w,T){var b=w.type;return b===or?u(y,m,w.props.children,T,w.key):m!==null&&(m.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===zn&&Qp(b)===m.type)?(T=r(m,w.props),T.ref=ys(y,m,w),T.return=y,T):(T=al(w.type,w.key,w.props,null,y.mode,T),T.ref=ys(y,m,w),T.return=y,T)}function c(y,m,w,T){return m===null||m.tag!==4||m.stateNode.containerInfo!==w.containerInfo||m.stateNode.implementation!==w.implementation?(m=Au(w,y.mode,T),m.return=y,m):(m=r(m,w.children||[]),m.return=y,m)}function u(y,m,w,T,b){return m===null||m.tag!==7?(m=Ai(w,y.mode,T,b),m.return=y,m):(m=r(m,w),m.return=y,m)}function f(y,m,w){if(typeof m=="string"&&m!==""||typeof m=="number")return m=Pu(""+m,y.mode,w),m.return=y,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case ra:return w=al(m.type,m.key,m.props,null,y.mode,w),w.ref=ys(y,null,m),w.return=y,w;case sr:return m=Au(m,y.mode,w),m.return=y,m;case zn:var T=m._init;return f(y,T(m._payload),w)}if(Is(m)||hs(m))return m=Ai(m,y.mode,w,null),m.return=y,m;pa(y,m)}return null}function h(y,m,w,T){var b=m!==null?m.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return b!==null?null:a(y,m,""+w,T);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case ra:return w.key===b?l(y,m,w,T):null;case sr:return w.key===b?c(y,m,w,T):null;case zn:return b=w._init,h(y,m,b(w._payload),T)}if(Is(w)||hs(w))return b!==null?null:u(y,m,w,T,null);pa(y,w)}return null}function d(y,m,w,T,b){if(typeof T=="string"&&T!==""||typeof T=="number")return y=y.get(w)||null,a(m,y,""+T,b);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case ra:return y=y.get(T.key===null?w:T.key)||null,l(m,y,T,b);case sr:return y=y.get(T.key===null?w:T.key)||null,c(m,y,T,b);case zn:var P=T._init;return d(y,m,w,P(T._payload),b)}if(Is(T)||hs(T))return y=y.get(w)||null,u(m,y,T,b,null);pa(m,T)}return null}function p(y,m,w,T){for(var b=null,P=null,L=m,C=m=0,M=null;L!==null&&C<w.length;C++){L.index>C?(M=L,L=null):M=L.sibling;var R=h(y,L,w[C],T);if(R===null){L===null&&(L=M);break}t&&L&&R.alternate===null&&e(y,L),m=s(R,m,C),P===null?b=R:P.sibling=R,P=R,L=M}if(C===w.length)return n(y,L),ue&&_i(y,C),b;if(L===null){for(;C<w.length;C++)L=f(y,w[C],T),L!==null&&(m=s(L,m,C),P===null?b=L:P.sibling=L,P=L);return ue&&_i(y,C),b}for(L=i(y,L);C<w.length;C++)M=d(L,y,C,w[C],T),M!==null&&(t&&M.alternate!==null&&L.delete(M.key===null?C:M.key),m=s(M,m,C),P===null?b=M:P.sibling=M,P=M);return t&&L.forEach(function(V){return e(y,V)}),ue&&_i(y,C),b}function _(y,m,w,T){var b=hs(w);if(typeof b!="function")throw Error(O(150));if(w=b.call(w),w==null)throw Error(O(151));for(var P=b=null,L=m,C=m=0,M=null,R=w.next();L!==null&&!R.done;C++,R=w.next()){L.index>C?(M=L,L=null):M=L.sibling;var V=h(y,L,R.value,T);if(V===null){L===null&&(L=M);break}t&&L&&V.alternate===null&&e(y,L),m=s(V,m,C),P===null?b=V:P.sibling=V,P=V,L=M}if(R.done)return n(y,L),ue&&_i(y,C),b;if(L===null){for(;!R.done;C++,R=w.next())R=f(y,R.value,T),R!==null&&(m=s(R,m,C),P===null?b=R:P.sibling=R,P=R);return ue&&_i(y,C),b}for(L=i(y,L);!R.done;C++,R=w.next())R=d(L,y,C,R.value,T),R!==null&&(t&&R.alternate!==null&&L.delete(R.key===null?C:R.key),m=s(R,m,C),P===null?b=R:P.sibling=R,P=R);return t&&L.forEach(function(W){return e(y,W)}),ue&&_i(y,C),b}function x(y,m,w,T){if(typeof w=="object"&&w!==null&&w.type===or&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case ra:e:{for(var b=w.key,P=m;P!==null;){if(P.key===b){if(b=w.type,b===or){if(P.tag===7){n(y,P.sibling),m=r(P,w.props.children),m.return=y,y=m;break e}}else if(P.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===zn&&Qp(b)===P.type){n(y,P.sibling),m=r(P,w.props),m.ref=ys(y,P,w),m.return=y,y=m;break e}n(y,P);break}else e(y,P);P=P.sibling}w.type===or?(m=Ai(w.props.children,y.mode,T,w.key),m.return=y,y=m):(T=al(w.type,w.key,w.props,null,y.mode,T),T.ref=ys(y,m,w),T.return=y,y=T)}return o(y);case sr:e:{for(P=w.key;m!==null;){if(m.key===P)if(m.tag===4&&m.stateNode.containerInfo===w.containerInfo&&m.stateNode.implementation===w.implementation){n(y,m.sibling),m=r(m,w.children||[]),m.return=y,y=m;break e}else{n(y,m);break}else e(y,m);m=m.sibling}m=Au(w,y.mode,T),m.return=y,y=m}return o(y);case zn:return P=w._init,x(y,m,P(w._payload),T)}if(Is(w))return p(y,m,w,T);if(hs(w))return _(y,m,w,T);pa(y,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,m!==null&&m.tag===6?(n(y,m.sibling),m=r(m,w),m.return=y,y=m):(n(y,m),m=Pu(w,y.mode,T),m.return=y,y=m),o(y)):n(y,m)}return x}var Fr=L_(!0),C_=L_(!1),Oo={},tn=ui(Oo),co=ui(Oo),uo=ui(Oo);function Si(t){if(t===Oo)throw Error(O(174));return t}function Md(t,e){switch(re(uo,e),re(co,t),re(tn,Oo),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Rf(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Rf(e,t)}le(tn),re(tn,e)}function Dr(){le(tn),le(co),le(uo)}function I_(t){Si(uo.current);var e=Si(tn.current),n=Rf(e,t.type);e!==n&&(re(co,t),re(tn,n))}function Rd(t){co.current===t&&(le(tn),le(co))}var he=ui(0);function Bl(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var wu=[];function Od(){for(var t=0;t<wu.length;t++)wu[t]._workInProgressVersionPrimary=null;wu.length=0}var nl=Pn.ReactCurrentDispatcher,Eu=Pn.ReactCurrentBatchConfig,Mi=0,pe=null,Se=null,Le=null,Ul=!1,Vs=!1,fo=0,CS=0;function De(){throw Error(O(321))}function kd(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Vt(t[n],e[n]))return!1;return!0}function Nd(t,e,n,i,r,s){if(Mi=s,pe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,nl.current=t===null||t.memoizedState===null?OS:kS,t=n(i,r),Vs){s=0;do{if(Vs=!1,fo=0,25<=s)throw Error(O(301));s+=1,Le=Se=null,e.updateQueue=null,nl.current=NS,t=n(i,r)}while(Vs)}if(nl.current=Vl,e=Se!==null&&Se.next!==null,Mi=0,Le=Se=pe=null,Ul=!1,e)throw Error(O(300));return t}function Fd(){var t=fo!==0;return fo=0,t}function Kt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Le===null?pe.memoizedState=Le=t:Le=Le.next=t,Le}function Pt(){if(Se===null){var t=pe.alternate;t=t!==null?t.memoizedState:null}else t=Se.next;var e=Le===null?pe.memoizedState:Le.next;if(e!==null)Le=e,Se=t;else{if(t===null)throw Error(O(310));Se=t,t={memoizedState:Se.memoizedState,baseState:Se.baseState,baseQueue:Se.baseQueue,queue:Se.queue,next:null},Le===null?pe.memoizedState=Le=t:Le=Le.next=t}return Le}function ho(t,e){return typeof e=="function"?e(t):e}function xu(t){var e=Pt(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var i=Se,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Mi&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var f={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=f,o=i):l=l.next=f,pe.lanes|=u,Ri|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,Vt(i,e.memoizedState)||(tt=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,pe.lanes|=s,Ri|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Tu(t){var e=Pt(),n=e.queue;if(n===null)throw Error(O(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Vt(s,e.memoizedState)||(tt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function M_(){}function R_(t,e){var n=pe,i=Pt(),r=e(),s=!Vt(i.memoizedState,r);if(s&&(i.memoizedState=r,tt=!0),i=i.queue,Dd(N_.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Le!==null&&Le.memoizedState.tag&1){if(n.flags|=2048,go(9,k_.bind(null,n,i,r,e),void 0,null),Ie===null)throw Error(O(349));Mi&30||O_(n,e,r)}return r}function O_(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=pe.updateQueue,e===null?(e={lastEffect:null,stores:null},pe.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function k_(t,e,n,i){e.value=n,e.getSnapshot=i,F_(e)&&D_(t)}function N_(t,e,n){return n(function(){F_(e)&&D_(t)})}function F_(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Vt(t,n)}catch{return!0}}function D_(t){var e=wn(t,1);e!==null&&Bt(e,t,1,-1)}function Jp(t){var e=Kt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ho,lastRenderedState:t},e.queue=t,t=t.dispatch=RS.bind(null,pe,t),[e.memoizedState,t]}function go(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=pe.updateQueue,e===null?(e={lastEffect:null,stores:null},pe.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function z_(){return Pt().memoizedState}function il(t,e,n,i){var r=Kt();pe.flags|=t,r.memoizedState=go(1|e,n,void 0,i===void 0?null:i)}function Ec(t,e,n,i){var r=Pt();i=i===void 0?null:i;var s=void 0;if(Se!==null){var o=Se.memoizedState;if(s=o.destroy,i!==null&&kd(i,o.deps)){r.memoizedState=go(e,n,s,i);return}}pe.flags|=t,r.memoizedState=go(1|e,n,s,i)}function em(t,e){return il(8390656,8,t,e)}function Dd(t,e){return Ec(2048,8,t,e)}function B_(t,e){return Ec(4,2,t,e)}function U_(t,e){return Ec(4,4,t,e)}function V_(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function j_(t,e,n){return n=n!=null?n.concat([t]):null,Ec(4,4,V_.bind(null,e,t),n)}function zd(){}function G_(t,e){var n=Pt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&kd(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function W_(t,e){var n=Pt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&kd(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function H_(t,e,n){return Mi&21?(Vt(n,e)||(n=Yv(),pe.lanes|=n,Ri|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,tt=!0),t.memoizedState=n)}function IS(t,e){var n=ee;ee=n!==0&&4>n?n:4,t(!0);var i=Eu.transition;Eu.transition={};try{t(!1),e()}finally{ee=n,Eu.transition=i}}function $_(){return Pt().memoizedState}function MS(t,e,n){var i=ei(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},X_(t))Y_(e,n);else if(n=S_(t,e,n,i),n!==null){var r=Ze();Bt(n,t,i,r),Z_(n,e,i)}}function RS(t,e,n){var i=ei(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(X_(t))Y_(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Vt(a,o)){var l=e.interleaved;l===null?(r.next=r,Cd(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=S_(t,e,r,i),n!==null&&(r=Ze(),Bt(n,t,i,r),Z_(n,e,i))}}function X_(t){var e=t.alternate;return t===pe||e!==null&&e===pe}function Y_(t,e){Vs=Ul=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Z_(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,pd(t,n)}}var Vl={readContext:bt,useCallback:De,useContext:De,useEffect:De,useImperativeHandle:De,useInsertionEffect:De,useLayoutEffect:De,useMemo:De,useReducer:De,useRef:De,useState:De,useDebugValue:De,useDeferredValue:De,useTransition:De,useMutableSource:De,useSyncExternalStore:De,useId:De,unstable_isNewReconciler:!1},OS={readContext:bt,useCallback:function(t,e){return Kt().memoizedState=[t,e===void 0?null:e],t},useContext:bt,useEffect:em,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,il(4194308,4,V_.bind(null,e,t),n)},useLayoutEffect:function(t,e){return il(4194308,4,t,e)},useInsertionEffect:function(t,e){return il(4,2,t,e)},useMemo:function(t,e){var n=Kt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Kt();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=MS.bind(null,pe,t),[i.memoizedState,t]},useRef:function(t){var e=Kt();return t={current:t},e.memoizedState=t},useState:Jp,useDebugValue:zd,useDeferredValue:function(t){return Kt().memoizedState=t},useTransition:function(){var t=Jp(!1),e=t[0];return t=IS.bind(null,t[1]),Kt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=pe,r=Kt();if(ue){if(n===void 0)throw Error(O(407));n=n()}else{if(n=e(),Ie===null)throw Error(O(349));Mi&30||O_(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,em(N_.bind(null,i,s,t),[t]),i.flags|=2048,go(9,k_.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Kt(),e=Ie.identifierPrefix;if(ue){var n=gn,i=dn;n=(i&~(1<<32-zt(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=fo++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=CS++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},kS={readContext:bt,useCallback:G_,useContext:bt,useEffect:Dd,useImperativeHandle:j_,useInsertionEffect:B_,useLayoutEffect:U_,useMemo:W_,useReducer:xu,useRef:z_,useState:function(){return xu(ho)},useDebugValue:zd,useDeferredValue:function(t){var e=Pt();return H_(e,Se.memoizedState,t)},useTransition:function(){var t=xu(ho)[0],e=Pt().memoizedState;return[t,e]},useMutableSource:M_,useSyncExternalStore:R_,useId:$_,unstable_isNewReconciler:!1},NS={readContext:bt,useCallback:G_,useContext:bt,useEffect:Dd,useImperativeHandle:j_,useInsertionEffect:B_,useLayoutEffect:U_,useMemo:W_,useReducer:Tu,useRef:z_,useState:function(){return Tu(ho)},useDebugValue:zd,useDeferredValue:function(t){var e=Pt();return Se===null?e.memoizedState=t:H_(e,Se.memoizedState,t)},useTransition:function(){var t=Tu(ho)[0],e=Pt().memoizedState;return[t,e]},useMutableSource:M_,useSyncExternalStore:R_,useId:$_,unstable_isNewReconciler:!1};function zr(t,e){try{var n="",i=e;do n+=cT(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function Su(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function th(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var FS=typeof WeakMap=="function"?WeakMap:Map;function q_(t,e,n){n=mn(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Gl||(Gl=!0,fh=i),th(t,e)},n}function K_(t,e,n){n=mn(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){th(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){th(t,e),typeof i!="function"&&(Jn===null?Jn=new Set([this]):Jn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function tm(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new FS;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=qS.bind(null,t,e,n),e.then(t,t))}function nm(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function im(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=mn(-1,1),e.tag=2,Qn(n,e,1))),n.lanes|=1),t)}var DS=Pn.ReactCurrentOwner,tt=!1;function $e(t,e,n,i){e.child=t===null?C_(e,null,n,i):Fr(e,t.child,n,i)}function rm(t,e,n,i,r){n=n.render;var s=e.ref;return Lr(e,r),i=Nd(t,e,n,i,s,r),n=Fd(),t!==null&&!tt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,En(t,e,r)):(ue&&n&&Td(e),e.flags|=1,$e(t,e,i,r),e.child)}function sm(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!$d(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Q_(t,e,s,i,r)):(t=al(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:so,n(o,i)&&t.ref===e.ref)return En(t,e,r)}return e.flags|=1,t=ti(s,i),t.ref=e.ref,t.return=e,e.child=t}function Q_(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(so(s,i)&&t.ref===e.ref)if(tt=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(tt=!0);else return e.lanes=t.lanes,En(t,e,r)}return nh(t,e,n,i,r)}function J_(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},re(mr,lt),lt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,re(mr,lt),lt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,re(mr,lt),lt|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,re(mr,lt),lt|=i;return $e(t,e,r,n),e.child}function e1(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function nh(t,e,n,i,r){var s=it(n)?Ci:We.current;return s=kr(e,s),Lr(e,r),n=Nd(t,e,n,i,s,r),i=Fd(),t!==null&&!tt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,En(t,e,r)):(ue&&i&&Td(e),e.flags|=1,$e(t,e,n,r),e.child)}function om(t,e,n,i,r){if(it(n)){var s=!0;Ol(e)}else s=!1;if(Lr(e,r),e.stateNode===null)rl(t,e),A_(e,n,i),eh(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=bt(c):(c=it(n)?Ci:We.current,c=kr(e,c));var u=n.getDerivedStateFromProps,f=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&Kp(e,o,i,c),Bn=!1;var h=e.memoizedState;o.state=h,zl(e,i,o,r),l=e.memoizedState,a!==i||h!==l||nt.current||Bn?(typeof u=="function"&&(Jf(e,n,u,i),l=e.memoizedState),(a=Bn||qp(e,n,a,i,h,l,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,b_(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Mt(e.type,a),o.props=c,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=bt(l):(l=it(n)?Ci:We.current,l=kr(e,l));var d=n.getDerivedStateFromProps;(u=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&Kp(e,o,i,l),Bn=!1,h=e.memoizedState,o.state=h,zl(e,i,o,r);var p=e.memoizedState;a!==f||h!==p||nt.current||Bn?(typeof d=="function"&&(Jf(e,n,d,i),p=e.memoizedState),(c=Bn||qp(e,n,c,i,h,p,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),o.props=i,o.state=p,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return ih(t,e,n,i,s,r)}function ih(t,e,n,i,r,s){e1(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&Hp(e,n,!1),En(t,e,s);i=e.stateNode,DS.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=Fr(e,t.child,null,s),e.child=Fr(e,null,a,s)):$e(t,e,a,s),e.memoizedState=i.state,r&&Hp(e,n,!0),e.child}function t1(t){var e=t.stateNode;e.pendingContext?Wp(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Wp(t,e.context,!1),Md(t,e.containerInfo)}function am(t,e,n,i,r){return Nr(),bd(r),e.flags|=256,$e(t,e,n,i),e.child}var rh={dehydrated:null,treeContext:null,retryLane:0};function sh(t){return{baseLanes:t,cachePool:null,transitions:null}}function n1(t,e,n){var i=e.pendingProps,r=he.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),re(he,r&1),t===null)return Kf(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Sc(o,i,0,null),t=Ai(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=sh(n),e.memoizedState=rh,t):Bd(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return zS(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=ti(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=ti(a,s):(s=Ai(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?sh(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=rh,i}return s=t.child,t=s.sibling,i=ti(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Bd(t,e){return e=Sc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ma(t,e,n,i){return i!==null&&bd(i),Fr(e,t.child,null,n),t=Bd(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function zS(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=Su(Error(O(422))),ma(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=Sc({mode:"visible",children:i.children},r,0,null),s=Ai(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Fr(e,t.child,null,o),e.child.memoizedState=sh(o),e.memoizedState=rh,s);if(!(e.mode&1))return ma(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(O(419)),i=Su(s,i,void 0),ma(t,e,o,i)}if(a=(o&t.childLanes)!==0,tt||a){if(i=Ie,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,wn(t,r),Bt(i,t,r,-1))}return Hd(),i=Su(Error(O(421))),ma(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=KS.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,ut=Kn(r.nextSibling),ft=e,ue=!0,Ot=null,t!==null&&(wt[Et++]=dn,wt[Et++]=gn,wt[Et++]=Ii,dn=t.id,gn=t.overflow,Ii=e),e=Bd(e,i.children),e.flags|=4096,e)}function lm(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Qf(t.return,e,n)}function bu(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function i1(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if($e(t,e,i.children,n),i=he.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&lm(t,n,e);else if(t.tag===19)lm(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(re(he,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Bl(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),bu(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Bl(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}bu(e,!0,n,null,s);break;case"together":bu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function rl(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function En(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ri|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(O(153));if(e.child!==null){for(t=e.child,n=ti(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ti(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function BS(t,e,n){switch(e.tag){case 3:t1(e),Nr();break;case 5:I_(e);break;case 1:it(e.type)&&Ol(e);break;case 4:Md(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;re(Fl,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(re(he,he.current&1),e.flags|=128,null):n&e.child.childLanes?n1(t,e,n):(re(he,he.current&1),t=En(t,e,n),t!==null?t.sibling:null);re(he,he.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return i1(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),re(he,he.current),i)break;return null;case 22:case 23:return e.lanes=0,J_(t,e,n)}return En(t,e,n)}var r1,oh,s1,o1;r1=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};oh=function(){};s1=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Si(tn.current);var s=null;switch(n){case"input":r=Lf(t,r),i=Lf(t,i),s=[];break;case"select":r=me({},r,{value:void 0}),i=me({},i,{value:void 0}),s=[];break;case"textarea":r=Mf(t,r),i=Mf(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Ml)}Of(n,i);var o;n=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Qs.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Qs.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&oe("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};o1=function(t,e,n,i){n!==i&&(e.flags|=4)};function vs(t,e){if(!ue)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function ze(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function US(t,e,n){var i=e.pendingProps;switch(Sd(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ze(e),null;case 1:return it(e.type)&&Rl(),ze(e),null;case 3:return i=e.stateNode,Dr(),le(nt),le(We),Od(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(ga(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ot!==null&&(gh(Ot),Ot=null))),oh(t,e),ze(e),null;case 5:Rd(e);var r=Si(uo.current);if(n=e.type,t!==null&&e.stateNode!=null)s1(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(O(166));return ze(e),null}if(t=Si(tn.current),ga(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Qt]=e,i[lo]=s,t=(e.mode&1)!==0,n){case"dialog":oe("cancel",i),oe("close",i);break;case"iframe":case"object":case"embed":oe("load",i);break;case"video":case"audio":for(r=0;r<Rs.length;r++)oe(Rs[r],i);break;case"source":oe("error",i);break;case"img":case"image":case"link":oe("error",i),oe("load",i);break;case"details":oe("toggle",i);break;case"input":yp(i,s),oe("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},oe("invalid",i);break;case"textarea":_p(i,s),oe("invalid",i)}Of(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&da(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&da(i.textContent,a,t),r=["children",""+a]):Qs.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&oe("scroll",i)}switch(n){case"input":sa(i),vp(i,s,!0);break;case"textarea":sa(i),wp(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Ml)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Ov(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Qt]=e,t[lo]=i,r1(t,e,!1,!1),e.stateNode=t;e:{switch(o=kf(n,i),n){case"dialog":oe("cancel",t),oe("close",t),r=i;break;case"iframe":case"object":case"embed":oe("load",t),r=i;break;case"video":case"audio":for(r=0;r<Rs.length;r++)oe(Rs[r],t);r=i;break;case"source":oe("error",t),r=i;break;case"img":case"image":case"link":oe("error",t),oe("load",t),r=i;break;case"details":oe("toggle",t),r=i;break;case"input":yp(t,i),r=Lf(t,i),oe("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=me({},i,{value:void 0}),oe("invalid",t);break;case"textarea":_p(t,i),r=Mf(t,i),oe("invalid",t);break;default:r=i}Of(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Fv(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&kv(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Js(t,l):typeof l=="number"&&Js(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Qs.hasOwnProperty(s)?l!=null&&s==="onScroll"&&oe("scroll",t):l!=null&&cd(t,s,l,o))}switch(n){case"input":sa(t),vp(t,i,!1);break;case"textarea":sa(t),wp(t);break;case"option":i.value!=null&&t.setAttribute("value",""+ri(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Sr(t,!!i.multiple,s,!1):i.defaultValue!=null&&Sr(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Ml)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ze(e),null;case 6:if(t&&e.stateNode!=null)o1(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(O(166));if(n=Si(uo.current),Si(tn.current),ga(e)){if(i=e.stateNode,n=e.memoizedProps,i[Qt]=e,(s=i.nodeValue!==n)&&(t=ft,t!==null))switch(t.tag){case 3:da(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&da(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Qt]=e,e.stateNode=i}return ze(e),null;case 13:if(le(he),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ue&&ut!==null&&e.mode&1&&!(e.flags&128))T_(),Nr(),e.flags|=98560,s=!1;else if(s=ga(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(O(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(O(317));s[Qt]=e}else Nr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ze(e),s=!1}else Ot!==null&&(gh(Ot),Ot=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||he.current&1?be===0&&(be=3):Hd())),e.updateQueue!==null&&(e.flags|=4),ze(e),null);case 4:return Dr(),oh(t,e),t===null&&oo(e.stateNode.containerInfo),ze(e),null;case 10:return Ld(e.type._context),ze(e),null;case 17:return it(e.type)&&Rl(),ze(e),null;case 19:if(le(he),s=e.memoizedState,s===null)return ze(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)vs(s,!1);else{if(be!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Bl(t),o!==null){for(e.flags|=128,vs(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return re(he,he.current&1|2),e.child}t=t.sibling}s.tail!==null&&_e()>Br&&(e.flags|=128,i=!0,vs(s,!1),e.lanes=4194304)}else{if(!i)if(t=Bl(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),vs(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!ue)return ze(e),null}else 2*_e()-s.renderingStartTime>Br&&n!==1073741824&&(e.flags|=128,i=!0,vs(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=_e(),e.sibling=null,n=he.current,re(he,i?n&1|2:n&1),e):(ze(e),null);case 22:case 23:return Wd(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?lt&1073741824&&(ze(e),e.subtreeFlags&6&&(e.flags|=8192)):ze(e),null;case 24:return null;case 25:return null}throw Error(O(156,e.tag))}function VS(t,e){switch(Sd(e),e.tag){case 1:return it(e.type)&&Rl(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Dr(),le(nt),le(We),Od(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Rd(e),null;case 13:if(le(he),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(O(340));Nr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return le(he),null;case 4:return Dr(),null;case 10:return Ld(e.type._context),null;case 22:case 23:return Wd(),null;case 24:return null;default:return null}}var ya=!1,je=!1,jS=typeof WeakSet=="function"?WeakSet:Set,B=null;function pr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){ve(t,e,i)}else n.current=null}function ah(t,e,n){try{n()}catch(i){ve(t,e,i)}}var cm=!1;function GS(t,e){if(Wf=Ll,t=u_(),xd(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,f=t,h=null;t:for(;;){for(var d;f!==n||r!==0&&f.nodeType!==3||(a=o+r),f!==s||i!==0&&f.nodeType!==3||(l=o+i),f.nodeType===3&&(o+=f.nodeValue.length),(d=f.firstChild)!==null;)h=f,f=d;for(;;){if(f===t)break t;if(h===n&&++c===r&&(a=o),h===s&&++u===i&&(l=o),(d=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=d}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Hf={focusedElem:t,selectionRange:n},Ll=!1,B=e;B!==null;)if(e=B,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,B=t;else for(;B!==null;){e=B;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var _=p.memoizedProps,x=p.memoizedState,y=e.stateNode,m=y.getSnapshotBeforeUpdate(e.elementType===e.type?_:Mt(e.type,_),x);y.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(O(163))}}catch(T){ve(e,e.return,T)}if(t=e.sibling,t!==null){t.return=e.return,B=t;break}B=e.return}return p=cm,cm=!1,p}function js(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&ah(e,n,s)}r=r.next}while(r!==i)}}function xc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function lh(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function a1(t){var e=t.alternate;e!==null&&(t.alternate=null,a1(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Qt],delete e[lo],delete e[Yf],delete e[bS],delete e[PS])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function l1(t){return t.tag===5||t.tag===3||t.tag===4}function um(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||l1(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ch(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ml));else if(i!==4&&(t=t.child,t!==null))for(ch(t,e,n),t=t.sibling;t!==null;)ch(t,e,n),t=t.sibling}function uh(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(uh(t,e,n),t=t.sibling;t!==null;)uh(t,e,n),t=t.sibling}var Oe=null,Rt=!1;function Mn(t,e,n){for(n=n.child;n!==null;)c1(t,e,n),n=n.sibling}function c1(t,e,n){if(en&&typeof en.onCommitFiberUnmount=="function")try{en.onCommitFiberUnmount(gc,n)}catch{}switch(n.tag){case 5:je||pr(n,e);case 6:var i=Oe,r=Rt;Oe=null,Mn(t,e,n),Oe=i,Rt=r,Oe!==null&&(Rt?(t=Oe,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Oe.removeChild(n.stateNode));break;case 18:Oe!==null&&(Rt?(t=Oe,n=n.stateNode,t.nodeType===8?vu(t.parentNode,n):t.nodeType===1&&vu(t,n),io(t)):vu(Oe,n.stateNode));break;case 4:i=Oe,r=Rt,Oe=n.stateNode.containerInfo,Rt=!0,Mn(t,e,n),Oe=i,Rt=r;break;case 0:case 11:case 14:case 15:if(!je&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&ah(n,e,o),r=r.next}while(r!==i)}Mn(t,e,n);break;case 1:if(!je&&(pr(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){ve(n,e,a)}Mn(t,e,n);break;case 21:Mn(t,e,n);break;case 22:n.mode&1?(je=(i=je)||n.memoizedState!==null,Mn(t,e,n),je=i):Mn(t,e,n);break;default:Mn(t,e,n)}}function fm(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new jS),e.forEach(function(i){var r=QS.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function It(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Oe=a.stateNode,Rt=!1;break e;case 3:Oe=a.stateNode.containerInfo,Rt=!0;break e;case 4:Oe=a.stateNode.containerInfo,Rt=!0;break e}a=a.return}if(Oe===null)throw Error(O(160));c1(s,o,r),Oe=null,Rt=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){ve(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)u1(e,t),e=e.sibling}function u1(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(It(e,t),$t(t),i&4){try{js(3,t,t.return),xc(3,t)}catch(_){ve(t,t.return,_)}try{js(5,t,t.return)}catch(_){ve(t,t.return,_)}}break;case 1:It(e,t),$t(t),i&512&&n!==null&&pr(n,n.return);break;case 5:if(It(e,t),$t(t),i&512&&n!==null&&pr(n,n.return),t.flags&32){var r=t.stateNode;try{Js(r,"")}catch(_){ve(t,t.return,_)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Mv(r,s),kf(a,o);var c=kf(a,s);for(o=0;o<l.length;o+=2){var u=l[o],f=l[o+1];u==="style"?Fv(r,f):u==="dangerouslySetInnerHTML"?kv(r,f):u==="children"?Js(r,f):cd(r,u,f,c)}switch(a){case"input":Cf(r,s);break;case"textarea":Rv(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var d=s.value;d!=null?Sr(r,!!s.multiple,d,!1):h!==!!s.multiple&&(s.defaultValue!=null?Sr(r,!!s.multiple,s.defaultValue,!0):Sr(r,!!s.multiple,s.multiple?[]:"",!1))}r[lo]=s}catch(_){ve(t,t.return,_)}}break;case 6:if(It(e,t),$t(t),i&4){if(t.stateNode===null)throw Error(O(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(_){ve(t,t.return,_)}}break;case 3:if(It(e,t),$t(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{io(e.containerInfo)}catch(_){ve(t,t.return,_)}break;case 4:It(e,t),$t(t);break;case 13:It(e,t),$t(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(jd=_e())),i&4&&fm(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(je=(c=je)||u,It(e,t),je=c):It(e,t),$t(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(B=t,u=t.child;u!==null;){for(f=B=u;B!==null;){switch(h=B,d=h.child,h.tag){case 0:case 11:case 14:case 15:js(4,h,h.return);break;case 1:pr(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(_){ve(i,n,_)}}break;case 5:pr(h,h.return);break;case 22:if(h.memoizedState!==null){dm(f);continue}}d!==null?(d.return=h,B=d):dm(f)}u=u.sibling}e:for(u=null,f=t;;){if(f.tag===5){if(u===null){u=f;try{r=f.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Nv("display",o))}catch(_){ve(t,t.return,_)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(_){ve(t,t.return,_)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:It(e,t),$t(t),i&4&&fm(t);break;case 21:break;default:It(e,t),$t(t)}}function $t(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(l1(n)){var i=n;break e}n=n.return}throw Error(O(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Js(r,""),i.flags&=-33);var s=um(t);uh(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=um(t);ch(t,a,o);break;default:throw Error(O(161))}}catch(l){ve(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function WS(t,e,n){B=t,f1(t)}function f1(t,e,n){for(var i=(t.mode&1)!==0;B!==null;){var r=B,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||ya;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||je;a=ya;var c=je;if(ya=o,(je=l)&&!c)for(B=r;B!==null;)o=B,l=o.child,o.tag===22&&o.memoizedState!==null?gm(r):l!==null?(l.return=o,B=l):gm(r);for(;s!==null;)B=s,f1(s),s=s.sibling;B=r,ya=a,je=c}hm(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,B=s):hm(t)}}function hm(t){for(;B!==null;){var e=B;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:je||xc(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!je)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Mt(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Zp(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Zp(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&io(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(O(163))}je||e.flags&512&&lh(e)}catch(h){ve(e,e.return,h)}}if(e===t){B=null;break}if(n=e.sibling,n!==null){n.return=e.return,B=n;break}B=e.return}}function dm(t){for(;B!==null;){var e=B;if(e===t){B=null;break}var n=e.sibling;if(n!==null){n.return=e.return,B=n;break}B=e.return}}function gm(t){for(;B!==null;){var e=B;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{xc(4,e)}catch(l){ve(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){ve(e,r,l)}}var s=e.return;try{lh(e)}catch(l){ve(e,s,l)}break;case 5:var o=e.return;try{lh(e)}catch(l){ve(e,o,l)}}}catch(l){ve(e,e.return,l)}if(e===t){B=null;break}var a=e.sibling;if(a!==null){a.return=e.return,B=a;break}B=e.return}}var HS=Math.ceil,jl=Pn.ReactCurrentDispatcher,Ud=Pn.ReactCurrentOwner,Tt=Pn.ReactCurrentBatchConfig,Q=0,Ie=null,xe=null,Ne=0,lt=0,mr=ui(0),be=0,po=null,Ri=0,Tc=0,Vd=0,Gs=null,et=null,jd=0,Br=1/0,un=null,Gl=!1,fh=null,Jn=null,va=!1,Wn=null,Wl=0,Ws=0,hh=null,sl=-1,ol=0;function Ze(){return Q&6?_e():sl!==-1?sl:sl=_e()}function ei(t){return t.mode&1?Q&2&&Ne!==0?Ne&-Ne:LS.transition!==null?(ol===0&&(ol=Yv()),ol):(t=ee,t!==0||(t=window.event,t=t===void 0?16:t_(t.type)),t):1}function Bt(t,e,n,i){if(50<Ws)throw Ws=0,hh=null,Error(O(185));Io(t,n,i),(!(Q&2)||t!==Ie)&&(t===Ie&&(!(Q&2)&&(Tc|=n),be===4&&Vn(t,Ne)),rt(t,i),n===1&&Q===0&&!(e.mode&1)&&(Br=_e()+500,_c&&fi()))}function rt(t,e){var n=t.callbackNode;LT(t,e);var i=Al(t,t===Ie?Ne:0);if(i===0)n!==null&&Tp(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&Tp(n),e===1)t.tag===0?AS(pm.bind(null,t)):w_(pm.bind(null,t)),TS(function(){!(Q&6)&&fi()}),n=null;else{switch(Zv(i)){case 1:n=gd;break;case 4:n=$v;break;case 16:n=Pl;break;case 536870912:n=Xv;break;default:n=Pl}n=_1(n,h1.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function h1(t,e){if(sl=-1,ol=0,Q&6)throw Error(O(327));var n=t.callbackNode;if(Cr()&&t.callbackNode!==n)return null;var i=Al(t,t===Ie?Ne:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Hl(t,i);else{e=i;var r=Q;Q|=2;var s=g1();(Ie!==t||Ne!==e)&&(un=null,Br=_e()+500,Pi(t,e));do try{YS();break}catch(a){d1(t,a)}while(1);Ad(),jl.current=s,Q=r,xe!==null?e=0:(Ie=null,Ne=0,e=be)}if(e!==0){if(e===2&&(r=Bf(t),r!==0&&(i=r,e=dh(t,r))),e===1)throw n=po,Pi(t,0),Vn(t,i),rt(t,_e()),n;if(e===6)Vn(t,i);else{if(r=t.current.alternate,!(i&30)&&!$S(r)&&(e=Hl(t,i),e===2&&(s=Bf(t),s!==0&&(i=s,e=dh(t,s))),e===1))throw n=po,Pi(t,0),Vn(t,i),rt(t,_e()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(O(345));case 2:wi(t,et,un);break;case 3:if(Vn(t,i),(i&130023424)===i&&(e=jd+500-_e(),10<e)){if(Al(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Ze(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Xf(wi.bind(null,t,et,un),e);break}wi(t,et,un);break;case 4:if(Vn(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-zt(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=_e()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*HS(i/1960))-i,10<i){t.timeoutHandle=Xf(wi.bind(null,t,et,un),i);break}wi(t,et,un);break;case 5:wi(t,et,un);break;default:throw Error(O(329))}}}return rt(t,_e()),t.callbackNode===n?h1.bind(null,t):null}function dh(t,e){var n=Gs;return t.current.memoizedState.isDehydrated&&(Pi(t,e).flags|=256),t=Hl(t,e),t!==2&&(e=et,et=n,e!==null&&gh(e)),t}function gh(t){et===null?et=t:et.push.apply(et,t)}function $S(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Vt(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Vn(t,e){for(e&=~Vd,e&=~Tc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-zt(e),i=1<<n;t[n]=-1,e&=~i}}function pm(t){if(Q&6)throw Error(O(327));Cr();var e=Al(t,0);if(!(e&1))return rt(t,_e()),null;var n=Hl(t,e);if(t.tag!==0&&n===2){var i=Bf(t);i!==0&&(e=i,n=dh(t,i))}if(n===1)throw n=po,Pi(t,0),Vn(t,e),rt(t,_e()),n;if(n===6)throw Error(O(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,wi(t,et,un),rt(t,_e()),null}function Gd(t,e){var n=Q;Q|=1;try{return t(e)}finally{Q=n,Q===0&&(Br=_e()+500,_c&&fi())}}function Oi(t){Wn!==null&&Wn.tag===0&&!(Q&6)&&Cr();var e=Q;Q|=1;var n=Tt.transition,i=ee;try{if(Tt.transition=null,ee=1,t)return t()}finally{ee=i,Tt.transition=n,Q=e,!(Q&6)&&fi()}}function Wd(){lt=mr.current,le(mr)}function Pi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,xS(n)),xe!==null)for(n=xe.return;n!==null;){var i=n;switch(Sd(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Rl();break;case 3:Dr(),le(nt),le(We),Od();break;case 5:Rd(i);break;case 4:Dr();break;case 13:le(he);break;case 19:le(he);break;case 10:Ld(i.type._context);break;case 22:case 23:Wd()}n=n.return}if(Ie=t,xe=t=ti(t.current,null),Ne=lt=e,be=0,po=null,Vd=Tc=Ri=0,et=Gs=null,Ti!==null){for(e=0;e<Ti.length;e++)if(n=Ti[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}Ti=null}return t}function d1(t,e){do{var n=xe;try{if(Ad(),nl.current=Vl,Ul){for(var i=pe.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Ul=!1}if(Mi=0,Le=Se=pe=null,Vs=!1,fo=0,Ud.current=null,n===null||n.return===null){be=1,po=e,xe=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Ne,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,f=u.tag;if(!(u.mode&1)&&(f===0||f===11||f===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var d=nm(o);if(d!==null){d.flags&=-257,im(d,o,a,s,e),d.mode&1&&tm(s,c,e),e=d,l=c;var p=e.updateQueue;if(p===null){var _=new Set;_.add(l),e.updateQueue=_}else p.add(l);break e}else{if(!(e&1)){tm(s,c,e),Hd();break e}l=Error(O(426))}}else if(ue&&a.mode&1){var x=nm(o);if(x!==null){!(x.flags&65536)&&(x.flags|=256),im(x,o,a,s,e),bd(zr(l,a));break e}}s=l=zr(l,a),be!==4&&(be=2),Gs===null?Gs=[s]:Gs.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=q_(s,l,e);Yp(s,y);break e;case 1:a=l;var m=s.type,w=s.stateNode;if(!(s.flags&128)&&(typeof m.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Jn===null||!Jn.has(w)))){s.flags|=65536,e&=-e,s.lanes|=e;var T=K_(s,a,e);Yp(s,T);break e}}s=s.return}while(s!==null)}m1(n)}catch(b){e=b,xe===n&&n!==null&&(xe=n=n.return);continue}break}while(1)}function g1(){var t=jl.current;return jl.current=Vl,t===null?Vl:t}function Hd(){(be===0||be===3||be===2)&&(be=4),Ie===null||!(Ri&268435455)&&!(Tc&268435455)||Vn(Ie,Ne)}function Hl(t,e){var n=Q;Q|=2;var i=g1();(Ie!==t||Ne!==e)&&(un=null,Pi(t,e));do try{XS();break}catch(r){d1(t,r)}while(1);if(Ad(),Q=n,jl.current=i,xe!==null)throw Error(O(261));return Ie=null,Ne=0,be}function XS(){for(;xe!==null;)p1(xe)}function YS(){for(;xe!==null&&!_T();)p1(xe)}function p1(t){var e=v1(t.alternate,t,lt);t.memoizedProps=t.pendingProps,e===null?m1(t):xe=e,Ud.current=null}function m1(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=VS(n,e),n!==null){n.flags&=32767,xe=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{be=6,xe=null;return}}else if(n=US(n,e,lt),n!==null){xe=n;return}if(e=e.sibling,e!==null){xe=e;return}xe=e=t}while(e!==null);be===0&&(be=5)}function wi(t,e,n){var i=ee,r=Tt.transition;try{Tt.transition=null,ee=1,ZS(t,e,n,i)}finally{Tt.transition=r,ee=i}return null}function ZS(t,e,n,i){do Cr();while(Wn!==null);if(Q&6)throw Error(O(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(O(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(CT(t,s),t===Ie&&(xe=Ie=null,Ne=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||va||(va=!0,_1(Pl,function(){return Cr(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Tt.transition,Tt.transition=null;var o=ee;ee=1;var a=Q;Q|=4,Ud.current=null,GS(t,n),u1(n,t),pS(Hf),Ll=!!Wf,Hf=Wf=null,t.current=n,WS(n),wT(),Q=a,ee=o,Tt.transition=s}else t.current=n;if(va&&(va=!1,Wn=t,Wl=r),s=t.pendingLanes,s===0&&(Jn=null),TT(n.stateNode),rt(t,_e()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Gl)throw Gl=!1,t=fh,fh=null,t;return Wl&1&&t.tag!==0&&Cr(),s=t.pendingLanes,s&1?t===hh?Ws++:(Ws=0,hh=t):Ws=0,fi(),null}function Cr(){if(Wn!==null){var t=Zv(Wl),e=Tt.transition,n=ee;try{if(Tt.transition=null,ee=16>t?16:t,Wn===null)var i=!1;else{if(t=Wn,Wn=null,Wl=0,Q&6)throw Error(O(331));var r=Q;for(Q|=4,B=t.current;B!==null;){var s=B,o=s.child;if(B.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(B=c;B!==null;){var u=B;switch(u.tag){case 0:case 11:case 15:js(8,u,s)}var f=u.child;if(f!==null)f.return=u,B=f;else for(;B!==null;){u=B;var h=u.sibling,d=u.return;if(a1(u),u===c){B=null;break}if(h!==null){h.return=d,B=h;break}B=d}}}var p=s.alternate;if(p!==null){var _=p.child;if(_!==null){p.child=null;do{var x=_.sibling;_.sibling=null,_=x}while(_!==null)}}B=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,B=o;else e:for(;B!==null;){if(s=B,s.flags&2048)switch(s.tag){case 0:case 11:case 15:js(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,B=y;break e}B=s.return}}var m=t.current;for(B=m;B!==null;){o=B;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,B=w;else e:for(o=m;B!==null;){if(a=B,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:xc(9,a)}}catch(b){ve(a,a.return,b)}if(a===o){B=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,B=T;break e}B=a.return}}if(Q=r,fi(),en&&typeof en.onPostCommitFiberRoot=="function")try{en.onPostCommitFiberRoot(gc,t)}catch{}i=!0}return i}finally{ee=n,Tt.transition=e}}return!1}function mm(t,e,n){e=zr(n,e),e=q_(t,e,1),t=Qn(t,e,1),e=Ze(),t!==null&&(Io(t,1,e),rt(t,e))}function ve(t,e,n){if(t.tag===3)mm(t,t,n);else for(;e!==null;){if(e.tag===3){mm(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Jn===null||!Jn.has(i))){t=zr(n,t),t=K_(e,t,1),e=Qn(e,t,1),t=Ze(),e!==null&&(Io(e,1,t),rt(e,t));break}}e=e.return}}function qS(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Ze(),t.pingedLanes|=t.suspendedLanes&n,Ie===t&&(Ne&n)===n&&(be===4||be===3&&(Ne&130023424)===Ne&&500>_e()-jd?Pi(t,0):Vd|=n),rt(t,e)}function y1(t,e){e===0&&(t.mode&1?(e=la,la<<=1,!(la&130023424)&&(la=4194304)):e=1);var n=Ze();t=wn(t,e),t!==null&&(Io(t,e,n),rt(t,n))}function KS(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),y1(t,n)}function QS(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(O(314))}i!==null&&i.delete(e),y1(t,n)}var v1;v1=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||nt.current)tt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return tt=!1,BS(t,e,n);tt=!!(t.flags&131072)}else tt=!1,ue&&e.flags&1048576&&E_(e,Nl,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;rl(t,e),t=e.pendingProps;var r=kr(e,We.current);Lr(e,n),r=Nd(null,e,i,t,r,n);var s=Fd();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,it(i)?(s=!0,Ol(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Id(e),r.updater=wc,e.stateNode=r,r._reactInternals=e,eh(e,i,t,n),e=ih(null,e,i,!0,s,n)):(e.tag=0,ue&&s&&Td(e),$e(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(rl(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=eb(i),t=Mt(i,t),r){case 0:e=nh(null,e,i,t,n);break e;case 1:e=om(null,e,i,t,n);break e;case 11:e=rm(null,e,i,t,n);break e;case 14:e=sm(null,e,i,Mt(i.type,t),n);break e}throw Error(O(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),nh(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),om(t,e,i,r,n);case 3:e:{if(t1(e),t===null)throw Error(O(387));i=e.pendingProps,s=e.memoizedState,r=s.element,b_(t,e),zl(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=zr(Error(O(423)),e),e=am(t,e,i,n,r);break e}else if(i!==r){r=zr(Error(O(424)),e),e=am(t,e,i,n,r);break e}else for(ut=Kn(e.stateNode.containerInfo.firstChild),ft=e,ue=!0,Ot=null,n=C_(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Nr(),i===r){e=En(t,e,n);break e}$e(t,e,i,n)}e=e.child}return e;case 5:return I_(e),t===null&&Kf(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,$f(i,r)?o=null:s!==null&&$f(i,s)&&(e.flags|=32),e1(t,e),$e(t,e,o,n),e.child;case 6:return t===null&&Kf(e),null;case 13:return n1(t,e,n);case 4:return Md(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Fr(e,null,i,n):$e(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),rm(t,e,i,r,n);case 7:return $e(t,e,e.pendingProps,n),e.child;case 8:return $e(t,e,e.pendingProps.children,n),e.child;case 12:return $e(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,re(Fl,i._currentValue),i._currentValue=o,s!==null)if(Vt(s.value,o)){if(s.children===r.children&&!nt.current){e=En(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=mn(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Qf(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(O(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Qf(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}$e(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Lr(e,n),r=bt(r),i=i(r),e.flags|=1,$e(t,e,i,n),e.child;case 14:return i=e.type,r=Mt(i,e.pendingProps),r=Mt(i.type,r),sm(t,e,i,r,n);case 15:return Q_(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),rl(t,e),e.tag=1,it(i)?(t=!0,Ol(e)):t=!1,Lr(e,n),A_(e,i,r),eh(e,i,r,n),ih(null,e,i,!0,t,n);case 19:return i1(t,e,n);case 22:return J_(t,e,n)}throw Error(O(156,e.tag))};function _1(t,e){return Hv(t,e)}function JS(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xt(t,e,n,i){return new JS(t,e,n,i)}function $d(t){return t=t.prototype,!(!t||!t.isReactComponent)}function eb(t){if(typeof t=="function")return $d(t)?1:0;if(t!=null){if(t=t.$$typeof,t===fd)return 11;if(t===hd)return 14}return 2}function ti(t,e){var n=t.alternate;return n===null?(n=xt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function al(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")$d(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case or:return Ai(n.children,r,s,e);case ud:o=8,r|=8;break;case Sf:return t=xt(12,n,e,r|2),t.elementType=Sf,t.lanes=s,t;case bf:return t=xt(13,n,e,r),t.elementType=bf,t.lanes=s,t;case Pf:return t=xt(19,n,e,r),t.elementType=Pf,t.lanes=s,t;case Lv:return Sc(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Pv:o=10;break e;case Av:o=9;break e;case fd:o=11;break e;case hd:o=14;break e;case zn:o=16,i=null;break e}throw Error(O(130,t==null?t:typeof t,""))}return e=xt(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Ai(t,e,n,i){return t=xt(7,t,i,e),t.lanes=n,t}function Sc(t,e,n,i){return t=xt(22,t,i,e),t.elementType=Lv,t.lanes=n,t.stateNode={isHidden:!1},t}function Pu(t,e,n){return t=xt(6,t,null,e),t.lanes=n,t}function Au(t,e,n){return e=xt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function tb(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=au(0),this.expirationTimes=au(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=au(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Xd(t,e,n,i,r,s,o,a,l){return t=new tb(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=xt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Id(s),t}function nb(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:sr,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function w1(t){if(!t)return si;t=t._reactInternals;e:{if(ji(t)!==t||t.tag!==1)throw Error(O(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(it(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(O(171))}if(t.tag===1){var n=t.type;if(it(n))return __(t,n,e)}return e}function E1(t,e,n,i,r,s,o,a,l){return t=Xd(n,i,!0,t,r,s,o,a,l),t.context=w1(null),n=t.current,i=Ze(),r=ei(n),s=mn(i,r),s.callback=e??null,Qn(n,s,r),t.current.lanes=r,Io(t,r,i),rt(t,i),t}function bc(t,e,n,i){var r=e.current,s=Ze(),o=ei(r);return n=w1(n),e.context===null?e.context=n:e.pendingContext=n,e=mn(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Qn(r,e,o),t!==null&&(Bt(t,r,o,s),tl(t,r,o)),o}function $l(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function ym(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Yd(t,e){ym(t,e),(t=t.alternate)&&ym(t,e)}function ib(){return null}var x1=typeof reportError=="function"?reportError:function(t){console.error(t)};function Zd(t){this._internalRoot=t}Pc.prototype.render=Zd.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(O(409));bc(t,e,null,null)};Pc.prototype.unmount=Zd.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Oi(function(){bc(null,t,null,null)}),e[_n]=null}};function Pc(t){this._internalRoot=t}Pc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Qv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Un.length&&e!==0&&e<Un[n].priority;n++);Un.splice(n,0,t),n===0&&e_(t)}};function qd(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Ac(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function vm(){}function rb(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=$l(o);s.call(c)}}var o=E1(e,i,t,0,null,!1,!1,"",vm);return t._reactRootContainer=o,t[_n]=o.current,oo(t.nodeType===8?t.parentNode:t),Oi(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var c=$l(l);a.call(c)}}var l=Xd(t,0,!1,null,null,!1,!1,"",vm);return t._reactRootContainer=l,t[_n]=l.current,oo(t.nodeType===8?t.parentNode:t),Oi(function(){bc(e,l,n,i)}),l}function Lc(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=$l(o);a.call(l)}}bc(e,o,t,r)}else o=rb(n,e,t,r,i);return $l(o)}qv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ms(e.pendingLanes);n!==0&&(pd(e,n|1),rt(e,_e()),!(Q&6)&&(Br=_e()+500,fi()))}break;case 13:Oi(function(){var i=wn(t,1);if(i!==null){var r=Ze();Bt(i,t,1,r)}}),Yd(t,1)}};md=function(t){if(t.tag===13){var e=wn(t,134217728);if(e!==null){var n=Ze();Bt(e,t,134217728,n)}Yd(t,134217728)}};Kv=function(t){if(t.tag===13){var e=ei(t),n=wn(t,e);if(n!==null){var i=Ze();Bt(n,t,e,i)}Yd(t,e)}};Qv=function(){return ee};Jv=function(t,e){var n=ee;try{return ee=t,e()}finally{ee=n}};Ff=function(t,e,n){switch(e){case"input":if(Cf(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=vc(i);if(!r)throw Error(O(90));Iv(i),Cf(i,r)}}}break;case"textarea":Rv(t,n);break;case"select":e=n.value,e!=null&&Sr(t,!!n.multiple,e,!1)}};Bv=Gd;Uv=Oi;var sb={usingClientEntryPoint:!1,Events:[Ro,ur,vc,Dv,zv,Gd]},_s={findFiberByHostInstance:xi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ob={bundleType:_s.bundleType,version:_s.version,rendererPackageName:_s.rendererPackageName,rendererConfig:_s.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Pn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Gv(t),t===null?null:t.stateNode},findFiberByHostInstance:_s.findFiberByHostInstance||ib,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _a=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_a.isDisabled&&_a.supportsFiber)try{gc=_a.inject(ob),en=_a}catch{}}pt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sb;pt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!qd(e))throw Error(O(200));return nb(t,e,null,n)};pt.createRoot=function(t,e){if(!qd(t))throw Error(O(299));var n=!1,i="",r=x1;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Xd(t,1,!1,null,null,n,!1,i,r),t[_n]=e.current,oo(t.nodeType===8?t.parentNode:t),new Zd(e)};pt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(O(188)):(t=Object.keys(t).join(","),Error(O(268,t)));return t=Gv(e),t=t===null?null:t.stateNode,t};pt.flushSync=function(t){return Oi(t)};pt.hydrate=function(t,e,n){if(!Ac(e))throw Error(O(200));return Lc(null,t,e,!0,n)};pt.hydrateRoot=function(t,e,n){if(!qd(t))throw Error(O(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=x1;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=E1(e,null,t,1,n??null,r,!1,s,o),t[_n]=e.current,oo(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Pc(e)};pt.render=function(t,e,n){if(!Ac(e))throw Error(O(200));return Lc(null,t,e,!1,n)};pt.unmountComponentAtNode=function(t){if(!Ac(t))throw Error(O(40));return t._reactRootContainer?(Oi(function(){Lc(null,null,t,!1,function(){t._reactRootContainer=null,t[_n]=null})}),!0):!1};pt.unstable_batchedUpdates=Gd;pt.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Ac(n))throw Error(O(200));if(t==null||t._reactInternals===void 0)throw Error(O(38));return Lc(t,e,n,!1,i)};pt.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}e(),t.exports=pt})(iT);var _m=Ks;Ef.createRoot=_m.createRoot,Ef.hydrateRoot=_m.hydrateRoot;function Xl(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Kd=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),wm=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);wm&&parseFloat(wm[1]);const ab="3.3.2";function xn(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const ll=typeof process!="object"||String(process)!=="[object process]"||process.browser,lb=typeof window<"u"&&typeof window.orientation<"u",Em=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Em&&parseFloat(Em[1]);function mo(t){return mo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mo(t)}function cb(t,e){if(mo(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(mo(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ub(t){var e=cb(t,"string");return mo(e)==="symbol"?e:String(e)}function g(t,e,n){return e=ub(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class fb{constructor(e,n){g(this,"name",void 0),g(this,"workerThread",void 0),g(this,"isRunning",!0),g(this,"result",void 0),g(this,"_resolve",()=>{}),g(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){xn(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){xn(this.isRunning),this.isRunning=!1,this._reject(e)}}let Lu=class{terminate(){}};const Cu=new Map;function hb(t){xn(t.source&&!t.url||!t.source&&t.url);let e=Cu.get(t.source||t.url);return e||(t.url&&(e=db(t.url),Cu.set(t.url,e)),t.source&&(e=T1(t.source),Cu.set(t.source,e))),xn(e),e}function db(t){if(!t.startsWith("http"))return t;const e=gb(t);return T1(e)}function T1(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function gb(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function S1(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(t){if(xm(t))i.add(t);else if(xm(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)S1(t[r],e,i)}}return n===void 0?Array.from(i):[]}function xm(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Iu=()=>{};class ph{static isSupported(){return typeof Worker<"u"&&ll||typeof Lu<"u"&&!ll}constructor(e){g(this,"name",void 0),g(this,"source",void 0),g(this,"url",void 0),g(this,"terminated",!1),g(this,"worker",void 0),g(this,"onMessage",void 0),g(this,"onError",void 0),g(this,"_loadableURL","");const{name:n,source:i,url:r}=e;xn(i||r),this.name=n,this.source=i,this.url=r,this.onMessage=Iu,this.onError=s=>console.log(s),this.worker=ll?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Iu,this.onError=Iu,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||S1(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=hb({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Lu(i,{eval:!1})}else if(this.source)e=new Lu(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class pb{static isSupported(){return ph.isSupported()}constructor(e){g(this,"name","unnamed"),g(this,"source",void 0),g(this,"url",void 0),g(this,"maxConcurrency",1),g(this,"maxMobileConcurrency",1),g(this,"onDebug",()=>{}),g(this,"reuseWorkers",!0),g(this,"props",{}),g(this,"jobQueue",[]),g(this,"idleQueue",[]),g(this,"count",0),g(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,o,a)=>s.done(a),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,o)=>s.error(o);const r=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:s}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new fb(n.name,e);e.onMessage=r=>n.onMessage(i,r.type,r.payload),e.onError=r=>n.onError(i,r),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new ph({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return lb?this.maxMobileConcurrency:this.maxConcurrency}}const mb={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class hn{static isSupported(){return ph.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return hn._workerFarm=hn._workerFarm||new hn({}),hn._workerFarm.setProps(e),hn._workerFarm}constructor(e){g(this,"props",void 0),g(this,"workerPools",new Map),this.props={...mb},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:r}=e;let s=this.workerPools.get(n);return s||(s=new pb({name:n,source:i,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}g(hn,"_workerFarm",void 0);const yb="latest";function vb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(r="modules/".concat(t.module,"/dist/").concat(i)),!r){let s=t.version;s==="latest"&&(s=yb);const o=s?"@".concat(s):"";r="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(i)}return xn(r),r}function _b(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ab;xn(t,"no worker provided");const n=t.version;return!(!e||!n)}function wb(t,e){return!hn.isSupported()||!ll&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function Eb(t,e,n,i,r){const s=t.id,o=vb(t,n),l=hn.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const c=await l.startJob("process-on-worker",xb.bind(null,r));return c.postMessage("process",{input:e,options:n,context:i}),await(await c.result).result}async function xb(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:s,options:o}=i;try{const a=await t(s,o);e.postMessage("done",{id:r,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:r,error:l})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function Tb(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}function Sb(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),r=i.reduce((a,l)=>a+l.byteLength,0),s=new Uint8Array(r);let o=0;for(const a of i)s.set(a,o),o+=a.byteLength;return s.buffer}async function bb(t){const e=[];for await(const n of t)e.push(n);return Sb(...e)}function Tm(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Sm{constructor(e,n){g(this,"name",void 0),g(this,"type",void 0),g(this,"sampleSize",1),g(this,"time",void 0),g(this,"count",void 0),g(this,"samples",void 0),g(this,"lastTiming",void 0),g(this,"lastSampleTime",void 0),g(this,"lastSampleCount",void 0),g(this,"_count",0),g(this,"_time",0),g(this,"_samples",0),g(this,"_startTime",0),g(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Tm(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Tm()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Cc{constructor(e){g(this,"id",void 0),g(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof Sm?this.stats[n]=e:this.stats[n]=new Sm(n,i)),this.stats[n]}}const Pb="Queued Requests",Ab="Active Requests",Lb="Cancelled Requests",Cb="Queued Requests Ever",Ib="Active Requests Ever",Mb={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Rb{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};g(this,"props",void 0),g(this,"stats",void 0),g(this,"activeRequestCount",0),g(this,"requestQueue",[]),g(this,"requestMap",new Map),g(this,"deferredUpdate",null),this.props={...Mb,...e},this.stats=new Cc({id:this.props.id}),this.stats.get(Pb),this.stats.get(Ab),this.stats.get(Lb),this.stats.get(Cb),this.stats.get(Ib)}scheduleRequest(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:n},r=new Promise(s=>(i.resolve=s,i));return this.requestQueue.push(i),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){const{handle:n,resolve:i}=e;let r=!1;const s=()=>{r||(r=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const i=e[n];this._updateRequest(i)||(e.splice(n,1),this.requestMap.delete(i.handle),n--)}e.sort((n,i)=>n.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let Ob="";const bm={};function kb(t){for(const e in bm)if(t.startsWith(e)){const n=bm[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(Ob).concat(t)),t}function Nb(t){return t&&typeof t=="object"&&t.isBuffer}function b1(t){if(Nb(t))return(void 0)(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function Fb(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}const Db=t=>typeof t=="boolean",Hs=t=>typeof t=="function",ko=t=>t!==null&&typeof t=="object",Pm=t=>ko(t)&&t.constructor==={}.constructor,zb=t=>t&&typeof t[Symbol.iterator]=="function",Bb=t=>t&&typeof t[Symbol.asyncIterator]=="function",es=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,ts=t=>typeof Blob<"u"&&t instanceof Blob,Ub=t=>t&&typeof t=="object"&&t.isBuffer,Vb=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||ko(t)&&Hs(t.tee)&&Hs(t.cancel)&&Hs(t.getReader),jb=t=>ko(t)&&Hs(t.read)&&Hs(t.pipe)&&Db(t.readable),P1=t=>Vb(t)||jb(t),Gb=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Wb=/^([-\w.]+\/[-\w.+]+)/;function Hb(t){const e=Wb.exec(t);return e?e[1]:t}function Am(t){const e=Gb.exec(t);return e?e[1]:""}const $b=/\?.*/;function Ic(t){if(es(t)){const e=Mu(t.url||""),n=t.headers.get("content-type")||"";return{url:e,type:Hb(n)||Am(e)}}return ts(t)?{url:Mu(t.name||""),type:t.type||""}:typeof t=="string"?{url:Mu(t),type:Am(t)}:{url:"",type:""}}function Xb(t){return es(t)?t.headers["content-length"]||-1:ts(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function Mu(t){return t.replace($b,"")}async function A1(t){if(es(t))return t;const e={},n=Xb(t);n>=0&&(e["content-length"]=String(n));const{url:i,type:r}=Ic(t);r&&(e["content-type"]=r);const s=await qb(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function Yb(t){if(!t.ok){const e=await Zb(t);throw new Error(e)}}async function Zb(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function qb(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=s=>{var o;return i(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=Kb(n);return"data:base64,".concat(i)}return null}function Kb(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function Lm(t,e){if(typeof t=="string"){t=kb(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await A1(t)}function L1(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function An(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||L1()}const cl={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},wa=cl.window||cl.self||cl.global,ws=cl.process||{},C1=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";An();const Ru=globalThis;function I1(t){if(!t&&!An())return"Node";if(L1(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r?"IE":Ru.chrome?"Chrome":Ru.safari?"Safari":Ru.mozInnerScreenX?"Firefox":"Unknown"}function Qb(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class Jb{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";g(this,"storage",void 0),g(this,"id",void 0),g(this,"config",void 0),this.storage=Qb(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function eP(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function tP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Ou(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let Yl;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Yl||(Yl={}));function Cm(t){return typeof t=="string"?Yl[t.toUpperCase()]||Yl.WHITE:t}function nP(t,e,n){return!An&&typeof t=="string"&&(e&&(e=Cm(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=Cm(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function iP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const r of i)typeof t[r]=="function"&&(e.find(s=>r===s)||(t[r]=t[r].bind(t)))}function Zl(t,e){if(!t)throw new Error(e||"Assertion failed")}function qi(){let t;if(An&&"performance"in wa){var e,n;t=wa==null||(e=wa.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in ws){var i;const r=ws==null||(i=ws.hrtime)===null||i===void 0?void 0:i.call(ws);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const Ki={debug:An&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},rP={enabled:!0,level:0};function _t(){}const Im={},Mm={once:!0};class No{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};g(this,"id",void 0),g(this,"VERSION",C1),g(this,"_startTs",qi()),g(this,"_deltaTs",qi()),g(this,"_storage",void 0),g(this,"userData",{}),g(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new Jb("__probe-".concat(this.id,"__"),rP),this.timeStamp("".concat(this.id," started")),iP(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((qi()-this._startTs).toPrecision(10))}getDelta(){return Number((qi()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Zl(e,n)}warn(e){return this._getLogFunction(0,e,Ki.warn,arguments,Mm)}error(e){return this._getLogFunction(0,e,Ki.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Ki.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Ki.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,r=new Array(i>2?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];return this._getLogFunction(e,n,Ki.debug||Ki.info,arguments,Mm)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||_t,i&&[i],{tag:lP(n)}):_t}image(e){let{logLevel:n,priority:i,image:r,message:s="",scale:o=1}=e;return this._shouldLog(n||i)?An?aP({image:r,message:s,scale:o}):oP():_t}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||_t)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=Rm({logLevel:e,message:n,opts:i}),{collapsed:s}=i;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||_t)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=M1(e)}_getLogFunction(e,n,i,r,s){if(this._shouldLog(e)){s=Rm({logLevel:e,message:n,args:r,opts:s}),i=i||s.method,Zl(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=qi();const o=s.tag||s.message;if(s.once)if(!Im[o])Im[o]=qi();else return _t;return n=sP(this.id,s.message,s),i.bind(console,n,...s.args)}return _t}}g(No,"VERSION",C1);function M1(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Zl(Number.isFinite(e)&&e>=0),e}function Rm(t){const{logLevel:e,message:n}=t;t.logLevel=M1(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return Zl(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function sP(t,e,n){if(typeof e=="string"){const i=n.time?tP(eP(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=nP(e,n.color,n.background)}return e}function oP(t){return console.warn("removed"),_t}function aP(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=Ou(s,n,i);console.log(...o)},s.src=e,_t}const r=e.nodeName||"";if(r.toLowerCase()==="img")return console.log(...Ou(e,n,i)),_t;if(r.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Ou(s,n,i)),s.src=e.toDataURL(),_t}return _t}function lP(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const Om=new No({id:"loaders.gl"});class cP{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class uP{constructor(){g(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.error.bind(this.console,...n)}}const R1={fetch:null,mimeType:void 0,nothrow:!1,log:new uP,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Kd,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},fP={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function O1(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const k1=()=>{const t=O1();return t.globalOptions=t.globalOptions||{...R1},t.globalOptions};function hP(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],dP(t,n),pP(e,t,i)}function N1(t,e){const n=k1(),i=t||n;return typeof i.fetch=="function"?i.fetch:ko(i.fetch)?r=>Lm(r,i):e!=null&&e.fetch?e==null?void 0:e.fetch:Lm}function dP(t,e){km(t,null,R1,fP,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};km(i,n.id,r,s,e)}}function km(t,e,n,i,r){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const l=!e&&ko(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in i)Om.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!l){const f=gP(a,r);Om.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(f))()}}}}function gP(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const s in r.options){if(t===s)return"Did you mean '".concat(r.id,".").concat(s,"'?");const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(s,"'?"))}return i}function pP(t,e,n){const r={...t.options||{}};return mP(r,n),r.log===null&&(r.log=new cP),Nm(r,k1()),Nm(r,e),r}function Nm(t,e){for(const n in e)if(n in e){const i=e[n];Pm(i)&&Pm(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function mP(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Qd(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Jd(t){var e,n;Xl(t,"null loader"),Xl(Qd(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const F1=()=>{const t=O1();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function yP(t){const e=F1();t=Array.isArray(t)?t:[t];for(const n of t){const i=Jd(n);e.find(r=>i===r)||e.unshift(i)}}function vP(){return F1()}const _P=new No({id:"loaders.gl"}),wP=/\.([^.]+)$/;async function EP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!D1(t))return null;let r=Fm(t,e,{...n,nothrow:!0},i);if(r)return r;if(ts(t)&&(t=await t.slice(0,10).arrayBuffer(),r=Fm(t,e,n,i)),!r&&!(n!=null&&n.nothrow))throw new Error(z1(t));return r}function Fm(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!D1(t))return null;if(e&&!Array.isArray(e))return Jd(e);let r=[];e&&(r=r.concat(e)),n!=null&&n.ignoreRegisteredLoaders||r.push(...vP()),TP(r);const s=xP(t,r,n,i);if(!s&&!(n!=null&&n.nothrow))throw new Error(z1(t));return s}function xP(t,e,n,i){const{url:r,type:s}=Ic(t),o=r||(i==null?void 0:i.url);let a=null,l="";if(n!=null&&n.mimeType&&(a=ku(e,n==null?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),a=a||SP(e,o),l=l||(a?"matched url ".concat(o):""),a=a||ku(e,s),l=l||(a?"matched MIME type ".concat(s):""),a=a||PP(e,t),l=l||(a?"matched initial data ".concat(B1(t)):""),a=a||ku(e,n==null?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(s):""),l){var c;_P.log(1,"selectLoader selected ".concat((c=a)===null||c===void 0?void 0:c.name,": ").concat(l,"."))}return a}function D1(t){return!(t instanceof Response&&t.status===204)}function z1(t){const{url:e,type:n}=Ic(t);let i="No valid loader found (";i+=e?"".concat(Fb(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=t?B1(t):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function TP(t){for(const e of t)Jd(e)}function SP(t,e){const n=e&&wP.exec(e),i=n&&n[1];return i?bP(t,i):null}function bP(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function ku(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function PP(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(AP(e,n))return n}else if(ArrayBuffer.isView(e)){if(Dm(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Dm(e,0,n))return n;return null}function AP(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function Dm(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>LP(t,e,n,r))}function LP(t,e,n,i){if(i instanceof ArrayBuffer)return Tb(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const r=mh(t,e,i.length);return i===r;default:return!1}}function B1(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?mh(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?mh(t,0,e):""}function mh(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}const CP=256*1024;function*IP(t,e){const n=(e==null?void 0:e.chunkSize)||CP;let i=0;const r=new TextEncoder;for(;i<t.length;){const s=Math.min(t.length-i,n),o=t.slice(i,i+s);i+=s,yield r.encode(o)}}const MP=256*1024;function*RP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{chunkSize:n=MP}=e;let i=0;for(;i<t.byteLength;){const r=Math.min(t.byteLength-i,n),s=new ArrayBuffer(r),o=new Uint8Array(t,i,r);new Uint8Array(s).set(o),i+=r,yield s}}const OP=1024*1024;async function*kP(t,e){const n=(e==null?void 0:e.chunkSize)||OP;let i=0;for(;i<t.size;){const r=i+n,s=await t.slice(i,r).arrayBuffer();i=r,yield s}}function zm(t,e){return Kd?NP(t,e):FP(t)}async function*NP(t,e){const n=t.getReader();let i;try{for(;;){const r=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:s,value:o}=await r;if(s)return;yield b1(o)}}catch{n.releaseLock()}}async function*FP(t,e){for await(const n of t)yield b1(n)}function DP(t,e){if(typeof t=="string")return IP(t,e);if(t instanceof ArrayBuffer)return RP(t,e);if(ts(t))return kP(t,e);if(P1(t))return zm(t,e);if(es(t))return zm(t.body,e);throw new Error("makeIterator")}const U1="Cannot convert supplied data type";function zP(t,e,n){if(e.text&&typeof t=="string")return t;if(Ub(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error(U1)}async function BP(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return zP(t,e);if(ts(t)&&(t=await A1(t)),es(t)){const r=t;return await Yb(r),e.binary?await r.arrayBuffer():await r.text()}if(P1(t)&&(t=DP(t,n)),zb(t)||Bb(t))return bb(t);throw new Error(U1)}function UP(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(n)return n;const i={fetch:N1(e,t),...t};return Array.isArray(i.loaders)||(i.loaders=null),i}function VP(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function eg(t,e,n,i){xn(!i||typeof i=="object"),e&&!Array.isArray(e)&&!Qd(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:r}=Ic(t),o=VP(e,i),a=await EP(t,o,n);return a?(n=hP(n,a,o,r),i=UP({url:r,parse:eg,loaders:o},n,i),await jP(a,t,n,i)):null}async function jP(t,e,n,i){if(_b(t),es(e)){const r=e,{ok:s,redirected:o,status:a,statusText:l,type:c,url:u}=r,f=Object.fromEntries(r.headers.entries());i.response={headers:f,ok:s,redirected:o,status:a,statusText:l,type:c,url:u}}if(e=await BP(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(wb(t,n))return await Eb(t,e,n,i,eg);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw xn(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function ql(t,e,n,i){!Array.isArray(e)&&!Qd(e)&&(n=e,e=void 0);const r=N1(n);let s=t;return typeof t=="string"&&(s=await r(t)),ts(t)&&(s=await r(t)),await eg(s,e,n)}const GP="3.3.2",{_parseImageNode:WP}=globalThis,yh=typeof Image<"u",vh=typeof ImageBitmap<"u",HP=!!WP,_h=Kd?!0:HP;function $P(t){switch(t){case"auto":return vh||yh||_h;case"imagebitmap":return vh;case"image":return yh;case"data":return _h;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function XP(){if(vh)return"imagebitmap";if(yh)return"image";if(_h)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function YP(t){const e=qP(t);if(!e)throw new Error("Not an image");return e}function ZP(t){switch(YP(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function qP(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const KP=/^data:image\/svg\+xml/,QP=/\.svg((\?|#).*)?$/;function tg(t){return t&&(KP.test(t)||QP.test(t))}function JP(t,e){if(tg(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return V1(t,e)}function V1(t,e){if(tg(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function j1(t,e,n){const i=JP(t,n),r=self.URL||self.webkitURL,s=typeof i!="string"&&r.createObjectURL(i);try{return await eA(s||i,e)}finally{s&&r.revokeObjectURL(s)}}async function eA(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,r)=>{try{n.onload=()=>i(n),n.onerror=s=>r(new Error("Could not load image ".concat(t,": ").concat(s)))}catch(s){r(s)}})}const tA={};let Bm=!0;async function nA(t,e,n){let i;tg(n)?i=await j1(t,e,n):i=V1(t,n);const r=e&&e.imagebitmap;return await iA(i,r)}async function iA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((rA(e)||!Bm)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),Bm=!1}return await createImageBitmap(t)}function rA(t){for(const e in t||tA)return!1;return!0}const Jt=!1,$s=!0;function G1(t){const e=Fo(t);return sA(e)||lA(e)||oA(e)||aA(e)}function sA(t){const e=Fo(t);return e.byteLength>=24&&e.getUint32(0,Jt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Jt),height:e.getUint32(20,Jt)}:null}function oA(t){const e=Fo(t);return e.byteLength>=10&&e.getUint32(0,Jt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,$s),height:e.getUint16(8,$s)}:null}function aA(t){const e=Fo(t);return e.byteLength>=14&&e.getUint16(0,Jt)===16973&&e.getUint32(2,$s)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,$s),height:e.getUint32(22,$s)}:null}function lA(t){const e=Fo(t);if(!(e.byteLength>=3&&e.getUint16(0,Jt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=cA();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Jt);if(r.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Jt),width:e.getUint16(s+7,Jt)};if(!i.has(o))return null;s+=2,s+=e.getUint16(s,Jt)}return null}function cA(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Fo(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function uA(t,e){const{mimeType:n}=G1(t)||{},i=globalThis._parseImageNode;return Xl(i),await i(t,n)}async function fA(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:s}=n||{},o=hA(r);let a;switch(o){case"imagebitmap":a=await nA(t,e,s);break;case"image":a=await j1(t,e,s);break;case"data":a=await uA(t);break;default:Xl(!1)}return r==="data"&&(a=ZP(a)),a}function hA(t){switch(t){case"auto":case"data":return XP();default:return $P(t),t}}const dA=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],gA=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],pA={image:{type:"auto",decode:!0}},mA={id:"image",module:"images",name:"Images",version:GP,mimeTypes:gA,extensions:dA,parse:fA,tests:[t=>!!G1(new DataView(t))],options:pA},$=new No({id:"deck"});let wh={};function yA(t){wh=t}function Ue(t,e,n,i){$.level>0&&wh[t]&&wh[t].call(null,e,n,i)}function vA(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const _A={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:vA,parseTextSync:JSON.parse};function wA(){const t="8.9.7",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||($.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:$,_registerLoggers:yA},yP([_A,[mA,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const EA=wA(),K={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(K,"IDENTITY",{get:()=>($.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const kt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ki={common:0,meters:1,pixels:2},Um={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},U=new No({id:"luma.gl"});function Xe(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const xA="Invalid WebGLRenderingContext",TA="Requires WebGL2";function Mc(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function Y(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function SA(t){return Y(t)?t:null}function Rc(t){return Xe(Mc(t),xA),t}function Ge(t){return Xe(Y(t),TA),t}const Os={};function bA(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function PA(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function AA(t,e){Os[t]=!0,e!==void 0&&bA(e)}function LA(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(Os[i]=!0);while(i!==0);for(i in Os)if(Os[i])return delete Os[i],parseInt(i,10);return 0}}const Do=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const r=new t.VertexAttrib(n);this.attribs[i]=r}this.maxAttrib=0};Do.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Do.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Gi=function(e){const n=this;this.gl=e,LA(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(s){return s===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(s,o){switch(s){case 34962:n.currentArrayBuffer=o;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=o;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(s,o){const l=n.currentVertexArrayObject.attribs[s];switch(o){case 34975:return l.buffer;case 34338:return l.enabled;case 34339:return l.size;case 34340:return l.stride;case 34341:return l.type;case 34922:return l.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(s,o,a,l,c,u){const f=n.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,s);const h=f.attribs[s];return h.buffer=n.currentArrayBuffer,h.size=o,h.type=a,h.normalized=l,h.stride=c,h.offset=u,h.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{PA("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Gi.prototype.VERTEX_ARRAY_BINDING_OES=34229;Gi.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new Do(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Gi.prototype.createVertexArrayOES=function(){const e=new Do(this);return this.vertexArrayObjects.push(e),e};Gi.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Gi.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Do&&e.hasBeenBound&&e.ext===this)};Gi.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){AA(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(r===s)return;(!r||s.elementArrayBuffer!==r.elementArrayBuffer)&&i.bindBuffer.call(n,34963,s.elementArrayBuffer);let o=this.currentArrayBuffer;const a=Math.max(r?r.maxAttrib:0,s.maxAttrib);for(let l=0;l<=a;l++){const c=s.attribs[l],u=r?r.attribs[l]:null;if((!r||c.enabled!==u.enabled)&&(c.enabled?i.enableVertexAttribArray.call(n,l):i.disableVertexAttribArray.call(n,l)),c.enabled){let f=!1;(!r||c.buffer!==u.buffer)&&(o!==c.buffer&&(i.bindBuffer.call(n,34962,c.buffer),o=c.buffer),f=!0),(f||c.cached!==u.cached)&&i.vertexAttribPointer.call(n,l,c.size,c.type,c.normalized,c.stride,c.offset)}}this.currentArrayBuffer!==o&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function CA(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const r=e.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const n=t.getExtension;t.getExtension=function(r){const s=n.call(this,r);return s||(r!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Gi(this)),this.__OESVertexArrayObject))}}const Vm="OES_element_index",jm="WEBGL_draw_buffers",IA="EXT_disjoint_timer_query",MA="EXT_disjoint_timer_query_webgl2",RA="EXT_texture_filter_anisotropic",Gm="WEBGL_debug_renderer_info",OA=35723,kA=4352,NA=36795,FA=34047,DA=37445,zA=37446,ie=t=>Y(t)?void 0:0,BA={[3074]:t=>Y(t)?void 0:36064,[OA]:t=>Y(t)?void 0:kA,[35977]:ie,[32937]:ie,[NA]:(t,e)=>{const n=Y(t)?t.getExtension(MA):t.getExtension(IA);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[DA]:(t,e)=>{const n=t.getExtension(Gm);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[zA]:(t,e)=>{const n=t.getExtension(Gm);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[FA]:(t,e)=>{const n=t.luma.extensions[RA];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:ie,[35071]:ie,[37447]:ie,[36063]:(t,e)=>{if(!Y(t)){const n=t.getExtension(jm);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:ie,[35374]:ie,[35377]:ie,[34852]:t=>{if(!Y(t)){const e=t.getExtension(jm);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(Vm)?2147483647:65535,[33001]:t=>t.getExtension(Vm)?16777216:65535,[33e3]:t=>16777216,[37157]:ie,[35373]:ie,[35657]:ie,[36183]:ie,[37137]:ie,[34045]:ie,[35978]:ie,[35979]:ie,[35968]:ie,[35376]:ie,[35375]:ie,[35659]:ie,[37154]:ie,[35371]:ie,[35658]:ie,[35076]:ie,[35077]:ie,[35380]:ie};function UA(t,e,n){const i=BA[n],r=typeof i=="function"?i(t,e,n):i;return r!==void 0?r:e(n)}const VA="OES_vertex_array_object",W1="ANGLE_instanced_arrays",jA="WEBGL_draw_buffers",GA="EXT_disjoint_timer_query",WA="EXT_texture_filter_anisotropic",HA="VertexArray requires WebGL2 or OES_vertex_array_object extension";function $A(t,e){return{webgl2:Y(t),ext:t.getExtension(e)}}const H1={[VA]:{meta:{suffix:"OES"},createVertexArray:()=>{Xe(!1,HA)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[W1]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Xe(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[jA]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Xe(!1)}},[GA]:{meta:{suffix:"EXT"},createQuery:()=>{Xe(!1)},deleteQuery:()=>{Xe(!1)},beginQuery:()=>{Xe(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},Nu={readBuffer:(t,e,n)=>{Y(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:r,ext:s}=$A(t,W1);let o;switch(i){case 35069:o=r?void 0:!1;break;case 35070:o=!r&&!s?0:void 0;break}return o!==void 0?o:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Y(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,r)=>{if(!Y(t))switch(r){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,r)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:r}=t.luma,s=r[WA];i=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:UA,hint(t,e,n,i){return e(n,i)}};function XA(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(CA(t),YA(t),qA(t,H1),ZA(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=XA;function YA(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function ZA(t,e){let{target:n,target2:i}=e;Object.keys(Nu).forEach(r=>{if(typeof Nu[r]=="function"){const s=t[r]?t[r].bind(t):()=>{},o=Nu[r].bind(null,t,s);n[r]=o,i[r]=o}})}function qA(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&KA(t,{extension:n,target:t.luma,target2:t})}function KA(t,e){let{extension:n,target:i,target2:r}=e;const s=H1[n];Xe(s);const{meta:o={}}=s,{suffix:a=""}=o,l=t.getExtension(n);for(const c of Object.keys(s)){const u="".concat(c).concat(a);let f=null;c==="meta"||typeof t[c]=="function"||(l&&typeof l[u]=="function"?f=function(){return l[u](...arguments)}:typeof s[c]=="function"&&(f=s[c].bind(i))),f&&(i[c]=f,r[c]=f)}}const ng={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},Rn=(t,e,n)=>e?t.enable(n):t.disable(n),Wm=(t,e,n)=>t.hint(n,e),st=(t,e,n)=>t.pixelStorei(n,e),QA=(t,e)=>{const n=Y(t)?36009:36160;return t.bindFramebuffer(n,e)},JA=(t,e)=>t.bindFramebuffer(36008,e);function Es(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const e2={[3042]:Rn,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:Rn,[2885]:(t,e)=>t.cullFace(e),[2929]:Rn,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:Rn,[35723]:Wm,[36006]:QA,[2886]:(t,e)=>t.frontFace(e),[33170]:Wm,[2849]:(t,e)=>t.lineWidth(e),[32823]:Rn,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:Rn,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:Rn,[3088]:(t,e)=>t.scissor(...e),[2960]:Rn,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:st,[3317]:st,[37440]:st,[37441]:st,[37443]:st,[3330]:st,[3332]:st,[3331]:st,[36010]:JA,[3314]:st,[32878]:st,[3316]:st,[3315]:st,[32877]:st,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=Es(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=Es(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Es(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=Es(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=Es(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function ye(t,e,n){return e[t]!==void 0?e[t]:n[t]}const t2={blendEquation:(t,e,n)=>t.blendEquationSeparate(ye(32777,e,n),ye(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(ye(32969,e,n),ye(32968,e,n),ye(32971,e,n),ye(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(ye(32824,e,n),ye(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(ye(32938,e,n),ye(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,ye(2962,e,n),ye(2967,e,n),ye(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,ye(34816,e,n),ye(36003,e,n),ye(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,ye(2964,e,n),ye(2965,e,n),ye(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,ye(34817,e,n),ye(34818,e,n),ye(34819,e,n))},Hm={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({[36006]:n,[36010]:n});case 36009:return t({[36006]:n});case 36008:return t({[36010]:n});default:return null}},blendColor:(t,e,n,i,r)=>t({[32773]:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,n)=>t({[32777]:e,[34877]:n}),blendFunc:(t,e,n)=>t({[32969]:e,[32968]:n,[32971]:e,[32970]:n}),blendFuncSeparate:(t,e,n,i,r)=>t({[32969]:e,[32968]:n,[32971]:i,[32970]:r}),clearColor:(t,e,n,i,r)=>t({[3106]:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,n,i,r)=>t({[3107]:[e,n,i,r]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,n)=>t({[2928]:new Float32Array([e,n])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,n)=>t({[32824]:e,[10752]:n}),sampleCoverage:(t,e,n)=>t({[32938]:e,[32939]:n}),scissor:(t,e,n,i,r)=>t({[3088]:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({[2962]:e,[2967]:n,[2963]:i,[34816]:e,[36003]:n,[36004]:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({[2964]:e,[2965]:n,[2966]:i,[34817]:e,[34818]:n,[34819]:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({[2978]:[e,n,i,r]})},Xt=(t,e)=>t.isEnabled(e),$m={[3042]:Xt,[2884]:Xt,[2929]:Xt,[3024]:Xt,[32823]:Xt,[32926]:Xt,[32928]:Xt,[3089]:Xt,[2960]:Xt,[35977]:Xt};function $1(t){for(const e in t)return!1;return!0}function n2(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}function Xm(t,e){const n=t[e].bind(t);t[e]=function(){const r=arguments.length<=0?void 0:arguments[0];return r in t.state.cache?t.state.enable?t.state.cache[r]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function i2(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];const{valueChanged:l,oldValue:c}=n(t.state._updateCache,...o);return l&&i(...o),c},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function r2(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class s2{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?a2(e):Object.assign({},ng),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Xe(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Tn(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in e){Xe(s!==void 0);const o=e[s],a=this.cache[s];n2(o,a)||(n=!0,i=a,r&&!(s in r)&&(r[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:i}}}function X1(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(Xe(i!==void 0),!t.state){const{polyfillContext:r}=globalThis;r&&r(t),t.state=new s2(t,{copyState:i}),r2(t);for(const s in Hm){const o=Hm[s];i2(t,s,o)}Xm(t,"getParameter"),Xm(t,"isEnabled")}return t.state.enable=n,t}function o2(t){t.state||X1(t,{copyState:!1}),t.state.push()}function Ym(t){Xe(t.state),t.state.pop()}function Tn(t,e){if(Xe(Mc(t),"setParameters requires a WebGL context"),$1(e))return;const n={};for(const r in e){const s=Number(r),o=e2[r];o&&(typeof o=="string"?n[o]=!0:o(t,e[r],s))}const i=t.state&&t.state.cache;if(i)for(const r in n){const s=t2[r];s(t,e,i)}}function a2(t,e){if(e=e||ng,typeof e=="number"){const r=e,s=$m[r];return s?s(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const s=$m[r];i[r]=s?s(t,Number(r)):t.getParameter(Number(r))}return i}function l2(t){Tn(t,ng)}function Ut(t,e,n){if($1(e))return n(t);const{nocatch:i=!0}=e;o2(t),Tn(t,e);let r;if(i)r=n(t),Ym(t);else try{r=n(t)}finally{Ym(t)}return r}function Ur(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function Fu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=Ur(t),r=t.drawingBufferWidth,s=t.drawingBufferHeight;return u2(e,i,r,s,n)}function c2(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function u2(t,e,n,i,r){const s=Zm(t[0],e,n);let o=qm(t[1],e,i,r),a=Zm(t[0]+1,e,n);const l=a===n-1?a:a-1;a=qm(t[1]+1,e,i,r);let c;return r?(a=a===0?a:a+1,c=o,o=a):c=a===i-1?a:a-1,{x:s,y:o,width:Math.max(l-s+1,1),height:Math.max(c-o+1,1)}}function Zm(t,e,n){return Math.min(Math.round(t*e),n-1)}function qm(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const ig=An(),f2=ig&&typeof document<"u",Y1={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function Z1(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Xe(ig,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},Y1,t);const{width:e,height:n}=t;function i(a){if(t.throwOnError)throw new Error(a);return console.error(a),null}t.onError=i;let r;const{canvas:s}=t,o=p2({canvas:s,width:e,height:n,onError:i});return r=g2(o,t),r?(r=rg(r,t),m2(r),r):null}function rg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||y2(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},Y1,e);const{manageState:n,debug:i}=e;return n&&X1(t,{copyState:!1,log:function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return U.log(1,...s)()}}),ig&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),U.level=Math.max(U.level,1)):U.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function h2(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),r=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),s=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||e,renderer:s||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function d2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=c2(e.useDevicePixels);v2(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function g2(t,e){const{onError:n}=e;let i=null;const r=l=>i=l.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:s=!0,webgl2:o=!0}=e;let a=null;return o&&(a=a||t.getContext("webgl2",e),a=a||t.getContext("experimental-webgl2",e)),s&&(a=a||t.getContext("webgl",e),a=a||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",r,!1),a?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),a):n("Failed to create ".concat(o&&!s?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function p2(t){let{canvas:e,width:n=800,height:i=600,onError:r}=t,s;return typeof e=="string"?(f2&&document.readyState==="complete"||r("createGLContext called on canvas '".concat(e,"' before page was loaded")),s=document.getElementById(e)):e?s=e:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",s.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function m2(t){const e=Y(t)?"WebGL2":"WebGL1",n=h2(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",r=t.debug?" debug":"";U.info(1,"".concat(e).concat(r," context ").concat(i))()}function y2(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function v2(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,r="height"in n?n.height:t.canvas.clientHeight;(!i||!r)&&(U.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,r=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==e){let o=e;const a=Math.floor(i*o),l=Math.floor(r*o);t.canvas.width=a,t.canvas.height=l,(t.drawingBufferWidth!==a||t.drawingBufferHeight!==l)&&(U.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/r),t.canvas.width=Math.floor(i*o),t.canvas.height=Math.floor(r*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:e})}}const Xs="8.5.19",_2="set luma.log.level=1 (or higher) to trace rendering";class w2{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Cc({id:e})),this.stats.get(e)}}const bi=new w2;if(globalThis.luma&&globalThis.luma.VERSION!==Xs)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Xs));globalThis.luma||(An()&&U.log(1,"luma.gl ".concat(Xs," - ").concat(_2))(),globalThis.luma=globalThis.luma||{VERSION:Xs,version:Xs,log:U,stats:bi,globals:{modules:{},nodeIO:{}}});function E2(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function x2(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function k(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function Du(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return k(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function ni(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const zu={};function oi(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";zu[t]=zu[t]||1;const e=zu[t]++;return"".concat(t,"-").concat(e)}function Km(t){return k(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Vr(t){let e=!0;for(const n in t){e=!1;break}return e}function q1(t,e,n,i){const r="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(t);i.forEach(o=>{s.methodName||(s[o]=()=>{throw U.removed("Calling removed method ".concat(e,".").concat(o,": "),r)(),new Error(o)})})}const Qi="Resource subclass must define virtual methods";let Ln=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Rc(e);const{id:i,userData:r={}}=n;this.gl=e,this.gl2=e,this.id=i||oi(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Du(this.gl,e),k(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=Y(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const a=r.webgl1,l="webgl2"in r?r.webgl2:r.webgl1;return s?l:a}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,r=this.constructor.PARAMETERS||{},s=Y(this.gl),o={},a=n||Object.keys(r);for(const l of a){const c=r[l];if(c&&(!("webgl2"in c)||s)&&(!("extension"in c)||this.gl.getExtension(c.extension))){const f=i?ni(this.gl,l):l;o[f]=this.getParameter(l,e),i&&c.type==="GLenum"&&(o[f]=ni(this.gl,o[f]))}}return o}setParameter(e,n){e=Du(this.gl,e),k(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=Y(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");r.type==="GLenum"&&(n=Du(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return q1(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(Qi)}_deleteHandle(){throw new Error(Qi)}_bindHandle(e){throw new Error(Qi)}_getOptsFromHandle(){throw new Error(Qi)}_getParameter(e,n){throw new Error(Qi)}_setParameter(e,n){throw new Error(Qi)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=bi.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];bi.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const r=bi.get("Memory Usage".concat(i));r.get("GPU Memory").addCount(e),r.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=bi.get("Memory Usage".concat(n));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const T2="Failed to deduce GL constant from typed array";function Eh(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(T2)}}function yo(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function S2(t){let{data:e,width:n,height:i,bytesPerPixel:r=4,temp:s}=t;const o=n*r;s=s||new Uint8Array(o);for(let a=0;a<i/2;++a){const l=a*o,c=(i-a-1)*o;s.set(e.subarray(l,l+o)),e.copyWithin(l,c,c+o),e.set(s,c)}}function b2(t){let{data:e,width:n,height:i}=t;const r=Math.round(n/2),s=Math.round(i/2),o=new Uint8Array(r*s*4);for(let a=0;a<s;a++)for(let l=0;l<r;l++)for(let c=0;c<4;c++)o[(a*r+l)*4+c]=e[(a*2*n+l*2)*4+c];return{data:o,width:r,height:s}}function xh(t,e,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=n;for(const a in i)if(a in e){const c=i[a]?"".concat(t,".").concat(i[a]):"N/A";U.removed("".concat(t,".").concat(a),c)()}for(const a in r)if(a in e){const l=r[a];U.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))()}let o=null;for(const a in s)if(a in e){const l=s[a];U.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]}return o||e}const P2={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},A2={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ct{static getBytesPerElement(e){return yo(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return k(e.size),yo(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new ct(P2,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ct.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ct.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=xh("Accessor",e,A2),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const Qm=10,K1={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},L2={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:K1},C2={removedProps:K1};class te extends Ln{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ct.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ct.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=xh("Buffer",e,L2),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=xh("Buffer",e,C2),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new ct(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:r=0}=e,s=e.byteLength||e.length;k(n);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),r!==0||s!==void 0?(Ge(this.gl),this.gl.bufferSubData(this.target,i,n,r,s)):this.gl.bufferSubData(o,i,n),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:r=0,size:s}=e;const{gl:o}=this;return Ge(o),o.bindBuffer(36662,n.handle),o.bindBuffer(36663,this.handle),o.copyBufferSubData(36662,36663,i,r,s),o.bindBuffer(36662,null),o.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ge(this.gl);const s=yo(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(n),a=i;let l,c;e?(c=e.length,l=c-a):(l=Math.min(o,r||o),c=a+l);const u=Math.min(o,l);return r=r||u,k(r<=u),e=e||new s(c),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,r),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?r!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,r):(k(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Qm,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;k(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.usage),this.gl.bufferSubData(r,n,e),this.gl.bindBuffer(r,null),this.debugData=e.slice(0,Qm),this.bytesUsed=i,this._trackAllocatedMemory(i);const s=Eh(e);return k(s),this.setAccessor(new ct(this.accessor,{type:s})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;k(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,n),this.gl.bindBuffer(r,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=yo(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new ct(this.accessor,{type:Eh(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return U.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return U.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return U.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return U.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new ct(this.accessor,e),this}}const sg={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},Q1={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},J1={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function I2(t,e){const n=sg[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=Y(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function M2(t,e){const n=sg[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const R2=[9729,9728],Jm=globalThis.WebGLBuffer||function(){};class Ni extends Ln{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:r}=n;let s=!0;return i&&(s=s&&I2(e,i),s=s&&(!r||M2(e,i))),s}constructor(e,n){const{id:i=oi("texture"),handle:r,target:s}=n;super(e,{id:i,handle:r}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(m=>this.initialize(Object.assign({},e,{pixels:m,data:m}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:r=null,format:s=6408,border:o=0,recreate:a=!1,parameters:l={},pixelStore:c={},textureUnit:u=void 0}=e;n||(n=r);let{width:f,height:h,dataFormat:d,type:p,compressed:_=!1,mipmaps:x=!0}=e;const{depth:y=0}=e;return{width:f,height:h,compressed:_,dataFormat:d,type:p}=this._deduceParameters({format:s,type:p,dataFormat:d,compressed:_,data:n,width:f,height:h}),this.width=f,this.height=h,this.depth=y,this.format=s,this.type=p,this.dataFormat=d,this.border=o,this.textureUnit=u,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),x&&this._isNPOT()&&(U.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),x=!1,this._updateForNPOT(l)),this.mipmaps=x,this.setImageData({data:n,width:f,height:h,depth:y,format:s,type:p,dataFormat:d,border:o,mipmaps:x,parameters:c,compressed:_}),x&&this.generateMipmap(),this.setParameters(l),a&&(this.data=n),i&&(this._video={video:n,parameters:l,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:r=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(U.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Ut(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:r=0,format:s=this.format,border:o=this.border,offset:a=0,parameters:l={}}=e;let{data:c=null,type:u=this.type,width:f=this.width,height:h=this.height,dataFormat:d=this.dataFormat,compressed:p=!1}=e;c||(c=i),{type:u,dataFormat:d,compressed:p,width:f,height:h}=this._deduceParameters({format:s,type:u,dataFormat:d,compressed:p,data:c,width:f,height:h});const{gl:_}=this;_.bindTexture(this.target,this.handle);let x=null;({data:c,dataType:x}=this._getDataType({data:c,compressed:p}));let y,m=0;if(Ut(this.gl,l,()=>{switch(x){case"null":_.texImage2D(n,r,s,f,h,o,d,u,c);break;case"typed-array":_.texImage2D(n,r,s,f,h,o,d,u,c,a);break;case"buffer":y=Ge(_),y.bindBuffer(35052,c.handle||c),y.texImage2D(n,r,s,f,h,o,d,u,a),y.bindBuffer(35052,null);break;case"browser-object":Y(_)?_.texImage2D(n,r,s,f,h,o,d,u,c):_.texImage2D(n,r,s,d,u,c);break;case"compressed":for(const[w,T]of c.entries())_.compressedTexImage2D(n,w,T.format,T.width,T.height,o,T.data),m+=T.levelSize;break;default:k(!1,"Unknown image data type")}}),x==="compressed")this._trackAllocatedMemory(m,"Texture");else if(c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{const w=Q1[this.dataFormat]||4,T=J1[this.type]||1;this._trackAllocatedMemory(this.width*this.height*w*T,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:r=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:c=0,format:u=this.format,type:f=this.type,dataFormat:h=this.dataFormat,compressed:d=!1,offset:p=0,border:_=this.border,parameters:x={}}=e;if({type:f,dataFormat:h,compressed:d,width:a,height:l}=this._deduceParameters({format:u,type:f,dataFormat:h,compressed:d,data:r,width:a,height:l}),k(this.depth===0,"texSubImage not supported for 3D textures"),r||(r=i),r&&r.data){const y=r;r=y.data,a=y.shape[0],l=y.shape[1]}r instanceof te&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),Ut(this.gl,x,()=>{if(d)this.gl.compressedTexSubImage2D(n,c,s,o,a,l,u,r);else if(r===null)this.gl.texSubImage2D(n,c,s,o,a,l,h,f,null);else if(ArrayBuffer.isView(r))this.gl.texSubImage2D(n,c,s,o,a,l,h,f,r,p);else if(r instanceof Jm){const y=Ge(this.gl);y.bindBuffer(35052,r),y.texSubImage2D(n,c,s,o,a,l,h,f,p),y.bindBuffer(35052,null)}else Y(this.gl)?Ge(this.gl).texSubImage2D(n,c,s,o,a,l,h,f,r):this.gl.texSubImage2D(n,c,s,o,h,f,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return U.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof te?{data:n.handle,dataType:"buffer"}:n instanceof Jm?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:r,height:s,dataFormat:o,type:a,compressed:l}=e;const c=sg[n];return o=o||c&&c.dataFormat,a=a||c&&c.types[0],l=l||c&&c.compressed,{width:r,height:s}=this._deduceImageSize(i,r,s),{dataFormat:o,type:a,compressed:l,width:r,height:s,format:n,data:i}}_deduceImageSize(e,n,i){let r;return typeof ImageData<"u"&&e instanceof ImageData?r={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?r={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?r={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?r={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?r={width:e.videoWidth,height:e.videoHeight}:e?r={width:n,height:i}:r={width:n>=0?n:1,height:i>=0?i:1},k(r,"Could not deduced texture size"),k(n===void 0||r.width===n,"Deduced texture width does not match supplied width"),k(i===void 0||r.height===i,"Deduced texture height does not match supplied height"),r}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:k(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Y(this.gl)||!this.width||!this.height?!1:!Km(this.width)||!Km(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:R2.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let O2="";function k2(t,e){return k(typeof t=="string"),t=O2+t,new Promise((n,i)=>{try{const r=new Image;r.onload=()=>n(r),r.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),r.crossOrigin=e&&e.crossOrigin||"anonymous",r.src=t}catch(r){i(r)}})}class gt extends Ni{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return Ni.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Rc(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:k2(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const Th=[34069,34070,34071,34072,34073,34074];class ew extends Ni{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Rc(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:r=0,y:s=0,mipmapLevel:o=0}=e;return this._subImage({target:n,data:i,x:r,y:s,mipmapLevel:o})}async setCubeMapImageData(e){let{width:n,height:i,pixels:r,data:s,border:o=0,format:a=6408,type:l=5121}=e;const{gl:c}=this,u=r||s,f=await Promise.all(Th.map(h=>{const d=u[h];return Promise.all(Array.isArray(d)?d:[d])}));this.bind(),Th.forEach((h,d)=>{f[d].length>1&&this.opts.mipmaps!==!1&&U.warn("".concat(this.id," has mipmap and multiple LODs."))(),f[d].forEach((p,_)=>{n&&i?c.texImage2D(h,_,a,n,i,o,a,l,p):c.texImage2D(h,_,a,a,l,p)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:r,pixels:s,data:o,border:a=0,format:l=6408,type:c=5121}=e,{gl:u}=this,f=s||o;return this.bind(),f instanceof Promise?f.then(h=>this.setImageDataForFace(Object.assign({},e,{face:n,data:h,pixels:h}))):this.width||this.height?u.texImage2D(n,0,l,i,r,a,l,c,f):u.texImage2D(n,0,l,l,c,f),this}}ew.FACES=Th;class N2 extends Ni{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Y(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ge(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:r,height:s,depth:o=1,border:a=0,format:l,type:c=5121,offset:u=0,data:f,parameters:h={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Ut(this.gl,h,()=>{ArrayBuffer.isView(f)&&this.gl.texImage3D(this.target,n,i,r,s,o,a,l,c,f),f instanceof te&&(this.gl.bindBuffer(35052,f.handle),this.gl.texImage3D(this.target,n,i,r,s,o,a,l,c,u))}),f&&f.byteLength)this._trackAllocatedMemory(f.byteLength,"Texture");else{const d=Q1[this.dataFormat]||4,p=J1[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*d*p,"Texture")}return this.loaded=!0,this}}const pi="EXT_color_buffer_float",e0={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:pi,bpp:2},[33327]:{gl2:pi,bpp:4},[34842]:{gl2:pi,bpp:8},[33326]:{gl2:pi,bpp:4},[33328]:{gl2:pi,bpp:8},[34836]:{gl2:pi,bpp:16},[35898]:{gl2:pi,bpp:4}};function F2(t,e,n){const i=n[e];if(!i)return!1;const r=Y(t)&&i.gl2||i.gl1;return typeof r=="string"?t.getExtension(r):r}class yr extends Ln{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||F2(e,n,e0)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:r=1,samples:s=0}=e;return k(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&Y(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,n,i,r):this.gl.renderbufferStorage(36161,n,i,r),this.format=n,this.width=i,this.height=r,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*e0[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const D2=256,z2=1024,B2=16384,t0=6144,n0=6145,i0=6146,r0=34041,tw="clear: bad arguments";function og(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:r=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};e&&(s.framebuffer=e);let o=0;n&&(o|=B2,n!==!0&&(s.clearColor=n)),i&&(o|=D2,i!==!0&&(s.clearDepth=i)),r&&(o|=z2,i!==!0&&(s.clearStencil=i)),k(o!==0,tw),Ut(t,s,()=>{t.clear(o)})}function U2(t){let{framebuffer:e=null,buffer:n=t0,drawBuffer:i=0,value:r=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ge(t),Ut(t,{framebuffer:e},()=>{switch(n){case t0:switch(r.constructor){case Int32Array:t.clearBufferiv(n,i,r);break;case Uint32Array:t.clearBufferuiv(n,i,r);break;case Float32Array:default:t.clearBufferfv(n,i,r)}break;case n0:t.clearBufferfv(n0,0,[r]);break;case i0:t.clearBufferiv(i0,0,[r]);break;case r0:const[s,o]=r;t.clearBufferfi(r0,0,s,o);break;default:k(!1,tw)}})}function V2(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return k(!1),0}}function Oc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=e;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e;const{framebuffer:u,deleteFramebuffer:f}=nw(t);k(u);const{gl:h,handle:d,attachments:p}=u;a=a||u.width,l=l||u.height,s===36064&&d===null&&(s=1028),k(p[s]),c=c||p[s].type,o=G2(o,c,r,a,l),c=c||Eh(o);const _=h.bindFramebuffer(36160,d);return h.readPixels(n,i,a,l,r,c,o),h.bindFramebuffer(36160,_||null),f&&u.delete(),o}function s0(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=Oc(t,{sourceAttachment:e}),{width:r,height:s}=t;for(;s>n;)({data:i,width:r,height:s}=b2({data:i,width:r,height:s}));S2({data:i,width:r,height:s});const o=document.createElement("canvas");o.width=r,o.height=s;const a=o.getContext("2d"),l=a.createImageData(r,s);return l.data.set(i),a.putImageData(l,0,0),o.toDataURL()}function j2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:i=0,sourceY:r=0,targetMipmaplevel:s=0,targetInternalFormat:o=6408}=n;let{targetX:a,targetY:l,targetZ:c,width:u,height:f}=n;const{framebuffer:h,deleteFramebuffer:d}=nw(t);k(h);const{gl:p,handle:_}=h,x=typeof a<"u"||typeof l<"u"||typeof c<"u";a=a||0,l=l||0,c=c||0;const y=p.bindFramebuffer(36160,_);k(e);let m=null;if(e instanceof Ni&&(m=e,u=Number.isFinite(u)?u:m.width,f=Number.isFinite(f)?f:m.height,m.bind(0),e=m.target),!x)p.copyTexImage2D(e,s,o,i,r,u,f,0);else switch(e){case 3553:case 34067:p.copyTexSubImage2D(e,s,a,l,i,r,u,f);break;case 35866:case 32879:Ge(p).copyTexSubImage3D(e,s,a,l,c,i,r,u,f);break}return m&&m.unbind(),p.bindFramebuffer(36160,y||null),d&&h.delete(),m}function nw(t){return t instanceof Pe?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:J2(t),deleteFramebuffer:!0}}function G2(t,e,n,i,r){if(t)return t;e=e||5121;const s=yo(e,{clamped:!1}),o=V2(n);return new s(i*r*o)}const ae={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function W2(t){const e=new gt(t,{format:6408,type:5126,dataFormat:6408}),n=new Pe(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const iw={[ae.WEBGL2]:[!1,!0],[ae.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[ae.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[ae.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[ae.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[ae.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[ae.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[ae.FLOAT_BLEND]:["EXT_float_blend"],[ae.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[ae.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[ae.TEXTURE_FLOAT]:["OES_texture_float",!0],[ae.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[ae.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[ae.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[ae.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[ae.COLOR_ATTACHMENT_RGBA32F]:[W2,"EXT_color_buffer_float"],[ae.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[ae.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[ae.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[ae.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[ae.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[ae.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},H2=2;function $2(t,e){return ag(t,e)}function ag(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>rw(t,n))}function X2(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in iw)t.luma.caps[e]===void 0&&(t.luma.caps[e]=rw(t,e));return t.luma.caps}function rw(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=Y2(t,e)),t.luma.caps[e]||U.log(H2,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function Y2(t,e){const n=iw[e];k(n,e);let i;const r=Y(t)&&n[1]||n[0];if(typeof r=="function")i=r(t);else if(Array.isArray(r)){i=!0;for(const s of r)i=i&&!!t.getExtension(s)}else typeof r=="string"?i=!!t.getExtension(r):typeof r=="boolean"?i=r:k(!1);return i}const o0="Multiple render targets not supported";class Pe extends Ln{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:r}=n;let s=!0;return i&&(s=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),r&&(s=s&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Pe(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Ge(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Ge(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:r=null,color:s=!0,depth:o=!0,stencil:a=!1,check:l=!0,readBuffer:c=void 0,drawBuffers:u=void 0}=e;if(k(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,r)for(const f in r){const h=r[f];(Array.isArray(h)?h[0]:h).resize({width:n,height:i})}else r=this._createDefaultAttachments(s,o,a,n,i);this.update({clearAttachments:!0,attachments:r,readBuffer:c,drawBuffers:u}),r&&l&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:r,clearAttachments:s=!1,resizeAttachments:o=!0}=e;this.attach(n,{clearAttachments:s,resizeAttachments:o});const{gl:a}=this,l=a.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),a.bindFramebuffer(36160,l||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return k(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&U.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const r in this.attachments)this.attachments[r].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r={};n&&Object.keys(this.attachments).forEach(o=>{r[o]=null}),Object.assign(r,e);const s=this.gl.bindFramebuffer(36160,this.handle);for(const o in r){k(o!==void 0,"Misspelled framebuffer binding point?");const a=Number(o),l=r[a];let c=l;if(!c)this._unattach(a);else if(c instanceof yr)this._attachRenderbuffer({attachment:a,renderbuffer:c});else if(Array.isArray(l)){const[u,f=0,h=0]=l;c=u,this._attachTexture({attachment:a,texture:u,layer:f,level:h})}else this._attachTexture({attachment:a,texture:c,layer:0,level:0});i&&c&&c.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(o=>!this.attachments[o]).forEach(o=>{delete this.attachments[o]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(q2(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:r,drawBuffers:s=[]}=e,o=this.gl.bindFramebuffer(36160,this.handle);return(n||i||r)&&og(this.gl,{color:n,depth:i,stencil:r}),s.forEach((a,l)=>{U2(this.gl,{drawBuffer:l,value:a})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(){return U.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return U.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return U.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return U.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return U.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return U.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:r=0,width:s,height:o}=e;const a=Ge(this.gl),l=a.bindFramebuffer(36008,this.handle);return i===0&&r===0&&s===void 0&&o===void 0?a.invalidateFramebuffer(36008,n):a.invalidateFramebuffer(36008,n,i,r,s,o),a.bindFramebuffer(36008,l),this}getAttachmentParameter(e,n,i){let r=this._getAttachmentParameterFallback(n);return r===null&&(this.gl.bindFramebuffer(36160,this.handle),r=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&r>1e3&&(r=ni(this.gl,r)),r}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const r={};for(const s of i){const o=n?ni(this.gl,s):s;r[o]=this.getAttachmentParameter(e,s,n)}return r}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const r of n){const s=Number(r),o=e?ni(this.gl,s):s;i[o]=this.getAttachmentParameters(s,e)}return i}show(){return typeof window<"u"&&window.open(s0(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>U.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=s0(this,{targetMaxHeight:100});return U.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,r,s){let o=null;return e&&(o=o||{},o[36064]=new gt(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:r,height:s,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(o[36064])),n&&i?(o=o||{},o[33306]=new yr(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:r,height:111}),this.ownResources.push(o[33306])):n?(o=o||{},o[36096]=new yr(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:r,height:s}),this.ownResources.push(o[36096])):i&&k(!1),o}_unattach(e){const n=this.attachments[e];n&&(n instanceof yr?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:r}=this;r.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:r,level:s}=e;const{gl:o}=this;switch(o.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:Ge(o).framebufferTextureLayer(36160,n,i.target,s,r);break;case 34067:const l=Z2(r);o.framebufferTexture2D(36160,n,l,i.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,i.handle,s);break;default:k(!1,"Illegal texture type")}o.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=SA(this.gl);n?n.readBuffer(e):k(e===36064||e===1029,o0),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=Ge(n);if(i)i.drawBuffers(e);else{const r=n.getExtension("WEBGL_draw_buffers");r?r.drawBuffersWEBGL(e):k(e.length===1&&(e[0]===36064||e[0]===1029),o0)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=X2(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function Z2(t){return t<34069?t+34069:t}function q2(t){return(Pe.STATUS||{})[t]||"Framebuffer error ".concat(t)}const K2=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Pe.ATTACHMENT_PARAMETERS=K2;function Q2(t,e){k(t instanceof gt||t instanceof ew||t instanceof N2);const n=t.constructor,{gl:i,width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u}=t,f=Object.assign({width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u},e);return new n(i,f)}function J2(t,e){const{gl:n,width:i,height:r,id:s}=t;return new Pe(n,Object.assign({},e,{id:"framebuffer-for-".concat(s),width:i,height:r,attachments:{[36064]:t}}))}function ul(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const eL=35632,tL=35633;function nL(t){switch(t){case eL:return"fragment";case tL:return"vertex";default:return"unknown type"}}function iL(t,e,n,i){const r=t.split(/\r?\n/),s={},o={},a=i||ul(e)||"(unnamed)",l="".concat(nL(n)," shader ").concat(a);for(let u=0;u<r.length;u++){const f=r[u];if(f.length<=1)continue;const h=f.split(":"),d=h[0],p=parseInt(h[2],10);if(isNaN(p))throw new Error("GLSL compilation error in ".concat(l,": ").concat(t));d!=="WARNING"?s[p]=f:o[p]=f}const c=rL(e);return{shaderName:l,errors:a0(s,c),warnings:a0(o,c)}}function a0(t,e){let n="";for(let i=0;i<e.length;i++){const r=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(r,`
`),t[i+1])){const s=t[i+1],o=s.split(":",3),a=o[0],l=parseInt(o[1],10)||0,c=s.substring(o.join(":").length+1).trim();n+=sw("^^^ ".concat(a,": ").concat(c,`

`),l)}}return n}function rL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map((s,o)=>{const a=String(o+e),l=a.length;return sw(a,r-l)+n+s})}function sw(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function ow(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const sL="Shader: GLSL source code must be a JavaScript string";class vo extends Ln{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return k(!1),"unknown"}}constructor(e,n){Rc(e),k(typeof n.source=="string",sL);const i=ul(n.source,null)||n.id||oi("unnamed ".concat(vo.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=ul(n,null);i&&(this.id=oi(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(vo.getTypeName(this.shaderType),":").concat(this.id)}getName(){return ul(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:s,warnings:o}=iL(i,this.source,this.shaderType,this.id);throw U.error("GLSL compilation errors in ".concat(r,`
`).concat(s))(),U.warn("GLSL compilation warnings in ".concat(r,`
`).concat(o))(),new Error("GLSL compilation errors in ".concat(r))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Bu extends vo{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class Uu extends vo{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const oL={[5126]:se.bind(null,"uniform1fv",ot,1,Be),[35664]:se.bind(null,"uniform2fv",ot,2,Be),[35665]:se.bind(null,"uniform3fv",ot,3,Be),[35666]:se.bind(null,"uniform4fv",ot,4,Be),[5124]:se.bind(null,"uniform1iv",On,1,Be),[35667]:se.bind(null,"uniform2iv",On,2,Be),[35668]:se.bind(null,"uniform3iv",On,3,Be),[35669]:se.bind(null,"uniform4iv",On,4,Be),[35670]:se.bind(null,"uniform1iv",On,1,Be),[35671]:se.bind(null,"uniform2iv",On,2,Be),[35672]:se.bind(null,"uniform3iv",On,3,Be),[35673]:se.bind(null,"uniform4iv",On,4,Be),[35674]:se.bind(null,"uniformMatrix2fv",ot,4,an),[35675]:se.bind(null,"uniformMatrix3fv",ot,9,an),[35676]:se.bind(null,"uniformMatrix4fv",ot,16,an),[35678]:Re,[35680]:Re,[5125]:se.bind(null,"uniform1uiv",Ea,1,Be),[36294]:se.bind(null,"uniform2uiv",Ea,2,Be),[36295]:se.bind(null,"uniform3uiv",Ea,3,Be),[36296]:se.bind(null,"uniform4uiv",Ea,4,Be),[35685]:se.bind(null,"uniformMatrix2x3fv",ot,6,an),[35686]:se.bind(null,"uniformMatrix2x4fv",ot,8,an),[35687]:se.bind(null,"uniformMatrix3x2fv",ot,6,an),[35688]:se.bind(null,"uniformMatrix3x4fv",ot,12,an),[35689]:se.bind(null,"uniformMatrix4x2fv",ot,8,an),[35690]:se.bind(null,"uniformMatrix4x3fv",ot,12,an),[35678]:Re,[35680]:Re,[35679]:Re,[35682]:Re,[36289]:Re,[36292]:Re,[36293]:Re,[36298]:Re,[36299]:Re,[36300]:Re,[36303]:Re,[36306]:Re,[36307]:Re,[36308]:Re,[36311]:Re},aL={},lL={},cL={},l0=[0];function lg(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(l0[0]=t,t=l0);const r=t.length;if(r%e&&U.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let s=i[r];s||(s=new n(r),i[r]=s);for(let o=0;o<r;o++)s[o]=t[o];return s}function ot(t,e){return lg(t,e,Float32Array,aL)}function On(t,e){return lg(t,e,Int32Array,lL)}function Ea(t,e){return lg(t,e,Uint32Array,cL)}function c0(t,e,n){const i=oL[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function uL(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function fL(t,e,n){for(const i in t){const r=t[i];if((!n||!!n[i])&&!hL(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),r),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function hL(t){return Array.isArray(t)||ArrayBuffer.isView(t)?gL(t):isFinite(t)||t===!0||t===!1||t instanceof Ni||t instanceof yr?!0:t instanceof Pe?!!t.texture:!1}function dL(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let r=0,s=n.length;r<s;++r)i[r]=n[r]}else t[e]=n.slice();else t[e]=n}function gL(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Re(){let t=null;return(e,n,i)=>{const r=t!==i;return r&&(e.uniform1i(n,i),t=i),r}}function se(t,e,n,i){let r=null,s=null;return(o,a,l)=>{const c=e(l,n),u=c.length;let f=!1;if(r===null)r=new Float32Array(u),s=u,f=!0;else{k(s===u,"Uniform length cannot change.");for(let h=0;h<u;++h)if(c[h]!==r[h]){f=!0;break}}return f&&(i(o,t,a,c),r.set(c)),f}}function Be(t,e,n,i){t[e](n,i)}function an(t,e,n,i){t[e](n,!1,i)}const pL=5120,mL=5121,yL=5122,vL=5123,u0=0,xa=1,_L=2,wL=3,Ta=4,EL=5,xL=6,Te=5126,TL=35664,SL=35665,bL=35666,xs=5124,PL=35667,AL=35668,LL=35669,Ts=5125,CL=36294,IL=36295,ML=36296,RL=35670,OL=35671,kL=35672,NL=35673,FL=35674,DL=35675,zL=35676,BL=35685,UL=35686,VL=35687,jL=35688,GL=35689,WL=35690,Sh={[Te]:[Te,1,"float"],[TL]:[Te,2,"vec2"],[SL]:[Te,3,"vec3"],[bL]:[Te,4,"vec4"],[xs]:[xs,1,"int"],[PL]:[xs,2,"ivec2"],[AL]:[xs,3,"ivec3"],[LL]:[xs,4,"ivec4"],[Ts]:[Ts,1,"uint"],[CL]:[Ts,2,"uvec2"],[IL]:[Ts,3,"uvec3"],[ML]:[Ts,4,"uvec4"],[RL]:[Te,1,"bool"],[OL]:[Te,2,"bvec2"],[kL]:[Te,3,"bvec3"],[NL]:[Te,4,"bvec4"],[FL]:[Te,8,"mat2"],[BL]:[Te,8,"mat2x3"],[UL]:[Te,8,"mat2x4"],[DL]:[Te,12,"mat3"],[VL]:[Te,12,"mat3x2"],[jL]:[Te,12,"mat3x4"],[zL]:[Te,16,"mat4"],[GL]:[Te,16,"mat4x2"],[WL]:[Te,16,"mat4x3"]};function HL(t){switch(t){case u0:return u0;case xa:return xa;case wL:return xa;case _L:return xa;case Ta:return Ta;case EL:return Ta;case xL:return Ta;default:return k(!1),0}}function f0(t){const e=Sh[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function aw(t,e){switch(t){case pL:case mL:case yL:case vL:t=Te;break}for(const n in Sh){const[i,r,s]=Sh[n];if(i===t&&r===e)return{glType:n,name:s}}return null}class $L{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getActiveAttrib(e.handle,r),l=n.getAttribLocation(e.handle,s);l>=0&&this._addAttribute(l,s,o,a)}this.attributeInfos.sort((r,s)=>r.location-s.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Y(n))return;const i=n.getProgramParameter(e.handle,35971);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getTransformFeedbackVarying(e.handle,r);this._addVarying(r,s,o,a)}this.varyingInfos.sort((r,s)=>r.location-s.location)}_addAttribute(e,n,i,r){const{type:s,components:o}=f0(i),a={type:s,size:r*o};this._inferProperties(e,n,a);const l={location:e,name:n,accessor:new ct(a)};this.attributeInfos.push(l),this.attributeInfosByLocation[e]=l,this.attributeInfosByName[l.name]=l}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,r){const{type:s,components:o}=f0(i),a=new ct({type:s,size:r*o}),l={location:e,name:n,accessor:a};this.varyingInfos.push(l),this.varyingInfosByName[l.name]=l}}const h0=4,XL=35981,YL=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class lw extends Ln{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",YL),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:r,varyings:s,bufferMode:o=XL}=e;return this.hash=n||"",this.vs=typeof i=="string"?new Bu(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof r=="string"?new Uu(this.gl,{id:"".concat(e.id,"-fs"),source:r}):r,k(this.vs instanceof Bu),k(this.fs instanceof Uu),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(Ge(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new $L(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:r,offset:s=0,start:o,end:a,isIndexed:l=!1,indexType:c=5123,instanceCount:u=0,isInstanced:f=u>0,vertexArray:h=null,transformFeedback:d,framebuffer:p,parameters:_={},uniforms:x,samplers:y}=e;if((x||y)&&(U.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(x||{})),U.priority>=n){const m=p?p.id:"default",w="mode=".concat(ni(this.gl,i)," verts=").concat(r," ")+"instances=".concat(u," indexType=").concat(ni(this.gl,c)," ")+"isInstanced=".concat(f," isIndexed=").concat(l," ")+"Framebuffer=".concat(m);U.log(n,w)()}return k(h),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||r===0||f&&u===0?!1:(h.bindForDraw(r,u,()=>{if(p!==void 0&&(_=Object.assign({},_,{framebuffer:p})),d){const m=HL(i);d.begin(m)}this._bindTextures(),Ut(this.gl,_,()=>{l&&f?this.gl2.drawElementsInstanced(i,r,c,s,u):l&&Y(this.gl)&&!isNaN(o)&&!isNaN(a)?this.gl2.drawRangeElements(i,o,a,r,c,s):l?this.gl.drawElements(i,r,c,s):f?this.gl2.drawArraysInstanced(i,s,r,u):this.gl.drawArrays(i,s,r)}),d&&d.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};U.priority>=2&&fL(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],r=this._uniformSetters[n];if(r){let s=i,o=!1;if(s instanceof Pe&&(s=s.texture),s instanceof Ni)if(o=this.uniforms[n]!==i,o){r.textureIndex===void 0&&(r.textureIndex=this._textureIndexCounter++);const a=s,{textureIndex:l}=r;a.bind(l),s=l,this._textureUniforms[n]=a}else s=r.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(r(s)||o)&&dL(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const r of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new Bu({handle:r});break;case 35632:i.fs=new Uu({handle:r});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=oi(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),U.time(h0,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),U.timeEnd(h0,"linkProgram for ".concat(this._getName()))(),e.debug||U.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:r}=uL(i.name);let s=e.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=c0(e,s,i),i.size>1)for(let o=0;o<i.size;o++)s=e.getUniformLocation(this.handle,"".concat(r,"[").concat(o,"]")),this._uniformSetters["".concat(r,"[").concat(o,"]")]=c0(e,s,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const ZL=34918,qL=34919,KL=35007,QL=36795,JL=35976,eC=35887,tC=36202;class Kl extends Ln{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=Y(e),r=ag(e,ae.TIMER_QUERY);let s=i||r;for(const o of n)switch(o){case"queries":s=s&&i;break;case"timers":s=s&&r;break;default:k(!1)}return s}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(KL)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?tC:eC)}beginTransformFeedbackQuery(){return this.begin(JL)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,qL);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(QL)}getResult(){return this.gl2.getQueryParameter(this.handle,ZL)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,r)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return Kl.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class cw extends Ln{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Y(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ge(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Vr(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:r,byteSize:s,byteOffset:o}=this._getBufferParams(n);return i<0?(this.unused[e]=r,U.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,r,o,s),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,r;return e instanceof te?r=e:(r=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||r.byteLength-n),{buffer:r,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:r}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,r,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const s=n&&n.handle;return!s||r===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,i,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let Sa=null;function nC(t){return(!Sa||Sa.byteLength<t)&&(Sa=new ArrayBuffer(t)),Sa}function iC(t,e){const n=nC(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function rC(t){let{target:e,source:n,start:i=0,count:r=1}=t;const s=n.length,o=r*s;let a=0;for(let l=i;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+o-a),a=o);return e}const sC="elements must be GL.ELEMENT_ARRAY_BUFFER";class at extends Ln{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Y(e)||I1()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new at(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return at.MAX_ATTRIBUTES=at.MAX_ATTRIBUTES||e.getParameter(34921),at.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:at._setConstantFloatArray(e,n,i);break;case Int32Array:at._setConstantIntArray(e,n,i);break;case Uint32Array:at._setConstantUintArray(e,n,i);break;default:k(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return at.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return k(!e||e.target===34963,sC),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:r,type:s,stride:o,offset:a,normalized:l,integer:c,divisor:u}=i,{gl:f,gl2:h}=this;return e=Number(e),this.bind(()=>{f.bindBuffer(34962,n.handle),c?(k(Y(f)),h.vertexAttribIPointer(e,r,s,o,a)):f.vertexAttribPointer(e,r,s,l,o,a),f.enableVertexAttribArray(e),h.vertexAttribDivisor(e,u||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!at.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),r=i.byteLength*e,s=i.length*e;let o=!this.buffer;if(this.buffer=this.buffer||new te(this.gl,r),o=o||this.buffer.reallocate(r),o=o||!this._compareConstantArrayValues(i,this.bufferValue),o){const a=iC(n.constructor,s);rC({target:a,source:i,start:0,count:s}),this.buffer.subData(a),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:k(!1)}}static _setConstantIntArray(e,n,i){switch(k(Y(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:k(!1)}}static _setConstantUintArray(e,n,i){switch(k(Y(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:k(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return k(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const oC="VertexArray: attributes must be Buffers or constants (i.e. typed array)",aC=/^(.+)__LOCATION_([0-9]+)$/,lC=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class cC{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new at(e),q1(this,"VertexArray","v6.0",lC),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return r>=0&&(this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(r,n,s)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return r>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new te(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof te&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof te&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let r;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),r=i()}),r}_resolveLocationAndAccessor(e,n,i,r){const s={location:-1,accessor:null},{location:o,name:a}=this._getAttributeIndex(e);if(!Number.isFinite(o)||o<0)return this.unused[e]=n,U.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),s;const l=this._getAttributeInfo(a||o);if(!l)return s;const c=this.accessors[o]||{},u=ct.resolve(l.accessor,c,i,r),{size:f,type:h}=u;return k(Number.isFinite(f)&&Number.isFinite(h)),{location:o,accessor:u}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=aC.exec(e),r=i?i[1]:e,s=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+s,name:r}:{location:-1}}_setAttribute(e,n){if(n instanceof te)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof te){const i=n[0],r=n[1];this.setBuffer(e,i,r)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof te){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(oC)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,i);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)r=this.values[s],ArrayBuffer.isView(r)&&this._setConstantAttribute(s,r)}_setConstantAttributeZero(e,n){if(at.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){at.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],r=this.accessors[n];if(!i)return;const{divisor:s}=r,o=s>0;if(e.isInstanced=e.isInstanced||o,i instanceof te){const a=i;if(o){const l=a.getVertexCount(r);e.instanceCount=Math.min(e.instanceCount,l)}else{const l=a.getVertexCount(r);e.vertexCount=Math.min(e.vertexCount,l)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return U.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function uC(t,e){const{maxElts:n=16,size:i=1}=e;let r="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(r+=",".concat(o%i===0?" ":"")),r+=_o(t[o],e);const s=t.length>n?"...":"]";return"".concat(r).concat(s)}function _o(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return uC(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const r=t.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function d0(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:r=!1}=t;k(n);const s=".*_.*",o=".*Matrix",a=n._uniformSetters,l={},c=Object.keys(a).sort();let u=0;for(const d of c)!d.match(s)&&!d.match(o)&&Vu({table:l,header:e,uniforms:i,uniformName:d,undefinedOnly:r})&&u++;for(const d of c)d.match(o)&&Vu({table:l,header:e,uniforms:i,uniformName:d,undefinedOnly:r})&&u++;for(const d of c)l[d]||Vu({table:l,header:e,uniforms:i,uniformName:d,undefinedOnly:r})&&u++;let f=0;const h={};if(!r)for(const d in i){const p=i[d];l[d]||(f++,h[d]={Type:"NOT USED: ".concat(p),[e]:_o(p)})}return{table:l,count:u,unusedTable:h,unusedCount:f}}function Vu(t){let{table:e,header:n,uniforms:i,uniformName:r,undefinedOnly:s}=t;const o=i[r],a=fC(o);return!s||!a?(e[r]={[n]:a?_o(o):"N/A","Uniform Type":a?o:"NOT PROVIDED"},!0):!1}function fC(t){return t!=null}function hC(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=g0(e,e.elements,null,n));const r=e.values;for(const s in r){const o=e._getAttributeInfo(s);if(o){let a="".concat(s,": ").concat(o.name);const l=e.accessors[o.location];l&&(a="".concat(s,": ").concat(dC(o.name,l))),i[a]=g0(e,r[s],l,n)}}return i}function g0(t,e,n,i){const{gl:r}=t;if(!e)return{[i]:"null","Format ":"N/A"};let s="NOT PROVIDED",o=1,a=0,l=0,c,u,f;if(n&&(s=n.type,o=n.size,s=String(s).replace("Array",""),c=s.indexOf("nt")!==-1),e instanceof te){const h=e,{data:d,changed:p}=h.getDebugData();u=p?"*":"",f=d,l=h.byteLength,a=l/d.BYTES_PER_ELEMENT/o;let _;if(n){const x=n.divisor>0;_="".concat(x?"I ":"P "," ").concat(a," (x").concat(o,"=").concat(l," bytes ").concat(ni(r,s),")")}else c=!0,_="".concat(l," bytes");return{[i]:"".concat(u).concat(_o(f,{size:o,isInteger:c})),"Format ":_}}return f=e,o=e.length,s=String(e.constructor.name).replace("Array",""),c=s.indexOf("nt")!==-1,{[i]:"".concat(_o(f,{size:o,isInteger:c})," (constant)"),"Format ":"".concat(o,"x").concat(s," (constant)")}}function dC(t,e){const{type:n,size:i}=e,r=aw(n,i);return r?"".concat(t," (").concat(r.name,")"):t}function gC(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const r=p0(i);e["in ".concat(r)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const r=p0(i);e["out ".concat(r)]={[n]:JSON.stringify(i.accessor)}}return e}function p0(t){const{type:e,size:n}=t.accessor,i=aw(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const m0=An()&&typeof document<"u";let pC=0;class mC{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=x=>Z1(x),onAddHTML:i=null,onInitialize:r=()=>{},onRender:s=()=>{},onFinalize:o=()=>{},onError:a,gl:l=null,glOptions:c={},debug:u=!1,createFramebuffer:f=!1,autoResizeViewport:h=!0,autoResizeDrawingBuffer:d=!0,stats:p=bi.get("animation-loop-".concat(pC++))}=e;let{useDevicePixels:_=!0}=e;"useDevicePixelRatio"in e&&(U.deprecated("useDevicePixelRatio","useDevicePixels")(),_=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:r,onRender:s,onFinalize:o,onError:a,gl:l,glOptions:c,debug:u,createFramebuffer:f},this.gl=l,this.needsRedraw=null,this.timeline=null,this.stats=p,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:h,autoResizeDrawingBuffer:d,useDevicePixels:_}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return k(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Kl.isSupported(this.gl,["timers"])?new Kl(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return U.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=m0?new Promise((e,n)=>{if(m0&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):x2(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):E2(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?rg(this.props.gl,e):this.onCreateContext(e),!Mc(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");l2(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:r}=this.gl;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&d2(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Pe(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const zo="vs",cg="fs";function ht(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const ju={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function yC(t){const e={};for(const n in t){const i=t[n],r=vC(i);e[n]=r}return e}function vC(t){let e=y0(t);return e==="object"?t?"type"in t?Object.assign({},t,ju[t.type]):"value"in t?(e=y0(t.value),Object.assign({type:e},t,ju[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},ju[e])}function y0(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const _C="vs",wC="fs";class v0{constructor(e){let{name:n,vs:i,fs:r,dependencies:s=[],uniforms:o,getUniforms:a,deprecations:l=[],defines:c={},inject:u={},vertexShader:f,fragmentShader:h}=e;ht(typeof n=="string"),this.name=n,this.vs=i||f,this.fs=r||h,this.getModuleUniforms=a,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(l),this.defines=c,this.injections=EC(u),o&&(this.uniforms=yC(o))}getModuleSource(e){let n;switch(e){case _C:n=this.vs||"";break;case wC:n=this.fs||"";break;default:ht(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const r in i){const s=i[r];r in e&&!s.private?(s.validate&&ht(s.validate(e[r],s),"".concat(this.name,": invalid ").concat(r)),n[r]=e[r]):n[r]=s.value}return n}}function EC(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const r=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[r][n]=i}return e}function xC(t){return TC(fw(t))}function TC(t){const e={},n={};return uw({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,r)=>n[r]-n[i]).map(i=>e[i])}function uw(t){let{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)i[s.name]=s,(r[s.name]===void 0||r[s.name]<n)&&(r[s.name]=n);for(const s of e)s.dependencies&&uw({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function fw(t,e){return t.map(n=>(n instanceof v0||(ht(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),ht(n.name,"shader module has no name"),n=new v0(n),n.dependencies=fw(n.dependencies)),n))}function SC(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r}const bC=7936,PC=7937,AC=7938,LC=35724,ug={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Ei={};Object.keys(ug).forEach(t=>{Ei[t]=t});function CC(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function IC(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||bC),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||PC);return{gpuVendor:MC(n,i),vendor:n,renderer:i,version:t.getParameter(AC),shadingLanguageVersion:t.getParameter(LC)}}function MC(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const Gu={};function _0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=ug[e];if(ht(i,e),!SC(n))return!0;if(e in Gu)return Gu[e];const r=i[0],s=n.behavior||"enable",o="#extension GL_".concat(r," : ").concat(s,`
void main(void) {}`),a=t.createShader(35633);t.shaderSource(a,o),t.compileShader(a);const l=t.getShaderParameter(a,35713);return t.deleteShader(a),Gu[e]=l,l}function RC(t,e){const n=ug[e];ht(n,e);const i=CC(t)&&n[1]||n[0],r=typeof i=="string"?!!t.getExtension(i):i;return ht(r===!1||r===!0),r}function ba(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>RC(t,n))}function OC(t){switch(IC(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function kC(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return ba(t,Ei.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),ba(t,Ei.GLSL_DERIVATIVES)&&_0(t,Ei.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),ba(t,Ei.GLSL_FRAG_DATA)&&_0(t,Ei.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),ba(t,Ei.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const NC=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,FC=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,DC={[zo]:NC,[cg]:FC},fl="__LUMA_INJECT_DECLARATIONS__",w0=/void\s+main\s*\([^)]*\)\s*\{\n?/,E0=/}\n?[^{}]*$/,Wu=[];function x0(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=e===zo;for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),Wu.length=o.length;for(let l=0,c=o.length;l<c;++l)Wu[l]=o[l].injection;const a="".concat(Wu.join(`
`),`
`);switch(s){case"vs:#decl":r&&(t=t.replace(fl,a));break;case"vs:#main-start":r&&(t=t.replace(w0,l=>l+a));break;case"vs:#main-end":r&&(t=t.replace(E0,l=>a+l));break;case"fs:#decl":r||(t=t.replace(fl,a));break;case"fs:#main-start":r||(t=t.replace(w0,l=>l+a));break;case"fs:#main-end":r||(t=t.replace(E0,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(fl,""),i&&(t=t.replace(/\}\s*$/,s=>s+DC[e])),t}function bh(t){const e={};return ht(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function jr(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const hw=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],zC=[...hw,[jr("attribute"),"in $1"],[jr("varying"),"out $1"]],BC=[...hw,[jr("varying"),"in $1"]],dw=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],UC=[...dw,[jr("in"),"attribute $1"],[jr("out"),"varying $1"]],VC=[...dw,[jr("in"),"varying $1"]],Ph="gl_FragColor",Ah=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,jC=/void\s+main\s*\([^)]*\)\s*\{\n?/;function GC(t,e,n){switch(e){case 300:return n?Ql(t,zC):WC(t);case 100:return n?Ql(t,UC):HC(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Ql(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function WC(t){t=Ql(t,BC);const e=t.match(Ah);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(Ph,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(jC,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(Ph,"\\b"),"g"),n)}return t}function HC(t){t=Ql(t,VC);const e=t.match(Ah);if(e){const n=e[1];t=t.replace(Ah,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),Ph)}return t}const $C=`

`.concat(fl,`

`),gw={[zo]:"vertex",[cg]:"fragment"},XC=`precision highp float;

`;function YC(t,e){const{vs:n,fs:i}=e,r=xC(e.modules||[]);return{gl:t,vs:T0(t,Object.assign({},e,{source:n,type:zo,modules:r})),fs:T0(t,Object.assign({},e,{source:i,type:cg,modules:r})),getUniforms:ZC(r)}}function T0(t,e){let{id:n,source:i,type:r,modules:s,defines:o={},hookFunctions:a=[],inject:l={},transpileToGLSL100:c=!1,prologue:u=!0,log:f}=e;ht(typeof i=="string","shader source must be a string");const h=r===zo,d=i.split(`
`);let p=100,_="",x=i;d[0].indexOf("#version ")===0?(p=300,_=d[0],x=d.slice(1).join(`
`)):_="#version ".concat(p);const y={};s.forEach(L=>{Object.assign(y,L.getDefines())}),Object.assign(y,o);let m=u?"".concat(_,`
`).concat(KC({id:n,source:i,type:r}),`
`).concat(qC({type:r}),`
`).concat(OC(t),`
`).concat(kC(t),`
`).concat(QC(y),`
`).concat(h?"":XC,`
`):"".concat(_,`
`);const w=e3(a),T={},b={},P={};for(const L in l){const C=typeof l[L]=="string"?{injection:l[L],order:0}:l[L],M=L.match(/^(v|f)s:(#)?([\w-]+)$/);if(M){const R=M[2],V=M[3];R?V==="decl"?b[L]=[C]:P[L]=[C]:T[L]=[C]}else P[L]=[C]}for(const L of s){f&&L.checkDeprecations(x,f);const C=L.getModuleSource(r,p);m+=C;const M=L.injections[r];for(const R in M){const V=R.match(/^(v|f)s:#([\w-]+)$/);if(V){const G=V[2]==="decl"?b:P;G[R]=G[R]||[],G[R].push(M[R])}else T[R]=T[R]||[],T[R].push(M[R])}}return m+=$C,m=x0(m,r,b),m+=JC(w[r],T),m+=x,m=x0(m,r,P),m=GC(m,c?100:p,h),m}function ZC(t){return function(n){const i={};for(const r of t){const s=r.getUniforms(n,i);Object.assign(i,s)}return i}}function qC(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(gw[e].toUpperCase(),`
`)}function KC(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(gw[i],`

`):""}function QC(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const r=t[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function JC(t,e){let n="";for(const i in t){const r=t[i];if(n+="void ".concat(r.signature,` {
`),r.header&&(n+="  ".concat(r.header)),e[i]){const s=e[i];s.sort((o,a)=>o.order-a.order);for(const o of s)n+="  ".concat(o.injection,`
`)}r.footer&&(n+="  ".concat(r.footer)),n+=`}
`}return n}function e3(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[r,s]=n.split(":"),o=n.replace(/\(.+/,"");e[r][o]=Object.assign(i,{signature:s})}),e}const t3="void main() {gl_FragColor = vec4(0);}",pw=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,n3=`#version 300 es
`.concat(pw);function mw(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,r,s]=n;if(!e.includes(i)||!r||!s)return null;const o=s.split(";")[0];return{qualifier:i,type:r,name:o}}function yw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:r}=t;if(!n)return e===300?n3:e>300?"#version ".concat(e,`
`).concat(pw):t3;const s=s3(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(r,`;
void main() {
  `).concat(r," = ").concat(s,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function i3(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return ht(!1),null}}function r3(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return ht(!1),null}}function s3(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return ht(!1),null}}const o3=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,a3={name:"fp32",vs:o3,fs:null};function wo(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Ye={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function l3(t,{precision:e=Ye.precision}={}){return t=c3(t),"".concat(parseFloat(t.toPrecision(e)))}function Fi(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Hn(t,e,n){return f3(t,i=>Math.max(e,Math.min(n,i)))}function Gr(t,e,n){return Fi(t)?t.map((i,r)=>Gr(i,e[r],n)):n*e+(1-n)*t}function yn(t,e,n){const i=Ye.EPSILON;n&&(Ye.EPSILON=n);try{if(t===e)return!0;if(Fi(t)&&Fi(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!yn(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Ye.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Ye.EPSILON=i}}function c3(t){return Math.round(t/Ye.EPSILON)*Ye.EPSILON}function u3(t){return t.clone?t.clone():new Array(t.length)}function f3(t,e,n){if(Fi(t)){const i=t;n=n||u3(i);for(let r=0;r<n.length&&r<i.length;++r)n[r]=e(t[r],r,n);return n}return e(t)}function h3(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class fg extends h3(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Fi(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ye)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+l3(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!yn(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const s=e[r];this[r]=s+i*(n[r]-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Ye.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function d3(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function ne(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Ys(t,e,n=""){if(Ye.debug&&!d3(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class vw extends fg{get x(){return this[0]}set x(e){this[0]=ne(e)}get y(){return this[1]}set y(e){this[1]=ne(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];n+=r*r}return ne(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return ne(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return wo(e>=0&&e<this.ELEMENTS,"index is out of range"),ne(this[e])}setComponent(e,n){return wo(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Zs=1e-6,jt=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function g3(){var t=new jt(2);return jt!=Float32Array&&(t[0]=0,t[1]=0),t}function S0(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function p3(t,e){return t[0]=-e[0],t[1]=-e[1],t}function _w(t,e,n,i){var r=e[0],s=e[1];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t}function m3(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t}function y3(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}(function(){var t=g3();return function(e,n,i,r,s,o){var a,l;for(n||(n=2),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function v3(t,e,n){const i=e[0],r=e[1],s=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/s,t[1]=(n[1]*i+n[5]*r)/s,t}function ww(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s||1;return t[0]=(n[0]*i+n[4]*r+n[8]*s)/o,t[1]=(n[1]*i+n[5]*r+n[9]*s)/o,t[2]=(n[2]*i+n[6]*r+n[10]*s)/o,t}function _3(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function w3(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t[3]=e[3],t}function Ew(t,e,n){const i=e[0],r=e[1],s=e[2];return t[0]=n[0]*i+n[3]*r+n[6]*s,t[1]=n[1]*i+n[4]*r+n[7]*s,t[2]=n[2]*i+n[5]*r+n[8]*s,t[3]=e[3],t}function xw(){var t=new jt(3);return jt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function E3(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function b0(t,e,n){var i=new jt(3);return i[0]=t,i[1]=e,i[2]=n,i}function x3(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function T3(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function S3(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function b3(t,e){var n=e[0],i=e[1],r=e[2],s=n*n+i*i+r*r;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Tw(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function hl(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=r*l-s*a,t[1]=s*o-i*l,t[2]=i*a-r*o,t}function P3(t,e,n,i){var r=e[0],s=e[1],o=e[2];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t}function hg(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,t}function Sw(t,e,n){var i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t}function bw(t,e,n){var i=n[0],r=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2],u=r*c-s*l,f=s*a-i*c,h=i*l-r*a,d=r*h-s*f,p=s*u-i*h,_=i*f-r*u,x=o*2;return u*=x,f*=x,h*=x,d*=2,p*=2,_*=2,t[0]=a+u+d,t[1]=l+f+p,t[2]=c+h+_,t}function A3(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function L3(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function C3(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function I3(t,e){var n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt(n*n+i*i+r*r),c=Math.sqrt(s*s+o*o+a*a),u=l*c,f=u&&Tw(t,e)/u;return Math.acos(Math.min(Math.max(f,-1),1))}var Pw=x3,Aw=E3,Hu=T3;(function(){var t=xw();return function(e,n,i,r,s,o){var a,l;for(n||(n=3),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const $u=[0,0,0];let Pa;class D extends vw{static get ZERO(){return Pa||(Pa=new D(0,0,0),Object.freeze(Pa)),Pa}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&Fi(e)?this.copy(e):(Ye.debug&&(ne(e),ne(n),ne(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ye.debug&&(ne(e.x),ne(e.y),ne(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ne(e)}angle(e){return I3(this,e)}cross(e){return hl(this,this,e),this.check()}rotateX({radians:e,origin:n=$u}){return A3(this,this,n,e),this.check()}rotateY({radians:e,origin:n=$u}){return L3(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=$u}){return C3(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return hg(this,this,e),this.check()}transformAsVector(e){return ww(this,this,e),this.check()}transformByMatrix3(e){return Sw(this,this,e),this.check()}transformByMatrix2(e){return _3(this,this,e),this.check()}transformByQuaternion(e){return bw(this,this,e),this.check()}}let Aa;class dg extends vw{static get ZERO(){return Aa||(Aa=new dg(0,0,0,0),Object.freeze(Aa)),Aa}constructor(e=0,n=0,i=0,r=0){super(-0,-0,-0,-0),Fi(e)&&arguments.length===1?this.copy(e):(Ye.debug&&(ne(e),ne(n),ne(i),ne(r)),this[0]=e,this[1]=n,this[2]=i,this[3]=r)}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Ye.debug&&(ne(e.x),ne(e.y),ne(e.z),ne(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=ne(e)}get w(){return this[3]}set w(e){this[3]=ne(e)}transform(e){return hg(this,this,e),this.check()}transformByMatrix3(e){return Ew(this,this,e),this.check()}transformByMatrix2(e){return w3(this,this,e),this.check()}transformByQuaternion(e){return bw(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class Lw extends fg{toString(){let e="[";if(Ye.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=ne(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[i+r];return n}setColumn(e,n){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=n[r];return this}}function M3(){var t=new jt(9);return jt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function R3(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function O3(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=u*o-a*c,h=-u*s+a*l,d=c*s-o*l,p=n*f+i*h+r*d;return p?(p=1/p,t[0]=f*p,t[1]=(-u*i+r*c)*p,t[2]=(a*i-r*o)*p,t[3]=h*p,t[4]=(u*n-r*l)*p,t[5]=(-a*n+r*s)*p,t[6]=d*p,t[7]=(-c*n+i*l)*p,t[8]=(o*n-i*s)*p,t):null}function k3(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+n*(-c*r+o*a)+i*(l*r-s*a)}function P0(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=n[0],d=n[1],p=n[2],_=n[3],x=n[4],y=n[5],m=n[6],w=n[7],T=n[8];return t[0]=h*i+d*o+p*c,t[1]=h*r+d*a+p*u,t[2]=h*s+d*l+p*f,t[3]=_*i+x*o+y*c,t[4]=_*r+x*a+y*u,t[5]=_*s+x*l+y*f,t[6]=m*i+w*o+T*c,t[7]=m*r+w*a+T*u,t[8]=m*s+w*l+T*f,t}function N3(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=n[0],d=n[1];return t[0]=i,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=h*i+d*o+c,t[7]=h*r+d*a+u,t[8]=h*s+d*l+f,t}function F3(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=Math.sin(n),d=Math.cos(n);return t[0]=d*i+h*o,t[1]=d*r+h*a,t[2]=d*s+h*l,t[3]=d*o-h*i,t[4]=d*a-h*r,t[5]=d*l-h*s,t[6]=c,t[7]=u,t[8]=f,t}function A0(t,e,n){var i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function D3(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,f=i*a,h=r*o,d=r*a,p=r*l,_=s*o,x=s*a,y=s*l;return t[0]=1-f-p,t[3]=u-y,t[6]=h+x,t[1]=u+y,t[4]=1-c-p,t[7]=d-_,t[2]=h-x,t[5]=d+_,t[8]=1-c-f,t}var Lh;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(Lh||(Lh={}));const z3=Object.freeze([1,0,0,0,1,0,0,0,1]);class ke extends Lw{static get IDENTITY(){return U3()}static get ZERO(){return B3()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Lh}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(z3)}fromObject(e){return this.check()}fromQuaternion(e){return D3(this,e),this.check()}set(e,n,i,r,s,o,a,l,c){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this.check()}setRowMajor(e,n,i,r,s,o,a,l,c){return this[0]=e,this[1]=r,this[2]=a,this[3]=n,this[4]=s,this[5]=l,this[6]=i,this[7]=o,this[8]=c,this.check()}determinant(){return k3(this)}transpose(){return R3(this,this),this.check()}invert(){return O3(this,this),this.check()}multiplyLeft(e){return P0(this,e,this),this.check()}multiplyRight(e){return P0(this,this,e),this.check()}rotate(e){return F3(this,this,e),this.check()}scale(e){return Array.isArray(e)?A0(this,this,e):A0(this,this,[e,e]),this.check()}translate(e){return N3(this,this,e),this.check()}transform(e,n){let i;switch(e.length){case 2:i=m3(n||[-0,-0],e,this);break;case 3:i=Sw(n||[-0,-0,-0],e,this);break;case 4:i=Ew(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ys(i,e.length),i}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let La,Ca;function B3(){return La||(La=new ke([0,0,0,0,0,0,0,0,0]),Object.freeze(La)),La}function U3(){return Ca||(Ca=new ke,Object.freeze(Ca)),Ca}function V3(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function j3(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Ch(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],d=e[11],p=e[12],_=e[13],x=e[14],y=e[15],m=n*a-i*o,w=n*l-r*o,T=n*c-s*o,b=i*l-r*a,P=i*c-s*a,L=r*c-s*l,C=u*_-f*p,M=u*x-h*p,R=u*y-d*p,V=f*x-h*_,W=f*y-d*_,G=h*y-d*x,q=m*G-w*W+T*V+b*R-P*M+L*C;return q?(q=1/q,t[0]=(a*G-l*W+c*V)*q,t[1]=(r*W-i*G-s*V)*q,t[2]=(_*L-x*P+y*b)*q,t[3]=(h*P-f*L-d*b)*q,t[4]=(l*R-o*G-c*M)*q,t[5]=(n*G-r*R+s*M)*q,t[6]=(x*T-p*L-y*w)*q,t[7]=(u*L-h*T+d*w)*q,t[8]=(o*W-a*R+c*C)*q,t[9]=(i*R-n*W-s*C)*q,t[10]=(p*P-_*T+y*m)*q,t[11]=(f*T-u*P-d*m)*q,t[12]=(a*M-o*V-l*C)*q,t[13]=(n*V-i*M+r*C)*q,t[14]=(_*w-p*b-x*m)*q,t[15]=(u*b-f*w+h*m)*q,t):null}function G3(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],f=t[10],h=t[11],d=t[12],p=t[13],_=t[14],x=t[15],y=e*o-n*s,m=e*a-i*s,w=e*l-r*s,T=n*a-i*o,b=n*l-r*o,P=i*l-r*a,L=c*p-u*d,C=c*_-f*d,M=c*x-h*d,R=u*_-f*p,V=u*x-h*p,W=f*x-h*_;return y*W-m*V+w*R+T*M-b*C+P*L}function Li(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=e[9],d=e[10],p=e[11],_=e[12],x=e[13],y=e[14],m=e[15],w=n[0],T=n[1],b=n[2],P=n[3];return t[0]=w*i+T*a+b*f+P*_,t[1]=w*r+T*l+b*h+P*x,t[2]=w*s+T*c+b*d+P*y,t[3]=w*o+T*u+b*p+P*m,w=n[4],T=n[5],b=n[6],P=n[7],t[4]=w*i+T*a+b*f+P*_,t[5]=w*r+T*l+b*h+P*x,t[6]=w*s+T*c+b*d+P*y,t[7]=w*o+T*u+b*p+P*m,w=n[8],T=n[9],b=n[10],P=n[11],t[8]=w*i+T*a+b*f+P*_,t[9]=w*r+T*l+b*h+P*x,t[10]=w*s+T*c+b*d+P*y,t[11]=w*o+T*u+b*p+P*m,w=n[12],T=n[13],b=n[14],P=n[15],t[12]=w*i+T*a+b*f+P*_,t[13]=w*r+T*l+b*h+P*x,t[14]=w*s+T*c+b*d+P*y,t[15]=w*o+T*u+b*p+P*m,t}function Jl(t,e,n){var i=n[0],r=n[1],s=n[2],o,a,l,c,u,f,h,d,p,_,x,y;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*s+e[12],t[13]=e[1]*i+e[5]*r+e[9]*s+e[13],t[14]=e[2]*i+e[6]*r+e[10]*s+e[14],t[15]=e[3]*i+e[7]*r+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],f=e[5],h=e[6],d=e[7],p=e[8],_=e[9],x=e[10],y=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=f,t[6]=h,t[7]=d,t[8]=p,t[9]=_,t[10]=x,t[11]=y,t[12]=o*i+u*r+p*s+e[12],t[13]=a*i+f*r+_*s+e[13],t[14]=l*i+h*r+x*s+e[14],t[15]=c*i+d*r+y*s+e[15]),t}function gg(t,e,n){var i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function W3(t,e,n,i){var r=i[0],s=i[1],o=i[2],a=Math.hypot(r,s,o),l,c,u,f,h,d,p,_,x,y,m,w,T,b,P,L,C,M,R,V,W,G,q,At;return a<Zs?null:(a=1/a,r*=a,s*=a,o*=a,l=Math.sin(n),c=Math.cos(n),u=1-c,f=e[0],h=e[1],d=e[2],p=e[3],_=e[4],x=e[5],y=e[6],m=e[7],w=e[8],T=e[9],b=e[10],P=e[11],L=r*r*u+c,C=s*r*u+o*l,M=o*r*u-s*l,R=r*s*u-o*l,V=s*s*u+c,W=o*s*u+r*l,G=r*o*u+s*l,q=s*o*u-r*l,At=o*o*u+c,t[0]=f*L+_*C+w*M,t[1]=h*L+x*C+T*M,t[2]=d*L+y*C+b*M,t[3]=p*L+m*C+P*M,t[4]=f*R+_*V+w*W,t[5]=h*R+x*V+T*W,t[6]=d*R+y*V+b*W,t[7]=p*R+m*V+P*W,t[8]=f*G+_*q+w*At,t[9]=h*G+x*q+T*At,t[10]=d*G+y*q+b*At,t[11]=p*G+m*q+P*At,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Cw(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+c*i,t[5]=o*r+u*i,t[6]=a*r+f*i,t[7]=l*r+h*i,t[8]=c*r-s*i,t[9]=u*r-o*i,t[10]=f*r-a*i,t[11]=h*r-l*i,t}function H3(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-c*i,t[1]=o*r-u*i,t[2]=a*r-f*i,t[3]=l*r-h*i,t[8]=s*i+c*r,t[9]=o*i+u*r,t[10]=a*i+f*r,t[11]=l*i+h*r,t}function Iw(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+c*i,t[1]=o*r+u*i,t[2]=a*r+f*i,t[3]=l*r+h*i,t[4]=c*r-s*i,t[5]=u*r-o*i,t[6]=f*r-a*i,t[7]=h*r-l*i,t}function $3(t,e){var n=e[0],i=e[1],r=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.hypot(n,i,r),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(l,c,u),t}function X3(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,f=i*a,h=r*o,d=r*a,p=r*l,_=s*o,x=s*a,y=s*l;return t[0]=1-f-p,t[1]=u+y,t[2]=h-x,t[3]=0,t[4]=u-y,t[5]=1-c-p,t[6]=d+_,t[7]=0,t[8]=h+x,t[9]=d-_,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Y3(t,e,n,i,r,s,o){var a=1/(n-e),l=1/(r-i),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(r+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function Z3(t,e,n,i,r){var s=1/Math.tan(e/2),o;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0?(o=1/(i-r),t[10]=(r+i)*o,t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t}var q3=Z3;function K3(t,e,n,i,r,s,o){var a=1/(e-n),l=1/(i-r),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*l,t[14]=(o+s)*c,t[15]=1,t}var Q3=K3;function J3(t,e,n,i){var r,s,o,a,l,c,u,f,h,d,p=e[0],_=e[1],x=e[2],y=i[0],m=i[1],w=i[2],T=n[0],b=n[1],P=n[2];return Math.abs(p-T)<Zs&&Math.abs(_-b)<Zs&&Math.abs(x-P)<Zs?V3(t):(u=p-T,f=_-b,h=x-P,d=1/Math.hypot(u,f,h),u*=d,f*=d,h*=d,r=m*h-w*f,s=w*u-y*h,o=y*f-m*u,d=Math.hypot(r,s,o),d?(d=1/d,r*=d,s*=d,o*=d):(r=0,s=0,o=0),a=f*o-h*s,l=h*r-u*o,c=u*s-f*r,d=Math.hypot(a,l,c),d?(d=1/d,a*=d,l*=d,c*=d):(a=0,l=0,c=0),t[0]=r,t[1]=a,t[2]=u,t[3]=0,t[4]=s,t[5]=l,t[6]=f,t[7]=0,t[8]=o,t[9]=c,t[10]=h,t[11]=0,t[12]=-(r*p+s*_+o*x),t[13]=-(a*p+l*_+c*x),t[14]=-(u*p+f*_+h*x),t[15]=1,t)}function eI(){var t=new jt(4);return jt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function tI(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function pg(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function nI(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.hypot(e,n,i,r)}function iI(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r}function rI(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=i*o,t[2]=r*o,t[3]=s*o,t}function sI(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function oI(t,e,n,i){var r=e[0],s=e[1],o=e[2],a=e[3];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t[3]=a+i*(n[3]-a),t}function ns(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,t}function aI(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2],c=n[3],u=c*i+a*s-l*r,f=c*r+l*i-o*s,h=c*s+o*r-a*i,d=-o*i-a*r-l*s;return t[0]=u*c+d*-o+f*-l-h*-a,t[1]=f*c+d*-a+h*-o-u*-l,t[2]=h*c+d*-l+u*-a-f*-o,t[3]=e[3],t}(function(){var t=eI();return function(e,n,i,r,s,o){var a,l;for(n||(n=4),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Ih;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Ih||(Ih={}));const lI=45*Math.PI/180,cI=1,Xu=.1,Yu=500,uI=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class qe extends Lw{static get IDENTITY(){return hI()}static get ZERO(){return fI()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Ih}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,r,s,o,a,l,c,u,f,h,d,p,_,x){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=f,this[11]=h,this[12]=d,this[13]=p,this[14]=_,this[15]=x,this.check()}setRowMajor(e,n,i,r,s,o,a,l,c,u,f,h,d,p,_,x){return this[0]=e,this[1]=s,this[2]=c,this[3]=d,this[4]=n,this[5]=o,this[6]=u,this[7]=p,this[8]=i,this[9]=a,this[10]=f,this[11]=_,this[12]=r,this[13]=l,this[14]=h,this[15]=x,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(uI)}fromObject(e){return this.check()}fromQuaternion(e){return X3(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:r,top:s,near:o=Xu,far:a=Yu}=e;return a===1/0?dI(this,n,i,r,s,o):Y3(this,n,i,r,s,o,a),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:r=[0,1,0]}=e;return J3(this,n,i,r),this.check()}ortho(e){const{left:n,right:i,bottom:r,top:s,near:o=Xu,far:a=Yu}=e;return Q3(this,n,i,r,s,o,a),this.check()}orthographic(e){const{fovy:n=lI,aspect:i=cI,focalDistance:r=1,near:s=Xu,far:o=Yu}=e;L0(n);const a=n/2,l=r*Math.tan(a),c=l*i;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:r=.1,far:s=500}=e;return L0(n),q3(this,n,i,r,s),this.check()}determinant(){return G3(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*r,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*r,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return j3(this,this),this.check()}invert(){return Ch(this,this),this.check()}multiplyLeft(e){return Li(this,e,this),this.check()}multiplyRight(e){return Li(this,this,e),this.check()}rotateX(e){return Cw(this,this,e),this.check()}rotateY(e){return H3(this,this,e),this.check()}rotateZ(e){return Iw(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return W3(this,this,e,n),this.check()}scale(e){return gg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Jl(this,this,e),this.check()}transform(e,n){return e.length===4?(n=ns(n||[-0,-0,-0,-0],e,this),Ys(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let r;switch(i){case 2:r=y3(n||[-0,-0],e,this);break;case 3:r=hg(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ys(r,e.length),r}transformAsVector(e,n){let i;switch(e.length){case 2:i=v3(n||[-0,-0],e,this);break;case 3:i=ww(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ys(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let Ia,Ma;function fI(){return Ia||(Ia=new qe([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Ia)),Ia}function hI(){return Ma||(Ma=new qe,Object.freeze(Ma)),Ma}function L0(t){if(t>Math.PI*2)throw Error("expected radians")}function dI(t,e,n,i,r,s){const o=2*s/(n-e),a=2*s/(r-i),l=(n+e)/(n-e),c=(r+i)/(r-i),u=-1,f=-1,h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=f,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}function C0(){var t=new jt(4);return jt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function gI(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Mw(t,e,n){n=n*.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function I0(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=n[0],l=n[1],c=n[2],u=n[3];return t[0]=i*u+o*a+r*c-s*l,t[1]=r*u+o*l+s*a-i*c,t[2]=s*u+o*c+i*l-r*a,t[3]=o*u-i*a-r*l-s*c,t}function pI(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+o*a,t[1]=r*l+s*a,t[2]=s*l-r*a,t[3]=o*l-i*a,t}function mI(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l-s*a,t[1]=r*l+o*a,t[2]=s*l+i*a,t[3]=o*l-r*a,t}function yI(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+r*a,t[1]=r*l-i*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function vI(t,e){var n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t}function dl(t,e,n,i){var r=e[0],s=e[1],o=e[2],a=e[3],l=n[0],c=n[1],u=n[2],f=n[3],h,d,p,_,x;return d=r*l+s*c+o*u+a*f,d<0&&(d=-d,l=-l,c=-c,u=-u,f=-f),1-d>Zs?(h=Math.acos(d),p=Math.sin(h),_=Math.sin((1-i)*h)/p,x=Math.sin(i*h)/p):(_=1-i,x=i),t[0]=_*r+x*l,t[1]=_*s+x*c,t[2]=_*o+x*u,t[3]=_*a+x*f,t}function _I(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;return t[0]=-n*a,t[1]=-i*a,t[2]=-r*a,t[3]=s*a,t}function wI(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Rw(t,e){var n=e[0]+e[4]+e[8],i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);var s=(r+1)%3,o=(r+2)%3;i=Math.sqrt(e[r*3+r]-e[s*3+s]-e[o*3+o]+1),t[r]=.5*i,i=.5/i,t[3]=(e[s*3+o]-e[o*3+s])*i,t[s]=(e[s*3+r]+e[r*3+s])*i,t[o]=(e[o*3+r]+e[r*3+o])*i}return t}var EI=tI,xI=pg,TI=sI,SI=oI,bI=nI,PI=iI,Ow=rI,AI=function(){var t=xw(),e=b0(1,0,0),n=b0(0,1,0);return function(i,r,s){var o=Tw(r,s);return o<-.999999?(hl(t,e,r),Aw(t)<1e-6&&hl(t,n,r),b3(t,t),Mw(i,t,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(hl(t,r,s),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+o,Ow(i,i))}}();(function(){var t=C0(),e=C0();return function(n,i,r,s,o,a){return dl(t,i,o,a),dl(e,r,s,a),dl(n,t,e,2*a*(1-a)),n}})();(function(){var t=M3();return function(e,n,i,r){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],Ow(e,Rw(e,t))}})();const LI=[0,0,0,1];class M0 extends fg{constructor(e=0,n=0,i=0,r=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,i,r)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return Rw(this,e),this.check()}fromAxisRotation(e,n){return Mw(this,e,n),this.check()}identity(){return gI(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=ne(e)}get y(){return this[1]}set y(e){this[1]=ne(e)}get z(){return this[2]}set z(e){this[2]=ne(e)}get w(){return this[3]}set w(e){this[3]=ne(e)}len(){return bI(this)}lengthSquared(){return PI(this)}dot(e){return TI(this,e)}rotationTo(e,n){return AI(this,e,n),this.check()}add(e){return EI(this,this,e),this.check()}calculateW(){return vI(this,this),this.check()}conjugate(){return wI(this,this),this.check()}invert(){return _I(this,this),this.check()}lerp(e,n,i){return i===void 0?this.lerp(this,e,n):(SI(this,e,n,i),this.check())}multiplyRight(e){return I0(this,this,e),this.check()}multiplyLeft(e){return I0(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return pI(this,this,e),this.check()}rotateY(e){return mI(this,this,e),this.check()}rotateZ(e){return yI(this,this,e),this.check()}scale(e){return xI(this,this,e),this.check()}slerp(e,n,i){let r,s,o;switch(arguments.length){case 1:({start:r=LI,target:s,ratio:o}=e);break;case 2:r=this,s=e,o=n;break;default:r=e,s=n,o=i}return dl(this,r,s,o),this.check()}transformVector4(e,n=new dg){return aI(n,e,this),Ys(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const kw={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},R0=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,CI={lightSources:{}};function Zu(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function II(t){let{ambientLight:e,pointLights:n=[],directionalLights:i=[]}=t;const r={};return e?r["lighting_uAmbientLight.color"]=Zu(e):r["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((s,o)=>{r["lighting_uPointLight[".concat(o,"].color")]=Zu(s),r["lighting_uPointLight[".concat(o,"].position")]=s.position,r["lighting_uPointLight[".concat(o,"].attenuation")]=s.attenuation||[1,0,0]}),r.lighting_uPointLightCount=n.length,i.forEach((s,o)=>{r["lighting_uDirectionalLight[".concat(o,"].color")]=Zu(s),r["lighting_uDirectionalLight[".concat(o,"].direction")]=s.direction}),r.lighting_uDirectionalLightCount=i.length,r}function Nw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:CI;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},II({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return Nw({lightSources:e})}return{}}const MI={name:"lights",vs:R0,fs:R0,getUniforms:Nw,defines:{MAX_LIGHTS:3}},RI=new Uint8Array([0,255,255,255]),OI={pickingSelectedColor:null,pickingHighlightColor:RI,pickingActive:!1,pickingAttribute:!1};function kI(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:OI;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const NI=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,FI=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,DI={name:"picking",vs:NI,fs:FI,getUniforms:kI},zI=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,BI={};function UI(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map(s=>s/255)}}function VI(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:BI;if(!("material"in t))return{};const{material:e}=t;return e?UI(e):{lighting_uEnabled:!1}}const jI={name:"gouraud-lighting",dependencies:[MI],vs:zI,defines:{LIGHTING_VERTEX:1},getUniforms:VI},GI=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,WI={name:"transform",vs:GI,fs:null};class Bo{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Bo(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:r={},inject:s={},varyings:o=[],bufferMode:a=35981,transpileToGLSL100:l=!1}=e,c=this._getModuleList(e.modules),u=this._getHash(n),f=this._getHash(i),h=c.map(w=>this._getHash(w.name)).sort(),d=o.map(w=>this._getHash(w)),p=Object.keys(r).sort(),_=Object.keys(s).sort(),x=[],y=[];for(const w of p)x.push(this._getHash(w)),x.push(this._getHash(r[w]));for(const w of _)y.push(this._getHash(w)),y.push(this._getHash(s[w]));const m="".concat(u,"/").concat(f,"D").concat(x.join("/"),"M").concat(h.join("/"),"I").concat(y.join("/"),"V").concat(d.join("/"),"H").concat(this.stateHash,"B").concat(a).concat(l?"T":"");if(!this._programCache[m]){const w=YC(this.gl,{vs:n,fs:i,modules:c,inject:s,defines:r,hookFunctions:this._hookFunctions,transpileToGLSL100:l});this._programCache[m]=new lw(this.gl,{hash:m,vs:w.vs,fs:w.fs,varyings:o,bufferMode:a}),this._getUniforms[m]=w.getUniforms||(T=>{}),this._useCounts[m]=0}return this._useCounts[m]++,this._programCache[m]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[r++]=a,i[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;i[l]||(n[r++]=a,i[l]=!0)}return n.length=r,n}}const HI={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function $I(t,e,n){const i={};let r=e.indices;for(const s in e.attributes){const o=e.attributes[s],a=XI(s,n);if(s==="indices")r=o;else if(o.constant)i[a]=o.value;else{const l=o.value,c={...o};delete c.value,i[a]=[new te(t,l),c],YI(s,c)}}if(r){const s=r.value||r;k(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const o={size:1,isIndexed:r.isIndexed===void 0?!0:r.isIndexed};i.indices=[new te(t,{data:s,target:34963}),o]}return i}function XI(t,e){const{attributeMap:n=HI}=e||{};return n&&n[t]||t}function YI(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}k(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Ji=2,ZI=1e4,qI="Model needs drawMode and vertexCount",O0=()=>{},KI={};class Di{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=oi("model")}=n;k(Mc(e)),this.id=i,this.gl=e,this.id=n.id||oi("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||Bo.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},k(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),qI)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return k(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return k(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=$I(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Vr(e))return this;const n={};for(const i in e){const r=e[i];n[i]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return og(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:r={},attributes:s={},transformFeedback:o=this.transformFeedback,parameters:a={},vertexArray:l=this.vertexArray}=e;this.setAttributes(s),this.updateModuleSettings(n),this.setUniforms(r);let c;U.priority>=Ji&&(c=this._logDrawCallStart(Ji));const u=this.vertexArray.getDrawParams(),{isIndexed:f=u.isIndexed,indexType:h=u.indexType,indexOffset:d=u.indexOffset,vertexArrayInstanced:p=u.isInstanced}=this.props;p&&!this.isInstanced&&U.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:_,instanceCount:x}=this,{onBeforeRender:y=O0,onAfterRender:m=O0}=this.props;y(),this.program.setUniforms(this.uniforms);const w=this.program.draw(Object.assign(KI,e,{logPriority:c,uniforms:null,framebuffer:i,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:l,transformFeedback:o,isIndexed:f,indexType:h,isInstanced:_,instanceCount:x,offset:f?d:0}));return m(),U.priority>=Ji&&this._logDrawCallEnd(c,l,i),w}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:r=[]}=e;let{parameters:s}=e;i&&this._setFeedbackBuffers(i),n&&(s=Object.assign({},s,{[35977]:n})),r.forEach(o=>o.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:s}))}finally{r.forEach(o=>o.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return U.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:r,modules:s,inject:o,defines:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=this.programProps;n=this.programManager.get({vs:i,fs:r,modules:s,inject:o,defines:a,varyings:l,bufferMode:c,transpileToGLSL100:u}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}k(n instanceof lw,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new cC(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof te&&n.delete()}}_setAnimationProps(e){this.animated&&k(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Vr(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new cw(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:ZI;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),U.group(Ji,">>> DRAWING MODEL ".concat(this.id),{collapsed:U.level<=2})(),e}_logDrawCallEnd(e,n,i,r){if(e===void 0)return;const s=hC({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:o,unusedTable:a,unusedCount:l}=d0({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:c,count:u}=d0({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});u>0&&U.log("MISSING UNIFORMS",Object.keys(c))(),l>0&&U.log("UNUSED UNIFORMS",Object.keys(a))();const f=gC(this.vertexArray.configuration);U.table(e,s)(),U.table(e,o)(),U.table(e+1,f)(),r&&r.log({logLevel:Ji,message:"Rendered to ".concat(r.id)}),U.groupEnd(Ji)()}}class QI{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:r}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:r}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof te?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&k(Y(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const r in this.feedbackMap){const s=this.feedbackMap[r];r in n&&(i[s]=r)}Object.assign(i,e.feedbackBuffers);for(const r in i){const s=i[r];if(typeof s=="string"){const o=n[s],{byteLength:a,usage:l,accessor:c}=o;i[r]=this._createNewBuffer(r,{byteLength:a,usage:l,accessor:c})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:r}=i;e.transformFeedback=new cw(this.gl,{program:r,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const r in this.feedbackMap){const s=this.feedbackMap[r];n[r]=e.feedbackBuffers[s],i[s]=e.sourceBuffers[r],k(i[s]instanceof te)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new te(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const JI="transform_uSampler_",ec="transform_uSize_",k0="transform_position";function eM(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:r}=t,o=Object.keys(n).length,a=null;const l={};let c=e,u={};if(o>0||i){const f=c.split(`
`),h=f.slice();if(f.forEach((d,p,_)=>{if(o>0){const x=sM(d,n);if(x){const{updatedLine:y,inject:m}=x;h[p]=y,u=bh([u,m]),Object.assign(l,x.samplerTextureMap),o--}}i&&!a&&(a=rM(d,i))}),i){k(r);const d="".concat(ec).concat(i),p="uniform vec2 ".concat(d,`;
`),_="     vec2 ".concat(k0," = transform_getPos(").concat(d,`);
     gl_Position = vec4(`).concat(k0,`, 0, 1.);
`);u=bh([u,{"vs:#decl":p,"vs:#main-start":_}])}c=h.join(`
`)}return{vs:c,targetTextureType:a,inject:u,samplerTextureMap:l}}function tM(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const r={};let s,o;n&&({width:s,height:o}=i,r["".concat(ec).concat(n)]=[s,o]);for(const a in e)({width:s,height:o}=e[a]),r["".concat(ec).concat(a)]=[s,o];return r}function nM(t){return mw(t,["attribute","in"])}function iM(t){const e="".concat(JI).concat(t),n="".concat(ec).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function rM(t,e){const n=mw(t,["varying","out"]);return n&&n.name===e?n.type:null}function sM(t,e){const n={},i=nM(t);if(!i)return null;const{type:r,name:s}=i;if(s&&e[s]){const o="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:a,sizeName:l,uniformDeclerations:c}=iM(s),u=i3(r),f="  ".concat(r," ").concat(s," = transform_getInput(").concat(a,", ").concat(l,").").concat(u,`;
`);return n[a]=s,{updatedLine:o,inject:{"vs:#decl":c,"vs:#main-start":f},samplerTextureMap:n}}return null}const oM={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},aM="transform_output";class lM{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:r,targetTexture:s}=this.bindings[this.currentIndex],o=Object.assign({},n,e.attributes),a=Object.assign({},e.uniforms),l=Object.assign({},e.parameters);let c=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const f in this.samplerTextureMap){const h=this.samplerTextureMap[f];a[f]=i[h]}this._setSourceTextureParameters();const u=tM({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(a,u)}return this.hasTargetTexture&&(c=!1,l.viewport=[0,0,r.width,r.height]),{attributes:o,framebuffer:r,uniforms:a,discard:c,parameters:l}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=Oc(n);if(!e)return i;const r=i.constructor,s=r3(this.targetTextureType),o=new r(i.length*s/4);let a=0;for(let l=0;l<i.length;l+=4)for(let c=0;c<s;c++)o[a++]=i[l+c];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof gt)return i;const r=n[i];return r?(this._targetRefTexName=i,this._createNewTexture(r)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:r}=e,s=this._createTargetTexture({sourceTextures:i,textureOrReference:r});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,r,s)=>{s[r]=r}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new te(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:r,targetTexture:s}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),Object.assign(e.sourceBuffers,i),s){e.targetTexture=s;const{width:o,height:a}=s,{framebuffer:l}=e;l?(l.update({attachments:{[36064]:s},resizeAttachments:!1}),l.resize({width:o,height:a})):e.framebuffer=new Pe(this.gl,{id:"transform-framebuffer",width:o,height:a,attachments:{[36064]:s}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(oM)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=Q2(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:r,uniforms:s,targetTextureType:o,inject:a,samplerTextureMap:l}=eM({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),c=bh([e.inject||{},a]);this.targetTextureType=o,this.samplerTextureMap=l;const u=e._fs||yw({version:ow(r),input:this.targetTextureVarying,inputType:o,output:aM}),f=this.hasSourceTextures||this.targetTextureVarying?[WI].concat(e.modules||[]):e.modules;return{vs:r,fs:u,modules:f,uniforms:s,inject:c}}}class mg{static isSupported(e){return Y(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();k(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const r=i.getData(e);if(r)return r}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Di(n,Object.assign({},e,{fs:e.fs||yw({version:ow(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=r.updateModelProps(n);return n}_buildResourceTransforms(e,n){cM(n)&&(this.bufferTransform=new QI(e,n)),uM(n)&&(this.textureTransform=new lM(e,n)),k(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=Object.assign(n,r.getDrawOptions(n));return n}}function cM(t){return!!(!Vr(t.feedbackBuffers)||!Vr(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function uM(t){return!!(!Vr(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const N0={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Uo{static get DRAW_MODE(){return N0}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=oi("geometry"),drawMode:i=N0.TRIANGLES,attributes:r={},indices:s=null,vertexCount:o=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(r,s),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let r=e[i];r=ArrayBuffer.isView(r)?{value:r}:r,k(ArrayBuffer.isView(r.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!r.size&&(r.size=3),i==="indices"?(k(!this.indices),this.indices=r):this.attributes[i]=r}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const r in e){const s=e[r],{value:o,size:a,constant:l}=s;!l&&o&&a>=1&&(i=Math.min(i,o.length/a))}return k(Number.isFinite(i)),i}}let fM=1,hM=1;class Fw{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=e,o=fM++,a={time:0,delay:n,duration:i,rate:r,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:s,channel:o}=r;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=hM++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,r=e.duration*e.repeat;i>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const dM=[255,255,255],gM=1;let pM=0;class mM{constructor(e={}){g(this,"id",void 0),g(this,"color",void 0),g(this,"intensity",void 0),g(this,"type","ambient");const{color:n=dM}=e,{intensity:i=gM}=e;this.id=e.id||"ambient-".concat(pM++),this.color=n,this.intensity=i}}const yM=[255,255,255],vM=1,_M=[0,0,-1];let wM=0;class F0{constructor(e={}){g(this,"id",void 0),g(this,"color",void 0),g(this,"intensity",void 0),g(this,"type","directional"),g(this,"direction",void 0),g(this,"shadow",void 0);const{color:n=yM}=e,{intensity:i=vM}=e,{direction:r=_M}=e,{_shadow:s=!1}=e;this.id=e.id||"directional-".concat(wM++),this.color=n,this.intensity=i,this.type="directional",this.direction=new D(r).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class EM{constructor(e,n={id:"pass"}){g(this,"id",void 0),g(this,"gl",void 0),g(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class yg extends EM{constructor(...e){super(...e),g(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return Tn(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:r,views:s,onViewportActive:o,clearStack:a=!0,clearCanvas:l=!0}=e;e.pass=e.pass||"unknown";const c=this.gl;l&&TM(c,n),a&&(this._lastRenderIndex=-1);const u=[];for(const f of r){const h=s&&s[f.id];o==null||o(f);const d=this._getDrawLayerParams(f,e),p=f.subViewports||[f];for(const _ of p){const x=this._drawLayersInViewport(c,{target:n,moduleParameters:i,viewport:_,view:h,pass:e.pass,layers:e.layers},d);u.push(x)}}return u}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:r=!1,layerFilter:s,cullRect:o,effects:a,moduleParameters:l},c=!1){const u=[],f=Dw(this._lastRenderIndex+1),h={layer:n[0],viewport:e,isPicking:r,renderPass:i,cullRect:o},d={};for(let p=0;p<n.length;p++){const _=n[p],x=this._shouldDrawLayer(_,h,s,d),y={shouldDrawLayer:x};x&&!c&&(y.layerRenderIndex=f(_,x),y.moduleParameters=this._getModuleParameters(_,a,i,l),y.layerParameters=this.getLayerParameters(_,p,e)),u[p]=y}return u}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:r,target:s,viewport:o,view:a},l){const c=xM(e,{moduleParameters:i,target:s,viewport:o});if(a&&a.props.clear){const f=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;Ut(e,{scissorTest:!0,scissor:c},()=>og(e,f))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Tn(e,{viewport:c});for(let f=0;f<n.length;f++){const h=n[f],{shouldDrawLayer:d,layerRenderIndex:p,moduleParameters:_,layerParameters:x}=l[f];if(d&&h.props.pickable&&u.pickableCount++,h.isComposite)u.compositeCount++;else if(d){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,p),_.viewport=o;try{h._drawLayer({moduleParameters:_,uniforms:{layerIndex:p},parameters:x})}catch(y){h.raiseError(y,"drawing ".concat(h," to ").concat(r))}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(i){const a=n.layer.id;if(a in r||(r[a]=i(n)),!r[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,r){var s;const o=Object.assign(Object.create(((s=e.internalState)===null||s===void 0?void 0:s.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Ur(this.gl)});if(n)for(const l of n){var a;Object.assign(o,(a=l.getModuleParameters)===null||a===void 0?void 0:a.call(l,e))}return Object.assign(o,this.getModuleParameters(e,n),r)}}function Dw(t=0,e={}){const n={},i=(r,s)=>{const o=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in e)&&i(r.parent,!1),l in n){const u=n[l]=n[l]||Dw(e[l],e);c=u(r,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return i}function xM(t,{moduleParameters:e,target:n,viewport:i}){const r=n&&n.id!=="default-framebuffer",s=e&&e.devicePixelRatio||Ur(t),o=r?n.height:t.drawingBufferHeight,a=i;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function TM(t,e){const n=e?e.width:t.drawingBufferWidth,i=e?e.height:t.drawingBufferHeight;Tn(t,{viewport:[0,0,n,i]}),t.clear(16640)}class SM extends yg{constructor(e,n){super(e,n),g(this,"shadowMap",void 0),g(this,"depthBuffer",void 0),g(this,"fbo",void 0),this.shadowMap=new gt(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new yr(e,{format:33189,width:1,height:1}),this.fbo=new Pe(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const n=this.fbo;Ut(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],r=Ur(this.gl),s=i.width*r,o=i.height*r;(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const zw="#define SMOOTH_EDGE_RADIUS 0.5",bM=`
`.concat(zw,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),PM=`
`.concat(zw,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),AM={name:"geometry",vs:bM,fs:PM},LM=Object.keys(K).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(K[t],";")).join(""),CM=Object.keys(kt).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(kt[t],";")).join(""),IM=Object.keys(ki).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(ki[t],";")).join(""),MM="".concat(LM,`
`).concat(CM,`
`).concat(IM,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function RM(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Vo(t){let e={},n;return i=>{for(const r in i)if(!RM(i[r],e[r])){n=t(i),e=i;break}return n}}const D0=[0,0,0,0],OM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Bw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],kM=[0,0,0],Uw=[0,0,0],NM=Vo(zM);function Vw(t,e,n=Uw){n.length<3&&(n=[n[0],n[1],0]);let i=n,r,s=!0;switch(e===K.LNGLAT_OFFSETS||e===K.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case kt.WEB_MERCATOR:(e===K.LNGLAT||e===K.CARTESIAN)&&(r=[0,0,0],s=!1);break;case kt.WEB_MERCATOR_AUTO_OFFSET:e===K.LNGLAT?i=r:e===K.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case kt.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case kt.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:s}}function FM(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=D0,l=D0,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:f,offsetMode:h}=Vw(t,e,n);return h&&(l=t.projectPosition(u||f),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=ns([],l,o),s=i||s,o=Li([],r,s),o=Li([],o,OM)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:u}}function DM({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=K.DEFAULT,coordinateOrigin:r=Uw,autoWrapLongitude:s=!1}){i===K.DEFAULT&&(i=t.isGeospatial?K.LNGLAT:K.CARTESIAN);const o=NM({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||Bw,o}function zM({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=FM(t,n,i),u=t.getDistanceScales(),f=[t.width*e,t.height*e],h=ns([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,d={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:r,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:f,project_uDevicePixelRatio:e,project_uFocalDistance:h,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:kM,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:Bw,project_uCameraPosition:a};if(c){const p=t.getDistanceScales(c);switch(n){case K.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=p.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case K.LNGLAT:case K.LNGLAT_OFFSETS:t._pseudoMeters||(d.project_uCommonUnitsPerMeter=p.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=p.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case K.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break}}return d}const BM={};function UM(t=BM){return"viewport"in t?DM(t):{}}const vg={name:"project",dependencies:[a3,AM],vs:MM,getUniforms:UM};function VM(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ir(t,e){const n=ns([],e,t);return pg(n,n,1/n[3]),n}function z0(t,e){const n=t%e;return n<0?e+n:n}function Mh(t,e,n){return t<e?e:t>n?n:t}function jM(t){return Math.log(t)*Math.LOG2E}const _g=Math.log2||jM;function Sn(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Nt=Math.PI,jw=Nt/4,St=Nt/180,Rh=180/Nt,Wr=512,tc=4003e4,Ra=85.051129,GM=1.5;function WM(t){return _g(t)}function Hr(t){const[e,n]=t;Sn(Number.isFinite(e)),Sn(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*St,r=n*St,s=Wr*(i+Nt)/(2*Nt),o=Wr*(Nt+Math.log(Math.tan(jw+r*.5)))/(2*Nt);return[s,o]}function $r(t){const[e,n]=t,i=e/Wr*(2*Nt)-Nt,r=2*(Math.atan(Math.exp(n/Wr*(2*Nt)-Nt))-jw);return[i*Rh,r*Rh]}function HM(t){const{latitude:e}=t;Sn(Number.isFinite(e));const n=Math.cos(e*St);return WM(tc*n)-9}function qu(t){const e=Math.cos(t*St);return Wr/tc/e}function Oh(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;Sn(Number.isFinite(e)&&Number.isFinite(n));const r=Wr,s=Math.cos(e*St),o=r/360,a=o/s,l=r/tc/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(i){const u=St*Math.tan(e*St)/s,f=o*u/2,h=r/tc*u,d=h/a*l;c.unitsPerDegree2=[0,f,h],c.unitsPerMeter2=[d,0,d]}return c}function Gw(t,e){const[n,i,r]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Oh({longitude:n,latitude:i,highPrecision:!0}),u=Hr(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const f=$r(u),h=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[f[0],f[1],h]:f}function $M(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:s,center:o}=t,a=VM();Jl(a,a,[0,0,-r]),Cw(a,a,-n*St),Iw(a,a,i*St);const l=s/e;return gg(a,a,[l,l,l]),o&&Jl(a,a,S3([],o)),a}function XM(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=nc(GM)}=t;i!==void 0&&(u=nc(i));const f=u*St,h=r*St,d=Ww(u);let p=d;o&&(p+=o[2]*a/Math.cos(h)/n);const _=f*(.5+(s?s[1]:0)/n),x=Math.sin(_)*p/Math.sin(Mh(Math.PI/2-h-_,.01,Math.PI-.01)),y=Math.sin(h)*x+p,m=p*10,w=Math.min(y*c,m);return{fov:f,aspect:e/n,focalDistance:d,near:l,far:w}}function nc(t){return 2*Math.atan(.5/t)*Rh}function Ww(t){return .5/Math.tan(.5*t*St)}function Hw(t,e){const[n,i,r=0]=t;return Sn(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),Ir(e,[n,i,r,1])}function wg(t,e,n=0){const[i,r,s]=t;if(Sn(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return Ir(e,[i,r,s,1]);const o=Ir(e,[i,r,0,1]),a=Ir(e,[i,r,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return _w([],o,a,u)}function YM(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=i,f=ZM(t.padding),h=Hr([a,Mh(u,-Ra,Ra)]),d=Hr([c,Mh(l,-Ra,Ra)]),p=[Math.max(Math.abs(d[0]-h[0]),r),Math.max(Math.abs(d[1]-h[1]),r)],_=[e-f.left-f.right-Math.abs(o[0])*2,n-f.top-f.bottom-Math.abs(o[1])*2];Sn(_[0]>0&&_[1]>0);const x=_[0]/p[0],y=_[1]/p[1],m=(f.right-f.left)/2/x,w=(f.top-f.bottom)/2/y,T=[(d[0]+h[0])/2+m,(d[1]+h[1])/2+w],b=$r(T),P=Math.min(s,_g(Math.abs(Math.min(x,y))));return Sn(Number.isFinite(P)),{longitude:b[0],latitude:b[1],zoom:P}}function ZM(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Sn(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const B0=Math.PI/180;function qM(t,e=0){const{width:n,height:i,unproject:r}=t,s={targetZ:e},o=r([0,i],s),a=r([n,i],s);let l,c;const u=t.fovy?.5*t.fovy*B0:Math.atan(.5/t.altitude),f=(90-t.pitch)*B0;return u>f-.01?(l=U0(t,0,e),c=U0(t,n,e)):(l=r([0,0],s),c=r([n,0],s)),[o,a,c,l]}function U0(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=Ir(i,[e,0,1,1]),s=Ir(i,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),l=_w([],r,s,a),c=$r(l);return c.push(n),c}const V0=512;function KM(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=t;(r<-180||r>180)&&(r=z0(r+180,360)-180),(a<-180||a>180)&&(a=z0(a+180,360)-180);const l=_g(n/V0);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=$r([0,c])[1];if(s<u)s=u;else{const f=$r([0,V0-c])[1];s>f&&(s=f)}}return{width:e,height:n,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}const QM=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,JM=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,eR=Vo(sR),tR=Vo(oR),nR=[0,0,0,1],iR=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function rR(t,e){const[n,i,r]=t,s=wg([n,i,r],e);return Number.isFinite(r)?s:[s[0],s[1],0]}function sR({viewport:t,center:e}){return new qe(t.viewProjectionMatrix).invert().transform(e)}function oR({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,s=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>rR(o,i));for(const o of e){const a=o.clone().translate(new D(t.center).negate()),l=s.map(u=>a.transform(u)),c=new qe().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function aR(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||nR,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=eR({viewport:t.viewport,center:e.project_uCenter}),s=[],o=tR({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],c=l.clone().translate(new D(t.viewport.center).negate());e.project_uCoordinateSystem===K.LNGLAT&&e.project_uProjectionMode===kt.WEB_MERCATOR?(o[a]=c,s[a]=r):(o[a]=l.clone().multiplyRight(iR),s[a]=c.transform(r))}for(let a=0;a<o.length;a++)i["shadow_uViewProjectionMatrices[".concat(a,"]")]=o[a],i["shadow_uProjectCenters[".concat(a,"]")]=s[a],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(a)]=t.shadowMaps[a]:i["shadow_uShadowMap".concat(a)]=t.dummyShadowMap;return i}const Ku={name:"shadow",dependencies:[vg],vs:QM,fs:JM,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?aR(t,e):{}},lR={color:[255,255,255],intensity:1},j0=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],cR=[0,0,0,200/255];class $w{constructor(e={}){g(this,"id","lighting-effect"),g(this,"props",void 0),g(this,"shadowColor",cR),g(this,"shadow",void 0),g(this,"ambientLight",void 0),g(this,"directionalLights",void 0),g(this,"pointLights",void 0),g(this,"shadowPasses",[]),g(this,"shadowMaps",[]),g(this,"dummyShadowMap",null),g(this,"programManager",void 0),g(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Bo.getDefaultProgramManager(e),Ku&&this.programManager.addDefaultModule(Ku)),this.dummyShadowMap||(this.dummyShadowMap=new gt(e,{width:1,height:1}));for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o,moduleParameters:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Ku),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new qe().lookAt({eye:new D(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new SM(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new mM(lR),this.directionalLights.push(new F0(j0[0]),new F0(j0[1])))}}class uR{constructor(e={}){g(this,"_pool",[]),g(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:r,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=r||e&&e.constructor||Float32Array,u=n*i+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let f=1/0;l&&(f=l*i+s);const h=this._allocate(c,u,a,f);return e&&o?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,n,i,r){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>r&&(s=r);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return i&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:r}=i,s=n.findIndex(o=>o.byteLength>=r);s<0?n.push(i):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,i),n.length>this.opts.poolSize&&n.shift()}}const Xr=new uR;function ks(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fR(t){return[t[12],t[13],t[14]]}function hR(t){return{left:er(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:er(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:er(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:er(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:er(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:er(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const G0=new D;function er(t,e,n,i){G0.set(t,e,n);const r=G0.len();return{distance:i/r,normal:new D(-t/r,-e/r,-n/r)}}function dR(t){return t-Math.fround(t)}let Ss;function Qu(t,e){const{size:n=1,startIndex:i=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,s=(r-i)/n;Ss=Xr.allocate(Ss,s,{type:Float32Array,size:n*2});let o=i,a=0;for(;o<r;){for(let l=0;l<n;l++){const c=t[o++];Ss[a+l]=c,Ss[a+l+n]=dR(c)}a+=n*2}return Ss.subarray(0,s*n*2)}function gR(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const pR=Math.PI/180,mR=ks(),W0=[0,0,0],yR={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function vR({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:s,near:o,far:a}){const l=t/e,c=n?new qe().orthographic({fovy:i,aspect:l,focalDistance:r,near:o,far:a}):new qe().perspective({fovy:i,aspect:l,near:o,far:a});if(s){const{left:u=0,right:f=0,top:h=0,bottom:d=0}=s,p=Hn((u+t-f)/2,0,t)-t/2,_=Hn((h+e-d)/2,0,e)-e/2;c[8]-=p*2/t,c[9]+=_*2/e}return c}class Wi{constructor(e={}){g(this,"id",void 0),g(this,"x",void 0),g(this,"y",void 0),g(this,"width",void 0),g(this,"height",void 0),g(this,"padding",void 0),g(this,"isGeospatial",void 0),g(this,"zoom",void 0),g(this,"focalDistance",void 0),g(this,"position",void 0),g(this,"modelMatrix",void 0),g(this,"distanceScales",void 0),g(this,"scale",void 0),g(this,"center",void 0),g(this,"cameraPosition",void 0),g(this,"projectionMatrix",void 0),g(this,"viewMatrix",void 0),g(this,"viewMatrixUncentered",void 0),g(this,"viewMatrixInverse",void 0),g(this,"viewProjectionMatrix",void 0),g(this,"pixelProjectionMatrix",void 0),g(this,"pixelUnprojectionMatrix",void 0),g(this,"resolution",void 0),g(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||yR,this.focalDistance=e.focalDistance||1,this.position=e.position||W0,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?kt.WEB_MERCATOR:kt.WEB_MERCATOR_AUTO_OFFSET:kt.IDENTITY}equals(e){return e instanceof Wi?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&yn(e.projectionMatrix,this.projectionMatrix)&&yn(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),r=Hw(i,this.pixelProjectionMatrix),[s,o]=r,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,r[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,l=i&&i*this.distanceScales.unitsPerMeter[2],c=wg([r,a,o],this.pixelUnprojectionMatrix,l),[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(i)?[u,f,i]:[u,f]}projectPosition(e){const[n,i]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,r]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,r]}projectFlat(e){if(this.isGeospatial){const n=Hr(e);return n[1]=Hn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?$r(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),r=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(i[0],r[0],s[0],o[0]),Math.min(i[1],r[1],s[1],o[1]),Math.max(i[0],r[0],s[0],o[0]),Math.max(i[1],r[1],s[1],o[1])]}getDistanceScales(e){return e?Oh({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,hR(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=HM({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Oh({latitude:i,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:o}=e;let a=W0;if(s&&(a=o?new qe(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,i,0]);this.center=new D(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=mR,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new qe().multiplyRight(n).translate(new D(this.center).negate()),this.projectionMatrix=i||vR({width:this.width,height:this.height,orthographic:r,fovyRadians:s||o*pR,focalDistance:u,padding:c,near:a,far:l});const f=ks();Li(f,f,this.projectionMatrix),Li(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=Ch([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=fR(this.viewMatrixInverse);const h=ks(),d=ks();gg(h,h,[this.width/2,-this.height/2,1]),Jl(h,h,[1,-1,0]),Li(d,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=Ch(ks(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||$.warn("Pixel project matrix not invertible")()}}g(Wi,"displayName","Viewport");class ai extends Wi{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,orthographic:c=!1,projectionMatrix:u,repeat:f=!1,worldOffset:h=0,position:d,padding:p,legacyMeterSizes:_=!1}=e;let{width:x,height:y,altitude:m=1.5}=e;const w=Math.pow(2,r);x=x||1,y=y||1;let T,b=null;if(u)m=u[5]/2,T=nc(m);else{e.fovy?(T=e.fovy,m=Ww(T)):T=nc(m);let L;if(p){const{top:C=0,bottom:M=0}=p;L=[0,Hn((C+y-M)/2,0,y)-y/2]}b=XM({width:x,height:y,scale:w,center:d&&[0,0,d[2]*qu(n)],offset:L,pitch:s,fovy:T,nearZMultiplier:a,farZMultiplier:l})}let P=$M({height:y,pitch:s,bearing:o,scale:w,altitude:m});h&&(P=new qe().translate([512*h,0,0]).multiplyLeft(P)),super({...e,width:x,height:y,viewMatrix:P,longitude:i,latitude:n,zoom:r,...b,fovy:T,focalDistance:m}),g(this,"longitude",void 0),g(this,"latitude",void 0),g(this,"pitch",void 0),g(this,"bearing",void 0),g(this,"altitude",void 0),g(this,"fovy",void 0),g(this,"orthographic",void 0),g(this,"_subViewports",void 0),g(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=s,this.bearing=o,this.altitude=m,this.fovy=T,this.orthographic=c,this._subViewports=f?[]:null,this._pseudoMeters=_,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=n;r<=i;r++){const s=r?new ai({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),r=(e[2]||0)*qu(e[1]);return[n,i,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),r=(e[2]||0)/qu(i);return[n,i,r]}addMetersToLngLat(e,n){return Gw(e,n)}panByPosition(e,n){const i=wg(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=S0([],r,p3([],i)),o=S0([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=qM(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:r}=this,{longitude:s,latitude:o,zoom:a}=YM({width:i,height:r,bounds:e,...n});return new ai({width:i,height:r,longitude:s,latitude:o,zoom:a})}}g(ai,"displayName","WebMercatorViewport");const H0=[0,0,0];function Ju(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof ai){const[r,s,o=0]=t,a=e.getDistanceScales([r,s]);i[2]=o*a.unitsPerMeter[2]}return i}function _R(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return r===K.DEFAULT&&(r=e.isGeospatial?K.LNGLAT:K.CARTESIAN),s===void 0&&(s=r),o===void 0&&(o=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function Xw(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=ns([],[o,a,l,1],n)),i){case K.LNGLAT:return Ju([o,a,l],e,s);case K.LNGLAT_OFFSETS:return Ju([o+r[0],a+r[1],l+(r[2]||0)],e,s);case K.METER_OFFSETS:return Ju(Gw(r,[o,a,l]),e,s);case K.CARTESIAN:default:return e.isGeospatial?[o+r[0],a+r[1],l+r[2]]:e.projectPosition([o,a,l])}}function wR(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=_R(e),{autoOffset:l=!0}=e,{geospatialOrigin:c=H0,shaderCoordinateOrigin:u=H0,offsetMode:f=!1}=l?Vw(n,i,r):{},h=Xw(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:f});if(f){const d=n.projectPosition(c||u);Pw(h,h,d)}return h}const $0={blendFunc:[1,0,32771,0],blendEquation:32774};class Yw extends yg{constructor(...e){super(...e),g(this,"pickZ",void 0),g(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:f,effects:h,pass:d="picking",pickZ:p,moduleParameters:_}){const x=this.gl;this.pickZ=p;const y=this._resetColorEncoder(p),m=Ut(x,{scissorTest:!0,scissor:[a,l,c,u],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...$0,blend:!p},()=>super.render({target:o,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,cullRect:f,effects:h==null?void 0:h.filter(T=>T.useInPicking),pass:d,isPicking:!0,moduleParameters:_}));return this._colorEncoderState=null,{decodePickingColor:y&&xR.bind(null,y),stats:m}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const r={...e.props.parameters},{pickable:s,operation:o}=e.props;return this._colorEncoderState?s&&o.includes("draw")&&(Object.assign(r,$0),r.blend=!0,r.blendColor=ER(this._colorEncoderState,e,i)):r.blend=!1,o.includes("terrain")&&(r.blend=!1),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function ER(t,e,n){const{byLayer:i,byAlpha:r}=t;let s,o=i.get(e);return o?(o.viewports.push(n),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},i.set(e,o),r[s]=o):($.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function xR(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const rr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},ic=Symbol.for("component"),ii=Symbol.for("propTypes"),ef=Symbol.for("deprecatedProps"),Mr=Symbol.for("asyncPropDefaults"),zi=Symbol.for("asyncPropOriginal"),$n=Symbol.for("asyncPropResolved");function kc(t,e=()=>!0){return Array.isArray(t)?Zw(t,e,[]):e(t)?[t]:[]}function Zw(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?Zw(r,e,n):e(r)&&n.push(r)}return n}function TR({target:t,source:e,start:n=0,count:i=1}){const r=e.length,s=i*r;let o=0;for(let a=n;o<r;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class SR{constructor(e,n,i){g(this,"id",void 0),g(this,"context",void 0),g(this,"isLoaded",void 0),g(this,"persistent",void 0),g(this,"_loadCount",0),g(this,"_subscribers",new Set),g(this,"_data",void 0),g(this,"_loader",void 0),g(this,"_error",void 0),g(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let r=e;typeof e=="string"&&(r=ql(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class bR{constructor({gl:e,protocol:n}){g(this,"protocol",void 0),g(this,"_context",void 0),g(this,"_resources",void 0),g(this,"_consumers",void 0),g(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}){let s=this._resources[e];s?s.setData(n,i):(s=new SR(e,n,this._context),this._resources[e]=s),s.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const r=n[i],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:r="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(i,r,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,r){const s=this._consumers,o=s[e]=s[e]||{},a=o[n]||{},l=a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),i&&(o[n]=a,a.onChange=r,a.resourceId=i.id,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const PR=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,jo={name:"project32",dependencies:[vg],vs:PR},Go={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...DI},AR=[vg],LR=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function CR(t){const e=Bo.getDefaultProgramManager(t);for(const n of AR)e.addDefaultModule(n);for(const n of LR)e.addShaderHook(n);return e}const IR="layerManager.setLayers",MR="layerManager.activateViewport";class RR{constructor(e,{deck:n,stats:i,viewport:r,timeline:s}={}){g(this,"layers",void 0),g(this,"context",void 0),g(this,"resourceManager",void 0),g(this,"_lastRenderedLayers",[]),g(this,"_needsRedraw",!1),g(this,"_needsUpdate",!1),g(this,"_nextLayers",null),g(this,"_debug",!1),g(this,"activateViewport",o=>{Ue(MR,this,o),o&&(this.context.viewport=o)}),this.layers=[],this.resourceManager=new bR({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&CR(e),stats:i||new Cc({id:"deck.gl"}),viewport:r||new Wi({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new Fw,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Ue(IR,this,n,e),this._lastRenderedLayers=e;const i=kc(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const o of e)i[o.id]?$.warn("Multiple old layers with same id ".concat(o.id))():i[o.id]=o;const r=[];this._updateSublayersRecursively(n,i,r),this._finalizeOldLayers(i);let s=!1;for(const o of r)if(o.hasUniformTransition()){s="Uniform transition in ".concat(o);break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(e,n,i){for(const r of e){r.context=this.context;const s=n[r.id];s===null&&$.warn("Multiple new layers with same id ".concat(r.id))(),n[r.id]=null;let o=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),o=r.isComposite?r.getSubLayers():null}catch(a){this._handleError("matching",a,r)}o&&this._updateSublayersRecursively(o,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=rr.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=rr.MATCHED,n!==e&&(e.lifecycle=rr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=rr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=rr.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Ft(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Ft(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(const s of i)if(!e.hasOwnProperty(s)||!Ft(t[s],e[s],n-1))return!1;return!0}return!1}class OR{constructor(e){g(this,"width",void 0),g(this,"height",void 0),g(this,"views",void 0),g(this,"viewState",void 0),g(this,"controllers",void 0),g(this,"timeline",void 0),g(this,"_viewports",void 0),g(this,"_viewportMap",void 0),g(this,"_isUpdating",void 0),g(this,"_needsRedraw",void 0),g(this,"_needsUpdate",void 0),g(this,"_eventManager",void 0),g(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){const o=i[s];if(o.containsPixel(r)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=kc(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Ft(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):$.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))===null||o===void 0?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,i,r){const s=e.controller;if(s){const o={...n,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return r||(r=this._createController(e,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const s=e[r],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=!!s.controller;c&&!l&&(i=!0),(i||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),this._viewports.unshift(a)}for(const r in n){const s=n[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,r)=>!e[r].equals(n[r]))}}const kR=/([0-9]+\.?[0-9]*)(%|px)/;function kn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=kR.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function Nn(t,e){return t.relative?Math.round(t.position*e):t.position}function Ce(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Yr{constructor(e){g(this,"id",void 0),g(this,"viewportInstance",void 0),g(this,"_x",void 0),g(this,"_y",void 0),g(this,"_width",void 0),g(this,"_height",void 0),g(this,"_padding",void 0),g(this,"props",void 0);const{id:n,x:i=0,y:r=0,width:s="100%",height:o="100%",padding:a=null,viewportInstance:l}=e||{};Ce(!l||l instanceof Wi),this.viewportInstance=l,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=kn(i),this._y=kn(r),this._width=kn(s),this._height=kn(o),this._padding=a&&{left:kn(a.left||0),right:kn(a.right||0),top:kn(a.top||0),bottom:kn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Ft(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});return new this.ViewportType({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:Nn(this._x,e),y:Nn(this._y,n),width:Nn(this._width,e),height:Nn(this._height,n)};return this._padding&&(i.padding={left:Nn(this._padding.left,e),top:Nn(this._padding.top,n),right:Nn(this._padding.right,e),bottom:Nn(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Wo{constructor(e){g(this,"_inProgress",void 0),g(this,"_handle",void 0),g(this,"_timeline",void 0),g(this,"time",void 0),g(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:r}=this;this._handle=i.addChannel({delay:i.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const X0=()=>{},kh={BREAK:1,SNAP_TO_END:2,IGNORE:3},NR=t=>t,FR=kh.BREAK;class DR{constructor(e){g(this,"getControllerState",void 0),g(this,"props",void 0),g(this,"propsInTransition",void 0),g(this,"transition",void 0),g(this,"onViewStateChange",void 0),g(this,"onStateChange",void 0),g(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:r,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(i/a),u=r.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Wo(e.timeline),this.onViewStateChange=e.onViewStateChange||X0,this.onStateChange=e.onStateChange||X0}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;r={...i,...s===kh.SNAP_TO_END?o:this.propsInTransition||i}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===kh.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(i),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,r);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||NR,interpolator:s,interruption:n.transitionInterruption||FR,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class zR{constructor(e){g(this,"_propsToCompare",void 0),g(this,"_propsToExtract",void 0),g(this,"_requiredProps",void 0);const{compare:n,extract:i,required:r}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=r}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!yn(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},r={};for(const s of this._propsToExtract)(s in e||s in n)&&(i[s]=e[s],r[s]=n[s]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];Ce(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const BR=["longitude","latitude","zoom","bearing","pitch"],UR=["longitude","latitude","zoom"];class qw extends zR{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:BR,required:UR},super(i.transitionProps),g(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:r,around:s}=this.opts;if(r&&s){const o=r(e),a=r(n),l=o.unproject(s);i.start.around=s,Object.assign(i.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const r={};for(const s of this._propsToExtract)r[s]=Gr(e[s]||0,n[s]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...r});Object.assign(r,s.panByPosition(n.aroundPosition,Gr(e.around,n.around,i)))}return r}}const Fn={transitionDuration:0},VR=300,Oa=t=>1-(1-t)*(1-t),tr={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},mi={};class jR{constructor(e){g(this,"props",void 0),g(this,"state",{}),g(this,"transitionManager",void 0),g(this,"eventManager",void 0),g(this,"onViewStateChange",void 0),g(this,"onStateChange",void 0),g(this,"makeViewport",void 0),g(this,"_controllerState",void 0),g(this,"_events",{}),g(this,"_interactionState",{isDragging:!1}),g(this,"_customEvents",[]),g(this,"_eventStartBlocked",null),g(this,"_panMove",!1),g(this,"invertPan",!1),g(this,"dragMode","rotate"),g(this,"inertia",0),g(this,"scrollZoom",!0),g(this,"dragPan",!0),g(this,"dragRotate",!0),g(this,"doubleClickZoom",!0),g(this,"touchZoom",!0),g(this,"touchRotate",!1),g(this,"keyboard",!0),this.transitionManager=new DR({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-i]}isPointInBounds(e,n){const{width:i,height:r}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?VR:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(tr.WHEEL,u&&i),this.toggleEvents(tr.PAN,u&&(r||s)),this.toggleEvents(tr.PINCH,u&&(a||l)),this.toggleEvents(tr.TRIPLE_PAN,u&&l),this.toggleEvents(tr.DOUBLE_TAP,u&&o),this.toggleEvents(tr.KEYBOARD,u&&c),this.scrollZoom=i,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const r={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(r,Fn,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,Fn,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Oa},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Fn,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Oa},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*i)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,Fn,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Fn,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Oa},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return mi._startPinchRotation=e.rotation,mi._lastPinchEvent=e,this.updateViewport(i,Fn,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:mi._startPinchRotation-i})}return this.updateViewport(n,Fn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),mi._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=mi;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const r=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:r,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:Oa},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return mi._startPinchRotation=null,mi._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(i).zoomOut(i):a.zoomOut(i),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(i).zoomIn(i):a.zoomIn(i),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(r),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(r),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(r),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(r),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Fn:e?{...n,transitionInterpolator:new qw({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class GR{constructor(e,n){g(this,"_viewportProps",void 0),g(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Y0=5,WR=1.2;class HR extends GR{constructor(e){const{width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:_,startZoomLngLat:x,startRotatePos:y,startBearing:m,startPitch:w,startZoom:T,normalize:b=!0}=e;Ce(Number.isFinite(s)),Ce(Number.isFinite(r)),Ce(Number.isFinite(o)),super({width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:f,minZoom:h,maxPitch:d,minPitch:p,normalize:b,position:u},{startPanLngLat:_,startZoomLngLat:x,startRotatePos:y,startBearing:m,startPitch:w,startZoom:T}),g(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:o}=this.getState();if(!r||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,r,o,s):a={bearing:s+n,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=r+Math.log2(i);l=Hn(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(s-n.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=Hn(r,i,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=Hn(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,KM(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,r){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),f=s/c;let h=0;o>0?Math.abs(u-l)>Y0&&(h=o/(l-u)*WR):o<0&&l>Y0&&(h=1-a/l),h=Hn(h,-1,1);const{minPitch:d,maxPitch:p}=this.getViewportProps(),_=r+180*f;let x=i;return h>0?x=i+h*(p-i):h<0&&(x=i-h*(d-i)),{pitch:x,bearing:_}}}class $R extends jR{constructor(...e){super(...e),g(this,"ControllerState",HR),g(this,"transition",{transitionDuration:300,transitionInterpolator:new qw({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),g(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Kw extends Yr{get ViewportType(){return ai}get ControllerType(){return $R}}g(Kw,"displayName","MapView");const XR=new $w;function YR(t,e){var n,i;const r=(n=t.order)!==null&&n!==void 0?n:1/0,s=(i=e.order)!==null&&i!==void 0?i:1/0;return r-s}class ZR{constructor(){g(this,"effects",void 0),g(this,"_resolvedEffects",[]),g(this,"_defaultEffects",[]),g(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(r=>YR(r,e)>0);i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Ft(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const r of this.effects)n[r.id]=r;const i=[];for(const r of e){const s=n[r.id];s&&s!==r?s.setProps?(s.setProps(r.props),i.push(s)):(s.cleanup(),i.push(r)):i.push(r),delete n[r.id]}for(const r in n)n[r].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(r=>r instanceof $w)||this._resolvedEffects.push(XR),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class qR extends yg{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const KR="deckRenderer.renderLayers";class QR{constructor(e){g(this,"gl",void 0),g(this,"layerFilter",void 0),g(this,"drawPickingColors",void 0),g(this,"drawLayersPass",void 0),g(this,"pickLayersPass",void 0),g(this,"renderCount",void 0),g(this,"_needsRedraw",void 0),g(this,"renderBuffers",void 0),g(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new qR(e),this.pickLayersPass=new Yw(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||Pe.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const r=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,s=n.render({...i,target:r});i.effects&&this._postRender(i.effects,i),this.renderCount++,Ue(KR,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(this.gl,n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Pe(this.gl),new Pe(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,r={...n,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const s of e)if(s.postRender){if(s.id===this.lastPostProcessEffect){r.target=n.target,s.postRender(this.gl,r);break}const o=s.postRender(this.gl,r);r.inputBuffer=o,r.swapBuffer=o===i[0]?i[1]:i[0]}}}const JR={pickedColor:null,pickedObjectIndex:-1};function eO({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=r*r,f=-1,h=0;for(let d=0;d<c;d++){const p=d+a-i,_=p*p;if(_>u)h+=4*l;else for(let x=0;x<l;x++){if(t[h+3]-1>=0){const m=x+o-n,w=m*m+_;w<=u&&(u=w,f=h)}h+=4}}if(f>=0){const d=t.slice(f,f+4),p=e(d);if(p){const _=Math.floor(f/4/l),x=f/4-_*l;return{...p,pickedColor:d,pickedX:o+x,pickedY:a+_}}$.error("Picked non-existent layer. Is picking buffer corrupt?")()}return JR}function tO({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const s=t.slice(i,i+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):$.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function Qw({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:s}){let o=e[0];e.length>1&&(o=iO((t==null?void 0:t.pickedViewports)||e,{x:i,y:r}));let a;if(o){const l=[i-o.x,r-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function nO(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(i==="hover"){const f=n.index,h=n.layerId,d=o?o.props.id:null;if(d!==h||a!==f){if(d!==h){const p=r.find(_=>_.props.id===h);p&&l.unshift(p)}n.layerId=d,n.index=a,n.info=null}}const c=Qw(t),u=new Map;return u.set(null,c),l.forEach(f=>{let h={...c};f===o&&(h.color=s,h.index=a,h.picked=!0),h=Jw({layer:f,info:h,mode:i});const d=h.layer;f===o&&i==="hover"&&(n.info=h),u.set(d.id,h),i==="hover"&&d.updateAutoHighlight(h)}),u}function Jw({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function iO(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class rO{constructor(e){g(this,"gl",void 0),g(this,"pickingFBO",void 0),g(this,"depthFBO",void 0),g(this,"pickLayersPass",void 0),g(this,"layerFilter",void 0),g(this,"lastPickedInfo",void 0),g(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new Yw(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:r},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?i.find(h=>h.id===o):null,c=a&&r.find(h=>h.id===a)||r[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new Pe(i),Pe.isSupported(i,{colorBufferFloat:!0}))){const r=new Pe(i);r.attach({[36064]:new gt(i,{format:Y(i)?34836:6408,type:5126})}),this.depthFBO=r}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:r,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){const h=this._getPickable(e),d=Ur(this.gl);if(!h)return{result:[],emptyInfo:Qw({viewports:i,x:r,y:s,pixelRatio:d})};this._resizeBuffer();const p=Fu(this.gl,[r,s],!0),_=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],x=Math.round(o*d),{width:y,height:m}=this.pickingFBO,w=this._getPickingRect({deviceX:_[0],deviceY:_[1],deviceRadius:x,deviceWidth:y,deviceHeight:m}),T={x:r-o,y:s-o,width:o*2+1,height:o*2+1};let b;const P=[],L=new Set;for(let C=0;C<a;C++){let M;if(w){const V=this._drawAndSample({layers:h,views:n,viewports:i,onViewportActive:u,deviceRect:w,cullRect:T,effects:f,pass:"picking:".concat(l)});M=eO({...V,deviceX:_[0],deviceY:_[1],deviceRadius:x,deviceRect:w})}else M={pickedColor:null,pickedObjectIndex:-1};let R;if(M.pickedLayer&&c&&this.depthFBO){const{pickedColors:V}=this._drawAndSample({layers:[M.pickedLayer],views:n,viewports:i,onViewportActive:u,deviceRect:{x:M.pickedX,y:M.pickedY,width:1,height:1},cullRect:T,effects:f,pass:"picking:".concat(l,":z")},!0);V[3]&&(R=V[0])}M.pickedLayer&&C+1<a&&(L.add(M.pickedLayer),M.pickedLayer.disablePickingIndex(M.pickedObjectIndex)),b=nO({pickInfo:M,lastPickedInfo:this.lastPickedInfo,mode:l,layers:h,viewports:i,x:r,y:s,z:R,pixelRatio:d});for(const V of b.values())V.layer&&P.push(V);if(!M.pickedColor)break}for(const C of L)C.restorePickingColors();return{result:P,emptyInfo:b.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:r,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){const h=this._getPickable(e);if(!h)return[];this._resizeBuffer();const d=Ur(this.gl),p=Fu(this.gl,[r,s],!0),_=p.x,x=p.y+p.height,y=Fu(this.gl,[r+o,s+a],!0),m=y.x+y.width,w=y.y,T={x:_,y:w,width:m-_,height:x-w},b=this._drawAndSample({layers:h,views:n,viewports:i,onViewportActive:u,deviceRect:T,cullRect:{x:r,y:s,width:o,height:a},effects:f,pass:"picking:".concat(l)}),P=tO(b),L=new Map,C=Number.isFinite(c);for(let M=0;M<P.length&&!(C&&c&&L.size>=c);M++){const R=P[M];let V={color:R.pickedColor,layer:null,index:R.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:d};V=Jw({layer:R.pickedLayer,info:V,mode:l}),L.has(V.object)||L.set(V.object,V)}return Array.from(L.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,f={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c,preRenderStats:{}};for(const m of a)m.useInPicking&&(f.preRenderStats[m.id]=m.preRender(this.gl,f));const{decodePickingColor:h}=this.pickLayersPass.render(f),{x:d,y:p,width:_,height:x}=s,y=new(c?Float32Array:Uint8Array)(_*x*4);return Oc(u,{sourceX:d,sourceY:p,sourceWidth:_,sourceHeight:x,target:y}),{pickedColors:y,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:s}){const o=Math.max(0,e-i),a=Math.max(0,n-i),l=Math.min(r,e+i+1)-o,c=Math.min(s,n+i+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const sO={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class oO{constructor(e){g(this,"el",null),g(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,sO),n.appendChild(this.el))}setTooltip(e,n,i){const r=this.el;if(r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className),Object.assign(r.style,e.style);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform="translate(".concat(n,"px, ").concat(i,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var Bi={},aO={get exports(){return Bi},set exports(t){Bi=t}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,r){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,u=Date.now;function f(v,E,S){return setTimeout(w(v,S),E)}function h(v,E,S){return Array.isArray(v)?(d(v,S[E],S),!0):!1}function d(v,E,S){var A;if(v)if(v.forEach)v.forEach(E,S);else if(v.length!==r)for(A=0;A<v.length;)E.call(S,v[A],A,v),A++;else for(A in v)v.hasOwnProperty(A)&&E.call(S,v[A],A,v)}function p(v,E,S){var A="DEPRECATED METHOD: "+E+`
`+S+` AT 
`;return function(){var I=new Error("get-stack-trace"),F=I&&I.stack?I.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",X=e.console&&(e.console.warn||e.console.log);return X&&X.call(e.console,A,F),v.apply(this,arguments)}}var _;typeof Object.assign!="function"?_=function(E){if(E===r||E===null)throw new TypeError("Cannot convert undefined or null to object");for(var S=Object(E),A=1;A<arguments.length;A++){var I=arguments[A];if(I!==r&&I!==null)for(var F in I)I.hasOwnProperty(F)&&(S[F]=I[F])}return S}:_=Object.assign;var x=p(function(E,S,A){for(var I=Object.keys(S),F=0;F<I.length;)(!A||A&&E[I[F]]===r)&&(E[I[F]]=S[I[F]]),F++;return E},"extend","Use `assign`."),y=p(function(E,S){return x(E,S,!0)},"merge","Use `assign`.");function m(v,E,S){var A=E.prototype,I;I=v.prototype=Object.create(A),I.constructor=v,I._super=A,S&&_(I,S)}function w(v,E){return function(){return v.apply(E,arguments)}}function T(v,E){return typeof v==a?v.apply(E&&E[0]||r,E):v}function b(v,E){return v===r?E:v}function P(v,E,S){d(R(E),function(A){v.addEventListener(A,S,!1)})}function L(v,E,S){d(R(E),function(A){v.removeEventListener(A,S,!1)})}function C(v,E){for(;v;){if(v==E)return!0;v=v.parentNode}return!1}function M(v,E){return v.indexOf(E)>-1}function R(v){return v.trim().split(/\s+/g)}function V(v,E,S){if(v.indexOf&&!S)return v.indexOf(E);for(var A=0;A<v.length;){if(S&&v[A][S]==E||!S&&v[A]===E)return A;A++}return-1}function W(v){return Array.prototype.slice.call(v,0)}function G(v,E,S){for(var A=[],I=[],F=0;F<v.length;){var X=E?v[F][E]:v[F];V(I,X)<0&&A.push(v[F]),I[F]=X,F++}return S&&(E?A=A.sort(function(Me,He){return Me[E]>He[E]}):A=A.sort()),A}function q(v,E){for(var S,A,I=E[0].toUpperCase()+E.slice(1),F=0;F<s.length;){if(S=s[F],A=S?S+I:E,A in v)return A;F++}return r}var At=1;function is(){return At++}function $i(v){var E=v.ownerDocument||v;return E.defaultView||E.parentWindow||e}var z=/mobile|tablet|ip(ad|hone|od)|android/i,j="ontouchstart"in e,H=q(e,"PointerEvent")!==r,fe=j&&z.test(navigator.userAgent),ce="touch",Xi="pen",Lt="mouse",rs="kinect",nn=25,we=1,hi=2,Ee=4,Je=8,Xo=1,ss=2,os=4,as=8,ls=16,Gt=ss|os,di=as|ls,$g=Gt|di,Xg=["x","y"],Yo=["clientX","clientY"];function yt(v,E){var S=this;this.manager=v,this.callback=E,this.element=v.element,this.target=v.options.inputTarget,this.domHandler=function(A){T(v.options.enable,[v])&&S.handler(A)},this.init()}yt.prototype={handler:function(){},init:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P($i(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&L(this.element,this.evEl,this.domHandler),this.evTarget&&L(this.target,this.evTarget,this.domHandler),this.evWin&&L($i(this.element),this.evWin,this.domHandler)}};function ix(v){var E,S=v.options.inputClass;return S?E=S:H?E=Xc:fe?E=Ko:j?E=Yc:E=qo,new E(v,rx)}function rx(v,E,S){var A=S.pointers.length,I=S.changedPointers.length,F=E&we&&A-I===0,X=E&(Ee|Je)&&A-I===0;S.isFirst=!!F,S.isFinal=!!X,F&&(v.session={}),S.eventType=E,sx(v,S),v.emit("hammer.input",S),v.recognize(S),v.session.prevInput=S}function sx(v,E){var S=v.session,A=E.pointers,I=A.length;S.firstInput||(S.firstInput=Yg(E)),I>1&&!S.firstMultiple?S.firstMultiple=Yg(E):I===1&&(S.firstMultiple=!1);var F=S.firstInput,X=S.firstMultiple,Ae=X?X.center:F.center,Me=E.center=Zg(A);E.timeStamp=u(),E.deltaTime=E.timeStamp-F.timeStamp,E.angle=$c(Ae,Me),E.distance=Zo(Ae,Me),ox(S,E),E.offsetDirection=Kg(E.deltaX,E.deltaY);var He=qg(E.deltaTime,E.deltaX,E.deltaY);E.overallVelocityX=He.x,E.overallVelocityY=He.y,E.overallVelocity=c(He.x)>c(He.y)?He.x:He.y,E.scale=X?cx(X.pointers,A):1,E.rotation=X?lx(X.pointers,A):0,E.maxPointers=S.prevInput?E.pointers.length>S.prevInput.maxPointers?E.pointers.length:S.prevInput.maxPointers:E.pointers.length,ax(S,E);var Ht=v.element;C(E.srcEvent.target,Ht)&&(Ht=E.srcEvent.target),E.target=Ht}function ox(v,E){var S=E.center,A=v.offsetDelta||{},I=v.prevDelta||{},F=v.prevInput||{};(E.eventType===we||F.eventType===Ee)&&(I=v.prevDelta={x:F.deltaX||0,y:F.deltaY||0},A=v.offsetDelta={x:S.x,y:S.y}),E.deltaX=I.x+(S.x-A.x),E.deltaY=I.y+(S.y-A.y)}function ax(v,E){var S=v.lastInterval||E,A=E.timeStamp-S.timeStamp,I,F,X,Ae;if(E.eventType!=Je&&(A>nn||S.velocity===r)){var Me=E.deltaX-S.deltaX,He=E.deltaY-S.deltaY,Ht=qg(A,Me,He);F=Ht.x,X=Ht.y,I=c(Ht.x)>c(Ht.y)?Ht.x:Ht.y,Ae=Kg(Me,He),v.lastInterval=E}else I=S.velocity,F=S.velocityX,X=S.velocityY,Ae=S.direction;E.velocity=I,E.velocityX=F,E.velocityY=X,E.direction=Ae}function Yg(v){for(var E=[],S=0;S<v.pointers.length;)E[S]={clientX:l(v.pointers[S].clientX),clientY:l(v.pointers[S].clientY)},S++;return{timeStamp:u(),pointers:E,center:Zg(E),deltaX:v.deltaX,deltaY:v.deltaY}}function Zg(v){var E=v.length;if(E===1)return{x:l(v[0].clientX),y:l(v[0].clientY)};for(var S=0,A=0,I=0;I<E;)S+=v[I].clientX,A+=v[I].clientY,I++;return{x:l(S/E),y:l(A/E)}}function qg(v,E,S){return{x:E/v||0,y:S/v||0}}function Kg(v,E){return v===E?Xo:c(v)>=c(E)?v<0?ss:os:E<0?as:ls}function Zo(v,E,S){S||(S=Xg);var A=E[S[0]]-v[S[0]],I=E[S[1]]-v[S[1]];return Math.sqrt(A*A+I*I)}function $c(v,E,S){S||(S=Xg);var A=E[S[0]]-v[S[0]],I=E[S[1]]-v[S[1]];return Math.atan2(I,A)*180/Math.PI}function lx(v,E){return $c(E[1],E[0],Yo)+$c(v[1],v[0],Yo)}function cx(v,E){return Zo(E[0],E[1],Yo)/Zo(v[0],v[1],Yo)}var ux={mousedown:we,mousemove:hi,mouseup:Ee},fx="mousedown",hx="mousemove mouseup";function qo(){this.evEl=fx,this.evWin=hx,this.pressed=!1,yt.apply(this,arguments)}m(qo,yt,{handler:function(E){var S=ux[E.type];S&we&&E.button===0&&(this.pressed=!0),S&hi&&E.which!==1&&(S=Ee),this.pressed&&(S&Ee&&(this.pressed=!1),this.callback(this.manager,S,{pointers:[E],changedPointers:[E],pointerType:Lt,srcEvent:E}))}});var dx={pointerdown:we,pointermove:hi,pointerup:Ee,pointercancel:Je,pointerout:Je},gx={2:ce,3:Xi,4:Lt,5:rs},Qg="pointerdown",Jg="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Qg="MSPointerDown",Jg="MSPointerMove MSPointerUp MSPointerCancel");function Xc(){this.evEl=Qg,this.evWin=Jg,yt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}m(Xc,yt,{handler:function(E){var S=this.store,A=!1,I=E.type.toLowerCase().replace("ms",""),F=dx[I],X=gx[E.pointerType]||E.pointerType,Ae=X==ce,Me=V(S,E.pointerId,"pointerId");F&we&&(E.button===0||Ae)?Me<0&&(S.push(E),Me=S.length-1):F&(Ee|Je)&&(A=!0),!(Me<0)&&(S[Me]=E,this.callback(this.manager,F,{pointers:S,changedPointers:[E],pointerType:X,srcEvent:E}),A&&S.splice(Me,1))}});var px={touchstart:we,touchmove:hi,touchend:Ee,touchcancel:Je},mx="touchstart",yx="touchstart touchmove touchend touchcancel";function ep(){this.evTarget=mx,this.evWin=yx,this.started=!1,yt.apply(this,arguments)}m(ep,yt,{handler:function(E){var S=px[E.type];if(S===we&&(this.started=!0),!!this.started){var A=vx.call(this,E,S);S&(Ee|Je)&&A[0].length-A[1].length===0&&(this.started=!1),this.callback(this.manager,S,{pointers:A[0],changedPointers:A[1],pointerType:ce,srcEvent:E})}}});function vx(v,E){var S=W(v.touches),A=W(v.changedTouches);return E&(Ee|Je)&&(S=G(S.concat(A),"identifier",!0)),[S,A]}var _x={touchstart:we,touchmove:hi,touchend:Ee,touchcancel:Je},wx="touchstart touchmove touchend touchcancel";function Ko(){this.evTarget=wx,this.targetIds={},yt.apply(this,arguments)}m(Ko,yt,{handler:function(E){var S=_x[E.type],A=Ex.call(this,E,S);A&&this.callback(this.manager,S,{pointers:A[0],changedPointers:A[1],pointerType:ce,srcEvent:E})}});function Ex(v,E){var S=W(v.touches),A=this.targetIds;if(E&(we|hi)&&S.length===1)return A[S[0].identifier]=!0,[S,S];var I,F,X=W(v.changedTouches),Ae=[],Me=this.target;if(F=S.filter(function(He){return C(He.target,Me)}),E===we)for(I=0;I<F.length;)A[F[I].identifier]=!0,I++;for(I=0;I<X.length;)A[X[I].identifier]&&Ae.push(X[I]),E&(Ee|Je)&&delete A[X[I].identifier],I++;if(Ae.length)return[G(F.concat(Ae),"identifier",!0),Ae]}var xx=2500,tp=25;function Yc(){yt.apply(this,arguments);var v=w(this.handler,this);this.touch=new Ko(this.manager,v),this.mouse=new qo(this.manager,v),this.primaryTouch=null,this.lastTouches=[]}m(Yc,yt,{handler:function(E,S,A){var I=A.pointerType==ce,F=A.pointerType==Lt;if(!(F&&A.sourceCapabilities&&A.sourceCapabilities.firesTouchEvents)){if(I)Tx.call(this,S,A);else if(F&&Sx.call(this,A))return;this.callback(E,S,A)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Tx(v,E){v&we?(this.primaryTouch=E.changedPointers[0].identifier,np.call(this,E)):v&(Ee|Je)&&np.call(this,E)}function np(v){var E=v.changedPointers[0];if(E.identifier===this.primaryTouch){var S={x:E.clientX,y:E.clientY};this.lastTouches.push(S);var A=this.lastTouches,I=function(){var F=A.indexOf(S);F>-1&&A.splice(F,1)};setTimeout(I,xx)}}function Sx(v){for(var E=v.srcEvent.clientX,S=v.srcEvent.clientY,A=0;A<this.lastTouches.length;A++){var I=this.lastTouches[A],F=Math.abs(E-I.x),X=Math.abs(S-I.y);if(F<=tp&&X<=tp)return!0}return!1}var ip=q(o.style,"touchAction"),rp=ip!==r,sp="compute",op="auto",Zc="manipulation",gi="none",cs="pan-x",us="pan-y",Qo=Px();function qc(v,E){this.manager=v,this.set(E)}qc.prototype={set:function(v){v==sp&&(v=this.compute()),rp&&this.manager.element.style&&Qo[v]&&(this.manager.element.style[ip]=v),this.actions=v.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var v=[];return d(this.manager.recognizers,function(E){T(E.options.enable,[E])&&(v=v.concat(E.getTouchAction()))}),bx(v.join(" "))},preventDefaults:function(v){var E=v.srcEvent,S=v.offsetDirection;if(this.manager.session.prevented){E.preventDefault();return}var A=this.actions,I=M(A,gi)&&!Qo[gi],F=M(A,us)&&!Qo[us],X=M(A,cs)&&!Qo[cs];if(I){var Ae=v.pointers.length===1,Me=v.distance<2,He=v.deltaTime<250;if(Ae&&Me&&He)return}if(!(X&&F)&&(I||F&&S&Gt||X&&S&di))return this.preventSrc(E)},preventSrc:function(v){this.manager.session.prevented=!0,v.preventDefault()}};function bx(v){if(M(v,gi))return gi;var E=M(v,cs),S=M(v,us);return E&&S?gi:E||S?E?cs:us:M(v,Zc)?Zc:op}function Px(){if(!rp)return!1;var v={},E=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(S){v[S]=E?e.CSS.supports("touch-action",S):!0}),v}var Jo=1,vt=2,Yi=4,In=8,rn=In,fs=16,Wt=32;function sn(v){this.options=_({},this.defaults,v||{}),this.id=is(),this.manager=null,this.options.enable=b(this.options.enable,!0),this.state=Jo,this.simultaneous={},this.requireFail=[]}sn.prototype={defaults:{},set:function(v){return _(this.options,v),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(v){if(h(v,"recognizeWith",this))return this;var E=this.simultaneous;return v=ea(v,this),E[v.id]||(E[v.id]=v,v.recognizeWith(this)),this},dropRecognizeWith:function(v){return h(v,"dropRecognizeWith",this)?this:(v=ea(v,this),delete this.simultaneous[v.id],this)},requireFailure:function(v){if(h(v,"requireFailure",this))return this;var E=this.requireFail;return v=ea(v,this),V(E,v)===-1&&(E.push(v),v.requireFailure(this)),this},dropRequireFailure:function(v){if(h(v,"dropRequireFailure",this))return this;v=ea(v,this);var E=V(this.requireFail,v);return E>-1&&this.requireFail.splice(E,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(v){return!!this.simultaneous[v.id]},emit:function(v){var E=this,S=this.state;function A(I){E.manager.emit(I,v)}S<In&&A(E.options.event+ap(S)),A(E.options.event),v.additionalEvent&&A(v.additionalEvent),S>=In&&A(E.options.event+ap(S))},tryEmit:function(v){if(this.canEmit())return this.emit(v);this.state=Wt},canEmit:function(){for(var v=0;v<this.requireFail.length;){if(!(this.requireFail[v].state&(Wt|Jo)))return!1;v++}return!0},recognize:function(v){var E=_({},v);if(!T(this.options.enable,[this,E])){this.reset(),this.state=Wt;return}this.state&(rn|fs|Wt)&&(this.state=Jo),this.state=this.process(E),this.state&(vt|Yi|In|fs)&&this.tryEmit(E)},process:function(v){},getTouchAction:function(){},reset:function(){}};function ap(v){return v&fs?"cancel":v&In?"end":v&Yi?"move":v&vt?"start":""}function lp(v){return v==ls?"down":v==as?"up":v==ss?"left":v==os?"right":""}function ea(v,E){var S=E.manager;return S?S.get(v):v}function Ct(){sn.apply(this,arguments)}m(Ct,sn,{defaults:{pointers:1},attrTest:function(v){var E=this.options.pointers;return E===0||v.pointers.length===E},process:function(v){var E=this.state,S=v.eventType,A=E&(vt|Yi),I=this.attrTest(v);return A&&(S&Je||!I)?E|fs:A||I?S&Ee?E|In:E&vt?E|Yi:vt:Wt}});function ta(){Ct.apply(this,arguments),this.pX=null,this.pY=null}m(ta,Ct,{defaults:{event:"pan",threshold:10,pointers:1,direction:$g},getTouchAction:function(){var v=this.options.direction,E=[];return v&Gt&&E.push(us),v&di&&E.push(cs),E},directionTest:function(v){var E=this.options,S=!0,A=v.distance,I=v.direction,F=v.deltaX,X=v.deltaY;return I&E.direction||(E.direction&Gt?(I=F===0?Xo:F<0?ss:os,S=F!=this.pX,A=Math.abs(v.deltaX)):(I=X===0?Xo:X<0?as:ls,S=X!=this.pY,A=Math.abs(v.deltaY))),v.direction=I,S&&A>E.threshold&&I&E.direction},attrTest:function(v){return Ct.prototype.attrTest.call(this,v)&&(this.state&vt||!(this.state&vt)&&this.directionTest(v))},emit:function(v){this.pX=v.deltaX,this.pY=v.deltaY;var E=lp(v.direction);E&&(v.additionalEvent=this.options.event+E),this._super.emit.call(this,v)}});function Kc(){Ct.apply(this,arguments)}m(Kc,Ct,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[gi]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.scale-1)>this.options.threshold||this.state&vt)},emit:function(v){if(v.scale!==1){var E=v.scale<1?"in":"out";v.additionalEvent=this.options.event+E}this._super.emit.call(this,v)}});function Qc(){sn.apply(this,arguments),this._timer=null,this._input=null}m(Qc,sn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[op]},process:function(v){var E=this.options,S=v.pointers.length===E.pointers,A=v.distance<E.threshold,I=v.deltaTime>E.time;if(this._input=v,!A||!S||v.eventType&(Ee|Je)&&!I)this.reset();else if(v.eventType&we)this.reset(),this._timer=f(function(){this.state=rn,this.tryEmit()},E.time,this);else if(v.eventType&Ee)return rn;return Wt},reset:function(){clearTimeout(this._timer)},emit:function(v){this.state===rn&&(v&&v.eventType&Ee?this.manager.emit(this.options.event+"up",v):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function Jc(){Ct.apply(this,arguments)}m(Jc,Ct,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[gi]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.rotation)>this.options.threshold||this.state&vt)}});function eu(){Ct.apply(this,arguments)}m(eu,Ct,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Gt|di,pointers:1},getTouchAction:function(){return ta.prototype.getTouchAction.call(this)},attrTest:function(v){var E=this.options.direction,S;return E&(Gt|di)?S=v.overallVelocity:E&Gt?S=v.overallVelocityX:E&di&&(S=v.overallVelocityY),this._super.attrTest.call(this,v)&&E&v.offsetDirection&&v.distance>this.options.threshold&&v.maxPointers==this.options.pointers&&c(S)>this.options.velocity&&v.eventType&Ee},emit:function(v){var E=lp(v.offsetDirection);E&&this.manager.emit(this.options.event+E,v),this.manager.emit(this.options.event,v)}});function na(){sn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}m(na,sn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Zc]},process:function(v){var E=this.options,S=v.pointers.length===E.pointers,A=v.distance<E.threshold,I=v.deltaTime<E.time;if(this.reset(),v.eventType&we&&this.count===0)return this.failTimeout();if(A&&I&&S){if(v.eventType!=Ee)return this.failTimeout();var F=this.pTime?v.timeStamp-this.pTime<E.interval:!0,X=!this.pCenter||Zo(this.pCenter,v.center)<E.posThreshold;this.pTime=v.timeStamp,this.pCenter=v.center,!X||!F?this.count=1:this.count+=1,this._input=v;var Ae=this.count%E.taps;if(Ae===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=rn,this.tryEmit()},E.interval,this),vt):rn}return Wt},failTimeout:function(){return this._timer=f(function(){this.state=Wt},this.options.interval,this),Wt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==rn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function on(v,E){return E=E||{},E.recognizers=b(E.recognizers,on.defaults.preset),new tu(v,E)}on.VERSION="2.0.7",on.defaults={domEvents:!1,touchAction:sp,enable:!0,inputTarget:null,inputClass:null,preset:[[Jc,{enable:!1}],[Kc,{enable:!1},["rotate"]],[eu,{direction:Gt}],[ta,{direction:Gt},["swipe"]],[na],[na,{event:"doubletap",taps:2},["tap"]],[Qc]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ax=1,cp=2;function tu(v,E){this.options=_({},on.defaults,E||{}),this.options.inputTarget=this.options.inputTarget||v,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=v,this.input=ix(this),this.touchAction=new qc(this,this.options.touchAction),up(this,!0),d(this.options.recognizers,function(S){var A=this.add(new S[0](S[1]));S[2]&&A.recognizeWith(S[2]),S[3]&&A.requireFailure(S[3])},this)}tu.prototype={set:function(v){return _(this.options,v),v.touchAction&&this.touchAction.update(),v.inputTarget&&(this.input.destroy(),this.input.target=v.inputTarget,this.input.init()),this},stop:function(v){this.session.stopped=v?cp:Ax},recognize:function(v){var E=this.session;if(!E.stopped){this.touchAction.preventDefaults(v);var S,A=this.recognizers,I=E.curRecognizer;(!I||I&&I.state&rn)&&(I=E.curRecognizer=null);for(var F=0;F<A.length;)S=A[F],E.stopped!==cp&&(!I||S==I||S.canRecognizeWith(I))?S.recognize(v):S.reset(),!I&&S.state&(vt|Yi|In)&&(I=E.curRecognizer=S),F++}},get:function(v){if(v instanceof sn)return v;for(var E=this.recognizers,S=0;S<E.length;S++)if(E[S].options.event==v)return E[S];return null},add:function(v){if(h(v,"add",this))return this;var E=this.get(v.options.event);return E&&this.remove(E),this.recognizers.push(v),v.manager=this,this.touchAction.update(),v},remove:function(v){if(h(v,"remove",this))return this;if(v=this.get(v),v){var E=this.recognizers,S=V(E,v);S!==-1&&(E.splice(S,1),this.touchAction.update())}return this},on:function(v,E){if(v!==r&&E!==r){var S=this.handlers;return d(R(v),function(A){S[A]=S[A]||[],S[A].push(E)}),this}},off:function(v,E){if(v!==r){var S=this.handlers;return d(R(v),function(A){E?S[A]&&S[A].splice(V(S[A],E),1):delete S[A]}),this}},emit:function(v,E){this.options.domEvents&&Lx(v,E);var S=this.handlers[v]&&this.handlers[v].slice();if(!(!S||!S.length)){E.type=v,E.preventDefault=function(){E.srcEvent.preventDefault()};for(var A=0;A<S.length;)S[A](E),A++}},destroy:function(){this.element&&up(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function up(v,E){var S=v.element;if(S.style){var A;d(v.options.cssProps,function(I,F){A=q(S.style,F),E?(v.oldCssProps[A]=S.style[A],S.style[A]=I):S.style[A]=v.oldCssProps[A]||""}),E||(v.oldCssProps={})}}function Lx(v,E){var S=n.createEvent("Event");S.initEvent(v,!0,!0),S.gesture=E,E.target.dispatchEvent(S)}_(on,{INPUT_START:we,INPUT_MOVE:hi,INPUT_END:Ee,INPUT_CANCEL:Je,STATE_POSSIBLE:Jo,STATE_BEGAN:vt,STATE_CHANGED:Yi,STATE_ENDED:In,STATE_RECOGNIZED:rn,STATE_CANCELLED:fs,STATE_FAILED:Wt,DIRECTION_NONE:Xo,DIRECTION_LEFT:ss,DIRECTION_RIGHT:os,DIRECTION_UP:as,DIRECTION_DOWN:ls,DIRECTION_HORIZONTAL:Gt,DIRECTION_VERTICAL:di,DIRECTION_ALL:$g,Manager:tu,Input:yt,TouchAction:qc,TouchInput:Ko,MouseInput:qo,PointerEventInput:Xc,TouchMouseInput:Yc,SingleTouchInput:ep,Recognizer:sn,AttrRecognizer:Ct,Tap:na,Pan:ta,Swipe:eu,Pinch:Kc,Rotate:Jc,Press:Qc,on:P,off:L,each:d,merge:y,extend:x,assign:_,inherit:m,bindFn:w,prefixed:q});var Cx=typeof e<"u"?e:typeof self<"u"?self:{};Cx.Hammer=on,typeof r=="function"&&r.amd?r(function(){return on}):t.exports?t.exports=on:e[i]=on})(window,document,"Hammer")})(aO);const lO=Bi,Yt=Ix({__proto__:null,default:lO},[Bi]),eE=1,tE=2,Nh=4,cO={mousedown:eE,mousemove:tE,mouseup:Nh};function uO(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function fO(t){const e=t.prototype.handler;t.prototype.handler=function(i){const r=this.store;i.button>0&&i.type==="pointerdown"&&(uO(r,s=>s.pointerId===i.pointerId)||r.push(i)),e.call(this,i)}}function hO(t){t.prototype.handler=function(n){let i=cO[n.type];i&eE&&n.button>=0&&(this.pressed=!0),i&tE&&n.which===0&&(i=Nh),this.pressed&&(i&Nh&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}fO(Bi.PointerEventInput);hO(Bi.MouseInput);const dO=Bi.Manager;class Nc{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const gO=Yt?[[Yt.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Yt.Rotate,{enable:!1}],[Yt.Pinch,{enable:!1}],[Yt.Swipe,{enable:!1}],[Yt.Pan,{threshold:0,enable:!1}],[Yt.Press,{enable:!1}],[Yt.Tap,{event:"doubletap",taps:2,enable:!1}],[Yt.Tap,{event:"anytap",enable:!1}],[Yt.Tap,{enable:!1}]]:null,Z0={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},pO={doubletap:["tap"]},mO={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Eg={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},yO={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},q0={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},vO=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",vr=typeof window<"u"?window:global;let Fh=!1;try{const t={get passive(){return Fh=!0,!0}};vr.addEventListener("test",null,t),vr.removeEventListener("test",null)}catch{Fh=!1}const _O=vO.indexOf("firefox")!==-1,{WHEEL_EVENTS:wO}=Eg,K0="wheel",Q0=4.000244140625,EO=40,xO=.25;class TO extends Nc{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;vr.WheelEvent&&(_O&&r.deltaMode===vr.WheelEvent.DOM_DELTA_PIXEL&&(s/=vr.devicePixelRatio),r.deltaMode===vr.WheelEvent.DOM_DELTA_LINE&&(s*=EO)),s!==0&&s%Q0===0&&(s=Math.floor(s/Q0)),r.shiftKey&&s&&(s=s*xO),this.callback({type:K0,center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(wO),this.events.forEach(r=>e.addEventListener(r,this.handleEvent,Fh?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===K0&&(this.options.enable=n)}}const{MOUSE_EVENTS:SO}=Eg,J0="pointermove",ey="pointerover",ty="pointerout",ny="pointerenter",iy="pointerleave";class bO extends Nc{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(SO),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===J0&&(this.enableMoveEvent=n),e===ey&&(this.enableOverEvent=n),e===ty&&(this.enableOutEvent=n),e===ny&&(this.enableEnterEvent=n),e===iy&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(ey,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(ty,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(ny,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(iy,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(J0,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:PO}=Eg,ry="keydown",sy="keyup";class AO extends Nc{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{const s=r.target||r.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:ry,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:sy,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(PO),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===ry&&(this.enableDownEvent=n),e===sy&&(this.enableUpEvent=n)}}const oy="contextmenu";class LO extends Nc{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{this.options.enable&&this.callback({type:oy,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===oy&&(this.options.enable=n)}}const Dh=1,rc=2,zh=4,CO={pointerdown:Dh,pointermove:rc,pointerup:zh,mousedown:Dh,mousemove:rc,mouseup:zh},IO=1,MO=2,RO=3,OO=0,kO=1,NO=2,FO=1,DO=2,zO=4;function BO(t){const e=CO[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:r}=t.srcEvent;let s=!1,o=!1,a=!1;return e===zh||e===rc&&!Number.isFinite(n)?(s=r===IO,o=r===MO,a=r===RO):e===rc?(s=!!(n&FO),o=!!(n&zO),a=!!(n&DO)):e===Dh&&(s=i===OO,o=i===kO,a=i===NO),{leftButton:s,middleButton:o,rightButton:a}}function UO(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1,o={x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const tf={srcElement:"root",priority:0};class VO{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let r=n.srcEvent.target;for(;r&&r!==i.rootElement;){if(this._emit(i,r),i.handled)return;r=r.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,r=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=tf;typeof i=="string"||i&&i.addEventListener?l={...tf,srcElement:i}:i&&(l={...tf,...i});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};r&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let f=c.length-1;for(;f>=0&&!(c[f].priority>=u.priority);)f--;c.splice(f+1,0,u)}remove(e,n){const{handlers:i,handlersByElement:r}=this;for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.type===e&&o.handler===n){i.splice(s,1);const a=r.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&r.delete(o.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let r=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,r=!0},a=[];for(let l=0;l<i.length;l++){const{type:c,handler:u,once:f}=i[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),f&&a.push(i[l]),r)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...BO(e),...UO(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const jO={events:null,recognizers:null,recognizerOptions:{},Manager:dO,touchAction:"none",tabIndex:0};class GO{constructor(e=null,n){this._onBasicInput=r=>{const{srcEvent:s}=r,o=mO[s.type];o&&this.manager.emit(o,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...jO,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||gO}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(Z0).forEach(r=>{const s=this.manager.get(r);s&&Z0[r].forEach(o=>{s.recognizeWith(o)})});for(const r in n.recognizerOptions){const s=this.manager.get(r);if(s){const o=n.recognizerOptions[r];delete o.enable,s.set(o)}}this.wheelInput=new TO(e,this._onOtherEvent,{enable:!1}),this.moveInput=new bO(e,this._onOtherEvent,{enable:!1}),this.keyInput=new AO(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new LO(e,this._onOtherEvent,{enable:!1});for(const[r,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(r,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const r=i.get(e);if(r&&r.options.enable!==n){r.set({enable:n});const s=pO[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=i.get(o);n?(a.requireFailure(e),r.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,r,s){if(typeof e!="string"){i=n;for(const u in e)this._addEventHandler(u,e[u],i,r,s);return}const{manager:o,events:a}=this,l=q0[e]||e;let c=a.get(l);c||(c=new VO(this),a.set(l,c),c.recognizerName=yO[l]||l,o&&o.on(l,c.handleEvent)),c.add(e,n,i,r,s),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:i}=this,r=q0[e]||e,s=i.get(r);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of i.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function yi(){}const WO=({isDragging:t})=>t?"grabbing":"grab",nE={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:yi,onResize:yi,onViewStateChange:yi,onInteractionStateChange:yi,onBeforeRender:yi,onAfterRender:yi,onLoad:yi,onError:t=>$.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:WO,getTooltip:null,debug:!1,drawPickingColors:!1};class Fc{constructor(e){g(this,"props",void 0),g(this,"width",0),g(this,"height",0),g(this,"userData",{}),g(this,"canvas",null),g(this,"viewManager",null),g(this,"layerManager",null),g(this,"effectManager",null),g(this,"deckRenderer",null),g(this,"deckPicker",null),g(this,"eventManager",null),g(this,"tooltip",null),g(this,"metrics",void 0),g(this,"animationLoop",void 0),g(this,"stats",void 0),g(this,"viewState",void 0),g(this,"cursorState",void 0),g(this,"_needsRedraw",void 0),g(this,"_pickRequest",void 0),g(this,"_lastPointerDownInfo",null),g(this,"_metricsCounter",void 0),g(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const r=n.offsetCenter;if(!r)return;i.x=r.x,i.y=r.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),g(this,"_onEvent",n=>{const i=Um[n.type],r=n.offsetCenter;if(!i||!r||!this.layerManager)return;const s=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:s,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:a}=o,l=a&&(a[i.handler]||a.props[i.handler]),c=this.props[i.handler];let u=!1;l&&(u=l.call(a,o,n)),!u&&c&&c(o,n)}),g(this,"_onPointerDown",n=>{const i=n.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo}),this.props={...nE,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&$.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),I1()==="IE"&&$.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Cc({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Xr.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,r,s,o,a;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(r=this.deckRenderer)===null||r===void 0||r.finalize(),this.deckRenderer=null,(s=this.deckPicker)===null||s===void 0||s.finalize(),this.deckPicker=null,(o=this.eventManager)===null||o===void 0||o.destroy(),this.eventManager=null,(a=this.tooltip)===null||a===void 0||a.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var l;(l=this.canvas.parentElement)===null||l===void 0||l.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&$.removed("onLayerHover","onHover")(),"onLayerClick"in e&&$.removed("onLayerClick","onClick")(),e.initialViewState&&!Ft(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||i||r||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Ce(this.viewManager),this.viewManager.views}getViewports(e){return Ce(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,i){Ce(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Ce(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=s}if(i||i===0){var r;const s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((r=e.style)===null||r===void 0?void 0:r.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const n=e.clientWidth||e.width,i=e.clientHeight||e.height;if(n!==this.width||i!==this.height){var r;this.width=n,this.height=i,(r=this.viewManager)===null||r===void 0||r.setProps({width:n,height:i}),this.props.onResize({width:n,height:i})}}_createAnimationLoop(e){const{width:n,height:i,gl:r,glOptions:s,debug:o,onError:a,onBeforeRender:l,onAfterRender:c,useDevicePixels:u}=e;return new mC({width:n,height:i,useDevicePixels:u,autoResizeViewport:!1,gl:r,onCreateContext:f=>Z1({...s,...f,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:f=>this._setGLContext(f.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:l,onAfterRender:c,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new Kw({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let s=r,o=!1;for(const a of i){var n;s=a,o=((n=a.layer)===null||n===void 0?void 0:n.onHover(a,e.event))||o}if(!o&&this.props.onHover&&this.props.onHover(s,e.event),this.props.getTooltip&&this.tooltip){const a=this.props.getTooltip(s);this.tooltip.setTooltip(a,s.x,s.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,rg(e,{enable:!0,copyState:!0})),this.tooltip=new oO(this.canvas),Tn(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new Fw;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new GO(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in Um)this.eventManager.on(r,this._onEvent);this.viewManager=new OR({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new RR(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new ZR,this.deckRenderer=new QR(e),this.deckPicker=new rO(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;Tn(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),$.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=bi.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}g(Fc,"defaultProps",nE);g(Fc,"VERSION",EA);class nf{constructor(e,n){g(this,"opts",void 0),g(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:r}=n;let s=i;if(i&&i.length!==r){s=new Float32Array(r);const o=n.elementOffset||0;for(let a=0;a<r;++a)s[a]=i[o+a]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function HO(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function gl(t){return t.stride||t.size*t.bytesPerElement}function iE(t,e){e.offset&&$.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=gl(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,s=i*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function $O(t,e){const n=iE(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class XO{constructor(e,n,i){g(this,"gl",void 0),g(this,"id",void 0),g(this,"size",void 0),g(this,"settings",void 0),g(this,"value",void 0),g(this,"doublePrecision",void 0),g(this,"_buffer",void 0),g(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,s=r===5130;let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a=5126:!r&&n.isIndexed?a=e&&$2(e,ae.ELEMENT_INDEX_UINT32)?5125:5123:a=r||5126;let l=HO(r||a||5126);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:r,type:a,size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new te(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*gl(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Xr.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},r=this.value instanceof Float64Array,s=$O(this.getAccessor(),n||{});return i[e]=new nf(this,s.high),i["".concat(e,"64Low")]=r?new nf(this,s.low):new Float32Array(this.size),i}if(n){const i=iE(this.getAccessor(),n);return{[e]:new nf(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:r}=this,s=i*r;if(n&&s&&n.length>=s){const o=new Array(r).fill(1/0),a=new Array(r).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<r;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof te?i={buffer:e}:i=e;const r={...this.settings,...i};if(n.bufferAccessor=r,n.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=s}else if(i.buffer){const s=i.buffer;n.externalBuffer=s,n.constant=!1,this.value=i.value||null;const o=i.value instanceof Float64Array;r.type=i.type||s.accessor.type,r.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(o?2:1),r.stride=gl(r)}else if(i.value){this._checkExternalBuffer(i);let s=i.value;n.externalBuffer=null,n.constant=!1,this.value=s,r.bytesPerElement=s.BYTES_PER_ELEMENT,r.stride=gl(r);const{buffer:o,byteOffset:a}=this;this.doublePrecision&&s instanceof Float64Array&&(s=Qu(s,r));const l=s.byteLength+a+r.stride*2;o.byteLength<l&&o.reallocate(l),o.setAccessor(null),o.subData({data:s,offset:a}),r.type=i.type||o.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?Qu(n,{size:this.size,startIndex:i,endIndex:r}):n.subarray(i,r),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,r=i.allocatedValue,s=Xr.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{buffer:o,byteOffset:a}=this;return o.byteLength<s.byteLength+a&&(o.reallocate(s.byteLength+a),n&&r&&o.subData({data:r instanceof Float64Array?Qu(r,this):r,offset:a})),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&$.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let o=s;for(;--o>=0;)n[i+o]=r[o];return n}switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let o=s;for(;--o>=0;)n[i+o]=Number.isFinite(e[o])?e[o]:r[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==n[r])return!1;return!0}}const ay=[],ly=[];function Dc(t,e=0,n=1/0){let i=ay;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(ly.length=t.length,i=ly):i=ay,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function rE(t){return t&&t[Symbol.asyncIterator]}function sE(t,e){const{size:n,stride:i,offset:r,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((t.length-c)/l);return(f,{index:h,target:d})=>{if(!s){const y=h*l+c;for(let m=0;m<n;m++)d[m]=t[y+m];return d}const p=s[h],_=s[h+1]||u;let x;if(o){x=new Array(_-p);for(let y=p;y<_;y++){const m=y*l+c;d=new Array(n);for(let w=0;w<n;w++)d[w]=t[m+w];x[y-p]=d}}else if(l===n)x=t.subarray(p*n+c,_*n+c);else{x=new t.constructor((_-p)*n);let y=0;for(let m=p;m<_;m++){const w=m*l+c;for(let T=0;T<n;T++)x[y++]=t[w+T]}}return x}}const YO=[],pl=[[0,1/0]];function ZO(t,e){if(t===pl||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let r=0;for(let s=0;s<i;s++){const o=t[s];o[1]<e[0]?(n.push(o),r=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(r,0,e),n}function rf(t){const{source:e,target:n,start:i=0,size:r,getData:s}=t,o=t.end||n.length,a=e.length,l=o-i;if(a>l){n.set(e.subarray(0,l),i);return}if(n.set(e,i),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let f=0;f<r;f++)n[i+c]=u[f]||0,c++}}function qO({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!Array.isArray(s))return rf({source:t,target:e,size:n,getData:i}),e;let o=0,a=0;const l=i&&((u,f)=>i(u+a,f)),c=Math.min(r.length,s.length);for(let u=1;u<c;u++){const f=r[u]*n,h=s[u]*n;rf({source:t.subarray(o,f),target:e,start:a,end:h,size:n,getData:l}),o=f,a=h}return a<e.length&&rf({source:[],target:e,start:a,size:n,getData:l}),e}const KO={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function oE(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...KO[n],...e,...t,type:n}}function aE(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function lE(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function cE(t){t.push(t.shift())}function xg(t,e){const{doublePrecision:n,settings:i,value:r,size:s}=t,o=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*s)*o}function uE({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:r,getData:s=o=>o}){const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,a=n.size*o,l=n.byteOffset,c=n.startIndices,u=r&&c,f=xg(n,e),h=n.isConstant;if(!u&&i>=f)return;const d=h?n.value:n.getBuffer().getData({srcByteOffset:l});if(n.settings.normalized&&!h){const y=s;s=(m,w)=>n.normalizeConstant(y(m,w))}const p=h?(y,m)=>s(d,m):(y,m)=>s(d.subarray(y,y+a),m),_=t.getData({length:i}),x=new Float32Array(f);qO({source:_,target:x,sourceStartIndices:r,targetStartIndices:c,size:a,getData:p}),t.byteLength<x.byteLength+l&&t.reallocate(x.byteLength+l),t.subData({data:x,offset:l})}class Tg extends XO{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:pl}),g(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,r=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return oE(r,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:r=1/0}=n;this.state.updateRanges=ZO(this.state.updateRanges,[i,r])}else this.state.updateRanges=pl}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=YO}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==pl),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(r,this,{data:n,startRow:c,endRow:u,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const f=Number.isFinite(c)?this.getVertexOffset(c):0,h=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Ce(ArrayBuffer.isView(o.value),"invalid ".concat(r.accessor));const a=!!o.size&&o.size!==this.size;return i.binaryAccessor=sE(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:r,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:f}=e,{accessor:h,transform:d}=a,p=l.binaryAccessor||(typeof h=="function"?h:s[h]);Ce(typeof p=="function",'accessor "'.concat(h,'" is not a function'));let _=e.getVertexOffset(i);const{iterable:x,objectInfo:y}=Dc(n,i,r);for(const m of x){y.index++;let w=p(m,y);if(d&&(w=d.call(this,w)),f){const T=(y.index<f.length-1?f[y.index+1]:o)-f[y.index];if(w&&Array.isArray(w[0])){let b=_;for(const P of w)e._normalizeValue(P,c,b),b+=u}else w&&w.length>u?c.set(w,_):(e._normalizeValue(w,y.target,0),TR({target:c,source:y.target,start:_,count:T}));_+=T*u}else e._normalizeValue(w,c,_),_+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class QO{constructor({gl:e,attribute:n,timeline:i}){g(this,"gl",void 0),g(this,"type","interpolation"),g(this,"attributeInTransition",void 0),g(this,"settings",void 0),g(this,"attribute",void 0),g(this,"transition",void 0),g(this,"currentStartIndices",void 0),g(this,"currentLength",void 0),g(this,"transform",void 0),g(this,"buffers",void 0),this.gl=e,this.transition=new Wo(i),this.attribute=n,this.attributeInTransition=new Tg(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=ek(e,n);const r={byteLength:0,usage:35050};this.buffers=[new te(e,r),new te(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:r,attribute:s}=this;cE(r);const o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)uE({buffer:a,...o});this.currentStartIndices=s.startIndices,this.currentLength=xg(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:r[0],aTo:aE(i,s)},feedbackBuffers:{vCurrent:r[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:r}=this.transition;let s=r/n;i&&(s=i(s)),this.transform.run({uniforms:{time:s}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const JO=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function ek(t,e){const n=lE(e.size);return new mg(t,{vs:JO,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class tk{constructor({gl:e,attribute:n,timeline:i}){g(this,"gl",void 0),g(this,"type","spring"),g(this,"attributeInTransition",void 0),g(this,"settings",void 0),g(this,"attribute",void 0),g(this,"transition",void 0),g(this,"currentStartIndices",void 0),g(this,"currentLength",void 0),g(this,"texture",void 0),g(this,"framebuffer",void 0),g(this,"transform",void 0),g(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Wo(i),this.attribute=n,this.attributeInTransition=new Tg(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=ik(e),this.framebuffer=rk(e,this.texture),this.transform=nk(e,n,this.framebuffer);const r={byteLength:0,usage:35050};this.buffers=[new te(e,r),new te(e,r),new te(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:r,attribute:s}=this,o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)uE({buffer:a,...o});this.settings=e,this.currentStartIndices=s.startIndices,this.currentLength=xg(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:aE(i,s)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:r}=this;if(!r.update())return!1;const o=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:o.stiffness,damping:o.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),cE(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Oc(i)[0]>0||r.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function nk(t,e,n){const i=lE(e.size);return new mg(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function ik(t){return new gt(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function rk(t,e){return new Pe(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const sk={interpolation:QO,spring:tk};class ok{constructor(e,{id:n,timeline:i}){g(this,"id",void 0),g(this,"isSupported",void 0),g(this,"gl",void 0),g(this,"timeline",void 0),g(this,"transitions",void 0),g(this,"needsRedraw",void 0),g(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=mg.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const r in e){const s=e[r],o=s.getTransitionSetting(n);o&&this._updateAttribute(r,s,o)}for(const r in this.transitions){const s=e[r];(!s||!s.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const r=this.transitions[e];let s=!r||r.type!==i.type;if(s){if(!this.isSupported){$.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}r&&this._removeTransition(e);const o=sk[i.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,gl:this.gl}):($.error("unsupported transition type '".concat(i.type,"'"))(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const cy="attributeManager.invalidate",ak="attributeManager.updateStart",lk="attributeManager.updateEnd",ck="attribute.updateStart",uk="attribute.allocate",fk="attribute.updateEnd";class hk{constructor(e,{id:n="attribute-manager",stats:i,timeline:r}={}){g(this,"id",void 0),g(this,"gl",void 0),g(this,"attributes",void 0),g(this,"updateTriggers",void 0),g(this,"needsRedraw",void 0),g(this,"userData",void 0),g(this,"stats",void 0),g(this,"attributeTransitionManager",void 0),g(this,"mergeBoundsMemoized",Vo(gR)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new ok(e,{id:"".concat(n,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);Ue(cy,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Ue(cy,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:r,props:s={},buffers:o={},context:a={}}){let l=!1;Ue(ak,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],f=u.settings.accessor;u.startIndices=i,u.numInstances=n,s[c]&&$.removed("props.".concat(c),"data.attributes.".concat(c))(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof f=="string"?o[f]:void 0,e.startIndices)||typeof f=="string"&&!o[f]&&u.setConstantValue(s[f])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&Ue(lk,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(i=>{var r;return(r=this.attributes[i])===null||r===void 0?void 0:r.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!i.hasAttribute(s)&&(r[s]=o)}return r}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const r in e)n[r]||Object.assign(i,e[r].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const r=e[i];this.attributes[i]=this._createAttribute(i,r,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const r={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new Tg(this.gl,r)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:r}=this,s=r[e];return s&&s.forEach(o=>{const a=i[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(Ue(ck,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Ue(uk,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,Ue(fk,n,i))}}class dk extends Wo{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:r,easing:s}}=this,o=s(e/r);this._value=Gr(n,i,o)}}const uy=1e-5;function fy(t,e,n,i,r){const s=e-t,a=(n-e)*r,l=-s*i;return a+l+s+e}function gk(t,e,n,i,r){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=fy(t[o],e[o],n[o],i,r);return s}return fy(t,e,n,i,r)}function hy(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class pk extends Wo{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:r}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=gk(s,o,n,i,r);const l=hy(a,n),c=hy(a,o);l<uy&&c<uy&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const mk={interpolation:dk,spring:pk};class yk{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,r){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(r=oE(r),!r)return;const o=mk[r.type];if(!o){$.error("unsupported transition type '".concat(r.type,"'"))();return}const a=new o(this.timeline);a.start({...r,fromValue:n,toValue:i}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function vk(t){const e=t[ii];for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function _k(t,e){const n=fE({newProps:t,oldProps:e,propTypes:t[ii],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=Ek(t,e);let r=!1;return i||(r=xk(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:Tk(t,e),transitionsChanged:wk(t,e)}}function wk(t,e){if(!t.transitions)return!1;const n={},i=t[ii];let r=!1;for(const s in t.transitions){const o=i[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Bh(t[s],e[s],o)&&(n[s]=!0,r=!0)}return r?n:!1}function fE({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(r," changed shallowly");for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return"".concat(r,".").concat(s," added");const o=Bh(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return"".concat(r,".").concat(s," dropped");if(!Object.hasOwnProperty.call(t,s)){const o=Bh(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}}return!1}function Bh(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function Ek(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function xk(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&dy(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)r!=="all"&&dy(t,e,r)&&(n[r]=!0,i=!0);return i?n:!1}function Tk(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function dy(t,e,n){let i=t.updateTriggers[n];i=i??{};let r=e.updateTriggers[n];return r=r??{},fE({oldProps:r,newProps:i,triggerName:n})}const Sk="count(): argument not an object",bk="count(): argument not a container";function Pk(t){if(!Lk(t))throw new Error(Sk);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(Ak(t))return Object.keys(t).length;throw new Error(bk)}function Ak(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function Lk(t){return t!==null&&typeof t=="object"}function Ck(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(r=>r.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];n.inject=i}return n}const Ik={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},Uh={};function Mk(t,e,n){if(e instanceof gt)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={[10241]:e.data.length>1?9985:9729});const r=new gt(t,{...e,parameters:{...Ik,...i,...n}});return Uh[r.id]=!0,r}function Rk(t){!t||!(t instanceof gt)||Uh[t.id]&&(t.delete(),delete Uh[t.id])}const Ok={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Vh(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Ft(t,e,1)}},accessor:{validate(t,e){const n=sc(t);return n==="function"||n===sc(e.value)},equal(t,e,n){return typeof e=="function"?!0:Ft(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Vh(t)},equal(t,e,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Ft(t,e,r):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Ft(t,e,r):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.gl?null:Mk(i.gl,t,{...e.parameters,...n.props.textureParameters})},release:t=>{Rk(t)}}};function kk(t){const e={},n={},i={};for(const[r,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)i[r]=Array.isArray(o)?o:[o];else{const a=Nk(r,s);e[r]=a,n[r]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function Nk(t,e){switch(sc(e)){case"object":return bs(t,e);case"array":return bs(t,{type:"array",value:e,compare:!1});case"boolean":return bs(t,{type:"boolean",value:e});case"number":return bs(t,{type:"number",value:e});case"function":return bs(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function bs(t,e){return"type"in e?{name:t,...Ok[e.type],...e}:"value"in e?{name:t,type:sc(e.value),...e}:{name:t,type:"object",value:e}}function Vh(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function sc(t){return Vh(t)?"array":t===null?"null":typeof t}function Fk(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const i=jh(t.constructor,n),r=Object.create(i);r[ic]=t,r[zi]={},r[$n]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)r[a]=o[a]}return Object.freeze(r),r}const Dk="_mergedDefaultProps";function jh(t,e){let n=Dk;if(e)for(const r of e){const s=r.constructor;s&&(n+=":".concat(s.extensionName||s.name))}const i=hE(t,n);return i||(t[n]=zk(t,e||[]))}function zk(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),r=jh(i),s=hE(t,"defaultProps")||{},o=kk(s),a=Object.assign(Object.create(null),r,o.defaultProps),l=Object.assign(Object.create(null),r==null?void 0:r[ii],o.propTypes),c=Object.assign(Object.create(null),r==null?void 0:r[ef],o.deprecatedProps);for(const u of e){const f=jh(u.constructor);f&&(Object.assign(a,f),Object.assign(l,f[ii]),Object.assign(c,f[ef]))}return Bk(a,t),Vk(a,l),Uk(a,c),a[ii]=l,a[ef]=c,e.length===0&&!Sg(t,"_propTypes")&&(t._propTypes=l),a}function Bk(t,e){const n=Gk(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function Uk(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const r="".concat(this.id,": ").concat(n);for(const s of e[n])Sg(this,s)||(this[s]=i);$.deprecated(r,e[n].join("/"))()}})}function Vk(t,e){const n={},i={};for(const r in e){const s=e[r],{name:o,value:a}=s;s.async&&(n[o]=a,i[o]=jk(o))}t[Mr]=n,t[zi]={},Object.defineProperties(t,i)}function jk(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||rE(e)?this[zi][t]=e:this[$n][t]=e},get(){if(this[$n]){if(t in this[$n])return this[$n][t]||this[Mr][t];if(t in this[zi]){const e=this[ic]&&this[ic].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Mr][t]}}return this[Mr][t]}}}function Sg(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function hE(t,e){return Sg(t,e)&&t[e]}function Gk(t){const e=t.componentName;return e||$.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let Wk=0;class bg{constructor(...e){g(this,"id",void 0),g(this,"props",void 0),g(this,"count",void 0),this.props=Fk(this,e),this.id=this.props.id,this.count=Wk++}clone(e){const{props:n}=this,i={};for(const r in n[Mr])r in n[$n]?i[r]=n[$n][r]:r in n[zi]&&(i[r]=n[zi][r]);return new this.constructor({...n,...i,...e})}}g(bg,"componentName","Component");g(bg,"defaultProps",{});const Hk=Object.freeze({});class $k{constructor(e){g(this,"component",void 0),g(this,"onAsyncPropUpdated",void 0),g(this,"asyncProps",void 0),g(this,"oldProps",void 0),g(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Hk}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[ic]||this.component;const n=e[$n]||{},i=e[zi]||e,r=e[Mr]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in i){const o=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(rE(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,r),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,r)}this._onResolve(e,s)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.props[ii];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class Xk extends $k{constructor({attributeManager:e,layer:n}){super(n),g(this,"attributeManager",void 0),g(this,"needsRedraw",void 0),g(this,"needsUpdate",void 0),g(this,"subLayers",void 0),g(this,"usesPickingColorCache",void 0),g(this,"hasPickingBuffer",void 0),g(this,"changeFlags",void 0),g(this,"viewport",void 0),g(this,"uniformTransitions",void 0),g(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,r=i==null?void 0:i.props.fetch;return r?r(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const r=i.props.onDataLoad;e==="data"&&r&&r(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const Yk="layer.changeFlag",Zk="layer.initialize",qk="layer.update",Kk="layer.finalize",Qk="layer.matched",gy=2**24-1,Jk=Object.freeze([]),eN=Vo(({oldViewport:t,viewport:e})=>t.equals(e));let Zt=new Uint8ClampedArray(0);const tN={data:{type:"data",value:Jk,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:o}=n.context;if(r=r||n.getLoadOptions(),i=i||n.props.loaders,s){var a;r={...r,fetch:{...(a=r)===null||a===void 0?void 0:a.fetch,signal:s}}}let l=o.contains(t);return!l&&!r&&(o.add({resourceId:t,data:ql(t,i),persistent:!1}),l=!0),l?o.subscribe({resourceId:t,onChange:c=>{var u;return(u=n.internalState)===null||u===void 0?void 0:u.reloadAsyncProp(e,c)},consumerId:n.id,requestId:e}):ql(t,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:K.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Cn extends bg{constructor(...e){super(...e),g(this,"internalState",null),g(this,"lifecycle",rr.NO_STATE),g(this,"context",void 0),g(this,"state",void 0),g(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Ce(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=Xw(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,o]=Hw(i,n.pixelProjectionMatrix);return e.length===2?[r,s]:[r,s,o]}unproject(e){return Ce(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Ce(this.internalState);const i=this.internalState.viewport||this.context.viewport;return wR(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===K.DEFAULT||e===K.LNGLAT||e===K.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Ce(e instanceof Uint8Array);const[n,i,r]=e;return n+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Pk(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=Ck(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const r of i)n.invalidateAll(r);else n.invalidateAll();if(n){const{props:r}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=n.attributes,c=a||l;c&&(o&&c.constant&&(c.constant=!1,n.invalidate(c.id)),!c.value&&!o&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){var i,r;if(n&&(e.message="".concat(n,": ").concat(e.message)),!((i=(r=this.props).onError)!==null&&i!==void 0&&i.call(r,e))){var s,o;(s=this.context)===null||s===void 0||(o=s.onError)===null||o===void 0||o.call(s,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!eN({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const r in n)Object.defineProperty(i,r,{value:n[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(Zt.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>gy&&$.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Zt=Xr.allocate(Zt,n,{size:3,copy:!0,maxCount:Math.max(n,gy)});const r=Math.floor(Zt.length/3),s=[];for(let o=i;o<r;o++)this.encodePickingColor(o,s),Zt[o*3+0]=s[0],Zt[o*3+1]=s[1],Zt[o*3+2]=s[2]}e.value=Zt.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),r=e.userData.excludeAttributes||{},s=i.getShaderAttributes(n,r);e.setAttributes(s)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i;if(!r)return;const s=r.getVertexOffset(e),o=r.getVertexOffset(e+1);r.buffer.subData({data:new Uint8Array(o-s),offset:s})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Zt.buffer&&(i.value=Zt.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Ce(!this.internalState),Ce(Number.isFinite(this.props.coordinateSystem)),Ue(Zk,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Xk({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>($.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new yk(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ue(Qk,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ue(qk,this,e),!e)return;const n=this.props,i=this.context,r=this.internalState,s=i.viewport,o=this._updateUniformTransition();r.propsInTransition=o,i.viewport=r.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(i.gl)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{i.viewport=s,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){Ue(Kk,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,s=this.context;this.props=this.internalState.propsInTransition||r;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:a}=this.props,l=a&&a(n)||[0,0];Tn(s.gl,{polygonOffset:l}),Ut(s.gl,i,()=>{const c={moduleParameters:e,uniforms:n,parameters:i,context:s};for(const u of this.props.extensions)u.draw.call(this,c,u);this.draw(c)})}finally{this.props=r}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let s=!1;switch(r){case"dataChanged":const o=e[r],a=n[r];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[r]||(n[r]=e[r],s=!0)}s&&Ue(Yk,this,r,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=_k(e,n);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged){var r;this.internalState.uniformTransitions.add(s,n[s],e[s],(r=e.transitions)===null||r===void 0?void 0:r[s])}return this.setChangeFlags(i)}validateProps(){vk(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new hk(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=i;if(n||r.autoHighlight!==o||r.highlightedObjectIndex!==a||r.highlightColor!==l){const c={};o||(c.pickingSelectedColor=null),Array.isArray(l)&&(c.pickingHighlightColor=l),(n||a!==r.highlightedObjectIndex)&&(c.pickingSelectedColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setModuleParameters(c)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(e):!1;if(n=n||r,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}g(Cn,"defaultProps",tN);g(Cn,"layerName","Layer");const nN="compositeLayer.renderLayers";class zc extends Cn{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,r)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:f,coordinateOrigin:h,wrapLongitude:d,positionFormat:p,modelMatrix:_,extensions:x,fetch:y,operation:m,_subLayerProps:w}=this.props,T={id:"",updateTriggers:{},opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:f,coordinateOrigin:h,wrapLongitude:d,positionFormat:p,modelMatrix:_,extensions:x,fetch:y,operation:m},b=w&&e.id&&w[e.id],P=b&&b.updateTriggers,L=e.id||"sublayer";if(b){const C=this.props[ii],M=e.type?e.type._propTypes:{};for(const R in b){const V=M[R]||C[R];V&&V.type==="accessor"&&(b[R]=this.getSubLayerAccessor(b[R]))}}Object.assign(T,e,b),T.id="".concat(this.props.id,"-").concat(L),T.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...P};for(const C of x){const M=C.getSubLayerProps.call(this,C);M&&Object.assign(T,M,{updateTriggers:Object.assign(T.updateTriggers,M.updateTriggers)})}return T}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();if(r){const s=this.renderLayers();i=kc(s,Boolean),this.internalState.subLayers=i}Ue(nN,this,r,i);for(const s of i)s.parent=this}}g(zc,"layerName","CompositeLayer");const ka=Math.PI/180,py=180/Math.PI,ml=6370972,_r=256;function iN(){const t=_r/ml,e=Math.PI/180*_r;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class rN extends Wi{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,nearZMultiplier:s=.1,farZMultiplier:o=2,resolution:a=10}=e;let{height:l,altitude:c=1.5}=e;l=l||1,c=Math.max(.75,c);const u=new qe().lookAt({eye:[0,-c,0],up:[0,0,1]}),f=Math.pow(2,r);u.rotateX(n*ka),u.rotateZ(-i*ka),u.scale(f/l);const h=Math.atan(.5/c),d=_r*2*f/l;super({...e,height:l,viewMatrix:u,longitude:i,latitude:n,zoom:r,distanceScales:iN(),fovyRadians:h*2,focalDistance:c,near:s,far:Math.min(2,1/d+1)*c*o}),g(this,"longitude",void 0),g(this,"latitude",void 0),g(this,"resolution",void 0),this.latitude=n,this.longitude=i,this.resolution=a}get projectionMode(){return kt.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,this.height/2],n),r=this.unproject([this.width/2,0],n),s=this.unproject([this.width,this.height/2],n),o=this.unproject([this.width/2,this.height],n);return s[0]<this.longitude&&(s[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],s[0],r[0],o[0]),Math.min(i[1],s[1],r[1],o[1]),Math.max(i[0],s[0],r[0],o[0]),Math.max(i[1],s[1],r[1],o[1])]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,{pixelUnprojectionMatrix:l}=this;let c;if(Number.isFinite(o))c=sf(l,[r,a,o,1]);else{const d=sf(l,[r,a,-1,1]),p=sf(l,[r,a,1,1]),_=((i||0)/ml+1)*_r,x=Hu(Pw([],d,p)),y=Hu(d),m=Hu(p),T=4*((4*y*m-(x-y-m)**2)/16)/x,b=Math.sqrt(y-T),P=Math.sqrt(Math.max(0,_*_-T)),L=(b-P)/Math.sqrt(x);c=P3([],d,p,L)}const[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(i)?[u,f,i]:[u,f]}projectPosition(e){const[n,i,r=0]=e,s=n*ka,o=i*ka,a=Math.cos(o),l=(r/ml+1)*_r;return[Math.sin(s)*a*l,-Math.cos(s)*a*l,Math.sin(o)*l]}unprojectPosition(e){const[n,i,r]=e,s=Aw(e),o=Math.asin(r/s),l=Math.atan2(n,-i)*py,c=o*py,u=(s/_r-1)*ml;return[l,c,u]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,n){const i=this.unproject(n);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function sf(t,e){const n=ns([],e,t);return pg(n,n,1/n[3]),n}class Pg{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){g(this,"opts",void 0),e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&Ft(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:n}=e.constructor,i={updateTriggers:{}};for(const r in n)if(r in this.props){const s=n[r],o=this.props[r];i[r]=o,s&&s.type==="accessor"&&(i.updateTriggers[r]=this.props.updateTriggers[r],typeof o=="function"&&(i[r]=this.getSubLayerAccessor(o)))}return i}initializeState(e,n){}updateState(e,n){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,n){}finalizeState(e,n){}}g(Pg,"defaultProps",{});g(Pg,"extensionName","LayerExtension");class dE{constructor(e){g(this,"opts",void 0),g(this,"typedArrayManager",void 0),g(this,"indexStarts",[0]),g(this,"vertexStarts",[0]),g(this,"vertexCount",0),g(this,"instanceCount",0),g(this,"attributes",void 0),g(this,"_attributeDefs",void 0),g(this,"data",void 0),g(this,"getGeometry",void 0),g(this,"geometryBuffer",void 0),g(this,"buffers",void 0),g(this,"positionSize",void 0),g(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=Xr,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:r,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=n,this.getGeometry=r,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=i,this.normalize=l,s&&(Ce(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),l||(i.positions=s)),this.geometryBuffer=i.positions,Array.isArray(a))for(const c of a)this._rebuildGeometry(c);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?sE(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:r,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in r)o.release(i[a]),i[a]=null;else{const l=s[a];l.copy=n,i[a]=o.allocate(i[a],e,l)}}_forEachGeometry(e,n,i){const{data:r,getGeometry:s}=this,{iterable:o,objectInfo:a}=Dc(r,n,i);for(const l of o){a.index++;const c=s?s(l,a):null;e(c,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:r}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},c={};if(e||(n=[0],i=[0]),this.normalize||!o)this._forEachGeometry((f,h)=>{const d=f&&this.normalizeGeometry(f);c[h]=d,i[h+1]=i[h]+(d?this.getGeometrySize(d):0)},a,l),r=i[i.length-1];else if(i=s.startIndices,r=i[s.length]||0,ArrayBuffer.isView(o))r=r||o.length/this.positionSize;else if(o instanceof te){const f=o.accessor.stride||this.positionSize*4;r=r||o.byteLength/f}else if(o.buffer){const f=o.stride||this.positionSize*4;r=r||o.buffer.byteLength/f}else if(o.value){const f=o.value,h=o.stride/f.BYTES_PER_ELEMENT||this.positionSize;r=r||f.length/h}this._allocate(r,!!e),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=r;const u={};this._forEachGeometry((f,h)=>{const d=c[h]||f;u.vertexStart=i[h],u.indexStart=n[h];const p=h<i.length-1?i[h+1]:r;u.geometrySize=p-i[h],u.geometryIndex=h,this.updateGeometryAttributes(d,u)},a,l),this.vertexCount=n[n.length-1]}}const sN=typeof window<"u"?N.useLayoutEffect:N.useEffect,oN=sN;function oc(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const aN={position:"absolute",zIndex:-1};function gE(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>gE(n,e));if(Bc(t)){if(lN(t))return e.style=aN,N.cloneElement(t,e);if(cN(t))return N.cloneElement(t,e)}return t}function Bc(t){return t&&typeof t=="object"&&"type"in t||!1}function lN(t){const e=t.type,n=e&&e.defaultProps;return n&&n.mapStyle}function cN(t){const e=t.type;return e&&e.deckGLViewProps}function Gh(t){if(typeof t=="function")return N.createElement(Yr,{},t);if(Array.isArray(t))return t.map(Gh);if(Bc(t)){if(t.type===N.Fragment)return Gh(t.props.children);if(oc(t.type,Yr))return t}return t}function uN({children:t,layers:e=[],views:n=null}){const i=[],r=[],s={};return N.Children.forEach(Gh(t),o=>{if(Bc(o)){const a=o.type;if(oc(a,Cn)){const l=fN(a,o.props);r.push(l)}else i.push(o);if(oc(a,Yr)&&a!==Yr&&o.props.id){const l=new a(o.props);s[l.id]=l}}else o&&i.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=r.length>0?[...r,...e]:e,{layers:e,children:i,views:n}}function fN(t,e){const n={},i=t.defaultProps||{};for(const r in e)i[r]!==e[r]&&(n[r]=e[r]);return new t(n)}function hN({children:t,deck:e,ContextProvider:n}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const r={},s=i.views[0].id;for(const o of t){let a=s,l=o;Bc(o)&&oc(o.type,Yr)&&(a=o.props.id||s,l=o.props.children);const c=i.getViewport(a),u=i.getViewState(a);if(c){u.padding=c.padding;const{x:f,y:h,width:d,height:p}=c;l=gE(l,{x:f,y:h,width:d,height:p,viewport:c,viewState:u}),r[a]||(r[a]={viewport:c,children:[]}),r[a].children.push(l)}}return Object.keys(r).map(o=>{const{viewport:a,children:l}=r[o],{x:c,y:u,width:f,height:h}=a,d={position:"absolute",left:c,top:u,width:f,height:h},p="view-".concat(o),_=N.createElement("div",{key:p,id:p,style:d},...l);if(n){const x={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:y=>{y.viewId=o,e._onViewStateChange(y)}};return N.createElement(n,{key:p,value:x},_)}return _})}const dN={mixBlendMode:null};function gN({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},r={left:0,top:0};if(n)for(const s in n)s in dN?r[s]=n[s]:i[s]=n[s];return{containerStyle:i,canvasStyle:r}}function pN(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function pE(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function mN(t,e,n){const i=new e({...n,_customRender:r=>{t.redrawReason=r;const s=i.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():pE(t)}});return i}const mE=N.forwardRef((t,e)=>{const[n,i]=N.useState(0),s=N.useRef({control:null,version:n,forceUpdate:()=>i(b=>b+1)}).current,o=N.useRef(null),a=N.useRef(null),l=N.useMemo(()=>uN(t),[t.layers,t.views,t.children]);let c=!0;const u=b=>{var P;return c&&t.viewState?(s.viewStateUpdateRequested=b,null):(s.viewStateUpdateRequested=null,(P=t.onViewStateChange)===null||P===void 0?void 0:P.call(t,b))},f=b=>{if(c)s.interactionStateUpdateRequested=b;else{var P;s.interactionStateUpdateRequested=null,(P=t.onInteractionStateChange)===null||P===void 0||P.call(t,b)}},h=N.useMemo(()=>{const b={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:u,onInteractionStateChange:f};return delete b._customRender,s.deck&&s.deck.setProps(b),b},[t]);N.useEffect(()=>{const b=t.Deck||Fc;return s.deck=mN(s,b,{...h,parent:o.current,canvas:a.current}),()=>{var P;return(P=s.deck)===null||P===void 0?void 0:P.finalize()}},[]),oN(()=>{pE(s);const{viewStateUpdateRequested:b,interactionStateUpdateRequested:P}=s;b&&u(b),P&&f(P)}),N.useImperativeHandle(e,()=>pN(s),[]);const d=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:p,width:_,height:x,id:y,style:m}=t,{containerStyle:w,canvasStyle:T}=N.useMemo(()=>gN({width:_,height:x,style:m}),[_,x,m]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===d||s.version!==n){s.lastRenderedViewports=d,s.version=n;const b=hN({children:l.children,deck:s.deck,ContextProvider:p}),P=N.createElement("canvas",{key:"canvas",id:y||"deckgl-overlay",ref:a,style:T});s.control=N.createElement("div",{id:"".concat(y||"deckgl","-wrapper"),ref:o,style:w},[P,b])}return c=!1,s.control});mE.defaultProps=Fc.defaultProps;const yN=mE,vN="modulepreload",_N=function(t){return"/web_apps/vite-scratch/dist/"+t},my={},wN=function(e,n,i){if(!n||n.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=_N(s),s in my)return;my[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let u=r.length-1;u>=0;u--){const f=r[u];if(f.href===s&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":vN,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,f)=>{c.addEventListener("load",u),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())},EN=N.createContext(null);function xN(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function yy(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function vy(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const r=t.center;t.center=new r.constructor(n.longitude,n.latitude),i=i||r!==t.center}if("zoom"in n){const r=t.zoom;t.zoom=n.zoom,i=i||r!==t.zoom}if("bearing"in n){const r=t.bearing;t.bearing=n.bearing,i=i||r!==t.bearing}if("pitch"in n){const r=t.pitch;t.pitch=n.pitch,i=i||r!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const TN=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function _y(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{const r=e[i.ref];let s=null;if("interactive"in i&&(s={...i},delete s.interactive),r){s=s||{...i},delete s.ref;for(const o of TN)o in r&&(s[o]=r[o])}return s||i});return{...t,layers:n}}function SN(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===s}function jn(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!jn(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!jn(t[r],e[r]))return!1;return!0}return!1}const wy={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},of={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Ey={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},bN=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],PN=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Zr{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const s=this.props[Ey[r.type]];s&&s(r)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const s=this.props[wy[r.type]];s&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),s(r),delete r.features)},this._onCameraEvent=r=>{if(!this._internalUpdate){const s=this.props[of[r.type]];s&&s(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const r=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||r||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=Zr.savedMaps.pop();if(!i)return null;const r=i.map,s=r.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);r._container=n,i.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:o}=e;return o&&(o.bounds?r.fitBounds(o.bounds,{...o.fitBoundsOptions,duration:0}):i._updateViewState(o,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),r.triggerRepaint(),i}_initialize(e){const{props:n}=this,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||AN()||null,container:e,style:_y(n.mapStyle)},r=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),n.gl){const c=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=c,n.gl)}const s=new this._MapClass(i);r.padding&&s.setPadding(r.padding),n.cursor&&(s.getCanvas().style.cursor=n.cursor),this._createShadowTransform(s);const o=s._render;s._render=c=>{this._inRender=!0,o.call(s,c),this._inRender=!1};const a=s._renderTaskQueue.run;s._renderTaskQueue.run=c=>{a.call(s._renderTaskQueue,c),this._onBeforeRepaint()},s.on("render",()=>this._onAfterRepaint());const l=s.fire;s.fire=this._fireEvent.bind(this,l),s.on("resize",()=>{this._renderTransform.resize(s.transform.width,s.transform.height)}),s.on("styledata",()=>this._updateStyleComponents(this.props,{})),s.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const c in wy)s.on(c,this._onPointerEvent);for(const c in of)s.on(c,this._onCameraEvent);for(const c in Ey)s.on(c,this._onEvent);this._map=s}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),Zr.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=xN(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,r=this._renderTransform,{zoom:s,pitch:o,bearing:a}=r,l=i.isMoving();l&&(r.cameraElevationReference="sea");const c=vy(r,{...yy(i.transform),...e});if(l&&(r.cameraElevationReference="ground"),c&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=s!==r.zoom),u.rotate||(u.rotate=a!==r.bearing),u.pitch||(u.pitch=o!==r.pitch)}return l||vy(i.transform,e),c}_updateSettings(e,n){const i=this._map;let r=!1;for(const s of bN)s in e&&!jn(e[s],n[s])&&(r=!0,i[`set${s[0].toUpperCase()}${s.slice(1)}`](e[s]));return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor),e.mapStyle!==n.mapStyle){const i={diff:e.styleDiffing};return"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(_y(e.mapStyle),i),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let r=!1;return i.style.loaded()&&("light"in e&&!jn(e.light,n.light)&&(r=!0,i.setLight(e.light)),"fog"in e&&!jn(e.fog,n.fog)&&(r=!0,i.setFog(e.fog)),"terrain"in e&&!jn(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(r=!0,i.setTerrain(e.terrain))),r}_updateHandlers(e,n){const i=this._map;let r=!1;for(const s of PN){const o=e[s];jn(o,n[s])||(r=!0,o?i[s].enable(o):i[s].disable())}return r}_queryRenderedFeatures(e){const n=this._map,{interactiveLayerIds:i=[]}=this.props;try{return n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),l=a.length>0;!l&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,l&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,i){const r=this._map,s=r.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in of&&(typeof n=="object"&&(n.viewState=yy(s)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,n,i),r.transform=s,r):(e.call(r,n,i),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=n}}}Zr.savedMaps=[];function AN(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const LN=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function CN(t,e){if(!t)return null;const n=t.map,i={getMap:()=>n,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>t.transform.locationPoint(e.LngLat.convert(r)),unproject:r=>t.transform.pointLocation(e.Point.convert(r)),queryTerrainElevation:(r,s)=>{const o=n.transform;n.transform=t.transform;const a=n.queryTerrainElevation(r,s);return n.transform=o,a}};for(const r of IN(n))!(r in i)&&!LN.includes(r)&&(i[r]=n[r].bind(n));return i}function IN(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const MN=typeof document<"u"?N.useLayoutEffect:N.useEffect,RN=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function ON(t,e){for(const n of RN)n in e&&(t[n]=e[n]);e.RTLTextPlugin&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(e.RTLTextPlugin,n=>{n&&console.error(n)},!1)}const Uc=N.createContext(null),kN={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:t=>console.error(t.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},Ag=N.forwardRef((t,e)=>{const n=N.useContext(EN),[i,r]=N.useState(null),s=N.useRef(),{current:o}=N.useRef({mapLib:null,map:null});N.useEffect(()=>{const c=t.mapLib;let u=!0,f;return Promise.resolve(c||wN(()=>import("./mapbox-gl-03cc953c.js").then(h=>h.m),[])).then(h=>{if(u){if(h.Map||(h=h.default),!h||!h.Map)throw new Error("Invalid mapLib");if(ON(h,t),h.supported(t))t.reuseMaps&&(f=Zr.reuse(t,s.current)),f||(f=new Zr(h.Map,t,s.current)),o.map=CN(f,h),o.mapLib=h,r(f),n==null||n.onMapMount(o.map,t.id);else throw new Error("Map is not supported by this browser")}}).catch(h=>{t.onError({type:"error",target:null,originalEvent:null,error:h})}),()=>{u=!1,f&&(n==null||n.onMapUnmount(t.id),t.reuseMaps?f.recycle():f.destroy())}},[]),MN(()=>{i&&i.setProps(t)}),N.useImperativeHandle(e,()=>o.map,[i]);const a=N.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),l={height:"100%"};return N.createElement("div",{id:t.id,ref:s,style:a},i&&N.createElement(Uc.Provider,{value:o},N.createElement("div",{"mapboxgl-children":"",style:l},t.children)))});Ag.displayName="Map";Ag.defaultProps=kN;const NN=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Hi(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const r=e[i];Number.isFinite(r)&&!NN.test(i)?n[i]=`${r}px`:n[i]=r}}const FN={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function yE(t){const{map:e,mapLib:n}=N.useContext(Uc),i=N.useRef({props:t});i.current.props=t;const r=N.useMemo(()=>{let s=!1;N.Children.forEach(t.children,l=>{l&&(s=!0)});const o={...t,element:s?document.createElement("div"):null},a=new n.Marker(o).setLngLat([t.longitude,t.latitude]);return a.getElement().addEventListener("click",l=>{var c,u;(u=(c=i.current.props).onClick)===null||u===void 0||u.call(c,{type:"click",target:a,originalEvent:l})}),a.on("dragstart",l=>{var c,u;const f=l;f.lngLat=r.getLngLat(),(u=(c=i.current.props).onDragStart)===null||u===void 0||u.call(c,f)}),a.on("drag",l=>{var c,u;const f=l;f.lngLat=r.getLngLat(),(u=(c=i.current.props).onDrag)===null||u===void 0||u.call(c,f)}),a.on("dragend",l=>{var c,u;const f=l;f.lngLat=r.getLngLat(),(u=(c=i.current.props).onDragEnd)===null||u===void 0||u.call(c,f)}),a},[]);return N.useEffect(()=>(r.addTo(e.getMap()),()=>{r.remove()}),[]),N.useEffect(()=>{Hi(r.getElement(),t.style)},[t.style]),(r.getLngLat().lng!==t.longitude||r.getLngLat().lat!==t.latitude)&&r.setLngLat([t.longitude,t.latitude]),t.offset&&!SN(r.getOffset(),t.offset)&&r.setOffset(t.offset),r.isDraggable()!==t.draggable&&r.setDraggable(t.draggable),r.getRotation()!==t.rotation&&r.setRotation(t.rotation),r.getRotationAlignment()!==t.rotationAlignment&&r.setRotationAlignment(t.rotationAlignment),r.getPitchAlignment()!==t.pitchAlignment&&r.setPitchAlignment(t.pitchAlignment),r.getPopup()!==t.popup&&r.setPopup(t.popup),Ks.createPortal(t.children,r.getElement())}yE.defaultProps=FN;N.memo(yE);function xy(t){return new Set(t?t.trim().split(/\s+/):[])}function DN(t){const{map:e,mapLib:n}=N.useContext(Uc),i=N.useMemo(()=>document.createElement("div"),[]),r=N.useRef({props:t});r.current.props=t;const s=N.useMemo(()=>{const o={...t},a=new n.Popup(o).setLngLat([t.longitude,t.latitude]);return a.once("open",l=>{var c,u;(u=(c=r.current.props).onOpen)===null||u===void 0||u.call(c,l)}),a},[]);if(N.useEffect(()=>{const o=a=>{var l,c;(c=(l=r.current.props).onClose)===null||c===void 0||c.call(l,a)};return s.on("close",o),s.setDOMContent(i).addTo(e.getMap()),()=>{s.off("close",o),s.isOpen()&&s.remove()}},[]),N.useEffect(()=>{Hi(s.getElement(),t.style)},[t.style]),s.isOpen()&&((s.getLngLat().lng!==t.longitude||s.getLngLat().lat!==t.latitude)&&s.setLngLat([t.longitude,t.latitude]),t.offset&&!jn(s.options.offset,t.offset)&&s.setOffset(t.offset),(s.options.anchor!==t.anchor||s.options.maxWidth!==t.maxWidth)&&(s.options.anchor=t.anchor,s.setMaxWidth(t.maxWidth)),s.options.className!==t.className)){const o=xy(s.options.className),a=xy(t.className);for(const l of o)a.has(l)||s.removeClassName(l);for(const l of a)o.has(l)||s.addClassName(l);s.options.className=t.className}return Ks.createPortal(t.children,i)}N.memo(DN);function Ho(t,e,n,i){const r=N.useContext(Uc),s=N.useMemo(()=>t(r),[]);return N.useEffect(()=>{const o=i||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,l=typeof n=="function"?n:typeof e=="function"?e:null,{map:c}=r;return c.hasControl(s)||(c.addControl(s,o==null?void 0:o.position),a&&a(r)),()=>{l&&l(r),c.hasControl(s)&&c.removeControl(s)}},[]),s}function zN(t){const e=Ho(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return N.useEffect(()=>{Hi(e._container,t.style)},[t.style]),null}N.memo(zN);function BN(t){const e=Ho(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return N.useEffect(()=>{Hi(e._controlContainer,t.style)},[t.style]),null}N.memo(BN);const vE=N.forwardRef((t,e)=>{const n=N.useRef({props:t}),i=Ho(({mapLib:r})=>{const s=new r.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var l,c;(c=(l=n.current.props).onGeolocate)===null||c===void 0||c.call(l,a)}),s.on("error",a=>{var l,c;(c=(l=n.current.props).onError)===null||c===void 0||c.call(l,a)}),s.on("outofmaxbounds",a=>{var l,c;(c=(l=n.current.props).onOutOfMaxBounds)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationstart",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationStart)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationend",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationEnd)===null||c===void 0||c.call(l,a)}),s},{position:t.position});return n.current.props=t,N.useImperativeHandle(e,()=>({trigger:()=>i.trigger()}),[]),N.useEffect(()=>{Hi(i._container,t.style)},[t.style]),null});vE.displayName="GeolocateControl";N.memo(vE);function UN(t){const e=Ho(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return N.useEffect(()=>{Hi(e._container,t.style)},[t.style]),null}N.memo(UN);const VN={unit:"metric",maxWidth:100};function _E(t){const e=Ho(({mapLib:n})=>new n.ScaleControl(t),{position:t.position});return(e.options.unit!==t.unit||e.options.maxWidth!==t.maxWidth)&&(e.options.maxWidth=t.maxWidth,e.setUnit(t.unit)),N.useEffect(()=>{Hi(e._container,t.style)},[t.style]),null}_E.defaultProps=VN;N.memo(_E);const jN=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,GN=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,WN=1024,HN=4,Ty=()=>{},Sy={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function $N(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function XN(t,e,n,i){const r=Math.min(n/e.width,i/e.height),s=Math.floor(e.width*r),o=Math.floor(e.height*r);return r===1?{data:e,width:s,height:o}:(t.canvas.height=o,t.canvas.width=s,t.clearRect(0,0,s,o),t.drawImage(e,0,0,e.width,e.height,0,0,s,o),{data:t.canvas,width:s,height:o})}function Eo(t){return t&&(t.id||t.url)}function YN(t,e,n,i){const r=t.width,s=t.height,o=new gt(t.gl,{width:e,height:n,parameters:i});return j2(t,o,{targetY:0,width:r,height:s}),t.delete(),o}function by(t,e,n){for(let i=0;i<e.length;i++){const{icon:r,xOffset:s}=e[i],o=Eo(r);t[o]={...r,x:s,y:n}}}function ZN({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const c=t[l],u=Eo(c);if(!n[u]){const{height:f,width:h}=c;i+h+e>o&&(by(n,a,r),i=0,r=s+r+e,s=0,a=[]),a.push({icon:c,xOffset:i}),i=i+h+e,s=Math.max(s,f)}}return a.length>0&&by(n,a,r),{mapping:n,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:o,canvasHeight:$N(s+r+e)}}function qN(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:r,objectInfo:s}=Dc(t);for(const o of r){s.index++;const a=e(o,s),l=Eo(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!i[l]&&(!n[l]||a.url!==n[l].url)&&(i[l]={...a,source:o,sourceIndex:s.index})}return i}class KN{constructor(e,{onUpdate:n=Ty,onError:i=Ty}){g(this,"gl",void 0),g(this,"onUpdate",void 0),g(this,"onError",void 0),g(this,"_loadOptions",null),g(this,"_texture",null),g(this,"_externalTexture",null),g(this,"_mapping",{}),g(this,"_textureParameters",null),g(this,"_pendingCount",0),g(this,"_autoPacking",!1),g(this,"_xOffset",0),g(this,"_yOffset",0),g(this,"_rowHeight",0),g(this,"_buffer",HN),g(this,"_canvasWidth",WN),g(this,"_canvasHeight",0),g(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Eo(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:r,textureParameters:s}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),r&&(this._mapping=r),i){var o;(o=this._texture)===null||o===void 0||o.delete(),this._texture=null,this._externalTexture=i}s&&(this._textureParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(qN(e,n,this._mapping)||{});if(i.length>0){const{mapping:r,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:l}=ZN({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=r,this._xOffset=s,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=new gt(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||Sy})),this._texture.height!==this._canvasHeight&&(this._texture=YN(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||Sy)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,ql(i.url,this._loadOptions).then(r=>{const s=Eo(i),o=this._mapping[s],{x:a,y:l,width:c,height:u}=o,{data:f,width:h,height:d}=XN(n,r,c,u);this._texture.setSubImageData({data:f,x:a+(c-h)/2,y:l+(u-d)/2,width:h,height:d}),o.width=h,o.height=d,this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const wE=[0,0,0,255],QN={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:wE},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class Vc extends Cn{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:jN,fs:GN,modules:[jo,Go]})}initializeState(){this.state={iconManager:new KN(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:wE},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:c,textureParameters:u}=n,{iconManager:f}=this.state,h=o||this.internalState.isAsyncPropLoading("iconAtlas");if(f.setProps({loadOptions:n.loadOptions,autoPacking:!h,iconAtlas:o,iconMapping:h?a:null,textureParameters:u}),h?i.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&f.packIcons(l,c),r.extensionsChanged){var d;const{gl:p}=this.context;(d=this.state.model)===null||d===void 0||d.delete(),this.state.model=this._getModel(p),s.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,c=l.getTexture();c&&this.state.model.setUniforms(e).setUniforms({iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeUnits:ki[s],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,billboard:o,alphaCutoff:a}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new Di(e,{...this.getShaders(),id:this.props.id,geometry:new Uo({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;i?i(e):$.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:r=n/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-r,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:r,height:s}=this.state.iconManager.getIconMapping(e);return[n,i,r,s]}}g(Vc,"defaultProps",QN);g(Vc,"layerName","IconLayer");const JN=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,eF=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Py=[0,0,0,255],tF={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Py},getLineColor:{type:"accessor",value:Py},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Lg extends Cn{getShaders(){return super.getShaders({vs:JN,fs:eF,modules:[jo,Go]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,stroked:o,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:o?1:0,filled:a,billboard:l,antialiasing:c,radiusUnits:ki[n],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,lineWidthUnits:ki[u],lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Di(e,{...this.getShaders(),id:this.props.id,geometry:new Uo({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}g(Lg,"defaultProps",tF);g(Lg,"layerName","ScatterplotLayer");const EE={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function xE(t,e,n={}){return nF(t,n)!==e?(iF(t,n),!0):!1}function nF(t,e={}){return Math.sign(ac(t,e))}function ac(t,e={}){const{start:n=0,end:i=t.length}=e,r=e.size||2;let s=0;for(let o=n,a=i-r;o<i;o+=r)s+=(t[o]-t[a])*(t[o+1]+t[a+1]),a=o;return s/2}function iF(t,e){const{start:n=0,end:i=t.length,size:r=2}=e,s=(i-n)/r,o=Math.floor(s/2);for(let a=0;a<o;++a){const l=n+a*r,c=n+(s-1-a)*r;for(let u=0;u<r;++u){const f=t[l+u];t[l+u]=t[c+u],t[c+u]=f}}}function rF(t,e,n=2,i){const r=e&&e.length,s=r?e[0]*n:t.length;let o=TE(t,0,s,n,!0,i&&i[0]);const a=[];if(!o||o.next===o.prev)return a;let l,c,u,f,h,d,p;if(r&&(o=cF(t,e,o,n,i)),t.length>80*n){f=c=t[0],h=u=t[1];for(let _=n;_<s;_+=n)d=t[_],p=t[_+1],d<f&&(f=d),p<h&&(h=p),d>c&&(c=d),p>u&&(u=p);l=Math.max(c-f,u-h),l=l!==0?1/l:0}return xo(o,a,n,f,h,l),a}function TE(t,e,n,i,r,s){let o,a;if(s===void 0&&(s=ac(t,{start:e,end:n,size:i})),r===s<0)for(o=e;o<n;o+=i)a=Ay(o,t[o],t[o+1],a);else for(o=n-i;o>=e;o-=i)a=Ay(o,t[o],t[o+1],a);return a&&jc(a,a.next)&&(So(a),a=a.next),a}function li(t,e){if(!t)return t;e||(e=t);let n=t,i;do if(i=!1,!n.steiner&&(jc(n,n.next)||de(n.prev,n,n.next)===0)){if(So(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function xo(t,e,n,i,r,s,o){if(!t)return;!o&&s&&gF(t,i,r,s);let a=t,l,c;for(;t.prev!==t.next;){if(l=t.prev,c=t.next,s?oF(t,i,r,s):sF(t)){e.push(l.i/n),e.push(t.i/n),e.push(c.i/n),So(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=aF(li(t),e,n),xo(t,e,n,i,r,s,2)):o===2&&lF(t,e,n,i,r,s):xo(li(t),e,n,i,r,s,1);break}}}function sF(t){const e=t.prev,n=t,i=t.next;if(de(e,n,i)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(wr(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&de(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function oF(t,e,n,i){const r=t.prev,s=t,o=t.next;if(de(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,f=Wh(a,l,e,n,i),h=Wh(c,u,e,n,i);let d=t.prevZ,p=t.nextZ;for(;d&&d.z>=f&&p&&p.z<=h;){if(d!==t.prev&&d!==t.next&&wr(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&de(d.prev,d,d.next)>=0||(d=d.prevZ,p!==t.prev&&p!==t.next&&wr(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&de(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;d&&d.z>=f;){if(d!==t.prev&&d!==t.next&&wr(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&de(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=h;){if(p!==t.prev&&p!==t.next&&wr(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&de(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function aF(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!jc(r,s)&&SE(r,i,i.next,s)&&To(r,s)&&To(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),So(i),So(i.next),i=t=s),i=i.next}while(i!==t);return li(i)}function lF(t,e,n,i,r,s){let o=t;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&yF(o,a)){let l=bE(o,a);o=li(o,o.next),l=li(l,l.next),xo(o,e,n,i,r,s),xo(l,e,n,i,r,s);return}a=a.next}o=o.next}while(o!==t)}function cF(t,e,n,i,r){const s=[];let o,a,l,c,u;for(o=0,a=e.length;o<a;o++)l=e[o]*i,c=o<a-1?e[o+1]*i:t.length,u=TE(t,l,c,i,!1,r&&r[o+1]),u===u.next&&(u.steiner=!0),s.push(mF(u));for(s.sort(uF),o=0;o<s.length;o++)fF(s[o],n),n=li(n,n.next);return n}function uF(t,e){return t.x-e.x}function fF(t,e){if(e=hF(t,e),e){const n=bE(e,t);li(e,e.next),li(n,n.next)}}function hF(t,e){let n=e;const i=t.x,r=t.y;let s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const h=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(h<=i&&h>s){if(s=h,h===i){if(r===n.y)return n;if(r===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(i===s)return o;const a=o,l=o.x,c=o.y;let u=1/0,f;n=o;do i>=n.x&&n.x>=l&&i!==n.x&&wr(r<c?i:s,r,l,c,r<c?s:i,r,n.x,n.y)&&(f=Math.abs(r-n.y)/(i-n.x),To(n,t)&&(f<u||f===u&&(n.x>o.x||n.x===o.x&&dF(o,n)))&&(o=n,u=f)),n=n.next;while(n!==a);return o}function dF(t,e){return de(t.prev,t,e.prev)<0&&de(e.next,t,t.next)<0}function gF(t,e,n,i){let r=t;do r.z===null&&(r.z=Wh(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,pF(r)}function pF(t){let e,n,i=1,r,s,o,a,l,c;do{for(s=t,t=null,c=null,r=0;s;){for(r++,a=s,o=0,n=0;n<i&&(o++,a=a.nextZ,!!a);n++);for(l=i;o>0||l>0&&a;)o!==0&&(l===0||!a||s.z<=a.z)?(e=s,s=s.nextZ,o--):(e=a,a=a.nextZ,l--),c?c.nextZ=e:t=e,e.prevZ=c,c=e;s=a}c.nextZ=null,i*=2}while(r>1);return t}function Wh(t,e,n,i,r){return t=32767*(t-n)*r,e=32767*(e-i)*r,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function mF(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function wr(t,e,n,i,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(i-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function yF(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!vF(t,e)&&(To(t,e)&&To(e,t)&&_F(t,e)&&(de(t.prev,t,e.prev)||de(t,e.prev,e))||jc(t,e)&&de(t.prev,t,t.next)>0&&de(e.prev,e,e.next)>0)}function de(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function jc(t,e){return t.x===e.x&&t.y===e.y}function SE(t,e,n,i){const r=Fa(de(t,e,n)),s=Fa(de(t,e,i)),o=Fa(de(n,i,t)),a=Fa(de(n,i,e));return!!(r!==s&&o!==a||r===0&&Na(t,n,e)||s===0&&Na(t,i,e)||o===0&&Na(n,t,i)||a===0&&Na(n,e,i))}function Na(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Fa(t){return t>0?1:t<0?-1:0}function vF(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&SE(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function To(t,e){return de(t.prev,t,t.next)<0?de(t,e,t.next)>=0&&de(t,t.prev,e)>=0:de(t,e,t.prev)<0||de(t,t.next,e)<0}function _F(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function bE(t,e){const n=new Hh(t.i,t.x,t.y),i=new Hh(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Ay(t,e,n,i){const r=new Hh(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function So(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Hh(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Dt(t,e){const n=e.length,i=t.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(t[i-n+s]!==e[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[i+r]=e[r];return!0}function $h(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function bo(t,e,n,i,r=[]){const s=i+e*n;for(let o=0;o<n;o++)r[o]=t[s+o];return r}function Xh(t,e,n,i,r=[]){let s,o;if(n&8)s=(i[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(i[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(i[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(i[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)r[a]=(o&1)===a?i[o]:s*(e[a]-t[a])+t[a];return r}function yl(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function PE(t,e){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let c=[];const u=[c],f=bo(t,0,n,o);let h,d;const p=LE(f,r,s,[]),_=[];Dt(c,f);for(let x=1;x<l;x++){for(h=bo(t,x,n,o,h),d=yl(h,p);d;){Xh(f,h,d,p,_);const y=yl(_,p);y&&(Xh(f,_,y,p,_),d=y),Dt(c,_),$h(f,_),EF(p,r,d),i&&c.length>n&&(c=[],u.push(c),Dt(c,f)),d=yl(h,p)}Dt(c,h),$h(f,h)}return i?u:u[0]}const Ly=0,wF=1;function Da(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function AE(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:t,types:o?new Array(t.length/i).fill(wF):null,holes:e||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:f,types:h,holes:d}=l.shift();xF(f,i,d[0]||f.length,c),u=LE(c[0],r,s,u);const p=yl(c[1],u);if(p){let _=Cy(f,h,i,0,d[0]||f.length,u,p);const x={pos:_[0].pos,types:_[0].types,holes:[]},y={pos:_[1].pos,types:_[1].types,holes:[]};l.push(x,y);for(let m=0;m<d.length;m++)_=Cy(f,h,i,d[m],d[m+1]||f.length,u,p),_[0]&&(x.holes.push(x.pos.length),x.pos=Da(x.pos,_[0].pos),o&&(x.types=Da(x.types,_[0].types))),_[1]&&(y.holes.push(y.pos.length),y.pos=Da(y.pos,_[1].pos),o&&(y.types=Da(y.types,_[1].types)))}else{const _={positions:f};o&&(_.edgeTypes=h),d.length&&(_.holeIndices=d),a.push(_)}}return a}function Cy(t,e,n,i,r,s,o){const a=(r-i)/n,l=[],c=[],u=[],f=[],h=[];let d,p,_;const x=bo(t,a-1,n,i);let y=Math.sign(o&8?x[1]-s[3]:x[0]-s[2]),m=e&&e[a-1],w=0,T=0;for(let b=0;b<a;b++)d=bo(t,b,n,i,d),p=Math.sign(o&8?d[1]-s[3]:d[0]-s[2]),_=e&&e[i/n+b],p&&y&&y!==p&&(Xh(x,d,o,s,h),Dt(l,h)&&u.push(m),Dt(c,h)&&f.push(m)),p<=0?(Dt(l,d)&&u.push(_),w-=p):u.length&&(u[u.length-1]=Ly),p>=0?(Dt(c,d)&&f.push(_),T+=p):f.length&&(f[f.length-1]=Ly),$h(x,d),y=p,m=_;return[w?{pos:l,types:e&&u}:null,T?{pos:c,types:e&&f}:null]}function LE(t,e,n,i){const r=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=s,i[2]=r+e,i[3]=s+e,i}function EF(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function xF(t,e,n,i){let r=1/0,s=-1/0,o=1/0,a=-1/0;for(let l=0;l<n;l+=e){const c=t[l],u=t[l+1];r=c<r?c:r,s=c>s?c:s,o=u<o?u:o,a=u>a?u:a}return i[0][0]=r,i[0][1]=o,i[1][0]=s,i[1][1]=a,i}const TF=85.051129;function SF(t,e){const{size:n=2,startIndex:i=0,endIndex:r=t.length,normalize:s=!0}=e||{},o=t.slice(i,r);CE(o,n,0,r-i);const a=PE(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)IE(l,n);return a}function bF(t,e=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let l=0,c=0;for(let f=0;f<=e.length;f++){const h=e[f]||t.length,d=c,p=PF(t,i,l,h);for(let _=p;_<h;_++)o[c++]=t[_];for(let _=l;_<p;_++)o[c++]=t[_];CE(o,i,d,c),AF(o,i,d,c,n==null?void 0:n.maxLatitude),l=h,a[f]=c}a.pop();const u=AE(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const f of u)IE(f.positions,i);return u}function PF(t,e,n,i){let r=-1,s=-1;for(let o=n+1;o<i;o+=e){const a=Math.abs(t[o]);a>r&&(r=a,s=o-1)}return s}function AF(t,e,n,i,r=TF){const s=t[n],o=t[i-e];if(Math.abs(s-o)>180){const a=bo(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,Dt(t,a),a[1]=Math.sign(a[1])*r,Dt(t,a),a[0]=s,Dt(t,a)}}function CE(t,e,n,i){let r=t[0],s;for(let o=n;o<i;o+=e){s=t[o];const a=s-r;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=r=s}}function IE(t,e){let n;const i=t.length/e;for(let s=0;s<i&&(n=t[s*e],(n+180)%360===0);s++);const r=-Math.round(n/360)*360;if(r!==0)for(let s=0;s<i;s++)t[s*e]+=r}function LF(t,e,n,i){let r;if(Array.isArray(t[0])){const s=t.length*e;r=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)r[o*e+a]=t[o][a]||0}else r=t;return n?PE(r,{size:e,gridResolution:n}):i?SF(r,{size:e}):r}const CF=1,IF=2,af=4;class MF extends dE{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?LF(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(Iy(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&Iy(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;i.fill(0,s,s+o),r?(i[s]=af,i[s+o-2]=af):(i[s]+=CF,i[s+o-2]+=IF),i[s+o-1]=af}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:r,geometrySize:s}=n,o=new Array(3);for(let a=r,l=0;l<s;a++,l++)this.getPointOnPath(e,l,o),i[a*3]=o[0],i[a*3+1]=o[1],i[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:r}=this;n*r>=e.length&&(n+=1-e.length/r);const s=n*r;return i[0]=e[s],i[1]=e[s+1],i[2]=r===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function Iy(t){return Array.isArray(t[0])}const RF=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,OF=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,ME=[0,0,0,255],kF={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:ME},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},lf={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Cg extends Cn{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:RF,fs:OF,modules:[jo,Go]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:lf,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:lf,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:lf,defaultValue:ME},instancePickingColors:{size:3,type:5121,accessor:(i,{index:r,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:r,s)}}),this.setState({pathTesselator:new MF({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||r.invalidateAll()}if(i.extensionsChanged){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),r.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:r,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:r,widthUnits:ki[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:c}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Di(e,{...this.getShaders(),id:this.props.id,geometry:new Uo({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}g(Cg,"defaultProps",kF);g(Cg,"layerName","PathLayer");var lc={},NF={get exports(){return lc},set exports(t){lc=t}};NF.exports=Gc;lc.default=Gc;function Gc(t,e,n){n=n||2;var i=e&&e.length,r=i?e[0]*n:t.length,s=RE(t,0,r,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,c,u,f,h,d;if(i&&(s=UF(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(var p=n;p<r;p+=n)f=t[p],h=t[p+1],f<a&&(a=f),h<l&&(l=h),f>c&&(c=f),h>u&&(u=h);d=Math.max(c-a,u-l),d=d!==0?32767/d:0}return Po(s,o,n,a,l,d,0),o}function RE(t,e,n,i,r){var s,o;if(r===qh(t,e,n,i)>0)for(s=e;s<n;s+=i)o=My(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=My(s,t[s],t[s+1],o);return o&&Wc(o,o.next)&&(Lo(o),o=o.next),o}function Ui(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(Wc(n,n.next)||ge(n.prev,n,n.next)===0)){if(Lo(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function Po(t,e,n,i,r,s,o){if(t){!o&&s&&HF(t,i,r,s);for(var a=t,l,c;t.prev!==t.next;){if(l=t.prev,c=t.next,s?DF(t,i,r,s):FF(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),Lo(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=zF(Ui(t),e,n),Po(t,e,n,i,r,s,2)):o===2&&BF(t,e,n,i,r,s):Po(Ui(t),e,n,i,r,s,1);break}}}}function FF(t){var e=t.prev,n=t,i=t.next;if(ge(e,n,i)>=0)return!1;for(var r=e.x,s=n.x,o=i.x,a=e.y,l=n.y,c=i.y,u=r<s?r<o?r:o:s<o?s:o,f=a<l?a<c?a:c:l<c?l:c,h=r>s?r>o?r:o:s>o?s:o,d=a>l?a>c?a:c:l>c?l:c,p=i.next;p!==e;){if(p.x>=u&&p.x<=h&&p.y>=f&&p.y<=d&&Er(r,a,s,l,o,c,p.x,p.y)&&ge(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function DF(t,e,n,i){var r=t.prev,s=t,o=t.next;if(ge(r,s,o)>=0)return!1;for(var a=r.x,l=s.x,c=o.x,u=r.y,f=s.y,h=o.y,d=a<l?a<c?a:c:l<c?l:c,p=u<f?u<h?u:h:f<h?f:h,_=a>l?a>c?a:c:l>c?l:c,x=u>f?u>h?u:h:f>h?f:h,y=Yh(d,p,e,n,i),m=Yh(_,x,e,n,i),w=t.prevZ,T=t.nextZ;w&&w.z>=y&&T&&T.z<=m;){if(w.x>=d&&w.x<=_&&w.y>=p&&w.y<=x&&w!==r&&w!==o&&Er(a,u,l,f,c,h,w.x,w.y)&&ge(w.prev,w,w.next)>=0||(w=w.prevZ,T.x>=d&&T.x<=_&&T.y>=p&&T.y<=x&&T!==r&&T!==o&&Er(a,u,l,f,c,h,T.x,T.y)&&ge(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;w&&w.z>=y;){if(w.x>=d&&w.x<=_&&w.y>=p&&w.y<=x&&w!==r&&w!==o&&Er(a,u,l,f,c,h,w.x,w.y)&&ge(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;T&&T.z<=m;){if(T.x>=d&&T.x<=_&&T.y>=p&&T.y<=x&&T!==r&&T!==o&&Er(a,u,l,f,c,h,T.x,T.y)&&ge(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function zF(t,e,n){var i=t;do{var r=i.prev,s=i.next.next;!Wc(r,s)&&OE(r,i,i.next,s)&&Ao(r,s)&&Ao(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),Lo(i),Lo(i.next),i=t=s),i=i.next}while(i!==t);return Ui(i)}function BF(t,e,n,i,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&YF(o,a)){var l=kE(o,a);o=Ui(o,o.next),l=Ui(l,l.next),Po(o,e,n,i,r,s,0),Po(l,e,n,i,r,s,0);return}a=a.next}o=o.next}while(o!==t)}function UF(t,e,n,i){var r=[],s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,c=RE(t,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(XF(c));for(r.sort(VF),s=0;s<r.length;s++)n=jF(r[s],n);return n}function VF(t,e){return t.x-e.x}function jF(t,e){var n=GF(t,e);if(!n)return e;var i=kE(n,t);return Ui(i,i.next),Ui(n,n.next)}function GF(t,e){var n=e,i=t.x,r=t.y,s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===i))return o}n=n.next}while(n!==e);if(!o)return null;var l=o,c=o.x,u=o.y,f=1/0,h;n=o;do i>=n.x&&n.x>=c&&i!==n.x&&Er(r<u?i:s,r,c,u,r<u?s:i,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(i-n.x),Ao(n,t)&&(h<f||h===f&&(n.x>o.x||n.x===o.x&&WF(o,n)))&&(o=n,f=h)),n=n.next;while(n!==l);return o}function WF(t,e){return ge(t.prev,t,e.prev)<0&&ge(e.next,t,t.next)<0}function HF(t,e,n,i){var r=t;do r.z===0&&(r.z=Yh(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,$F(r)}function $F(t){var e,n,i,r,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1);return t}function Yh(t,e,n,i,r){return t=(t-n)*r|0,e=(e-i)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function XF(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Er(t,e,n,i,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function YF(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!ZF(t,e)&&(Ao(t,e)&&Ao(e,t)&&qF(t,e)&&(ge(t.prev,t,e.prev)||ge(t,e.prev,e))||Wc(t,e)&&ge(t.prev,t,t.next)>0&&ge(e.prev,e,e.next)>0)}function ge(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Wc(t,e){return t.x===e.x&&t.y===e.y}function OE(t,e,n,i){var r=Ba(ge(t,e,n)),s=Ba(ge(t,e,i)),o=Ba(ge(n,i,t)),a=Ba(ge(n,i,e));return!!(r!==s&&o!==a||r===0&&za(t,n,e)||s===0&&za(t,i,e)||o===0&&za(n,t,i)||a===0&&za(n,e,i))}function za(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Ba(t){return t>0?1:t<0?-1:0}function ZF(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&OE(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Ao(t,e){return ge(t.prev,t,t.next)<0?ge(t,e,t.next)>=0&&ge(t,t.prev,e)>=0:ge(t,e,t.prev)<0||ge(t,t.next,e)<0}function qF(t,e){var n=t,i=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function kE(t,e){var n=new Zh(t.i,t.x,t.y),i=new Zh(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function My(t,e,n,i){var r=new Zh(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Lo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Zh(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Gc.deviation=function(t,e,n,i){var r=e&&e.length,s=r?e[0]*n:t.length,o=Math.abs(qh(t,0,s,n));if(r)for(var a=0,l=e.length;a<l;a++){var c=e[a]*n,u=a<l-1?e[a+1]*n:t.length;o-=Math.abs(qh(t,c,u,n))}var f=0;for(a=0;a<i.length;a+=3){var h=i[a]*n,d=i[a+1]*n,p=i[a+2]*n;f+=Math.abs((t[h]-t[p])*(t[d+1]-t[h+1])-(t[h]-t[d])*(t[p+1]-t[h+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function qh(t,e,n,i){for(var r=0,s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}Gc.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[r][s][o]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n};const Ua=EE.CLOCKWISE,Ry=EE.COUNTER_CLOCKWISE,Xn={isClosed:!0};function KF(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Ns(t){return"positions"in t?t.positions:t}function vl(t){return"holeIndices"in t?t.holeIndices:null}function QF(t){return Array.isArray(t[0])}function JF(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function eD(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function tD(t,e,n,i){for(let r=0;r<e;r++)if(t[n+r]!==t[i-e+r])return!1;return!0}function Oy(t,e,n,i,r){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let l=0;l<i;l++)t[s++]=n[a][l]||0;if(!eD(n))for(let a=0;a<i;a++)t[s++]=n[0][a]||0;return Xn.start=e,Xn.end=s,Xn.size=i,xE(t,r,Xn),s}function ky(t,e,n,i,r=0,s,o){s=s||n.length;const a=s-r;if(a<=0)return e;let l=e;for(let c=0;c<a;c++)t[l++]=n[r+c];if(!tD(n,i,r,s))for(let c=0;c<i;c++)t[l++]=n[r+c];return Xn.start=e,Xn.end=l,Xn.size=i,xE(t,o,Xn),l}function nD(t,e){KF(t);const n=[],i=[];if("positions"in t){const{positions:r,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=ky(n,o,r,e,s[a-1],s[a],a===0?Ua:Ry),i.push(o);return i.pop(),{positions:n,holeIndices:i}}t=r}if(!QF(t))return ky(n,0,t,e,0,n.length,Ua),n;if(!JF(t)){let r=0;for(const[s,o]of t.entries())r=Oy(n,r,o,e,s===0?Ua:Ry),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return Oy(n,0,t,e,Ua),n}function cf(t,e,n){const i=t.length/3;let r=0;for(let s=0;s<i;s++){const o=(s+1)%i;r+=t[s*3+e]*t[o*3+n],r-=t[o*3+e]*t[s*3+n]}return Math.abs(r/2)}function Ny(t,e,n,i){const r=t.length/3;for(let s=0;s<r;s++){const o=s*3,a=t[o+0],l=t[o+1],c=t[o+2];t[o+e]=a,t[o+n]=l,t[o+i]=c}}function iD(t,e,n,i){let r=vl(t);r&&(r=r.map(a=>a/e));let s=Ns(t);const o=i&&e===3;if(n){const a=s.length;s=s.slice();const l=[];for(let c=0;c<a;c+=e){l[0]=s[c],l[1]=s[c+1],o&&(l[2]=s[c+2]);const u=n(l);s[c]=u[0],s[c+1]=u[1],o&&(s[c+2]=u[2])}}if(o){const a=cf(s,0,1),l=cf(s,0,2),c=cf(s,1,2);if(!a&&!l&&!c)return[];a>l&&a>c||(l>c?(n||(s=s.slice()),Ny(s,0,2,1)):(n||(s=s.slice()),Ny(s,1,2,0)))}return lc(s,r,e)}class rD extends dE{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=nD(e,this.positionSize);return this.opts.resolution?AE(Ns(n),vl(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?bF(Ns(n),vl(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(Fy(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return Ns(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&Fy(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:r}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let l=s.indices;if(!l||!e)return;let c=r;const u=iD(e,this.positionSize,this.opts.preproject,this.opts.full3d);l=a.allocate(l,r+u.length,{copy:!0});for(let f=0;f<u.length;f++)l[c++]=u[f]+i;o[n+1]=r+u.length,s.indices=l}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:r},positionSize:s}=this;if(!r||!e)return;const o=Ns(e);for(let a=n,l=0;l<i;a++,l++){const c=o[l*s],u=o[l*s+1],f=s>2?o[l*s+2]:0;r[a*3]=c,r[a*3+1]=u,r[a*3+2]=f}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:r}=this,s=this.attributes.vertexValid,o=e&&vl(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+i),o)for(let a=0;a<o.length;a++)s[n+o[a]/r-1]=0;s[n+i-1]=0}}function Fy(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const NE=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,sD=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(NE,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),oD=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(NE,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),aD=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,cc=[0,0,0,255],lD={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:cc},getLineColor:{type:"accessor",value:cc},material:!0},Va={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Ig extends Cn{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?sD:oD,fs:aD,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[jo,jI,Go]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:r}=this.props;n.isGeospatial&&i===K.DEFAULT&&(i=K.LNGLAT);let s;i===K.LNGLAT&&(r?s=n.projectPosition.bind(n):s=n.projectFlat.bind(n)),this.setState({numInstances:0,polygonTesselator:new rD({preproject:s,fp64:this.use64bitPositions(),IndexType:!e||ag(e,ae.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const o=this.getAttributeManager(),a=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:a},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:Va,accessor:"getPolygon",update:this.calculatePositions,noAlloc:a,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:a},elevations:{size:1,transition:Va,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Va,accessor:"getFillColor",defaultValue:cc,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Va,accessor:"getLineColor",defaultValue:cc,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(l,{index:c,target:u})=>this.encodePickingColor(l&&l.__source?l.__source.index:c,u),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:r,elevationScale:s}=this.props,{topModel:o,sideModel:a,polygonTesselator:l}=this.state,c={...e,extruded:!!n,elevationScale:s};a&&(a.setInstanceCount(l.instanceCount-1),a.setUniforms(c),r&&(a.setDrawMode(3),a.setUniforms({isWireframe:!0}).draw()),i&&(a.setDrawMode(6),a.setUniforms({isWireframe:!1}).draw())),o&&(o.setVertexCount(l.vertexCount),o.setUniforms(c).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager();if(r.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded){var a;(a=this.state.models)===null||a===void 0||a.forEach(l=>l.delete()),this.setState(this._getModels(this.context.gl)),s.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:i,extruded:r}=this.props;let s,o;if(i){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1,s=new Di(e,{...a,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return r&&(o=new Di(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new Uo({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),o.userData.excludeAttributes={indices:!0}),{models:[o,s].filter(Boolean),topModel:s,sideModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}g(Ig,"defaultProps",lD);g(Ig,"layerName","SolidPolygonLayer");function cD({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,o=t.length;let a=o,l=o;for(let h=0;h<o;h++){const d=e(t[h]);if(a>h&&d>=r&&(a=h),d>=s){l=h;break}}let c=a;const f=l-a!==i.length?t.slice(l):void 0;for(let h=0;h<i.length;h++)t[c++]=i[h];if(f){for(let h=0;h<f.length;h++)t[c++]=f[h];t.length=c}return{startRow:a,endRow:a+i.length}}function uD(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?fD(t,i,n):null}function fD(t,e,n){const i={properties:{...t.properties[e]}};for(const r in t.numericProps)i.properties[r]=t.numericProps[r].value[n];return i}function hD(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const r=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(r.length*3);const s=[];for(let o=0;o<r.length;o++)e(r[o],s),n[i][o*3+0]=s[0],n[i][o*3+1]=s[1],n[i][o*3+2]=s[2]}return n}const dD=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,uf=192/256,Dy=[],gD={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Mg extends Vc{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:dD}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:i,target:r})=>this.encodePickingColor(i,r)}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:r}=n;r!==i.outlineColor&&(r=r.map(s=>s/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!n.sdf&&n.outlineWidth&&$.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:i,outlineWidth:r}=this.props,{outlineColor:s}=this.state,o=r?Math.max(i,uf*(1-r)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:uf,outlineBuffer:o,gamma:i,sdf:!!n,outlineColor:s},super.draw(e),n&&r){const{iconManager:a}=this.state;a.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:uf}})}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):Dy}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):Dy}}g(Mg,"defaultProps",gD);g(Mg,"layerName","MultiIconLayer");const qs=1e20;class pD{constructor({fontSize:e=24,buffer:n=3,radius:i=8,cutoff:r=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=n,this.cutoff=r,this.radius=i;const l=this.size=e+n*4,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${a} ${o} ${e}px ${s}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(i),l=0,c=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),u=Math.min(this.size-this.buffer,a+Math.ceil(r)),f=c+2*this.buffer,h=u+2*this.buffer,d=Math.max(f*h,0),p=new Uint8ClampedArray(d),_={data:p,width:f,height:h,glyphWidth:c,glyphHeight:u,glyphTop:a,glyphLeft:l,glyphAdvance:n};if(c===0||u===0)return _;const{ctx:x,buffer:y,gridInner:m,gridOuter:w}=this;x.clearRect(y,y,c,u),x.fillText(e,y,y+a);const T=x.getImageData(y,y,c,u);w.fill(qs,0,d),m.fill(0,0,d);for(let b=0;b<u;b++)for(let P=0;P<c;P++){const L=T.data[4*(b*c+P)+3]/255;if(L===0)continue;const C=(b+y)*f+P+y;if(L===1)w[C]=0,m[C]=qs;else{const M=.5-L;w[C]=M>0?M*M:0,m[C]=M<0?M*M:0}}zy(w,0,0,f,h,f,this.f,this.v,this.z),zy(m,y,y,c,u,f,this.f,this.v,this.z);for(let b=0;b<d;b++){const P=Math.sqrt(w[b])-Math.sqrt(m[b]);p[b]=Math.round(255-255*(P/this.radius+this.cutoff))}return _}}function zy(t,e,n,i,r,s,o,a,l){for(let c=e;c<e+i;c++)By(t,n*s+c,s,r,o,a,l);for(let c=n;c<n+r;c++)By(t,c*s+e,1,i,o,a,l)}function By(t,e,n,i,r,s,o){s[0]=0,o[0]=-qs,o[1]=qs,r[0]=t[e];for(let a=1,l=0,c=0;a<i;a++){r[a]=t[e+a*n];const u=a*a;do{const f=s[l];c=(r[a]-r[f]+u-f*f)/(a-f)/2}while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=qs}for(let a=0,l=0;a<i;a++){for(;o[l+1]<a;)l++;const c=s[l],u=a-c;t[e+a*n]=r[c]+u*u}}const mD=32,yD=[];function vD(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function _D({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o;const u=n+i*2;for(const f of t)if(!s[f]){const h=e(f);c+h+i*2>r&&(c=0,l++),s[f]={x:c+i,y:a+l*u+i,width:h,height:u,layoutWidth:h,layoutHeight:n},c+=h+i*2}return{mapping:s,xOffset:c,yOffset:a+l*u,canvasHeight:vD(a+(l+1)*u)}}function FE(t,e,n,i){let r=0;for(let o=e;o<n;o++){var s;const a=t[o];r+=((s=i[a])===null||s===void 0?void 0:s.layoutWidth)||0}return r}function DE(t,e,n,i,r,s){let o=e,a=0;for(let l=e;l<n;l++){const c=FE(t,l,l+1,r);a+c>i&&(o<l&&s.push(l),o=l,a=0),a+=c}return a}function wD(t,e,n,i,r,s){let o=e,a=e,l=e,c=0;for(let u=e;u<n;u++)if((t[u]===" "||t[u+1]===" "||u+1===n)&&(l=u+1),l>a){let f=FE(t,a,l,r);c+f>i&&(o<a&&(s.push(a),o=a,c=0),f>i&&(f=DE(t,a,l,i,r,s),o=s[s.length-1])),a=l,c+=f}return c}function ED(t,e,n,i,r=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?DE(t,r,s,n,i,o):wD(t,r,s,n,i,o),o}function xD(t,e,n,i,r,s){let o=0,a=0;for(let l=e;l<n;l++){const c=t[l],u=i[c];u?(a||(a=u.layoutHeight),r[l]=o+u.layoutWidth/2,o+=u.layoutWidth):($.warn("Missing character: ".concat(c," (").concat(c.codePointAt(0),")"))(),r[l]=o,o+=mD)}s[0]=o,s[1]=a}function TD(t,e,n,i,r){const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),c=new Array(o),u=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,f=[0,0],h=[0,0];let d=0,p=0,_=0;for(let y=0;y<=o;y++){const m=s[y];if((m===`
`||y===o)&&(_=y),_>p){const w=u?ED(s,n,i,r,p,_):yD;for(let T=0;T<=w.length;T++){const b=T===0?p:w[T-1],P=T<w.length?w[T]:_;xD(s,b,P,r,a,h);for(let L=b;L<P;L++){var x;const C=s[L],M=((x=r[C])===null||x===void 0?void 0:x.layoutOffsetY)||0;l[L]=d+h[1]/2+M,c[L]=h[0]}d=d+h[1]*e,f[0]=Math.max(f[0],h[0])}p=_}m===`
`&&(a[p]=0,l[p]=0,c[p]=0,p++)}return f[1]=d,{x:a,y:l,rowWidth:c,size:f}}function SD({value:t,length:e,stride:n,offset:i,startIndices:r,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=i?i/o:0,c=r[e]||Math.ceil((t.length-l)/a),u=s&&new Set,f=new Array(e);let h=t;if(a>1||l>0){const d=t.constructor;h=new d(c);for(let p=0;p<c;p++)h[p]=t[p*a+l]}for(let d=0;d<e;d++){const p=r[d],_=r[d+1]||c,x=h.subarray(p,_);f[d]=String.fromCodePoint.apply(null,x),u&&x.forEach(u.add,u)}if(u)for(const d of u)s.add(String.fromCodePoint(d));return{texts:f,characterCount:c}}class zE{constructor(e=5){g(this,"limit",void 0),g(this,"_cache",{}),g(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function bD(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Rr={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:bD(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},Uy=1024,Vy=.9,jy=1.2,BE=3;let uc=new zE(BE);function PD(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const i=uc.get(t);if(!i)return n;for(const r in i.mapping)n.has(r)&&n.delete(r);return n}function AD(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function Gy(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function LD(t){$.assert(Number.isFinite(t)&&t>=BE,"Invalid cache limit"),uc=new zE(t)}class CD{constructor(){g(this,"props",{...Rr}),g(this,"_key",void 0),g(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*jy+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=PD(this._key,this.props.characterSet),i=uc.get(this._key);if(i&&n.size===0){this._atlas!==i&&(this._atlas=i);return}const r=this._generateFontAtlas(n,i);this._atlas=r,uc.set(this._key,r)}_generateFontAtlas(e,n){const{fontFamily:i,fontWeight:r,fontSize:s,buffer:o,sdf:a,radius:l,cutoff:c}=this.props;let u=n&&n.data;u||(u=document.createElement("canvas"),u.width=Uy);const f=u.getContext("2d",{willReadFrequently:!0});Gy(f,i,s,r);const{mapping:h,canvasHeight:d,xOffset:p,yOffset:_}=_D({getFontWidth:x=>f.measureText(x).width,fontHeight:s*jy,buffer:o,characterSet:e,maxCanvasWidth:Uy,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(u.height!==d){const x=f.getImageData(0,0,u.width,u.height);u.height=d,f.putImageData(x,0,0)}if(Gy(f,i,s,r),a){const x=new pD({fontSize:s,buffer:o,radius:l,cutoff:c,fontFamily:i,fontWeight:"".concat(r)});for(const y of e){const{data:m,width:w,height:T,glyphTop:b}=x.draw(y);h[y].width=w,h[y].layoutOffsetY=s*Vy-b;const P=f.createImageData(w,T);AD(m,P),f.putImageData(P,h[y].x,h[y].y)}}else for(const x of e)f.fillText(x,h[x].x,h[x].y+o+s*Vy);return{xOffset:p,yOffset:_,mapping:h,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:r,sdf:s,radius:o,cutoff:a}=this.props;return s?"".concat(e," ").concat(n," ").concat(i," ").concat(r," ").concat(o," ").concat(a):"".concat(e," ").concat(n," ").concat(i," ").concat(r)}}const ID=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,MD=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,RD={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Rg extends Cn{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:ID,fs:MD,modules:[jo,Go]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var i;const{gl:r}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:i,sizeUnits:r,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:!!a,padding:l,sizeUnits:ki[r],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:o}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new Di(e,{...this.getShaders(),id:this.props.id,geometry:new Uo({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}g(Rg,"defaultProps",RD);g(Rg,"layerName","TextBackgroundLayer");const Wy={start:1,middle:0,end:-1},Hy={top:1,center:0,bottom:-1},ff=[0,0,0,255],OD=1,kD={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:ff},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Rr.characterSet},fontFamily:Rr.fontFamily,fontWeight:Rr.fontWeight,lineHeight:OD,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:ff},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:ff},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Og extends zc{constructor(...e){super(...e),g(this,"state",void 0),g(this,"getBoundingRect",(n,i)=>{let{size:[r,s]}=this.transformParagraph(n,i);const{fontSize:o}=this.state.fontAtlasManager.props;r/=o,s/=o;const{getTextAnchor:a,getAlignmentBaseline:l}=this.props,c=Wy[typeof a=="function"?a(n,i):a],u=Hy[typeof l=="function"?l(n,i):l];return[(c-1)*r/2,(u-1)*s/2,r,s]}),g(this,"getIconOffsets",(n,i)=>{const{getTextAnchor:r,getAlignmentBaseline:s}=this.props,{x:o,y:a,rowWidth:l,size:[c,u]}=this.transformParagraph(n,i),f=Wy[typeof r=="function"?r(n,i):r],h=Hy[typeof s=="function"?s(n,i):s],d=o.length,p=new Array(d*2);let _=0;for(let x=0;x<d;x++){const y=(1-f)*(c-l[x])/2;p[_++]=(f-1)*c/2+y+o[x],p[_++]=(h-1)*u/2+a[x]}return p})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new CD},this.props.maxWidth>0&&$.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:i,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:i}=this.props,{fontAtlasManager:r,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:i};if(!r.mapping)return r.setProps(o),!0;for(const a in o)if(o[a]!==r.props[a])return r.setProps(o),!0;return!1}_updateText(){var e;const{data:n,characterSet:i}=this.props,r=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:s}=this.props,o=n.startIndices,a;const l=i==="auto"&&new Set;if(r&&o){const{texts:c,characterCount:u}=SD({...ArrayBuffer.isView(r)?{value:r}:r,length:n.length,startIndices:o,characterSet:l});a=u,s=(f,{index:h})=>c[h]}else{const{iterable:c,objectInfo:u}=Dc(n);o=[0],a=0;for(const f of c){u.index++;const h=Array.from(s(f,u)||"");l&&h.forEach(l.add,l),a+=h.length,o.push(a)}}this.setState({getText:s,startIndices:o,numInstances:a,characterSet:l||i})}transformParagraph(e,n){const{fontAtlasManager:i}=this.state,r=i.mapping,s=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:l}=this.props,c=s(e,n)||"";return TD(c,a,o,l*i.props.fontSize,r)}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:r,texture:s,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:c,getPosition:u,getColor:f,getSize:h,getAngle:d,getPixelOffset:p,getBackgroundColor:_,getBorderColor:x,getBorderWidth:y,backgroundPadding:m,background:w,billboard:T,fontSettings:b,outlineWidth:P,outlineColor:L,sizeScale:C,sizeUnits:M,sizeMinPixels:R,sizeMaxPixels:V,transitions:W,updateTriggers:G}=this.props,q=this.getSubLayerClass("characters",Mg),At=this.getSubLayerClass("background",Rg);return[w&&new At({getFillColor:_,getLineColor:x,getLineWidth:y,padding:m,getPosition:u,getSize:h,getAngle:d,getPixelOffset:p,billboard:T,sizeScale:C,sizeUnits:M,sizeMinPixels:R,sizeMaxPixels:V,transitions:W&&{getPosition:W.getPosition,getAngle:W.getAngle,getSize:W.getSize,getFillColor:W.getBackgroundColor,getLineColor:W.getBorderColor,getLineWidth:W.getBorderWidth,getPixelOffset:W.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:G.getPosition,getAngle:G.getAngle,getSize:G.getSize,getFillColor:G.getBackgroundColor,getLineColor:G.getBorderColor,getLineWidth:G.getBorderWidth,getPixelOffset:G.getPixelOffset,getBoundingRect:{getText:G.getText,getTextAnchor:G.getTextAnchor,getAlignmentBaseline:G.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:c,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new q({sdf:b.sdf,smoothing:Number.isFinite(b.smoothing)?b.smoothing:Rr.smoothing,outlineWidth:P/(b.radius||Rr.radius),outlineColor:L,iconAtlas:s,iconMapping:o,getPosition:u,getColor:f,getSize:h,getAngle:d,getPixelOffset:p,billboard:T,sizeScale:C*r,sizeUnits:M,sizeMinPixels:R*r,sizeMaxPixels:V*r,transitions:W&&{getPosition:W.getPosition,getAngle:W.getAngle,getColor:W.getColor,getSize:W.getSize,getPixelOffset:W.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:G.getText,getPosition:G.getPosition,getAngle:G.getAngle,getColor:G.getColor,getSize:G.getSize,getPixelOffset:G.getPixelOffset,getIconOffsets:{getTextAnchor:G.getTextAnchor,getAlignmentBaseline:G.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:c,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){LD(e)}}g(Og,"defaultProps",kD);g(Og,"layerName","TextLayer");const _l={circle:{type:Lg,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Vc,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Og,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},wl={type:Cg,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Kh={type:Ig,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Ps({type:t,props:e}){const n={};for(const i in e)n[i]=t.defaultProps[e[i]];return n}function hf(t,e){const{transitions:n,updateTriggers:i}=t.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),r.updateTriggers[o]=i[s],n&&(r.transitions[o]=n[s])),r[o]=a}return r}function ND(t){if(Array.isArray(t))return t;switch($.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return $.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function $y(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=t.length}=n;for(let o=r;o<s;o++){const a=t[o],{geometry:l}=a;if(l)if(l.type==="GeometryCollection"){$.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");const{geometries:c}=l;for(let u=0;u<c.length;u++){const f=c[u];Xy(f,i,e,a,o)}}else Xy(l,i,e,a,o)}return i}function Xy(t,e,n,i,r){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=e;if(!DD(s,o)){$.warn("".concat(s," coordinates are malformed"))();return}switch(s){case"Point":a.push(n({geometry:t},i,r));break;case"MultiPoint":o.forEach(f=>{a.push(n({geometry:{type:"Point",coordinates:f}},i,r))});break;case"LineString":l.push(n({geometry:t},i,r));break;case"MultiLineString":o.forEach(f=>{l.push(n({geometry:{type:"LineString",coordinates:f}},i,r))});break;case"Polygon":c.push(n({geometry:t},i,r)),o.forEach(f=>{u.push(n({geometry:{type:"LineString",coordinates:f}},i,r))});break;case"MultiPolygon":o.forEach(f=>{c.push(n({geometry:{type:"Polygon",coordinates:f}},i,r)),f.forEach(h=>{u.push(n({geometry:{type:"LineString",coordinates:h}},i,r))})});break}}const FD={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function DD(t,e){let n=FD[t];for($.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function UE(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function ja(t){return t.geometry.coordinates}function zD(t,e){const n=UE(),{pointFeatures:i,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=ja,n.lines.data=r,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=ja,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=ja,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=ja,n}function BD(t,e){const n=UE(),{points:i,lines:r,polygons:s}=t,o=hD(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const UD=["points","linestrings","polygons"],VD={...Ps(_l.circle),...Ps(_l.icon),...Ps(_l.text),...Ps(wl),...Ps(Kh),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class $o extends zc{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:i}=this.props,r=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const i=BD(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:n}){const i=ND(e.data),r=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(n.dataChanged)){const l=this.state.features;for(const c in l)s[c]=l[c].slice(),o[c]=[];for(const c of n.dataChanged){const u=$y(i,r,c);for(const f in l)o[f].push(cD({data:s[f],getIndex:h=>h.__source.index,dataRange:c,replace:u[f]}))}}else s=$y(i,r);const a=zD(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i,sourceLayer:r}=n;return n.featureType=UD.find(s=>r.id.startsWith("".concat(this.id,"-").concat(s,"-"))),i>=0&&r.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[i]),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),i=e.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(n)===i&&r.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,r="polygons-fill",s=this.shouldRenderSubLayer(r,i.polygons.data)&&this.getSubLayerClass(r,Kh.type);if(s){const o=hf(this,Kh.props),a=e&&n;return a||delete o.getLineColor,o.updateTriggers.lineColors=a,new s(o,this.getSubLayerProps({id:r,updateTriggers:o.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,r="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(r,i.polygonsOutline.data)&&this.getSubLayerClass(r,wl.type),a=this.shouldRenderSubLayer(s,i.lines.data)&&this.getSubLayerClass(s,wl.type);if(o||a){const l=hf(this,wl.props);return[o&&new o(l,this.getSubLayerProps({id:r,updateTriggers:l.updateTriggers}),i.polygonsOutline),a&&new a(l,this.getSubLayerProps({id:s,updateTriggers:l.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:r}=this.props;!i&&Number.isFinite(r)&&(r=n.points.data.findIndex(a=>a.__source.index===r));const s=new Set(e.split("+")),o=[];for(const a of s){const l="points-".concat(a),c=_l[a],u=c&&this.shouldRenderSubLayer(l,n.points.data)&&this.getSubLayerClass(l,c.type);if(u){const f=hf(this,c.props);let h=n.points;if(a==="text"&&i){const{instancePickingColors:d,...p}=h.data.attributes;h={...h,data:{...h.data,attributes:p}}}o.push(new u(f,this.getSubLayerProps({id:l,updateTriggers:f.updateTriggers,highlightedObjectIndex:r}),h))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),r=this._renderPointLayers();return[!e&&n,i,r,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,r)=>{const{data:s,index:o}=r,a=uD(s,o);return e(a,r)}}}g($o,"layerName","GeoJsonLayer");g($o,"defaultProps",VD);class jD{constructor(e){g(this,"index",void 0),g(this,"isVisible",void 0),g(this,"isSelected",void 0),g(this,"parent",void 0),g(this,"children",void 0),g(this,"content",void 0),g(this,"state",void 0),g(this,"layers",void 0),g(this,"id",void 0),g(this,"bbox",void 0),g(this,"zoom",void 0),g(this,"userData",void 0),g(this,"_abortController",void 0),g(this,"_loader",void 0),g(this,"_loaderId",void 0),g(this,"_isLoaded",void 0),g(this,"_isCancelled",void 0),g(this,"_needsReload",void 0),this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:n,onLoad:i,onError:r}){const{index:s,id:o,bbox:a,userData:l,zoom:c}=this,u=this._loaderId;this._abortController=new AbortController;const{signal:f}=this._abortController,h=await n.scheduleRequest(this,_=>_.isSelected?1:-1);if(!h){this._isCancelled=!0;return}if(this._isCancelled){h.done();return}let d=null,p;try{d=await e({index:s,id:o,bbox:a,userData:l,zoom:c,signal:f})}catch(_){p=_||!0}finally{h.done()}if(u===this._loaderId){if(this._loader=void 0,this.content=d,this._isCancelled&&!d){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,p?r(p,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)===null||e===void 0||e.abort())}}const Ve={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},Yy=new D,GD=new D;class kg{constructor(e=[0,0,0],n=[0,0,0],i){g(this,"center",void 0),g(this,"halfDiagonal",void 0),g(this,"minimum",void 0),g(this,"maximum",void 0),i=i||Yy.copy(e).add(n).scale(.5),this.center=new D(i),this.halfDiagonal=new D(n).subtract(this.center),this.minimum=new D(e),this.maximum=new D(n)}clone(){return new kg(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:n}=this,i=GD.from(e.normal),r=n.x*Math.abs(i.x)+n.y*Math.abs(i.y)+n.z*Math.abs(i.z),s=this.center.dot(i)+e.distance;return s-r>0?Ve.INSIDE:s+r<0?Ve.OUTSIDE:Ve.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=Yy.from(e).subtract(this.center),{halfDiagonal:i}=this;let r=0,s;return s=Math.abs(n.x)-i.x,s>0&&(r+=s*s),s=Math.abs(n.y)-i.y,s>0&&(r+=s*s),s=Math.abs(n.z)-i.z,s>0&&(r+=s*s),r}}const As=new D,Zy=new D;class Ng{constructor(e=[0,0,0],n=0){g(this,"center",void 0),g(this,"radius",void 0),this.radius=-0,this.center=new D,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=As.from(n),this.center=new D().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Ng(this.center,this.radius)}union(e){const n=this.center,i=this.radius,r=e.center,s=e.radius,o=As.copy(r).subtract(n),a=o.magnitude();if(i>=a+s)return this.clone();if(s>=a+i)return e.clone();const l=(i+a+s)*.5;return Zy.copy(o).scale((-i+l)/a).add(n),this.center.copy(Zy),this.radius=l,this}expand(e){const i=As.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const n=$3(As,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const i=As.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const n=this.center,i=this.radius,s=e.normal.dot(n)+e.distance;return s<-i?Ve.OUTSIDE:s<i?Ve.INTERSECTING:Ve.INSIDE}}const WD=new D,HD=new D,Ga=new D,Wa=new D,Ha=new D,$D=new D,XD=new D,ln={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Fg{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){g(this,"center",void 0),g(this,"halfAxes",void 0),this.center=new D().from(e),this.halfAxes=new ke(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new D(e).len(),new D(n).len(),new D(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),r=new D(e).normalize(),s=new D(n).normalize(),o=new D(i).normalize();return new M0().fromMatrix3(new ke([...r,...s,...o]))}fromCenterHalfSizeQuaternion(e,n,i){const r=new M0(i),s=new ke().fromQuaternion(r);return s[0]=s[0]*n[0],s[1]=s[1]*n[0],s[2]=s[2]*n[0],s[3]=s[3]*n[1],s[4]=s[4]*n[1],s[5]=s[5]*n[1],s[6]=s[6]*n[2],s[7]=s[7]*n[2],s[8]=s[8]*n[2],this.center=new D().from(e),this.halfAxes=s,this}clone(){return new Fg(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Ng){const n=this.halfAxes,i=n.getColumn(0,Ga),r=n.getColumn(1,Wa),s=n.getColumn(2,Ha),o=WD.copy(i).add(r).add(s);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const n=this.center,i=e.normal,r=this.halfAxes,s=i.x,o=i.y,a=i.z,l=Math.abs(s*r[ln.COLUMN0ROW0]+o*r[ln.COLUMN0ROW1]+a*r[ln.COLUMN0ROW2])+Math.abs(s*r[ln.COLUMN1ROW0]+o*r[ln.COLUMN1ROW1]+a*r[ln.COLUMN1ROW2])+Math.abs(s*r[ln.COLUMN2ROW0]+o*r[ln.COLUMN2ROW1]+a*r[ln.COLUMN2ROW2]),c=i.dot(n)+e.distance;return c<=-l?Ve.OUTSIDE:c>=l?Ve.INSIDE:Ve.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=HD.from(e).subtract(this.center),i=this.halfAxes,r=i.getColumn(0,Ga),s=i.getColumn(1,Wa),o=i.getColumn(2,Ha),a=r.magnitude(),l=s.magnitude(),c=o.magnitude();r.normalize(),s.normalize(),o.normalize();let u=0,f;return f=Math.abs(n.dot(r))-a,f>0&&(u+=f*f),f=Math.abs(n.dot(s))-l,f>0&&(u+=f*f),f=Math.abs(n.dot(o))-c,f>0&&(u+=f*f),u}computePlaneDistances(e,n,i=[-0,-0]){let r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,l=a.getColumn(0,Ga),c=a.getColumn(1,Wa),u=a.getColumn(2,Ha),f=$D.copy(l).add(c).add(u).add(o),h=XD.copy(f).subtract(e);let d=n.dot(h);return r=Math.min(d,r),s=Math.max(d,s),f.copy(o).add(l).add(c).subtract(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),f.copy(o).add(l).subtract(c).add(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),f.copy(o).add(l).subtract(c).subtract(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),o.copy(f).subtract(l).add(c).add(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),o.copy(f).subtract(l).add(c).subtract(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),o.copy(f).subtract(l).subtract(c).add(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),o.copy(f).subtract(l).subtract(c).subtract(u),h.copy(f).subtract(e),d=n.dot(h),r=Math.min(d,r),s=Math.max(d,s),i[0]=r,i[1]=s,i}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,Ga);n.transformAsPoint(e);const i=this.halfAxes.getColumn(1,Wa);i.transformAsPoint(e);const r=this.halfAxes.getColumn(2,Ha);return r.transformAsPoint(e),this.halfAxes=new ke([...n,...i,...r]),this}getTransform(){throw new Error("not implemented")}}const qy=new D,Ky=new D;class qr{constructor(e=[0,0,1],n=0){g(this,"normal",void 0),g(this,"distance",void 0),this.normal=new D,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return wo(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=qy.from(e),this.normal.from(n).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,n,i,r){return this.normal.set(e,n,i),wo(yn(this.normal.len(),1)),this.distance=r,this}clone(){return new qr(this.normal,this.distance)}equals(e){return yn(this.distance,e.distance)&&yn(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=Ky.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,n)}projectPointOntoPlane(e,n=[0,0,0]){e=qy.from(e);const i=this.getPointDistance(e),r=Ky.copy(this.normal).scale(i);return e.subtract(r).to(n)}}const Qy=[new D([1,0,0]),new D([0,1,0]),new D([0,0,1])],Jy=new D,YD=new D;new qr(new D(1,0,0),0);class pn{constructor(e=[]){g(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*Qy.length;const n=e.center,i=e.radius;let r=0;for(const s of Qy){let o=this.planes[r],a=this.planes[r+1];o||(o=this.planes[r]=new qr),a||(a=this.planes[r+1]=new qr);const l=Jy.copy(s).scale(-i).add(n);-s.dot(l),o.fromPointNormal(l,s);const c=Jy.copy(s).scale(i).add(n),u=YD.copy(s).negate();-u.dot(c),a.fromPointNormal(c,u),r+=2}return this}computeVisibility(e){let n=Ve.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case Ve.OUTSIDE:return Ve.OUTSIDE;case Ve.INTERSECTING:n=Ve.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(wo(Number.isFinite(n),"parentPlaneMask is required."),n===pn.MASK_OUTSIDE||n===pn.MASK_INSIDE)return n;let i=pn.MASK_INSIDE;const r=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&!(n&o))continue;const a=r[s],l=e.intersectPlane(a);if(l===Ve.OUTSIDE)return pn.MASK_OUTSIDE;l===Ve.INTERSECTING&&(i|=o)}return i}}g(pn,"MASK_OUTSIDE",4294967295);g(pn,"MASK_INSIDE",0);g(pn,"MASK_INDETERMINATE",2147483647);new D;new D;new D;new D;new D;new D;new D;new D;new D;new D;new D;new D;new D;new D;new D;new D;new D;const qt=new ke,ZD=new ke,qD=new ke,$a=new ke,ev=new ke;function KD(t,e={}){const n=kw.EPSILON20,i=10;let r=0,s=0;const o=ZD,a=qD;o.identity(),a.copy(t);const l=n*QD(a);for(;s<i&&JD(a)>l;)ez(a,$a),ev.copy($a).transpose(),a.multiplyRight($a),a.multiplyLeft(ev),o.multiplyRight($a),++r>2&&(++s,r=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function QD(t){let e=0;for(let n=0;n<9;++n){const i=t[n];e+=i*i}return Math.sqrt(e)}const Qh=[1,0,0],Jh=[2,2,1];function JD(t){let e=0;for(let n=0;n<3;++n){const i=t[qt.getElementIndex(Jh[n],Qh[n])];e+=2*i*i}return Math.sqrt(e)}function ez(t,e){const n=kw.EPSILON15;let i=0,r=1;for(let c=0;c<3;++c){const u=Math.abs(t[qt.getElementIndex(Jh[c],Qh[c])]);u>i&&(r=c,i=u)}const s=Qh[r],o=Jh[r];let a=1,l=0;if(Math.abs(t[qt.getElementIndex(o,s)])>n){const c=t[qt.getElementIndex(o,o)],u=t[qt.getElementIndex(s,s)],f=t[qt.getElementIndex(o,s)],h=(c-u)/2/f;let d;h<0?d=-1/(-h+Math.sqrt(1+h*h)):d=1/(h+Math.sqrt(1+h*h)),a=1/Math.sqrt(1+d*d),l=d*a}return ke.IDENTITY.to(e),e[qt.getElementIndex(s,s)]=e[qt.getElementIndex(o,o)]=a,e[qt.getElementIndex(o,s)]=l,e[qt.getElementIndex(s,o)]=-l,e}const Dn=new D,tz=new D,nz=new D,iz=new D,rz=new D,sz=new ke,oz={diagonal:new ke,unitary:new ke};function az(t,e=new Fg){if(!t||t.length===0)return e.halfAxes=new ke([0,0,0,0,0,0,0,0,0]),e.center=new D,e;const n=t.length,i=new D(0,0,0);for(const M of t)i.add(M);const r=1/n;i.multiplyByScalar(r);let s=0,o=0,a=0,l=0,c=0,u=0;for(const M of t){const R=Dn.copy(M).subtract(i);s+=R.x*R.x,o+=R.x*R.y,a+=R.x*R.z,l+=R.y*R.y,c+=R.y*R.z,u+=R.z*R.z}s*=r,o*=r,a*=r,l*=r,c*=r,u*=r;const f=sz;f[0]=s,f[1]=o,f[2]=a,f[3]=o,f[4]=l,f[5]=c,f[6]=a,f[7]=c,f[8]=u;const{unitary:h}=KD(f,oz),d=e.halfAxes.copy(h);let p=d.getColumn(0,nz),_=d.getColumn(1,iz),x=d.getColumn(2,rz),y=-Number.MAX_VALUE,m=-Number.MAX_VALUE,w=-Number.MAX_VALUE,T=Number.MAX_VALUE,b=Number.MAX_VALUE,P=Number.MAX_VALUE;for(const M of t)Dn.copy(M),y=Math.max(Dn.dot(p),y),m=Math.max(Dn.dot(_),m),w=Math.max(Dn.dot(x),w),T=Math.min(Dn.dot(p),T),b=Math.min(Dn.dot(_),b),P=Math.min(Dn.dot(x),P);p=p.multiplyByScalar(.5*(T+y)),_=_.multiplyByScalar(.5*(b+m)),x=x.multiplyByScalar(.5*(P+w)),e.center.copy(p).add(_).add(x);const L=tz.set(y-T,m-b,w-P).multiplyByScalar(.5),C=new ke([L[0],0,0,0,L[1],0,0,0,L[2]]);return e.halfAxes.multiplyRight(C),e}const xr=512,tv=3,VE=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],jE=VE.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),lz=jE.concat([[.25,.5],[.75,.5]]);class Tr{constructor(e,n,i){g(this,"x",void 0),g(this,"y",void 0),g(this,"z",void 0),g(this,"childVisible",void 0),g(this,"selected",void 0),g(this,"_children",void 0),this.x=e,this.y=n,this.z=i}get children(){if(!this._children){const e=this.x*2,n=this.y*2,i=this.z+1;this._children=[new Tr(e,n,i),new Tr(e,n+1,i),new Tr(e+1,n,i),new Tr(e+1,n+1,i)]}return this._children}update(e){const{viewport:n,cullingVolume:i,elevationBounds:r,minZ:s,maxZ:o,bounds:a,offset:l,project:c}=e,u=this.getBoundingVolume(r,l,c);if(a&&!this.insideBounds(a)||i.computeVisibility(u)<0)return!1;if(!this.childVisible){let{z:h}=this;if(h<o&&h>=s){const d=u.distanceTo(n.cameraPosition)*n.scale/n.height;h+=Math.floor(Math.log2(d))}if(h>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const h of this.children)h.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const n of this._children)n.getSelected(e);return e}insideBounds([e,n,i,r]){const s=Math.pow(2,this.z),o=xr/s;return this.x*o<i&&this.y*o<r&&(this.x+1)*o>e&&(this.y+1)*o>n}getBoundingVolume(e,n,i){if(i){const l=this.z<1?lz:this.z<2?jE:VE,c=[];for(const u of l){const f=td(this.x+u[0],this.y+u[1],this.z);f[2]=e[0],c.push(i(f)),e[0]!==e[1]&&(f[2]=e[1],c.push(i(f)))}return az(c)}const r=Math.pow(2,this.z),s=xr/r,o=this.x*s+n*xr,a=xr-(this.y+1)*s;return new kg([o,a,e[0]],[o+s,a+s,e[1]])}}function cz(t,e,n,i){const r=t instanceof rN&&t.resolution?t.projectPosition:null,s=Object.values(t.getFrustumPlanes()).map(({normal:d,distance:p})=>new qr(d.clone().negate(),p)),o=new pn(s),a=t.distanceScales.unitsPerMeter[2],l=n&&n[0]*a||0,c=n&&n[1]*a||0,u=t instanceof ai&&t.pitch<=60?e:0;if(i){const[d,p,_,x]=i,y=Hr([d,x]),m=Hr([_,p]);i=[y[0],xr-y[1],m[0],xr-m[1]]}const f=new Tr(0,0,0),h={viewport:t,project:r,cullingVolume:o,elevationBounds:[l,c],minZ:u,maxZ:e,bounds:i,offset:0};if(f.update(h),t instanceof ai&&t.subViewports&&t.subViewports.length>1){for(h.offset=-1;f.update(h)&&!(--h.offset<-tv););for(h.offset=1;f.update(h)&&!(++h.offset>tv););}return f.getSelected()}const bn=512,uz=[-1/0,-1/0,1/0,1/0],GE={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(n=>typeof n=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}};function WE(t,e){const n=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...n.map(r=>r[0])),Math.min(...n.map(r=>r[1])),Math.max(...n.map(r=>r[0])),Math.max(...n.map(r=>r[1]))]}function fz(t){return Math.abs(t.split("").reduce((e,n)=>(e<<5)-e+n.charCodeAt(0)|0,0))}function HE(t,e){if(!t||!t.length)return null;const{index:n,id:i}=e;if(Array.isArray(t)){const s=fz(i)%t.length;t=t[s]}let r=t;for(const s of Object.keys(n)){const o=new RegExp("{".concat(s,"}"),"g");r=r.replace(o,String(n[s]))}return Number.isInteger(n.y)&&Number.isInteger(n.z)&&(r=r.replace(/\{-y\}/g,String(Math.pow(2,n.z)-n.y-1))),r}function hz(t,e,n){let i;if(e&&e.length===2){const[r,s]=e,o=t.getBounds({z:r}),a=t.getBounds({z:s});i=[Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.max(o[2],a[2]),Math.max(o[3],a[3])]}else i=t.getBounds();return t.isGeospatial?[Math.max(i[0],n[0]),Math.max(i[1],n[1]),Math.min(i[2],n[2]),Math.min(i[3],n[3])]:[Math.max(Math.min(i[0],n[2]),n[0]),Math.max(Math.min(i[1],n[3]),n[1]),Math.min(Math.max(i[2],n[0]),n[2]),Math.min(Math.max(i[3],n[1]),n[3])]}function dz({viewport:t,z:e=0,cullRect:n}){return(t.subViewports||[t]).map(r=>ed(r,e,n))}function ed(t,e,n){if(!Array.isArray(e)){const s=n.x-t.x,o=n.y-t.y,{width:a,height:l}=n,c={targetZ:e},u=t.unproject([s,o],c),f=t.unproject([s+a,o],c),h=t.unproject([s,o+l],c),d=t.unproject([s+a,o+l],c);return[Math.min(u[0],f[0],h[0],d[0]),Math.min(u[1],f[1],h[1],d[1]),Math.max(u[0],f[0],h[0],d[0]),Math.max(u[1],f[1],h[1],d[1])]}const i=ed(t,e[0],n),r=ed(t,e[1],n);return[Math.min(i[0],r[0]),Math.min(i[1],r[1]),Math.max(i[2],r[2]),Math.max(i[3],r[3])]}function gz(t,e,n){return n?WE(t,n).map(r=>r*e/bn):t.map(i=>i*e/bn)}function Dg(t,e){return Math.pow(2,t)*bn/e}function td(t,e,n){const i=Dg(n,bn),r=t/i*360-180,s=Math.PI-2*Math.PI*e/i,o=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[r,o]}function nv(t,e,n,i){const r=Dg(n,i);return[t/r*bn,e/r*bn]}function pz(t,e,n,i,r=bn){if(t.isGeospatial){const[c,u]=td(e,n,i),[f,h]=td(e+1,n+1,i);return{west:c,north:u,east:f,south:h}}const[s,o]=nv(e,n,i,r),[a,l]=nv(e+1,n+1,i,r);return{left:s,top:o,right:a,bottom:l}}function mz(t,e,n,i,r){const s=hz(t,null,i),o=Dg(e,n),[a,l,c,u]=gz(s,o,r),f=[];for(let h=Math.floor(a);h<c;h++)for(let d=Math.floor(l);d<u;d++)f.push({x:h,y:d,z:e});return f}function yz({viewport:t,maxZoom:e,minZoom:n,zRange:i,extent:r,tileSize:s=bn,modelMatrix:o,modelMatrixInverse:a,zoomOffset:l=0}){let c=t.isGeospatial?Math.round(t.zoom+Math.log2(bn/s))+l:Math.ceil(t.zoom)+l;if(typeof n=="number"&&Number.isFinite(n)&&c<n){if(!r)return[];c=n}typeof e=="number"&&Number.isFinite(e)&&c>e&&(c=e);let u=r;return o&&a&&r&&!t.isGeospatial&&(u=WE(r,o)),t.isGeospatial?cz(t,c,i,r):mz(t,c,s,u||uz,a)}function vz(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function _z(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}function wz(t){let e={},n;return i=>{for(const r in i)if(!Ez(i[r],e[r])){n=t(i),e=i;break}return n}}function Ez(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}const iv=1,Hc=2,xz="never",Tz="no-overlap",zg="best-available",Sz=5,bz={[zg]:Lz,[Tz]:Cz,[xz]:()=>{}},Pz={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class Az{constructor(e){g(this,"opts",void 0),g(this,"_requestScheduler",void 0),g(this,"_cache",void 0),g(this,"_dirty",void 0),g(this,"_tiles",void 0),g(this,"_cacheByteSize",void 0),g(this,"_viewport",void 0),g(this,"_zRange",void 0),g(this,"_selectedTiles",void 0),g(this,"_frameNumber",void 0),g(this,"_modelMatrix",void 0),g(this,"_modelMatrixInverse",void 0),g(this,"_maxZoom",void 0),g(this,"_minZoom",void 0),g(this,"onTileLoad",void 0),g(this,"_getCullBounds",wz(dz)),this.opts={...Pz,...e},this.onTileLoad=n=>{var i,r;(i=(r=this.opts).onTileLoad)===null||i===void 0||i.call(r,n),this.opts.maxCacheByteSize&&(this._cacheByteSize+=n.byteLength,this._resizeCache())},this._requestScheduler=new Rb({maxRequests:e.maxRequests,throttleRequests:!!(e.maxRequests&&e.maxRequests>0)}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new qe,this._modelMatrixInverse=new qe,this.setOptions(e)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const n=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(n)?this._cache.delete(e):n.setNeedsReload()}}update(e,{zRange:n,modelMatrix:i}={}){const r=new qe(i),s=!r.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!yn(this._zRange,n)||s){s&&(this._modelMatrixInverse=r.clone().invert(),this._modelMatrix=r),this._viewport=e,this._zRange=n;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:n,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(l=>this._getTile(l,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,n){if(!e.isVisible)return!1;if(n&&this._viewport){const i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:n}),{bbox:r}=e;for(const[s,o,a,l]of i){let c;if("west"in r)c=r.west<a&&r.east>s&&r.south<l&&r.north>o;else{const u=Math.min(r.top,r.bottom),f=Math.max(r.top,r.bottom);c=r.left<a&&r.right>s&&u<l&&f>o}if(c)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:n,minZoom:i,zRange:r,modelMatrix:s,modelMatrixInverse:o}){const{tileSize:a,extent:l,zoomOffset:c}=this.opts;return yz({viewport:e,maxZoom:n,minZoom:i,zRange:r,tileSize:a,extent:l,modelMatrix:s,modelMatrixInverse:o,zoomOffset:c})}getTileId(e){return"".concat(e.x,"-").concat(e.y,"-").concat(e.z)}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:n}=this.opts;return{bbox:pz(this._viewport,e.x,e.y,e.z,n)}}getParentIndex(e){const n=Math.floor(e.x/2),i=Math.floor(e.y/2),r=e.z-1;return{x:n,y:i,z:r}}updateTileStates(){const e=this.opts.refinementStrategy||zg,n=new Array(this._cache.size);let i=0;for(const r of this._cache.values())n[i++]=r.isVisible,r.isSelected=!1,r.isVisible=!1;for(const r of this._selectedTiles)r.isSelected=!0,r.isVisible=!0;(typeof e=="function"?e:bz[e])(Array.from(this._cache.values())),i=0;for(const r of this._cache.values())if(n[i++]!==r.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,n=[];let i=0;for(const r of this._cache.values())r.isLoading&&(i++,!r.isSelected&&!r.isVisible&&n.push(r));for(;e>0&&i>e&&n.length>0;)n.shift().abort(),i--}_rebuildTree(){const{_cache:e}=this;for(const n of e.values())n.parent=null,n.children&&(n.children.length=0);for(const n of e.values()){const i=this._getNearestAncestor(n);n.parent=i,i!=null&&i.children&&i.children.push(n)}}_resizeCache(){const{_cache:e,opts:n}=this,i=n.maxCacheSize||(n.maxCacheByteSize?1/0:Sz*this.selectedTiles.length),r=n.maxCacheByteSize||1/0;if(e.size>i||this._cacheByteSize>r){for(const[l,c]of e){if(!c.isVisible&&!c.isSelected){var o,a;this._cacheByteSize-=n.maxCacheByteSize?c.byteLength:0,e.delete(l),(o=(a=this.opts).onTileUnload)===null||o===void 0||o.call(a,c)}if(e.size<=i&&this._cacheByteSize<=r)break}this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((l,c)=>l.zoom-c.zoom),this._dirty=!1)}_getTile(e,n){const i=this.getTileId(e);let r=this._cache.get(i),s=!1;return!r&&n?(r=new jD(e),Object.assign(r,this.getTileMetadata(r.index)),Object.assign(r,{id:i,zoom:this.getTileZoom(r.index)}),s=!0,this._cache.set(i,r),this._dirty=!0):r&&r.needsReload&&(s=!0),r&&s&&r.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),r}_getNearestAncestor(e){const{_minZoom:n=0}=this;let i=e.index;for(;this.getTileZoom(i)>n;){i=this.getParentIndex(i);const r=this._getTile(i);if(r)return r}return null}}function Lz(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!$E(e)&&Bg(e);for(const e of t)e.isVisible=!!(e.state&Hc)}function Cz(t){for(const n of t)n.state=0;for(const n of t)n.isSelected&&$E(n);const e=Array.from(t).sort((n,i)=>n.zoom-i.zoom);for(const n of e)if(n.isVisible=!!(n.state&Hc),n.children&&(n.isVisible||n.state&iv))for(const i of n.children)i.state=iv;else n.isSelected&&Bg(n)}function $E(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=Hc,!0;e=e.parent}return!1}function Bg(t){for(const e of t.children)e.isLoaded||e.content?e.state|=Hc:Bg(e)}const Iz={TilesetClass:Az,data:{type:"data",value:[]},dataComparator:GE.equal,renderSubLayers:{type:"function",value:t=>new $o(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:zg,zRange:null,maxRequests:6,zoomOffset:0};class Ug extends zc{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,n;(e=this.state)===null||e===void 0||(n=e.tileset)===null||n===void 0||n.finalize()}get isLoaded(){var e,n;return(e=this.state)===null||e===void 0||(n=e.tileset)===null||n===void 0?void 0:n.selectedTiles.every(i=>i.isLoaded&&i.layers&&i.layers.every(r=>r.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:n}=this.state;const i=e.propsOrDataChanged||e.updateTriggersChanged,r=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);n?i&&(n.setOptions(this._getTilesetOptions()),r?n.reloadAll():this.state.tileset.tiles.forEach(s=>{s.layers=null})):(n=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:n})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:n,maxCacheByteSize:i,refinementStrategy:r,extent:s,maxZoom:o,minZoom:a,maxRequests:l,zoomOffset:c}=this.props;return{maxCacheSize:n,maxCacheByteSize:i,maxZoom:o,minZoom:a,tileSize:e,refinementStrategy:r,extent:s,maxRequests:l,zoomOffset:c,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const{tileset:e}=this.state,{zRange:n,modelMatrix:i}=this.props,r=e.update(this.context.viewport,{zRange:n,modelMatrix:i}),{isLoaded:s}=e,o=this.state.isLoaded!==s,a=this.state.frameNumber!==r;s&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:r}),this.state.isLoaded=s}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:n}=this.props;n&&n(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,n){this.props.onTileError(e),n.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:n,getTileData:i,fetch:r}=this.props,{signal:s}=e;return e.url=typeof n=="string"||Array.isArray(n)?HE(n,e):null,i?i(e):r&&e.url?r(e.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo({info:e,sourceLayer:n}){const i=n.props.tile;return e.picked&&(e.tile=i),e.sourceTile=i,e}_updateAutoHighlight(e){const n=e.sourceTile;if(n&&n.layers)for(const i of n.layers)i.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const n=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)n&&e.layers[0]&&Object.keys(n).some(i=>e.layers[0].props[i]!==n[i])&&(e.layers=e.layers.map(i=>i.clone(n)));else{const i=this.renderSubLayers({...this.props,id:"".concat(this.id,"-").concat(e.id),data:e.content,_offset:0,tile:e});e.layers=kc(i,Boolean).map(r=>r.clone({tile:e,...n}))}return e.layers})}filterSubLayer({layer:e,cullRect:n}){const{tile:i}=e.props;return this.state.tileset.isTileVisible(i,n)}}g(Ug,"defaultProps",Iz);g(Ug,"layerName","TileLayer");const Mz={clipBounds:[0,0,1,1],clipByInstance:void 0},XE=`
uniform vec4 clip_bounds;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,Rz={name:"clip-vs",vs:XE},Oz={"vs:#decl":`
varying float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
varying float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},kz={name:"clip-fs",fs:XE},Nz={"vs:#decl":`
varying vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
varying vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class Vg extends Pg{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[Rz],inject:Oz}:{modules:[kz],inject:Nz}}draw({uniforms:e}){const{clipBounds:n}=this.props;if(this.state.clipByInstance)e.clip_bounds=n;else{const i=this.projectPosition([n[0],n[1],0]),r=this.projectPosition([n[2],n[3],0]);e.clip_bounds=[Math.min(i[0],r[0]),Math.min(i[1],r[1]),Math.max(i[0],r[0]),Math.max(i[1],r[1])]}}}g(Vg,"defaultProps",Mz);g(Vg,"extensionName","ClipExtension");function Fz(t,e,n){const i=Dz(t),r=Object.keys(i).filter(s=>i[s]!==Array);return zz(t,{propArrayTypes:i,...e},{numericPropKeys:n&&n.numericPropKeys||r,PositionDataType:n?n.PositionDataType:Float32Array})}function Dz(t){const e={};for(const n of t)if(n.properties)for(const i in n.properties){const r=n.properties[i];e[i]=Wz(r,e[i])}return e}function zz(t,e,n){const{pointPositionsCount:i,pointFeaturesCount:r,linePositionsCount:s,linePathsCount:o,lineFeaturesCount:a,polygonPositionsCount:l,polygonObjectsCount:c,polygonRingsCount:u,polygonFeaturesCount:f,propArrayTypes:h,coordLength:d}=e,{numericPropKeys:p=[],PositionDataType:_=Float32Array}=n,x=t[0]&&"id"in t[0],y=t.length>65535?Uint32Array:Uint16Array,m={type:"Point",positions:new _(i*d),globalFeatureIds:new y(i),featureIds:r>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},w={type:"LineString",pathIndices:s>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new _(s*d),globalFeatureIds:new y(s),featureIds:a>65535?new Uint32Array(s):new Uint16Array(s),numericProps:{},properties:[],fields:[]},T={type:"Polygon",polygonIndices:l>65535?new Uint32Array(c+1):new Uint16Array(c+1),primitivePolygonIndices:l>65535?new Uint32Array(u+1):new Uint16Array(u+1),positions:new _(l*d),triangles:[],globalFeatureIds:new y(l),featureIds:f>65535?new Uint32Array(l):new Uint16Array(l),numericProps:{},properties:[],fields:[]};for(const P of[m,w,T])for(const L of p){const C=h[L];P.numericProps[L]=new C(P.positions.length/d)}w.pathIndices[o]=s,T.polygonIndices[c]=l,T.primitivePolygonIndices[u]=l;const b={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const P of t){const L=P.geometry,C=P.properties||{};switch(L.type){case"Point":Bz(L,m,b,d,C),m.properties.push(gf(C,p)),x&&m.fields.push({id:P.id}),b.pointFeature++;break;case"LineString":Uz(L,w,b,d,C),w.properties.push(gf(C,p)),x&&w.fields.push({id:P.id}),b.lineFeature++;break;case"Polygon":Vz(L,T,b,d,C),T.properties.push(gf(C,p)),x&&T.fields.push({id:P.id}),b.polygonFeature++;break;default:throw new Error("Invalid geometry type")}b.feature++}return Gz(m,w,T,d)}function Bz(t,e,n,i,r){e.positions.set(t.data,n.pointPosition*i);const s=t.data.length/i;jg(e,r,n.pointPosition,s),e.globalFeatureIds.fill(n.feature,n.pointPosition,n.pointPosition+s),e.featureIds.fill(n.pointFeature,n.pointPosition,n.pointPosition+s),n.pointPosition+=s}function Uz(t,e,n,i,r){e.positions.set(t.data,n.linePosition*i);const s=t.data.length/i;jg(e,r,n.linePosition,s),e.globalFeatureIds.fill(n.feature,n.linePosition,n.linePosition+s),e.featureIds.fill(n.lineFeature,n.linePosition,n.linePosition+s);for(let o=0,a=t.indices.length;o<a;++o){const l=t.indices[o],c=o===a-1?t.data.length:t.indices[o+1];e.pathIndices[n.linePath++]=n.linePosition,n.linePosition+=(c-l)/i}}function Vz(t,e,n,i,r){e.positions.set(t.data,n.polygonPosition*i);const s=t.data.length/i;jg(e,r,n.polygonPosition,s),e.globalFeatureIds.fill(n.feature,n.polygonPosition,n.polygonPosition+s),e.featureIds.fill(n.polygonFeature,n.polygonPosition,n.polygonPosition+s);for(let o=0,a=t.indices.length;o<a;++o){const l=n.polygonPosition;e.polygonIndices[n.polygonObject++]=l;const c=t.areas[o],u=t.indices[o],f=t.indices[o+1];for(let d=0,p=u.length;d<p;++d){const _=u[d],x=d===p-1?f===void 0?t.data.length:f[0]:u[d+1];e.primitivePolygonIndices[n.polygonRing++]=n.polygonPosition,n.polygonPosition+=(x-_)/i}const h=n.polygonPosition;jz(e,c,u,{startPosition:l,endPosition:h,coordLength:i})}}function jz(t,e,n,i){let{startPosition:r,endPosition:s,coordLength:o}=i;const a=r*o,l=s*o,c=t.positions.subarray(a,l),u=n[0],f=n.slice(1).map(d=>(d-u)/o),h=rF(c,f,o,e);for(let d=0,p=h.length;d<p;++d)t.triangles.push(r+h[d])}function df(t,e){const n={};for(const i in t)n[i]={value:t[i],size:e};return n}function Gz(t,e,n,i){return{points:{...t,positions:{value:t.positions,size:i},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:df(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:i},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:df(e.numericProps,1)},polygons:{...n,positions:{value:n.positions,size:i},polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},triangles:{value:new Uint32Array(n.triangles),size:1},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:df(n.numericProps,1)}}}function jg(t,e,n,i){for(const r in t.numericProps)if(r in e){const s=e[r];t.numericProps[r].fill(s,n,n+i)}}function gf(t,e){const n={};for(const i in t)e.includes(i)||(n[i]=t[i]);return n}function Wz(t,e){return e===Array||!Number.isFinite(t)?Array:e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}function rv(t,e){const n=e==null?void 0:e.globalFeatureId;return n!==void 0?Hz(t,n):$z(t,e==null?void 0:e.type)}function Hz(t,e){const n=YE(t);for(const i of n){let r=0,s=i.featureIds.value[0];for(let o=0;o<i.featureIds.value.length;o++){const a=i.featureIds.value[o];if(a!==s){if(e===i.globalFeatureIds.value[r])return fc(i,r,o);r=o,s=a}}if(e===i.globalFeatureIds.value[r])return fc(i,r,i.featureIds.value.length)}throw new Error("featureId:".concat(e," not found"))}function $z(t,e){const n=YE(t,e);return Yz(n)}function Xz(t,e,n){switch(t.type){case"Point":return Qz(t,e,n);case"LineString":return Kz(t,e,n);case"Polygon":return ZE(t,e,n);default:const i=t;throw new Error("Unsupported geometry type: ".concat(i==null?void 0:i.type))}}function YE(t,e){if(!!!(t.points||t.lines||t.polygons))return t.type=e||Jz(t),[t];const i=[];return t.points&&(t.points.type="Point",i.push(t.points)),t.lines&&(t.lines.type="LineString",i.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",i.push(t.polygons)),i}function Yz(t){const e=[];for(const n of t){if(n.featureIds.value.length===0)continue;let i=0,r=n.featureIds.value[0];for(let s=0;s<n.featureIds.value.length;s++){const o=n.featureIds.value[s];o!==r&&(e.push(fc(n,i,s)),i=s,r=o)}e.push(fc(n,i,n.featureIds.value.length))}return e}function fc(t,e,n){const i=Xz(t,e,n),r=qz(t,e,n),s=Zz(t,e,n);return{type:"Feature",geometry:i,properties:r,...s}}function Zz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return t.fields&&t.fields[t.featureIds.value[e]]}function qz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=Object.assign({},t.properties[t.featureIds.value[e]]);for(const i in t.numericProps)n[i]=t.numericProps[i].value[e];return n}function ZE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1/0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0;const{positions:i}=t,r=t.polygonIndices.value.filter(l=>l>=e&&l<=n),s=t.primitivePolygonIndices.value.filter(l=>l>=e&&l<=n);if(!(r.length>2)){const l=[];for(let c=0;c<s.length-1;c++){const u=s[c],f=s[c+1],h=hc(i,u,f);l.push(h)}return{type:"Polygon",coordinates:l}}const a=[];for(let l=0;l<r.length-1;l++){const c=r[l],u=r[l+1],f=ZE(t,c,u).coordinates;a.push(f)}return{type:"MultiPolygon",coordinates:a}}function Kz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1/0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0;const{positions:i}=t,r=t.pathIndices.value.filter(a=>a>=e&&a<=n);if(!(r.length>2))return{type:"LineString",coordinates:hc(i,r[0],r[1])};const o=[];for(let a=0;a<r.length-1;a++){const l=hc(i,r[a],r[a+1]);o.push(l)}return{type:"MultiLineString",coordinates:o}}function Qz(t,e,n){const{positions:i}=t,r=hc(i,e,n);return r.length>1?{type:"MultiPoint",coordinates:r}:{type:"Point",coordinates:r[0]}}function hc(t,e,n){e=e||0,n=n||t.value.length/t.size;const i=[];for(let r=e;r<n;r++){const s=Array();for(let o=r*t.size;o<(r+1)*t.size;o++)s.push(Number(t.value[o]));i.push(s)}return i}function Jz(t){return t.pathIndices?"LineString":t.polygonIndices?"Polygon":"Point"}var Gg={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Gg.read=function(t,e,n,i,r){var s,o,a=r*8-i-1,l=(1<<a)-1,c=l>>1,u=-7,f=n?r-1:0,h=n?-1:1,d=t[e+f];for(f+=h,s=d&(1<<-u)-1,d>>=-u,u+=a;u>0;s=s*256+t[e+f],f+=h,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=o*256+t[e+f],f+=h,u-=8);if(s===0)s=1-c;else{if(s===l)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-c}return(d?-1:1)*o*Math.pow(2,s-i)};Gg.write=function(t,e,n,i,r,s){var o,a,l,c=s*8-r-1,u=(1<<c)-1,f=u>>1,h=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:s-1,p=i?1:-1,_=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+f>=1?e+=h/l:e+=h*Math.pow(2,1-f),e*l>=2&&(o++,l/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(e*l-1)*Math.pow(2,r),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,r),o=0));r>=8;t[n+d]=a&255,d+=p,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;t[n+d]=o&255,d+=p,o/=256,c-=8);t[n+d-p]|=_*128};var qE=J,Xa=Gg;function J(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}J.Varint=0;J.Fixed64=1;J.Bytes=2;J.Fixed32=5;var nd=(1<<16)*(1<<16),sv=1/nd,e4=12,KE=typeof TextDecoder>"u"?null:new TextDecoder("utf8");J.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,s=this.pos;this.type=i&7,t(r,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Ya(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=av(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Ya(this.buf,this.pos)+Ya(this.buf,this.pos+4)*nd;return this.pos+=8,t},readSFixed64:function(){var t=Ya(this.buf,this.pos)+av(this.buf,this.pos+4)*nd;return this.pos+=8,t},readFloat:function(){var t=Xa.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Xa.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,n,i;return i=e[this.pos++],n=i&127,i<128||(i=e[this.pos++],n|=(i&127)<<7,i<128)||(i=e[this.pos++],n|=(i&127)<<14,i<128)||(i=e[this.pos++],n|=(i&127)<<21,i<128)?n:(i=e[this.pos],n|=(i&15)<<28,t4(n,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=e4&&KE?p4(this.buf,e,t):g4(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==J.Bytes)return t.push(this.readVarint(e));var n=cn(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==J.Bytes)return t.push(this.readSVarint());var e=cn(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==J.Bytes)return t.push(this.readBoolean());var e=cn(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==J.Bytes)return t.push(this.readFloat());var e=cn(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==J.Bytes)return t.push(this.readDouble());var e=cn(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==J.Bytes)return t.push(this.readFixed32());var e=cn(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==J.Bytes)return t.push(this.readSFixed32());var e=cn(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==J.Bytes)return t.push(this.readFixed64());var e=cn(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==J.Bytes)return t.push(this.readSFixed64());var e=cn(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===J.Varint)for(;this.buf[this.pos++]>127;);else if(e===J.Bytes)this.pos=this.readVarint()+this.pos;else if(e===J.Fixed32)this.pos+=4;else if(e===J.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),ir(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),ir(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),ir(this.buf,t&-1,this.pos),ir(this.buf,Math.floor(t*sv),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),ir(this.buf,t&-1,this.pos),ir(this.buf,Math.floor(t*sv),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){n4(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=m4(this.buf,t,this.pos);var n=this.pos-e;n>=128&&ov(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Xa.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Xa.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&ov(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,J.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,s4,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,o4,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,c4,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,a4,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,l4,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,u4,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,f4,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,h4,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,d4,e)},writeBytesField:function(t,e){this.writeTag(t,J.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,J.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,J.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,J.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,J.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,J.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,J.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,J.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,J.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,J.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function t4(t,e,n){var i=n.buf,r,s;if(s=i[n.pos++],r=(s&112)>>4,s<128||(s=i[n.pos++],r|=(s&127)<<3,s<128)||(s=i[n.pos++],r|=(s&127)<<10,s<128)||(s=i[n.pos++],r|=(s&127)<<17,s<128)||(s=i[n.pos++],r|=(s&127)<<24,s<128)||(s=i[n.pos++],r|=(s&1)<<31,s<128))return nr(t,r,e);throw new Error("Expected varint not more than 10 bytes")}function cn(t){return t.type===J.Bytes?t.readVarint()+t.pos:t.pos+1}function nr(t,e,n){return n?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function n4(t,e){var n,i;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(n=~(-t%4294967296),i=~(-t/4294967296),n^4294967295?n=n+1|0:(n=0,i=i+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),i4(n,i,e),r4(i,e)}function i4(t,e,n){n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos]=t&127}function r4(t,e){var n=(t&7)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function ov(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function s4(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function o4(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function a4(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function l4(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function c4(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function u4(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function f4(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function h4(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function d4(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Ya(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function ir(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function av(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function g4(t,e,n){for(var i="",r=e;r<n;){var s=t[r],o=null,a=s>239?4:s>223?3:s>191?2:1;if(r+a>n)break;var l,c,u;a===1?s<128&&(o=s):a===2?(l=t[r+1],(l&192)===128&&(o=(s&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=t[r+1],c=t[r+2],(l&192)===128&&(c&192)===128&&(o=(s&15)<<12|(l&63)<<6|c&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=t[r+1],c=t[r+2],u=t[r+3],(l&192)===128&&(c&192)===128&&(u&192)===128&&(o=(s&15)<<18|(l&63)<<12|(c&63)<<6|u&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),r+=a}return i}function p4(t,e,n){return KE.decode(t.subarray(e,n))}function m4(t,e,n){for(var i=0,r,s;i<e.length;i++){if(r=e.charCodeAt(i),r>55295&&r<57344)if(s)if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,s=r;continue}else r=s-55296<<10|r-56320|65536,s=null;else{r>56319||i+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):s=r;continue}else s&&(t[n++]=239,t[n++]=191,t[n++]=189,s=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=r&63|128)}return n}function y4(t){const e=t.length;if(e<=1)return[t];const n=[];let i,r;for(let s=0;s<e;s++){const o=v4(t[s]);o!==0&&(r===void 0&&(r=o<0),r===o<0?(i&&n.push(i),i=[t[s]]):i&&i.push(t[s]))}return i&&n.push(i),n}function v4(t){let e=0;for(let n=0,i=t.length-1,r,s;n<t.length;i=n++)r=t[n],s=t[i],e+=(s[0]-r[0])*(r[1]+s[1]);return e}function _4(t,e,n){e&&n&&(t===1?e.id=n.readVarint():t===2?w4(n,e):t===3?e.type=n.readVarint():t===4&&(e._geometry=n.pos))}function w4(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}let E4=class QE{static get types(){return["Unknown","Point","LineString","Polygon"]}constructor(e,n,i,r,s){g(this,"properties",void 0),g(this,"extent",void 0),g(this,"type",void 0),g(this,"id",void 0),g(this,"_pbf",void 0),g(this,"_geometry",void 0),g(this,"_keys",void 0),g(this,"_values",void 0),this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=r,this._values=s,e.readFields(_4,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let i=1,r=0,s=0,o=0;const a=[];let l;for(;e.pos<n;){if(r<=0){const c=e.readVarint();i=c&7,r=c>>3}if(r--,i===1||i===2)s+=e.readSVarint(),o+=e.readSVarint(),i===1&&(l&&a.push(l),l=[]),l&&l.push([s,o]);else if(i===7)l&&l.push(l[0].slice());else throw new Error("unknown command ".concat(i))}return l&&a.push(l),a}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let i=1,r=0,s=0,o=0,a=1/0,l=-1/0,c=1/0,u=-1/0;for(;e.pos<n;){if(r<=0){const f=e.readVarint();i=f&7,r=f>>3}if(r--,i===1||i===2)s+=e.readSVarint(),o+=e.readSVarint(),s<a&&(a=s),s>l&&(l=s),o<c&&(c=o),o>u&&(u=o);else if(i!==7)throw new Error("unknown command ".concat(i))}return[a,c,l,u]}_toGeoJSON(e){let n=this.loadGeometry(),i=QE.types[this.type],r,s;switch(this.type){case 1:const a=[];for(r=0;r<n.length;r++)a[r]=n[r][0];n=a,e(n,this);break;case 2:for(r=0;r<n.length;r++)e(n[r],this);break;case 3:for(n=y4(n),r=0;r<n.length;r++)for(s=0;s<n[r].length;s++)e(n[r][s],this);break}n.length===1?n=n[0]:i="Multi".concat(i);const o={type:"Feature",geometry:{type:i,coordinates:n},properties:this.properties};return this.id!==null&&(o.id=this.id),o}toGeoJSON(e){if(typeof e=="function")return this._toGeoJSON(e);const{x:n,y:i,z:r}=e,s=this.extent*Math.pow(2,r),o=this.extent*n,a=this.extent*i;function l(c){for(let u=0;u<c.length;u++){const f=c[u];f[0]=(f[0]+o)*360/s-180;const h=180-(f[1]+a)*360/s;f[1]=360/Math.PI*Math.atan(Math.exp(h*Math.PI/180))-90}}return this._toGeoJSON(l)}},x4=class{constructor(e,n){g(this,"version",void 0),g(this,"name",void 0),g(this,"extent",void 0),g(this,"length",void 0),g(this,"_pbf",void 0),g(this,"_keys",void 0),g(this,"_values",void 0),g(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(T4,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new E4(this._pbf,n,this.extent,this._keys,this._values)}};function T4(t,e,n){e&&n&&(t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(S4(n)))}function S4(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}let b4=class{constructor(e,n){g(this,"layers",void 0),this.layers=e.readFields(P4,{},n)}};function P4(t,e,n){if(t===3&&n){const i=new x4(n,n.readVarint()+n.pos);i.length&&e&&(e[i.name]=i)}}function A4(t){const e=t.indices.length,n="Polygon";if(e<=1)return{type:n,data:t.data,areas:[[ac(t.data)]],indices:[t.indices]};const i=[],r=[];let s=[],o=[],a,l=0;for(let c,u=0,f;u<e;u++){f=t.indices[u]-l,c=t.indices[u+1]-l||t.data.length;const h=t.data.slice(f,c),d=ac(h);if(d===0){const p=t.data.slice(0,f),_=t.data.slice(c);t.data=p.concat(_),l+=c-f;continue}a===void 0&&(a=d<0),a===d<0?(o.length&&(i.push(s),r.push(o)),o=[f],s=[d]):(s.push(d),o.push(f))}return s&&i.push(s),o.length&&r.push(o),{type:n,areas:i,indices:r,data:t.data}}function L4(t,e,n,i){for(let r=0,s=t.length;r<s;r+=2){t[r]=(t[r]+e)*360/i-180;const o=180-(t[r+1]+n)*360/i;t[r+1]=360/Math.PI*Math.atan(Math.exp(o*Math.PI/180))-90}}function C4(t,e,n){e&&n&&(t===1?e.id=n.readVarint():t===2?I4(n,e):t===3?e.type=n.readVarint():t===4&&(e._geometry=n.pos))}function I4(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}let lv,vi,pf,Za,mf,yf,Ls;class M4{constructor(e,n,i,r,s,o){g(this,"properties",void 0),g(this,"extent",void 0),g(this,"type",void 0),g(this,"id",void 0),g(this,"_pbf",void 0),g(this,"_geometry",void 0),g(this,"_keys",void 0),g(this,"_values",void 0),g(this,"_geometryInfo",void 0),this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=r,this._values=s,this._geometryInfo=o,e.readFields(C4,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry,lv=e.readVarint()+e.pos,vi=1,Za=0,mf=0,yf=0,Ls=0;const n=[],i=[];for(;e.pos<lv;)if(Za<=0&&(pf=e.readVarint(),vi=pf&7,Za=pf>>3),Za--,vi===1||vi===2)mf+=e.readSVarint(),yf+=e.readSVarint(),vi===1&&n.push(Ls),i.push(mf,yf),Ls+=2;else if(vi===7){if(Ls>0){const r=n[n.length-1];i.push(i[r],i[r+1]),Ls+=2}}else throw new Error("unknown command ".concat(vi));return{data:i,indices:n}}_toBinaryCoordinates(e){const n=this.loadGeometry();let i;e(n.data,this);const r=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=n.indices.length,i={type:"Point",...n};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=n.indices.length,this._geometryInfo.linePositionsCount+=n.data.length/r,i={type:"LineString",...n};break;case 3:i=A4(n),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=i.indices.length;for(const o of i.indices)this._geometryInfo.polygonRingsCount+=o.length;this._geometryInfo.polygonPositionsCount+=i.data.length/r;break;default:throw new Error("Invalid geometry type: ".concat(this.type))}const s={type:"Feature",geometry:i,properties:this.properties};return this.id!==null&&(s.id=this.id),s}toBinaryCoordinates(e){if(typeof e=="function")return this._toBinaryCoordinates(e);const{x:n,y:i,z:r}=e,s=this.extent*Math.pow(2,r),o=this.extent*n,a=this.extent*i;return this._toBinaryCoordinates(l=>L4(l,o,a,s))}}class R4{constructor(e,n){g(this,"version",void 0),g(this,"name",void 0),g(this,"extent",void 0),g(this,"length",void 0),g(this,"_pbf",void 0),g(this,"_keys",void 0),g(this,"_values",void 0),g(this,"_features",void 0),this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(O4,this,n),this.length=this._features.length}feature(e,n){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new M4(this._pbf,i,this.extent,this._keys,this._values,n)}}function O4(t,e,n){e&&n&&(t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(k4(n)))}function k4(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}class N4{constructor(e,n){g(this,"layers",void 0),this.layers=e.readFields(F4,{},n)}}function F4(t,e,n){if(t===3&&n){const i=new R4(n,n.readVarint()+n.pos);i.length&&e&&(e[i.name]=i)}}function cv(t,e){var n,i;const r=z4(e),s=(e==null||(n=e.gis)===null||n===void 0?void 0:n.format)||(e==null||(i=e.mvt)===null||i===void 0?void 0:i.shape);switch(s){case"columnar-table":return{shape:"columnar-table",data:vf(t,r)};case"geojson-row-table":return{shape:"geojson-row-table",data:uv(t,r)};case"geojson":return uv(t,r);case"binary-geometry":return vf(t,r);case"binary":return vf(t,r);default:throw new Error(s)}}function vf(t,e){const[n,i]=D4(t,e),r=Fz(n,i);return r.byteLength=t.byteLength,r}function D4(t,e){const n=[],i={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[n,i];const r=new N4(new qE(t));return(e&&Array.isArray(e.layers)?e.layers:Object.keys(r.layers)).forEach(o=>{const a=r.layers[o];if(a)for(let l=0;l<a.length;l++){const c=a.feature(l,i),u=U4(c,e,o);n.push(u)}}),[n,i]}function uv(t,e){if(t.byteLength<=0)return[];const n=[],i=new b4(new qE(t));return(Array.isArray(e.layers)?e.layers:Object.keys(i.layers)).forEach(s=>{const o=i.layers[s];if(o)for(let a=0;a<o.length;a++){const l=o.feature(a),c=B4(l,e,s);n.push(c)}}),n}function z4(t){var e;if(!(t!=null&&t.mvt))throw new Error("mvt options required");const n=((e=t.mvt)===null||e===void 0?void 0:e.coordinates)==="wgs84",{tileIndex:i}=t.mvt,r=i&&Number.isFinite(i.x)&&Number.isFinite(i.y)&&Number.isFinite(i.z);if(n&&!r)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return t.mvt}function B4(t,e,n){const i=t.toGeoJSON(e.coordinates==="wgs84"?e.tileIndex:V4);return e.layerProperty&&(i.properties[e.layerProperty]=n),i}function U4(t,e,n){const i=t.toBinaryCoordinates(e.coordinates==="wgs84"?e.tileIndex:j4);return e.layerProperty&&i.properties&&(i.properties[e.layerProperty]=n),i}function V4(t,e){const{extent:n}=e;for(let i=0;i<t.length;i++){const r=t[i];r[0]/=n,r[1]/=n}}function j4(t,e){const{extent:n}=e;for(let i=0,r=t.length;i<r;++i)t[i]/=n}const G4="3.3.2",W4={mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}},JE={name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:G4,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:W4};({...JE});const H4={Point:ex,MultiPoint:$4,LineString:tx,MultiLineString:X4,Polygon:nx,MultiPolygon:Y4};function ex([t,e],[n,i],r){const s=Gr(n[0],i[0],t),o=Gr(n[1],i[1],e);return r.unprojectFlat([s,o])}function Wg(t,e,n){return t.map(i=>ex(i,e,n))}function $4(t,e,n){return Wg(t,e,n)}function tx(t,e,n){return Wg(t,e,n)}function X4(t,e,n){return t.map(i=>tx(i,e,n))}function nx(t,e,n){return t.map(i=>Wg(i,e,n))}function Y4(t,e,n){return t.map(i=>nx(i,e,n))}function Z4(t,e,n){const i=n.projectFlat([e.west,e.north]),r=n.projectFlat([e.east,e.south]),s=[i,r];return{...t,coordinates:H4[t.type](t.coordinates,s,n)}}const q4=["points","lines","polygons"];function K4(t,e,n,i){for(const r of q4){const s=t[r]&&Q4(t[r],e,n,i);if(s>=0)return s}return-1}function Q4(t,e,n,i){const r=t.featureIds.value;if(!r.length)return-1;let s=0,o=r[r.length-1]+1;if(i){const l=J4(t,i);if(l)s=l[0],o=l[1]+1;else return-1}let a=-1;if(e in t.numericProps){const l=t.numericProps[e].value.findIndex((c,u)=>c===n&&r[u]>=s&&r[u]<o);return l>=0?t.globalFeatureIds.value[l]:-1}else e?a=fv(t.properties,l=>l[e]===n,s,o):t.fields&&(a=fv(t.fields,l=>l.id===n,s,o));return a>=0?eB(t,a):-1}function J4(t,e){if(!t.__layers){const n={},{properties:i}=t;for(let r=0;r<i.length;r++){const{layerName:s}=i[r];s&&(n[s]?n[s][1]=r:n[s]=[r,r])}t.__layers=n}return t.__layers[e]}function eB(t,e){if(!t.__ids){const n=[],i=t.featureIds.value,r=t.globalFeatureIds.value;for(let s=0;s<i.length;s++)n[i[s]]=r[s];t.__ids=n}return t.__ids[e]}function fv(t,e,n,i){for(let r=n;r<i;r++)if(e(t[r],r))return r;return-1}const _f=512,tB={...$o.defaultProps,data:GE,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[JE],binary:!0};class Hg extends Ug{initializeState(){super.initializeState();const e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null})}get isLoaded(){return this.state&&this.state.data&&this.state.tileset&&super.isLoaded}updateState({props:e,oldProps:n,context:i,changeFlags:r}){var s;r.dataChanged&&this._updateTileData(),(s=this.state)!==null&&s!==void 0&&s.data&&(super.updateState({props:e,oldProps:n,context:i,changeFlags:r}),this._setWGS84PropertyForTiles());const{highlightColor:o}=e;o!==n.highlightColor&&Array.isArray(o)&&this.setState({highlightColor:o})}async _updateTileData(){let e=this.props.data,n=null;if(typeof e=="string"&&!vz(e)){const{onDataLoad:i,fetch:r}=this.props;this.setState({data:null,tileJSON:null});try{n=await r(e,{propName:"data",layer:this,loaders:[]})}catch(s){this.raiseError(s,"loading TileJSON"),e=null}i&&i(n,{propName:"data",layer:this})}else e.tilejson&&(n=e);n&&(e=n.tiles),this.setState({data:e,tileJSON:n})}_getTilesetOptions(){const e=super._getTilesetOptions(),n=this.state.tileJSON,{minZoom:i,maxZoom:r}=this.props;return n&&(Number.isFinite(n.minzoom)&&n.minzoom>i&&(e.minZoom=n.minzoom),Number.isFinite(n.maxzoom)&&(!Number.isFinite(r)||n.maxzoom<r)&&(e.maxZoom=n.maxzoom)),e}renderLayers(){var e;return(e=this.state)!==null&&e!==void 0&&e.data?super.renderLayers():null}getTileData(e){var n;const{data:i,binary:r}=this.state,{index:s,signal:o}=e,a=HE(i,e);if(!a)return Promise.reject("Invalid URL");let l=this.getLoadOptions();const{fetch:c}=this.props;return l={...l,mimeType:"application/x-protobuf",mvt:{...(n=l)===null||n===void 0?void 0:n.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:s},gis:r?{format:"binary"}:{}},c(a,{propName:"data",layer:this,loadOptions:l,signal:o})}renderSubLayers(e){const{x:n,y:i,z:r}=e.tile.index,s=Math.pow(2,r),o=_f/s,a=-o,l=_f*n/s,c=_f*(1-i/s),u=new qe().scale([o,a,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=u,e.coordinateOrigin=[l,c,0],e.coordinateSystem=K.CARTESIAN,e.extensions=[...e.extensions||[],new Vg]);const f=super.renderSubLayers(e);return this.state.binary&&!(f instanceof $o)&&$.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),f}_updateAutoHighlight(e){const{uniqueIdProperty:n}=this.props,{hoveredFeatureId:i,hoveredFeatureLayerName:r}=this.state,s=e.object;let o,a;s&&(o=wf(s,n),a=hv(s));let{highlightColor:l}=this.props;typeof l=="function"&&(l=l(e)),(i!==o||r!==a)&&this.setState({highlightColor:l,hoveredFeatureId:o,hoveredFeatureLayerName:a})}getPickingInfo(e){const n=super.getPickingInfo(e),i=!!this.context.viewport.resolution;if(this.state.binary&&n.index!==-1){const{data:r}=e.sourceLayer.props;n.object=rv(r,{globalFeatureId:n.index})}return n.object&&!i&&(n.object=gv(n.object,n.tile.bbox,this.context.viewport)),n}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:n,hoveredFeatureLayerName:i,binary:r}=this.state,{uniqueIdProperty:s,highlightedFeatureId:o}=this.props,a=e.content,l=dv(o);if(!(dv(n)||l))return-1;const u=l?o:n;return Array.isArray(a)?a.findIndex(f=>{const h=wf(f,s)===u,d=l||hv(f)===i;return h&&d}):a&&r?K4(a,s,u,l?"":i):-1}_pickObjects(e){const{deck:n,viewport:i}=this.context,r=i.width,s=i.height,o=i.x,a=i.y,l=[this.id];return n.pickObjects({x:o,y:a,width:r,height:s,layerIds:l,maxObjects:e})}getRenderedFeatures(e=null){const n=this._pickObjects(e),i=new Set,r=[];for(const s of n){const o=wf(s.object,this.props.uniqueIdProperty);o===void 0?r.push(s.object):i.has(o)||(i.add(o),r.push(s.object))}return r}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(e)||Object.defineProperty(i,e,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];const{bbox:r}=i;if(i._contentWGS84===void 0&&_z(r)){const s=this.state.binary?rv(i.content):i.content;i._contentWGS84=s.map(o=>gv(o,r,this.context.viewport))}return i._contentWGS84}})})}}g(Hg,"layerName","MVTLayer");g(Hg,"defaultProps",tB);function wf(t,e){if(t.properties&&e)return t.properties[e];if("id"in t)return t.id}function hv(t){var e;return((e=t.properties)===null||e===void 0?void 0:e.layerName)||null}function dv(t){return t!=null&&t!==""}function gv(t,e,n){const i={...t,geometry:{type:t.geometry.type}};return Object.defineProperty(i.geometry,"coordinates",{get:()=>Z4(t.geometry,e,n).coordinates}),i}const nB="mapbox://styles/andrewcottam/clcsxyxcu002914qrsk95xyud",iB="pk.eyJ1IjoiYW5kcmV3Y290dGFtIiwiYSI6ImNsY3N4aHM5czB1YjkzbmxoNzN1NHk3aGYifQ.LzpyM7lJ5-f0vjshJoaNXg",rB={latitude:52.207,longitude:.315,zoom:8,minZoom:2,maxZoom:25};function sB({running:t}){return nT(yN,{initialViewState:rB,controller:!0,getTooltip:e=>{},children:[xl(Hg,{data:"https://basemaps.arcgis.com/arcgis/rest/services/OpenStreetMap_v2/VectorTileServer/tile/{z}/{y}/{x}.pbf",getFillColor:e=>{switch(e.properties.layerName){case"power pole":return[255,0,0];case"power tower":return[255,0,0];default:return[255,255,255,0]}},getLineColor:e=>{switch(e.properties.layerName){case"power line":return[0,0,255];case"power minor line":return[0,0,255];case"power major line":return[0,255,0];default:return[128,128,0]}},getLineWidth:e=>{switch(e.properties.layerName){case"power line":return 6;case"power minor line":return 6;case"power major line":return 6;default:return 0}},getPointRadius:e=>{switch(e.properties.layerName){case"power tower":return 6;case"power pole":return 5;default:return 1}},pickable:!0}),xl(Ag,{mapStyle:nB,mapboxAccessToken:iB})]})}Ef.createRoot(document.getElementById("root")).render(xl(Zx.StrictMode,{children:xl(sB,{running:!0})}));export{oB as c};
