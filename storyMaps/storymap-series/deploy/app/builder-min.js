/*! Storymaps-MapSeries - v1.10.1 - 2018-04-13, 12:03:40 PM - This application is released under the Apache License V2.0 by Esri http://www.esri.com/ - https://github.com/Esri/map-series-storytelling-template-js */define("lib-build/css",[],function(){if(typeof window=="undefined")return{load:function(e,t,n){n()}};var e=document.getElementsByTagName("head")[0],t=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/)||0,n=!1,r=!0;t[1]||t[7]?n=parseInt(t[1])<6||parseInt(t[7])<=9:t[2]?r=!1:t[4]&&(n=parseInt(t[4])<18);var i={};i.pluginBuilder="./css-builder";var s,o=function(){s=document.createElement("style"),e.appendChild(s)},u=function(e,t){o();var n=s.styleSheet||s.sheet;if(n&&n.addImport)n.addImport(e),s.onload=t;else{s.textContent='@import "'+e+'";';var r=setInterval(function(){try{s.sheet.cssRules,clearInterval(r),t()}catch(e){}},10)}},a=function(t,n){var i=document.createElement("link");i.type="text/css",i.rel="stylesheet";if(r)i.onload=function(){i.onload=function(){},setTimeout(n,7)};else var s=setInterval(function(){for(var e=0;e<document.styleSheets.length;e++){var t=document.styleSheets[e];if(t.href==i.href)return clearInterval(s),n()}},10);i.href=t,e.appendChild(i)};return i.normalize=function(e,t){return e.substr(e.length-4,4)==".css"&&(e=e.substr(0,e.length-4)),t(e)},i.load=function(e,t,r,i){(n?u:a)(t.toUrl(e+".css"),r)},i}),define("lib-build/css!lib-app/bootstrap/css/bootstrap.min",[],function(){}),define("lib-build/css!storymaps/common/ui/Modal",[],function(){}),define("lib-build/css!storymaps/common/Core",[],function(){}),!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function y(e){var t=e.length,n=p.type(e);return"function"===n||p.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e}function x(e,t,n){if(p.isFunction(t))return p.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return p.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(S.test(t))return p.filter(t,e,n);t=p.filter(t,e)}return p.grep(e,function(e){return p.inArray(e,t)>=0!==n})}function O(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function D(e){var t=_[e]={};return p.each(e.match(M)||[],function(e,n){t[n]=!0}),t}function H(){N.addEventListener?(N.removeEventListener("DOMContentLoaded",B,!1),e.removeEventListener("load",B,!1)):(N.detachEvent("onreadystatechange",B),e.detachEvent("onload",B))}function B(){(N.addEventListener||"load"===event.type||"complete"===N.readyState)&&(H(),p.ready())}function R(e,t,n){if(void 0===n&&1===e.nodeType){var r="data-"+t.replace(q,"-$1").toLowerCase();if(n=e.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:I.test(n)?p.parseJSON(n):n}catch(i){}p.data(e,t,n)}else n=void 0}return n}function U(e){var t;for(t in e)if(("data"!==t||!p.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function z(e,t,r,i){if(p.acceptData(e)){var s,o,u=p.expando,a=e.nodeType,f=a?p.cache:e,l=a?e[u]:e[u]&&u;if(l&&f[l]&&(i||f[l].data)||void 0!==r||"string"!=typeof t)return l||(l=a?e[u]=n.pop()||p.guid++:u),f[l]||(f[l]=a?{}:{toJSON:p.noop}),("object"==typeof t||"function"==typeof t)&&(i?f[l]=p.extend(f[l],t):f[l].data=p.extend(f[l].data,t)),o=f[l],i||(o.data||(o.data={}),o=o.data),void 0!==r&&(o[p.camelCase(t)]=r),"string"==typeof t?(s=o[t],null==s&&(s=o[p.camelCase(t)])):s=o,s}}function W(e,t,n){if(p.acceptData(e)){var r,i,s=e.nodeType,o=s?p.cache:e,u=s?e[p.expando]:p.expando;if(o[u]){if(t&&(r=n?o[u]:o[u].data)){p.isArray(t)?t=t.concat(p.map(t,p.camelCase)):t in r?t=[t]:(t=p.camelCase(t),t=t in r?[t]:t.split(" ")),i=t.length;while(i--)delete r[t[i]];if(n?!U(r):!p.isEmptyObject(r))return}(n||(delete o[u].data,U(o[u])))&&(s?p.cleanData([e],!0):c.deleteExpando||o!=o.window?delete o[u]:o[u]=null)}}}function tt(){return!0}function nt(){return!1}function rt(){try{return N.activeElement}catch(e){}}function it(e){var t=st.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Et(e,t){var n,r,i=0,s=typeof e.getElementsByTagName!==j?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==j?e.querySelectorAll(t||"*"):void 0;if(!s)for(s=[],n=e.childNodes||e;null!=(r=n[i]);i++)!t||p.nodeName(r,t)?s.push(r):p.merge(s,Et(r,t));return void 0===t||t&&p.nodeName(e,t)?p.merge([e],s):s}function St(e){K.test(e.type)&&(e.defaultChecked=e.checked)}function xt(e,t){return p.nodeName(e,"table")&&p.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function Tt(e){return e.type=(null!==p.find.attr(e,"type"))+"/"+e.type,e}function Nt(e){var t=mt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Ct(e,t){for(var n,r=0;null!=(n=e[r]);r++)p._data(n,"globalEval",!t||p._data(t[r],"globalEval"))}function kt(e,t){if(1===t.nodeType&&p.hasData(e)){var n,r,i,s=p._data(e),o=p._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;i>r;r++)p.event.add(t,n,u[n][r])}o.data&&(o.data=p.extend({},o.data))}}function Lt(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!c.noCloneEvent&&t[p.expando]){i=p._data(t);for(r in i.events)p.removeEvent(t,r,i.handle);t.removeAttribute(p.expando)}"script"===n&&t.text!==e.text?(Tt(t).text=e.text,Nt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),c.html5Clone&&e.innerHTML&&!p.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&K.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function Mt(t,n){var r=p(n.createElement(t)).appendTo(n.body),i=e.getDefaultComputedStyle?e.getDefaultComputedStyle(r[0]).display:p.css(r[0],"display");return r.detach(),i}function _t(e){var t=N,n=Ot[e];return n||(n=Mt(e,t),"none"!==n&&n||(At=(At||p("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(At[0].contentWindow||At[0].contentDocument).document,t.write(),t.close(),n=Mt(e,t),At.detach()),Ot[e]=n),n}function Ft(e,t){return{get:function(){var n=e();if(null!=n)return n?void delete this.get:(this.get=t).apply(this,arguments)}}}function $t(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Vt.length;while(i--)if(t=Vt[i]+n,t in e)return t;return r}function Jt(e,t){for(var n,r,i,s=[],o=0,u=e.length;u>o;o++)r=e[o],r.style&&(s[o]=p._data(r,"olddisplay"),n=r.style.display,t?(s[o]||"none"!==n||(r.style.display=""),""===r.style.display&&$(r)&&(s[o]=p._data(r,"olddisplay",_t(r.nodeName)))):s[o]||(i=$(r),(n&&"none"!==n||!i)&&p._data(r,"olddisplay",i?n:p.css(r,"display"))));for(o=0;u>o;o++)r=e[o],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?s[o]||"":"none"));return e}function Kt(e,t,n){var r=Ut.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function Qt(e,t,n,r,i){for(var s=n===(r?"border":"content")?4:"width"===t?1:0,o=0;4>s;s+=2)"margin"===n&&(o+=p.css(e,n+V[s],!0,i)),r?("content"===n&&(o-=p.css(e,"padding"+V[s],!0,i)),"margin"!==n&&(o-=p.css(e,"border"+V[s]+"Width",!0,i))):(o+=p.css(e,"padding"+V[s],!0,i),"padding"!==n&&(o+=p.css(e,"border"+V[s]+"Width",!0,i)));return o}function Gt(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,s=Ht(e),o=c.boxSizing()&&"border-box"===p.css(e,"boxSizing",!1,s);if(0>=i||null==i){if(i=Bt(e,t,s),(0>i||null==i)&&(i=e.style[t]),Pt.test(i))return i;r=o&&(c.boxSizingReliable()||i===e.style[t]),i=parseFloat(i)||0}return i+Qt(e,t,n||(o?"border":"content"),r,s)+"px"}function Yt(e,t,n,r,i){return new Yt.prototype.init(e,t,n,r,i)}function un(){return setTimeout(function(){Zt=void 0}),Zt=p.now()}function an(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=V[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function fn(e,t,n){for(var r,i=(on[t]||[]).concat(on["*"]),s=0,o=i.length;o>s;s++)if(r=i[s].call(n,t,e))return r}function ln(e,t,n){var r,i,s,o,u,a,f,l,h=this,d={},v=e.style,m=e.nodeType&&$(e),g=p._data(e,"fxshow");n.queue||(u=p._queueHooks(e,"fx"),null==u.unqueued&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,h.always(function(){h.always(function(){u.unqueued--,p.queue(e,"fx").length||u.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[v.overflow,v.overflowX,v.overflowY],f=p.css(e,"display"),l=_t(e.nodeName),"none"===f&&(f=l),"inline"===f&&"none"===p.css(e,"float")&&(c.inlineBlockNeedsLayout&&"inline"!==l?v.zoom=1:v.display="inline-block")),n.overflow&&(v.overflow="hidden",c.shrinkWrapBlocks()||h.always(function(){v.overflow=n.overflow[0],v.overflowX=n.overflow[1],v.overflowY=n.overflow[2]}));for(r in t)if(i=t[r],tn.exec(i)){if(delete t[r],s=s||"toggle"===i,i===(m?"hide":"show")){if("show"!==i||!g||void 0===g[r])continue;m=!0}d[r]=g&&g[r]||p.style(e,r)}if(!p.isEmptyObject(d)){g?"hidden"in g&&(m=g.hidden):g=p._data(e,"fxshow",{}),s&&(g.hidden=!m),m?p(e).show():h.done(function(){p(e).hide()}),h.done(function(){var t;p._removeData(e,"fxshow");for(t in d)p.style(e,t,d[t])});for(r in d)o=fn(m?g[r]:0,r,h),r in g||(g[r]=o.start,m&&(o.end=o.start,o.start="width"===r||"height"===r?1:0))}}function cn(e,t){var n,r,i,s,o;for(n in e)if(r=p.camelCase(n),i=t[r],s=e[n],p.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=p.cssHooks[r],o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}function hn(e,t,n){var r,i,s=0,o=sn.length,u=p.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;for(var t=Zt||un(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;a>o;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),1>s&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:p.extend({},t),opts:p.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Zt||un(),duration:n.duration,tweens:[],createTween:function(t,n){var r=p.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;for(cn(l,f.opts.specialEasing);o>s;s++)if(r=sn[s].call(f,e,l,f.opts))return r;return p.map(l,fn,f),p.isFunction(f.opts.start)&&f.opts.start.call(e,f),p.fx.timer(p.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function In(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(M)||[];if(p.isFunction(n))while(r=s[i++])"+"===r.charAt(0)?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,t,n,r){function o(u){var a;return i[u]=!0,p.each(e[u]||[],function(e,u){var f=u(t,n,r);return"string"!=typeof f||s||i[f]?s?!(a=f):void 0:(t.dataTypes.unshift(f),o(f),!1)}),a}var i={},s=e===Bn;return o(t.dataTypes[0])||!i["*"]&&o("*")}function Rn(e,t){var n,r,i=p.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((i[r]?e:n||(n={}))[r]=t[r]);return n&&p.extend(!0,e,n),e}function Un(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while("*"===a[0])a.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(o in u)if(u[o]&&u[o].test(i)){a.unshift(o);break}if(a[0]in n)s=a[0];else{for(o in n){if(!a[0]||e.converters[o+" "+a[0]]){s=o;break}r||(r=o)}s=s||r}return s?(s!==a[0]&&a.unshift(s),n[s]):void 0}function zn(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift())if("*"===s)s=a;else if("*"!==a&&a!==s){if(o=f[a+" "+s]||f["* "+s],!o)for(i in f)if(u=i.split(" "),u[1]===s&&(o=f[a+" "+u[0]]||f["* "+u[0]])){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}return{state:"success",data:t}}function Kn(e,t,n,r){var i;if(p.isArray(t))p.each(t,function(t,i){n||Xn.test(e)?r(e,i):Kn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==p.type(t))r(e,t);else for(i in t)Kn(e+"["+i+"]",t[i],n,r)}function Zn(){try{return new e.XMLHttpRequest}catch(t){}}function er(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function sr(e){return p.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var n=[],r=n.slice,i=n.concat,s=n.push,o=n.indexOf,u={},a=u.toString,f=u.hasOwnProperty,l="".trim,c={},h="1.11.0",p=function(e,t){return new p.fn.init(e,t)},d=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,v=/^-ms-/,m=/-([\da-z])/gi,g=function(e,t){return t.toUpperCase()};p.fn=p.prototype={jquery:h,constructor:p,selector:"",length:0,toArray:function(){return r.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:r.call(this)},pushStack:function(e){var t=p.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return p.each(this,e,t)},map:function(e){return this.pushStack(p.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:s,sort:n.sort,splice:n.splice},p.extend=p.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;for("boolean"==typeof o&&(f=o,o=arguments[u]||{},u++),"object"==typeof o||p.isFunction(o)||(o={}),u===a&&(o=this,u--);a>u;u++)if(null!=(i=arguments[u]))for(r in i)e=o[r],n=i[r],o!==n&&(f&&n&&(p.isPlainObject(n)||(t=p.isArray(n)))?(t?(t=!1,s=e&&p.isArray(e)?e:[]):s=e&&p.isPlainObject(e)?e:{},o[r]=p.extend(f,s,n)):void 0!==n&&(o[r]=n));return o},p.extend({expando:"jQuery"+(h+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===p.type(e)},isArray:Array.isArray||function(e){return"array"===p.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return e-parseFloat(e)>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||"object"!==p.type(e)||e.nodeType||p.isWindow(e))return!1;try{if(e.constructor&&!f.call(e,"constructor")&&!f.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(c.ownLast)for(t in e)return f.call(e,t);for(t in e);return void 0===t||f.call(e,t)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?u[a.call(e)]||"object":typeof e},globalEval:function(t){t&&p.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(v,"ms-").replace(m,g)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=y(e);if(n){if(o){for(;s>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(o){for(;s>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:l&&!l.call("﻿ ")?function(e){return null==e?"":l.call(e)}:function(e){return null==e?"":(e+"").replace(d,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(y(Object(e))?p.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(o)return o.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,t){var n=+t.length,r=0,i=e.length;while(n>r)e[i++]=t[r++];if(n!==n)while(void 0!==t[r])e[i++]=t[r++];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],s=0,o=e.length,u=!n;o>s;s++)r=!t(e[s],s),r!==u&&i.push(e[s]);return i},map:function(e,t,n){var r,s=0,o=e.length,u=y(e),a=[];if(u)for(;o>s;s++)r=t(e[s],s,n),null!=r&&a.push(r);else for(s in e)r=t(e[s],s,n),null!=r&&a.push(r);return i.apply([],a)},guid:1,proxy:function(e,t){var n,i,s;return"string"==typeof t&&(s=e[t],t=e,e=s),p.isFunction(e)?(n=r.call(arguments,2),i=function(){return e.apply(t||this,n.concat(r.call(arguments)))},i.guid=e.guid=e.guid||p.guid++,i):void 0},now:function(){return+(new Date)},support:c}),p.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){u["[object "+t+"]"]=t.toLowerCase()});var b=function(e){function rt(e,t,r,i){var s,o,u,a,f,h,v,m,w,E;if((t?t.ownerDocument||t:b)!==c&&l(t),t=t||c,r=r||[],!e||"string"!=typeof e)return r;if(1!==(a=t.nodeType)&&9!==a)return[];if(p&&!i){if(s=G.exec(e))if(u=s[1]){if(9===a){if(o=t.getElementById(u),!o||!o.parentNode)return r;if(o.id===u)return r.push(o),r}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(u))&&g(t,o)&&o.id===u)return r.push(o),r}else{if(s[2])return _.apply(r,t.getElementsByTagName(e)),r;if((u=s[3])&&n.getElementsByClassName&&t.getElementsByClassName)return _.apply(r,t.getElementsByClassName(u)),r}if(n.qsa&&(!d||!d.test(e))){if(m=v=y,w=t,E=9===a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){h=dt(e),(v=t.getAttribute("id"))?m=v.replace(Z,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",f=h.length;while(f--)h[f]=m+vt(h[f]);w=Y.test(e)&&ht(t.parentNode)||t,E=h.join(",")}if(E)try{return _.apply(r,w.querySelectorAll(E)),r}catch(S){}finally{v||t.removeAttribute("id")}}}return xt(e.replace(R,"$1"),t,r,i)}function it(){function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function st(e){return e[y]=!0,e}function ot(e){var t=c.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ut(e,t){var n=e.split("|"),i=e.length;while(i--)r.attrHandle[n[i]]=t}function at(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||k)-(~e.sourceIndex||k);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ct(e){return st(function(t){return t=+t,st(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ht(e){return e&&typeof e.getElementsByTagName!==C&&e}function pt(){}function dt(e,t){var n,i,s,o,u,a,f,l=x[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=r.preFilter;while(u){(!n||(i=U.exec(u)))&&(i&&(u=u.slice(i[0].length)||u),a.push(s=[])),n=!1,(i=z.exec(u))&&(n=i.shift(),s.push({value:n,type:i[0].replace(R," ")}),u=u.slice(n.length));for(o in r.filter)!(i=$[o].exec(u))||f[o]&&!(i=f[o](i))||(n=i.shift(),s.push({value:n,type:o,matches:i}),u=u.slice(n.length));if(!n)break}return t?u.length:u?rt.error(e):x(e,a).slice(0)}function vt(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function mt(e,t,n){var r=t.dir,i=n&&"parentNode"===r,s=E++;return t.first?function(t,n,s){while(t=t[r])if(1===t.nodeType||i)return e(t,n,s)}:function(t,n,o){var u,a,f=[w,s];if(o){while(t=t[r])if((1===t.nodeType||i)&&e(t,n,o))return!0}else while(t=t[r])if(1===t.nodeType||i){if(a=t[y]||(t[y]={}),(u=a[r])&&u[0]===w&&u[1]===s)return f[2]=u[2];if(a[r]=f,f[2]=e(t,n,o))return!0}}}function gt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function yt(e,t,n,r,i){for(var s,o=[],u=0,a=e.length,f=null!=t;a>u;u++)(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push(u));return o}function bt(e,t,n,r,i,s){return r&&!r[y]&&(r=bt(r)),i&&!i[y]&&(i=bt(i,s)),st(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||St(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:yt(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;if(n&&n(m,g,u,a),r){f=yt(g,p),r(f,[],u,a),l=f.length;while(l--)(c=f[l])&&(g[p[l]]=!(m[p[l]]=c))}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?P.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=yt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):_.apply(o,g)})}function wt(e){for(var t,n,i,s=e.length,o=r.relative[e[0].type],a=o||r.relative[" "],f=o?1:0,l=mt(function(e){return e===t},a,!0),c=mt(function(e){return P.call(t,e)>-1},a,!0),h=[function(e,n,r){return!o&&(r||n!==u)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];s>f;f++)if(n=r.relative[e[f].type])h=[mt(gt(h),n)];else{if(n=r.filter[e[f].type].apply(null,e[f].matches),n[y]){for(i=++f;s>i;i++)if(r.relative[e[i].type])break;return bt(f>1&&gt(h),f>1&&vt(e.slice(0,f-1).concat({value:" "===e[f-2].type?"*":""})).replace(R,"$1"),n,i>f&&wt(e.slice(f,i)),s>i&&wt(e=e.slice(i)),s>i&&vt(e))}h.push(n)}return gt(h)}function Et(e,t){var n=t.length>0,i=e.length>0,s=function(s,o,a,f,l){var h,p,d,v=0,m="0",g=s&&[],y=[],b=u,E=s||i&&r.find.TAG("*",l),S=w+=null==b?1:Math.random()||.1,x=E.length;for(l&&(u=o!==c&&o);m!==x&&null!=(h=E[m]);m++){if(i&&h){p=0;while(d=e[p++])if(d(h,o,a)){f.push(h);break}l&&(w=S)}n&&((h=!d&&h)&&v--,s&&g.push(h))}if(v+=m,n&&m!==v){p=0;while(d=t[p++])d(g,y,o,a);if(s){if(v>0)while(m--)g[m]||y[m]||(y[m]=O.call(f));y=yt(y)}_.apply(f,y),l&&!s&&y.length>0&&v+t.length>1&&rt.uniqueSort(f)}return l&&(w=S,u=b),g};return n?st(s):s}function St(e,t,n){for(var r=0,i=t.length;i>r;r++)rt(e,t[r],n);return n}function xt(e,t,i,s){var u,a,f,l,c,h=dt(e);if(!s&&1===h.length){if(a=h[0]=h[0].slice(0),a.length>2&&"ID"===(f=a[0]).type&&n.getById&&9===t.nodeType&&p&&r.relative[a[1].type]){if(t=(r.find.ID(f.matches[0].replace(et,tt),t)||[])[0],!t)return i;e=e.slice(a.shift().value.length)}u=$.needsContext.test(e)?0:a.length;while(u--){if(f=a[u],r.relative[l=f.type])break;if((c=r.find[l])&&(s=c(f.matches[0].replace(et,tt),Y.test(a[0].type)&&ht(t.parentNode)||t))){if(a.splice(u,1),e=s.length&&vt(a),!e)return _.apply(i,s),i;break}}}return o(e,h)(s,t,!p,i,Y.test(e)&&ht(t.parentNode)||t),i}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y="sizzle"+ -(new Date),b=e.document,w=0,E=0,S=it(),x=it(),T=it(),N=function(e,t){return e===t&&(f=!0),0},C="undefined",k=1<<31,L={}.hasOwnProperty,A=[],O=A.pop,M=A.push,_=A.push,D=A.slice,P=A.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},H="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="[\\x20\\t\\r\\n\\f]",j="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",F=j.replace("w","w#"),I="\\["+B+"*("+j+")"+B+"*(?:([*^$|!~]?=)"+B+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+F+")|)|)"+B+"*\\]",q=":("+j+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+I.replace(3,8)+")*)|.*)\\)|)",R=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),U=new RegExp("^"+B+"*,"+B+"*"),z=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),W=new RegExp("="+B+"*([^\\]'\"]*?)"+B+"*\\]","g"),X=new RegExp(q),V=new RegExp("^"+F+"$"),$={ID:new RegExp("^#("+j+")"),CLASS:new RegExp("^\\.("+j+")"),TAG:new RegExp("^("+j.replace("w","w*")+")"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+H+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},J=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,G=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Y=/[+~]/,Z=/'|\\/g,et=new RegExp("\\\\([\\da-f]{1,6}"+B+"?|("+B+")|.)","ig"),tt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{_.apply(A=D.call(b.childNodes),b.childNodes),A[b.childNodes.length].nodeType}catch(nt){_={apply:A.length?function(e,t){M.apply(e,D.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}n=rt.support={},s=rt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},l=rt.setDocument=function(e){var t,i=e?e.ownerDocument||e:b,o=i.defaultView;return i!==c&&9===i.nodeType&&i.documentElement?(c=i,h=i.documentElement,p=!s(i),o&&o!==o.top&&(o.addEventListener?o.addEventListener("unload",function(){l()},!1):o.attachEvent&&o.attachEvent("onunload",function(){l()})),n.attributes=ot(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ot(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Q.test(i.getElementsByClassName)&&ot(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),n.getById=ot(function(e){return h.appendChild(e).id=y,!i.getElementsByName||!i.getElementsByName(y).length}),n.getById?(r.find.ID=function(e,t){if(typeof t.getElementById!==C&&p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},r.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==C&&e.getAttributeNode("id");return n&&n.value===t}}),r.find.TAG=n.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==C?t.getElementsByTagName(e):void 0}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++])1===n.nodeType&&r.push(n);return r}return s},r.find.CLASS=n.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==C&&p?t.getElementsByClassName(e):void 0},v=[],d=[],(n.qsa=Q.test(i.querySelectorAll))&&(ot(function(e){e.innerHTML="<select t=''><option selected=''></option></select>",e.querySelectorAll("[t^='']").length&&d.push("[*^$]="+B+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||d.push("\\["+B+"*(?:value|"+H+")"),e.querySelectorAll(":checked").length||d.push(":checked")}),ot(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&d.push("name"+B+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")})),(n.matchesSelector=Q.test(m=h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ot(function(e){n.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),v.push("!=",q)}),d=d.length&&new RegExp(d.join("|")),v=v.length&&new RegExp(v.join("|")),t=Q.test(h.compareDocumentPosition),g=t||Q.test(h.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&1===r.nodeType&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},N=t?function(e,t){if(e===t)return f=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===i||e.ownerDocument===b&&g(b,e)?-1:t===i||t.ownerDocument===b&&g(b,t)?1:a?P.call(a,e)-P.call(a,t):0:4&r?-1:1)}:function(e,t){if(e===t)return f=!0,0;var n,r=0,s=e.parentNode,o=t.parentNode,u=[e],l=[t];if(!s||!o)return e===i?-1:t===i?1:s?-1:o?1:a?P.call(a,e)-P.call(a,t):0;if(s===o)return at(e,t);n=e;while(n=n.parentNode)u.unshift(n);n=t;while(n=n.parentNode)l.unshift(n);while(u[r]===l[r])r++;return r?at(u[r],l[r]):u[r]===b?-1:l[r]===b?1:0},i):c},rt.matches=function(e,t){return rt(e,null,null,t)},rt.matchesSelector=function(e,t){if((e.ownerDocument||e)!==c&&l(e),t=t.replace(W,"='$1']"),!(!n.matchesSelector||!p||v&&v.test(t)||d&&d.test(t)))try{var r=m.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(i){}return rt(t,c,null,[e]).length>0},rt.contains=function(e,t){return(e.ownerDocument||e)!==c&&l(e),g(e,t)},rt.attr=function(e,t){(e.ownerDocument||e)!==c&&l(e);var i=r.attrHandle[t.toLowerCase()],s=i&&L.call(r.attrHandle,t.toLowerCase())?i(e,t,!p):void 0;return void 0!==s?s:n.attributes||!p?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},rt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},rt.uniqueSort=function(e){var t,r=[],i=0,s=0;if(f=!n.detectDuplicates,a=!n.sortStable&&e.slice(0),e.sort(N),f){while(t=e[s++])t===e[s]&&(i=r.push(s));while(i--)e.splice(r[i],1)}return a=null,e},i=rt.getText=function(e){var t,n="",r=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===s||4===s)return e.nodeValue}else while(t=e[r++])n+=i(t);return n},r=rt.selectors={cacheLength:50,createPseudo:st,match:$,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||rt.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&rt.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return $.CHILD.test(e[0])?null:(e[3]&&void 0!==e[4]?e[2]=e[4]:n&&X.test(n)&&(t=dt(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(et,tt).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=S[e+" "];return t||(t=new RegExp("(^|"+B+")"+e+"("+B+"|$)"))&&S(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==C&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=rt.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),b=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:1===c.nodeType)return!1;d=v="only"===e&&!d&&"nextSibling"}return!0}if(d=[o?m.firstChild:m.lastChild],o&&b){l=m[y]||(m[y]={}),f=l[e]||[],p=f[0]===w&&f[1],h=f[0]===w&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(1===c.nodeType&&++h&&c===t){l[e]=[w,p,h];break}}else if(b&&(f=(t[y]||(t[y]={}))[e])&&f[0]===w)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(b&&((c[y]||(c[y]={}))[e]=[w,h]),c===t))break;return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||rt.error("unsupported pseudo: "+e);return i[y]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?st(function(e,n){var r,s=i(e,t),o=s.length;while(o--)r=P.call(e,s[o]),e[r]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:st(function(e){var t=[],n=[],r=o(e.replace(R,"$1"));return r[y]?st(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)(s=o[u])&&(e[u]=!(t[u]=s))}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:st(function(e){return function(t){return rt(e,t).length>0}}),contains:st(function(e){return function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:st(function(e){return V.test(e||"")||rt.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=p?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return K.test(e.nodeName)},input:function(e){return J.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ct(function(){return[0]}),last:ct(function(e,t){return[t-1]}),eq:ct(function(e,t,n){return[0>n?n+t:n]}),even:ct(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:ct(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:ct(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:ct(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ft(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=lt(t);return pt.prototype=r.filters=r.pseudos,r.setFilters=new pt,o=rt.compile=function(e,t){var n,r=[],i=[],s=T[e+" "];if(!s){t||(t=dt(e)),n=t.length;while(n--)s=wt(t[n]),s[y]?r.push(s):i.push(s);s=T(e,Et(i,r))}return s},n.sortStable=y.split("").sort(N).join("")===y,n.detectDuplicates=!!f,l(),n.sortDetached=ot(function(e){return 1&e.compareDocumentPosition(c.createElement("div"))}),ot(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||ut("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&ot(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||ut("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),ot(function(e){return null==e.getAttribute("disabled")})||ut(H,function(e,t,n){var r;return n?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),rt}(e);p.find=b,p.expr=b.selectors,p.expr[":"]=p.expr.pseudos,p.unique=b.uniqueSort,p.text=b.getText,p.isXMLDoc=b.isXML,p.contains=b.contains;var w=p.expr.match.needsContext,E=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,S=/^.[^:#\[\.,]*$/;p.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?p.find.matchesSelector(r,e)?[r]:[]:p.find.matches(e,p.grep(t,function(e){return 1===e.nodeType}))},p.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(p(e).filter(function(){for(t=0;i>t;t++)if(p.contains(r[t],this))return!0}));for(t=0;i>t;t++)p.find(e,r[t],n);return n=this.pushStack(i>1?p.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(x(this,e||[],!1))},not:function(e){return this.pushStack(x(this,e||[],!0))},is:function(e){return!!x(this,"string"==typeof e&&w.test(e)?p(e):e||[],!1).length}});var T,N=e.document,C=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,k=p.fn.init=function(e,t){var n,r;if(!e)return this;if("string"==typeof e){if(n="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:C.exec(e),!n||!n[1]&&t)return!t||t.jquery?(t||T).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof p?t[0]:t,p.merge(this,p.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:N,!0)),E.test(n[1])&&p.isPlainObject(t))for(n in t)p.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}if(r=N.getElementById(n[2]),r&&r.parentNode){if(r.id!==n[2])return T.find(e);this.length=1,this[0]=r}return this.context=N,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):p.isFunction(e)?"undefined"!=typeof T.ready?T.ready(e):e(p):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),p.makeArray(e,this))};k.prototype=p.fn,T=p(N);var L=/^(?:parents|prev(?:Until|All))/,A={children:!0,contents:!0,next:!0,prev:!0};p.extend({dir:function(e,t,n){var r=[],i=e[t];while(i&&9!==i.nodeType&&(void 0===n||1!==i.nodeType||!p(i).is(n)))1===i.nodeType&&r.push(i),i=i[t];return r},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),p.fn.extend({has:function(e){var t,n=p(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(p.contains(this,n[t]))return!0})},closest:function(e,t){for(var n,r=0,i=this.length,s=[],o=w.test(e)||"string"!=typeof e?p(e,t||this.context):0;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&p.find.matchesSelector(n,e))){s.push(n);break}return this.pushStack(s.length>1?p.unique(s):s)},index:function(e){return e?"string"==typeof e?p.inArray(this[0],p(e)):p.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(p.unique(p.merge(this.get(),p(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),p.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return p.dir(e,"parentNode")},parentsUntil:function(e,t,n){return p.dir(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return p.dir(e,"nextSibling")},prevAll:function(e){return p.dir(e,"previousSibling")},nextUntil:function(e,t,n){return p.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return p.dir(e,"previousSibling",n)},siblings:function(e){return p.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return p.sibling(e.firstChild)},contents:function(e){return p.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:p.merge([],e.childNodes)}},function(e,t){p.fn[e]=function(n,r){var i=p.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=p.filter(r,i)),this.length>1&&(A[e]||(i=p.unique(i)),L.test(e)&&(i=i.reverse())),this.pushStack(i)}});var M=/\S+/g,_={};p.Callbacks=function(e){e="string"==typeof e?_[e]||D(e):p.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){for(n=e.memory&&c,r=!0,s=o||0,o=0,i=u.length,t=!0;u&&i>s;s++)if(u[s].apply(c[0],c[1])===!1&&e.stopOnFalse){n=!1;break}t=!1,u&&(a?a.length&&f(a.shift()):n?u=[]:l.disable())},l={add:function(){if(u){var r=u.length;!function s(t){p.each(t,function(t,n){var r=p.type(n);"function"===r?e.unique&&l.has(n)||u.push(n):n&&n.length&&"string"!==r&&s(n)})}(arguments),t?i=u.length:n&&(o=r,f(n))}return this},remove:function(){return u&&p.each(arguments,function(e,n){var r;while((r=p.inArray(n,u,r))>-1)u.splice(r,1),t&&(i>=r&&i--,s>=r&&s--)}),this},has:function(e){return e?p.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],i=0,this},disable:function(){return u=a=n=void 0,this},disabled:function(){return!u},lock:function(){return a=void 0,n||l.disable(),this},locked:function(){return!a},fireWith:function(e,n){return!u||r&&!a||(n=n||[],n=[e,n.slice?n.slice():n],t?a.push(n):f(n)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},p.extend({Deferred:function(e){var t=[["resolve","done",p.Callbacks("once memory"),"resolved"],["reject","fail",p.Callbacks("once memory"),"rejected"],["notify","progress",p.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return p.Deferred(function(n){p.each(t,function(t,s){var o=p.isFunction(e[t])&&e[t];i[s[1]](function(){var e=o&&o.apply(this,arguments);e&&p.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s[0]+"With"](this===r?n.promise():this,o?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?p.extend(e,r):r}},i={};return r.pipe=r.then,p.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[1^e][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=r.call(arguments),i=n.length,s=1!==i||e&&p.isFunction(e.promise)?i:0,o=1===s?e:p.Deferred(),u=function(e,t,n){return function(i){t[e]=this,n[e]=arguments.length>1?r.call(arguments):i,n===a?o.notifyWith(t,n):--s||o.resolveWith(t,n)}},a,f,l;if(i>1)for(a=new Array(i),f=new Array(i),l=new Array(i);i>t;t++)n[t]&&p.isFunction(n[t].promise)?n[t].promise().done(u(t,l,n)).fail(o.reject).progress(u(t,f,a)):--s;return s||o.resolveWith(l,n),o.promise()}});var P;p.fn.ready=function(e){return p.ready.promise().done(e),this},p.extend({isReady:!1,readyWait:1,holdReady:function(e){e?p.readyWait++:p.ready(!0)},ready:function(e){if(e===!0?!--p.readyWait:!p.isReady){if(!N.body)return setTimeout(p.ready);p.isReady=!0,e!==!0&&--p.readyWait>0||(P.resolveWith(N,[p]),p.fn.trigger&&p(N).trigger("ready").off("ready"))}}}),p.ready.promise=function(t){if(!P)if(P=p.Deferred(),"complete"===N.readyState)setTimeout(p.ready);else if(N.addEventListener)N.addEventListener("DOMContentLoaded",B,!1),e.addEventListener("load",B,!1);else{N.attachEvent("onreadystatechange",B),e.attachEvent("onload",B);var n=!1;try{n=null==e.frameElement&&N.documentElement}catch(r){}n&&n.doScroll&&!function i(){if(!p.isReady){try{n.doScroll("left")}catch(e){return setTimeout(i,50)}H(),p.ready()}}()}return P.promise(t)};var j="undefined",F;for(F in p(c))break;c.ownLast="0"!==F,c.inlineBlockNeedsLayout=!1,p(function(){var e,t,n=N.getElementsByTagName("body")[0];n&&(e=N.createElement("div"),e.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",t=N.createElement("div"),n.appendChild(e).appendChild(t),typeof t.style.zoom!==j&&(t.style.cssText="border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1",(c.inlineBlockNeedsLayout=3===t.offsetWidth)&&(n.style.zoom=1)),n.removeChild(e),e=t=null)}),function(){var e=N.createElement("div");if(null==c.deleteExpando){c.deleteExpando=!0;try{delete e.test}catch(t){c.deleteExpando=!1}}e=null}(),p.acceptData=function(e){var t=p.noData[(e.nodeName+" ").toLowerCase()],n=+e.nodeType||1;return 1!==n&&9!==n?!1:!t||t!==!0&&e.getAttribute("classid")===t};var I=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,q=/([A-Z])/g;p.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?p.cache[e[p.expando]]:e[p.expando],!!e&&!U(e)},data:function(e,t,n){return z(e,t,n)},removeData:function(e,t){return W(e,t)},_data:function(e,t,n){return z(e,t,n,!0)},_removeData:function(e,t){return W(e,t,!0)}}),p.fn.extend({data:function(e,t){var n,r,i,s=this[0],o=s&&s.attributes;if(void 0===e){if(this.length&&(i=p.data(s),1===s.nodeType&&!p._data(s,"parsedAttrs"))){n=o.length;while(n--)r=o[n].name,0===r.indexOf("data-")&&(r=p.camelCase(r.slice(5)),R(s,r,i[r]));p._data(s,"parsedAttrs",!0)}return i}return"object"==typeof e?this.each(function(){p.data(this,e)}):arguments.length>1?this.each(function(){p.data(this,e,t)}):s?R(s,e,p.data(s,e)):void 0},removeData:function(e){return this.each(function(){p.removeData(this,e)})}}),p.extend({queue:function(e,t,n){var r;return e?(t=(t||"fx")+"queue",r=p._data(e,t),n&&(!r||p.isArray(n)?r=p._data(e,t,p.makeArray(n)):r.push(n)),r||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=p.queue(e,t),r=n.length,i=n.shift(),s=p._queueHooks(e,t),o=function(){p.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return p._data(e,n)||p._data(e,n,{empty:p.Callbacks("once memory").add(function(){p._removeData(e,t+"queue"),p._removeData(e,n)})})}}),p.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?p.queue(this[0],e):void 0===t?this:this.each(function(){var n=p.queue(this,e,t);p._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&p.dequeue(this,e)})},dequeue:function(e){return this.each(function(){p.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=p.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(o--)n=p._data(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var X=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,V=["Top","Right","Bottom","Left"],$=function(e,t){return e=t||e,"none"===p.css(e,"display")||!p.contains(e.ownerDocument,e)},J=p.access=function(e,t,n,r,i,s,o){var u=0,a=e.length,f=null==n;if("object"===p.type(n)){i=!0;for(u in n)p.access(e,t,u,n[u],!0,s,o)}else if(void 0!==r&&(i=!0,p.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(p(e),n)})),t))for(;a>u;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)));return i?e:f?t.call(e):a?t(e[0],n):s},K=/^(?:checkbox|radio)$/i;!function(){var e=N.createDocumentFragment(),t=N.createElement("div"),n=N.createElement("input");if(t.setAttribute("className","t"),t.innerHTML="  <link/><table></table><a href='/a'>a</a>",c.leadingWhitespace=3===t.firstChild.nodeType,c.tbody=!t.getElementsByTagName("tbody").length,c.htmlSerialize=!!t.getElementsByTagName("link").length,c.html5Clone="<:nav></:nav>"!==N.createElement("nav").cloneNode(!0).outerHTML,n.type="checkbox",n.checked=!0,e.appendChild(n),c.appendChecked=n.checked,t.innerHTML="<textarea>x</textarea>",c.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue,e.appendChild(t),t.innerHTML="<input type='radio' checked='checked' name='t'/>",c.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,c.noCloneEvent=!0,t.attachEvent&&(t.attachEvent("onclick",function(){c.noCloneEvent=!1}),t.cloneNode(!0).click()),null==c.deleteExpando){c.deleteExpando=!0;try{delete t.test}catch(r){c.deleteExpando=!1}}e=t=n=null}(),function(){var t,n,r=N.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})n="on"+t,(c[t+"Bubbles"]=n in e)||(r.setAttribute(n,"t"),c[t+"Bubbles"]=r.attributes[n].expando===!1);r=null}();var Q=/^(?:input|select|textarea)$/i,G=/^key/,Y=/^(?:mouse|contextmenu)|click/,Z=/^(?:focusinfocus|focusoutblur)$/,et=/^([^.]*)(?:\.(.+)|)$/;p.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,d,v,m,g=p._data(e);if(g){n.handler&&(a=n,n=a.handler,i=a.selector),n.guid||(n.guid=p.guid++),(o=g.events)||(o=g.events={}),(l=g.handle)||(l=g.handle=function(e){return typeof p===j||e&&p.event.triggered===e.type?void 0:p.event.dispatch.apply(l.elem,arguments)},l.elem=e),t=(t||"").match(M)||[""],u=t.length;while(u--)s=et.exec(t[u])||[],d=m=s[1],v=(s[2]||"").split(".").sort(),d&&(f=p.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=p.event.special[d]||{},c=p.extend({type:d,origType:m,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&p.expr.match.needsContext.test(i),namespace:v.join(".")},a),(h=o[d])||(h=o[d]=[],h.delegateCount=0,f.setup&&f.setup.call(e,r,v,l)!==!1||(e.addEventListener?e.addEventListener(d,l,!1):e.attachEvent&&e.attachEvent("on"+d,l))),f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,c):h.push(c),p.event.global[d]=!0);e=null}},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,d,v,m,g=p.hasData(e)&&p._data(e);if(g&&(l=g.events)){t=(t||"").match(M)||[""],f=t.length;while(f--)if(u=et.exec(t[f])||[],d=m=u[1],v=(u[2]||"").split(".").sort(),d){c=p.event.special[d]||{},d=(r?c.delegateType:c.bindType)||d,h=l[d]||[],u=u[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=h.length;while(s--)o=h[s],!i&&m!==o.origType||n&&n.guid!==o.guid||u&&!u.test(o.namespace)||r&&r!==o.selector&&("**"!==r||!o.selector)||(h.splice(s,1),o.selector&&h.delegateCount--,c.remove&&c.remove.call(e,o));a&&!h.length&&(c.teardown&&c.teardown.call(e,v,g.handle)!==!1||p.removeEvent(e,d,g.handle),delete l[d])}else for(d in l)p.event.remove(e,d+t[f],n,r,!0);p.isEmptyObject(l)&&(delete g.handle,p._removeData(e,"events"))}},trigger:function(t,n,r,i){var s,o,u,a,l,c,h,d=[r||N],v=f.call(t,"type")?t.type:t,m=f.call(t,"namespace")?t.namespace.split("."):[];if(u=c=r=r||N,3!==r.nodeType&&8!==r.nodeType&&!Z.test(v+p.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),o=v.indexOf(":")<0&&"on"+v,t=t[p.expando]?t:new p.Event(v,"object"==typeof t&&t),t.isTrigger=i?2:3,t.namespace=m.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:p.makeArray(n,[t]),l=p.event.special[v]||{},i||!l.trigger||l.trigger.apply(r,n)!==!1)){if(!i&&!l.noBubble&&!p.isWindow(r)){for(a=l.delegateType||v,Z.test(a+v)||(u=u.parentNode);u;u=u.parentNode)d.push(u),c=u;c===(r.ownerDocument||N)&&d.push(c.defaultView||c.parentWindow||e)}h=0;while((u=d[h++])&&!t.isPropagationStopped())t.type=h>1?a:l.bindType||v,s=(p._data(u,"events")||{})[t.type]&&p._data(u,"handle"),s&&s.apply(u,n),s=o&&u[o],s&&s.apply&&p.acceptData(u)&&(t.result=s.apply(u,n),t.result===!1&&t.preventDefault());if(t.type=v,!i&&!t.isDefaultPrevented()&&(!l._default||l._default.apply(d.pop(),n)===!1)&&p.acceptData(r)&&o&&r[v]&&!p.isWindow(r)){c=r[o],c&&(r[o]=null),p.event.triggered=v;try{r[v]()}catch(g){}p.event.triggered=void 0,c&&(r[o]=c)}return t.result}},dispatch:function(e){e=p.event.fix(e);var t,n,i,s,o,u=[],a=r.call(arguments),f=(p._data(this,"events")||{})[e.type]||[],l=p.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=p.event.handlers.call(this,e,f),t=0;while((s=u[t++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,n=((p.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),void 0!==n&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||"click"!==e.type))for(;a!=this;a=a.parentNode||this)if(1===a.nodeType&&(a.disabled!==!0||"click"!==e.type)){for(i=[],s=0;u>s;s++)r=t[s],n=r.selector+" ",void 0===i[n]&&(i[n]=r.needsContext?p(n,this).index(a)>=0:p.find(n,this,null,[a]).length),i[n]&&i.push(r);i.length&&o.push({elem:a,handlers:i})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},fix:function(e){if(e[p.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=Y.test(i)?this.mouseHooks:G.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new p.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=s.srcElement||N),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,o.filter?o.filter(e,s):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button,o=t.fromElement;return null==e.pageX&&null!=t.clientX&&(r=e.target.ownerDocument||N,i=r.documentElement,n=r.body,e.pageX=t.clientX+(i&&i.scrollLeft||n&&n.scrollLeft||0)-(i&&i.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||n&&n.scrollTop||0)-(i&&i.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&o&&(e.relatedTarget=o===e.target?t.toElement:o),e.which||void 0===s||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==rt()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===rt()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return p.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(e){return p.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=p.extend(new p.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?p.event.trigger(i,null,t):p.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},p.removeEvent=N.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===j&&(e[r]=null),e.detachEvent(r,n))},p.Event=function(e,t){return this instanceof p.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&(e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault())?tt:nt):this.type=e,t&&p.extend(this,t),this.timeStamp=e&&e.timeStamp||p.now(),void (this[p.expando]=!0)):new p.Event(e,t)},p.Event.prototype={isDefaultPrevented:nt,isPropagationStopped:nt,isImmediatePropagationStopped:nt,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=tt,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=tt,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=tt,this.stopPropagation()}},p.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){p.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;return(!i||i!==r&&!p.contains(r,i))&&(e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t),n}}}),c.submitBubbles||(p.event.special.submit={setup:function(){return p.nodeName(this,"form")?!1:void p.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,n=p.nodeName(t,"input")||p.nodeName(t,"button")?t.form:void 0;n&&!p._data(n,"submitBubbles")&&(p.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),p._data(n,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&p.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return p.nodeName(this,"form")?!1:void p.event.remove(this,"._submit")}}),c.changeBubbles||(p.event.special.change={setup:function(){return Q.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(p.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),p.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),p.event.simulate("change",this,e,!0)})),!1):void p.event.add(this,"beforeactivate._change",function(e){var t=e.target;Q.test(t.nodeName)&&!p._data(t,"changeBubbles")&&(p.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||p.event.simulate("change",this.parentNode,e,!0)}),p._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return p.event.remove(this,"._change"),!Q.test(this.nodeName)}}),c.focusinBubbles||p.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){p.event.simulate(t,e.target,p.event.fix(e),!0)};p.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=p._data(r,t);i||r.addEventListener(e,n,!0),p._data(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=p._data(r,t)-1;i?p._data(r,t,i):(r.removeEventListener(e,n,!0),p._removeData(r,t))}}}),p.fn.extend({on:function(e,t,n,r,i){var s,o;if("object"==typeof e){"string"!=typeof t&&(n=n||t,t=void 0);for(s in e)this.on(s,t,n,e[s],i);return this}if(null==n&&null==r?(r=t,n=t=void 0):null==r&&("string"==typeof t?(r=n,n=void 0):(r=n,n=t,t=void 0)),r===!1)r=nt;else if(!r)return this;return 1===i&&(o=r,r=function(e){return p().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=p.guid++)),this.each(function(){p.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,p(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=void 0),n===!1&&(n=nt),this.each(function(){p.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){p.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?p.event.trigger(e,t,n,!0):void 0}});var st="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ot=/ jQuery\d+="(?:null|\d+)"/g,ut=new RegExp("<(?:"+st+")[\\s/>]","i"),at=/^\s+/,ft=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,lt=/<([\w:]+)/,ct=/<tbody/i,ht=/<|&#?\w+;/,pt=/<(?:script|style|link)/i,dt=/checked\s*(?:[^=]|=\s*.checked.)/i,vt=/^$|\/(?:java|ecma)script/i,mt=/^true\/(.*)/,gt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,yt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:c.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},bt=it(N),wt=bt.appendChild(N.createElement("div"));yt.optgroup=yt.option,yt.tbody=yt.tfoot=yt.colgroup=yt.caption=yt.thead,yt.th=yt.td,p.extend({clone:function(e,t,n){var r,i,s,o,u,a=p.contains(e.ownerDocument,e);if(c.html5Clone||p.isXMLDoc(e)||!ut.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(wt.innerHTML=e.outerHTML,wt.removeChild(s=wt.firstChild)),!(c.noCloneEvent&&c.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||p.isXMLDoc(e)))for(r=Et(s),u=Et(e),o=0;null!=(i=u[o]);++o)r[o]&&Lt(i,r[o]);if(t)if(n)for(u=u||Et(e),r=r||Et(s),o=0;null!=(i=u[o]);o++)kt(i,r[o]);else kt(e,s);return r=Et(s,"script"),r.length>0&&Ct(r,!a&&Et(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){for(var i,s,o,u,a,f,l,h=e.length,d=it(t),v=[],m=0;h>m;m++)if(s=e[m],s||0===s)if("object"===p.type(s))p.merge(v,s.nodeType?[s]:s);else if(ht.test(s)){u=u||d.appendChild(t.createElement("div")),a=(lt.exec(s)||["",""])[1].toLowerCase(),l=yt[a]||yt._default,u.innerHTML=l[1]+s.replace(ft,"<$1></$2>")+l[2],i=l[0];while(i--)u=u.lastChild;if(!c.leadingWhitespace&&at.test(s)&&v.push(t.createTextNode(at.exec(s)[0])),!c.tbody){s="table"!==a||ct.test(s)?"<table>"!==l[1]||ct.test(s)?0:u:u.firstChild,i=s&&s.childNodes.length;while(i--)p.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}p.merge(v,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=d.lastChild}else v.push(t.createTextNode(s));u&&d.removeChild(u),c.appendChecked||p.grep(Et(v,"input"),St),m=0;while(s=v[m++])if((!r||-1===p.inArray(s,r))&&(o=p.contains(s.ownerDocument,s),u=Et(d.appendChild(s),"script"),o&&Ct(u),n)){i=0;while(s=u[i++])vt.test(s.type||"")&&n.push(s)}return u=null,d},cleanData:function(e,t){for(var r,i,s,o,u=0,a=p.expando,f=p.cache,l=c.deleteExpando,h=p.event.special;null!=(r=e[u]);u++)if((t||p.acceptData(r))&&(s=r[a],o=s&&f[s])){if(o.events)for(i in o.events)h[i]?p.event.remove(r,i):p.removeEvent(r,i,o.handle);f[s]&&(delete f[s],l?delete r[a]:typeof r.removeAttribute!==j?r.removeAttribute(a):r[a]=null,n.push(s))}}}),p.fn.extend({text:function(e){return J(this,function(e){return void 0===e?p.text(this):this.empty().append((this[0]&&this[0].ownerDocument||N).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=xt(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=xt(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,r=e?p.filter(e,this):this,i=0;null!=(n=r[i]);i++)t||1!==n.nodeType||p.cleanData(Et(n)),n.parentNode&&(t&&p.contains(n.ownerDocument,n)&&Ct(Et(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){1===e.nodeType&&p.cleanData(Et(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&p.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return p.clone(this,e,t)})},html:function(e){return J(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e)return 1===t.nodeType?t.innerHTML.replace(ot,""):void 0;if(!("string"!=typeof e||pt.test(e)||!c.htmlSerialize&&ut.test(e)||!c.leadingWhitespace&&at.test(e)||yt[(lt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(ft,"<$1></$2>");try{for(;r>n;n++)t=this[n]||{},1===t.nodeType&&(p.cleanData(Et(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,p.cleanData(Et(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=i.apply([],e);var n,r,s,o,u,a,f=0,l=this.length,h=this,d=l-1,v=e[0],m=p.isFunction(v);if(m||l>1&&"string"==typeof v&&!c.checkClone&&dt.test(v))return this.each(function(n){var r=h.eq(n);m&&(e[0]=v.call(this,n,r.html())),r.domManip(e,t)});if(l&&(a=p.buildFragment(e,this[0].ownerDocument,!1,this),n=a.firstChild,1===a.childNodes.length&&(a=n),n)){for(o=p.map(Et(a,"script"),Tt),s=o.length;l>f;f++)r=a,f!==d&&(r=p.clone(r,!0,!0),s&&p.merge(o,Et(r,"script"))),t.call(this[f],r,f);if(s)for(u=o[o.length-1].ownerDocument,p.map(o,Nt),f=0;s>f;f++)r=o[f],vt.test(r.type||"")&&!p._data(r,"globalEval")&&p.contains(u,r)&&(r.src?p._evalUrl&&p._evalUrl(r.src):p.globalEval((r.text||r.textContent||r.innerHTML||"").replace(gt,"")));a=n=null}return this}}),p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){p.fn[e]=function(e){for(var n,r=0,i=[],o=p(e),u=o.length-1;u>=r;r++)n=r===u?this:this.clone(!0),p(o[r])[t](n),s.apply(i,n.get());return this.pushStack(i)}});var At,Ot={};!function(){var e,t,n=N.createElement("div"),r="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=n.getElementsByTagName("a")[0],e.style.cssText="float:left;opacity:.5",c.opacity=/^0.5/.test(e.style.opacity),c.cssFloat=!!e.style.cssFloat,n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",c.clearCloneStyle="content-box"===n.style.backgroundClip,e=n=null,c.shrinkWrapBlocks=function(){var e,n,i,s;if(null==t){if(e=N.getElementsByTagName("body")[0],!e)return;s="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",n=N.createElement("div"),i=N.createElement("div"),e.appendChild(n).appendChild(i),t=!1,typeof i.style.zoom!==j&&(i.style.cssText=r+";width:1px;padding:1px;zoom:1",i.innerHTML="<div></div>",i.firstChild.style.width="5px",t=3!==i.offsetWidth),e.removeChild(n),e=n=i=null}return t}}();var Dt=/^margin/,Pt=new RegExp("^("+X+")(?!px)[a-z%]+$","i"),Ht,Bt,jt=/^(top|right|bottom|left)$/;e.getComputedStyle?(Ht=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)},Bt=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Ht(e),o=n?n.getPropertyValue(t)||n[t]:void 0,n&&(""!==o||p.contains(e.ownerDocument,e)||(o=p.style(e,t)),Pt.test(o)&&Dt.test(t)&&(r=u.width,i=u.minWidth,s=u.maxWidth,u.minWidth=u.maxWidth=u.width=o,o=n.width,u.width=r,u.minWidth=i,u.maxWidth=s)),void 0===o?o:o+""}):N.documentElement.currentStyle&&(Ht=function(e){return e.currentStyle},Bt=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Ht(e),o=n?n[t]:void 0,null==o&&u&&u[t]&&(o=u[t]),Pt.test(o)&&!jt.test(t)&&(r=u.left,i=e.runtimeStyle,s=i&&i.left,s&&(i.left=e.currentStyle.left),u.left="fontSize"===t?"1em":o,o=u.pixelLeft+"px",u.left=r,s&&(i.left=s)),void 0===o?o:o+""||"auto"}),!function(){function l(){var t,n,u=N.getElementsByTagName("body")[0];u&&(t=N.createElement("div"),n=N.createElement("div"),t.style.cssText=a,u.appendChild(t).appendChild(n),n.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%",p.swap(u,null!=u.style.zoom?{zoom:1}:{},function(){r=4===n.offsetWidth}),i=!0,s=!1,o=!0,e.getComputedStyle&&(s="1%"!==(e.getComputedStyle(n,null)||{}).top,i="4px"===(e.getComputedStyle(n,null)||{width:"4px"}).width),u.removeChild(t),n=u=null)}var t,n,r,i,s,o,u=N.createElement("div"),a="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",f="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";u.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=u.getElementsByTagName("a")[0],t.style.cssText="float:left;opacity:.5",c.opacity=/^0.5/.test(t.style.opacity),c.cssFloat=!!t.style.cssFloat,u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",c.clearCloneStyle="content-box"===u.style.backgroundClip,t=u=null,p.extend(c,{reliableHiddenOffsets:function(){if(null!=n)return n;var e,t,r,i=N.createElement("div"),s=N.getElementsByTagName("body")[0];if(s)return i.setAttribute("className","t"),i.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=N.createElement("div"),e.style.cssText=a,s.appendChild(e).appendChild(i),i.innerHTML="<table><tr><td></td><td>t</td></tr></table>",t=i.getElementsByTagName("td"),t[0].style.cssText="padding:0;margin:0;border:0;display:none",r=0===t[0].offsetHeight,t[0].style.display="",t[1].style.display="none",n=r&&0===t[0].offsetHeight,s.removeChild(e),i=s=null,n},boxSizing:function(){return null==r&&l(),r},boxSizingReliable:function(){return null==i&&l(),i},pixelPosition:function(){return null==s&&l(),s},reliableMarginRight:function(){var t,n,r,i;if(null==o&&e.getComputedStyle){if(t=N.getElementsByTagName("body")[0],!t)return;n=N.createElement("div"),r=N.createElement("div"),n.style.cssText=a,t.appendChild(n).appendChild(r),i=r.appendChild(N.createElement("div")),i.style.cssText=r.style.cssText=f,i.style.marginRight=i.style.width="0",r.style.width="1px",o=!parseFloat((e.getComputedStyle(i,null)||{}).marginRight),t.removeChild(n)}return o}})}(),p.swap=function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i};var It=/alpha\([^)]*\)/i,qt=/opacity\s*=\s*([^)]*)/,Rt=/^(none|table(?!-c[ea]).+)/,Ut=new RegExp("^("+X+")(.*)$","i"),zt=new RegExp("^([+-])=("+X+")","i"),Wt={position:"absolute",visibility:"hidden",display:"block"},Xt={letterSpacing:0,fontWeight:400},Vt=["Webkit","O","Moz","ms"];p.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Bt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":c.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,s,o,u=p.camelCase(t),a=e.style;if(t=p.cssProps[u]||(p.cssProps[u]=$t(a,u)),o=p.cssHooks[t]||p.cssHooks[u],void 0===n)return o&&"get"in o&&void 0!==(i=o.get(e,!1,r))?i:a[t];if(s=typeof n,"string"===s&&(i=zt.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(p.css(e,t)),s="number"),null!=n&&n===n&&("number"!==s||p.cssNumber[u]||(n+="px"),c.clearCloneStyle||""!==n||0!==t.indexOf("background")||(a[t]="inherit"),!(o&&"set"in o&&void 0===(n=o.set(e,n,r)))))try{a[t]="",a[t]=n}catch(f){}}},css:function(e,t,n,r){var i,s,o,u=p.camelCase(t);return t=p.cssProps[u]||(p.cssProps[u]=$t(e.style,u)),o=p.cssHooks[t]||p.cssHooks[u],o&&"get"in o&&(s=o.get(e,!0,n)),void 0===s&&(s=Bt(e,t,r)),"normal"===s&&t in Xt&&(s=Xt[t]),""===n||n?(i=parseFloat(s),n===!0||p.isNumeric(i)?i||0:s):s}}),p.each(["height","width"],function(e,t){p.cssHooks[t]={get:function(e,n,r){return n?0===e.offsetWidth&&Rt.test(p.css(e,"display"))?p.swap(e,Wt,function(){return Gt(e,t,r)}):Gt(e,t,r):void 0},set:function(e,n,r){var i=r&&Ht(e);return Kt(e,n,r?Qt(e,t,r,c.boxSizing()&&"border-box"===p.css(e,"boxSizing",!1,i),i):0)}}}),c.opacity||(p.cssHooks.opacity={get:function(e,t){return qt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=p.isNumeric(t)?"alpha(opacity="+100*t+")":"",s=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===p.trim(s.replace(It,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=It.test(s)?s.replace(It,i):s+" "+i)}}),p.cssHooks.marginRight=Ft(c.reliableMarginRight,function(e,t){return t?p.swap(e,{display:"inline-block"},Bt,[e,"marginRight"]):void 0}),p.each({margin:"",padding:"",border:"Width"},function(e,t){p.cssHooks[e+t]={expand:function(n){for(var r=0,i={},s="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+V[r]+t]=s[r]||s[r-2]||s[0];return i}},Dt.test(e)||(p.cssHooks[e+t].set=Kt)}),p.fn.extend({css:function(e,t){return J(this,function(e,t,n){var r,i,s={},o=0;if(p.isArray(t)){for(r=Ht(e),i=t.length;i>o;o++)s[t[o]]=p.css(e,t[o],!1,r);return s}return void 0!==n?p.style(e,t,n):p.css(e,t)},e,t,arguments.length>1)},show:function(){return Jt(this,!0)},hide:function(){return Jt(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){$(this)?p(this).show():p(this).hide()})}}),p.Tween=Yt,Yt.prototype={constructor:Yt,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(p.cssNumber[n]?"":"px")},cur:function(){var e=Yt.propHooks[this.prop];return e&&e.get?e.get(this):Yt.propHooks._default.get(this)},run:function(e){var t,n=Yt.propHooks[this.prop];return this.pos=t=this.options.duration?p.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Yt.propHooks._default.set(this),this}},Yt.prototype.init.prototype=Yt.prototype,Yt.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=p.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){p.fx.step[e.prop]?p.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[p.cssProps[e.prop]]||p.cssHooks[e.prop])?p.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Yt.propHooks.scrollTop=Yt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},p.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},p.fx=Yt.prototype.init,p.fx.step={};var Zt,en,tn=/^(?:toggle|show|hide)$/,nn=new RegExp("^(?:([+-])=|)("+X+")([a-z%]*)$","i"),rn=/queueHooks$/,sn=[ln],on={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=nn.exec(t),s=i&&i[3]||(p.cssNumber[e]?"":"px"),o=(p.cssNumber[e]||"px"!==s&&+r)&&nn.exec(p.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,p.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&1!==u&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};p.Animation=p.extend(hn,{tweener:function(e,t){p.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,r=0,i=e.length;i>r;r++)n=e[r],on[n]=on[n]||[],on[n].unshift(t)},prefilter:function(e,t){t?sn.unshift(e):sn.push(e)}}),p.speed=function(e,t,n){var r=e&&"object"==typeof e?p.extend({},e):{complete:n||!n&&t||p.isFunction(e)&&e,duration:e,easing:n&&t||t&&!p.isFunction(t)&&t};return r.duration=p.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in p.fx.speeds?p.fx.speeds[r.duration]:p.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){p.isFunction(r.old)&&r.old.call(this),r.queue&&p.dequeue(this,r.queue)},r},p.fn.extend({fadeTo:function(e,t,n,r){return this.filter($).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=p.isEmptyObject(e),s=p.speed(t,n,r),o=function(){var t=hn(this,p.extend({},e),s);(i||p._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",s=p.timers,o=p._data(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&rn.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem!==this||null!=e&&s[i].queue!==e||(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&p.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=p._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=p.timers,o=r?r.length:0;for(n.finish=!0,p.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;o>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),p.each(["toggle","show","hide"],function(e,t){var n=p.fn[t];p.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(an(t,!0),e,r,i)}}),p.each({slideDown:an("show"),slideUp:an("hide"),slideToggle:an("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){p.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),p.timers=[],p.fx.tick=function(){var e,t=p.timers,n=0;for(Zt=p.now();n<t.length;n++)e=t[n],e()||t[n]!==e||t.splice(n--,1);t.length||p.fx.stop(),Zt=void 0},p.fx.timer=function(e){p.timers.push(e),e()?p.fx.start():p.timers.pop()},p.fx.interval=13,p.fx.start=function(){en||(en=setInterval(p.fx.tick,p.fx.interval))},p.fx.stop=function(){clearInterval(en),en=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fn.delay=function(e,t){return e=p.fx?p.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},function(){var e,t,n,r,i=N.createElement("div");i.setAttribute("className","t"),i.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=i.getElementsByTagName("a")[0],n=N.createElement("select"),r=n.appendChild(N.createElement("option")),t=i.getElementsByTagName("input")[0],e.style.cssText="top:1px",c.getSetAttribute="t"!==i.className,c.style=/top/.test(e.getAttribute("style")),c.hrefNormalized="/a"===e.getAttribute("href"),c.checkOn=!!t.value,c.optSelected=r.selected,c.enctype=!!N.createElement("form").enctype,n.disabled=!0,c.optDisabled=!r.disabled,t=N.createElement("input"),t.setAttribute("value",""),c.input=""===t.getAttribute("value"),t.value="t",t.setAttribute("type","radio"),c.radioValue="t"===t.value,e=t=n=r=i=null}();var pn=/\r/g;p.fn.extend({val:function(e){var t,n,r,i=this[0];if(arguments.length)return r=p.isFunction(e),this.each(function(n){var i;1===this.nodeType&&(i=r?e.call(this,n,p(this).val()):e,null==i?i="":"number"==typeof i?i+="":p.isArray(i)&&(i=p.map(i,function(e){return null==e?"":e+""})),t=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))});if(i)return t=p.valHooks[i.type]||p.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:(n=i.value,"string"==typeof n?n.replace(pn,""):null==n?"":n)}}),p.extend({valHooks:{option:{get:function(e){var t=p.find.attr(e,"value");return null!=t?t:p.text(e)}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,s="select-one"===e.type||0>i,o=s?null:[],u=s?i+1:r.length,a=0>i?u:s?i:0;u>a;a++)if(n=r[a],!(!n.selected&&a!==i||(c.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&p.nodeName(n.parentNode,"optgroup"))){if(t=p(n).val(),s)return t;o.push(t)}return o},set:function(e,t){var n,r,i=e.options,s=p.makeArray(t),o=i.length;while(o--)if(r=i[o],p.inArray(p.valHooks.option.get(r),s)>=0)try{r.selected=n=!0}catch(u){r.scrollHeight}else r.selected=!1;return n||(e.selectedIndex=-1),i}}}}),p.each(["radio","checkbox"],function(){p.valHooks[this]={set:function(e,t){return p.isArray(t)?e.checked=p.inArray(p(e).val(),t)>=0:void 0}},c.checkOn||(p.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var dn,vn,mn=p.expr.attrHandle,gn=/^(?:checked|selected)$/i,yn=c.getSetAttribute,bn=c.input;p.fn.extend({attr:function(e,t){return J(this,p.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){p.removeAttr(this,e)})}}),p.extend({attr:function(e,t,n){var r,i,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===j?p.prop(e,t,n):(1===s&&p.isXMLDoc(e)||(t=t.toLowerCase(),r=p.attrHooks[t]||(p.expr.match.bool.test(t)?vn:dn)),void 0===n?r&&"get"in r&&null!==(i=r.get(e,t))?i:(i=p.find.attr(e,t),null==i?void 0:i):null!==n?r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:(e.setAttribute(t,n+""),n):void p.removeAttr(e,t))},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(M);if(s&&1===e.nodeType)while(n=s[i++])r=p.propFix[n]||n,p.expr.match.bool.test(n)?bn&&yn||!gn.test(n)?e[r]=!1:e[p.camelCase("default-"+n)]=e[r]=!1:p.attr(e,n,""),e.removeAttribute(yn?n:r)},attrHooks:{type:{set:function(e,t){if(!c.radioValue&&"radio"===t&&p.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),vn={set:function(e,t,n){return t===!1?p.removeAttr(e,n):bn&&yn||!gn.test(n)?e.setAttribute(!yn&&p.propFix[n]||n,n):e[p.camelCase("default-"+n)]=e[n]=!0,n}},p.each(p.expr.match.bool.source.match(/\w+/g),function(e,t){var n=mn[t]||p.find.attr;mn[t]=bn&&yn||!gn.test(t)?function(e,t,r){var i,s;return r||(s=mn[t],mn[t]=i,i=null!=n(e,t,r)?t.toLowerCase():null,mn[t]=s),i}:function(e,t,n){return n?void 0:e[p.camelCase("default-"+t)]?t.toLowerCase():null}}),bn&&yn||(p.attrHooks.value={set:function(e,t,n){return p.nodeName(e,"input")?void (e.defaultValue=t):dn&&dn.set(e,t,n)}}),yn||(dn={set:function(e,t,n){var r=e.getAttributeNode(n);return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(n)),r.value=t+="","value"===n||t===e.getAttribute(n)?t:void 0}},mn.id=mn.name=mn.coords=function(e,t,n){var r;return n?void 0:(r=e.getAttributeNode(t))&&""!==r.value?r.value:null},p.valHooks.button={get:function(e,t){var n=e.getAttributeNode(t);return n&&n.specified?n.value:void 0},set:dn.set},p.attrHooks.contenteditable={set:function(e,t,n){dn.set(e,""===t?!1:t,n)}},p.each(["width","height"],function(e,t){p.attrHooks[t]={set:function(e,n){return""===n?(e.setAttribute(t,"auto"),n):void 0}}})),c.style||(p.attrHooks.style={get:function(e){return e.style.cssText||void 0},set:function(e,t){return e.style.cssText=t+""}});var wn=/^(?:input|select|textarea|button|object)$/i,En=/^(?:a|area)$/i;p.fn.extend({prop:function(e,t){return J(this,p.prop,e,t,arguments.length>1)},removeProp:function(e){return e=p.propFix[e]||e,this.each(function(){try{this[e]=void 0,delete this[e]}catch(t){}})}}),p.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return s=1!==o||!p.isXMLDoc(e),s&&(t=p.propFix[t]||t,i=p.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=p.find.attr(e,"tabindex");return t?parseInt(t,10):wn.test(e.nodeName)||En.test(e.nodeName)&&e.href?0:-1}}}}),c.hrefNormalized||p.each(["href","src"],function(e,t){p.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),c.optSelected||(p.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),p.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){p.propFix[this.toLowerCase()]=this}),c.enctype||(p.propFix.enctype="encoding");var Sn=/[\t\r\n\f]/g;p.fn.extend({addClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f="string"==typeof e&&e;if(p.isFunction(e))return this.each(function(t){p(this).addClass(e.call(this,t,this.className))});if(f)for(t=(e||"").match(M)||[];a>u;u++)if(n=this[u],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Sn," "):" ")){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");o=p.trim(r),n.className!==o&&(n.className=o)}return this},removeClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f=0===arguments.length||"string"==typeof e&&e;if(p.isFunction(e))return this.each(function(t){p(this).removeClass(e.call(this,t,this.className))});if(f)for(t=(e||"").match(M)||[];a>u;u++)if(n=this[u],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Sn," "):"")){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");o=e?p.trim(r):"",n.className!==o&&(n.className=o)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):this.each(p.isFunction(e)?function(n){p(this).toggleClass(e.call(this,n,this.className,t),t)}:function(){if("string"===n){var t,r=0,i=p(this),s=e.match(M)||[];while(t=s[r++])i.hasClass(t)?i.removeClass(t):i.addClass(t)}else(n===j||"boolean"===n)&&(this.className&&p._data(this,"__className__",this.className),this.className=this.className||e===!1?"":p._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(Sn," ").indexOf(t)>=0)return!0;return!1}}),p.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){p.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),p.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var xn=p.now(),Tn=/\?/,Nn=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;p.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"");var n,r=null,i=p.trim(t+"");return i&&!p.trim(i.replace(Nn,function(e,t,i,s){return n&&t&&(r=0),0===r?e:(n=i||t,r+=!s-!i,"")}))?Function("return "+i)():p.error("Invalid JSON: "+t)},p.parseXML=function(t){var n,r;if(!t||"string"!=typeof t)return null;try{e.DOMParser?(r=new DOMParser,n=r.parseFromString(t,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t))}catch(i){n=void 0}return n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||p.error("Invalid XML: "+t),n};var Cn,kn,Ln=/#.*$/,An=/([?&])_=[^&]*/,On=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Mn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,_n=/^(?:GET|HEAD)$/,Dn=/^\/\//,Pn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Hn={},Bn={},jn="*/".concat("*");try{kn=location.href}catch(Fn){kn=N.createElement("a"),kn.href="",kn=kn.href}Cn=Pn.exec(kn.toLowerCase())||[],p.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:kn,type:"GET",isLocal:Mn.test(Cn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":jn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":p.parseJSON,"text xml":p.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Rn(Rn(e,p.ajaxSettings),t):Rn(p.ajaxSettings,e)},ajaxPrefilter:In(Hn),ajaxTransport:In(Bn),ajax:function(e,t){function x(e,t,n,r){var f,g,y,w,S,x=t;2!==b&&(b=2,o&&clearTimeout(o),a=void 0,s=r||"",E.readyState=e>0?4:0,f=e>=200&&300>e||304===e,n&&(w=Un(l,E,n)),w=zn(l,w,E,f),f?(l.ifModified&&(S=E.getResponseHeader("Last-Modified"),S&&(p.lastModified[i]=S),S=E.getResponseHeader("etag"),S&&(p.etag[i]=S)),204===e||"HEAD"===l.type?x="nocontent":304===e?x="notmodified":(x=w.state,g=w.data,y=w.error,f=!y)):(y=x,(e||!x)&&(x="error",0>e&&(e=0))),E.status=e,E.statusText=(t||x)+"",f?d.resolveWith(c,[g,x,E]):d.rejectWith(c,[E,x,y]),E.statusCode(m),m=void 0,u&&h.trigger(f?"ajaxSuccess":"ajaxError",[E,l,f?g:y]),v.fireWith(c,[E,x]),u&&(h.trigger("ajaxComplete",[E,l]),--p.active||p.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r,i,s,o,u,a,f,l=p.ajaxSetup({},t),c=l.context||l,h=l.context&&(c.nodeType||c.jquery)?p(c):p.event,d=p.Deferred(),v=p.Callbacks("once memory"),m=l.statusCode||{},g={},y={},b=0,w="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!f){f={};while(t=On.exec(s))f[t[1].toLowerCase()]=t[2]}t=f[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return b||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)m[t]=[m[t],e[t]];else E.always(e[E.status]);return this},abort:function(e){var t=e||w;return a&&a.abort(t),x(0,t),this}};if(d.promise(E).complete=v.add,E.success=E.done,E.error=E.fail,l.url=((e||l.url||kn)+"").replace(Ln,"").replace(Dn,Cn[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=p.trim(l.dataType||"*").toLowerCase().match(M)||[""],null==l.crossDomain&&(n=Pn.exec(l.url.toLowerCase()),l.crossDomain=!(!n||n[1]===Cn[1]&&n[2]===Cn[2]&&(n[3]||("http:"===n[1]?"80":"443"))===(Cn[3]||("http:"===Cn[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=p.param(l.data,l.traditional)),qn(Hn,l,t,E),2===b)return E;u=l.global,u&&0===p.active++&&p.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!_n.test(l.type),i=l.url,l.hasContent||(l.data&&(i=l.url+=(Tn.test(i)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=An.test(i)?i.replace(An,"$1_="+xn++):i+(Tn.test(i)?"&":"?")+"_="+xn++)),l.ifModified&&(p.lastModified[i]&&E.setRequestHeader("If-Modified-Since",p.lastModified[i]),p.etag[i]&&E.setRequestHeader("If-None-Match",p.etag[i])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&E.setRequestHeader("Content-Type",l.contentType),E.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+jn+"; q=0.01":""):l.accepts["*"]);for(r in l.headers)E.setRequestHeader(r,l.headers[r]);if(!l.beforeSend||l.beforeSend.call(c,E,l)!==!1&&2!==b){w="abort";for(r in{success:1,error:1,complete:1})E[r](l[r]);if(a=qn(Bn,l,t,E)){E.readyState=1,u&&h.trigger("ajaxSend",[E,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){E.abort("timeout")},l.timeout));try{b=1,a.send(g,x)}catch(S){if(!(2>b))throw S;x(-1,S)}}else x(-1,"No Transport");return E}return E.abort()},getJSON:function(e,t,n){return p.get(e,t,n,"json")},getScript:function(e,t){return p.get(e,void 0,t,"script")}}),p.each(["get","post"],function(e,t){p[t]=function(e,n,r,i){return p.isFunction(n)&&(i=i||r,r=n,n=void 0),p.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),p.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){p.fn[t]=function(e){return this.on(t,e)}}),p._evalUrl=function(e){return p.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},p.fn.extend({wrapAll:function(e){if(p.isFunction(e))return this.each(function(t){p(this).wrapAll(e.call(this,t))});if(this[0]){var t=p(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return this.each(p.isFunction(e)?function(t){p(this).wrapInner(e.call(this,t))}:function(){var t=p(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=p.isFunction(e);return this.each(function(n){p(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){p.nodeName(this,"body")||p(this).replaceWith(this.childNodes)}).end()}}),p.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!c.reliableHiddenOffsets()&&"none"===(e.style&&e.style.display||p.css(e,"display"))},p.expr.filters.visible=function(e){return!p.expr.filters.hidden(e)};var Wn=/%20/g,Xn=/\[\]$/,Vn=/\r?\n/g,$n=/^(?:submit|button|image|reset|file)$/i,Jn=/^(?:input|select|textarea|keygen)/i;p.param=function(e,t){var n,r=[],i=function(e,t){t=p.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=p.ajaxSettings&&p.ajaxSettings.traditional),p.isArray(e)||e.jquery&&!p.isPlainObject(e))p.each(e,function(){i(this.name,this.value)});else for(n in e)Kn(n,e[n],t,i);return r.join("&").replace(Wn,"+")},p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=p.prop(this,"elements");return e?p.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!p(this).is(":disabled")&&Jn.test(this.nodeName)&&!$n.test(e)&&(this.checked||!K.test(e))}).map(function(e,t){var n=p(this).val();return null==n?null:p.isArray(n)?p.map(n,function(e){return{name:t.name,value:e.replace(Vn,"\r\n")}}):{name:t.name,value:n.replace(Vn,"\r\n")}}).get()}}),p.ajaxSettings.xhr=void 0!==e.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Zn()||er()}:Zn;var Qn=0,Gn={},Yn=p.ajaxSettings.xhr();e.ActiveXObject&&p(e).on("unload",function(){for(var e in Gn)Gn[e](void 0,!0)}),c.cors=!!Yn&&"withCredentials"in Yn,Yn=c.ajax=!!Yn,Yn&&p.ajaxTransport(function(e){if(!e.crossDomain||c.cors){var t;return{send:function(n,r){var i,s=e.xhr(),o=++Qn;if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(i in n)void 0!==n[i]&&s.setRequestHeader(i,n[i]+"");s.send(e.hasContent&&e.data||null),t=function(n,i){var u,a,f;if(t&&(i||4===s.readyState))if(delete Gn[o],t=void 0,s.onreadystatechange=p.noop,i)4!==s.readyState&&s.abort();else{f={},u=s.status,"string"==typeof s.responseText&&(f.text=s.responseText);try{a=s.statusText}catch(l){a=""}u||!e.isLocal||e.crossDomain?1223===u&&(u=204):u=f.text?200:404}f&&r(u,a,f,s.getAllResponseHeaders())},e.async?4===s.readyState?setTimeout(t):s.onreadystatechange=Gn[o]=t:t()},abort:function(){t&&t(void 0,!0)}}}}),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return p.globalEval(e),e}}}),p.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),p.ajaxTransport("script",function(e){if(e.crossDomain){var t,n=N.head||p("head")[0]||N.documentElement;return{send:function(r,i){t=N.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,n){(n||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,n||i(200,"success"))},n.insertBefore(t,n.firstChild)},abort:function(){t&&t.onload(void 0,!0)}}}});var tr=[],nr=/(=)\?(?=&|$)|\?\?/;p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=tr.pop()||p.expando+"_"+xn++;return this[e]=!0,e}}),p.ajaxPrefilter("json jsonp",function(t,n,r){var i,s,o,u=t.jsonp!==!1&&(nr.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&nr.test(t.data)&&"data");return u||"jsonp"===t.dataTypes[0]?(i=t.jsonpCallback=p.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,u?t[u]=t[u].replace(nr,"$1"+i):t.jsonp!==!1&&(t.url+=(Tn.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return o||p.error(i+" was not called"),o[0]},t.dataTypes[0]="json",s=e[i],e[i]=function(){o=arguments},r.always(function(){e[i]=s,t[i]&&(t.jsonpCallback=n.jsonpCallback,tr.push(i)),o&&p.isFunction(s)&&s(o[0]),o=s=void 0}),"script"):void 0}),p.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||N;var r=E.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=p.buildFragment([e],t,i),i&&i.length&&p(i).remove(),p.merge([],r.childNodes))};var rr=p.fn.load;p.fn.load=function(e,t,n){if("string"!=typeof e&&rr)return rr.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=e.slice(u,e.length),e=e.slice(0,u)),p.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(s="POST"),o.length>0&&p.ajax({url:e,type:s,dataType:"html",data:t}).done(function(e){i=arguments,o.html(r?p("<div>").append(p.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,i||[e.responseText,t,e])}),this},p.expr.filters.animated=function(e){return p.grep(p.timers,function(t){return e===t.elem}).length};var ir=e.document.documentElement;p.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=p.css(e,"position"),c=p(e),h={};"static"===l&&(e.style.position="relative"),u=c.offset(),s=p.css(e,"top"),a=p.css(e,"left"),f=("absolute"===l||"fixed"===l)&&p.inArray("auto",[s,a])>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),p.isFunction(t)&&(t=t.call(e,n,u)),null!=t.top&&(h.top=t.top-u.top+o),null!=t.left&&(h.left=t.left-u.left+i),"using"in t?t.using.call(e,h):c.css(h)}},p.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){p.offset.setOffset(this,e,t)});var t,n,r={top:0,left:0},i=this[0],s=i&&i.ownerDocument;if(s)return t=s.documentElement,p.contains(t,i)?(typeof i.getBoundingClientRect!==j&&(r=i.getBoundingClientRect()),n=sr(s),{top:r.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:r.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):r},position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===p.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),p.nodeName(e[0],"html")||(n=e.offset()),n.top+=p.css(e[0],"borderTopWidth",!0),n.left+=p.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-p.css(r,"marginTop",!0),left:t.left-n.left-p.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||ir;while(e&&!p.nodeName(e,"html")&&"static"===p.css(e,"position"))e=e.offsetParent;return e||ir})}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n=/Y/.test(t);p.fn[e]=function(r){return J(this,function(e,r,i){var s=sr(e);return void 0===i?s?t in s?s[t]:s.document.documentElement[r]:e[r]:void (s?s.scrollTo(n?p(s).scrollLeft():i,n?i:p(s).scrollTop()):e[r]=i)},e,r,arguments.length,null)}}),p.each(["top","left"],function(e,t){p.cssHooks[t]=Ft(c.pixelPosition,function(e,n){return n?(n=Bt(e,t),Pt.test(n)?p(e).position()[t]+"px":n):void 0})}),p.each({Height:"height",Width:"width"},function(e,t){p.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){p.fn[r]=function(r,i){var s=arguments.length&&(n||"boolean"!=typeof r),o=n||(r===!0||i===!0?"margin":"border");return J(this,function(t,n,r){var i;return p.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):void 0===r?p.css(t,n,o):p.style(t,n,r,o)},t,s?r:void 0,s,null)}})}),p.fn.size=function(){return this.length},p.fn.andSelf=p.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return p});var or=e.jQuery,ur=e.$;return p.noConflict=function(t){return e.$===p&&(e.$=ur),t&&e.jQuery===p&&(e.jQuery=or),p},typeof t===j&&(e.jQuery=e.$=p),p}),define("lib-app/jquery",function(){}),define("storymaps/common/utils/Polyfills",[],function(){return{apply:function(){typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Date.now||(Date.now=function(){return(new Date).valueOf()}),Object.keys=Object.keys||function(e,t,n){n=[];for(t in e)n.hasOwnProperty.call(e,t)&&n.push(t);return n},function(){function n(e){this.message=e}var e=typeof exports!="undefined"?exports:this,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.prototype=new Error,n.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){var r=String(e);for(var i,s,o=0,u=t,a="";r.charAt(o|0)||(u="=",o%1);a+=u.charAt(63&i>>8-o%1*8)){s=r.charCodeAt(o+=.75);if(s>255)throw new n("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");i=i<<8|s}return a}),e.atob||(e.atob=function(e){var r=String(e).replace(/=+$/,"");if(r.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var i=0,s,o,u=0,a="";o=r.charAt(u++);~o&&(s=i%4?s*64+o:o,i++%4)?a+=String.fromCharCode(255&s>>(-2*i&6)):0)o=t.indexOf(o);return a})}()}}}),define("storymaps/common/utils/SocialSharing",["dojo/Deferred","esri/urlUtils"],function(e,t){return{shareFacebook:function(e,t,n,r){var i=this.cleanURL(r||document.location.href);window.open("http://www.facebook.com/sharer/sharer.php?u="+i,"","toolbar=0,status=0,width=626,height=436")},shareTwitter:function(e,t){var n="text="+encodeURIComponent(e||"")+"&url="+this.cleanURL(t||document.location.href)+"&related=EsriStoryMaps"+"&hashtags=StoryMaps";window.open("https://twitter.com/intent/tweet?"+n,"","toolbar=0,status=0,width=626,height=436")},requestShortUrl:function(t){var n="https://arcg.is/prod/shorten?callback=?",r=t||document.location.href,i=new e;return $.getJSON(n,{longUrl:r},function(e){console.log(e),!e||!e||!e.data.url?i.reject():i.resolve(e.data.url)}),i},cleanURL:function(e,n){var r=t.urlToObject(e),i=r.path;return r.query&&(delete r.query.edit,delete r.query.locale,delete r.query.folderId,delete r.query.webmap,delete r.query.autoplay,$.each(Object.keys(r.query),function(e,t){e===0?i+="?":i+="&",r.query[t]!==undefined&&r.query[t]!==""?i+=t+"="+r.query[t]:i+=t})),n?i:encodeURIComponent(i)}}}),define("storymaps/common/utils/CommonHelper",["dojo/cookie","dojo/has","dojo/_base/lang","dojo/_base/Color","dojo/Deferred","dojo/DeferredList","./SocialSharing","esri/IdentityManager","esri/request","esri/dijit/Search","esri/tasks/locator","esri/urlUtils","esri/arcgis/utils","esri/geometry/webMercatorUtils","esri/geometry/Point","esri/geometry/Extent","esri/geometry/Polygon","esri/layers/FeatureLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/OpenStreetMapLayer","dojo/i18n!commonResources/nls/webmap.js?v="+app.version,"dojo/i18n!commonResources/nls/media.js?v="+app.version],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){return{isMobile:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/IEMobile/i)},switchToBuilder:function(){document.location.search.match(/appid/)?document.location=o.cleanURL(document.location.protocol+"//"+document.location.host+document.location.pathname+document.location.search,!0)+"&edit"+document.location.hash:document.location.search.slice(-1)=="?"?document.location=o.cleanURL(document.location.protocol+"//"+document.location.host+document.location.pathname,!0)+"?edit"+document.location.hash:document.location=o.cleanURL(document.location.protocol+"//"+document.location.host+document.location.pathname,!0)+"?edit"+document.location.hash},isArcGISHosted:function(){return/(\/)([a-zA-Z0-9]+(\/))*(apps\/|home\/)([a-zA-Z0-9\-\_]+\/)/.test(document.location.pathname)},browserSupportHistory:function(){return!!window.history&&!!history.pushState},getUrlParams:function(){var e=c.urlToObject(document.location.search).query;return e?e:!this.browserSupportHistory()&&!e?c.urlToObject(document.location.hash).query||{}:{}},getWebmapID:function(e){var t=this.getUrlParams();if(app.indexCfg&&app.indexCfg.webmap)return app.indexCfg.webmap;if(this.isArcGISHosted()||!e)return t.webmap;if(app.indexCfg.authorizedOwners&&app.indexCfg.authorizedOwners.length>0&&app.indexCfg.authorizedOwners[0])return t.webmap},getAppID:function(e){var t=this.getUrlParams();if(app.indexCfg&&app.indexCfg.appid)return app.indexCfg.appid;if(this.isArcGISHosted()||!e)return t.appid;if(app.indexCfg.authorizedOwners&&app.indexCfg.authorizedOwners.length>0&&app.indexCfg.authorizedOwners[0])return t.appid},getGraphicsLayerByName:function(e,t){var n;for(var r=0;r<e.graphicsLayerIds.length;r++){n=e.getLayer(e.graphicsLayerIds[r]);if(n.name==t)return n}return null},getWebMapExtentFromItem:function(e){if(!e.extent||e.extent.length!=2)return null;var t=p.geographicToWebMercator(new d(e.extent[0][0],e.extent[0][1])),n=p.geographicToWebMercator(new d(e.extent[1][0],e.extent[1][1]));return new v({xmax:n.x,xmin:t.x,ymax:n.y,ymin:t.y,spatialReference:{wkid:102100}})},serializeExtentToItem:function(e){if(!e||!e.spatialReference)return null;var t=e.spatialReference.wkid==4326?e:p.webMercatorToGeographic(e);return[[Math.round(t.xmin*1e4)/1e4,Math.round(t.ymin*1e4)/1e4],[Math.round(t.xmax*1e4)/1e4,Math.round(t.ymax*1e4)/1e4]]},serializedExtentEquals:function(e,t){return e&&t&&e.length==t.length&&e.length==2&&e[0][0]==t[0][0]&&e[0][1]==t[0][1]&&e[1][0]==t[1][0]&&e[1][1]==t[1][1]},cloneLayer:function(e){return e.url&&e.url.match(/virtualearth\./)?new b("http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer"):e instanceof b?new b(e.url):e instanceof y?new y(e.url):e.id=="OpenStreetMap"?new w:new b("http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer")},extentToPolygon:function(e){var t=new m(e.spatialReference);return t.addRing([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]),t},getFirstLevelWhereExtentFit:function(e,t){var n=t.width,r=t.height,i=t._params.lods;if(!i)return-1;for(var s=i.length-1;s>=0;s--)if(n*t._params.lods[s].resolution>e.getWidth()&&r*t._params.lods[s].resolution>e.getHeight())return s;return-1},getPortalUser:function(){var t=e("esri_auth");if(!t)return;t=JSON.parse(t.replace('"ssl":undefined','"ssl":""'));if(t.urlKey&&t.customBaseUrl&&(t.urlKey+"."+t.customBaseUrl).toLowerCase()!=document.location.hostname.toLowerCase())return;return t?t.email:null},getPortalRole:function(){var t=e("esri_auth");if(!t)return;t=JSON.parse(t.replace('"ssl":undefined','"ssl":""'));if(t.urlKey&&t.customBaseUrl&&(t.urlKey+"."+t.customBaseUrl).toLowerCase()!=document.location.hostname.toLowerCase())return;return t?t.role:null},getAppViewModeURL:function(){return document.location.protocol+"//"+document.location.host+document.location.pathname+"?appid="+app.data.getWebAppItem().id},getWebmapViewerLinkFromSharingURL:function(e){var t=e.split("/sharing/")[0];return t+"/home/webmap/viewer.html"},getPortalURL:function(){return h.arcgisUrl.split("/sharing/")[0]},getItemURL:function(e){return this.getPortalURL()+"/home/item.html?id="+e},getItemId:function(){return app.data&&app.data.getWebAppItem&&app.data.getWebAppItem().id},getMyContentURL:function(){return this.getPortalURL()+"/home/content.html"},getMyStoriesURL:function(){return app.isPortal?this.getPortalURL()+"/apps/MyStories/":"//storymaps.arcgis.com/en/my-stories/"},browserSupportAttachementUsingFileReader:function(){return!!window.FileReader&&!!window.FormData&&!!this.browserSupportCanvas()&&!!window.Blob},browserSupportCanvas:function(){var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},browserSupportFileReaderBinaryString:function(){if(!window.FileReader)return!1;var e=new window.FileReader;return"readAsArrayBuffer"in e},getBinaryStringFromArrayBuffer:function(e){var t=new Uint8Array(e),n="";for(var r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return n},addCSSRule:function(e,n,r){var i="head";if(t("ie")<=8)return;r&&(i=r.contents().find("head"));if(n){var s=$(i).find("#"+n).eq(0);if(s.length){s.html(e);return}}$("<style>").prop("type","text/css").attr("id",n).html(e).appendTo(i)},hex2rgba:function(e,t){if(!e||e==="")return"";var n=e.replace("#","").match(/../g),r=[],i;for(i in n)r.push(parseInt(n[i],16));return r.push(t),"rgba("+r.join()+")"},prependURLHTTP:function(e){return!e||e===""||e.match(/^mailto:/)?e:/^(https?:\/\/)|^(\/\/)/i.test(e)?e:"http://"+e},convertURLHTTPS:function(e){return!e||e===""||e.match(/^mailto:/)?e:(e=e.replace(/http:\/\//,"https://"),e=e.replace(/^\/\//,"https://"),/^(https:\/\/)/i.test(e)?e:"https://"+e)},convertURLHTTP:function(e){return!e||e===""||e.match(/^mailto:/)?e:(e=e.replace(/https:\/\//,"http://"),e=e.replace(/^\/\//,"http://"),/^(http:\/\/)/i.test(e)?e:"http://"+e)},checkImageURL:function(e){return e&&e.match(/((\.png)|(\.jp(e)?g))$/i)},createGeocoder:function(e){var t=new i;if(!e||!e.map||!e.domNode)return t.resolve(),t;if(!app.cfg.HELPER_SERVICES.geocode)return t.resolve(),t;var n=[],r=[],o=[],u=this;e.searchOptions&&e.searchOptions.layers&&e.searchOptions.layers.length&&e.searchOptions.enabled&&(r=this.getLayerSources(e.searchOptions.layers,e.map,e.searchOptions.hintText));var a=u.processAppDataGeocoders(e.placeHolder);r.length&&(o=r);if(!e.searchOptions||e.searchOptions&&!e.searchOptions.disablePlaceFinder)o=o.concat(a||[]),$.each(app.cfg.HELPER_SERVICES.geocode,function(e,t){n.push(u.getGeocoderRequest(t))});if(e.searchOptions&&e.searchOptions.disablePlaceFinder&&!o.length)if(a&&a.length)o.push(a[0]);else if(app.cfg.HELPER_SERVICES.geocode&&app.cfg.HELPER_SERVICES.geocode.length){var l=!1;$.each(app.cfg.HELPER_SERVICES.geocode,function(e,t){!l&&t.url&&(n.push(u.getGeocoderRequest(t)),l=!0)})}else o=null;var c={map:e.map,allPlaceholder:e.placeHolder,enableButtonMode:e.enableButtonMode};o&&o.length?(this.checkForSourceNameDuplicates(o),c.sources=o):c.placeholder=e.placeHolder||S.commonMedia.editorActionGeocode.lblTitle;var h=new f(c,e.domNode);if(n.length){var p=new s(n);p.then(function(n){var r=u.processGeocoderRequestReturn(n,e.placeHolder),i=h.get("sources").concat(r||[]);i.length&&(u.setGeocodeSources(h,i),t.resolve(h))})}else{var d=h.get("sources");d.length&&(u.setGeocodeSources(h,d),t.resolve(h))}return t},getGeocoderRequest:function(e){var t={url:e.url,content:{f:"json"},handleAs:"json"};return!app.isInBuilder&&!app.portal.user?t.disableIdentityLookup=!0:t.callbackParamName="callback",a(t)},getLayerSources:function(e,t,n){var r=this;return $.map(e,function(e){var i=t.getLayer(e.id),s={featureLayer:i,searchFields:[e.field.name],displayField:e.field.name,exactMatch:e.field.exactMatch,outFields:["*"],maxResults:6,name:r.findGeocoderName(i,e),placeholder:n};if(e.subLayer||e.subLayer===0){var o=e.subLayer,u;(u=i.dynamicLayerInfos)&&(u=u[e.subLayer])&&(u=u.source)&&(o=u.mapLayerId),s.featureLayer=new g(i.url+"/"+e.subLayer)}return s})},processGeocoderRequestReturn:function(e,t){var n=[],r=this;return $.each(e,function(e,i){if(!i[0]||!i[1]||!i[1].singleLineAddressField)return;var s=app.cfg.HELPER_SERVICES.geocode[e],o=new l(s.url),u={singleLineFieldName:i[1].singleLineAddressField.name,name:s.name?s.name:i[1].name,placeholder:s.placeholder||t||S.commonMedia.editorActionGeocode.lblTitle,locator:o};u.name=u.name||r.findGeocoderName({url:o.url}),r.isEsriGeocoder({url:s.url})&&(u.placeholder=S.commonMedia.editorActionGeocode.lblTitle);if(!i[1].capabilities||i[1].capabilities.toLowerCase().indexOf("suggest")<0)u.enableSuggestions=!1;n.push(u)}),n},processAppDataGeocoders:function(e){if(!app.data.getWebAppData().getAppGeocoders)return;var t=app.data.getWebAppData().getAppGeocoders();t||(t=[{name:"Esri World Geocoder",url:"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",singleLineFieldName:"SingleLine"}]);if(!t.length)return[];t=t.slice();var r=[],i=this;return $.each(t,function(t,s){if(s.url){var o=n.mixin({},s);o.locator=new l(o.url),i.isEsriGeocoder({url:o.url})?(o.placeholder=S.commonMedia.editorActionGeocode.lblTitle,o.name=E.commonWebmap.selector.lblEsriGeocoder):(o.placeholder=o.placeholder||e,o.name=o.name||i.findGeocoderName({url:o.url})),r.push(o)}}),r},setGeocodeSources:function(e,t){this.checkForSourceNameDuplicates(t),e.set("sources",t),e.set("activeSourceIndex",0),e.startup();if(!app.data.getWebAppData().getAppGeocoders)return;!app.data.getWebAppData().getAppGeocoders()&&e._allIndex&&e.set("activeSourceIndex",e._allIndex)},checkForSourceNameDuplicates:function(e){var t=[],n=this;$.each(e,function(e,r){t.indexOf(r.name)>=0&&(r.name=n.getAdjustedSourceName(t,r.name)),t.push(r.name)})},getAdjustedSourceName:function(e,t){var n=2,r=t+" - "+n;while(e.indexOf(r)>=0)n++,r=t+" - "+n;return r},isEsriGeocoder:function(e){return e.url?e.url.match(/geocode(.){0,3}\.arcgis.com\/arcgis\/rest\/services\/World\/GeocodeServer/g):(console.warn("no url on locator",e),!1)},findGeocoderName:function(e,t){var n=t?t.name||t.title:"";if(!n){var r=app.mapItem?app.mapItem.itemData.operationalLayers:[];r.some(function(t){return t.id===e.id?(n=t.title,!0):!1})}n=n||e.name||e.title;if(!n){if(!this.isEsriGeocoder(e)){if(typeof e.url!="string"||!e.url.split)return;var i=e.url.split("/"),s=i[i.length-2];s&&(n=s);return}n=E.commonWebmap.selector.lblEsriGeocoder}if(t&&(t.subLayer||t.subLayer===0)){var o=e.dynamicLayerInfos||e.layerInfos,u=o[t.subLayer];u&&u.name&&(n+=" - "+u.name)}return n.replace(/_/g," ")},colorsAreSimilar:function(e,t,n){var r=this.getLuminance(e),i=this.getLuminance(t),s=(r+.05)/(i+.05);return i>r&&(s=1/s),s>=2.85||n&&s>=2.2?!1:!0},getLuminance:function(e){var t=new r(e),n=t.toRgb().map(function(e){return e/=255,e<.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)});return.2126*n[0]+.7152*n[1]+.0722*n[2]},convertToDegrees:function(e){var t=e[0].numerator,n=e[0].denominator,r=parseFloat(t)/parseFloat(n),i=e[1].numerator,s=e[1].denominator,o=parseFloat(i)/parseFloat(s),u=e[2].numerator,a=e[2].denominator,f=parseFloat(u)/parseFloat(a);return r+o/60+f/3600},debounce:function(e,t,n){var r;return function(){var i=this,s=arguments;clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,s)},t),n&&!r&&e.apply(i,s)}},findDifferences:function(e,t){var n=[],r=["this"];return function(e,t){if(e.constructor==Array)if(!t||t.constructor!=Array||t.length!=e.length)n.push({Property:r.join(""),ObjectA:e,ObjectB:t});else for(var i=0;i<e.length;i++)r.push("["+i.toString()+"]"),arguments.callee(e[i],t[i]),r.pop();else if(e.constructor==Object||e.constructor!=Number&&e.constructor!=String&&e.constructor!=Date&&e.constructor!=RegExp&&e.constructor!=Function&&e.constructor!=Boolean)for(var s in e)r.push("."+s),t[s]?e[s]&&e[s].constructor!=Function&&arguments.callee(e[s],t[s]):n.push({Property:r.join(""),ObjectA:e[s],ObjectB:null}),r.pop();else e.constructor!=Function&&e!=t&&n.push({Property:r.join(""),ObjectA:e,ObjectB:t})}(e,t),n},possiblyAddToken:function(e){if(!this.isAppResource(e))return e;e=this.removeToken(e);if(!this.needsTokenAdded(e))return e;var t="";return app.portal&&app.portal.getPortalUser()?t=app.portal.getPortalUser().credential.token:u.findCredential(document.location.origin)?t=u.findCredential(document.location.origin).token:u.findCredential(app.portal.url)?t=u.findCredential(app.portal.url).token:t=this.getCookieToken(),this.forceHttps(e)+"?token="+t},forceHttps:function(e){var t=e.replace(/^.*?\/\//,"");return"https://"+t},isAppResource:function(e,t){return t||(t=app.data&&app.data.getWebAppItem&&app.data.getWebAppItem()),t?t&&t.id&&e&&e.match(new RegExp("/sharing/rest/content/items/"+t.id+"/resources/")):!1},needsTokenAdded:function(e){var t=app.data&&app.data.getWebAppItem&&app.data.getWebAppItem();return t?this.isAppResource(e,t)&&t.access!=="public":!1},getCookieToken:function(){var t=e("esri_auth");if(!t)return;t=JSON.parse(t.replace('"ssl":undefined','"ssl":""'));if(t.urlKey&&t.customBaseUrl&&(t.urlKey+"."+t.customBaseUrl).toLowerCase()!=document.location.hostname.toLowerCase())return;return t?t.token:null},possiblyRemoveToken:function(e){return this.isAppResource(e)?this.removeToken(e):e},removeToken:function(e){return e.split("?token=")[0]}}}),define("storymaps/common/builder/PortalVersionTest",["esri/arcgis/utils","dojo/Deferred"],function(e,t){function n(){return e.arcgisUrl.split("/sharing/")[0]}return{run:function(){var e=new t,r=null;app.portal.hasMyStories=null;var i=new Image,s=app.isProduction?n()+"/apps/":"../";return i.src=s+"MyStories/assets/my-stories-portal-detector.png",i.onload=function(){app.portal.hasMyStories=!0,r&&clearTimeout(r),e.resolve()},i.onerror=i.onabort=function(){app.portal.hasMyStories=!1,r&&clearTimeout(r),e.reject()},r=setTimeout(function(){e.reject()},2e3),e}}}),define("storymaps/common/builder/MyStoriesWrapper",["./PortalVersionTest","esri/IdentityManager","storymaps/common/utils/CommonHelper","dojo/topic"],function(e,t,n,r){function i(){e.run().then(function(){app.isProduction&&!f()?s():o()},s)}function s(){$(".check-story").hide()}function o(){window.myStoriesInit=u,r.publish("MYSTORIES_SCAN","start");var e="../MyStories/index.html?fromBuilder";e+="&locale="+dojo.locale,setTimeout(function(){$("#my-stories-frame").attr("src",e)},1e3)}function u(){var e=$("#my-stories-frame")[0].contentWindow;if(!e||!e.init||!e.check||!e.share){console.error("Failed to load My Stories");return}if(!app.data.getStoryLength()&&!app.appCfg.noStoryLengthRequired){console.log("Skipping the initialization of My Stories until the story has content");return}app.mystories={init:e.init,check:e.check,share:e.share,isChecking:!1,hasCheckErrors:!1,hasScanErrors:!1},app.mystories.init(app.isInBuilder?t.toJson():null,app.isDirectCreationFirstSave||app.isGalleryCreation?null:app.data.getWebAppItem(),app.cfg.TPL_ID,app.isPortal,function(e,t,n){r.publish("MY-STORIES-EDIT-MEDIA",{index:e,type:t,actionId:n})},function(e){r.publish("MY-STORIES-EDIT-MAP",{id:e})},function(){app.mystories.hasCheckErrors=!1,r.publish("MY-STORIES-REFRESH")},function(e){e=e||{completed:!1,ignoreAllIssues:!1},app.mystories.hasCheckErrors=!e.ignoreAllIssues,app.mystories.forcedIgnoreIssues=e.ignoreAllIssues,r.publish("MY-STORIES-REFRESH")}).then(a,function(){console.error("Failed to initialize My Stories")})}function a(){if(!app.mystories)return;if(!app.mystories.init){u();return}if(!app.mystories.check)return;app.mystories.isChecking=!0,app.mystories.hasCheckErrors=!1,r.publish("MYSTORIES_SCAN","start"),app.mystories.check(app.data.getWebAppData().get()).then(function(e){e=e||{ignoreAllIssues:!1},app.mystories.isChecking=!1,app.mystories.hasCheckErrors=!1,app.mystories.forcedIgnoreIssues=e.ignoreAllIssues,r.publish("MYSTORIES_SCAN","success"),$("#sharePopup").is(":visible")&&app.builder.openSharePopup()},function(e){e=e||{completed:!1,ignoreAllIssues:!1},app.mystories.isChecking=!1,app.mystories.hasCheckErrors=!0,app.mystories.forcedIgnoreIssues=e.ignoreAllIssues,r.publish("MYSTORIES_SCAN","error"),$("#sharePopup").is(":visible")&&app.builder.openSharePopup()})}function f(){var e=n.getPortalURL().split("//").slice(-1)[0],t=e.split("."),r=document.location.host,i=r.split(".");return e==r||e.split("/").length>1&&e.split("/")[0]==r?!0:i.length<3?r==e:i.slice(1).join(".")==t.slice(-2).join(".")}return{loadMyStories:i,scanStory:a,myStoriesIsSameDomain:f}}),function(){"use strict";function e(t,r){function s(e,t){return function(){return e.apply(t,arguments)}}var i;r=r||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=r.touchBoundary||10,this.layer=t,this.tapDelay=r.tapDelay||200,this.tapTimeout=r.tapTimeout||700;if(e.notNeeded(t))return;var o=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],u=this;for(var a=0,f=o.length;a<f;a++)u[o[a]]=s(u[o[a]],u);n&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,n,r){var i=Node.prototype.removeEventListener;e==="click"?i.call(t,e,n.hijacked||n,r):i.call(t,e,n,r)},t.addEventListener=function(e,n,r){var i=Node.prototype.addEventListener;e==="click"?i.call(t,e,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):i.call(t,e,n,r)}),typeof t.onclick=="function"&&(i=t.onclick,t.addEventListener("click",function(e){i(e)},!1),t.onclick=null)}var t=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!t,r=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,i=r&&/OS 4_\d(_\d)?/.test(navigator.userAgent),s=r&&/OS [6-7]_\d/.test(navigator.userAgent),o=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(r&&e.type==="file"||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},e.prototype.determineEventType=function(e){return n&&e.tagName.toLowerCase()==="select"?"mousedown":"click"},e.prototype.focus=function(e){var t;r&&e.setSelectionRange&&e.type.indexOf("date")!==0&&e.type!=="time"&&e.type!=="month"?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,n;t=e.fastClickScrollParent;if(!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,n,s;if(e.targetTouches.length>1)return!0;t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0];if(r){s=window.getSelection();if(s.rangeCount&&!s.isCollapsed)return!0;if(!i){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},e.prototype.onTouchMove=function(e){if(!this.trackingClick)return!0;if(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))this.trackingClick=!1,this.targetElement=null;return!0},e.prototype.findControl=function(e){return e.control!==undefined?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,o,u,a,f,l=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,o=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,s&&(f=e.changedTouches[0],l=document.elementFromPoint(f.pageX-window.pageXOffset,f.pageY-window.pageYOffset)||l,l.fastClickScrollParent=this.targetElement.fastClickScrollParent),u=l.tagName.toLowerCase();if(u==="label"){t=this.findControl(l);if(t){this.focus(l);if(n)return!1;l=t}}else if(this.needsFocus(l)){if(e.timeStamp-o>100||r&&window.top!==window&&u==="input")return this.targetElement=null,!1;this.focus(l),this.sendClick(l,e);if(!r||u!=="select")this.targetElement=null,e.preventDefault();return!1}if(r&&!i){a=l.fastClickScrollParent;if(a&&a.fastClickLastScrollTop!==a.scrollTop)return!0}return this.needsClick(l)||(e.preventDefault(),this.sendClick(l,e)),!1},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable?!this.needsClick(this.targetElement)||this.cancelNextClick?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0:!0},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):e.target.type==="submit"&&e.detail===0?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;n&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,r,i,s;if(typeof window.ontouchstart=="undefined")return!0;r=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(r){if(!n)return!0;t=document.querySelector("meta[name=viewport]");if(t){if(t.content.indexOf("user-scalable=no")!==-1)return!0;if(r>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(o){i=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);if(i[1]>=10&&i[2]>=3){t=document.querySelector("meta[name=viewport]");if(t){if(t.content.indexOf("user-scalable=no")!==-1)return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}}}if(e.style.msTouchAction==="none"||e.style.touchAction==="manipulation")return!0;s=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(s>=27){t=document.querySelector("meta[name=viewport]");if(t&&(t.content.indexOf("user-scalable=no")!==-1||document.documentElement.scrollWidth<=window.outerWidth))return!0}return e.style.touchAction==="none"||e.style.touchAction==="manipulation"?!0:!1},e.attach=function(t,n){return new e(t,n)},typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("lib-app/jquery.fastClick",[],function(){return e}):typeof module!="undefined"&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}();if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(e){"use strict";var t=e.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||1==t[0]&&9==t[1]&&t[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher")}(jQuery),+function(e){"use strict";function t(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var r=n&&e(n);return r&&r.length?r:t.parent()}function n(n){n&&3===n.which||(e(i).remove(),e(s).each(function(){var r=e(this),i=t(r),s={relatedTarget:this};i.hasClass("open")&&(n&&"click"==n.type&&/input|textarea/i.test(n.target.tagName)&&e.contains(i[0],n.target)||(i.trigger(n=e.Event("hide.bs.dropdown",s)),n.isDefaultPrevented()||(r.attr("aria-expanded","false"),i.removeClass("open").trigger("hidden.bs.dropdown",s))))}))}function r(t){return this.each(function(){var n=e(this),r=n.data("bs.dropdown");r||n.data("bs.dropdown",r=new o(this)),"string"==typeof t&&r[t].call(n)})}var i=".dropdown-backdrop",s='[data-toggle="dropdown"]',o=function(t){e(t).on("click.bs.dropdown",this.toggle)};o.VERSION="3.3.5",o.prototype.toggle=function(r){var i=e(this);if(!i.is(".disabled, :disabled")){var s=t(i),o=s.hasClass("open");if(n(),!o){"ontouchstart"in document.documentElement&&!s.closest(".navbar-nav").length&&e(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(e(this)).on("click",n);var u={relatedTarget:this};if(s.trigger(r=e.Event("show.bs.dropdown",u)),r.isDefaultPrevented())return;i.trigger("focus").attr("aria-expanded","true"),s.toggleClass("open").trigger("shown.bs.dropdown",u)}return!1}},o.prototype.keydown=function(n){if(/(38|40|27|32)/.test(n.which)&&!/input|textarea/i.test(n.target.tagName)){var r=e(this);if(n.preventDefault(),n.stopPropagation(),!r.is(".disabled, :disabled")){var i=t(r),o=i.hasClass("open");if(!o&&27!=n.which||o&&27==n.which)return 27==n.which&&i.find(s).trigger("focus"),r.trigger("click");var u=" li:not(.disabled):visible a",a=i.find(".dropdown-menu"+u);if(a.length){var f=a.index(n.target);38==n.which&&f>0&&f--,40==n.which&&f<a.length-1&&f++,~f||(f=0),a.eq(f).trigger("focus")}}}};var u=e.fn.dropdown;e.fn.dropdown=r,e.fn.dropdown.Constructor=o,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=u,this},e(document).on("click.bs.dropdown.data-api",n).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",s,o.prototype.toggle).on("keydown.bs.dropdown.data-api",s,o.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",o.prototype.keydown)}(jQuery),+function(e){"use strict";function t(t,r){return this.each(function(){var s=e(this),u=s.data("bs.modal"),a=e.extend({},n.DEFAULTS,s.data(),"object"==typeof t&&t);u||s.data("bs.modal",u=new n(this,a)),"string"==typeof t?u[t](r):a.show&&u.show(r)})}var n=function(t,n){this.options=n,this.$body=e(document.body),this.$element=e(t),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};n.VERSION="3.3.5",n.TRANSITION_DURATION=300,n.BACKDROP_TRANSITION_DURATION=150,n.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},n.prototype.toggle=function(e){return this.isShown?this.hide():this.show(e)},n.prototype.show=function(t){var r=this,s=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(s),this.isShown||s.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){r.$element.one("mouseup.dismiss.bs.modal",function(t){e(t.target).is(r.$element)&&(r.ignoreBackdropClick=!0)})}),this.backdrop(function(){var s=e.support.transition&&r.$element.hasClass("fade");r.$element.parent().length||r.$element.appendTo(r.$body),r.$element.show().scrollTop(0),r.adjustDialog(),s&&r.$element[0].offsetWidth,r.$element.addClass("in"),r.enforceFocus();var u=e.Event("shown.bs.modal",{relatedTarget:t});s?r.$dialog.one("bsTransitionEnd",function(){r.$element.trigger("focus").trigger(u)}).emulateTransitionEnd(n.TRANSITION_DURATION):r.$element.trigger("focus").trigger(u)}))},n.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",e.proxy(this.hideModal,this)).emulateTransitionEnd(n.TRANSITION_DURATION):this.hideModal())},n.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},n.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},n.prototype.resize=function(){this.isShown?e(window).on("resize.bs.modal",e.proxy(this.handleUpdate,this)):e(window).off("resize.bs.modal")},n.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.$body.removeClass("modal-open"),e.resetAdjustments(),e.resetScrollbar(),e.$element.trigger("hidden.bs.modal")})},n.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},n.prototype.backdrop=function(t){var r=this,s=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var o=e.support.transition&&s;if(this.$backdrop=e(document.createElement("div")).addClass("modal-backdrop "+s).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",e.proxy(function(e){return this.ignoreBackdropClick?void (this.ignoreBackdropClick=!1):void (e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),o&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;o?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var u=function(){r.removeBackdrop(),t&&t()};e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",u).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):u()}else t&&t()},n.prototype.handleUpdate=function(){this.adjustDialog()},n.prototype.adjustDialog=function(){var e=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&e?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!e?this.scrollbarWidth:""})},n.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},n.prototype.checkScrollbar=function(){var e=window.innerWidth;if(!e){var t=document.documentElement.getBoundingClientRect();e=t.right-Math.abs(t.left)}this.bodyIsOverflowing=document.body.clientWidth<e,this.scrollbarWidth=this.measureScrollbar()},n.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",e+this.scrollbarWidth)},n.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},n.prototype.measureScrollbar=function(){var e=document.createElement("div");e.className="modal-scrollbar-measure",this.$body.append(e);var t=e.offsetWidth-e.clientWidth;return this.$body[0].removeChild(e),t};var r=e.fn.modal;e.fn.modal=t,e.fn.modal.Constructor=n,e.fn.modal.noConflict=function(){return e.fn.modal=r,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(n){var r=e(this),i=r.attr("href"),s=e(r.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),o=s.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(i)&&i},s.data(),r.data());r.is("a")&&n.preventDefault(),s.one("show.bs.modal",function(e){e.isDefaultPrevented()||s.one("hidden.bs.modal",function(){r.is(":visible")&&r.trigger("focus")})}),t.call(s,o,this)})}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),s=r.data("bs.tooltip"),o="object"==typeof t&&t;(s||!/destroy|hide/.test(t))&&(s||r.data("bs.tooltip",s=new n(this,o)),"string"==typeof t&&s[t]())})}var n=function(e,t){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",e,t)};n.VERSION="3.3.5",n.TRANSITION_DURATION=150,n.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},n.prototype.init=function(t,n,r){if(this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.$viewport=this.options.viewport&&e(e.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var i=this.options.trigger.split(" "),s=i.length;s--;){var o=i[s];if("click"==o)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=o){var u="hover"==o?"mouseenter":"focusin",a="hover"==o?"mouseleave":"focusout";this.$element.on(u+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(a+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},n.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,r){n[e]!=r&&(t[e]=r)}),t},n.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusin"==t.type?"focus":"hover"]=!0),n.tip().hasClass("in")||"in"==n.hoverState?void (n.hoverState="in"):(clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?void (n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show)):n.show())},n.prototype.isInStateTrue=function(){for(var e in this.inState)if(this.inState[e])return!0;return!1},n.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusout"==t.type?"focus":"hover"]=!1),n.isInStateTrue()?void 0:(clearTimeout(n.timeout),n.hoverState="out",n.options.delay&&n.options.delay.hide?void (n.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide)):n.hide())},n.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);var r=e.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(t.isDefaultPrevented()||!r)return;var s=this,o=this.tip(),u=this.getUID(this.type);this.setContent(),o.attr("id",u),this.$element.attr("aria-describedby",u),this.options.animation&&o.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,o[0],this.$element[0]):this.options.placement,f=/\s?auto?\s?/i,l=f.test(a);l&&(a=a.replace(f,"")||"top"),o.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?o.appendTo(this.options.container):o.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var c=this.getPosition(),h=o[0].offsetWidth,p=o[0].offsetHeight;if(l){var d=a,v=this.getPosition(this.$viewport);a="bottom"==a&&c.bottom+p>v.bottom?"top":"top"==a&&c.top-p<v.top?"bottom":"right"==a&&c.right+h>v.width?"left":"left"==a&&c.left-h<v.left?"right":a,o.removeClass(d).addClass(a)}var m=this.getCalculatedOffset(a,c,h,p);this.applyPlacement(m,a);var g=function(){var e=s.hoverState;s.$element.trigger("shown.bs."+s.type),s.hoverState=null,"out"==e&&s.leave(s)};e.support.transition&&this.$tip.hasClass("fade")?o.one("bsTransitionEnd",g).emulateTransitionEnd(n.TRANSITION_DURATION):g()}},n.prototype.applyPlacement=function(t,n){var r=this.tip(),i=r[0].offsetWidth,s=r[0].offsetHeight,o=parseInt(r.css("margin-top"),10),u=parseInt(r.css("margin-left"),10);isNaN(o)&&(o=0),isNaN(u)&&(u=0),t.top+=o,t.left+=u,e.offset.setOffset(r[0],e.extend({using:function(e){r.css({top:Math.round(e.top),left:Math.round(e.left)})}},t),0),r.addClass("in");var a=r[0].offsetWidth,f=r[0].offsetHeight;"top"==n&&f!=s&&(t.top=t.top+s-f);var l=this.getViewportAdjustedDelta(n,t,a,f);l.left?t.left+=l.left:t.top+=l.top;var c=/top|bottom/.test(n),h=c?2*l.left-i+a:2*l.top-s+f,p=c?"offsetWidth":"offsetHeight";r.offset(t),this.replaceArrow(h,r[0][p],c)},n.prototype.replaceArrow=function(e,t,n){this.arrow().css(n?"left":"top",50*(1-e/t)+"%").css(n?"top":"left","")},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},n.prototype.hide=function(t){function r(){"in"!=s.hoverState&&o.detach(),s.$element.removeAttr("aria-describedby").trigger("hidden.bs."+s.type),t&&t()}var s=this,o=e(this.$tip),u=e.Event("hide.bs."+this.type);return this.$element.trigger(u),u.isDefaultPrevented()?void 0:(o.removeClass("in"),e.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",r).emulateTransitionEnd(n.TRANSITION_DURATION):r(),this.hoverState=null,this)},n.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},n.prototype.hasContent=function(){return this.getTitle()},n.prototype.getPosition=function(t){t=t||this.$element;var n=t[0],r="BODY"==n.tagName,i=n.getBoundingClientRect();null==i.width&&(i=e.extend({},i,{width:i.right-i.left,height:i.bottom-i.top}));var s=r?{top:0,left:0}:t.offset(),o={scroll:r?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},u=r?{width:e(window).width(),height:e(window).height()}:null;return e.extend({},i,o,u,s)},n.prototype.getCalculatedOffset=function(e,t,n,r){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-n/2}:"top"==e?{top:t.top-r,left:t.left+t.width/2-n/2}:"left"==e?{top:t.top+t.height/2-r/2,left:t.left-n}:{top:t.top+t.height/2-r/2,left:t.left+t.width}},n.prototype.getViewportAdjustedDelta=function(e,t,n,r){var i={top:0,left:0};if(!this.$viewport)return i;var s=this.options.viewport&&this.options.viewport.padding||0,o=this.getPosition(this.$viewport);if(/right|left/.test(e)){var u=t.top-s-o.scroll,a=t.top+s-o.scroll+r;u<o.top?i.top=o.top-u:a>o.top+o.height&&(i.top=o.top+o.height-a)}else{var f=t.left-s,l=t.left+s+n;f<o.left?i.left=o.left-f:l>o.right&&(i.left=o.left+o.width-l)}return i},n.prototype.getTitle=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||("function"==typeof n.title?n.title.call(t[0]):n.title)},n.prototype.getUID=function(e){do e+=~~(1e6*Math.random());while(document.getElementById(e));return e},n.prototype.tip=function(){if(!this.$tip&&(this.$tip=e(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},n.prototype.enable=function(){this.enabled=!0},n.prototype.disable=function(){this.enabled=!1},n.prototype.toggleEnabled=function(){this.enabled=!this.enabled},n.prototype.toggle=function(t){var n=this;t&&(n=e(t.currentTarget).data("bs."+this.type),n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n))),t?(n.inState.click=!n.inState.click,n.isInStateTrue()?n.enter(n):n.leave(n)):n.tip().hasClass("in")?n.leave(n):n.enter(n)},n.prototype.destroy=function(){var e=this;clearTimeout(this.timeout),this.hide(function(){e.$element.off("."+e.type).removeData("bs."+e.type),e.$tip&&e.$tip.detach(),e.$tip=null,e.$arrow=null,e.$viewport=null})};var r=e.fn.tooltip;e.fn.tooltip=t,e.fn.tooltip.Constructor=n,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=r,this}}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),s=r.data("bs.popover"),o="object"==typeof t&&t;(s||!/destroy|hide/.test(t))&&(s||r.data("bs.popover",s=new n(this,o)),"string"==typeof t&&s[t]())})}var n=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");n.VERSION="3.3.5",n.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),n.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),n.prototype.constructor=n,n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof n?"html":"append":"text"](n),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},n.prototype.hasContent=function(){return this.getTitle()||this.getContent()},n.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var r=e.fn.popover;e.fn.popover=t,e.fn.popover.Constructor=n,e.fn.popover.noConflict=function(){return e.fn.popover=r,this}}(jQuery),+function(e){"use strict";function t(t){return this.each(function(){var r=e(this),i=r.data("bs.tab");i||r.data("bs.tab",i=new n(this)),"string"==typeof t&&i[t]()})}var n=function(t){this.element=e(t)};n.VERSION="3.3.5",n.TRANSITION_DURATION=150,n.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.data("target");if(r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var i=n.find(".active:last a"),s=e.Event("hide.bs.tab",{relatedTarget:t[0]}),o=e.Event("show.bs.tab",{relatedTarget:i[0]});if(i.trigger(s),t.trigger(o),!o.isDefaultPrevented()&&!s.isDefaultPrevented()){var u=e(r);this.activate(t.closest("li"),n),this.activate(u,u.parent(),function(){i.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:i[0]})})}}},n.prototype.activate=function(t,r,i){function s(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),u?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu").length&&t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),i&&i()}var o=r.find("> .active"),u=i&&e.support.transition&&(o.length&&o.hasClass("fade")||!!r.find("> .fade").length);o.length&&u?o.one("bsTransitionEnd",s).emulateTransitionEnd(n.TRANSITION_DURATION):s(),o.removeClass("in")};var r=e.fn.tab;e.fn.tab=t,e.fn.tab.Constructor=n,e.fn.tab.noConflict=function(){return e.fn.tab=r,this};var i=function(n){n.preventDefault(),t.call(e(this),"show")};e(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',i).on("click.bs.tab.data-api",'[data-toggle="pill"]',i)}(jQuery),+function(e){"use strict";function t(t){var n,r=t.attr("data-target")||(n=t.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"");return e(r)}function n(t){return this.each(function(){var n=e(this),i=n.data("bs.collapse"),s=e.extend({},r.DEFAULTS,n.data(),"object"==typeof t&&t);!i&&s.toggle&&/show|hide/.test(t)&&(s.toggle=!1),i||n.data("bs.collapse",i=new r(this,s)),"string"==typeof t&&i[t]()})}var r=function(t,n){this.$element=e(t),this.options=e.extend({},r.DEFAULTS,n),this.$trigger=e('[data-toggle="collapse"][href="#'+t.id+'"],[data-toggle="collapse"][data-target="#'+t.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};r.VERSION="3.3.5",r.TRANSITION_DURATION=350,r.DEFAULTS={toggle:!0},r.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},r.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t,i=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(i&&i.length&&(t=i.data("bs.collapse"),t&&t.transitioning))){var s=e.Event("show.bs.collapse");if(this.$element.trigger(s),!s.isDefaultPrevented()){i&&i.length&&(n.call(i,"hide"),t||i.data("bs.collapse",null));var u=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[u](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var a=function(){this.$element.removeClass("collapsing").addClass("collapse in")[u](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return a.call(this);var f=e.camelCase(["scroll",u].join("-"));this.$element.one("bsTransitionEnd",e.proxy(a,this)).emulateTransitionEnd(r.TRANSITION_DURATION)[u](this.$element[0][f])}}}},r.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var i=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return e.support.transition?void this.$element[n](0).one("bsTransitionEnd",e.proxy(i,this)).emulateTransitionEnd(r.TRANSITION_DURATION):i.call(this)}}},r.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},r.prototype.getParent=function(){return e(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(e.proxy(function(n,r){var i=e(r);this.addAriaAndCollapsedClass(t(i),i)},this)).end()},r.prototype.addAriaAndCollapsedClass=function(e,t){var n=e.hasClass("in");e.attr("aria-expanded",n),t.toggleClass("collapsed",!n).attr("aria-expanded",n)};var i=e.fn.collapse;e.fn.collapse=n,e.fn.collapse.Constructor=r,e.fn.collapse.noConflict=function(){return e.fn.collapse=i,this},e(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(r){var i=e(this);i.attr("data-target")||r.preventDefault();var s=t(i),o=s.data("bs.collapse"),u=o?"toggle":i.data();n.call(s,u)})}(jQuery),+function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]};return!1}e.fn.emulateTransitionEnd=function(t){var n=!1,r=this;e(this).one("bsTransitionEnd",function(){n=!0});var i=function(){n||e(r).trigger(e.support.transition.end)};return setTimeout(i,t),this},e(function(){e.support.transition=t(),e.support.transition&&(e.event.special.bsTransitionEnd={bindType:e.support.transition.end,delegateType:e.support.transition.end,handle:function(t){return e(t.target).is(this)?t.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),define("lib-app/bootstrap/js/bootstrap.min",function(){}),typeof JSON!="object"&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e,t){"use strict";var n=e.History=e.History||{};if(typeof n.Adapter!="undefined")throw new Error("History.js Adapter has already been loaded...");n.Adapter={handlers:{},_uid:1,uid:function(e){return e._uid||(e._uid=n.Adapter._uid++)},bind:function(e,t,r){var i=n.Adapter.uid(e);n.Adapter.handlers[i]=n.Adapter.handlers[i]||{},n.Adapter.handlers[i][t]=n.Adapter.handlers[i][t]||[],n.Adapter.handlers[i][t].push(r),e["on"+t]=function(e,t){return function(r){n.Adapter.trigger(e,t,r)}}(e,t)},trigger:function(e,t,r){r=r||{};var i=n.Adapter.uid(e),s,o;n.Adapter.handlers[i]=n.Adapter.handlers[i]||{},n.Adapter.handlers[i][t]=n.Adapter.handlers[i][t]||[];for(s=0,o=n.Adapter.handlers[i][t].length;s<o;++s)n.Adapter.handlers[i][t][s].apply(this,[r])},extractEventData:function(e,n){var r=n&&n[e]||t;return r},onDomLoad:function(t){var n=e.setTimeout(function(){t()},2e3);e.onload=function(){clearTimeout(n),t()}}},typeof n.init!="undefined"&&n.init()}(window),function(e,t){"use strict";var n=e.document,r=e.setTimeout||r,i=e.clearTimeout||i,s=e.setInterval||s,o=e.History=e.History||{};if(typeof o.initHtml4!="undefined")throw new Error("History.js HTML4 Support has already been loaded...");o.initHtml4=function(){if(typeof o.initHtml4.initialized!="undefined")return!1;o.initHtml4.initialized=!0,o.enabled=!0,o.savedHashes=[],o.isLastHash=function(e){var t=o.getHashByIndex(),n;return n=e===t,n},o.isHashEqual=function(e,t){return e=encodeURIComponent(e).replace(/%25/g,"%"),t=encodeURIComponent(t).replace(/%25/g,"%"),e===t},o.saveHash=function(e){return o.isLastHash(e)?!1:(o.savedHashes.push(e),!0)},o.getHashByIndex=function(e){var t=null;return typeof e=="undefined"?t=o.savedHashes[o.savedHashes.length-1]:e<0?t=o.savedHashes[o.savedHashes.length+e]:t=o.savedHashes[e],t},o.discardedHashes={},o.discardedStates={},o.discardState=function(e,t,n){var r=o.getHashByState(e),i;return i={discardedState:e,backState:n,forwardState:t},o.discardedStates[r]=i,!0},o.discardHash=function(e,t,n){var r={discardedHash:e,backState:n,forwardState:t};return o.discardedHashes[e]=r,!0},o.discardedState=function(e){var t=o.getHashByState(e),n;return n=o.discardedStates[t]||!1,n},o.discardedHash=function(e){var t=o.discardedHashes[e]||!1;return t},o.recycleState=function(e){var t=o.getHashByState(e);return o.discardedState(e)&&delete o.discardedStates[t],!0},o.emulated.hashChange&&(o.hashChangeInit=function(){o.checkerFunction=null;var t="",r,i,u,a,f=Boolean(o.getHash());return o.isInternetExplorer()?(r="historyjs-iframe",i=n.createElement("iframe"),i.setAttribute("id",r),i.setAttribute("src","#"),i.style.display="none",n.body.appendChild(i),i.contentWindow.document.open(),i.contentWindow.document.close(),u="",a=!1,o.checkerFunction=function(){if(a)return!1;a=!0;var n=o.getHash(),r=o.getHash(i.contentWindow.document);return n!==t?(t=n,r!==n&&(u=r=n,i.contentWindow.document.open(),i.contentWindow.document.close(),i.contentWindow.document.location.hash=o.escapeHash(n)),o.Adapter.trigger(e,"hashchange")):r!==u&&(u=r,f&&r===""?o.back():o.setHash(r,!1)),a=!1,!0}):o.checkerFunction=function(){var n=o.getHash()||"";return n!==t&&(t=n,o.Adapter.trigger(e,"hashchange")),!0},o.intervalList.push(s(o.checkerFunction,o.options.hashChangeInterval)),!0},o.Adapter.onDomLoad(o.hashChangeInit)),o.emulated.pushState&&(o.onHashChange=function(t){var n=t&&t.newURL||o.getLocationHref(),r=o.getHashByUrl(n),i=null,s=null,u=null,a;return o.isLastHash(r)?(o.busy(!1),!1):(o.doubleCheckComplete(),o.saveHash(r),r&&o.isTraditionalAnchor(r)?(o.Adapter.trigger(e,"anchorchange"),o.busy(!1),!1):(i=o.extractState(o.getFullUrl(r||o.getLocationHref()),!0),o.isLastSavedState(i)?(o.busy(!1),!1):(s=o.getHashByState(i),a=o.discardedState(i),a?(o.getHashByIndex(-2)===o.getHashByState(a.forwardState)?o.back(!1):o.forward(!1),!1):(o.pushState(i.data,i.title,encodeURI(i.url),!1),!0))))},o.Adapter.bind(e,"hashchange",o.onHashChange),o.pushState=function(t,n,r,i){r=encodeURI(r).replace(/%25/g,"%");if(o.getHashByUrl(r))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(i!==!1&&o.busy())return o.pushQueue({scope:o,callback:o.pushState,args:arguments,queue:i}),!1;o.busy(!0);var s=o.createStateObject(t,n,r),u=o.getHashByState(s),a=o.getState(!1),f=o.getHashByState(a),l=o.getHash(),c=o.expectedStateId==s.id;return o.storeState(s),o.expectedStateId=s.id,o.recycleState(s),o.setTitle(s),u===f?(o.busy(!1),!1):(o.saveState(s),c||o.Adapter.trigger(e,"statechange"),!o.isHashEqual(u,l)&&!o.isHashEqual(u,o.getShortUrl(o.getLocationHref()))&&o.setHash(u,!1),o.busy(!1),!0)},o.replaceState=function(t,n,r,i){r=encodeURI(r).replace(/%25/g,"%");if(o.getHashByUrl(r))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(i!==!1&&o.busy())return o.pushQueue({scope:o,callback:o.replaceState,args:arguments,queue:i}),!1;o.busy(!0);var s=o.createStateObject(t,n,r),u=o.getHashByState(s),a=o.getState(!1),f=o.getHashByState(a),l=o.getStateByIndex(-2);return o.discardState(a,s,l),u===f?(o.storeState(s),o.expectedStateId=s.id,o.recycleState(s),o.setTitle(s),o.saveState(s),o.Adapter.trigger(e,"statechange"),o.busy(!1)):o.pushState(s.data,s.title,s.url,!1),!0}),o.emulated.pushState&&o.getHash()&&!o.emulated.hashChange&&o.Adapter.onDomLoad(function(){o.Adapter.trigger(e,"hashchange")})},typeof o.init!="undefined"&&o.init()}(window),function(e,t){"use strict";var n=e.console||t,r=e.document,i=e.navigator,s=!1,o=e.setTimeout,u=e.clearTimeout,a=e.setInterval,f=e.clearInterval,l=e.JSON,c=e.alert,h=e.History=e.History||{},p=e.history;try{s=e.sessionStorage,s.setItem("TEST","1"),s.removeItem("TEST")}catch(d){s=!1}l.stringify=l.stringify||l.encode,l.parse=l.parse||l.decode;if(typeof h.init!="undefined")throw new Error("History.js Core has already been loaded...");h.init=function(e){return typeof h.Adapter=="undefined"?!1:(typeof h.initCore!="undefined"&&h.initCore(),typeof h.initHtml4!="undefined"&&h.initHtml4(),!0)},h.initCore=function(d){if(typeof h.initCore.initialized!="undefined")return!1;h.initCore.initialized=!0,h.options=h.options||{},h.options.hashChangeInterval=h.options.hashChangeInterval||100,h.options.safariPollInterval=h.options.safariPollInterval||500,h.options.doubleCheckInterval=h.options.doubleCheckInterval||500,h.options.disableSuid=h.options.disableSuid||!1,h.options.storeInterval=h.options.storeInterval||1e3,h.options.busyDelay=h.options.busyDelay||250,h.options.debug=h.options.debug||!1,h.options.initialTitle=h.options.initialTitle||r.title,h.options.html4Mode=h.options.html4Mode||!1,h.options.delayInit=h.options.delayInit||!1,h.intervalList=[],h.clearAllIntervals=function(){var e,t=h.intervalList;if(typeof t!="undefined"&&t!==null){for(e=0;e<t.length;e++)f(t[e]);h.intervalList=null}},h.debug=function(){(h.options.debug||!1)&&h.log.apply(h,arguments)},h.log=function(){var e=typeof n!="undefined"&&typeof n.log!="undefined"&&typeof n.log.apply!="undefined",t=r.getElementById("log"),i,s,o,u,a;e?(u=Array.prototype.slice.call(arguments),i=u.shift(),typeof n.debug!="undefined"?n.debug.apply(n,[i,u]):n.log.apply(n,[i,u])):i="\n"+arguments[0]+"\n";for(s=1,o=arguments.length;s<o;++s){a=arguments[s];if(typeof a=="object"&&typeof l!="undefined")try{a=l.stringify(a)}catch(f){}i+="\n"+a+"\n"}return t?(t.value+=i+"\n-----\n",t.scrollTop=t.scrollHeight-t.clientHeight):e||c(i),!0},h.getInternetExplorerMajorVersion=function(){var e=h.getInternetExplorerMajorVersion.cached=typeof h.getInternetExplorerMajorVersion.cached!="undefined"?h.getInternetExplorerMajorVersion.cached:function(){var e=3,t=r.createElement("div"),n=t.getElementsByTagName("i");while((t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&n[0]);return e>4?e:!1}();return e},h.isInternetExplorer=function(){var e=h.isInternetExplorer.cached=typeof h.isInternetExplorer.cached!="undefined"?h.isInternetExplorer.cached:Boolean(h.getInternetExplorerMajorVersion());return e},h.options.html4Mode?h.emulated={pushState:!0,hashChange:!0}:h.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(i.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(i.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in r)||h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8)},h.enabled=!h.emulated.pushState,h.bugs={setHash:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),safariPoll:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),ieDoubleCheck:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<7)},h.isEmptyObject=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},h.cloneObject=function(e){var t,n;return e?(t=l.stringify(e),n=l.parse(t)):n={},n},h.getRootUrl=function(){var e=r.location.protocol+"//"+(r.location.hostname||r.location.host);if(r.location.port||!1)e+=":"+r.location.port;return e+="/",e},h.getBaseHref=function(){var e=r.getElementsByTagName("base"),t=null,n="";return e.length===1&&(t=e[0],n=t.href.replace(/[^\/]+$/,"")),n=n.replace(/\/+$/,""),n&&(n+="/"),n},h.getBaseUrl=function(){var e=h.getBaseHref()||h.getBasePageUrl()||h.getRootUrl();return e},h.getPageUrl=function(){var e=h.getState(!1,!1),t=(e||{}).url||h.getLocationHref(),n;return n=t.replace(/\/+$/,"").replace(/[^\/]+$/,function(e,t,n){return/\./.test(e)?e:e+"/"}),n},h.getBasePageUrl=function(){var e=h.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,t,n){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e},h.getFullUrl=function(e,t){var n=e,r=e.substring(0,1);return t=typeof t=="undefined"?!0:t,/[a-z]+\:\/\//.test(e)||(r==="/"?n=h.getRootUrl()+e.replace(/^\/+/,""):r==="#"?n=h.getPageUrl().replace(/#.*/,"")+e:r==="?"?n=h.getPageUrl().replace(/[\?#].*/,"")+e:t?n=h.getBaseUrl()+e.replace(/^(\.\/)+/,""):n=h.getBasePageUrl()+e.replace(/^(\.\/)+/,"")),n.replace(/\#$/,"")},h.getShortUrl=function(e){var t=e,n=h.getBaseUrl(),r=h.getRootUrl();return h.emulated.pushState&&(t=t.replace(n,"")),t=t.replace(r,"/"),h.isTraditionalAnchor(t)&&(t="./"+t),t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,""),t},h.getLocationHref=function(e){return e=e||r,e.URL===e.location.href?e.location.href:e.location.href===decodeURIComponent(e.URL)?e.URL:e.location.hash&&decodeURIComponent(e.location.href.replace(/^[^#]+/,""))===e.location.hash?e.location.href:e.URL.indexOf("#")==-1&&e.location.href.indexOf("#")!=-1?e.location.href:e.URL||e.location.href},h.store={},h.idToState=h.idToState||{},h.stateToId=h.stateToId||{},h.urlToId=h.urlToId||{},h.storedStates=h.storedStates||[],h.savedStates=h.savedStates||[],h.normalizeStore=function(){h.store.idToState=h.store.idToState||{},h.store.urlToId=h.store.urlToId||{},h.store.stateToId=h.store.stateToId||{}},h.getState=function(e,t){typeof e=="undefined"&&(e=!0),typeof t=="undefined"&&(t=!0);var n=h.getLastSavedState();return!n&&t&&(n=h.createStateObject()),e&&(n=h.cloneObject(n),n.url=n.cleanUrl||n.url),n},h.getIdByState=function(e){var t=h.extractId(e.url),n;if(!t){n=h.getStateString(e);if(typeof h.stateToId[n]!="undefined")t=h.stateToId[n];else if(typeof h.store.stateToId[n]!="undefined")t=h.store.stateToId[n];else{for(;;){t=(new Date).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof h.idToState[t]=="undefined"&&typeof h.store.idToState[t]=="undefined")break}h.stateToId[n]=t,h.idToState[t]=e}}return t},h.normalizeState=function(e){var t,n;if(!e||typeof e!="object")e={};if(typeof e.normalized!="undefined")return e;if(!e.data||typeof e.data!="object")e.data={};return t={},t.normalized=!0,t.title=e.title||"",t.url=h.getFullUrl(e.url?e.url:h.getLocationHref()),t.hash=h.getShortUrl(t.url),t.data=h.cloneObject(e.data),t.id=h.getIdByState(t),t.cleanUrl=t.url.replace(/\??\&_suid.*/,""),t.url=t.cleanUrl,n=!h.isEmptyObject(t.data),(t.title||n)&&h.options.disableSuid!==!0&&(t.hash=h.getShortUrl(t.url).replace(/\??\&_suid.*/,""),/\?/.test(t.hash)||(t.hash+="?"),t.hash+="&_suid="+t.id),t.hashedUrl=h.getFullUrl(t.hash),(h.emulated.pushState||h.bugs.safariPoll)&&h.hasUrlDuplicate(t)&&(t.url=t.hashedUrl),t},h.createStateObject=function(e,t,n){var r={data:e,title:t,url:n};return r=h.normalizeState(r),r},h.getStateById=function(e){e=String(e);var n=h.idToState[e]||h.store.idToState[e]||t;return n},h.getStateString=function(e){var t,n,r;return t=h.normalizeState(e),n={data:t.data,title:e.title,url:e.url},r=l.stringify(n),r},h.getStateId=function(e){var t,n;return t=h.normalizeState(e),n=t.id,n},h.getHashByState=function(e){var t,n;return t=h.normalizeState(e),n=t.hash,n},h.extractId=function(e){var t,n,r,i;return e.indexOf("#")!=-1?i=e.split("#")[0]:i=e,n=/(.*)\&_suid=([0-9]+)$/.exec(i),r=n?n[1]||e:e,t=n?String(n[2]||""):"",t||!1},h.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t},h.extractState=function(e,t){var n=null,r,i;return t=t||!1,r=h.extractId(e),r&&(n=h.getStateById(r)),n||(i=h.getFullUrl(e),r=h.getIdByUrl(i)||!1,r&&(n=h.getStateById(r)),!n&&t&&!h.isTraditionalAnchor(e)&&(n=h.createStateObject(null,null,i))),n},h.getIdByUrl=function(e){var n=h.urlToId[e]||h.store.urlToId[e]||t;return n},h.getLastSavedState=function(){return h.savedStates[h.savedStates.length-1]||t},h.getLastStoredState=function(){return h.storedStates[h.storedStates.length-1]||t},h.hasUrlDuplicate=function(e){var t=!1,n;return n=h.extractState(e.url),t=n&&n.id!==e.id,t},h.storeState=function(e){return h.urlToId[e.url]=e.id,h.storedStates.push(h.cloneObject(e)),e},h.isLastSavedState=function(e){var t=!1,n,r,i;return h.savedStates.length&&(n=e.id,r=h.getLastSavedState(),i=r.id,t=n===i),t},h.saveState=function(e){return h.isLastSavedState(e)?!1:(h.savedStates.push(h.cloneObject(e)),!0)},h.getStateByIndex=function(e){var t=null;return typeof e=="undefined"?t=h.savedStates[h.savedStates.length-1]:e<0?t=h.savedStates[h.savedStates.length+e]:t=h.savedStates[e],t},h.getCurrentIndex=function(){var e=null;return h.savedStates.length<1?e=0:e=h.savedStates.length-1,e},h.getHash=function(e){var t=h.getLocationHref(e),n;return n=h.getHashByUrl(t),n},h.unescapeHash=function(e){var t=h.normalizeHash(e);return t=decodeURIComponent(t),t},h.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t},h.setHash=function(e,t){var n,i;return t!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.setHash,args:arguments,queue:t}),!1):(h.busy(!0),n=h.extractState(e,!0),n&&!h.emulated.pushState?h.pushState(n.data,n.title,n.url,!1):h.getHash()!==e&&(h.bugs.setHash?(i=h.getPageUrl(),h.pushState(null,null,i+"#"+e,!1)):r.location.hash=e),h)},h.escapeHash=function(t){var n=h.normalizeHash(t);return n=e.encodeURIComponent(n),h.bugs.hashEscape||(n=n.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),n},h.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return t=h.unescapeHash(t),t},h.setTitle=function(e){var t=e.title,n;t||(n=h.getStateByIndex(0),n&&n.url===e.url&&(t=n.title||h.options.initialTitle));try{r.getElementsByTagName("title")[0].innerHTML=t.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(i){}return r.title=t,h},h.queues=[],h.busy=function(e){typeof e!="undefined"?h.busy.flag=e:typeof h.busy.flag=="undefined"&&(h.busy.flag=!1);if(!h.busy.flag){u(h.busy.timeout);var t=function(){var e,n,r;if(h.busy.flag)return;for(e=h.queues.length-1;e>=0;--e){n=h.queues[e];if(n.length===0)continue;r=n.shift(),h.fireQueueItem(r),h.busy.timeout=o(t,h.options.busyDelay)}};h.busy.timeout=o(t,h.options.busyDelay)}return h.busy.flag},h.busy.flag=!1,h.fireQueueItem=function(e){return e.callback.apply(e.scope||h,e.args||[])},h.pushQueue=function(e){return h.queues[e.queue||0]=h.queues[e.queue||0]||[],h.queues[e.queue||0].push(e),h},h.queue=function(e,t){return typeof e=="function"&&(e={callback:e}),typeof t!="undefined"&&(e.queue=t),h.busy()?h.pushQueue(e):h.fireQueueItem(e),h},h.clearQueue=function(){return h.busy.flag=!1,h.queues=[],h},h.stateChanged=!1,h.doubleChecker=!1,h.doubleCheckComplete=function(){return h.stateChanged=!0,h.doubleCheckClear(),h},h.doubleCheckClear=function(){return h.doubleChecker&&(u(h.doubleChecker),h.doubleChecker=!1),h},h.doubleCheck=function(e){return h.stateChanged=!1,h.doubleCheckClear(),h.bugs.ieDoubleCheck&&(h.doubleChecker=o(function(){return h.doubleCheckClear(),h.stateChanged||e(),!0},h.options.doubleCheckInterval)),h},h.safariStatePoll=function(){var t=h.extractState(h.getLocationHref()),n;if(!h.isLastSavedState(t))return n=t,n||(n=h.createStateObject()),h.Adapter.trigger(e,"popstate"),h;return},h.back=function(e){return e!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.back,args:arguments,queue:e}),!1):(h.busy(!0),h.doubleCheck(function(){h.back(!1)}),p.go(-1),!0)},h.forward=function(e){return e!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.forward,args:arguments,queue:e}),!1):(h.busy(!0),h.doubleCheck(function(){h.forward(!1)}),p.go(1),!0)},h.go=function(e,t){var n;if(e>0)for(n=1;n<=e;++n)h.forward(t);else{if(!(e<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(n=-1;n>=e;--n)h.back(t)}return h};if(h.emulated.pushState){var v=function(){};h.pushState=h.pushState||v,h.replaceState=h.replaceState||v}else h.onPopState=function(t,n){var r=!1,i=!1,s,o;return h.doubleCheckComplete(),s=h.getHash(),s?(o=h.extractState(s||h.getLocationHref(),!0),o?h.replaceState(o.data,o.title,o.url,!1):(h.Adapter.trigger(e,"anchorchange"),h.busy(!1)),h.expectedStateId=!1,!1):(r=h.Adapter.extractEventData("state",t,n)||!1,r?i=h.getStateById(r):h.expectedStateId?i=h.getStateById(h.expectedStateId):i=h.extractState(h.getLocationHref()),i||(i=h.createStateObject(null,null,h.getLocationHref())),h.expectedStateId=!1,h.isLastSavedState(i)?(h.busy(!1),!1):(h.storeState(i),h.saveState(i),h.setTitle(i),h.Adapter.trigger(e,"statechange"),h.busy(!1),!0))},h.Adapter.bind(e,"popstate",h.onPopState),h.pushState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy())return h.pushQueue({scope:h,callback:h.pushState,args:arguments,queue:i}),!1;h.busy(!0);var s=h.createStateObject(t,n,r);return h.isLastSavedState(s)?h.busy(!1):(h.storeState(s),h.expectedStateId=s.id,p.pushState(s.id,s.title,s.url),h.Adapter.trigger(e,"popstate")),!0},h.replaceState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy())return h.pushQueue({scope:h,callback:h.replaceState,args:arguments,queue:i}),!1;h.busy(!0);var s=h.createStateObject(t,n,r);return h.isLastSavedState(s)?h.busy(!1):(h.storeState(s),h.expectedStateId=s.id,p.replaceState(s.id,s.title,s.url),h.Adapter.trigger(e,"popstate")),!0};if(s){try{h.store=l.parse(s.getItem("History.store"))||{}}catch(m){h.store={}}h.normalizeStore()}else h.store={},h.normalizeStore();h.Adapter.bind(e,"unload",h.clearAllIntervals),h.saveState(h.storeState(h.extractState(h.getLocationHref(),!0))),s&&(h.onUnload=function(){var e,t,n;try{e=l.parse(s.getItem("History.store"))||{}}catch(r){e={}}e.idToState=e.idToState||{},e.urlToId=e.urlToId||{},e.stateToId=e.stateToId||{};for(t in h.idToState){if(!h.idToState.hasOwnProperty(t))continue;e.idToState[t]=h.idToState[t]}for(t in h.urlToId){if(!h.urlToId.hasOwnProperty(t))continue;e.urlToId[t]=h.urlToId[t]}for(t in h.stateToId){if(!h.stateToId.hasOwnProperty(t))continue;e.stateToId[t]=h.stateToId[t]}h.store=e,h.normalizeStore(),n=l.stringify(e);try{s.setItem("History.store",n)}catch(i){if(i.code!==DOMException.QUOTA_EXCEEDED_ERR)throw i;s.length&&(s.removeItem("History.store"),s.setItem("History.store",n))}},h.intervalList.push(a(h.onUnload,h.options.storeInterval)),h.Adapter.bind(e,"beforeunload",h.onUnload),h.Adapter.bind(e,"unload",h.onUnload));if(!h.emulated.pushState){h.bugs.safariPoll&&h.intervalList.push(a(h.safariStatePoll,h.options.safariPollInterval));if(i.vendor==="Apple Computer, Inc."||(i.appCodeName||"")==="Mozilla")h.Adapter.bind(e,"hashchange",function(){h.Adapter.trigger(e,"popstate")}),h.getHash()&&h.Adapter.onDomLoad(function(){h.Adapter.trigger(e,"hashchange")})}},(!h.options||!h.options.delayInit)&&h.init()}(window),define("lib-app/history.min",function(){}),define("storymaps/common/Core",["lib-build/css!lib-app/bootstrap/css/bootstrap.min","lib-build/css!storymaps/common/ui/Modal.css","lib-build/css!./Core","lib-app/jquery","./utils/Polyfills","esri/map","esri/arcgis/Portal","esri/arcgis/utils","./utils/CommonHelper","esri/urlUtils","./builder/MyStoriesWrapper","dojo/has","esri/IdentityManager","esri/arcgis/OAuthInfo","esri/config","esri/tasks/GeometryService","esri/request","dojo/topic","dojo/on","dojo/_base/lang","dojo/_base/array","dojo/_base/kernel","dojo/Deferred","dojo/DeferredList","dojo/query","lib-app/jquery.fastClick","lib-app/bootstrap/js/bootstrap.min","lib-app/history.min"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N){function A(e,t){var n=!1,r=!1;console.log("common.core.Core - init",t),k=e,app.userCanEdit=!1,rt(),t!=null&&(n=L.fromScratch!=null||L.fromscratch!=null,r=L.fromGallery!=null),!a.browserSupportHistory()&&(n||r)&&L.ieredirected==null&&(window.location=document.location.protocol+"//"+document.location.host+document.location.pathname+"#"+document.location.search+"&ieredirected"),a.isArcGISHosted()?app.indexCfg={}:it()||(app.indexCfg={proxyurl:app.indexCfg.proxyurl,sharingurl:app.indexCfg.sharingurl,username:app.indexCfg.username,password:app.indexCfg.password,oAuthAppId:app.indexCfg.oAuthAppId}),L.sharinghost&&(app.indexCfg.sharingurl=L.sharinghost);if(!k.checkConfigFileIsOK()){q("invalidConfig");return}document.title=app.cfg.TPL_NAME,c("touch")&&$("body").addClass("hasTouch"),app.appCfg.noFastClick||(N.prototype._needsClick=N.prototype.needsClick,N.prototype.needsClick=function(e){return $(e).parents(".esriPopup").length?!0:N.prototype._needsClick.call(this,e)},N.attach(document.body)),window!=window.top&&$("body").addClass("isEmbed"),b.mixin(app,{map:null,maps:{},portal:null,builder:t,isDirectCreation:n,isGalleryCreation:r,isDirectCreationFirstSave:n,isLoading:!0,loadingTimeout:null,ui:{}}),app.appCfg.useStandardHeader&&require(["storymaps/common/ui/header/Desktop"],function(e){app.ui.headerDesktop=new e($("#headerDesktop"),app.isInBuilder)});if(!k.init(this))return;!it()&&app.indexCfg.username&&app.indexCfg.password&&y(h,"dialog-create",function(){y(h.dialog,"show",function(){h.dialog.txtUser_.set("value",app.indexCfg.username),h.dialog.txtPwd_.set("value",app.indexCfg.password),h.dialog.btnSubmit_.onClick()})}),et();if(!app.indexCfg.sharingurl){var i=document.location.pathname.indexOf("/apps/");i==-1&&(i=document.location.pathname.indexOf("/home/"));if(i!=-1){var s=location.pathname.substr(0,i);app.indexCfg.sharingurl="//"+location.host+s+"/sharing/rest/content/items",app.indexCfg.proxyurl="//"+location.host+s+"/sharing/proxy"}else app.indexCfg.sharingurl=app.cfg.DEFAULT_SHARING_URL}L.sharinghost&&(app.indexCfg.sharingurl=L.sharinghost),app.indexCfg.sharingurl.match(/^http/)?u.arcgisUrl=app.indexCfg.sharingurl:u.arcgisUrl=location.protocol+app.indexCfg.sharingurl,app.indexCfg.proxyurl||(app.indexCfg.proxyurl=app.cfg.DEFAULT_PROXY_URL),d.defaults.io.proxyUrl=location.protocol+app.indexCfg.proxyurl,h&&h.setProtocolErrorHandler(function(){return!0}),app.isInBuilder&&app.cfg.CORS_SERVER&&$.each(app.cfg.CORS_SERVER,function(e,t){d.defaults.io.corsEnabledServers.push(t)}),app.cfg.PROXY_RULES&&app.cfg.PROXY_RULES.length&&$.each(app.cfg.PROXY_RULES,function(e,t){t&&t.urlPrefix&&t.proxyUrl&&f.addProxyRule(t)}),d.defaults.io.timeout=app.isInBuilder?app.cfg.TIMEOUT_BUILDER_REQUEST:app.cfg.TIMEOUT_VIEWER_REQUEST,$.fn.modal.Constructor.prototype.enforceFocus=function(){},k.initLocalization(),$(window).resize(V),$("form").bind("keydown",function(e){if(e.keyCode==13)return!1}),y(h,"dialog-create",K),g.subscribe("CORE_UPDATE_UI",W),g.subscribe("CORE_RESIZE",V),g.subscribe("CORE_UPDATE_EXTENT",U),app.portal=new o.Portal(app.indexCfg.sharingurl.split("/sharing/")[0]),app.portal.on("load",function(e){app.isPortal=!!e.isPortal,st(),h.checkSignInStatus(app.portal.portalUrl);if(app.indexCfg.oAuthAppId){var n=new p({appId:app.indexCfg.oAuthAppId,popup:!1,portalUrl:"https:"+app.indexCfg.sharingurl.split("/sharing/")[0]});h.registerOAuthInfos([n]),h.checkSignInStatus(n.portalUrl).then(function(){t?D().then(O):D().then(O)},function(){t?D().then(O):O()})}else O()})}function O(){console.log("common.core.Core - initStep2");var e=a.getAppID(it()),t=a.getWebmapID(it()),n=app.appCfg?!!app.appCfg.supportWebmapPreviewAGOL:!0;if(e){M(e);return}var r=a.getUrlParams().insights;if(app.isDirectCreation&&r){if(!r.match(/^[a-fA-F0-9]{32}$/)){q("appLoadingFail");return}D().then(function(){j(),app.isInitializing=!1,app.data.setStoryStorage("WEBAPP"),u.getItem(r).then(function(e){if(!e){q("appLoadingFail");return}var t=e.item;if(!t.url){q("appLoadingFail");return}app.data.getWebAppData().setTitle(t.title+" - story");var n=location.protocol+app.indexCfg.sharingurl.split("/sharing/")[0]+"/apps/insights/#/embed/"+r;app.data.addStorySection({title:t.title,creaDate:Date.now(),status:"PUBLISHED",media:{type:"webpage",webpage:{url:n,display:"stretch",unload:!1}},description:t.description}),app.data.getWebAppData().setLayout({id:"tab"}),app.data.getWebAppData().setLayoutOptions({description:!0,legend:"panel",panel:{position:"right",size:"medium"},panelMapOverlap:!1}),app.data.setCurrentSectionIndex(0),g.publish("story-update-entries"),g.publish("BUILDER_INCREMENT_COUNTER",1),F(),g.publish("CORE_UPDATE_UI"),I()},function(){q("appLoadingFail")})});return}var i=a.getUrlParams().webmap;if(app.isDirectCreation&&(t||i)){D().then(function(){j(),a.getUrlParams().source=="opendata"&&(app.isDirectCreationOpenData=!0),app.isInitializing=!1,app.data.setStoryStorage("WEBAPP");var e=(t||i).split(","),n=[];$.each(e,function(e,t){if(!t.match(/^[a-fA-F0-9]{32}$/))return;if(app.data.getStoryLength()>=app.cfg.MAX_NB_ENTRIES)return;var r={title:"",creaDate:Date.now(),status:"PUBLISHED",media:{type:"webmap",webmap:{id:t,extent:null,layers:null,popup:null,legend:{enable:!1,openByDefault:!1}}},description:""};n.push(r),app.data.addStorySection(r)}),app.data.getWebAppData().setLayout({id:"tab"}),app.data.getWebAppData().setDefaultLayoutOptions(),app.data.getWebAppData().setMapOptions({mapsSync:!1});var r=0,s=n.length,o=g.subscribe("story-loaded-map",function(e){if(!app.maps[e.id])console.log("Could not load web map with id:",e.id),s--;else{var t=app.maps[e.id].response.itemInfo.item;$.each(n,function(n,i){i.media.webmap.id==e.id&&(n===0&&app.data.getWebAppData().setTitle(t.title),i.title=t.title,i.description=t.description,app.data.editSection(n,i),r++)})}r==s&&(o.remove(),F(),g.publish("CORE_UPDATE_UI"),g.publish("story-update-entries"),I())});app.data.setCurrentSectionIndex(0),g.publish("story-update-entries"),g.publish("BUILDER_INCREMENT_COUNTER",1),app.ui.mainStage.preloadAllMaps(!0)});return}if(t&&!n){a.isArcGISHosted()?B():P(t);return}if(app.isDirectCreation&&it()&&a.isArcGISHosted()&&!a.getPortalUser()&&!app.portal.getPortalUser()){Y();return}if(app.isDirectCreation){D().then(function(){j(),k.startFromScratch(),F()});return}a.isArcGISHosted()?B():L.appid&&(!app.indexCfg.authorizedOwners||!app.indexCfg.authorizedOwners[0])?q("unspecifiedConfigOwner"):app.isProduction?q("invalidConfigNoApp"):q("invalidConfigNoAppDev")}function M(e){console.log("common.core.Core - loadWebMappingApp - appId:",e);var t=L.forceLogin!==undefined;t||app.isInBuilder?D().then(function(){_(e)},function(){q("notAuthorized")}):_(e)}function _(e){u.getItem(e).then(function(e){if(!e){q("appLoadingFail");return}var t=e.item,n=e.itemData;app.data.setWebAppItem(t),app.data.getWebAppData().set(n),app.userCanEdit=app.data.userIsAppOwner();if(app.indexCfg.authorizedOwners&&app.indexCfg.authorizedOwners.length>0&&app.indexCfg.authorizedOwners[0]){var r=t.owner,i=!1;r&&(i=$.inArray(r,app.indexCfg.authorizedOwners)!=-1),!i&&app.indexCfg.authorizedOwners[0]=="*"&&(i=!0),i||$.each(app.indexCfg.authorizedOwners,function(e,n){var r=n.match(/^\[(.*)\]$/);r&&t.orgId==r[1]&&(i=!0)});if(!i){q("invalidConfigOwner");return}}if(t&&t.appProxies){var s=w.map(t.appProxies,function(e){return{url:e.sourceUrl,mixin:{url:e.proxyUrl}}});app.data.setAppProxies(s)}if(app.isInBuilder&&it()&&!app.userCanEdit){q("notAuthorized");return}k.webAppConfigLoaded();var o=app.appCfg?!!app.appCfg.useWebmapInApp:!0,u=app.data.getWebAppData().getWebmap()||a.getWebmapID(it());u&&o&&app.data.getWebAppData().isBlank()||app.isGalleryCreation?(k.startFromScratch(),j()):u&&o?P(u):!o||!u&&o?(j(),k.loadWebmapFromData()):a.getPortalUser()||!it()&&app.data.getWebAppData().isBlank()?Z():app.data.getWebAppData().isBlank()?q("appLoadingFail"):P(app.data.getWebAppData().getViews()[0].cfg.webmap.id)},function(e){e&&e.httpCode==400?q("invalidApp"):e&&e.httpCode==403?q("notAuthorized"):q("appLoadingFail")})}function D(){var e=new S;return y(h,"dialog-create",Q),app.portal.signIn().then(function(){if(app.isInBuilder&&!app.data.checkUserItemPrivileges()){q("notAuthorizedBuilder");return}app.userCanEdit=app.data.userIsAppOwner(),st(),e.resolve()},function(){e.reject()}),e}function P(e){k.loadFirstWebmap(e).then(b.hitch(this,function(e){H(e)}),b.hitch(this,function(){q("createMap")}))}function H(e){console.log("common.core.Core - webMapInitCallback"),app.maps[e.itemInfo.item.id]=k.getMapConfig(e),app.map=e.map,app.data.setWebMap(e.itemInfo),app.map.disableKeyboardNavigation(),j(),k.firstWebmapLoaded()}function B(){window.location=app.isPortal&&app.cfg.HELP_URL_PORTAL?app.cfg.HELP_URL_PORTAL:app.cfg.HELP_URL}function j(){var e=app.indexCfg.title||app.data.getWebAppData().getTitle(),t=app.indexCfg.subtitle||app.data.getWebAppData().getSubtitle(),n=app.data.getWebAppData().getColors();app.ui.headerDesktop&&app.ui.headerDesktop.init(!app.isInBuilder&&(app.cfg.EMBED||L.embed||L.embed===""),e,t,X(),n,J(),app.appCfg.headerCompactByDefault),app.appCfg.useAppTitleAsPageTitle&&(document.title=e?$("<div>"+e+"</div>").text():app.cfg.TPL_NAME)}function F(){console.log("common.core.Core - initApp"),V(),location.hash&&a.browserSupportHistory()&&(location.hash="map"),window.onhashchange=function(){k.prepareMobileViewSwitch(),k.onHashChange()},k.appInitComplete(),app.builder&&app.builder.appInitComplete();var e=L.preview==="true"||L.preview==="",t=L.autoplay==="true"||L.autoplay==="";(app.isInBuilder||app.userCanEdit)&&c("ie")!=9&&!e&&!t&&(c("ff")&&$(".builderShare #my-stories-frame").remove(),(c("ff")||!app.isInBuilder)&&$("body").append('<div id="my-stories-hidden-container"><iframe id="my-stories-frame"></iframe></div>'),l.loadMyStories()),document.location.pathname.match(/\/apps\/[a-zA-Z]+\/$/)&&document.location.search.match(/^\?appid=/)&&(!c("ie")||c("ie")>=10)&&History.replaceState({},"","index.html"+document.location.search+document.location.hash);var n=document.location.search;n&&(n=n.replace("&preview",""),n!=document.location.search&&window.history.replaceState({},"","index.html"+n+document.location.hash))}function I(){app.isLoading=!1,$("#headerDesktop").removeAttr("aria-hidden"),$("#loadingIndicator, #loadingMessage").addClass("fadeOut").fadeOut(400),$("#loadingOverlay").fadeOut(800)}function q(e,t,n){var r=i18n.viewer.errors[e];tt(),$("#loadingIndicator").hide(),r=r.replace(/%TPL_NAME%/g,app.cfg.TPL_NAME),e=="notAuthorized"&&app.indexCfg.oAuthAppId&&(r+='<div><button class="btn btn-sm btn-default" onclick="esri.id.destroyCredentials(); window.location.reload();">'+i18n.viewer.errors.signOut+"</button></div>"),e=="appLoadingFail"?$("#loadingMessage").html('<div id="loadingRetry"> <button type="button" class="btn btn-naked btn-sm" onclick="document.location.reload()">'+i18n.viewer.loading.failButton+" </button>"+"</div>").hide().fadeIn(1200,function(){$("#loadingMessage").addClass("loaded")}):$("#loadingMessage").hide(),c("ie")==8&&($("#fatalError-icon").css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='_resources/icons/warning-icon.png', sizingMethod='scale')",backgroundPosition:"2px 3px",width:78}),$("#fatalError-msg").css({paddingLeft:5})),$("#fatalError .error-msg").html(r),n||$("#fatalError").show()}function R(e){$("#fatalError .error-msg").html(i18n.viewer.errors[e])}function U(e,t){t=t||app.map;if(!e||!e.spatialReference||!t||!t.extent.spatialReference||!t.spatialReference){var n=new S;return n.resolve(),n}var r=app.appCfg.mapExtentFit?app.appCfg.mapExtentFit:!1;if(t.spatialReference.wkid==e.spatialReference.wkid)return t.setExtent(k.getLayoutExtent(e,!1),r);var i=new S;return d.defaults.geometryService.project([e],t.spatialReference,function(e){if(!e||!e[0])return;t.setExtent(k.getLayoutExtent(e[0],!1),r),i.resolve()}),i}function z(e,t){e?app.map.spatialReference.wkid!=102100&&app.map.spatialReference.wkid!=4326?d.defaults.geometryService.project([t],app.map.spatialReference,function(e){if(!e||!e[0])return;app.map.extent.contains(e[0])||app.map.centerAt(e[0])}):app.map.extent.contains(t)||app.map.centerAt(t):($(".mainMediaContainer.active .mapLocationMsg").html(i18n.viewer.locatorFromCommon.error),$(".mainMediaContainer.active .mapLocationError").fadeIn(),setTimeout(function(){$(".mainMediaContainer.active .mapLocationError").fadeOut()},5e3))}function W(){console.log("common.core.Core - updateUI");var e=app.data.getWebAppData().getColors();app.ui.headerDesktop&&(app.ui.headerDesktop.setTitleAndSubtitle(app.data.getWebAppData().getTitle()||(app.data.getWebMap()?app.data.getWebMap().item.title:""),app.data.getWebAppData().getSubtitle()||(app.data.getWebMap()?app.data.getWebMap().item.snippet:"")),app.ui.headerDesktop.update(X(),e,app.appCfg.headerCompactByDefault)),k.updateUI(),V()}function X(e){return{logoURL:app.data.getWebAppData().getLogoURL(e&&e.useMobileLogo),logoTarget:app.data.getWebAppData().getLogoTarget(),linkText:app.data.getWebAppData().getHeaderLinkText(),linkURL:app.data.getWebAppData().getHeaderLinkURL(),socialBtn:app.data.getWebAppData().getSocial(),compactSize:app.data.getWebAppData().getHeaderCompactSize()}}function V(){var e=$("body").width(),t=$("body").height(),n=0,r=0,i=L.forceDesktop!==undefined||app.indexCfg.forceDesktop,s=L.forceMobile!==undefined||app.indexCfg.forceMobile,o=e<=768||s,u=$(".centerLink").length?$(".centerLink").hasClass("current"):!0;i&&(o=!1),o?$("body").addClass("mobile-view"):$("body").removeClass("mobile-view"),$(".mainViewAboveMap, .mainViewBelowMap").each(function(e,t){var r=$(t);n+=r.is(":visible")?r.outerHeight():0}),$(".mainViewSideMap").each(function(e,t){var n=$(t);r+=n.is(":visible")?n.outerWidth():0}),app.ui.headerDesktop&&app.ui.headerDesktop.resize(e),app.initScreenIsOpen&&($("#header").css("display",o?"none":"block"),$("#fatalError").css("display",o?"block":"none")),app.initScreenIsOpen||$("#contentPanel").height(t-n),k.resize({isMobileView:o,isOnMobileMapView:u,width:e,height:t-n}),app.isInBuilder&&app.builder.resize({isMobileView:o});if(app.map&&(!o||o&&u))try{app.map.resize(!!app.appCfg.mapsImmediateResize)}catch(a){}o?$(".mapContainer .esriControlsBR > div").first().removeClass("logo-med").addClass("logo-sm"):$(".mapContainer .esriControlsBR > div").first().removeClass("logo-sm").addClass("logo-med")}function J(){return!app.isInBuilder&&(!it()&&!!a.getAppID(it())||it()&&app.userCanEdit)&&(L.autoplay===undefined||L.autoplay=="false")&&(L.preview===undefined||L.preview=="false")}function K(){$(".esriSignInDialog td label").siblings("br").css("display","none"),$(".esriSignInDialog .dijitDialogPaneContentArea div:nth(1)").css("display","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("padding","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("margin-bottom","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("border","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-webkit-border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-moz-border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-webkit-box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-moz-box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitValidationContainer").css("display","none"),$(".esriSignInDialog .esriErrorMsg").css("margin-top","10px"),$(".esriSignInDialog").find(".dijitDialogTitleBar").find(".dijitDialogTitle").first().html(i18n.viewer.signin.title),h._arcgisUrl&&($(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().css("display","none"),$(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().after("<div id='dijitDialogPaneContentAreaLoginText'>"+i18n.viewer.signin.explainViewer.replace("%PORTAL_LINK%","<a href='http://"+h._arcgisUrl+"' title='"+h._arcgisUrl+"' target='_blank'>"+h._arcgisUrl+"</a>")+"</div>"))}function Q(){h._arcgisUrl&&$(".esriSignInDialog").find("#dijitDialogPaneContentAreaLoginText").html(i18n.viewer.signin.explainBuilder.replace("%PORTAL_LINK%","<a href='http://"+h._arcgisUrl+"' title='"+h._arcgisUrl+"' target='_blank'>"+h._arcgisUrl+"</a>"))}function G(){$("#header").css("display","inherit"),$(".mobileView").css("display","inherit"),$("#fatalError").css("display","none"),$("#loadingOverlay").css("top","0px"),et(),V()}function Y(){window.location=u.arcgisUrl.split("/sharing/")[0]+"/home/signin.html?returnUrl="+encodeURIComponent(document.location.href)}function Z(){window.location=document.location.href+"&fromGallery"}function et(){app.loadingTimeout=setTimeout(nt,app.cfg.TIMEOUT_VIEWER_LOAD)}function tt(){typeof app!="undefined"&&app.loadingTimeout&&(clearTimeout(app.loadingTimeout),app.loadingTimeout=null)}function nt(){if(h&&h.dialog&&h.dialog._alreadyInitialized&&!h.loadingTimeoutAlreadyFired){clearTimeout(app.loadingTimeout),et(),h._busy||(h.loadingTimeoutAlreadyFired=!0);return}$("#loadingMessage").html('<div class="mainMessage">'+i18n.viewer.loading.long+"<br />"+i18n.viewer.loading.long2+"</div>").fadeIn("slow",function(){$("#loadingMessage").addClass("loaded")})}function rt(){document.documentElement.lang=E.locale,T("#fatalError .error-title")[0].innerHTML=i18n.viewer.errors.boxTitle}function it(){return C.environment!=["TPL","ENV","DEV"].join("_")}function st(){console.log("common.core.Core - parsePortalConfig");if(!app.portal)return;if(app.data.getWebAppData().getAppGeocoders){var e=app.data.getWebAppData().getAppGeocoders(),t=e?e.map(function(e){return e.url}):[],n=[];app.cfg.HELPER_SERVICES.geocode&&app.cfg.HELPER_SERVICES.geocode.length&&($.each(app.portal.helperServices.geocode,function(e,r){r.url&&t.indexOf(r.url)<0&&n.push(r)}),app.cfg.HELPER_SERVICES.geocode=n)}var r;app.cfg.HELPER_SERVICES.geometry&&app.cfg.HELPER_SERVICES.geometry.url?r=app.cfg.HELPER_SERVICES.geometry.url:app.portal.helperServices.geometry&&app.portal.helperServices.geometry.url&&(r=app.portal.helperServices.geometry.url),d.defaults.geometryService=new v(r),!app.cfg.BING_MAPS_KEY&&app.portal.bingKey&&(app.cfg.BING_MAPS_KEY=app.portal.bingKey),app.portal.isPortal&&app.cfg&&app.cfg.AUTHORIZED_IMPORT_SOURCE&&(app.cfg.AUTHORIZED_IMPORT_SOURCE.featureService=!1),app.isPortal=!!app.portal.isPortal;if(app.isPortal&&app.portal.helpBase&&app.portal.portalHostname&&!app.cfg.HELP_URL_PORTAL.match("^//")){var i=app.portal.portalHostname.split("/")[0];app.cfg.HELP_URL_PORTAL="//"+i+app.portal.helpBase+app.cfg.HELP_URL_PORTAL}}function ot(){var e="notConfiguredMobile";tt(),app.isInitializing=!0,app.initScreenIsOpen=!0,c("touch")&&a.isMobile()&&(window.innerHeight>window.innerWidth?window.innerHeight>768&&(e="notConfiguredMobile2"):window.innerWidth>768&&(e="notConfiguredMobile2")),q(e,null,!0),setTimeout(V,50)}function ut(){$("#initPopup").modal("hide"),app.initScreenIsOpen=!1}function at(){R("notConfiguredDesktop"),$("#loadingOverlay").css("top","0px"),$("#header").css("display","inherit"),$("#fatalError").css("display","block"),app.initScreenIsOpen=!1,V()}var C={environment:"TPL_ENV_PRODUCTION"},k=null,L=a.getUrlParams();return i.apply(),{init:A,isProd:it,appInitComplete:F,displayApp:I,loadWebMap:P,handleWindowResize:V,hasSwitchBuilderButton:J,initPopupPrepare:ot,initPopupComplete:ut,initPopupFail:at,setMapExtent:U,zoomToDeviceLocation:z,getHeaderUserCfg:X,cleanLoadingTimeout:tt,initError:q,prepareAppForWebmapReload:G,replaceInitErrorMessage:R,portalLogin:D}}),define("lib-build/css!storymaps/common/ui/header/Desktop",[],function(){}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),function(){function e(e,t,n){n=(n||0)-1;for(var r=e?e.length:0;++n<r;)if(e[n]===t)return n;return-1}function t(t,n){var r=typeof n;if(t=t.l,"boolean"==r||null==n)return t[n]?0:-1;"number"!=r&&"string"!=r&&(r="object");var i="number"==r?n:g+n;return t=(t=t[r])&&t[i],"object"==r?t&&-1<e(t,n)?0:-1:t?0:-1}function n(e){var t=this.l,n=typeof e;if("boolean"==n||null==e)t[e]=!0;else{"number"!=n&&"string"!=n&&(n="object");var r="number"==n?e:g+e,t=t[n]||(t[n]={});"object"==n?(t[r]||(t[r]=[])).push(e):t[r]=!0}}function r(e){return e.charCodeAt(0)}function i(e,t){for(var n=e.m,r=t.m,i=-1,s=n.length;++i<s;){var o=n[i],u=r[i];if(o!==u){if(o>u||typeof o=="undefined")return 1;if(o<u||typeof u=="undefined")return-1}}return e.n-t.n}function s(e){var t=-1,r=e.length,i=e[0],s=e[r/2|0],o=e[r-1];if(i&&typeof i=="object"&&s&&typeof s=="object"&&o&&typeof o=="object")return!1;for(i=a(),i["false"]=i["null"]=i["true"]=i.undefined=!1,s=a(),s.k=e,s.l=i,s.push=n;++t<r;)s.push(e[t]);return s}function o(e){return"\\"+V[e]}function u(){return d.pop()||[]}function a(){return v.pop()||{k:null,l:null,m:null,"false":!1,n:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,"undefined":!1,o:null}}function f(e){e.length=0,d.length<b&&d.push(e)}function l(e){var t=e.l;t&&l(t),e.k=e.l=e.m=e.object=e.number=e.string=e.o=null,v.length<b&&v.push(e)}function c(e,t,n){t||(t=0),typeof n=="undefined"&&(n=e?e.length:0);var r=-1;n=n-t||0;for(var i=Array(0>n?0:n);++r<n;)i[r]=e[t+r];return i}function h(n){function d(e,t,n){if(!e||!X[typeof e])return e;t=t&&typeof n=="undefined"?t:tt(t,n,3);for(var r=-1,i=X[typeof e]&&jn(e),s=i?i.length:0;++r<s&&(n=i[r],!1!==t(e[n],n,e)););return e}function v(e,t,n){var r;if(!e||!X[typeof e])return e;t=t&&typeof n=="undefined"?t:tt(t,n,3);for(r in e)if(!1===t(e[r],r,e))break;return e}function b(e,t,n){var r,i=e,s=i;if(!i)return s;for(var o=arguments,u=0,a=typeof n=="number"?2:o.length;++u<a;)if((i=o[u])&&X[typeof i])for(var f=-1,l=X[typeof i]&&jn(i),c=l?l.length:0;++f<c;)r=l[f],"undefined"==typeof s[r]&&(s[r]=i[r]);return s}function V(e,t,n){var r,i=e,s=i;if(!i)return s;var o=arguments,u=0,a=typeof n=="number"?2:o.length;if(3<a&&"function"==typeof o[a-2])var f=tt(o[--a-1],o[a--],2);else 2<a&&"function"==typeof o[a-1]&&(f=o[--a]);for(;++u<a;)if((i=o[u])&&X[typeof i])for(var l=-1,c=X[typeof i]&&jn(i),h=c?c.length:0;++l<h;)r=c[l],s[r]=f?f(s[r],i[r]):i[r];return s}function J(e){var t,n=[];if(!e||!X[typeof e])return n;for(t in e)yn.call(e,t)&&n.push(t);return n}function K(e){return e&&typeof e=="object"&&!Bn(e)&&yn.call(e,"__wrapped__")?e:new Q(e)}function Q(e,t){this.__chain__=!!t,this.__wrapped__=e}function G(e){function t(){if(r){var e=c(r);bn.apply(e,arguments)}if(this instanceof t){var s=et(n.prototype),e=n.apply(s,e||arguments);return Et(e)?e:s}return n.apply(i,e||arguments)}var n=e[0],r=e[2],i=e[4];return Hn(t,e),t}function Z(e,t,n,r,i){if(n){var s=n(e);if(typeof s!="undefined")return s}if(!Et(e))return e;var o=cn.call(e);if(!U[o])return e;var a=Dn[o];switch(o){case H:case B:return new a(+e);case F:case R:return new a(e);case q:return s=a(e.source,N.exec(e)),s.lastIndex=e.lastIndex,s}if(o=Bn(e),t){var l=!r;r||(r=u()),i||(i=u());for(var h=r.length;h--;)if(r[h]==e)return i[h];s=o?a(e.length):{}}else s=o?c(e):V({},e);return o&&(yn.call(e,"index")&&(s.index=e.index),yn.call(e,"input")&&(s.input=e.input)),t?(r.push(e),i.push(s),(o?At:d)(e,function(e,o){s[o]=Z(e,t,n,r,i)}),l&&(f(r),f(i)),s):s}function et(e){return Et(e)?Tn(e):{}}function tt(e,t,n){if(typeof e!="function")return Vt;if(typeof t!="undefined"&&"prototype"in e){var r=e.__bindData__;if(typeof r=="undefined"&&(Pn.funcNames&&(r=!e.name),r=r||!Pn.funcDecomp,!r)){var i=mn.call(e);Pn.funcNames||(r=!C.test(i)),r||(r=O.test(i),Hn(e,r))}if(!1===r||!0!==r&&1&r[1])return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return Wt(e,t)}return e}function nt(e){function t(){var e=a?o:this;if(i){var d=c(i);bn.apply(d,arguments)}return(s||l)&&(d||(d=c(arguments)),s&&bn.apply(d,s),l&&d.length<u)?(r|=16,nt([n,h?r:-4&r,d,null,o,u])):(d||(d=arguments),f&&(n=e[p]),this instanceof t?(e=et(n.prototype),d=n.apply(e,d),Et(d)?d:e):n.apply(e,d))}var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],u=e[5],a=1&r,f=2&r,l=4&r,h=8&r,p=n;return Hn(t,e),t}function rt(n,r){var i=-1,o=ht(),u=n?n.length:0,a=u>=y&&o===e,f=[];if(a){var c=s(r);c?(o=t,r=c):a=!1}for(;++i<u;)c=n[i],0>o(r,c)&&f.push(c);return a&&l(r),f}function it(e,t,n,r){r=(r||0)-1;for(var i=e?e.length:0,s=[];++r<i;){var o=e[r];if(o&&typeof o=="object"&&typeof o.length=="number"&&(Bn(o)||mt(o))){t||(o=it(o,t,n));var u=-1,a=o.length,f=s.length;for(s.length+=a;++u<a;)s[f++]=o[u]}else n||s.push(o)}return s}function st(e,t,n,r,i,s){if(n){var o=n(e,t);if(typeof o!="undefined")return!!o}if(e===t)return 0!==e||1/e==1/t;if(e===e&&!(e&&X[typeof e]||t&&X[typeof t]))return!1;if(null==e||null==t)return e===t;var a=cn.call(e),l=cn.call(t);if(a==D&&(a=I),l==D&&(l=I),a!=l)return!1;switch(a){case H:case B:return+e==+t;case F:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case q:case R:return e==on(t)}if(l=a==P,!l){var c=yn.call(e,"__wrapped__"),h=yn.call(t,"__wrapped__");if(c||h)return st(c?e.__wrapped__:e,h?t.__wrapped__:t,n,r,i,s);if(a!=I)return!1;if(a=e.constructor,c=t.constructor,a!=c&&!(wt(a)&&a instanceof a&&wt(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}for(a=!i,i||(i=u()),s||(s=u()),c=i.length;c--;)if(i[c]==e)return s[c]==t;var p=0,o=!0;if(i.push(e),s.push(t),l){if(c=e.length,p=t.length,(o=p==c)||r)for(;p--;)if(l=c,h=t[p],r)for(;l--&&!(o=st(e[l],h,n,r,i,s)););else if(!(o=st(e[p],h,n,r,i,s)))break}else v(t,function(t,u,a){return yn.call(a,u)?(p++,o=yn.call(e,u)&&st(e[u],t,n,r,i,s)):void 0}),o&&!r&&v(e,function(e,t,n){return yn.call(n,t)?o=-1<--p:void 0});return i.pop(),s.pop(),a&&(f(i),f(s)),o}function ot(e,t,n,r,i){(Bn(t)?At:d)(t,function(t,s){var o,u,a=t,f=e[s];if(t&&((u=Bn(t))||Un(t))){for(a=r.length;a--;)if(o=r[a]==t){f=i[a];break}if(!o){var l;n&&(a=n(f,t),l=typeof a!="undefined")&&(f=a),l||(f=u?Bn(f)?f:[]:Un(f)?f:{}),r.push(t),i.push(f),l||ot(f,t,n,r,i)}}else n&&(a=n(f,t),typeof a=="undefined"&&(a=t)),typeof a!="undefined"&&(f=a);e[s]=f})}function ut(e,t){return e+vn(_n()*(t-e+1))}function at(n,r,i){var o=-1,a=ht(),c=n?n.length:0,h=[],p=!r&&c>=y&&a===e,d=i||p?u():h;for(p&&(d=s(d),a=t);++o<c;){var v=n[o],m=i?i(v,o,n):v;(r?!o||d[d.length-1]!==m:0>a(d,m))&&((i||p)&&d.push(m),h.push(v))}return p?(f(d.k),l(d)):i&&f(d),h}function ft(e){return function(t,n,r){var i={};n=K.createCallback(n,r,3),r=-1;var s=t?t.length:0;if(typeof s=="number")for(;++r<s;){var o=t[r];e(i,o,n(o,r,t),t)}else d(t,function(t,r,s){e(i,t,n(t,r,s),s)});return i}}function lt(e,t,n,r,i,s){var o=1&t,u=4&t,a=16&t,f=32&t;if(!(2&t||wt(e)))throw new un;a&&!n.length&&(t&=-17,a=n=!1),f&&!r.length&&(t&=-33,f=r=!1);var l=e&&e.__bindData__;return l&&!0!==l?(l=c(l),l[2]&&(l[2]=c(l[2])),l[3]&&(l[3]=c(l[3])),!o||1&l[1]||(l[4]=i),!o&&1&l[1]&&(t|=8),!u||4&l[1]||(l[5]=s),a&&bn.apply(l[2]||(l[2]=[]),n),f&&Sn.apply(l[3]||(l[3]=[]),r),l[1]|=t,lt.apply(null,l)):(1==t||17===t?G:nt)([e,t,n,r,i,s])}function ct(e){return Fn[e]}function ht(){var t=(t=K.indexOf)===Ft?e:t;return t}function pt(e){return typeof e=="function"&&hn.test(e)}function dt(e){var t,n;return e&&cn.call(e)==I&&(t=e.constructor,!wt(t)||t instanceof t)?(v(e,function(e,t){n=t}),typeof n=="undefined"||yn.call(e,n)):!1}function vt(e){return In[e]}function mt(e){return e&&typeof e=="object"&&typeof e.length=="number"&&cn.call(e)==D||!1}function gt(e,t,n){var r=jn(e),i=r.length;for(t=tt(t,n,3);i--&&(n=r[i],!1!==t(e[n],n,e)););return e}function yt(e){var t=[];return v(e,function(e,n){wt(e)&&t.push(n)}),t.sort()}function bt(e){for(var t=-1,n=jn(e),r=n.length,i={};++t<r;){var s=n[t];i[e[s]]=s}return i}function wt(e){return typeof e=="function"}function Et(e){return!!e&&!!X[typeof e]}function St(e){return typeof e=="number"||e&&typeof e=="object"&&cn.call(e)==F||!1}function xt(e){return typeof e=="string"||e&&typeof e=="object"&&cn.call(e)==R||!1}function Tt(e){for(var t=-1,n=jn(e),r=n.length,i=Gt(r);++t<r;)i[t]=e[n[t]];return i}function Nt(e,t,n){var r=-1,i=ht(),s=e?e.length:0,o=!1;return n=(0>n?An(0,s+n):n)||0,Bn(e)?o=-1<i(e,t,n):typeof s=="number"?o=-1<(xt(e)?e.indexOf(t,n):i(e,t,n)):d(e,function(e){return++r<n?void 0:!(o=e===t)}),o}function Ct(e,t,n){var r=!0;t=K.createCallback(t,n,3),n=-1;var i=e?e.length:0;if(typeof i=="number")for(;++n<i&&(r=!!t(e[n],n,e)););else d(e,function(e,n,i){return r=!!t(e,n,i)});return r}function kt(e,t,n){var r=[];t=K.createCallback(t,n,3),n=-1;var i=e?e.length:0;if(typeof i=="number")for(;++n<i;){var s=e[n];t(s,n,e)&&r.push(s)}else d(e,function(e,n,i){t(e,n,i)&&r.push(e)});return r}function Lt(e,t,n){t=K.createCallback(t,n,3),n=-1;var r=e?e.length:0;if(typeof r!="number"){var i;return d(e,function(e,n,r){return t(e,n,r)?(i=e,!1):void 0}),i}for(;++n<r;){var s=e[n];if(t(s,n,e))return s}}function At(e,t,n){var r=-1,i=e?e.length:0;if(t=t&&typeof n=="undefined"?t:tt(t,n,3),typeof i=="number")for(;++r<i&&!1!==t(e[r],r,e););else d(e,t);return e}function Ot(e,t,n){var r=e?e.length:0;if(t=t&&typeof n=="undefined"?t:tt(t,n,3),typeof r=="number")for(;r--&&!1!==t(e[r],r,e););else{var i=jn(e),r=i.length;d(e,function(e,n,s){return n=i?i[--r]:--r,t(s[n],n,s)})}return e}function Mt(e,t,n){var r=-1,i=e?e.length:0;if(t=K.createCallback(t,n,3),typeof i=="number")for(var s=Gt(i);++r<i;)s[r]=t(e[r],r,e);else s=[],d(e,function(e,n,i){s[++r]=t(e,n,i)});return s}function _t(e,t,n){var i=-1/0,s=i;if(typeof t!="function"&&n&&n[t]===e&&(t=null),null==t&&Bn(e)){n=-1;for(var o=e.length;++n<o;){var u=e[n];u>s&&(s=u)}}else t=null==t&&xt(e)?r:K.createCallback(t,n,3),At(e,function(e,n,r){n=t(e,n,r),n>i&&(i=n,s=e)});return s}function Dt(e,t,n,r){if(!e)return n;var i=3>arguments.length;t=K.createCallback(t,r,4);var s=-1,o=e.length;if(typeof o=="number")for(i&&(n=e[++s]);++s<o;)n=t(n,e[s],s,e);else d(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)});return n}function Pt(e,t,n,r){var i=3>arguments.length;return t=K.createCallback(t,r,4),Ot(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)}),n}function Ht(e){var t=-1,n=e?e.length:0,r=Gt(typeof n=="number"?n:0);return At(e,function(e){var n=ut(0,++t);r[t]=r[n],r[n]=e}),r}function Bt(e,t,n){var r;t=K.createCallback(t,n,3),n=-1;var i=e?e.length:0;if(typeof i=="number")for(;++n<i&&!(r=t(e[n],n,e)););else d(e,function(e,n,i){return!(r=t(e,n,i))});return!!r}function jt(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&null!=t){var s=-1;for(t=K.createCallback(t,n,3);++s<i&&t(e[s],s,e);)r++}else if(r=t,null==r||n)return e?e[0]:p;return c(e,0,On(An(0,r),i))}function Ft(t,n,r){if(typeof r=="number"){var i=t?t.length:0;r=0>r?An(0,i+r):r||0}else if(r)return r=qt(t,n),t[r]===n?r:-1;return e(t,n,r)}function It(e,t,n){if(typeof t!="number"&&null!=t){var r=0,i=-1,s=e?e.length:0;for(t=K.createCallback(t,n,3);++i<s&&t(e[i],i,e);)r++}else r=null==t||n?1:An(0,t);return c(e,r)}function qt(e,t,n,r){var i=0,s=e?e.length:i;for(n=n?K.createCallback(n,r,1):Vt,t=n(t);i<s;)r=i+s>>>1,n(e[r])<t?i=r+1:s=r;return i}function Rt(e,t,n,r){return typeof t!="boolean"&&null!=t&&(r=n,n=typeof t!="function"&&r&&r[t]===e?null:t,t=!1),null!=n&&(n=K.createCallback(n,r,3)),at(e,t,n)}function Ut(){for(var e=1<arguments.length?arguments:arguments[0],t=-1,n=e?_t(Vn(e,"length")):0,r=Gt(0>n?0:n);++t<n;)r[t]=Vn(e,t);return r}function zt(e,t){var n=-1,r=e?e.length:0,i={};for(t||!r||Bn(e[0])||(t=[]);++n<r;){var s=e[n];t?i[s]=t[n]:s&&(i[s[0]]=s[1])}return i}function Wt(e,t){return 2<arguments.length?lt(e,17,c(arguments,2),null,t):lt(e,1,null,null,t)}function Xt(e,t,n){function r(){l&&dn(l),o=l=c=p,(v||d!==t)&&(h=$n(),u=e.apply(f,s),l||o||(s=f=null))}function i(){var n=t-($n()-a);0<n?l=wn(i,n):(o&&dn(o),n=c,o=l=c=p,n&&(h=$n(),u=e.apply(f,s),l||o||(s=f=null)))}var s,o,u,a,f,l,c,h=0,d=!1,v=!0;if(!wt(e))throw new un;if(t=An(0,t)||0,!0===n)var m=!0,v=!1;else Et(n)&&(m=n.leading,d="maxWait"in n&&(An(t,n.maxWait)||0),v="trailing"in n?n.trailing:v);return function(){if(s=arguments,a=$n(),f=this,c=v&&(l||!m),!1===d)var n=m&&!l;else{o||m||(h=a);var p=d-(a-h),g=0>=p;g?(o&&(o=dn(o)),h=a,u=e.apply(f,s)):o||(o=wn(r,p))}return g&&l?l=dn(l):l||t===d||(l=wn(i,t)),n&&(g=!0,u=e.apply(f,s)),!g||l||o||(s=f=null),u}}function Vt(e){return e}function $t(e,t,n){var r=!0,i=t&&yt(t);t&&(n||i.length)||(null==n&&(n=t),s=Q,t=e,e=K,i=yt(t)),!1===n?r=!1:Et(n)&&"chain"in n&&(r=n.chain);var s=e,o=wt(s);At(i,function(n){var i=e[n]=t[n];o&&(s.prototype[n]=function(){var t=this.__chain__,n=this.__wrapped__,o=[n];if(bn.apply(o,arguments),o=i.apply(e,o),r||t){if(n===o&&Et(o))return this;o=new s(o),o.__chain__=t}return o})})}function Jt(){}function Kt(e){return function(t){return t[e]}}function Qt(){return this.__wrapped__}n=n?Y.defaults($.Object(),n,Y.pick($,_)):$;var Gt=n.Array,Yt=n.Boolean,Zt=n.Date,en=n.Function,tn=n.Math,nn=n.Number,rn=n.Object,sn=n.RegExp,on=n.String,un=n.TypeError,an=[],fn=rn.prototype,ln=n._,cn=fn.toString,hn=sn("^"+on(cn).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),pn=tn.ceil,dn=n.clearTimeout,vn=tn.floor,mn=en.prototype.toString,gn=pt(gn=rn.getPrototypeOf)&&gn,yn=fn.hasOwnProperty,bn=an.push,wn=n.setTimeout,En=an.splice,Sn=an.unshift,xn=function(){try{var e={},t=pt(t=rn.defineProperty)&&t,n=t(e,e,e)&&t}catch(r){}return n}(),Tn=pt(Tn=rn.create)&&Tn,Nn=pt(Nn=Gt.isArray)&&Nn,Cn=n.isFinite,kn=n.isNaN,Ln=pt(Ln=rn.keys)&&Ln,An=tn.max,On=tn.min,Mn=n.parseInt,_n=tn.random,Dn={};Dn[P]=Gt,Dn[H]=Yt,Dn[B]=Zt,Dn[j]=en,Dn[I]=rn,Dn[F]=nn,Dn[q]=sn,Dn[R]=on,Q.prototype=K.prototype;var Pn=K.support={};Pn.funcDecomp=!pt(n.a)&&O.test(h),Pn.funcNames=typeof en.name=="string",K.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:k,variable:"",imports:{_:K}},Tn||(et=function(){function e(){}return function(t){if(Et(t)){e.prototype=t;var r=new e;e.prototype=null}return r||n.Object()}}());var Hn=xn?function(e,t){W.value=t,xn(e,"__bindData__",W)}:Jt,Bn=Nn||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&cn.call(e)==P||!1},jn=Ln?function(e){return Et(e)?Ln(e):[]}:J,Fn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},In=bt(Fn),qn=sn("("+jn(In).join("|")+")","g"),Rn=sn("["+jn(Fn).join("")+"]","g"),Un=gn?function(e){if(!e||cn.call(e)!=I)return!1;var t=e.valueOf,n=pt(t)&&(n=gn(t))&&gn(n);return n?e==n||gn(e)==n:dt(e)}:dt,zn=ft(function(e,t,n){yn.call(e,n)?e[n]++:e[n]=1}),Wn=ft(function(e,t,n){(yn.call(e,n)?e[n]:e[n]=[]).push(t)}),Xn=ft(function(e,t,n){e[n]=t}),Vn=Mt,$n=pt($n=Zt.now)&&$n||function(){return(new Zt).getTime()},Jn=8==Mn(w+"08")?Mn:function(e,t){return Mn(xt(e)?e.replace(L,""):e,t||0)};return K.after=function(e,t){if(!wt(t))throw new un;return function(){return 1>--e?t.apply(this,arguments):void 0}},K.assign=V,K.at=function(e){for(var t=arguments,n=-1,r=it(t,!0,!1,1),t=t[2]&&t[2][t[1]]===e?1:r.length,i=Gt(t);++n<t;)i[n]=e[r[n]];return i},K.bind=Wt,K.bindAll=function(e){for(var t=1<arguments.length?it(arguments,!0,!1,1):yt(e),n=-1,r=t.length;++n<r;){var i=t[n];e[i]=lt(e[i],1,null,null,e)}return e},K.bindKey=function(e,t){return 2<arguments.length?lt(t,19,c(arguments,2),null,e):lt(t,3,null,null,e)},K.chain=function(e){return e=new Q(e),e.__chain__=!0,e},K.compact=function(e){for(var t=-1,n=e?e.length:0,r=[];++t<n;){var i=e[t];i&&r.push(i)}return r},K.compose=function(){for(var e=arguments,t=e.length;t--;)if(!wt(e[t]))throw new un;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}},K.constant=function(e){return function(){return e}},K.countBy=zn,K.create=function(e,t){var n=et(e);return t?V(n,t):n},K.createCallback=function(e,t,n){var r=typeof e;if(null==e||"function"==r)return tt(e,t,n);if("object"!=r)return Kt(e);var i=jn(e),s=i[0],o=e[s];return 1!=i.length||o!==o||Et(o)?function(t){for(var n=i.length,r=!1;n--&&(r=st(t[i[n]],e[i[n]],null,!0)););return r}:function(e){return e=e[s],o===e&&(0!==o||1/o==1/e)}},K.curry=function(e,t){return t=typeof t=="number"?t:+t||e.length,lt(e,4,null,null,null,t)},K.debounce=Xt,K.defaults=b,K.defer=function(e){if(!wt(e))throw new un;var t=c(arguments,1);return wn(function(){e.apply(p,t)},1)},K.delay=function(e,t){if(!wt(e))throw new un;var n=c(arguments,2);return wn(function(){e.apply(p,n)},t)},K.difference=function(e){return rt(e,it(arguments,!0,!0,1))},K.filter=kt,K.flatten=function(e,t,n,r){return typeof t!="boolean"&&null!=t&&(r=n,n=typeof t!="function"&&r&&r[t]===e?null:t,t=!1),null!=n&&(e=Mt(e,n,r)),it(e,t)},K.forEach=At,K.forEachRight=Ot,K.forIn=v,K.forInRight=function(e,t,n){var r=[];v(e,function(e,t){r.push(t,e)});var i=r.length;for(t=tt(t,n,3);i--&&!1!==t(r[i--],r[i],e););return e},K.forOwn=d,K.forOwnRight=gt,K.functions=yt,K.groupBy=Wn,K.indexBy=Xn,K.initial=function(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&null!=t){var s=i;for(t=K.createCallback(t,n,3);s--&&t(e[s],s,e);)r++}else r=null==t||n?1:t||r;return c(e,0,On(An(0,i-r),i))},K.intersection=function(){for(var n=[],r=-1,i=arguments.length,o=u(),a=ht(),c=a===e,h=u();++r<i;){var p=arguments[r];(Bn(p)||mt(p))&&(n.push(p),o.push(c&&p.length>=y&&s(r?n[r]:h)))}var c=n[0],d=-1,v=c?c.length:0,m=[];e:for(;++d<v;){var g=o[0],p=c[d];if(0>(g?t(g,p):a(h,p))){for(r=i,(g||h).push(p);--r;)if(g=o[r],0>(g?t(g,p):a(n[r],p)))continue e;m.push(p)}}for(;i--;)(g=o[i])&&l(g);return f(o),f(h),m},K.invert=bt,K.invoke=function(e,t){var n=c(arguments,2),r=-1,i=typeof t=="function",s=e?e.length:0,o=Gt(typeof s=="number"?s:0);return At(e,function(e){o[++r]=(i?t:e[t]).apply(e,n)}),o},K.keys=jn,K.map=Mt,K.mapValues=function(e,t,n){var r={};return t=K.createCallback(t,n,3),d(e,function(e,n,i){r[n]=t(e,n,i)}),r},K.max=_t,K.memoize=function(e,t){function n(){var r=n.cache,i=t?t.apply(this,arguments):g+arguments[0];return yn.call(r,i)?r[i]:r[i]=e.apply(this,arguments)}if(!wt(e))throw new un;return n.cache={},n},K.merge=function(e){var t=arguments,n=2;if(!Et(e))return e;if("number"!=typeof t[2]&&(n=t.length),3<n&&"function"==typeof t[n-2])var r=tt(t[--n-1],t[n--],2);else 2<n&&"function"==typeof t[n-1]&&(r=t[--n]);for(var t=c(arguments,1,n),i=-1,s=u(),o=u();++i<n;)ot(e,t[i],r,s,o);return f(s),f(o),e},K.min=function(e,t,n){var i=1/0,s=i;if(typeof t!="function"&&n&&n[t]===e&&(t=null),null==t&&Bn(e)){n=-1;for(var o=e.length;++n<o;){var u=e[n];u<s&&(s=u)}}else t=null==t&&xt(e)?r:K.createCallback(t,n,3),At(e,function(e,n,r){n=t(e,n,r),n<i&&(i=n,s=e)});return s},K.omit=function(e,t,n){var r={};if(typeof t!="function"){var i=[];v(e,function(e,t){i.push(t)});for(var i=rt(i,it(arguments,!0,!1,1)),s=-1,o=i.length;++s<o;){var u=i[s];r[u]=e[u]}}else t=K.createCallback(t,n,3),v(e,function(e,n,i){t(e,n,i)||(r[n]=e)});return r},K.once=function(e){var t,n;if(!wt(e))throw new un;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},K.pairs=function(e){for(var t=-1,n=jn(e),r=n.length,i=Gt(r);++t<r;){var s=n[t];i[t]=[s,e[s]]}return i},K.partial=function(e){return lt(e,16,c(arguments,1))},K.partialRight=function(e){return lt(e,32,null,c(arguments,1))},K.pick=function(e,t,n){var r={};if(typeof t!="function")for(var i=-1,s=it(arguments,!0,!1,1),o=Et(e)?s.length:0;++i<o;){var u=s[i];u in e&&(r[u]=e[u])}else t=K.createCallback(t,n,3),v(e,function(e,n,i){t(e,n,i)&&(r[n]=e)});return r},K.pluck=Vn,K.property=Kt,K.pull=function(e){for(var t=arguments,n=0,r=t.length,i=e?e.length:0;++n<r;)for(var s=-1,o=t[n];++s<i;)e[s]===o&&(En.call(e,s--,1),i--);return e},K.range=function(e,t,n){e=+e||0,n=typeof n=="number"?n:+n||1,null==t&&(t=e,e=0);var r=-1;t=An(0,pn((t-e)/(n||1)));for(var i=Gt(t);++r<t;)i[r]=e,e+=n;return i},K.reject=function(e,t,n){return t=K.createCallback(t,n,3),kt(e,function(e,n,r){return!t(e,n,r)})},K.remove=function(e,t,n){var r=-1,i=e?e.length:0,s=[];for(t=K.createCallback(t,n,3);++r<i;)n=e[r],t(n,r,e)&&(s.push(n),En.call(e,r--,1),i--);return s},K.rest=It,K.shuffle=Ht,K.sortBy=function(e,t,n){var r=-1,s=Bn(t),o=e?e.length:0,c=Gt(typeof o=="number"?o:0);for(s||(t=K.createCallback(t,n,3)),At(e,function(e,n,i){var o=c[++r]=a();s?o.m=Mt(t,function(t){return e[t]}):(o.m=u())[0]=t(e,n,i),o.n=r,o.o=e}),o=c.length,c.sort(i);o--;)e=c[o],c[o]=e.o,s||f(e.m),l(e);return c},K.tap=function(e,t){return t(e),e},K.throttle=function(e,t,n){var r=!0,i=!0;if(!wt(e))throw new un;return!1===n?r=!1:Et(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),z.leading=r,z.maxWait=t,z.trailing=i,Xt(e,t,z)},K.times=function(e,t,n){e=-1<(e=+e)?e:0;var r=-1,i=Gt(e);for(t=tt(t,n,1);++r<e;)i[r]=t(r);return i},K.toArray=function(e){return e&&typeof e.length=="number"?c(e):Tt(e)},K.transform=function(e,t,n,r){var i=Bn(e);if(null==n)if(i)n=[];else{var s=e&&e.constructor;n=et(s&&s.prototype)}return t&&(t=K.createCallback(t,r,4),(i?At:d)(e,function(e,r,i){return t(n,e,r,i)})),n},K.union=function(){return at(it(arguments,!0,!0))},K.uniq=Rt,K.values=Tt,K.where=kt,K.without=function(e){return rt(e,c(arguments,1))},K.wrap=function(e,t){return lt(t,16,[e])},K.xor=function(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(Bn(n)||mt(n))var r=r?at(rt(r,n).concat(rt(n,r))):n}return r||[]},K.zip=Ut,K.zipObject=zt,K.collect=Mt,K.drop=It,K.each=At,K.eachRight=Ot,K.extend=V,K.methods=yt,K.object=zt,K.select=kt,K.tail=It,K.unique=Rt,K.unzip=Ut,$t(K),K.clone=function(e,t,n,r){return typeof t!="boolean"&&null!=t&&(r=n,n=t,t=!1),Z(e,t,typeof n=="function"&&tt(n,r,1))},K.cloneDeep=function(e,t,n){return Z(e,!0,typeof t=="function"&&tt(t,n,1))},K.contains=Nt,K.escape=function(e){return null==e?"":on(e).replace(Rn,ct)},K.every=Ct,K.find=Lt,K.findIndex=function(e,t,n){var r=-1,i=e?e.length:0;for(t=K.createCallback(t,n,3);++r<i;)if(t(e[r],r,e))return r;return-1},K.findKey=function(e,t,n){var r;return t=K.createCallback(t,n,3),d(e,function(e,n,i){return t(e,n,i)?(r=n,!1):void 0}),r},K.findLast=function(e,t,n){var r;return t=K.createCallback(t,n,3),Ot(e,function(e,n,i){return t(e,n,i)?(r=e,!1):void 0}),r},K.findLastIndex=function(e,t,n){var r=e?e.length:0;for(t=K.createCallback(t,n,3);r--;)if(t(e[r],r,e))return r;return-1},K.findLastKey=function(e,t,n){var r;return t=K.createCallback(t,n,3),gt(e,function(e,n,i){return t(e,n,i)?(r=n,!1):void 0}),r},K.has=function(e,t){return e?yn.call(e,t):!1},K.identity=Vt,K.indexOf=Ft,K.isArguments=mt,K.isArray=Bn,K.isBoolean=function(e){return!0===e||!1===e||e&&typeof e=="object"&&cn.call(e)==H||!1},K.isDate=function(e){return e&&typeof e=="object"&&cn.call(e)==B||!1},K.isElement=function(e){return e&&1===e.nodeType||!1},K.isEmpty=function(e){var t=!0;if(!e)return t;var n=cn.call(e),r=e.length;return n==P||n==R||n==D||n==I&&typeof r=="number"&&wt(e.splice)?!r:(d(e,function(){return t=!1}),t)},K.isEqual=function(e,t,n,r){return st(e,t,typeof n=="function"&&tt(n,r,2))},K.isFinite=function(e){return Cn(e)&&!kn(parseFloat(e))},K.isFunction=wt,K.isNaN=function(e){return St(e)&&e!=+e},K.isNull=function(e){return null===e},K.isNumber=St,K.isObject=Et,K.isPlainObject=Un,K.isRegExp=function(e){return e&&typeof e=="object"&&cn.call(e)==q||!1},K.isString=xt,K.isUndefined=function(e){return typeof e=="undefined"},K.lastIndexOf=function(e,t,n){var r=e?e.length:0;for(typeof n=="number"&&(r=(0>n?An(0,r+n):On(n,r-1))+1);r--;)if(e[r]===t)return r;return-1},K.mixin=$t,K.noConflict=function(){return n._=ln,this},K.noop=Jt,K.now=$n,K.parseInt=Jn,K.random=function(e,t,n){var r=null==e,i=null==t;return null==n&&(typeof e=="boolean"&&i?(n=e,e=1):i||typeof t!="boolean"||(n=t,i=!0)),r&&i&&(t=1),e=+e||0,i?(t=e,e=0):t=+t||0,n||e%1||t%1?(n=_n(),On(e+n*(t-e+parseFloat("1e-"+((n+"").length-1))),t)):ut(e,t)},K.reduce=Dt,K.reduceRight=Pt,K.result=function(e,t){if(e){var n=e[t];return wt(n)?e[t]():n}},K.runInContext=h,K.size=function(e){var t=e?e.length:0;return typeof t=="number"?t:jn(e).length},K.some=Bt,K.sortedIndex=qt,K.template=function(e,t,n){var r=K.templateSettings;e=on(e||""),n=b({},n,r);var i,s=b({},n.imports,r.imports),r=jn(s),s=Tt(s),u=0,a=n.interpolate||A,f="__p+='",a=sn((n.escape||A).source+"|"+a.source+"|"+(a===k?T:A).source+"|"+(n.evaluate||A).source+"|$","g");e.replace(a,function(t,n,r,s,a,l){return r||(r=s),f+=e.slice(u,l).replace(M,o),n&&(f+="'+__e("+n+")+'"),a&&(i=!0,f+="';"+a+";\n__p+='"),r&&(f+="'+((__t=("+r+"))==null?'':__t)+'"),u=l+t.length,t}),f+="';",a=n=n.variable,a||(n="obj",f="with("+n+"){"+f+"}"),f=(i?f.replace(E,""):f).replace(S,"$1").replace(x,"$1;"),f="function("+n+"){"+(a?"":n+"||("+n+"={});")+"var __t,__p='',__e=_.escape"+(i?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+f+"return __p}";try{var l=en(r,"return "+f).apply(p,s)}catch(c){throw c.source=f,c}return t?l(t):(l.source=f,l)},K.unescape=function(e){return null==e?"":on(e).replace(qn,vt)},K.uniqueId=function(e){var t=++m;return on(null==e?"":e)+t},K.all=Ct,K.any=Bt,K.detect=Lt,K.findWhere=Lt,K.foldl=Dt,K.foldr=Pt,K.include=Nt,K.inject=Dt,$t(function(){var e={};return d(K,function(t,n){K.prototype[n]||(e[n]=t)}),e}(),!1),K.first=jt,K.last=function(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&null!=t){var s=i;for(t=K.createCallback(t,n,3);s--&&t(e[s],s,e);)r++}else if(r=t,null==r||n)return e?e[i-1]:p;return c(e,An(0,i-r))},K.sample=function(e,t,n){return e&&typeof e.length!="number"&&(e=Tt(e)),null==t||n?e?e[ut(0,e.length-1)]:p:(e=Ht(e),e.length=On(An(0,t),e.length),e)},K.take=jt,K.head=jt,d(K,function(e,t){var n="sample"!==t;K.prototype[t]||(K.prototype[t]=function(t,r){var i=this.__chain__,s=e(this.__wrapped__,t,r);return i||null!=t&&(!r||n&&typeof t=="function")?new Q(s,i):s})}),K.VERSION="2.4.1",K.prototype.chain=function(){return this.__chain__=!0,this},K.prototype.toString=function(){return on(this.__wrapped__)},K.prototype.value=Qt,K.prototype.valueOf=Qt,At(["join","pop","shift"],function(e){var t=an[e];K.prototype[e]=function(){var e=this.__chain__,n=t.apply(this.__wrapped__,arguments);return e?new Q(n,e):n}}),At(["push","reverse","sort","unshift"],function(e){var t=an[e];K.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),At(["concat","slice","splice"],function(e){var t=an[e];K.prototype[e]=function(){return new Q(t.apply(this.__wrapped__,arguments),this.__chain__)}}),K}var p,d=[],v=[],m=0,g=+(new Date)+"",y=75,b=40,w=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",E=/\b__p\+='';/g,S=/\b(__p\+=)''\+/g,x=/(__e\(.*?\)|\b__t\))\+'';/g,T=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,N=/\w*$/,C=/^\s*function[ \n\r\t]+\w/,k=/<%=([\s\S]+?)%>/g,L=RegExp("^["+w+"]*0+(?=.$)"),A=/($^)/,O=/\bthis\b/,M=/['\n\r\t\u2028\u2029\\]/g,_="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),D="[object Arguments]",P="[object Array]",H="[object Boolean]",B="[object Date]",j="[object Function]",F="[object Number]",I="[object Object]",q="[object RegExp]",R="[object String]",U={};U[j]=!1,U[D]=U[P]=U[H]=U[B]=U[F]=U[I]=U[q]=U[R]=!0;var z={leading:!1,maxWait:0,trailing:!1},W={configurable:!1,enumerable:!1,value:null,writable:!1},X={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1},V={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},$=X[typeof window]&&window||this,J=X[typeof exports]&&exports&&!exports.nodeType&&exports,K=X[typeof module]&&module&&!module.nodeType&&module,Q=K&&K.exports===J&&J,G=X[typeof global]&&global;!G||G.global!==G&&G.window!==G||($=G);var Y=h();typeof define=="function"&&typeof define.amd=="object"&&define.amd?($._=Y,define("underscore",[],function(){return Y})):J&&K?Q?(K.exports=Y)._=Y:J._=Y:$._=Y}.call(this),define("lib-build/tpl",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("lib-build/tpl!storymaps/common/ui/share/ShareDialog",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\n	<div class="modal-content">\n		<div class="modal-logo"></div>\n		<div class="modal-header">\n			<h4 class="modal-title"></h4>\n		</div>\n\n		<div class="modal-body">\n			<div class="social-container">\n				<i class="shareIcon blackHover share_facebook icon-facebook-squared"></i>\n				<i class="shareIcon blackHover share_twitter icon-twitter"></i>\n			</div>\n\n			<div class="share-url-panel"></div>\n\n			<div class="embed-title"></div>\n			<div class="share-embed-panel"></div>\n\n			<div class="checkbox autoplay-container">\n				<label>\n					<input type="checkbox" class="autoplay-checkbox" value="autoplay" />\n					<span class="autoplay-label"></span>\n				</label>\n				<a href="#" class="help autoplay-help" data-toggle="tooltip">\n					<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -5px;"/>\n				</a>\n				<span class="autoplay-notification"></span>\n			</div>\n		</div>\n\n		<div class="modal-footer">\n			<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal"></button>\n		</div>\n	</div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/ui/share/ShareDialog",[],function(){}),define("lib-build/tpl!storymaps/common/ui/share/ShareURLPanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="share-url-container">\n	<span class="share-btn share-clipboard"></span>\n	<input type="text" class="form-control bitlylink" readonly="true"/>\n	<a class="btn btn-primary btn-bitlylink-open" target="_blank"></a>\n	<div class="share-status-wrapper"><span class="share-status"></span></div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/ui/share/ShareURLPanel",[],function(){}),function(e){if(typeof exports=="object"&&typeof module!="undefined")module.exports=e();else if(typeof define=="function"&&define.amd)define("lib-app/clipboard/clipboard",[],e);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"?t=self:t=this,t.Clipboard=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){function i(e,t){while(e&&e!==document){if(e.matches(t))return e;e=e.parentNode}}if(Element&&!Element.prototype.matches){var r=Element.prototype;r.matches=r.matchesSelector||r.mozMatchesSelector||r.msMatchesSelector||r.oMatchesSelector||r.webkitMatchesSelector}t.exports=i},{}],2:[function(e,t,n){function i(e,t,n,r,i){var o=s.apply(this,arguments);return e.addEventListener(n,o,i),{destroy:function(){e.removeEventListener(n,o,i)}}}function s(e,t,n,i){return function(n){n.delegateTarget=r(n.target,t),n.delegateTarget&&i.call(e,n)}}var r=e("./closest");t.exports=i},{"./closest":1}],3:[function(e,t,n){n.node=function(e){return e!==undefined&&e instanceof HTMLElement&&e.nodeType===1},n.nodeList=function(e){var t=Object.prototype.toString.call(e);return e!==undefined&&(t==="[object NodeList]"||t==="[object HTMLCollection]")&&"length"in e&&(e.length===0||n.node(e[0]))},n.string=function(e){return typeof e=="string"||e instanceof String},n.fn=function(e){var t=Object.prototype.toString.call(e);return t==="[object Function]"}},{}],4:[function(e,t,n){function s(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!r.string(t))throw new TypeError("Second argument must be a String");if(!r.fn(n))throw new TypeError("Third argument must be a Function");if(r.node(e))return o(e,t,n);if(r.nodeList(e))return u(e,t,n);if(r.string(e))return a(e,t,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function o(e,t,n){return e.addEventListener(t,n),{destroy:function(){e.removeEventListener(t,n)}}}function u(e,t,n){return Array.prototype.forEach.call(e,function(e){e.addEventListener(t,n)}),{destroy:function(){Array.prototype.forEach.call(e,function(e){e.removeEventListener(t,n)})}}}function a(e,t,n){return i(document.body,e,t,n)}var r=e("./is"),i=e("delegate");t.exports=s},{"./is":3,delegate:2}],5:[function(e,t,n){function r(e){var t;if(e.nodeName==="SELECT")e.focus(),t=e.value;else if(e.nodeName==="INPUT"||e.nodeName==="TEXTAREA")e.focus(),e.setSelectionRange(0,e.value.length),t=e.value;else{e.hasAttribute("contenteditable")&&e.focus();var n=window.getSelection(),r=document.createRange();r.selectNodeContents(e),n.removeAllRanges(),n.addRange(r),t=n.toString()}return t}t.exports=r},{}],6:[function(e,t,n){function r(){}r.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){function i(){r.off(e,i),t.apply(n,arguments)}var r=this;return i._=t,this.on(e,i,n)},emit:function(e){var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=n.length;for(r;r<i;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],i=[];if(r&&t)for(var s=0,o=r.length;s<o;s++)r[s].fn!==t&&r[s].fn._!==t&&i.push(r[s]);return i.length?n[e]=i:delete n[e],this}},t.exports=r},{}],7:[function(t,n,r){(function(i,s){if(typeof e=="function"&&e.amd)e(["module","select"],s);else if(typeof r!="undefined")s(n,t("select"));else{var o={exports:{}};s(o,i.select),i.clipboardAction=o.exports}})(this,function(e,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=r(t),i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(){function e(t){s(this,e),this.resolveOptions(t),this.initSelection()}return o(e,[{key:"resolveOptions",value:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.action=t.action,this.emitter=t.emitter,this.target=t.target,this.text=t.text,this.trigger=t.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var t=this,r=document.documentElement.getAttribute("dir")=="rtl";this.removeFake(),this.fakeHandlerCallback=function(){return t.removeFake()},this.fakeHandler=document.body.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[r?"right":"left"]="-9999px";var i=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.addEventListener("focus",window.scrollTo(0,i)),this.fakeElem.style.top=i+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=(0,n.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(document.body.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,n.default)(this.target),this.copyText()}},{key:"copyText",value:function(){var t=void 0;try{t=document.execCommand(this.action)}catch(n){t=!1}this.handleResult(t)}},{key:"handleResult",value:function(t){this.emitter.emit(t?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"copy";this._action=t;if(this._action!=="copy"&&this._action!=="cut")throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(t){if(t!==undefined){if(!t||(typeof t=="undefined"?"undefined":i(t))!=="object"||t.nodeType!==1)throw new Error('Invalid "target" value, use a valid Element');if(this.action==="copy"&&t.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if(this.action==="cut"&&(t.hasAttribute("readonly")||t.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=t}},get:function(){return this._target}}]),e}();e.exports=u})},{select:5}],8:[function(t,n,r){(function(i,s){if(typeof e=="function"&&e.amd)e(["module","./clipboard-action","tiny-emitter","good-listener"],s);else if(typeof r!="undefined")s(n,t("./clipboard-action"),t("tiny-emitter"),t("good-listener"));else{var o={exports:{}};s(o,i.clipboardAction,i.tinyEmitter,i.goodListener),i.clipboard=o.exports}})(this,function(e,t,n,r){"use strict";function u(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||typeof t!="object"&&typeof t!="function"?e:t}function c(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e,t){var n="data-clipboard-"+e;if(!t.hasAttribute(n))return;return t.getAttribute(n)}var i=u(t),s=u(n),o=u(r),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=function(e){function t(e,n){a(this,t);var r=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.resolveOptions(n),r.listenClick(e),r}return c(t,e),f(t,[{key:"resolveOptions",value:function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.action=typeof t.action=="function"?t.action:this.defaultAction,this.target=typeof t.target=="function"?t.target:this.defaultTarget,this.text=typeof t.text=="function"?t.text:this.defaultText}},{key:"listenClick",value:function(t){var n=this;this.listener=(0,o.default)(t,"click",function(e){return n.onClick(e)})}},{key:"onClick",value:function(t){var n=t.delegateTarget||t.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new i.default({action:this.action(n),target:this.target(n),text:this.text(n),trigger:n,emitter:this})}},{key:"defaultAction",value:function(t){return p("action",t)}},{key:"defaultTarget",value:function(t){var n=p("target",t);if(n)return document.querySelector(n)}},{key:"defaultText",value:function(t){return p("text",t)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}]),t}(s.default);e.exports=h})},{"./clipboard-action":7,"good-listener":4,"tiny-emitter":6}]},{},[8])(8)}),define("lib-build/css!storymaps/common/_resources/font/builder-share/css/share-font",[],function(){}),define("storymaps/common/ui/share/ShareURLPanel",["lib-build/tpl!./ShareURLPanel","lib-build/css!./ShareURLPanel","../../utils/SocialSharing","lib-app/clipboard/clipboard","lib-build/css!storymaps/common/_resources/font/builder-share/css/share-font.css"],function(e,t,n,r){return function(i){function a(e,t){o.val(e),i.find(".btn-bitlylink-open").attr("href",e),n.requestShortUrl(e).then(function(e){o.val(e),(t===undefined||t===!0)&&o.select()});var s=new r(i.find(".share-btn").get(0),{text:function(){return i.find(".bitlylink").val()}});s.on("success",function(){i.find(".share-btn").removeClass("share-clipboard").addClass("share-ok"),i.find(".share-status").show(),i.find(".bitlylink")[0].selectionStart=i.find(".bitlylink")[0].selectionEnd=-1,i.find(".bitlylink").focus(),setTimeout(function(){i.find(".share-btn").addClass("share-clipboard").removeClass("share-ok"),i.find(".share-status").hide()},2e3)})}function f(){i.find(".bitlylink").click(function(){this.setSelectionRange(0,this.value.length)})}var s=document.queryCommandSupported("copy");i.append(e({}));var o=i.find(".bitlylink"),u=null;f(),this.present=function(e,t){u=n.cleanURL(e,!0),a(u,t),i.find(".btn-bitlylink-open").html(i18n.viewer.shareFromCommon.open),i.find(".share-url-container").toggleClass("touch",!s),i.find(".share-btn").attr("title",i18n.viewer.shareFromCommon.copy),i.find(".share-status").html(i18n.viewer.shareFromCommon.copied)},this.focus=function(){o.select()},this.setAutoplay=function(e){var t=u;e&&(t+=t.match(/\?/)?"&":"?",t+="autoplay"),a(t)}}}),define("lib-build/tpl!storymaps/common/ui/share/ShareEmbedPanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="share-embed-container">\n	<div class="embed-explain"></div>\n\n	<div class="share-embed-wrapper">\n		<div class="share-btn share-clipboard"></div>\n		<textarea class="form-control embedTextarea" readonly="true"></textarea>\n	</div>\n	<div class="share-status-wrapper"><span class="share-status"></span></div>\n\n	<div>\n		<span class="embed-lbl-size"></span>\n		<div class="btn-group">\n			<button class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown">\n				<span class="embed-sizes-btn"></span>&nbsp;<span class="caret"></span>\n			</button>\n			<ul class="dropdown-menu embed-sizes" role="menu"></ul>\n		</div>\n	</div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/ui/share/ShareEmbedPanel",[],function(){}),define("storymaps/common/ui/share/ShareEmbedPanel",["lib-build/tpl!./ShareEmbedPanel","lib-build/css!./ShareEmbedPanel","lib-app/clipboard/clipboard","lib-build/css!storymaps/common/_resources/font/builder-share/css/share-font.css"],function(e,t,n){return function(r){function a(){$.each(s,function(e,t){r.find(".embed-sizes").append('<li><a data-width="'+t.width+'" data-height="'+t.height+'">'+t.width+" / "+t.height+"</a></li>")}),r.find(".embed-sizes a").click(function(){var e=$(this);e.parents(".btn-group").find(".embed-sizes-btn").text(e.text()),f(e.data("width"),e.data("height"))})}function f(e,t){r.find(".embedTextarea").val(i.replace("%URL%",o).replace("%WIDTH%",e).replace("%HEIGHT%",t));var s=new n(r.find(".share-btn").get(0),{text:function(){return r.find(".embedTextarea").val()}});s.on("success",function(){r.find(".share-btn").removeClass("share-clipboard").addClass("share-ok"),r.find(".share-status").show(),r.find(".embedTextarea")[0].selectionStart=r.find(".embedTextarea")[0].selectionEnd=-1,r.find(".bitlylink").focus(),setTimeout(function(){r.find(".share-btn").addClass("share-clipboard").removeClass("share-ok"),r.find(".share-status").hide()},2e3)})}function l(){r.find(".embedTextarea").click(function(){this.setSelectionRange(0,this.value.length)})}var i='<iframe width="%WIDTH%" height="%HEIGHT%" src="%URL%" frameborder="0" scrolling="no"></iframe>',s=[{width:"100%",height:"800px"},{width:"100%",height:"640px"},{width:"800px",height:"600px"},{width:"640px",height:"480px"}],o=null,u=null;r.append(e({})),a(),l(),this.present=function(e){var t=document.queryCommandSupported("copy");u=e,o=e,r.find(".embed-explain").html(i18n.viewer.shareFromCommon.embedExplain),r.find(".embed-lbl-size").html(i18n.viewer.shareFromCommon.size),r.find(".embed-sizes a").eq(0).click(),r.find(".share-embed-wrapper").toggleClass("touch",!t),r.find(".share-clipboard").attr("title",i18n.viewer.shareFromCommon.copy),r.find(".share-status").html(i18n.viewer.shareFromCommon.copied)},this.setAutoplay=function(e){var t=u;e&&(t+=t.match(/\?/)?"&":"?",t+="autoplay"),o=t,r.find(".embed-sizes a").eq(0).click()}}}),define("storymaps/common/ui/share/ShareDialog",["lib-build/tpl!./ShareDialog","lib-build/css!./ShareDialog","./ShareURLPanel","./ShareEmbedPanel","../../utils/SocialSharing"],function(e,t,n,r,i){return function(s){function a(e){var t=$("<div>"+app.data.getWebAppData().getTitle()+"</div>").text();s.find(".share_facebook").toggle(e.facebook),e.facebook&&s.find(".share_facebook").off("click").click(function(){i.shareFacebook("","",null,$(this).data("url"))}),s.find(".share_twitter").toggle(e.twitter),e.twitter&&s.find(".share_twitter").off("click").click(function(){i.shareTwitter(t,$(this).data("url"))})}s.append(e({}));var o=new n(s.find(".share-url-panel")),u=new r(s.find(".share-embed-panel"));s.on("shown.bs.modal",function(){o.focus()}),s.find(".autoplay-checkbox").change(function(){o.setAutoplay(!!this.checked),u.setAutoplay(!!this.checked),s.find(".autoplay-notification").html(i18n.viewer.shareFromCommon.linksupdated).fadeIn(),setTimeout(function(){s.find(".autoplay-notification").fadeOut()},1e3)}),this.present=function(e,t){t=t||{facebook:!1,twitter:!1},s.find(".social-container").toggle(t.facebook||t.twitter),a(t),o.present(e),u.present(e),s.find(".modal-title").html(i18n.viewer.headerFromCommon.share),s.find(".embed-title").html(i18n.viewer.shareFromCommon.embed),s.find(".btn-close").html(i18n.viewer.common.close),s.find(".autoplay-label").html(i18n.viewer.shareFromCommon.autoplayLabel),s.find(".autoplay-help").tooltip({title:i18n.viewer.shareFromCommon.autoplayExplain1+"<br /><br />"+i18n.viewer.shareFromCommon.autoplayExplain2,html:!0}),s.find(".autoplay-checkbox").prop("checked",!1),s.modal({keyboard:!0}),app.appCfg.disableAutoPlay&&s.find(".autoplay-container").hide()}}}),define("storymaps/common/utils/HeaderHelper",["./SocialSharing","../ui/share/ShareDialog","storymaps/common/utils/CommonHelper"],function(e,t,n){function i(e){e.find(".linkContainer").parent().length&&e.find(".linkContainer").css("width",(e.find(".logoContainer").position()||{left:186}).left-e.find(".linkContainer").parent().position().left-e.find(".shareBtns").outerWidth()-($(".logoContainer").width()>1?14:4))}var r=new t($("#shareDialog"));return{setLogo:function(e,t,r){if(!t.logoURL||t.logoURL=="NO_LOGO")e.find(".logoImg").hide(),i(e);else{var s=e.find(".logoLink");t.logoTarget?s.css("cursor","pointer").attr("href",t.logoTarget):s.css("cursor","default").removeAttr("href"),i(e);var o=e.find(".logoImg");o[0].onload=function(){i(e),r&&typeof r=="function"&&r()},o[0].onerror=function(){i(e)},o.attr("src",n.possiblyAddToken(t.logoURL)).show()}},setLink:function(e,t){t.linkURL&&t.linkText?e.find(".linkContainer").html('<a href="'+t.linkURL+'" class="link" target="_blank" tabindex="-1">'+t.linkText+"</a>"):e.find(".linkContainer").html(t.linkText)},setSocial:function(e,t){var n=app.cfg.HEADER_SOCIAL,r=t.socialBtn,i=n&&n.facebook&&(!r||r.facebook),s=n&&n.twitter&&(!r||r.twitter),o=n&&n.bitly&&n.bitly.enable&&n.bitly.login&&n.bitly.key&&(!r||r.bitly);e.find(".share_facebook").toggleClass("active",i),e.find(".share_twitter").toggleClass("active",s),e.find(".share_bitly").toggleClass("active",o),e.find(".share-all").data("share-facebook",i).data("share-twitter",s).toggleClass("active",i||s||o)},toggleSocialBtnAppSharing:function(e,t){t&&e.find(".shareIcon").attr("title",""),e.find(".shareIcon").toggleClass("disabled",!!t).tooltip(t?{title:i18n.commonCore?i18n.commonCore.builderPanel.tooltipNotShared:"",container:"body"}:"destroy")},disableSocialBtnAppSharingAutoplay:function(e,t){e.find(".shareIcon").attr("title",""),e.find(".shareIcon").toggleClass("disabled",!0).tooltip({title:i18n.viewer.headerFromCommon.tooltipAutoplayDisabled,container:"body",placement:t?t:"bottom"})},initEvents:function(t){t.find(".share_facebook").off("click").click(function(){if($(this).hasClass("disabled"))return;var t=$("<div>"+(app.data.getWebAppData().getTitle()||"")+"</div>").text(),n=$("<div>"+(app.data.getWebAppData().getSubtitle()||"")+"</div>").text();e.shareFacebook(t,n,null,$(this).data("url"))}),t.find(".share_twitter").off("click").click(function(){if($(this).hasClass("disabled"))return;var t=$("<div>"+(app.data.getWebAppData().getTitle()||"")+"</div>").text();e.shareTwitter(t,$(this).data("url"))}),t.find(".share_bitly").off("click").click(function(){if($(this).hasClass("disabled"))return;var t=$(this).data("url")||document.location.href;r.present(e.cleanURL(t,!0))}),t.find(".share-all").off("click").click(function(){if($(this).hasClass("disabled"))return;var t=$(this).data("url")||document.location.href;r.present(e.cleanURL(t,!0),{facebook:!!$(this).data("share-facebook"),twitter:!!$(this).data("share-twitter")})}),t.find(".shareIcon, .share-all").off("keypress").keypress(function(e){if(e.which==13)return $(this).click(),!1}),t.find(".share_facebook").attr("title",i18n.viewer.headerFromCommon.facebookTooltip),t.find(".share_twitter").attr("title",i18n.viewer.headerFromCommon.twitterTooltip),t.find(".share_bitly").attr("title",i18n.viewer.headerFromCommon.bitlyTooltip),$(window).resize(function(){i(t)})}}}),define("lib-build/css!storymaps/common/builder/InlineFieldEdit",[],function(){}),define("storymaps/common/builder/InlineFieldEdit",["lib-build/css!./InlineFieldEdit","dojo/has"],function(e,t){return function(n,r,i){function o(e,t,n){if(!e||!t||!n)return;typeof r=="function"&&r(),s=n,t.parent().parent().addClass("isEditing"),t.hide(),e.hide(),n.val(t.html()),n.show(),n.select()}function u(e){if(!e||!e.get(0))return;s=null;var n=e.get(0).value,r=e.parent().find(".text_edit_label"),o=e.parent().find(".text_edit_icon"),u=r.parent().first();n===""&&($(e).parents("h1.title")?n=i18n.commonCore.inlineFieldEdit.enterTitle:n=i18n.commonCore.inlineFieldEdit.enterSubtitle),n=n.replace(/<\/?script>/g,""),r.parent().parent().removeClass("isEditing"),r.html(n),r.show(),e.hide(),o.css("display","inline-block"),t("ios")&&document.activeElement.blur(),typeof i=="function"&&i(u,n)}var s=null;n.find(".text_edit_icon").click(function(){o($(this),$(this).parent().find(".text_edit_label"),$(this).parent().find(".text_edit_input"))}),n.find(".text_edit_label").click(function(){o($(this).parent().find(".text_edit_icon"),$(this),$(this).parent().find(".text_edit_input"))}),n.find(".text_edit_input").blur(function(){u($(this))}),t("ios")&&$("body").bind("touchstart",function(e){s&&e.target!=s.get(0)&&u(s)}),n.find(".text_edit_input").keypress(function(e){var t=e.keyCode?e.keyCode:e.which;t=="13"&&u($(this))})}}),define("storymaps/common/ui/header/Desktop",["lib-build/css!./Desktop","../../utils/HeaderHelper","../../builder/InlineFieldEdit","../../utils/CommonHelper","dojo/has","dojo/topic"],function(e,t,n,r,i,s){return function(o,u){function f(){$("#headerDesktop .subtitle:visible").length?$("#headerDesktop .subtitle")[0].focus():$("#headerDesktop .title")[0].focus()}function l(e){if(!app.appCfg.noAppThemes){o.css("background-color",e.header),o.find(".textArea").css("color",e.headerTitle),o.find(".rightArea").css("color",e.headerText);var t=o.find(".subtitle");e.name.match(/-org$|-modified$/)?t.css({color:e.headerTitle,opacity:.8}):t.removeAttr("style")}}function c(e,n){var r=e.compactSize===undefined?n:e.compactSize;t.setLogo(o,e,a.resize),t.setLink(o,e),t.setSocial(o,e),t.initEvents(o,"bottom"),o.toggleClass("compact",r),r&&(o.find(".rightArea").hide(),setTimeout(function(){o.find(".rightArea").show()},0))}function h(){return o.find(".check-story").hide(),!o.find(".check-story").is(":visible")&&!o.find(".share-story").is(":visible")&&o.find(".error-status").removeClass("enabled"),a.resize(),!1}function p(){return o.find(".share-story").hide(),!o.find(".check-story").is(":visible")&&!o.find(".share-story").is(":visible")&&o.find(".error-status").removeClass("enabled"),a.resize(),!1}function d(e){var t=o.find(".check-story"),n=$('<span aria-hidden="true" class="check-story-close">×</span>'),s=$('<span aria-hidden="true" class="check-story-close">×</span>');t.off("click").removeClass("forceEvent").show(),n.click(h),s.click(p),e=="start"?t.html('<span class="small-loader"></span>'+i18n.viewer.headerFromCommon.checking).append(n).css("cursor","default"):e=="error"?t.html(i18n.viewer.headerFromCommon.fix).append(n).css("cursor","pointer").click(r.switchToBuilder).removeClass("btn-warning").addClass("btn-danger"):t.html(i18n.viewer.headerFromCommon.noerrors).append(n).removeClass("btn-warning").addClass("btn-success"),(i("ff")||i("ie")||i("trident")==7)&&e!="error"&&t.click(h).addClass("forceEvent");var u=o.find(".share-story").html(i18n.viewer.headerFromCommon.notshared).append(s).toggle(app.data.getWebAppItem().access=="private"||app.data.getWebAppItem().access=="shared"),a=u.css("background-color");if(!app.appCfg.noAppThemes){var f=app.data.getWebAppData().getTheme().colors;a&&f&&f.header&&r.colorsAreSimilar(a,f.header,!0)&&u.css("box-shadow","0 0 2px 1px white")}}function v(){}function m(e,t){setTimeout(function(){s.publish("HEADER_EDITED",{src:$(e).attr("class").split(" ")[0],value:t}),$(e).removeClass("error")},i("ios")||i("ie")>=10?700:0),app.builder.hideSaveConfirmation()}var a=this;this.init=function(e,t,a,f,h,p,g){l(h);if(e){o.addClass("hideDesktop");return}u&&(o.addClass("isBuilder"),t="<div class='text_edit_label'>"+(t||i18n.commonCore.inlineFieldEdit.enterTitle)+"</div>",t+="<div class='text_edit_icon' title='"+i18n.commonCore.header.title.replace("%TPL_NAME%",app.cfg.TPL_NAME)+"'></div>",t+="<textarea rows='1' class='text_edit_input form-control' type='text' spellcheck='true'></textarea>",a="<span class='text_edit_label'>"+(a||i18n.commonCore.inlineFieldEdit.enterSubtitle)+"</span>",a+="<div class='text_edit_icon' title='"+i18n.commonCore.header.subtitle.replace("%TPL_NAME%",app.cfg.TPL_NAME)+"'></div>",a+="<textarea rows='3' class='text_edit_input form-control' type='text' spellcheck='true'></textarea>"),o.find(".title").html(t),o.find(".subtitle").html(a),u&&new n(o,v,m);if(!u&&!a){var y=f.compactSize===undefined?g:f.compactSize;y||(o.find(".title").css({paddingTop:30,height:90}),o.find(".subtitle").css("height",32).attr("tabindex","-1"))}if(p){var b=o.find(".switchBuilder").html('<span class="glyphicon glyphicon-cog"></span>'+i18n.viewer.headerFromCommon.builderButton+'<span aria-hidden="true" class="switch-builder-close">×</span>').click(r.switchToBuilder).show(),w=b.css("background-color");if(!app.appCfg.noAppThemes){var E=app.data.getWebAppData().getTheme().colors;w&&E&&E.header&&r.colorsAreSimilar(w,E.header,!0)&&b.css("box-shadow","0 0 2px 1px white")}i("ff")||i("ie")||i("trident")==7?b.find(".switch-builder-close").hide():b.find(".switch-builder-close").click(function(){return b.hide(),$(window).resize(),!1})}var S=r.getUrlParams(),x=S.preview==="true"||S.preview==="",T=S.autoplay==="true"||S.autoplay==="";!app.isInBuilder&&app.userCanEdit&&i("ie")!=9&&!x&&!T&&(o.find(".error-status").addClass("enabled"),s.subscribe("MYSTORIES_SCAN",d),d("start")),c(f,g)},this.resize=function(e){e||(e=$(document).width());var t=Math.max(o.find(".logoImg").outerWidth()+50,o.find(".rightArea").outerWidth()+20);o.find(".textArea").width(e-t-15)},this.update=function(e,t,n){l(t),c(e,n)},this.getTitle=function(){return u?o.find(".title .text_edit_label").html():o.find(".title").html()},this.getSubtitle=function(){return u?o.find(".subtitle .text_edit_label").html():o.find(".subtitle").html()},this.setTitleAndSubtitle=function(e,t){var n=u?i18n.commonCore.inlineFieldEdit.enterTitle:"",r=u?i18n.commonCore.inlineFieldEdit.enterSubtitle:"";o.find(".title"+(u?" .text_edit_label":"")).html(e||n),o.find(".subtitle"+(u?" .text_edit_label":"")).html(t||r)},this.toggleSocialBtnAppSharing=function(e){t.toggleSocialBtnAppSharing(o,e)},this.focus=function(e){!e||e.area=="social"?($("#headerDesktop .shareIcon").attr("tabindex","0"),$("#headerDesktop .linkContainer a").length?$("#headerDesktop .linkContainer a").attr("tabindex","0")[0].focus():$("#headerDesktop .linkContainer").length?$("#headerDesktop .linkContainer").attr("tabindex","0")[0].focus():$("#headerDesktop .shareIcon:visible").length?$("#headerDesktop .shareIcon")[0].focus():f()):f()},this.enableAutoplay=function(){t.disableSocialBtnAppSharingAutoplay(o)},this.setTitleError=function(){o.find(".title").addClass("error")},this.initLocalization=function(){}}}),define("lib-build/css!storymaps/tpl/core/MainView",[],function(){}),define("lib-build/tpl!storymaps/tpl/ui/MainMediaContainerMap",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="mainMediaContainer">\n    <div class="mapContainer" data-webmapid="'+((__t=webmapid)==null?"":__t)+'" data-temporary="'+((__t=isTemporary)==null?"":__t)+'"></div>\n	<div class="overview"></div>\n	<div class="legend"></div>\n	<div class="geocoder"></div>\n	<div class="mainStageErrorContainer">\n		<div class="error"></div>\n	</div>\n	\n	<div class="mobilePopup mobileInfo hideContent">\n		<div class="content-toggles">\n			<div class="btn-group">\n				<button type="button" class="btn btn-default" data-value="description">'+((__t=lblDescription)==null?"":__t)+'</button>\n				<button type="button" class="btn btn-default" data-value="legend">'+((__t=lblLegend)==null?"":__t)+'</button>\n			</div>\n		</div>\n		<div class="content-containers">\n			<div class="content-container description textEditorContent"></div>\n			<div class="content-container legendMobile">\n				<div style="text-align: center">\n					'+((__t=lblLegendMobileError)==null?"":__t)+'\n				</div>\n				<div class="legendMobileErrorExplain">'+((__t=lblLegendMobileErrorExplain)==null?"":__t)+'</div>\n			</div>\n		</div>\n	</div>\n	<div class="mobilePopup mobileInfoWindow hideContent">\n		<div class="dijitContainer"></div>\n	</div>\n	\n	<div class="mapLocationError">\n		<div class="mapLocationMsg"></div>\n	</div>\n</div>';return __p}}),define("lib-build/tpl!storymaps/tpl/ui/MainMediaContainerImage",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="mainMediaContainer">\n    <div class="imgContainer" data-src="'+((__t=url)==null?"":__t)+'"></div>\n    <div class="mobilePopup mobileInfo hideContent">\n    	<div class="description textEditorContent"></div>\n    </div>\n</div>';return __p}}),define("lib-build/tpl!storymaps/tpl/ui/MainMediaContainerEmbed",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="mainMediaContainer">\n	\n    ',url?__p+='\n    	<iframe class="embedContainer" data-src="'+((__t=url)==null?"":__t)+'" data-unload="'+((__t=unload)==null?"":__t)+'" allowfullscreen="1"></iframe>\n    ':frameTag&&(__p+="\n    	"+((__t=frameTag)==null?"":__t)+"\n    "),__p+='\n    \n    <div class="mobilePopup mobileInfo hideContent">\n    	<div class="description textEditorContent"></div>\n    </div>\n</div>';return __p}}),define("lib-build/css!storymaps/tpl/ui/MainStage",[],function(){}),define("storymaps/tpl/core/WebApplicationData",["dojo/_base/lang","storymaps/common/utils/CommonHelper"],function(e,t){var n={},r={values:{}};return{set:function(t){n=e.clone(t);if(!t||!t.values)return;r=t},get:function(){var t=e.clone(r);return t.values.template=t.values.template||{},t.values.template={name:t.values.template.name||app.cfg.TPL_NAME,createdWith:t.values.template.createdWith||app.version,editedWith:app.version},t},getOriginalData:function(){return n},isBlank:function(){return Object.keys(r.values).length<=1||app.data.getStoryEntries().length===0},getBlank:function(){return{values:{webmap:n.values.webmap}}},getSourceWebmap:function(){return n&&n.values?n.values.webmap:null},cleanWebAppAfterInitialization:function(){var e=!1,t=[n,r];for(var i=0;i<t.length;i++){var s=t[i];s&&s.values&&(s.values.order&&(delete s.values.order,e=!0),s.values.firstRecordAsIntro&&(delete s.values.firstRecordAsIntro,e=!0),s.values.fieldsOverride&&(delete s.values.fieldsOverride,e=!0),s.values.sourceLayer&&(delete s.values.sourceLayer,e=!0))}return e},restoreOriginalData:function(){this.set(n)},updateAfterSave:function(){n=e.clone(r)},getTemplateVersion:function(){return r.values.template?r.values.template.editedWith:null},getTemplateCreation:function(){return r.values.template?r.values.template.creaedWith:null},getDoNotWarnTitle:function(){return r.values.doNotWarnTitle||!1},setDoNotWarnTitle:function(e){r.values.doNotWarnTitle=e},getWebmap:function(){return r.values.webmap},setWebmap:function(e){r.values.webmap=e},getTitle:function(){return r.values.title||""},setTitle:function(e){r.values.title=e},getSubtitle:function(){return r.values.subtitle},setSubtitle:function(e){r.values.subtitle=e},getSettings:function(){return r.values.settings||{}},getLayout:function(){return this.getSettings().layout||{}},setLayout:function(e){r.values.settings=r.values.settings||{},r.values.settings.layout=e},getLayoutId:function(){return this.getLayout().id||app.cfg.LAYOUTS[0].id},getLayoutProperties:function(e){var t=e||this.getLayoutId(),n=$.grep(app.cfg.LAYOUTS,function(e){return e.id==t});return n&&n.length?n[0]:null},getLayoutOptions:function(){var t=e.clone(this.getSettings().layoutOptions)||{};return t.panel=this.getPanelCfg(),t.description===undefined&&(this.getLayoutId()=="tab"||this.getLayoutId()=="bullet")&&(t.description=!0),this.getLayoutId()=="accordion"&&t.numbering===undefined&&(t.numbering=!0),this.getLayoutId()=="bullet"?t.legend="panel":this.getLayoutId()=="accordion"&&(t.legend="dropdown"),t},setLayoutOptions:function(e){r.values.settings=r.values.settings||{},r.values.settings.layoutOptions=e},setDefaultLayoutOptions:function(){this.getLayoutId()=="tab"?this.setLayoutOptions({description:!0,legend:"panel",panel:{position:"left",size:"medium"},panelMapOverlap:!1}):this.getLayoutId()=="accordion"&&this.setLayoutOptions({description:!0,legend:"dropdown",panel:{position:"left",size:"medium"},numbering:!0,reverse:!1}),this.getLayoutId()=="bullet"&&this.setLayoutOptions({description:!0,legend:"panel",panel:{position:"left",size:"medium"},reverse:!1,panelMapOverlap:!1})},getLocateBtn:function(){return this.getMapOptions().locateBtn&&this.getMapOptions().locateBtn.enable},getPanelCfg:function(){var e={},t=(this.getSettings().layoutOptions||{}).panel||{},n=this.getLayoutProperties();return n?(n.sizes&&(e.sizeLbl=t.size||"medium",e.sizeVal=n.sizes[e.sizeLbl]),n.positions&&(e.position=t.position||n.positions[0]),e):null},getLegendPlacement:function(){return this.getLayoutOptions().legend},getPanelMapOverlap:function(){return this.getLayoutOptions().panelMapOverlap},getTheme:function(){return this.getSettings().theme||{}},setTheme:function(e){r.values.settings=r.values.settings||{},r.values.settings.theme=e},getColors:function(){var e=this.getTheme().colors;if(e&&e.name){var t=$.grep(this.getLayoutProperties().themes,function(t){return t.name==e.name});return t&&t.length?t[0]:e}return this.getLayoutProperties().themes[0]},getHeader:function(){return this.getSettings().header||{}},setHeader:function(e){r.values.settings=r.values.settings||{},r.values.settings.header=e},getHeaderLinkText:function(){return this.getHeader().linkText===undefined?app.cfg.HEADER_LINK_TEXT:this.getHeader().linkText},getHeaderLinkURL:function(){return this.getHeader().linkURL===undefined?app.cfg.HEADER_LINK_URL:this.getHeader().linkURL},getLogoURL:function(e){var n=this.getHeader().logoURL?this.getHeader().logoURL:app.cfg.HEADER_LOGO_URL;return n==app.cfg.HEADER_LOGO_URL&&this.getColors()&&(e?this.getColors().esriLogoMobile=="white"&&(n="resources/tpl/viewer/icons/esri-logo-white.png"):this.getColors().esriLogo=="white"&&(n="resources/tpl/viewer/icons/esri-logo-white.png")),t.possiblyRemoveToken(n)},getLogoTarget:function(){return!this.getHeader().logoURL||this.getHeader().logoURL==app.cfg.HEADER_LOGO_URL?app.cfg.HEADER_LOGO_TARGET:this.getHeader().logoTarget},getSocial:function(){return this.getHeader().social},getHeaderCompactSize:function(){return this.getHeader().compactSize},getAppGeocoders:function(){return this.getSettings().appGeocoders},setAppGeocoders:function(e){r.values.settings=r.values.settings||{},r.values.settings.appGeocoders=e},getStory:function(){return r.values.story||{}},getStoryEntries:function(){var e=this.getStory();return e.entries||[]},getStoryStorage:function(){return this.getStory().storage||"WEBAPP"},setStoryEntries:function(e){r.values.story=r.values.story||{},r.values.story.storage="WEBAPP",r.values.story.entries=e},getMapOptions:function(){var t=e.clone(this.getSettings().mapOptions)||{};return t.mapsSync===undefined&&(t.mapsSync=!0),t},getGeocoder:function(){return!!this.getMapOptions().geocoder&&!!this.getMapOptions().geocoder.enable},setMapOptions:function(e){r.values.settings=r.values.settings||{},r.values.settings.mapOptions=e}}}),define("storymaps/tpl/core/Helper",["./WebApplicationData","esri/geometry/Extent"],function(e,t){return{getLayoutExtent:function(n,r,i){var s=$("body").hasClass("layout-tab-left")||$("body").hasClass("layout-bullet-left"),o=$("body").hasClass("layout-tab-right")||$("body").hasClass("layout-bullet-right");console.log("tpl.core.Helper - getLayoutExtent",r,s,o,e.getPanelMapOverlap());if(!n)return n;if(!s&&!o)return n;if(e.getPanelMapOverlap())return n;var u=0,a=0,f=0;s?a=$("#descLegendPanel").outerWidth():o&&(f=$("#descLegendPanel").outerWidth()),r?u=n.getWidth()/$("body").width():u=n.getWidth()/($("body").width()-a-f);var l=u*a,c=u*f;r&&(l*=-1,c*=-1);var h=new t({xmin:n.xmin-l,ymin:n.ymin,xmax:n.xmax+c,ymax:n.ymax,spatialReference:n.spatialReference});if(i){var p=new esri.layers.GraphicsLayer;p.add(new esri.Graphic(n,(new esri.symbol.SimpleFillSymbol).setColor(new esri.Color([255,0,0,.5])))),p.add(new esri.Graphic(h,new esri.symbol.SimpleFillSymbol)),app.map.addLayer(p)}return h}}}),function(e,t,n){function Q(n,r,i){var o=t.createElement(n);return r&&(o.id=s+r),i&&(o.style.cssText=i),e(o)}function G(){return n.innerHeight?n.innerHeight:e(n).height()}function Y(t,n){n!==Object(n)&&(n={}),this.cache={},this.el=t,this.value=function(t){var i;return this.cache[t]===undefined&&(i=e(this.el).attr("data-cbox-"+t),i!==undefined?this.cache[t]=i:n[t]!==undefined?this.cache[t]=n[t]:r[t]!==undefined&&(this.cache[t]=r[t])),this.cache[t]},this.get=function(t){var n=this.value(t);return e.isFunction(n)?n.call(this.el,this):n}}function Z(e){var t=E.length,n=(I+e)%t;return n<0?t+n:n}function et(e,t){return Math.round((/%/.test(e)?(t==="x"?S.width():G())/100:1)*parseInt(e,10))}function tt(e,t){return e.get("photo")||e.get("photoRegex").test(t)}function nt(e,t){return e.get("retinaUrl")&&n.devicePixelRatio>1?t.replace(e.get("photoRegex"),e.get("retinaSuffix")):t}function rt(e){"contains"in d[0]&&!d[0].contains(e.target)&&e.target!==p[0]&&(e.stopPropagation(),d.focus())}function it(e){it.str!==e&&(d.add(p).removeClass(it.str).addClass(e),it.str=e)}function st(){I=0,rel&&rel!=="nofollow"?(E=e("."+o).filter(function(){var t=e.data(this,i),n=new Y(this,t);return n.get("rel")===rel}),I=E.index(P.el),I===-1&&(E=E.add(P.el),I=E.length-1)):E=e(P.el)}function ot(n){e(t).trigger(n),D.triggerHandler(n)}function at(n){var r;z||(r=e(n).data("colorbox"),P=new Y(n,r),rel=P.get("rel"),st(),R||(R=U=!0,it(P.get("className")),d.css({visibility:"hidden",display:"block",opacity:""}),x=Q(V,"LoadedContent","width:0; height:0; overflow:hidden; visibility:hidden"),m.css({width:"",height:""}).append(x),H=g.height()+w.height()+m.outerHeight(!0)-m.height(),B=y.width()+b.width()+m.outerWidth(!0)-m.width(),j=x.outerHeight(!0),F=x.outerWidth(!0),P.w=et(P.get("initialWidth"),"x"),P.h=et(P.get("initialHeight"),"y"),x.css({width:"",height:P.h}),X.position(),ot(u),P.get("onOpen"),_.add(C).hide(),d.focus(),P.get("trapFocus")&&t.addEventListener&&(t.addEventListener("focus",rt,!0),D.one(c,function(){t.removeEventListener("focus",rt,!0)})),P.get("returnFocus")&&D.one(c,function(){e(P.el).focus()})),p.css({opacity:parseFloat(P.get("opacity"))||"",cursor:P.get("overlayClose")?"pointer":"",visibility:"visible"}).show(),P.get("closeButton")?M.html(P.get("close")).appendTo(m):M.appendTo("<div/>"),ct())}function ft(){!d&&t.body&&(K=!1,S=e(n),d=Q(V).attr({id:i,"class":e.support.opacity===!1?s+"IE":"",role:"dialog",tabindex:"-1"}).hide(),p=Q(V,"Overlay").hide(),N=e([Q(V,"LoadingOverlay")[0],Q(V,"LoadingGraphic")[0]]),v=Q(V,"Wrapper"),m=Q(V,"Content").append(C=Q(V,"Title"),k=Q(V,"Current"),O=e('<button type="button"/>').attr({id:s+"Previous"}),A=e('<button type="button"/>').attr({id:s+"Next"}),L=Q("button","Slideshow"),N),M=e('<button type="button"/>').attr({id:s+"Close"}),v.append(Q(V).append(Q(V,"TopLeft"),g=Q(V,"TopCenter"),Q(V,"TopRight")),Q(V,!1,"clear:left").append(y=Q(V,"MiddleLeft"),m,b=Q(V,"MiddleRight")),Q(V,!1,"clear:left").append(Q(V,"BottomLeft"),w=Q(V,"BottomCenter"),Q(V,"BottomRight"))).find("div div").css({"float":"left"}),T=Q(V,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),_=A.add(O).add(k).add(L),e(t.body).append(p,d.append(v,T)))}function lt(){function n(e){e.which>1||e.shiftKey||e.altKey||e.metaKey||e.ctrlKey||(e.preventDefault(),at(this))}return d?(K||(K=!0,A.click(function(){X.next()}),O.click(function(){X.prev()}),M.click(function(){X.close()}),p.click(function(){P.get("overlayClose")&&X.close()}),e(t).bind("keydown."+s,function(e){var t=e.keyCode;R&&P.get("escKey")&&t===27&&(e.preventDefault(),X.close()),R&&P.get("arrowKey")&&E[1]&&!e.altKey&&(t===37?(e.preventDefault(),O.click()):t===39&&(e.preventDefault(),A.click()))}),e.isFunction(e.fn.on)?e(t).on("click."+s,"."+o,n):e("."+o).live("click."+s,n)),!0):!1}function ct(){var r,i,o=X.prep,u,f=++$;U=!0,q=!1,ot(h),ot(a),P.get("onLoad"),P.h=P.get("height")?et(P.get("height"),"y")-j-H:P.get("innerHeight")&&et(P.get("innerHeight"),"y"),P.w=P.get("width")?et(P.get("width"),"x")-F-B:P.get("innerWidth")&&et(P.get("innerWidth"),"x"),P.mw=P.w,P.mh=P.h,P.get("maxWidth")&&(P.mw=et(P.get("maxWidth"),"x")-F-B,P.mw=P.w&&P.w<P.mw?P.w:P.mw),P.get("maxHeight")&&(P.mh=et(P.get("maxHeight"),"y")-j-H,P.mh=P.h&&P.h<P.mh?P.h:P.mh),r=P.get("href"),W=setTimeout(function(){N.show()},100),P.get("inline")?(u=Q(V).hide().insertBefore(e(r)[0]),D.one(h,function(){u.replaceWith(x.children())}),o(e(r))):P.get("iframe")?o(" "):P.get("html")?o(P.get("html")):tt(P,r)?(r=nt(P,r),q=t.createElement("img"),e(q).addClass(s+"Photo").bind("error",function(){o(Q(V,"Error").html(P.get("imgError")))}).one("load",function(){var t;if(f!==$)return;e.each(["alt","longdesc","aria-describedby"],function(t,n){var r=e(P.el).attr(n)||e(P.el).attr("data-"+n);r&&q.setAttribute(n,r)}),P.get("retinaImage")&&n.devicePixelRatio>1&&(q.height=q.height/n.devicePixelRatio,q.width=q.width/n.devicePixelRatio),P.get("scalePhotos")&&(i=function(){q.height-=q.height*t,q.width-=q.width*t},P.mw&&q.width>P.mw&&(t=(q.width-P.mw)/q.width,i()),P.mh&&q.height>P.mh&&(t=(q.height-P.mh)/q.height,i())),P.h&&(q.style.marginTop=Math.max(P.mh-q.height,0)/2+"px"),E[1]&&(P.get("loop")||E[I+1])&&(q.style.cursor="pointer",q.onclick=function(){X.next()}),q.style.width=q.width+"px",q.style.height=q.height+"px",setTimeout(function(){o(q)},1)}),setTimeout(function(){q.src=r},1)):r&&T.load(r,P.get("data"),function(t,n){f===$&&o(n==="error"?Q(V,"Error").html(P.get("xhrError")):e(this).contents())})}var r={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,opacity:.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:undefined,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp|jxr|svg)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1,rel:function(){return this.rel},href:function(){return e(this).attr("href")},title:function(){return this.title}},i="colorbox",s="cbox",o=s+"Element",u=s+"_open",a=s+"_load",f=s+"_complete",l=s+"_cleanup",c=s+"_closed",h=s+"_purge",p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D=e("<a/>"),P,H,B,j,F,I,q,R,U,z,W,X,V="div",$=0,J={},K,ut=function(){function i(){clearTimeout(r)}function o(){if(P.get("loop")||E[I+1])i(),r=setTimeout(X.next,P.get("slideshowSpeed"))}function u(){L.html(P.get("slideshowStop")).unbind(n).one(n,c),D.bind(f,o).bind(a,i),d.removeClass(t+"off").addClass(t+"on")}function c(){i(),D.unbind(f,o).unbind(a,i),L.html(P.get("slideshowStart")).unbind(n).one(n,function(){X.next(),u()}),d.removeClass(t+"on").addClass(t+"off")}function h(){e=!1,L.hide(),i(),D.unbind(f,o).unbind(a,i),d.removeClass(t+"off "+t+"on")}var e,t=s+"Slideshow_",n="click."+s,r;return function(){e?P.get("slideshow")||(D.unbind(l,h),h()):P.get("slideshow")&&E[1]&&(e=!0,D.one(l,h),P.get("slideshowAuto")?u():c(),L.show())}}();if(e.colorbox)return;e(ft),X=e.fn[i]=e[i]=function(t,n){var r,s=this;t=t||{};if(e.isFunction(s))s=e("<a/>"),t.open=!0;else if(!s[0])return s;return s[0]?(ft(),lt()&&(n&&(t.onComplete=n),s.each(function(){var n=e.data(this,i)||{};e.data(this,i,e.extend(n,t))}).addClass(o),r=new Y(s[0],t),r.get("open")&&at(s[0])),s):s},X.position=function(t,n){function l(){g[0].style.width=w[0].style.width=m[0].style.width=parseInt(d[0].style.width,10)-B+"px",m[0].style.height=y[0].style.height=b[0].style.height=parseInt(d[0].style.height,10)-H+"px"}var r,i=0,o=0,u=d.offset(),a,f;S.unbind("resize."+s),d.css({top:-9e4,left:-9e4}),a=S.scrollTop(),f=S.scrollLeft(),P.get("fixed")?(u.top-=a,u.left-=f,d.css({position:"fixed"})):(i=a,o=f,d.css({position:"absolute"})),P.get("right")!==!1?o+=Math.max(S.width()-P.w-F-B-et(P.get("right"),"x"),0):P.get("left")!==!1?o+=et(P.get("left"),"x"):o+=Math.round(Math.max(S.width()-P.w-F-B,0)/2),P.get("bottom")!==!1?i+=Math.max(G()-P.h-j-H-et(P.get("bottom"),"y"),0):P.get("top")!==!1?i+=et(P.get("top"),"y"):i+=Math.round(Math.max(G()-P.h-j-H,0)/2),d.css({top:u.top,left:u.left,visibility:"visible"}),v[0].style.width=v[0].style.height="9999px",r={width:P.w+F+B,height:P.h+j+H,top:i,left:o};if(t){var c=0;e.each(r,function(e){if(r[e]!==J[e]){c=t;return}}),t=c}J=r,t||d.css(r),d.dequeue().animate(r,{duration:t||0,complete:function(){l(),U=!1,v[0].style.width=P.w+F+B+"px",v[0].style.height=P.h+j+H+"px",P.get("reposition")&&setTimeout(function(){S.bind("resize."+s,X.position)},1),n&&n()},step:l})},X.resize=function(e){var t;R&&(e=e||{},e.width&&(P.w=et(e.width,"x")-F-B),e.innerWidth&&(P.w=et(e.innerWidth,"x")),x.css({width:P.w}),e.height&&(P.h=et(e.height,"y")-j-H),e.innerHeight&&(P.h=et(e.innerHeight,"y")),!e.innerHeight&&!e.height&&(t=x.scrollTop(),x.css({height:"auto"}),P.h=x.height()),x.css({height:P.h}),t&&x.scrollTop(t),X.position(P.get("transition")==="none"?0:P.get("speed")))},X.prep=function(n){function u(){return P.w=P.w||x.width(),P.w=P.mw&&P.mw<P.w?P.mw:P.w,P.w}function a(){return P.h=P.h||x.height(),P.h=P.mh&&P.mh<P.h?P.mh:P.h,P.h}if(!R)return;var r,o=P.get("transition")==="none"?0:P.get("speed");x.remove(),x=Q(V,"LoadedContent").append(n),x.hide().appendTo(T.show()).css({width:u(),overflow:P.get("scrolling")?"auto":"hidden"}).css({height:a()}).prependTo(m),T.hide(),e(q).css({"float":"none"}),it(P.get("className")),r=function(){function a(){e.support.opacity===!1&&d[0].style.removeAttribute("filter")}var n=E.length,r,u;if(!R)return;u=function(){clearTimeout(W),N.hide(),ot(f),P.get("onComplete")},C.html(P.get("title")).show(),x.show(),n>1?(typeof P.get("current")=="string"&&k.html(P.get("current").replace("{current}",I+1).replace("{total}",n)).show(),A[P.get("loop")||I<n-1?"show":"hide"]().html(P.get("next")),O[P.get("loop")||I?"show":"hide"]().html(P.get("previous")),ut(),P.get("preloading")&&e.each([Z(-1),Z(1)],function(){var n,r=E[this],s=new Y(r,e.data(r,i)),o=s.get("href");o&&tt(s,o)&&(o=nt(s,o),n=t.createElement("img"),n.src=o)})):_.hide(),P.get("iframe")?(r=t.createElement("iframe"),"frameBorder"in r&&(r.frameBorder=0),"allowTransparency"in r&&(r.allowTransparency="true"),P.get("scrolling")||(r.scrolling="no"),e(r).attr({src:P.get("href"),name:(new Date).getTime(),"class":s+"Iframe",allowFullScreen:!0}).one("load",u).appendTo(x),D.one(h,function(){r.src="//about:blank"}),P.get("fastIframe")&&e(r).trigger("load")):u(),P.get("transition")==="fade"?d.fadeTo(o,1,a):a()},P.get("transition")==="fade"?d.fadeTo(o,0,function(){X.position(0,r)}):X.position(o,r)},X.next=function(){!U&&E[1]&&(P.get("loop")||E[I+1])&&(I=Z(1),at(E[I]))},X.prev=function(){!U&&E[1]&&(P.get("loop")||I)&&(I=Z(-1),at(E[I]))},X.close=function(){R&&!z&&(z=!0,R=!1,ot(l),P.get("onCleanup"),S.unbind("."+s),p.fadeTo(P.get("fadeOut")||0,0),d.stop().fadeTo(P.get("fadeOut")||0,0,function(){d.hide(),p.hide(),ot(h),x.remove(),setTimeout(function(){z=!1,ot(c),P.get("onClosed")},1)}))},X.remove=function(){if(!d)return;d.stop(),e.colorbox.close(),d.stop().remove(),p.remove(),z=!1,d=null,e("."+o).removeData(i).removeClass(o),e(t).unbind("click."+s)},X.element=function(){return e(P.el)},X.settings=r}(jQuery,document,window),define("lib-app/colorbox/jquery.colorbox",function(){}),define("lib-build/css!lib-app/colorbox/colorbox",[],function(){}),define("storymaps/tpl/ui/StoryText",["dojo/topic","esri/layers/GraphicsLayer","esri/graphic","esri/geometry/Point","esri/geometry/ScreenPoint","esri/symbols/PictureMarkerSymbol","lib-app/colorbox/jquery.colorbox","lib-build/css!lib-app/colorbox/colorbox"],function(e,t,n,r,i,s){function u(e){var t=e.replace(/(?!>)(&nbsp;)(?!<\/)/g," ");return t=$(t),t.find(".description > *").each(function(e,t){var n=$(t);n.html()!="&nbsp;"&&n.attr("tabindex","0")}),t}function a(e){var t=$(e);return t.find("iframe").each(function(e,t){var n=$(t),r=n.attr("data-unload");n.attr("data-src",n.attr("src")).attr("data-unload",r===undefined||r=="true").removeAttr("src")}),t}function f(e){e.find("iframe").each(function(e,t){var n=$(t);n.attr("src")||n.attr("src",n.data("src"))})}function l(){c($(".descLegendPanel .textEditorContent"),$(".descLegendPanel").width()-40),c($(".accordionPanel .textEditorContent"),$(".accordionPanel").width()-34)}function c(e,t){e.find(".iframe-container.fit iframe").attr("height",t*9/16)}function h(){$.each(app.data.getContentActions(),function(e,t){$("a[data-storymaps="+t.id+"]").off("click").click(function(){m(t)})}),$("#mainStagePanel").find(".backLbl").html(i18n.viewer.mainStage.back)}function p(e){var t=$(e.target),n=t.is("img")?t:t.siblings("img");o=!0,$.colorbox({href:n.attr("src"),photo:!0,title:n.parents("figure").find("figcaption").html()||n.attr("title"),scalePhotos:!0,maxWidth:"90%",maxHeight:"90%"}),setTimeout(function(){o=!1},800)}function d(){$(".textEditorContent img").each(function(e,t){var n=!!$(t).attr("width"),r=$(t).css("float")=="right";$(t).parent().css("position","relative").addClass(n?"has-width":"no-width").addClass(r?"float-right":""),$(t).wrap("<div class='image-wrapper'></div>").after($('<span class="btn-fullscreen"></span>').click(p)).click(p)}),$(document).unbind("cbox_complete",v).bind("cbox_complete",v)}function v(){$("#cboxLoadedContent img").click(function(){if(o)return;$.colorbox.close()})}function m(o){var u=app.data.getCurrentSection()&&app.data.getCurrentSection().media,a=u&&u.type=="webmap",f=a?app.map.extent:null,l=a?u.webmap.id:null;$(".mediaBackContainer").hide();if(o.type=="media"){var c=o.media.type=="webmap",h=!!c&&!!o.media.webmap.extent,p=!!c&&!!o.media.webmap.layers,d=!!c&&!!o.media.webmap.popup;e.publish("story-perform-action-media",o.media);if(h&&!p&&!d&&l==o.media.webmap.id)var v=e.subscribe("story-loaded-map",function(){v.remove(),setTimeout(function(){var e=app.map.on("update-end",function(){e.remove(),$(".mediaBackContainer").fadeOut().off("click")});$(".mediaBackContainer").click(function(){e.remove()})},800)});$(".backButton").off("click").click(function(){if(a&&(!c||l!=o.media.webmap.id))e.publish("ADDEDIT_SHOW_WEBMAP",l);else if(a&&c&&l==o.media.webmap.id){(h||d)&&app.map.setExtent(f).then(function(){app.map.infoWindow.reposition()}),d&&app.map.infoWindow.hide();if(p){var t=app.maps[l].response.itemInfo.itemData.operationalLayers,n=u.webmap.layers||[];$.each(t,function(e,t){var r=t.layerObject||(t.featureCollection?t.featureCollection.layers[0].layerObject:null),i=$(n).filter(function(e,t){return t.id==r.id});r.setVisibility(i.length?i[0].visibility:t.visibility)})}}else e.publish("story-perform-action-media",app.data.getCurrentSection().media);$(".mediaBackContainer").hide()}),d||$(".mediaBackContainer").show().css("marginLeft",-$(".mediaBackContainer .backButton").outerWidth()/2).css("marginRight",-$(".mediaBackContainer .backButton").outerWidth()/2)}else if(o.type=="zoom"){var m=null;if(!a)return;o.zoom.mapMarker&&(m=new t,m.add(new n(new r(o.zoom.center),new s(app.cfg.SECTION_ACTION_ZOOM_MAP_MARKER,32,32))),app.map.addLayer(m)),app.map.centerAndZoom(o.zoom.center,o.zoom.level).then(function(){if($("body").hasClass("layout-float")){var e=app.map.toScreen(m.graphics[0].geometry),t=null,n=null;$("body").hasClass("layout-float-right")?(t=$("#floatingPanel").position().left,e.x>=t&&(n=app.map.toMap(new i(app.map.width/2+e.x-t/2,$("#floatingPanel").height()/2)))):$("body").hasClass("layout-float-left")&&(t=$("#floatingPanel").position().left+$("#floatingPanel").width(),e.x<=t&&(n=app.map.toMap(new i(app.map.width/2-e.x+t/2,$("#floatingPanel").height()/2)))),n&&app.map.centerAt(n)}}),$(".mediaBackContainer").show().css("marginLeft",-$(".mediaBackContainer .backButton").outerWidth()/2).css("marginRight",-$(".mediaBackContainer .backButton").outerWidth()/2),$(".backButton").off("click").click(function(){app.map.setExtent(f),m&&app.map.removeLayer(m),$(".mediaBackContainer").hide()})}}var o=!1;return{prepareEditorContent:u,createMainMediaActionLink:h,createMediaFullScreenButton:d,performAction:m,styleSectionPanelContent:l,prepareContentIframe:a,loadContentIframe:f}}),define("storymaps/tpl/ui/mobile/PopupUtils",["storymaps/common/utils/CommonHelper","../StoryText"],function(e,t){function n(e){if(!e)return;e.is(":visible")?(e.toggleClass("hideContent").slideToggle(),s(e)):(i(e),e.slideToggle(400,function(){e.toggleClass("hideContent")}),t.loadContentIframe(e))}function r(e){e.addClass("hideContent").slideUp(),s(e),$.each(e.find(".content-container"),function(e,t){t.scrollTop=0})}function i(e){e.siblings(".mobilePopup").hide().addClass("hideContent"),app.ui.mobileFooter.removeMobileInvite()}function s(e){var t=e.find("iframe[data-unload=true]");t.length&&setTimeout(function(){t.each(function(e,t){var n=$(t);n.attr("src","")})},150)}return{onPopupClick:function(e){var t=$(this),n=t.offset().left+t.outerWidth(),i=t.offset().top;e.clientX>n-14&&e.clientY>i-14&&r(t)},open:function(e){if(!e)return;var n=e.find(".content-container");n.length||(n=e.children()),e.is(":visible")?n[0].scrollTop=0:(i(e),e.slideDown(400,function(){e.removeClass("hideContent")}),t.loadContentIframe(e),setTimeout(function(){n[0].scrollTop=0},410))},slideToggle:n,close:r,setColors:function(t){$(".mobilePopup").css({color:t.text,backgroundColor:t.panel}),e.addCSSRule(".mobilePopup ::-webkit-scrollbar-thumb { background-color:"+t.header+"; }","MobilePopupScrollbar")}}}),define("storymaps/tpl/ui/MainStage",["lib-build/tpl!./MainMediaContainerMap","lib-build/tpl!./MainMediaContainerImage","lib-build/tpl!./MainMediaContainerEmbed","lib-build/css!./MainStage","../core/WebApplicationData","../core/Helper","./mobile/PopupUtils","storymaps/common/utils/CommonHelper","dojo/has","esri/arcgis/utils","esri/renderers/UniqueValueRenderer","esri/geometry/Point","esri/geometry/Extent","esri/config","esri/geometry/webMercatorUtils","esri/symbols/SimpleMarkerSymbol","esri/tasks/query","esri/tasks/QueryTask","dojo/topic","dojo/on","dojo/aspect","dojo/_base/lang","dijit/layout/ContentPane"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){return function(a,f,l){function d(t){$("#mainStagePanel .medias").append(e({webmapid:t,isTemporary:!0,lblDescription:i18n.viewer.mobileInfo.description,lblLegend:i18n.viewer.mobileInfo.legend,lblLegendMobileError:i18n.viewer.mobileInfo.lblLegendMobileError,lblLegendMobileErrorExplain:i18n.viewer.mobileInfo.lblLegendMobileErrorExplain}))}function b(e,t,n,r){var i=$(".mainMediaContainer.active > iframe[data-unload=true]");i.length&&i.attr("src","");if(r){var s=$(".mainMediaContainer.active");s.fadeOut(function(){s.css("display","")})}T();if(e.type=="webmap")N(e.webmap.id,t,n,e,!1,r);else if(e.type=="image")H(e.image,r);else if(e.type=="video")B(e.video.url,e.video,r);else if(e.type=="webpage"){var o=e.webpage.url;o.lastIndexOf("#")>0&&(o=o.substring(0,o.lastIndexOf("#"))),B(o||e.webpage.ts,e.webpage,r)}}function x(){$("#mainStageLoadingIndicator").fadeIn()}function T(){$("#mainStageLoadingIndicator").fadeOut()}function N(e,t,n,r,s,u){console.log("tpl.core.MainStage - updateMainMediaMaps:",e,n,s);var a=$('.mapContainer[data-webmapid="'+e+'"]');s||($(".mainMediaContainer").removeClass("active has-error"),a.parent().addClass("active")),a.parent().toggleClass("animate",!!u);if(e)if(a.hasClass("map")&&!s&&!a.hasClass("isLoading")){var c=app.map?app.map.extent:null;app.map=app.maps[e].response.map,app.mapItem=app.maps[e].response.itemInfo,app.mapConfig=app.maps[e],C(app.map,a,t,c,n,r,!1,s)}else if(a.hasClass("map")&&!s&&a.hasClass("isLoading")){x();var d=y.subscribe("story-loaded-map",function(t){t.id==e&&(app.map=app.maps[e].response.map,app.mapItem=app.maps[e].response.itemInfo,app.mapConfig=app.maps[e],setTimeout(function(){T()},50),d.remove())})}else if(!a.hasClass("map")&&!a.hasClass("isLoading")){s||x(),a.addClass("isLoading");var m=r&&r.webmap?r.webmap.extent:null;if(m)try{m=l.getLayoutExtent(new h(m),!1)}catch(g){m=null}l.loadWebmap(e,a[0],m).then(E.hitch(p,function(u){var c=app.map?app.map.extent:null;a.removeClass("isLoading"),app.maps[e]=l.getMapConfig(u,a),s||(app.map=u.map,app.mapItem=app.maps[e].response.itemInfo,app.mapConfig=app.maps[e]),u.map.infoWindow&&($(u.map.infoWindow.domNode).addClass("light"),u.map.infoWindow.markerSymbol=(new v).setSize(0)),C(u.map,a,t,c,n,r,!0,s);if(f){app.ignoreNextEvent=!1,w.before(u.map,"setExtent",function(t){console.log("Set extent:",e),app.ignoreNextEvent||(app.lastExtentSet=t,app.ignoreNextEvent=!0)});var h=u.map.on("update-end",function(){h.remove(),app.lastExtentSet=u.map.extent,u.map.mapJournalInitExtent=u.map.extent,app.ignoreNextEvent=!0}),p=function(e){app.ignoreNextEvent?app.ignoreNextEvent=!1:app.lastExtentSet=e.extent};u.map.on("zoom-end",p),u.map.on("pan-end",p)}s||setTimeout(function(){T()},50),u.map.on("extent-change",function(){app.appCfg.mapsSyncAppOption&&i.getMapOptions().mapsSync&&a.parent().hasClass("active")&&($.each(Object.keys(app.maps),function(t,n){e!=n&&l.setMapExtent(l.getLayoutExtent(u.map.extent,!0),app.maps[n].response.map)}),app.lastMapExtent=u.map.extent),setTimeout(function(){D(u.map,u.map.infoWindow)},100)}),a.siblings(".mobileInfo").find(".content-toggles .btn").click(app.ui.mobileEntryInfo.onPopupContentToggle);var d=new S({},a.siblings(".mobileInfoWindow").find(".dijitContainer")[0]);d.startup(),u.map.infoWindow.on("set-features",function(){var e=$("body").hasClass("mobile-view");if(e){var t=u.map.infoWindow.getSelectedFeature();d.set("content",t?t.getContent():""),o.open(a.siblings(".mobileInfoWindow"))}u.map.infoWindow.set("popupWindow",!e)}),w.after(u.map.infoWindow,"show",function(){D(u.map,u.map.infoWindow)}),app.lastMapExtent||(app.lastMapExtent=u.map.extent),a.parent().removeClass("has-error")}),E.hitch(p,function(){s||T(),a.removeClass("isLoading"),a.parent().addClass("has-error"),a.parent().find(".error").html(i18n.viewer.errors.mapLoadingFail),y.publish("story-loaded-map",{id:e,index:n}),y.publish("ADDEDIT_LOAD_WEBMAP_FAIL")})),setTimeout(function(){y.publish("story-section-map-timeout")},2e3)}}function C(e,t,n,r,o,u,a,f){p.updateMainStageWithLayoutSettings(),P();try{e.resize(),e.reposition()}catch(c){}if(n||u){var d=u&&u.webmap?u.webmap.layers:null,v=app.maps[u.webmap.id].response.itemInfo.itemData.operationalLayers;$.each(v,function(e,t){var n;if(t.layerObject){n=$(d).filter(function(e,n){return n.id==t.layerObject.id});var r=function(){t.layerObject.setVisibility(n.length?n[0].visibility:t.visibility)};t.layerObject.loaded?r():t.layerObject.on("load",r)}else t.featureCollection&&t.featureCollection.layers&&$.each(t.featureCollection.layers,function(e,t){n=$(d).filter(function(e,n){return n.id.split("_").slice(0,-1).join("_")==t.layerObject.id.split("_").slice(0,-1).join("_")}),t.layerObject.setVisibility(n.length?n[0].visibility:t.visibility)})});var m=u&&u.webmap?u.webmap.extent:null;if(m)try{m=new h(m)}catch(c){}app.firstMapIsPreloaded&&!app.lastMapExtent?m=s.getLayoutExtent(m||e._params.extent,!0):f&&a&&k(o)&&app.lastMapExtent?m=s.getLayoutExtent(app.lastMapExtent,!0):!a&&k(o)?m=null:!m&&!k(o)?(m=s.getLayoutExtent(e._params.extent,!0),m=s.getLayoutExtent(m,!1)):!m&&k(o)&&app.lastMapExtent?m=s.getLayoutExtent(app.lastMapExtent,!0):m||(m=s.getLayoutExtent(e._params.extent,!0),a&&(m=s.getLayoutExtent(m,!1)));var g=function(){y.publish("story-loaded-map",{id:u.webmap.id,index:o})};m?l.setMapExtent(m,e).then(function(){L(e,u.webmap.popup,o),g()}):g();var b=u.webmap.overview||{},w=u.webmap.legend||{},E=i.getSettings().mapOptions;E&&E.overview&&E.overview&&(b=E.overview),o===null&&n.media&&n.media.webmap&&(b=n.media.webmap.overview||{},w=n.media.webmap.legend||{}),b.enable!==undefined&&(app.maps[u.webmap.id].overview.toggle(b.enable,i.getColors()),app.maps[u.webmap.id].overview.toggleExpanded(b.openByDefault),app.maps[u.webmap.id].overview.setSettings(b)),w.enable!==undefined&&(app.maps[u.webmap.id].legend.toggle(w.enable),app.maps[u.webmap.id].legend.toggleExpanded(w.openByDefault),app.maps[u.webmap.id].legend.setSettings(w)),m||L(e,u.webmap.popup,o)}else y.publish("ADDEDIT_WEBMAP_DONE")}function k(e){if(app.appCfg.mapsSyncAppOption&&i.getMapOptions().mapsSync){var t=Number.MAX_VALUE;return $.each(app.data.getWebmapsInfo(),function(e,n){var r=Math.min.apply(null,n.entries);t=Math.min(t,r)}),e>=t-1}return!1}function L(e,t,n){e.infoWindow&&e.infoWindow.hide();if(t){var r=e.getLayer(t.layerId),i=t.layerId?t.layerId.split("_").slice(0,-1).join("_"):"",s=e.getLayer(i);e.infoWindow.clearFeatures();if(r)if(r.updating)var o=r.on("update-end",function(){o.remove(),A(e,t,n)});else A(e,t,n);else if(s){var u=t.layerId.split("_").slice(-1).join("_"),a=s.url+"/"+u,f=E.getObject("infoTemplates."+u+".layerUrl",!1,s);a=f||a,O(e,t,n,i,u,a)}else var l=app.map.on("update-end",function(){L(e,t,n),l.remove()})}}function A(e,t,n){var r=new m,i=e.getLayer(t.layerId);if(!i)return;r.objectIds=[t.fieldValue],i._collection||(r.returnGeometry=!0,r.outFields=["*"],r.outSpatialReference=e.spatialReference);if(!i.queryFeatures)return;i.queryFeatures(r).then(function(r){M(e,t,r.features,n)})}function O(e,t,n,r,i,s){var o=new g(s),u=new m,a=e.getLayer(r);if(!a)return;u.objectIds=[t.fieldValue],u.returnGeometry=!0,u.outFields=["*"],u.outSpatialReference=e.spatialReference,o.execute(u,function(s){M(e,t,s.features,n,r,i)})}function M(e,t,n,r,i,s){if(!e||!t||!n||!n.length)return;var o=n[0].geometry,u=null;t.anchorPoint?u=new c(t.anchorPoint):u=o.getExtent()?o.getExtent().getCenter():o,i?(n[0].infoTemplate=e.getLayer(i).infoTemplates[s].infoTemplate,e.infoWindow.setContent(n[0].getContent())):e.infoWindow.setFeatures(n),e.infoWindow.show(u),e.extent.contains(u)||(e.centerAt(u),r===null&&$(".mediaBackContainer").show().css("marginLeft",-$(".mediaBackContainer .backButton").outerWidth()/2).css("marginRight",-$(".mediaBackContainer .backButton").outerWidth()/2))}function D(e,t){if(!e||!t||!t.getSelectedFeature()||!t.location)return;var n=$(e.container),r=n.width(),i=n.height(),s=e.toScreen(e.infoWindow.location),o=n.find(".esriSimpleSlider:visible, .geocoderBtn:visible"),u=o.last().position()||{left:0},a=$(".descLegendPanel:visible").position(),f=300;$(".esriPopup").removeClass("app-hidden"),a&&a.left&&(r=a.left),o.length==1&&(u.top+=60),s.x<f+u.left&&s.y<i/3?t.set("anchor","bottom-right"):s.x<r-f&&s.y<i/3?t.set("anchor","bottom"):s.x>=r-f&&s.y<i/3?t.set("anchor","bottom-left"):s.x<r-f&&s.y<i*2/3?t.set("anchor","right"):s.x>=r-f&&s.y<i*2/3?t.set("anchor","left"):s.x<f+u.left&&s.y>=i*2/3?t.set("anchor","top-right"):s.x<r-f&&s.y>=i*2/3?t.set("anchor","top"):t.set("anchor","top-left"),s.x<u.left+30&&s.y<u.top+30&&$(".esriPopup").addClass("app-hidden"),a&&s.y<$(".descLegendPanel:visible").height()+20&&(a.left===0?s.x<$(".descLegendPanel:visible").width()&&$(".esriPopup").addClass("app-hidden"):s.x>a.left&&$(".esriPopup").addClass("app-hidden")),(s.x<=0||s.y<=10||s.x>=r||s.y>=i)&&$(".esriPopup").addClass("app-hidden")}function P(){if(app.mapConfig){var e=app.data.getWebAppData().getColors();app.mapConfig.overview.setColors(e),app.mapConfig.legend.setColors(e)}}function H(e,t){$(".mainMediaContainer").removeClass("active");var n=$('.imgContainer[data-src="'+e.url+'"]');if(n.length){n.css("background-image")=="none"&&x();var r=e.url;if(e.sizes){var i=_.sortBy(e.sizes,"width").reverse();r=i[0].url;if(i.length>1){var s=e.display&&e.display==="fit"?$("#mainStagePanel").width():$("body").width();_.some(i,function(e){return e.width&&e.width<s?!0:(r=e.url,!1)})}}var o=u.possiblyAddToken(r);n.parent().addClass("active").toggleClass("animate",!!t);var a=new Image;a.src=o,a.onload=function(){n.removeClass("center fit fill stretch").addClass(e.display).css({left:0,right:0}).css("background-image",'url("'+o+'")'),p.updateMainStageWithLayoutSettings(),n.parent().hasClass("active")&&setTimeout(T(),100)}}}function B(e,t,n){var r=e;try{r=btoa(e)}catch(i){}$(".mainMediaContainer").removeClass("active");var s=$('.embedContainer[data-src="'+r+'"]');if(!s.length){s=$('.embedContainer[data-ts="'+e+'"]');try{r=btoa(s.data("src"))}catch(i){r=s.data("src")}}if(s.length){s.removeClass("center fit fill stretch").addClass(t.display).attr("data-unload",t.hash===undefined&&(t.unload===undefined||t.unload)).css({left:0,right:0}),r.match("//")||(r=atob(r)),t.hash&&(r=r+"#"+t.hash,s.attr("src",r)),s.attr("src")||(s.off("load").load(T),x(),r.match("//player.vimeo.com/video")&&!r.match("transparent=0")&&(r.match(/\?/)?r+="&transparent=0":r+="?transparent=0"),s.attr("src",r));var o=t.width||"560",u=t.height||"315";t.display=="fit"&&(o="",u=""),o&&(o.match(/[0-9]+%/)||(o+="px"),s.attr("width",o)),u&&(u.match(/[0-9]+%/)||(u+="px"),s.attr("height",u)),s.parent().addClass("active").toggleClass("animate",!!n),p.updateMainStageWithLayoutSettings()}}function j(){$(".mainMediaContainer.active iframe.embedContainer.fit").attr("height",$("#mainStagePanel").width()*9/16)}var p=this;this.updateMainMediaContainers=function(){var r=app.data.getWebmaps(),i=app.data.getImages(),s=app.data.getEmbeds();$.each(r,function(t,n){var r=$('.mapContainer[data-webmapid="'+n+'"]');r.length||$("#mainStagePanel .medias").append(e({webmapid:n,isTemporary:!1,lblDescription:i18n.viewer.mobileInfo.description,lblLegend:i18n.viewer.mobileInfo.legend,lblLegendMobileError:i18n.viewer.mobileInfo.lblLegendMobileError,lblLegendMobileErrorExplain:i18n.viewer.mobileInfo.lblLegendMobileErrorExplain}))}),$(".mapContainer").each(function(){var e=$(this).data("webmapid");$.inArray(e,r)==-1&&($(this).parent().remove(),app.maps[e]&&(app.maps[e].response.map.destroy(),delete app.maps[e]))}),$.each(i,function(e,n){var r=$('.imgContainer[data-src="'+n+'"]');r.length||$("#mainStagePanel .medias").append(t({url:n}))}),$(".imgContainer").each(function(){$.inArray($(this).data("src"),i)==-1&&$(this).parent().remove()}),$.each(s,function(e,t){var r=t.url,i="";r.lastIndexOf("#")>0&&(r=r.substring(0,r.lastIndexOf("#")),i=t.url.substring(t.url.lastIndexOf("#")+1),t.hash=i);try{r=btoa(r)}catch(s){}var o=$('.embedContainer[data-src="'+r+'"]');o.length||(o=$('.embedContainer[data-ts="'+t.ts+'"]'));if(!o.length){$("#mainStagePanel .medias").append(n({url:r,frameTag:t.frameTag,unload:t.unload===undefined||!!t.unload}));if(!!t.frameTag){var u=$("#mainStagePanel .medias .mainMediaContainer").last().find("iframe").first();u.addClass("embedContainer").attr("data-src",u.attr("src")).removeAttr("src").attr("data-ts",t.ts).attr("data-unload",t.unload===undefined||!!t.unload)}}}),$(".embedContainer").each(function(){var e=$(this).data("ts");e||(e=$(this).data("src"),e.match("//")||(e=atob(e)));var t=$.grep(s,function(t){var n=t.url;return n.lastIndexOf("#")>0&&(n=n.substring(0,n.lastIndexOf("#"))),e==n||e==t.ts}).length>0;t||$(this).parent().remove()}),P(),$(".mainMediaContainer").find(".mobilePopup").off("click").click(o.onPopupClick)},this.updateMainMediaWithStoryMainMedia=function(e,t){var n=app.data.getStoryByIndex(e);n&&n.media&&b(n.media,n,e,t),y.publish("story-load-entry",e)},this.updateMainMediaWithStoryAction=function(e){b(e,app.data.getCurrentSection(),null,!0)},this.updateMainStageWithLayoutSettings=function(){var e=i.getLayoutId(),t=app.data.getWebAppData().getColors(),n=i.getPanelCfg(),r=n.position=="left",s=$("body").width(),o=0,u=null;j(),a.css("background-color",t.media),P();if(e=="tab"||e=="bullet"){o=$("#descLegendPanel:visible").width()||0,u=$("#descLegendPanel:visible").position()||{};var f=$(".mainMediaContainer.active .overviewContainer:visible").css("right"),l=191;if(e=="tab"||e=="bullet")o?r?$(".mainMediaContainer.active .esriControlsBR").css({left:"",right:f?l+10:""}):($(".mainMediaContainer.active .esriControlsBR").css({left:f?l+10:"",right:"initial"}),$(".mainMediaContainer.active .esriAttribution").css("float","inherit"),setTimeout(function(){$(".mainMediaContainer.active .esriAttribution").css("float","")},0)):$(".mainMediaContainer.active .esriControlsBR").css({left:"",right:""});$(".mapConfigOverlay.position, .mapConfigOverlay.popup, #mainStageLoadingIndicator, .mainStageErrorContainer").css("left",r?(o+s)/2:(s-o)/2),$("body").hasClass("mobile-view")&&$("#mainStageLoadingIndicator, .mainStageErrorContainer").css("left","50%");var c=r?"padding-left":"padding-right",h=r?"left":"right",p=u.left;r?p+=o:p=s-u.left,$(".centerAlignOnFloat").css({paddingRight:0,paddingLeft:0}).css(c,p),s<=1067&&$("#builderHelp").css(c,0),$(".mainMediaContainer .imgContainer.center").css({left:0,right:0}).css(h,p),$(".mainMediaContainer .embedContainer.center").css({left:0,right:0}).css(h,p),$(".mainMediaContainer .embedContainer.custom").css({left:0,right:0}).css(h,p);if(!o)$("#autoplay").css({left:"50%",right:"inherit"});else{var d=r?s-(u.left+o):u.left,v=$("#descLegendPanel:visible").height(),m=$("#contentPanel").height();v<=m/2?$("#autoplay").css({left:"50%",right:"inherit"}):$("#autoplay").css({left:"inherit",right:"inherit"}).css(h,p+d/2)}}else $(".mainMediaContainer.active .esriControlsBR").css({left:"",right:""}),$(".mapConfigOverlay.position, .mapConfigOverlay.popup, #mainStageLoadingIndicator, .mainStageErrorContainer").css("left","50%"),$(".centerAlignOnFloat").css({paddingRight:0,paddingLeft:0}),$(".mediaBackContainer").css({left:"50%",right:"inherit"}),$(".mainMediaContainer .imgContainer.center").css({left:0,right:0}),$(".mainMediaContainer .embedContainer.center").css({left:0,right:0}),$(".mainMediaContainer .embedContainer.custom").css({left:0,right:0}),$("#autoplay").css({left:"50%",right:"inherit"})},this.preloadAllMaps=function(e){var t=app.data.getStoryEntries(),n=t[0],r=t.slice(1),i=0;if(!n)return;if(n.media&&n.media.type=="webmap")$.each(r,function(t,n){n.media&&n.media.type=="webmap"&&(e||i<4)&&(N(n.media.webmap.id,n,t+1,n.media,!0,!1),i++)});else{var s=-1;$.each(r,function(t,n){if(s!=-1)return;if(n.media&&n.media.type=="webmap"){s=t+1,app.firstMapIsPreloaded=!0,N(n.media.webmap.id,n,s,n.media,!0,!1);var o=y.subscribe("story-loaded-map",function(){o.remove(),$.each(r.slice(s),function(t,n){n.media&&n.media.type=="webmap"&&(e||i<4)&&(N(n.media.webmap.id,n,t+s+1,n.media,!0,!1),i++)})})}})}},this.showWebmapById=function(e){N(e,null,null,null)},this.reloadCurrentWebmap=function(){var t=app.data.getCurrentEntry();if(t&&t.media&&t.media.webmap){var n=t.media.webmap.id,r=$('.mapContainer[data-webmapid="'+n+'"]');r.parent().remove(),app.maps[n]&&(app.maps[n].response.map.destroy(),delete app.maps[n]),$("#mainStagePanel .medias").append(e({webmapid:n,isTemporary:!1,lblDescription:i18n.viewer.mobileInfo.description,lblLegend:i18n.viewer.mobileInfo.legend,lblLegendMobileError:i18n.viewer.mobileInfo.lblLegendMobileError,lblLegendMobileErrorExplain:i18n.viewer.mobileInfo.lblLegendMobileErrorExplain})),y.publish("story-navigate-entry",app.data.getCurrentEntryIndex())}},this.loadTmpWebmap=function(e){$('.mapContainer[data-webmapid="'+e+'"]').length||d(e),N(e,null,null,null)}}}),define("storymaps/tpl/core/Config",[],function(){var e="resources/tpl/viewer/icons/esri-logo.png",t="http://www.esri.com",n="http://storymaps.arcgis.com";return app.appCfg={supportWebmapPreviewAGOL:!1,webmapStory:!1,createWebmap:!1,useWebmapInApp:!1,useStandardHeader:!0,useAppTitleAsPageTitle:!0,headerCompactOpt:!0,headerCompactByDefault:!0,mapsSyncAppOption:!0,mapsUseTermSection:!1,mapsImmediateResize:!0,mapCommandLargerTouch:!1,mediaPickerDisableVideo:!1,mediaPickerDisableWebPage:!1,mediaPickerSkipConfigure:!1,mediaPickerConfigureForceMode:null},app.appCfg.getLayoutThumbnail=function(e){e=e||{};var t=e.layout||n.id,n=app.data.getLayoutStaticConfig(t),r=e.theme||n.themes[0],i=e.options||{panel:{position:n.positions[0],size:"medium"}},s=e.selected||!1,o=e.contentLabel||!1,u="",a="",f="",l="",c=15;t=="bullet"?c=18:t=="tab"&&(c=21),u+='<div class="layout-thumbnail'+(s?" selected":"")+"\" data-colors='"+JSON.stringify(r)+"'>",u+='<div class="layout-selected"></div>',u+='<div class="layout-header" style="height: $size$%; background-color:$color$; $styleOpt$"><span class="thumb-content $contentClass$" style="$contentStyle$">$content$</span></div>',u=u.replace("$size$",c).replace("$color$",r.header).replace("$styleOpt$","");if(t!="accordion"){var h="header-tabs",p="header-tab",d="";t=="bullet"&&(h="header-bullets",p="header-bullet");for(var v=1;v<=3;v++){var m="background-color: "+r.tab+"; color:"+r.tabText+";";v==1&&(m="background-color: "+r.tabActive+"; color:"+r.tabTextActive+";"),d+='<span class="'+p+'" style="'+m+'">',t=="tab"?d+="Tab "+v:i.reverse?d+=3-v+1:d+=v,d+="</span>"}u=u.replace("$contentClass$",h).replace("$content$",d)}a='<div class="layout-block" style="width: $size$%; height: $height$%; background-color:$color$; $styleOpt$"><span class="thumb-content $contentClass$" style="$contentStyle$">$content$</span></div>';var g=0,y=0,b=100-c-1,w="",E="",S="";t=="accordion"?(i.panel.size=="small"?(g=23,y=71):i.panel.size=="large"?(g=43,y=51):(g=28,y=66),w="float: left;",i.panel.position=="left"?E+="margin-left: 3%;":S+="margin-left: 3%;"):(y=94,E="position: absolute; top: calc("+c+"% + 4px); z-index:1; height: 35% !important; opacity: 0.8;",S+="margin-left: 3%;",i.panel&&(i.panel.position=="left"?E+="left: 3%":E+="right: 3%",i.panel.size=="small"?g=23:i.panel.size=="large"?g=43:g=28)),f=a.replace("$size$",g).replace("$height$",b).replace("$color$",r.panel).replace("$styleOpt$",w+E),l=a.replace("$size$",y).replace("$height$",b).replace("$color$",r.media).replace("$styleOpt$",w+S),o&&t=="accordion"&&(f=f.replace("$contentClass$","panel-lbl rotate").replace("$contentStyle$","color: "+r.text).replace("$content$",n.title)),i.panel?i.panel.position=="left"?u+=f+l:u+=l+f:u+=l,u=u.replace(/\$contentStyle\$/g,"").replace(/\$contentClass\$/g,"").replace(/\$content\$/g,"");if(!o&&r&&r.name&&r.name.match){var x;r.name.match(/-org$|-modified$/)&&(r.name.match(/-modified$/)?x=i18n.builder.settingsThemeOptions.lblModTheme:x=i18n.builder.settingsThemeOptions.lblOrgTheme,u+='<div class="theme-label">'+x+"</div>")}return u+="</div>",u},{checkConfigFileIsOK:function(){return app.cfg.HEADER_LOGO_URL=e,app.cfg.HEADER_LOGO_TARGET=t,app.cfg.HEADER_LINK_TEXT=i18n.viewer.headerFromCommon.storymapsText,app.cfg.HEADER_LINK_URL=n,app.cfg&&app.cfg.HEADER_LOGO_URL!==undefined&&app.cfg.HEADER_LOGO_TARGET!==undefined&&app.cfg.HEADER_LINK_TEXT!==undefined&&app.cfg.HEADER_LINK_URL!==undefined&&app.cfg.HEADER_SOCIAL&&app.cfg.MAX_NB_ENTRIES&&app.cfg.TIMEOUT_VIEWER_LOAD&&app.cfg.TIMEOUT_VIEWER_REQUEST&&app.cfg.TIMEOUT_BUILDER_REQUEST&&app.cfg.LAYOUTS&&app.cfg.LAYOUTS.length&&app.cfg.HELP_URL&&app.cfg.HELP_URL_PORTAL&&app.cfg.TPL_NAME&&app.cfg.TPL_ID&&app.cfg.WEBAPP_TAG&&app.cfg.WEBAPP_KEYWORD_GENERIC&&app.cfg.WEBAPP_KEYWORD_APP&&app.cfg.AUTHORIZED_IMPORT_SOURCE&&app.cfg.FLICKR_API_KEY&&app.cfg.YOUTUBE_DISABLE_ON_PORTAL!==undefined&&app.cfg.YOUTUBE_API_KEY&&app.cfg.CORS_SERVER&&app.cfg.DEFAULT_SHARING_URL&&app.cfg.DEFAULT_PROXY_URL&&app.cfg.BING_MAPS_KEY!==undefined&&app.cfg.HELPER_SERVICES!==undefined&&app.cfg.HELPER_SERVICES.geometry!==undefined&&app.cfg.HELPER_SERVICES.geocode!==undefined}}}),define("storymaps/tpl/core/Data",["./WebApplicationData","storymaps/common/utils/CommonHelper","dojo/topic","esri/arcgis/utils"],function(e,t,n,r){return function(){function c(e){r.getItem(e).then(function(t){u[e]={title:t.item.title,sharing:t.item.access.toUpperCase()},n.publish("LOADED_WEBMAP_INFOS",{id:e,title:t.item.title,sharing:t.item.access.toUpperCase()})})}var s=null,o=null,u={},a=null;this.getWebMap=function(){return s},this.setWebMap=function(e){s=e},this.getWebAppItem=function(){return o||{}},this.setWebAppItem=function(e){o=e},this.getWebAppData=function(){return e},this.updateAfterSave=function(){e.updateAfterSave()},this.userIsAppOwner=function(){var e=app.portal?app.portal.getPortalUser():null;return e&&e.username==this.getWebAppItem().owner||t.getPortalUser()!=null&&t.getPortalUser()==this.getWebAppItem().owner||e&&e.privileges&&$.inArray("portal:admin:updateItems",e.privileges)>-1||this.getWebAppItem().itemControl=="admin"||this.getWebAppItem().itemControl=="update"},this.checkUserItemPrivileges=function(){var e=app.portal?app.portal.getPortalUser():null;return e&&!e.orgId&&!e.privileges||e&&e.privileges&&$.inArray("portal:user:createItem",e.privileges)>-1},this.isOrga=function(){return!app.portal||!app.portal.getPortalUser()?!1:!!app.portal.getPortalUser().orgId},this.getAppProxies=function(){return a},this.setAppProxies=function(e){a=e};var f=null,l=null;this.getStoryStorage=function(){return f},this.setStoryStorage=function(e){f=e},this.getStory=function(){return f=="WEBAPP"?e.getStory()||{}:{}},this.getStoryEntries=function(){var t=[],n=[];return f=="WEBAPP"&&(t=e.getStoryEntries()),t=t.slice(0,app.cfg.MAX_NB_ENTRIES),app.isInBuilder?t||[]:($.each(t||[],function(e,t){t.status=="PUBLISHED"&&n.push(t)}),n)},this.cleanEntriesMarkup=function(){$.each(this.getStoryEntries(),function(e,t){this.cleanEntryMarkup(t)}.bind(this))},this.cleanEntryMarkup=function(e){var n=e.description;if(!n)return;var r=$("<div>"+n+"</div>");r.find("img").each(function(e,n){var r=$(n);r.attr("src",t.possiblyAddToken(r.attr("src")))}),e.description=r.html()},this.getStoryLength=function(){return this.getStoryEntries().length},this.getStoryByIndex=function(e){return this.getStoryEntries()[e]},this.getCurrentSection=function(){return this.getStoryByIndex(l)},this.getCurrentSectionIndex=function(){return l},this.setCurrentSectionIndex=function(e){l=e},this.addStorySection=function(t){e.setStoryEntries(this.getStoryEntries().concat(t)),this.setCurrentSectionIndex(this.getStoryLength()-1)},this.editSection=function(t,n){var r=this.getStoryEntries();r[t]=n,e.setStoryEntries(r)},this.organizeStory=function(t,n){e.setStoryEntries(t),n==-1&&(n=0),this.setCurrentSectionIndex(n)},this.getWebmaps=function(){var e=$.map(this.getStoryEntries(),function(e){return e.media&&e.media.type=="webmap"&&e.media.webmap?e.media.webmap.id:null});return e=$.grep(e,function(t,n){return!t||t.length!=32?!1:n==$.inArray(t,e)}),e},this.getWebmapsInfo=function(){var t=[],n={},r=function(e,t,r){n[e]?n[e][t].indexOf(r)==-1&&n[e][t].push(r):(n[e]={entries:[],actions:[]},n[e][t].push(r))};$.each(this.getStoryEntries(),function(e,t){t.media&&t.media.type=="webmap"&&t.media.webmap&&r(t.media.webmap.id,"entries",e+1),t.contentActions&&$.each(t.contentActions,function(t,n){n.type=="media"&&n.media.webmap&&r(n.media.webmap.id,"actions",e+1)})});if(app.isInBuilder){var i=e.getSourceWebmap();i&&!n[i]&&(n[i]={})}return $.each(Object.keys(n),function(e,r){var i=u[r];if(!i){if(app.maps[r]){u[r]={title:app.maps[r].response.itemInfo.item.title,sharing:app.maps[r].response.itemInfo.item.access.toUpperCase()},t.push({id:r,title:app.maps[r].response.itemInfo.item.title,sharing:app.maps[r].response.itemInfo.item.access.toUpperCase(),entries:n[r].entries});return}c(r)}t.push({id:r,title:i?i.title:null,sharing:i?i.sharing:null,entries:n[r].entries})}),t},this.getWebmapTitle=function(e){return u[e]?u[e].title:""},this.getWebmapSharing=function(e){return u[e]?u[e].sharing:""},this.getImages=function(){var e=$.map(this.getStoryEntries(),function(e){return e.media&&e.media.type=="image"&&e.media.image?e.media.image.url:null});return e=$.grep(e,function(t,n){return n==$.inArray(t,e)}),e},this.getAllImageUrls=function(){return _.map(this.getImages().concat(this.getSidebarImages().concat([e.getLogoURL()])),this.getNonProtocolNonDoubleSlashUrl)},this.getSidebarImages=function(){var e=this.getStoryEntries(),n=[];return _.each(e,function(e){var r=$(e.description);_.each(r.find("img"),function(e){n.push(t.possiblyRemoveToken(e.src))})}),n},this.getNonProtocolNonDoubleSlashUrl=function(e){return e.replace(/http[s]?\:\/\//,"").replace("//","/")},this.getEmbeds=function(){var e=$.map(this.getStoryEntries(),function(e){return!e||!e.media||e.media.type!="video"&&e.media.type!="webpage"||!e.media[e.media.type]?null:e.media[e.media.type]});return e=$.grep(e,function(t,n){return n==$.inArray(t,e)}),e},this.getCurrentLayoutStaticConfig=function(){return this.getLayoutStaticConfig(e.getLayoutId())},this.getLayoutStaticConfig=function(e){var t=$.grep(app.cfg.LAYOUTS,function(t){return t.id==e});return!t||!t.length?null:t[0]},this.debug=function(){console.table&&console.table(app.data.getStoryEntries()),$.each(app.data.getStoryEntries(),function(e,t){console.log("%c%s","font-weight: bold; font-size: 18px;","["+e+"-"+t.title+"]"),console.log("%c%s","font-weight: bold; font-size: 16px;","> MEDIA"),console.log(JSON.stringify(t.media,null,"	")),console.log("%c%s","font-weight: bold; font-size: 16px;","> ACTIONS"),console.log(JSON.stringify(t.contentActions,null,"	"))})},this.getCurrentEntryIndex=function(){return l},this.getCurrentEntry=function(){return this.getStoryByIndex(l)}}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/AccordionPanelEntry",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="entry '+((__t=optHtmlClass)==null?"":__t)+'">\n	<div class="accordion-header"> 					<!-- todo rename all that prefixing -->\n		<div class="accordion-header-arrow"></div>\n		<table class="accordion-header-content" tabindex="0">\n			<tr>\n				',index>=10?__p+='\n					<td class="accordion-header-number twodigits">'+((__t=index)==null?"":__t)+"</td>\n				":__p+='\n					<td class="accordion-header-number">'+((__t=index)==null?"":__t)+"</td>\n				",__p+='\n				<td class="accordion-header-title">\n					<div class="accordion-header-title-wrapper">'+((__t=title)==null?"":__t)+"</div>\n				</td>\n			</tr>\n		</table>\n		",isInBuilder&&(__p+='\n			<div class="panelEditBtn">\n				<div class="panelEditBtnInner"></div>\n			</div>\n		'),__p+='\n	</div>\n	<div class="accordion-content">\n		',isInBuilder?__p+='\n			<textarea name="descriptionEditor" class="descriptionEditor" placeholder="'+((__t=editorPlaceholder)==null?"":__t)+'">\n				'+((__t=description)==null?"":__t)+"\n			</textarea>\n		":__p+='\n			<div class="description">\n				'+((__t=description)==null?"":__t)+"\n			</div>\n		",__p+="\n	</div>\n</div>";return __p}}),define("lib-build/css!storymaps/tpl/ui/desktop/AccordionPanel",[],function(){}),define("lib-build/css!storymaps/tpl/ui/desktop/Common",[],function(){}),define("storymaps/tpl/ui/desktop/AccordionPanel",["lib-build/tpl!./AccordionPanelEntry","lib-build/css!./AccordionPanel","lib-build/css!./Common","../StoryText","storymaps/common/utils/CommonHelper","dojo/topic"],function(e,t,n,r,i,s){return function(n,o,u){function c(t,i){var o=t.length,u="";$.each(t,function(t,n){var r=i.reverse?o-t:t+1;u+=e({index:r,title:n.title,description:n.description,optHtmlClass:n["status"]!="PUBLISHED"?"hidden-entry":"",isInBuilder:app.isInBuilder,editorPlaceholder:app.isInBuilder?i18n.builder.textEditor.placeholder1:""})}),app.isInBuilder?n.find(".content").html(u):n.find(".content").html(r.prepareContentIframe(r.prepareEditorContent(u))),n.find(".accordion-header").click(m);var a=n.find(".accordion-header-content");a.focus(function(){$(this).data("mouseDown")||$(this).click()}).mousedown(function(){$(this).data("mouseDown",!0)}).mouseup(function(){$(this).removeData("mouseDown")});var f=a.last();f.siblings(".accordion-content").find("[tabindex=0]").length&&(f=f.siblings(".accordion-content").find("[tabindex=0]").last()),f.on("keydown",function(e){if(e.keyCode===9&&!e.shiftKey)return s.publish("story-tab-navigation",{from:"panel",direction:"forward"}),!1})}function h(e){n.css("width",e.panel.sizeVal),n.toggleClass("is-numbered",!!e.numbering)}function p(){var e=n.outerHeight(),t=0;n.find(".accordion-header").each(function(){t+=$(this).outerHeight()+1}),o&&(t+=n.find(".builder-content-panel").outerHeight()),e-t<120?n.find(".accordion-content").css("height","").css("max-height",e/1.5):n.find(".accordion-content").css("height",e-t).css("max-height",""),o&&n.find(".content").css("height",n.height()-n.find(".builder-content-panel").outerHeight())}function d(e){var t=e.find("iframe[data-unload=true]");t.length&&setTimeout(function(){t.each(function(e,t){var n=$(t);n.attr("src","")})},150)}function v(e){n.css({color:e.text,backgroundColor:e.panel}),i.addCSSRule(".accordionPanel .accordion-header-arrow { border-left-color: "+e.accordionArrow+"; }"+".accordionPanel .entry.active .accordion-header-arrow { border-left-color: "+e.accordionArrowActive+"; }"+".accordionPanel .entry:not(.active) .accordion-header:hover .accordion-header-arrow { border-left-color: "+e.accordionArrowHover+"; }"+".accordionPanel .entry { border-top: 1px solid "+e.accordionArrow+"; }","AccordionColorArrow"),i.addCSSRule(".accordionPanel .accordion-header-number { color: "+e.accordionNumber+"; }","AccordionColorNumber"),i.addCSSRule(".accordionPanel .accordion-header-title { color: "+e.accordionTitle+"; }","AccordionColorTitle"),i.addCSSRule(".accordionPanel ::-webkit-scrollbar-thumb { background-color:"+e.header+"; }","AccordionScrollbar")}function m(e){$(e.target).hasClass("panelEditBtnInner")?app.builder.openEditPopup({entryIndex:a.getEntryIndex()}):u($(this).parents(".entry").index())}function g(){}function y(){}var a=this,f=null,l=null;o&&require(["storymaps/tpl/builder/InlineEditor"],function(e){l=new e}),this.init=function(e,t,n,r){f=null,h(n),v(r),y(),o&&g(),c(e,n),this.showEntryIndex(t,!1,!0)},this.update=function(e,t){h(e),v(t)},this.resize=function(){p()},this.showEntryIndex=function(e,t,i){if(f!=e||t){d(n.find(".entry.active")),r.loadContentIframe(n.find(".entry").eq(e));var s=n.find(".entry.active"),u=n.find(".entry").eq(e);s.removeClass("active"),i?s.hide():s.find(".accordion-content").slideUp(),u.addClass("active"),i?u.find(".accordion-content").show():u.find(".accordion-content").slideDown(),o&&(n.find(".entry.active .cke_editor_descriptionEditor").length||l.init(n.find(".entry.active"))),f=e}},this.getEntryIndex=function(){return f},this.destroy=function(){n.hide()}}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/NavBar",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="nav-bar">\n	<div class="entries">\n		<ul class="nav nav-tabs">\n			<!-- \n				tabs and the more button are injected here \n			-->\n		</ul>\n	</div>\n	<div class="builder-content-panel inline">\n		<span class="builder-content-panel-group builder-edit btn btn-sm btn-default">\n			<div class="builder-btn"></div>\n			<div class="builder-lbl"></div>\n		</span>\n		\n		<span class="builder-content-panel-group builder-add btn btn-sm btn-default">\n			<div class="builder-btn"></div>\n			<div class="builder-lbl"></div>\n		</span>\n		<span class="builder-content-panel-group builder-organize btn btn-sm btn-default">\n			<div class="builder-btn"></div>\n			<div class="builder-lbl"></div>\n		</span>\n	</div>\n	<div class="builder-mask"></div>\n</div>';return __p}}),define("lib-build/css!storymaps/tpl/ui/desktop/NavBar",[],function(){}),define("lib-build/tpl!storymaps/tpl/ui/desktop/NavBarEntry",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<li class="entry '+((__t=optHtmlClass)==null?"":__t)+'" data-title="'+((__t=tooltip)==null?"":__t)+'">\n	<a class="entryLbl" tabindex="0">'+((__t=value)==null?"":__t)+"</a>\n</li>";return __p}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/NavBarEntryMore",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<li class="dropdown pull-right"> <!-- tabindex="0" -->\n	<a class="dropdown-toggle" data-toggle="dropdown">\n		<span class="glyphicon glyphicon-th-list"></span> <span class="caret"></span>\n	</a>\n	<ul class="dropdown-menu">\n		<!-- \n			tabs are injected here a second time \n			that way they are just toggled and not moved around\n		-->\n		'+((__t=entries)==null?"":__t)+"\n	</ul>\n</li>";return __p}}),define("storymaps/tpl/ui/desktop/NavBar",["lib-build/tpl!./NavBar","lib-build/css!./NavBar","lib-build/tpl!./NavBarEntry","lib-build/tpl!./NavBarEntryMore","storymaps/common/utils/CommonHelper","dojo/_base/Color","dojo/topic","dojo/has"],function(e,t,n,r,i,s,o,u){return function(a,f,l){function d(e,t,i){h=h||[],v(e,t),m(i);var s=h.length,l="";$.each(h,function(r,i){var o=i.title;e=="bullet"&&(o=t.reverse?s-r:r+1),o||(o=f?'<span style="color: red;">'+i18n.commonCore.inlineFieldEdit.editMe+"</span>":"&nbsp;"),e=="bullet"&&(o+='<div style="height:0; width: 0; overflow: hidden;"><div>;</div><div>'+i.title+"</div></div>"),l+=n({value:o,tooltip:e=="bullet"?i.title:"",optHtmlClass:i.status!="PUBLISHED"?"hidden-entry":""})}),a.find(".nav-tabs").html(l+r({entries:l})),e=="bullet"&&!u("touch")&&(a.find(".nav-tabs > .entry").tooltip({placement:"top",trigger:"hover"}),a.find(".dropdown-menu > .entry").tooltip({placement:"left",container:".nav-bar",trigger:"hover"})),a.find(".entry").click(g),a.find(".entryLbl").on("keydown",function(e){if(e.keyCode===9)return o.publish("story-tab-navigation",{from:"nav",direction:e.shiftKey?"backward":"forward"}),!1}),a.find(".entryLbl").eq(0).focus(function(){!$(this).data("mouseDown")&&!$(this).parent(".entry").hasClass("active")&&$(this).parent(".entry").click()}).mousedown(function(){$(this).data("mouseDown",!0)}).mouseup(function(){$(this).removeData("mouseDown")}),c.resize()}function v(e){a.find(".nav-bar").toggleClass("isTab",e=="tab").toggleClass("isBullet",e=="bullet")}function m(e){a.css("background-color",e.header),i.addCSSRule(".nav-bar .nav > .entry .entryLbl, 					.nav-bar .dropdown-toggle { 						color: "+e.tabText+"; 						background-color: "+e.tab+" !important; 					}","NavBarTab"),i.addCSSRule(".nav-bar .entry.active > .entryLbl, 					.nav-bar .dropdown.active .dropdown-toggle { 						color: "+e.tabTextActive+"; 						background-color: "+e.tabActive+" !important; 					}","NavBarActive"),i.addCSSRule(".nav-bar .dropdown:not(.active):hover .dropdown-toggle, 					.nav-bar li:not(.active) .entryLbl:hover { 						color: "+e.tabTextHover+"; 						background-color: "+e.tabHover+" !important; 					}","NavBarHover");if(e.name&&e.name.match(/-org$|-modified$/)){var t=new s(e.tab);t.a=.55,i.addCSSRule(".nav-bar .dropdown-menu, 						.nav-bar .dropdown-menu .entryLbl { 							color: "+e.tabText+" !important; 							background-color: "+t.toString()+" !important; 						}","NavBarMore"),t.a=.75,i.addCSSRule(".nav-bar .dropdown-menu li:not(.active) .entryLbl:hover { 							background-color: "+t.toString()+" !important; 						}","NavBarEvenMore")}else i.addCSSRule(".nav-bar .dropdown-menu, 						.nav-bar .dropdown-menu .entryLbl { 							color: "+e.tabText+" !important; 							background-color: "+e.header+" !important; 						}","NavBarMore"),i.addCSSRule("","NavBarEvenMore");i.addCSSRule(".nav-bar .nav-tabs > .tooltip .tooltip-arrow, 					.nav-bar .builder-content-panel .tooltip-arrow { 						border-top-color: "+e.tabActive+"; 					} 					.nav-bar > .tooltip .tooltip-arrow { 						border-left-color: "+e.tabActive+"; 					} 					.nav-bar .tooltip-inner { 						background-color: "+e.tabActive+"; 						color: "+e.tabTextActive+"; 					}","BulletTooltip")}function g(){var e=$(this).index();l(e)}function y(){a.find(".builder-content-panel").css("display","inline-block"),a.find(".builder-edit").off("click").click(b).find(".builder-lbl").html(i18n.builder.addEditPopup.lblEdit)}function b(){app.builder.openEditPopup({entryIndex:c.getEntryIndex()})}function w(){}var c=this,h=null,p=null;a.html(e({})),this.init=function(e,t,n,r,i){h=e,p=null,d(n,r,i),this.showEntryIndex(t),w(),f&&y()},this.update=function(e,t,n){d(e,t,n),this.showEntryIndex(p)},this.resize=function(){a.find(".nav-tabs > li").addClass("visible"),a.find(".nav-tabs .dropdown").removeClass("visible"),a.find(".nav-tabs .dropdown-menu li").removeClass("visible");var e=0,t=0,n=!1,r=a.find(".nav-tabs > li:not(.dropdown)"),i=a.find("li.dropdown").outerWidth(),s=a.width()-a.find(".builder-content-panel:visible").outerWidth()-30-4;r.each(function(){t++,e+=$(this).outerWidth();if(e>s||e+i>s&&t<r.length)n=!0,$(this).removeClass("visible"),a.find(".nav-tabs .dropdown-menu li").eq($(this).index()).addClass("visible")});var o=a.find(".nav-tabs > .entry.active"),u=a.find(".nav-tabs .dropdown-menu li.active");o.length&&!o.hasClass("visible")?(o.removeClass("active"),a.find(".nav-tabs .dropdown-menu li").eq(o.index()).addClass("active"),a.find(".nav-tabs > .dropdown").addClass("active")):u.length&&!u.hasClass("visible")&&(u.removeClass("active"),a.find(".nav-tabs > .entry").eq(u.index()).addClass("active"),a.find(".nav-tabs > .dropdown").removeClass("active")),n&&a.find(".nav-tabs .dropdown").addClass("visible")},this.showEntryIndex=function(e){var t=a.find(".nav-tabs > .entry.visible").length;a.find("li").removeClass("active"),e<t?(a.find(".entry").eq(e).addClass("active"),app.isLoading||(a.find(".entry").eq(e).find(".entryLbl").focus(),a.find(".dropdown").hasClass("open")&&a.find(".dropdown-toggle").click())):(a.find(".dropdown").addClass("active"),a.find(".dropdown .entry").eq(e).addClass("active"),app.isLoading||(a.find(".dropdown").hasClass("open")||a.find(".dropdown-toggle").click(),a.find(".dropdown .entry").eq(e).focus())),p=e},this.getEntryIndex=function(){return p},this.destroy=function(){a.hide()}}}),define("lib-build/tpl!storymaps/tpl/ui/desktop/DescriptionAndLegendPanelEntry",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="entry '+((__t=optHtmlClass)==null?"":__t)+'">\n	<div class="entry-inner">\n		',isInBuilder?__p+='\n			<textarea name="descriptionEditor" class="descriptionEditor" placeholder="'+((__t=editorPlaceholder)==null?"":__t)+'">\n				'+((__t=description)==null?"":__t)+"\n			</textarea>\n		":__p+='\n			<div class="description">\n				'+((__t=description)==null?"":__t)+"\n			</div>\n		",__p+="\n	</div>\n</div>";return __p}}),define("lib-build/css!storymaps/tpl/ui/desktop/DescriptionAndLegendPanel",[],function(){}),define("storymaps/tpl/ui/desktop/DescriptionAndLegendPanel",["lib-build/tpl!./DescriptionAndLegendPanelEntry","lib-build/css!./DescriptionAndLegendPanel","lib-build/css!./Common","../../core/WebApplicationData","../StoryText","storymaps/common/utils/CommonHelper","dojo/topic"],function(e,t,n,r,i,s,o){return function(n,r){function c(){var t="";$.each(u,function(r,i){t+=e({isInBuilder:app.isInBuilder,optHtmlClass:i["status"]!="PUBLISHED"?"hidden-entry":"",description:i.description||"",editorPlaceholder:app.isInBuilder?i18n.builder.textEditor.placeholder1+" "+i18n.builder.textEditor.placeholder2:""}),i.media.type=="webmap"&&(n.find(".legendWrapper[data-webmap="+i.media.webmap.id+"]").length||n.find(".legends").append('<div class="legendWrapper" data-webmap="'+i.media.webmap.id+'"></div>'))}),app.isInBuilder?n.find(".descriptions").html(t):n.find(".descriptions").html(i.prepareContentIframe(i.prepareEditorContent(t)))}function h(e){var t=!app.isInitializing&&(e.description||e.legend&&f.legend=="panel");n.toggle(t),n.find(".descriptions").toggle(f.description),n.css("width",f.panel.sizeVal),n.removeClass("bullet-embed");if($("body").hasClass("layout-bullet")){var r=app.data.getCurrentEntry();r&&r.media&&(r.media.type=="video"||r.media.type=="webpage")&&n.addClass("bullet-embed")}}function p(e){var t=e.find("iframe[data-unload=true]");t.length&&setTimeout(function(){t.each(function(e,t){var n=$(t);n.attr("src","")})},150)}function d(e){n.css({color:e.text}),n.find(".backdrop").css({backgroundColor:e.panel}),s.addCSSRule(".descLegendPanel::-webkit-scrollbar-thumb { background-color:"+e.header+"; }"+".descLegendPanel::-webkit-scrollbar-track { background-color:"+e.panel+"; }","DescLegendPanelScrollbar")}function v(){}var u=null,a=null,f=null,l=null;r&&require(["storymaps/tpl/builder/InlineEditor"],function(e){l=new e}),this.init=function(e,t,i,s,f){u=e,a=null,c(),this.update(i,s,f),this.showEntryIndex(t,!1,f),n.on("keydown",function(e){if(e.keyCode===9){var t=$(":focus");if(t){var n=e.shiftKey?t.prevAll("*[tabindex=0]"):t.nextAll("*[tabindex=0]");if(!n.length)return o.publish("story-tab-navigation",{from:"panel",direction:e.shiftKey?"backward":"forward"}),!1}}}),r&&v()},this.update=function(e,t,n){f=e,h(n),d(t)},this.resize=function(e){var t=e?e.height:n.parent().outerHeight();n.toggleClass("no-radius",n.outerHeight()>=t)},this.showEntryIndex=function(e,t,s){if(a!=e||t){p(n.find(".entry.active")),i.loadContentIframe(n.find(".entry").eq(e)),n.find(".entry").removeClass("active"),n.find(".entry").eq(e).addClass("active"),r&&(n.find(".entry.active .cke_editor_descriptionEditor").length||l.init(n.find(".entry.active"))),n.find(".legendWrapper").removeClass("active");if(s.legend){var o=u[e].media[u[e].media.type].id;n.find(".legendWrapper[data-webmap="+o+"]").addClass("active")}a=e,h(s),n.toggleClass("hasDescription",!!f.description&&!!s.description),n.toggleClass("hasLegend",!!s.legend&&f.legend=="panel"),this.resize(),setTimeout(function(){n[0].scrollTop=0},0),setTimeout(function(){n[0].scrollTop=0},100),setTimeout(function(){n[0].scrollTop=0},200)}},this.getEntryIndex=function(){return a},this.destroy=function(){n.hide(),n.find(".descriptions, .legends").hide(),u=null,a=null},this.getLegendContainer=function(e){return n.find(".legendWrapper[data-webmap="+e+"]")},this.focus=function(){n.find(".entry.active .description > *[tabindex=0]").eq(0).focus()}}}),define("lib-build/css!storymaps/tpl/ui/mobile/Header",[],function(){}),define("lib-build/tpl!storymaps/tpl/ui/mobile/HeaderMenuTpl",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="menu-header">\n	<table style="width:100%;">\n		<tr>\n			<td>\n				<span class="linkContainer"></span>\n			</td>\n			<td style="text-align: right;">\n				<a class="logoLink" target="_blank">\n					<img class="logoImg"/>\n				</a>\n			</td>\n		</tr>\n	</table>\n</div>\n<div class="subtitle">\n	'+((__t=subtitle)==null?"":__t)+'\n</div>\n<div class="menu-content">\n	<!-- series index injected here -->\n	'+((__t=menuIndex)==null?"":__t)+"\n</div>";return __p}}),define("lib-build/tpl!storymaps/tpl/ui/mobile/HeaderMenuEntryTpl",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="menu-entry">\n	<div class="menu-title">'+((__t=title)==null?"":__t)+"</div>\n</div>";return __p}}),define("storymaps/tpl/ui/mobile/Header",["lib-build/css!./Header","lib-build/tpl!./HeaderMenuTpl","lib-build/tpl!./HeaderMenuEntryTpl","storymaps/common/utils/HeaderHelper","storymaps/common/utils/CommonHelper"],function(e,t,n,r,i){return function(s,o,u){function a(e){r.setSocial(s,e),r.initEvents(s)}function f(){s.find(".menu").slideToggle()}function l(e,i,o,u,a,f){var l="",c=o.length;$.each(o,function(e,t){var r=t.title;if(a=="bullet"||a=="accordion")f.reverse?r=c-e+(r?" - "+r:""):r=e+1+(r?" - "+r:"");l+=n({title:r||"&nbsp;"})}),s.find(".menu").html(t({subtitle:i,menuIndex:l})),s.find(".subtitle").toggle(!e.compactSize),r.setLink(s,e),r.setLogo(s,e),(e.logoURL=="NO_LOGO"||!e.logoURL||!e.linkText)&&s.find(".menu-header").addClass("centered"),s.find(".menu-entry").click(h).eq(u).addClass("active")}function c(e){s.css({color:e.headerTitle,backgroundColor:e.header}),s.find(".menu").css({color:e.text,backgroundColor:e.panel}),i.addCSSRule(".headerMobile ::-webkit-scrollbar-thumb { background-color:"+e.header+"; }","MobileheaderScrollbar")}function h(){if($(this).hasClass("active"))return;u($(this).index()),f()}function p(){s.find(".menu-btn").click(f)}this.init=function(e){e=e||{},s.find(".title").html(e.title),a(e.headerCfg),l(e.headerCfg,e.subtitle,e.entries,e.entryIndex,e.appLayout,e.layoutOpt),c(e.appColors)},this.update=function(e){c(e.appColors)},this.showEntryIndex=function(e){setTimeout(function(){s.find(".menu-entry").removeClass("active").eq(e).addClass("active")},500)},this.toggleSocialBtnAppSharing=function(e){r.toggleSocialBtnAppSharing(s,e)},this.enableAutoplay=function(){s.find(".share-all").addClass("disabled").tooltip({title:i18n.viewer.headerFromCommon.tooltipAutoplayDisabled,container:"body",placement:"left"})},p()}}),define("lib-build/css!storymaps/tpl/ui/mobile/EntryInfo",[],function(){}),define("storymaps/tpl/ui/mobile/EntryInfo",["lib-build/css!./EntryInfo","./PopupUtils","../StoryText"],function(e,t,n){return function(r){function u(){var e=a(),r=i[s].description;if(!e.is(":visible")){e.find(".description").html(n.prepareContentIframe(n.prepareEditorContent(r)));if(e.find(".content-toggles")){var u=o.description&&r&&o.legend;e.toggleClass("noToggle",!u),e.find(".content-toggles").toggle(u),e.find(".content-toggles .btn").eq(o.description&&r?0:1).click()}}t.open(e)}function a(){return $("#mainStagePanel .mainMediaContainer.active .mobileInfo")}function f(){r.click(u)}var i=null,s=null,o=null;this.init=function(e){e=e||{},i=e.entries,s=e.entryIndex},this.resize=function(){},this.showEntryIndex=function(e,t){o=t,s=e,r.toggle(o.description||o.legend),a().hide().addClass("hideContent")},this.onPopupContentToggle=function(){var e=$(this),t=$(this).index(),n=a();e.siblings().removeClass("btn-primary"),e.addClass("btn-primary"),n.find(".content-container").hide().eq(t).show()},f()}}),define("lib-build/css!storymaps/tpl/ui/mobile/Footer",[],function(){}),define("lib-build/tpl!storymaps/tpl/ui/mobile/FooterTpl",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="swiper-container">\n	<div class="embed-btn-container embed-btn-left">\n		<div class="embed-btn"></div>\n	</div>\n	<div class="swiper-wrapper">\n		'+((__t=entriesHTML)==null?"":__t)+'\n	</div>\n	<div class="embed-btn-container embed-btn-right">\n		<div class="embed-btn"></div>\n	</div>\n</div>';return __p}}),define("lib-build/tpl!storymaps/tpl/ui/mobile/FooterEntryTpl",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="entry swiper-slide">\n	<div class="title">\n		'+((__t=title)==null?"":__t)+'\n		<!--  \n		<span class="glyphicon glyphicon-info-sign info-btn" style="',enableInfo||(__p+="display: none;"),__p+='"></span>\n		<span class="glyphicon glyphicon-tower legend-btn" style="',enableLegend||(__p+="display: none;"),__p+='"></span>\n		-->\n	</div>\n	<div class="next">'+((__t=next)==null?"":__t)+"</div>\n</div>";return __p}});var Swiper=function(e,t){"use strict";function r(e,t){return document.querySelectorAll?(t||document).querySelectorAll(e):jQuery(e,t)}function b(e){return Object.prototype.toString.apply(e)==="[object Array]"?!0:!1}function x(){var e=u-l;return t.freeMode&&(e=u-l),t.slidesPerView>i.slides.length&&!t.centeredSlides&&(e=0),e<0&&(e=0),e}function T(){function o(e){var n=new Image;n.onload=function(){i&&i.imagesLoaded!==undefined&&i.imagesLoaded++,i.imagesLoaded===i.imagesToLoad.length&&(i.reInit(),t.onImagesReady&&i.fireCallback(t.onImagesReady,i))},n.src=e}var e=i.h.addEventListener,n=t.eventTarget==="wrapper"?i.wrapper:i.container;!i.browser.ie10&&!i.browser.ie11?(i.support.touch&&(e(n,"touchstart",I),e(n,"touchmove",U),e(n,"touchend",z)),t.simulateTouch&&(e(n,"mousedown",I),e(document,"mousemove",U),e(document,"mouseup",z))):(e(n,i.touchEvents.touchStart,I),e(document,i.touchEvents.touchMove,U),e(document,i.touchEvents.touchEnd,z)),t.autoResize&&e(window,"resize",i.resizeFix),N(),i._wheelEvent=!1;if(t.mousewheelControl){document.onmousewheel!==undefined&&(i._wheelEvent="mousewheel");if(!i._wheelEvent)try{new WheelEvent("wheel"),i._wheelEvent="wheel"}catch(s){}i._wheelEvent||(i._wheelEvent="DOMMouseScroll"),i._wheelEvent&&e(i.container,i._wheelEvent,A)}t.keyboardControl&&e(document,"keydown",k);if(t.updateOnImagesReady){i.imagesToLoad=r("img",i.container);for(var u=0;u<i.imagesToLoad.length;u++)o(i.imagesToLoad[u].getAttribute("src"))}}function N(){var e=i.h.addEventListener,n;if(t.preventLinks){var s=r("a",i.container);for(n=0;n<s.length;n++)e(s[n],"click",P)}if(t.releaseFormElements){var o=r("input, textarea, select",i.container);for(n=0;n<o.length;n++)e(o[n],i.touchEvents.touchStart,H,!0)}if(t.onSlideClick)for(n=0;n<i.slides.length;n++)e(i.slides[n],"click",M);if(t.onSlideTouch)for(n=0;n<i.slides.length;n++)e(i.slides[n],i.touchEvents.touchStart,_)}function C(){var e=i.h.removeEventListener,n;if(t.onSlideClick)for(n=0;n<i.slides.length;n++)e(i.slides[n],"click",M);if(t.onSlideTouch)for(n=0;n<i.slides.length;n++)e(i.slides[n],i.touchEvents.touchStart,_);if(t.releaseFormElements){var s=r("input, textarea, select",i.container);for(n=0;n<s.length;n++)e(s[n],i.touchEvents.touchStart,H,!0)}if(t.preventLinks){var o=r("a",i.container);for(n=0;n<o.length;n++)e(o[n],"click",P)}}function k(e){var t=e.keyCode||e.charCode;if(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey)return;if(t===37||t===39||t===38||t===40){var n=!1,r=i.h.getOffset(i.container),s=i.h.windowScroll().left,o=i.h.windowScroll().top,u=i.h.windowWidth(),a=i.h.windowHeight(),f=[[r.left,r.top],[r.left+i.width,r.top],[r.left,r.top+i.height],[r.left+i.width,r.top+i.height]];for(var l=0;l<f.length;l++){var c=f[l];c[0]>=s&&c[0]<=s+u&&c[1]>=o&&c[1]<=o+a&&(n=!0)}if(!n)return}if(d){if(t===37||t===39)e.preventDefault?e.preventDefault():e.returnValue=!1;t===39&&i.swipeNext(),t===37&&i.swipePrev()}else{if(t===38||t===40)e.preventDefault?e.preventDefault():e.returnValue=!1;t===40&&i.swipeNext(),t===38&&i.swipePrev()}}function A(e){var n=i._wheelEvent,r=0;if(e.detail)r=-e.detail;else if(n==="mousewheel")if(t.mousewheelControlForceToAxis)if(d){if(!(Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)))return;r=e.wheelDeltaX}else{if(!(Math.abs(e.wheelDeltaY)>Math.abs(e.wheelDeltaX)))return;r=e.wheelDeltaY}else r=e.wheelDelta;else if(n==="DOMMouseScroll")r=-e.detail;else if(n==="wheel")if(t.mousewheelControlForceToAxis)if(d){if(!(Math.abs(e.deltaX)>Math.abs(e.deltaY)))return;r=-e.deltaX}else{if(!(Math.abs(e.deltaY)>Math.abs(e.deltaX)))return;r=-e.deltaY}else r=Math.abs(e.deltaX)>Math.abs(e.deltaY)?-e.deltaX:-e.deltaY;if(!t.freeMode)(new Date).getTime()-L>60&&(r<0?i.swipeNext():i.swipePrev()),L=(new Date).getTime();else{var s=i.getWrapperTranslate()+r;s>0&&(s=0),s<-x()&&(s=-x()),i.setWrapperTransition(0),i.setWrapperTranslate(s),i.updateActiveSlide(s);if(s===0||s===-x())return}return t.autoplay&&i.stopAutoplay(!0),e.preventDefault?e.preventDefault():e.returnValue=!1,!1}function M(e){i.allowSlideClick&&(D(e),i.fireCallback(t.onSlideClick,i,e))}function _(e){D(e),i.fireCallback(t.onSlideTouch,i,e)}function D(e){if(!e.currentTarget){var n=e.srcElement;do{if(n.className.indexOf(t.slideClass)>-1)break;n=n.parentNode}while(n);i.clickedSlide=n}else i.clickedSlide=e.currentTarget;i.clickedTarget=e.target,i.clickedSlideIndex=i.slides.indexOf(i.clickedSlide),i.clickedSlideLoopIndex=i.clickedSlideIndex-(i.loopedSlides||0)}function P(e){if(!i.allowLinks)return e.preventDefault?e.preventDefault():e.returnValue=!1,t.preventLinksPropagation&&"stopPropagation"in e&&e.stopPropagation(),!1}function H(e){return e.stopPropagation?e.stopPropagation():e.returnValue=!1,!1}function I(e){t.preventLinks&&(i.allowLinks=!0);if(i.isTouched||t.onlyExternal)return!1;if(t.noSwiping&&(e.target||e.srcElement)&&W(e.target||e.srcElement))return!1;F=!1,i.isTouched=!0,B=e.type==="touchstart";if(!B||e.targetTouches.length===1){i.callPlugins("onTouchStartBegin"),!B&&!i.isAndroid&&(e.preventDefault?e.preventDefault():e.returnValue=!1);var n=B?e.targetTouches[0].pageX:e.pageX||e.clientX,r=B?e.targetTouches[0].pageY:e.pageY||e.clientY;i.touches.startX=i.touches.currentX=n,i.touches.startY=i.touches.currentY=r,i.touches.start=i.touches.current=d?n:r,i.setWrapperTransition(0),i.positions.start=i.positions.current=i.getWrapperTranslate(),i.setWrapperTranslate(i.positions.start),i.times.start=(new Date).getTime(),f=undefined,t.moveStartThreshold>0&&(j=!1),t.onTouchStart&&i.fireCallback(t.onTouchStart,i,e),i.callPlugins("onTouchStartEnd")}}function U(e){if(!i.isTouched||t.onlyExternal)return;if(B&&e.type==="mousemove")return;var n=B?e.targetTouches[0].pageX:e.pageX||e.clientX,r=B?e.targetTouches[0].pageY:e.pageY||e.clientY;typeof f=="undefined"&&d&&(f=!!(f||Math.abs(r-i.touches.startY)>Math.abs(n-i.touches.startX))),typeof f=="undefined"&&!d&&(f=!!(f||Math.abs(r-i.touches.startY)<Math.abs(n-i.touches.startX)));if(f){i.isTouched=!1;return}if(e.assignedToSwiper){i.isTouched=!1;return}e.assignedToSwiper=!0,t.preventLinks&&(i.allowLinks=!1),t.onSlideClick&&(i.allowSlideClick=!1),t.autoplay&&i.stopAutoplay(!0);if(!B||e.touches.length===1){i.isMoved||(i.callPlugins("onTouchMoveStart"),t.loop&&(i.fixLoop(),i.positions.start=i.getWrapperTranslate()),t.onTouchMoveStart&&i.fireCallback(t.onTouchMoveStart,i)),i.isMoved=!0,e.preventDefault?e.preventDefault():e.returnValue=!1,i.touches.current=d?n:r,i.positions.current=(i.touches.current-i.touches.start)*t.touchRatio+i.positions.start,i.positions.current>0&&t.onResistanceBefore&&i.fireCallback(t.onResistanceBefore,i,i.positions.current),i.positions.current<-x()&&t.onResistanceAfter&&i.fireCallback(t.onResistanceAfter,i,Math.abs(i.positions.current+x()));if(t.resistance&&t.resistance!=="100%"){var s;i.positions.current>0&&(s=1-i.positions.current/l/2,s<.5?i.positions.current=l/2:i.positions.current=i.positions.current*s);if(i.positions.current<-x()){var o=(i.touches.current-i.touches.start)*t.touchRatio+(x()+i.positions.start);s=(l+o)/l;var u=i.positions.current-o*(1-s)/2,a=-x()-l/2;u<a||s<=0?i.positions.current=a:i.positions.current=u}}t.resistance&&t.resistance==="100%"&&(i.positions.current>0&&(!t.freeMode||!!t.freeModeFluid)&&(i.positions.current=0),i.positions.current<-x()&&(!t.freeMode||!!t.freeModeFluid)&&(i.positions.current=-x()));if(!t.followFinger)return;if(!t.moveStartThreshold)i.setWrapperTranslate(i.positions.current);else if(Math.abs(i.touches.current-i.touches.start)>t.moveStartThreshold||j){if(!j){j=!0,i.touches.start=i.touches.current;return}i.setWrapperTranslate(i.positions.current)}else i.positions.current=i.positions.start;return(t.freeMode||t.watchActiveIndex)&&i.updateActiveSlide(i.positions.current),t.grabCursor&&(i.container.style.cursor="move",i.container.style.cursor="grabbing",i.container.style.cursor="-moz-grabbin",i.container.style.cursor="-webkit-grabbing"),q||(q=i.touches.current),R||(R=(new Date).getTime()),i.velocity=(i.touches.current-q)/((new Date).getTime()-R)/2,Math.abs(i.touches.current-q)<2&&(i.velocity=0),q=i.touches.current,R=(new Date).getTime(),i.callPlugins("onTouchMoveEnd"),t.onTouchMove&&i.fireCallback(t.onTouchMove,i,e),!1}}function z(e){f&&i.swipeReset();if(t.onlyExternal||!i.isTouched)return;i.isTouched=!1,t.grabCursor&&(i.container.style.cursor="move",i.container.style.cursor="grab",i.container.style.cursor="-moz-grab",i.container.style.cursor="-webkit-grab"),!i.positions.current&&i.positions.current!==0&&(i.positions.current=i.positions.start),t.followFinger&&i.setWrapperTranslate(i.positions.current),i.times.end=(new Date).getTime(),i.touches.diff=i.touches.current-i.touches.start,i.touches.abs=Math.abs(i.touches.diff),i.positions.diff=i.positions.current-i.positions.start,i.positions.abs=Math.abs(i.positions.diff);var n=i.positions.diff,r=i.positions.abs,s=i.times.end-i.times.start;r<5&&s<300&&i.allowLinks===!1&&(!t.freeMode&&r!==0&&i.swipeReset(),t.preventLinks&&(i.allowLinks=!0),t.onSlideClick&&(i.allowSlideClick=!0)),setTimeout(function(){t.preventLinks&&(i.allowLinks=!0),t.onSlideClick&&(i.allowSlideClick=!0)},100);var u=x();if(!i.isMoved&&t.freeMode){i.isMoved=!1,t.onTouchEnd&&i.fireCallback(t.onTouchEnd,i,e),i.callPlugins("onTouchEnd");return}if(!i.isMoved||i.positions.current>0||i.positions.current<-u){i.swipeReset(),t.onTouchEnd&&i.fireCallback(t.onTouchEnd,i,e),i.callPlugins("onTouchEnd");return}i.isMoved=!1;if(t.freeMode){if(t.freeModeFluid){var c=1e3*t.momentumRatio,h=i.velocity*c,p=i.positions.current+h,v=!1,m,g=Math.abs(i.velocity)*20*t.momentumBounceRatio;p<-u&&(t.momentumBounce&&i.support.transitions?(p+u<-g&&(p=-u-g),m=-u,v=!0,F=!0):p=-u),p>0&&(t.momentumBounce&&i.support.transitions?(p>g&&(p=g),m=0,v=!0,F=!0):p=0),i.velocity!==0&&(c=Math.abs((p-i.positions.current)/i.velocity)),i.setWrapperTranslate(p),i.setWrapperTransition(c),t.momentumBounce&&v&&i.wrapperTransitionEnd(function(){if(!F)return;t.onMomentumBounce&&i.fireCallback(t.onMomentumBounce,i),i.callPlugins("onMomentumBounce"),i.setWrapperTranslate(m),i.setWrapperTransition(300)}),i.updateActiveSlide(p)}(!t.freeModeFluid||s>=300)&&i.updateActiveSlide(i.positions.current),t.onTouchEnd&&i.fireCallback(t.onTouchEnd,i,e),i.callPlugins("onTouchEnd");return}a=n<0?"toNext":"toPrev",a==="toNext"&&s<=300&&(r<30||!t.shortSwipes?i.swipeReset():i.swipeNext(!0)),a==="toPrev"&&s<=300&&(r<30||!t.shortSwipes?i.swipeReset():i.swipePrev(!0));var y=0;if(t.slidesPerView==="auto"){var b=Math.abs(i.getWrapperTranslate()),w=0,E;for(var S=0;S<i.slides.length;S++){E=d?i.slides[S].getWidth(!0,t.roundLengths):i.slides[S].getHeight(!0,t.roundLengths),w+=E;if(w>b){y=E;break}}y>l&&(y=l)}else y=o*t.slidesPerView;a==="toNext"&&s>300&&(r>=y*t.longSwipesRatio?i.swipeNext(!0):i.swipeReset()),a==="toPrev"&&s>300&&(r>=y*t.longSwipesRatio?i.swipePrev(!0):i.swipeReset()),t.onTouchEnd&&i.fireCallback(t.onTouchEnd,i,e),i.callPlugins("onTouchEnd")}function W(e){var n=!1;do e.className.indexOf(t.noSwipingClass)>-1&&(n=!0),e=e.parentElement;while(!n&&e.parentElement&&e.className.indexOf(t.wrapperClass)===-1);return!n&&e.className.indexOf(t.wrapperClass)>-1&&e.className.indexOf(t.noSwipingClass)>-1&&(n=!0),n}function X(e,t){var n=document.createElement("div"),r;return n.innerHTML=t,r=n.firstChild,r.className+=" "+e,r.outerHTML}function V(e,n,r){function u(){var s=+(new Date),h=s-o;a+=f*h/(1e3/60),c=l==="toNext"?a>e:a<e,c?(i.setWrapperTranslate(Math.round(a)),i._DOMAnimating=!0,window.setTimeout(function(){u()},1e3/60)):(t.onSlideChangeEnd&&(n==="to"?r.runCallbacks===!0&&i.fireCallback(t.onSlideChangeEnd,i):i.fireCallback(t.onSlideChangeEnd,i)),i.setWrapperTranslate(e),i._DOMAnimating=!1)}var s=n==="to"&&r.speed>=0?r.speed:t.speed,o=+(new Date);if(i.support.transitions||!t.DOMAnimation)i.setWrapperTranslate(e),i.setWrapperTransition(s);else{var a=i.getWrapperTranslate(),f=Math.ceil((e-a)/s*(1e3/60)),l=a>e?"toNext":"toPrev",c=l==="toNext"?a>e:a<e;if(i._DOMAnimating)return;u()}i.updateActiveSlide(e),t.onSlideNext&&n==="next"&&i.fireCallback(t.onSlideNext,i,e),t.onSlidePrev&&n==="prev"&&i.fireCallback(t.onSlidePrev,i,e),t.onSlideReset&&n==="reset"&&i.fireCallback(t.onSlideReset,i,e),(n==="next"||n==="prev"||n==="to"&&r.runCallbacks===!0)&&$(n)}function $(e){i.callPlugins("onSlideChangeStart");if(t.onSlideChangeStart)if(t.queueStartCallbacks&&i.support.transitions){if(i._queueStartCallbacks)return;i._queueStartCallbacks=!0,i.fireCallback(t.onSlideChangeStart,i,e),i.wrapperTransitionEnd(function(){i._queueStartCallbacks=!1})}else i.fireCallback(t.onSlideChangeStart,i,e);if(t.onSlideChangeEnd)if(i.support.transitions)if(t.queueEndCallbacks){if(i._queueEndCallbacks)return;i._queueEndCallbacks=!0,i.wrapperTransitionEnd(function(n){i.fireCallback(t.onSlideChangeEnd,n,e)})}else i.wrapperTransitionEnd(function(n){i.fireCallback(t.onSlideChangeEnd,n,e)});else t.DOMAnimation||setTimeout(function(){i.fireCallback(t.onSlideChangeEnd,i,e)},10)}function J(){var e=i.paginationButtons;if(e)for(var t=0;t<e.length;t++)i.h.removeEventListener(e[t],"click",Q)}function K(){var e=i.paginationButtons;if(e)for(var t=0;t<e.length;t++)i.h.addEventListener(e[t],"click",Q)}function Q(e){var t,n=e.target||e.srcElement,r=i.paginationButtons;for(var s=0;s<r.length;s++)n===r[s]&&(t=s);i.swipeTo(t)}function Z(){G=setTimeout(function(){t.loop?(i.fixLoop(),i.swipeNext(!0)):i.swipeNext(!0)||(t.autoplayStopOnLast?(clearTimeout(G),G=undefined):i.swipeTo(0)),i.wrapperTransitionEnd(function(){typeof G!="undefined"&&Z()})},t.autoplay)}function et(){i.calcSlides(),t.loader.slides.length>0&&i.slides.length===0&&i.loadSlides(),t.loop&&i.createLoop(),i.init(),T(),t.pagination&&i.createPagination(!0),t.loop||t.initialSlide>0?i.swipeTo(t.initialSlide,0,!1):i.updateActiveSlide(0),t.autoplay&&i.startAutoplay(),i.centerIndex=i.activeIndex,t.onSwiperCreated&&i.fireCallback(t.onSwiperCreated,i),i.callPlugins("onSwiperCreated")}if(document.body.__defineGetter__&&HTMLElement){var n=HTMLElement.prototype;n.__defineGetter__&&n.__defineGetter__("outerHTML",function(){return(new XMLSerializer).serializeToString(this)})}window.getComputedStyle||(window.getComputedStyle=function(e,t){return this.el=e,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return t==="float"&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,function(){return arguments[2].toUpperCase()})),e.currentStyle[t]?e.currentStyle[t]:null},this}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=t||0,r=this.length;n<r;n++)if(this[n]===e)return n;return-1});if(!document.querySelectorAll&&!window.jQuery)return;if(typeof e=="undefined")return;if(!e.nodeType&&r(e).length===0)return;var i=this;i.touches={start:0,startX:0,startY:0,current:0,currentX:0,currentY:0,diff:0,abs:0},i.positions={start:0,abs:0,diff:0,current:0},i.times={start:0,end:0},i.id=(new Date).getTime(),i.container=e.nodeType?e:r(e)[0],i.isTouched=!1,i.isMoved=!1,i.activeIndex=0,i.centerIndex=0,i.activeLoaderIndex=0,i.activeLoopIndex=0,i.previousIndex=null,i.velocity=0,i.snapGrid=[],i.slidesGrid=[],i.imagesToLoad=[],i.imagesLoaded=0,i.wrapperLeft=0,i.wrapperRight=0,i.wrapperTop=0,i.wrapperBottom=0,i.isAndroid=navigator.userAgent.toLowerCase().indexOf("android")>=0;var s,o,u,a,f,l,c={eventTarget:"wrapper",mode:"horizontal",touchRatio:1,speed:300,freeMode:!1,freeModeFluid:!1,momentumRatio:1,momentumBounce:!0,momentumBounceRatio:1,slidesPerView:1,slidesPerGroup:1,slidesPerViewFit:!0,simulateTouch:!0,followFinger:!0,shortSwipes:!0,longSwipesRatio:.5,moveStartThreshold:!1,onlyExternal:!1,createPagination:!0,pagination:!1,paginationElement:"span",paginationClickable:!1,paginationAsRange:!0,resistance:!0,scrollContainer:!1,preventLinks:!0,preventLinksPropagation:!1,noSwiping:!1,noSwipingClass:"swiper-no-swiping",initialSlide:0,keyboardControl:!1,mousewheelControl:!1,mousewheelControlForceToAxis:!1,useCSS3Transforms:!0,autoplay:!1,autoplayDisableOnInteraction:!0,autoplayStopOnLast:!1,loop:!1,loopAdditionalSlides:0,roundLengths:!1,calculateHeight:!1,cssWidthAndHeight:!1,updateOnImagesReady:!0,releaseFormElements:!0,watchActiveIndex:!1,visibilityFullFit:!1,offsetPxBefore:0,offsetPxAfter:0,offsetSlidesBefore:0,offsetSlidesAfter:0,centeredSlides:!1,queueStartCallbacks:!1,queueEndCallbacks:!1,autoResize:!0,resizeReInit:!1,DOMAnimation:!0,loader:{slides:[],slidesHTMLType:"inner",surroundGroups:1,logic:"reload",loadAllSlides:!1},slideElement:"div",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",wrapperClass:"swiper-wrapper",paginationElementClass:"swiper-pagination-switch",paginationActiveClass:"swiper-active-switch",paginationVisibleClass:"swiper-visible-switch"};t=t||{};for(var h in c)if(h in t&&typeof t[h]=="object")for(var p in c[h])p in t[h]||(t[h][p]=c[h][p]);else h in t||(t[h]=c[h]);i.params=t,t.scrollContainer&&(t.freeMode=!0,t.freeModeFluid=!0),t.loop&&(t.resistance="100%");var d=t.mode==="horizontal",v=["mousedown","mousemove","mouseup"];i.browser.ie10&&(v=["MSPointerDown","MSPointerMove","MSPointerUp"]),i.browser.ie11&&(v=["pointerdown","pointermove","pointerup"]),i.touchEvents={touchStart:i.support.touch||!t.simulateTouch?"touchstart":v[0],touchMove:i.support.touch||!t.simulateTouch?"touchmove":v[1],touchEnd:i.support.touch||!t.simulateTouch?"touchend":v[2]};for(var m=i.container.childNodes.length-1;m>=0;m--)if(i.container.childNodes[m].className){var g=i.container.childNodes[m].className.split(/\s+/);for(var y=0;y<g.length;y++)g[y]===t.wrapperClass&&(s=i.container.childNodes[m])}i.wrapper=s,i._extendSwiperSlide=function(e){return e.append=function(){return t.loop?e.insertAfter(i.slides.length-i.loopedSlides):(i.wrapper.appendChild(e),i.reInit()),e},e.prepend=function(){return t.loop?(i.wrapper.insertBefore(e,i.slides[i.loopedSlides]),i.removeLoopedSlides(),i.calcSlides(),i.createLoop()):i.wrapper.insertBefore(e,i.wrapper.firstChild),i.reInit(),e},e.insertAfter=function(n){if(typeof n=="undefined")return!1;var r;return t.loop?(r=i.slides[n+1+i.loopedSlides],r?i.wrapper.insertBefore(e,r):i.wrapper.appendChild(e),i.removeLoopedSlides(),i.calcSlides(),i.createLoop()):(r=i.slides[n+1],i.wrapper.insertBefore(e,r)),i.reInit(),e},e.clone=function(){return i._extendSwiperSlide(e.cloneNode(!0))},e.remove=function(){i.wrapper.removeChild(e),i.reInit()},e.html=function(t){return typeof t=="undefined"?e.innerHTML:(e.innerHTML=t,e)},e.index=function(){var t;for(var n=i.slides.length-1;n>=0;n--)e===i.slides[n]&&(t=n);return t},e.isActive=function(){return e.index()===i.activeIndex?!0:!1},e.swiperSlideDataStorage||(e.swiperSlideDataStorage={}),e.getData=function(t){return e.swiperSlideDataStorage[t]},e.setData=function(t,n){return e.swiperSlideDataStorage[t]=n,e},e.data=function(t,n){return typeof n=="undefined"?e.getAttribute("data-"+t):(e.setAttribute("data-"+t,n),e)},e.getWidth=function(t,n){return i.h.getWidth(e,t,n)},e.getHeight=function(t,n){return i.h.getHeight(e,t,n)},e.getOffset=function(){return i.h.getOffset(e)},e},i.calcSlides=function(e){var n=i.slides?i.slides.length:!1;i.slides=[],i.displaySlides=[];for(var r=0;r<i.wrapper.childNodes.length;r++)if(i.wrapper.childNodes[r].className){var s=i.wrapper.childNodes[r].className,o=s.split(/\s+/);for(var u=0;u<o.length;u++)o[u]===t.slideClass&&i.slides.push(i.wrapper.childNodes[r])}for(r=i.slides.length-1;r>=0;r--)i._extendSwiperSlide(i.slides[r]);if(n===!1)return;if(n!==i.slides.length||e)C(),N(),i.updateActiveSlide(),i.params.pagination&&i.createPagination(),i.callPlugins("numberOfSlidesChanged")},i.createSlide=function(e,n,r){n=n||i.params.slideClass,r=r||t.slideElement;var s=document.createElement(r);return s.innerHTML=e||"",s.className=n,i._extendSwiperSlide(s)},i.appendSlide=function(e,t,n){if(!e)return;return e.nodeType?i._extendSwiperSlide(e).append():i.createSlide(e,t,n).append()},i.prependSlide=function(e,t,n){if(!e)return;return e.nodeType?i._extendSwiperSlide(e).prepend():i.createSlide(e,t,n).prepend()},i.insertSlideAfter=function(e,t,n,r){return typeof e=="undefined"?!1:t.nodeType?i._extendSwiperSlide(t).insertAfter(e):i.createSlide(t,n,r).insertAfter(e)},i.removeSlide=function(e){if(i.slides[e]){if(t.loop){if(!i.slides[e+i.loopedSlides])return!1;i.slides[e+i.loopedSlides].remove(),i.removeLoopedSlides(),i.calcSlides(),i.createLoop()}else i.slides[e].remove();return!0}return!1},i.removeLastSlide=function(){return i.slides.length>0?(t.loop?(i.slides[i.slides.length-1-i.loopedSlides].remove(),i.removeLoopedSlides(),i.calcSlides(),i.createLoop()):i.slides[i.slides.length-1].remove(),!0):!1},i.removeAllSlides=function(){for(var e=i.slides.length-1;e>=0;e--)i.slides[e].remove()},i.getSlide=function(e){return i.slides[e]},i.getLastSlide=function(){return i.slides[i.slides.length-1]},i.getFirstSlide=function(){return i.slides[0]},i.activeSlide=function(){return i.slides[i.activeIndex]},i.fireCallback=function(){var e=arguments[0];if(Object.prototype.toString.call(e)==="[object Array]")for(var n=0;n<e.length;n++)typeof e[n]=="function"&&e[n](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);else Object.prototype.toString.call(e)==="[object String]"?t["on"+e]&&i.fireCallback(t["on"+e],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]):e(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},i.addCallback=function(e,t){var n=this,r;if(!n.params["on"+e])return this.params["on"+e]=[],this.params["on"+e].push(t);if(b(this.params["on"+e]))return this.params["on"+e].push(t);if(typeof this.params["on"+e]=="function")return r=this.params["on"+e],this.params["on"+e]=[],this.params["on"+e].push(r),this.params["on"+e].push(t)},i.removeCallbacks=function(e){i.params["on"+e]&&(i.params["on"+e]=null)};var w=[];for(var E in i.plugins)if(t[E]){var S=i.plugins[E](i,t[E]);S&&w.push(S)}i.callPlugins=function(e,t){t||(t={});for(var n=0;n<w.length;n++)e in w[n]&&w[n][e](t)},(i.browser.ie10||i.browser.ie11)&&!t.onlyExternal&&i.wrapper.classList.add("swiper-wp8-"+(d?"horizontal":"vertical")),t.freeMode&&(i.container.className+=" swiper-free-mode"),i.initialized=!1,i.init=function(e,n){var r=i.h.getWidth(i.container,!1,t.roundLengths),s=i.h.getHeight(i.container,!1,t.roundLengths);if(r===i.width&&s===i.height&&!e)return;i.width=r,i.height=s;var a,f,c,h,p,v,m;l=d?r:s;var g=i.wrapper;e&&i.calcSlides(n);if(t.slidesPerView==="auto"){var y=0,b=0;t.slidesOffset>0&&(g.style.paddingLeft="",g.style.paddingRight="",g.style.paddingTop="",g.style.paddingBottom=""),g.style.width="",g.style.height="",t.offsetPxBefore>0&&(d?i.wrapperLeft=t.offsetPxBefore:i.wrapperTop=t.offsetPxBefore),t.offsetPxAfter>0&&(d?i.wrapperRight=t.offsetPxAfter:i.wrapperBottom=t.offsetPxAfter),t.centeredSlides&&(d?(i.wrapperLeft=(l-this.slides[0].getWidth(!0,t.roundLengths))/2,i.wrapperRight=(l-i.slides[i.slides.length-1].getWidth(!0,t.roundLengths))/2):(i.wrapperTop=(l-i.slides[0].getHeight(!0,t.roundLengths))/2,i.wrapperBottom=(l-i.slides[i.slides.length-1].getHeight(!0,t.roundLengths))/2)),d?(i.wrapperLeft>=0&&(g.style.paddingLeft=i.wrapperLeft+"px"),i.wrapperRight>=0&&(g.style.paddingRight=i.wrapperRight+"px")):(i.wrapperTop>=0&&(g.style.paddingTop=i.wrapperTop+"px"),i.wrapperBottom>=0&&(g.style.paddingBottom=i.wrapperBottom+"px")),v=0;var w=0;i.snapGrid=[],i.slidesGrid=[],c=0;for(m=0;m<i.slides.length;m++){a=i.slides[m].getWidth(!0,t.roundLengths),f=i.slides[m].getHeight(!0,t.roundLengths),t.calculateHeight&&(c=Math.max(c,f));var E=d?a:f;if(t.centeredSlides){var S=m===i.slides.length-1?0:i.slides[m+1].getWidth(!0,t.roundLengths),x=m===i.slides.length-1?0:i.slides[m+1].getHeight(!0,t.roundLengths),T=d?S:x;if(E>l){if(t.slidesPerViewFit)i.snapGrid.push(v+i.wrapperLeft),i.snapGrid.push(v+E-l+i.wrapperLeft);else for(var N=0;N<=Math.floor(E/(l+i.wrapperLeft));N++)N===0?i.snapGrid.push(v+i.wrapperLeft):i.snapGrid.push(v+i.wrapperLeft+l*N);i.slidesGrid.push(v+i.wrapperLeft)}else i.snapGrid.push(w),i.slidesGrid.push(w);w+=E/2+T/2}else{if(E>l)if(t.slidesPerViewFit)i.snapGrid.push(v),i.snapGrid.push(v+E-l);else if(l!==0)for(var C=0;C<=Math.floor(E/l);C++)i.snapGrid.push(v+l*C);else i.snapGrid.push(v);else i.snapGrid.push(v);i.slidesGrid.push(v)}v+=E,y+=a,b+=f}t.calculateHeight&&(i.height=c),d?(u=y+i.wrapperRight+i.wrapperLeft,g.style.width=y+"px",g.style.height=i.height+"px"):(u=b+i.wrapperTop+i.wrapperBottom,g.style.width=i.width+"px",g.style.height=b+"px")}else if(t.scrollContainer)g.style.width="",g.style.height="",h=i.slides[0].getWidth(!0,t.roundLengths),p=i.slides[0].getHeight(!0,t.roundLengths),u=d?h:p,g.style.width=h+"px",g.style.height=p+"px",o=d?h:p;else{if(t.calculateHeight){c=0,p=0,d||(i.container.style.height=""),g.style.height="";for(m=0;m<i.slides.length;m++)i.slides[m].style.height="",c=Math.max(i.slides[m].getHeight(!0),c),d||(p+=i.slides[m].getHeight(!0));f=c,i.height=f,d?p=f:(l=f,i.container.style.height=l+"px")}else f=d?i.height:i.height/t.slidesPerView,t.roundLengths&&(f=Math.round(f)),p=d?i.height:i.slides.length*f;a=d?i.width/t.slidesPerView:i.width,t.roundLengths&&(a=Math.round(a)),h=d?i.slides.length*a:i.width,o=d?a:f,t.offsetSlidesBefore>0&&(d?i.wrapperLeft=o*t.offsetSlidesBefore:i.wrapperTop=o*t.offsetSlidesBefore),t.offsetSlidesAfter>0&&(d?i.wrapperRight=o*t.offsetSlidesAfter:i.wrapperBottom=o*t.offsetSlidesAfter),t.offsetPxBefore>0&&(d?i.wrapperLeft=t.offsetPxBefore:i.wrapperTop=t.offsetPxBefore),t.offsetPxAfter>0&&(d?i.wrapperRight=t.offsetPxAfter:i.wrapperBottom=t.offsetPxAfter),t.centeredSlides&&(d?(i.wrapperLeft=(l-o)/2,i.wrapperRight=(l-o)/2):(i.wrapperTop=(l-o)/2,i.wrapperBottom=(l-o)/2)),d?(i.wrapperLeft>0&&(g.style.paddingLeft=i.wrapperLeft+"px"),i.wrapperRight>0&&(g.style.paddingRight=i.wrapperRight+"px")):(i.wrapperTop>0&&(g.style.paddingTop=i.wrapperTop+"px"),i.wrapperBottom>0&&(g.style.paddingBottom=i.wrapperBottom+"px")),u=d?h+i.wrapperRight+i.wrapperLeft:p+i.wrapperTop+i.wrapperBottom,t.cssWidthAndHeight||(parseFloat(h)>0&&(g.style.width=h+"px"),parseFloat(p)>0&&(g.style.height=p+"px")),v=0,i.snapGrid=[],i.slidesGrid=[];for(m=0;m<i.slides.length;m++)i.snapGrid.push(v),i.slidesGrid.push(v),v+=o,t.cssWidthAndHeight||(parseFloat(a)>0&&(i.slides[m].style.width=a+"px"),parseFloat(f)>0&&(i.slides[m].style.height=f+"px"))}i.initialized?(i.callPlugins("onInit"),t.onInit&&i.fireCallback(t.onInit,i)):(i.callPlugins("onFirstInit"),t.onFirstInit&&i.fireCallback(t.onFirstInit,i)),i.initialized=!0},i.reInit=function(e){i.init(!0,e)},i.resizeFix=function(e){i.callPlugins("beforeResizeFix"),i.init(t.resizeReInit||e),t.freeMode?i.getWrapperTranslate()<-x()&&(i.setWrapperTransition(0),i.setWrapperTranslate(-x())):(i.swipeTo(t.loop?i.activeLoopIndex:i.activeIndex,0,!1),t.autoplay&&(i.support.transitions&&typeof G!="undefined"?typeof G!="undefined"&&(clearTimeout(G),G=undefined,i.startAutoplay()):typeof Y!="undefined"&&(clearInterval(Y),Y=undefined,i.startAutoplay()))),i.callPlugins("afterResizeFix")},i.destroy=function(){var e=i.h.removeEventListener,n=t.eventTarget==="wrapper"?i.wrapper:i.container;!i.browser.ie10&&!i.browser.ie11?(i.support.touch&&(e(n,"touchstart",I),e(n,"touchmove",U),e(n,"touchend",z)),t.simulateTouch&&(e(n,"mousedown",I),e(document,"mousemove",U),e(document,"mouseup",z))):(e(n,i.touchEvents.touchStart,I),e(document,i.touchEvents.touchMove,U),e(document,i.touchEvents.touchEnd,z)),t.autoResize&&e(window,"resize",i.resizeFix),C(),t.paginationClickable&&J(),t.mousewheelControl&&i._wheelEvent&&e(i.container,i._wheelEvent,A),t.keyboardControl&&e(document,"keydown",k),t.autoplay&&i.stopAutoplay(),i.callPlugins("onDestroy"),i=null},i.disableKeyboardControl=function(){t.keyboardControl=!1,i.h.removeEventListener(document,"keydown",k)},i.enableKeyboardControl=function(){t.keyboardControl=!0,i.h.addEventListener(document,"keydown",k)};var L=(new Date).getTime();i.disableMousewheelControl=function(){return i._wheelEvent?(t.mousewheelControl=!1,i.h.removeEventListener(i.container,i._wheelEvent,A),!0):!1},i.enableMousewheelControl=function(){return i._wheelEvent?(t.mousewheelControl=!0,i.h.addEventListener(i.container,i._wheelEvent,A),!0):!1};if(t.grabCursor){var O=i.container.style;O.cursor="move",O.cursor="grab",O.cursor="-moz-grab",O.cursor="-webkit-grab"}i.allowSlideClick=!0,i.allowLinks=!0;var B=!1,j,F=!0,q,R;i.swipeNext=function(e){!e&&t.loop&&i.fixLoop(),!e&&t.autoplay&&i.stopAutoplay(!0),i.callPlugins("onSwipeNext");var n=i.getWrapperTranslate(),r=n;if(t.slidesPerView==="auto"){for(var s=0;s<i.snapGrid.length;s++)if(-n>=i.snapGrid[s]&&-n<i.snapGrid[s+1]){r=-i.snapGrid[s+1];break}}else{var u=o*t.slidesPerGroup;r=-(Math.floor(Math.abs(n)/Math.floor(u))*u+u)}return r<-x()&&(r=-x()),r===n?!1:(V(r,"next"),!0)},i.swipePrev=function(e){!e&&t.loop&&i.fixLoop(),!e&&t.autoplay&&i.stopAutoplay(!0),i.callPlugins("onSwipePrev");var n=Math.ceil(i.getWrapperTranslate()),r;if(t.slidesPerView==="auto"){r=0;for(var s=1;s<i.snapGrid.length;s++){if(-n===i.snapGrid[s]){r=-i.snapGrid[s-1];break}if(-n>i.snapGrid[s]&&-n<i.snapGrid[s+1]){r=-i.snapGrid[s];break}}}else{var u=o*t.slidesPerGroup;r=-(Math.ceil(-n/u)-1)*u}return r>0&&(r=0),r===n?!1:(V(r,"prev"),!0)},i.swipeReset=function(){i.callPlugins("onSwipeReset");var e=i.getWrapperTranslate(),n=o*t.slidesPerGroup,r,s=-x();if(t.slidesPerView==="auto"){r=0;for(var u=0;u<i.snapGrid.length;u++){if(-e===i.snapGrid[u])return;if(-e>=i.snapGrid[u]&&-e<i.snapGrid[u+1]){i.positions.diff>0?r=-i.snapGrid[u+1]:r=-i.snapGrid[u];break}}-e>=i.snapGrid[i.snapGrid.length-1]&&(r=-i.snapGrid[i.snapGrid.length-1]),e<=-x()&&(r=-x())}else r=e<0?Math.round(e/n)*n:0;return t.scrollContainer&&(r=e<0?e:0),r<-x()&&(r=-x()),t.scrollContainer&&l>o&&(r=0),r===e?!1:(V(r,"reset"),!0)},i.swipeTo=function(e,n,r){e=parseInt(e,10),i.callPlugins("onSwipeTo",{index:e,speed:n}),t.loop&&(e+=i.loopedSlides);var s=i.getWrapperTranslate();if(e>i.slides.length-1||e<0)return;var u;return t.slidesPerView==="auto"?u=-i.slidesGrid[e]:u=-e*o,u<-x()&&(u=-x()),u===s?!1:(r=r===!1?!1:!0,V(u,"to",{index:e,speed:n,runCallbacks:r}),!0)},i._queueStartCallbacks=!1,i._queueEndCallbacks=!1,i.updateActiveSlide=function(e){if(!i.initialized)return;if(i.slides.length===0)return;i.previousIndex=i.activeIndex,typeof e=="undefined"&&(e=i.getWrapperTranslate()),e>0&&(e=0);var n;if(t.slidesPerView==="auto"){var r=0;i.activeIndex=i.slidesGrid.indexOf(-e);if(i.activeIndex<0){for(n=0;n<i.slidesGrid.length-1;n++)if(-e>i.slidesGrid[n]&&-e<i.slidesGrid[n+1])break;var s=Math.abs(i.slidesGrid[n]+e),u=Math.abs(i.slidesGrid[n+1]+e);s<=u?i.activeIndex=n:i.activeIndex=n+1}}else i.activeIndex=Math[t.visibilityFullFit?"ceil":"round"](-e/o);i.activeIndex===i.slides.length&&(i.activeIndex=i.slides.length-1),i.activeIndex<0&&(i.activeIndex=0);if(!i.slides[i.activeIndex])return;i.calcVisibleSlides(e);if(i.support.classList){var a;for(n=0;n<i.slides.length;n++)a=i.slides[n],a.classList.remove(t.slideActiveClass),i.visibleSlides.indexOf(a)>=0?a.classList.add(t.slideVisibleClass):a.classList.remove(t.slideVisibleClass);i.slides[i.activeIndex].classList.add(t.slideActiveClass)}else{var f=new RegExp("\\s*"+t.slideActiveClass),l=new RegExp("\\s*"+t.slideVisibleClass);for(n=0;n<i.slides.length;n++)i.slides[n].className=i.slides[n].className.replace(f,"").replace(l,""),i.visibleSlides.indexOf(i.slides[n])>=0&&(i.slides[n].className+=" "+t.slideVisibleClass);i.slides[i.activeIndex].className+=" "+t.slideActiveClass}if(t.loop){var c=i.loopedSlides;i.activeLoopIndex=i.activeIndex-c,i.activeLoopIndex>=i.slides.length-c*2&&(i.activeLoopIndex=i.slides.length-c*2-i.activeLoopIndex),i.activeLoopIndex<0&&(i.activeLoopIndex=i.slides.length-c*2+i.activeLoopIndex),i.activeLoopIndex<0&&(i.activeLoopIndex=0)}else i.activeLoopIndex=i.activeIndex;t.pagination&&i.updatePagination(e)},i.createPagination=function(e){t.paginationClickable&&i.paginationButtons&&J(),i.paginationContainer=t.pagination.nodeType?t.pagination:r(t.pagination)[0];if(t.createPagination){var n="",s=i.slides.length,o=s;t.loop&&(o-=i.loopedSlides*2);for(var u=0;u<o;u++)n+="<"+t.paginationElement+' class="'+t.paginationElementClass+'"></'+t.paginationElement+">";i.paginationContainer.innerHTML=n}i.paginationButtons=r("."+t.paginationElementClass,i.paginationContainer),e||i.updatePagination(),i.callPlugins("onCreatePagination"),t.paginationClickable&&K()},i.updatePagination=function(e){if(!t.pagination)return;if(i.slides.length<1)return;var n=r("."+t.paginationActiveClass,i.paginationContainer);if(!n)return;var s=i.paginationButtons;if(s.length===0)return;for(var o=0;o<s.length;o++)s[o].className=t.paginationElementClass;var u=t.loop?i.loopedSlides:0;if(t.paginationAsRange){i.visibleSlides||i.calcVisibleSlides(e);var a=[],f;for(f=0;f<i.visibleSlides.length;f++){var l=i.slides.indexOf(i.visibleSlides[f])-u;t.loop&&l<0&&(l=i.slides.length-i.loopedSlides*2+l),t.loop&&l>=i.slides.length-i.loopedSlides*2&&(l=i.slides.length-i.loopedSlides*2-l,l=Math.abs(l)),a.push(l)}for(f=0;f<a.length;f++)s[a[f]]&&(s[a[f]].className+=" "+t.paginationVisibleClass);t.loop?s[i.activeLoopIndex]!==undefined&&(s[i.activeLoopIndex].className+=" "+t.paginationActiveClass):s[i.activeIndex].className+=" "+t.paginationActiveClass}else t.loop?s[i.activeLoopIndex]&&(s[i.activeLoopIndex].className+=" "+t.paginationActiveClass+" "+t.paginationVisibleClass):s[i.activeIndex].className+=" "+t.paginationActiveClass+" "+t.paginationVisibleClass},i.calcVisibleSlides=function(e){var n=[],r=0,s=0,u=0;d&&i.wrapperLeft>0&&(e+=i.wrapperLeft),!d&&i.wrapperTop>0&&(e+=i.wrapperTop);for(var a=0;a<i.slides.length;a++){r+=s,t.slidesPerView==="auto"?s=d?i.h.getWidth(i.slides[a],!0,t.roundLengths):i.h.getHeight(i.slides[a],!0,t.roundLengths):s=o,u=r+s;var f=!1;t.visibilityFullFit?(r>=-e&&u<=-e+l&&(f=!0),r<=-e&&u>=-e+l&&(f=!0)):(u>-e&&u<=-e+l&&(f=!0),r>=-e&&r<-e+l&&(f=!0),r<-e&&u>-e+l&&(f=!0)),f&&n.push(i.slides[a])}n.length===0&&(n=[i.slides[i.activeIndex]]),i.visibleSlides=n};var G,Y;i.startAutoplay=function(){if(i.support.transitions){if(typeof G!="undefined")return!1;if(!t.autoplay)return;i.callPlugins("onAutoplayStart"),t.onAutoplayStart&&i.fireCallback(t.onAutoplayStart,i),Z()}else{if(typeof Y!="undefined")return!1;if(!t.autoplay)return;i.callPlugins("onAutoplayStart"),t.onAutoplayStart&&i.fireCallback(t.onAutoplayStart,i),Y=setInterval(function(){t.loop?(i.fixLoop(),i.swipeNext(!0)):i.swipeNext(!0)||(t.autoplayStopOnLast?(clearInterval(Y),Y=undefined):i.swipeTo(0))},t.autoplay)}},i.stopAutoplay=function(e){if(i.support.transitions){if(!G)return;G&&clearTimeout(G),G=undefined,e&&!t.autoplayDisableOnInteraction&&i.wrapperTransitionEnd(function(){Z()}),i.callPlugins("onAutoplayStop"),t.onAutoplayStop&&i.fireCallback(t.onAutoplayStop,i)}else Y&&clearInterval(Y),Y=undefined,i.callPlugins("onAutoplayStop"),t.onAutoplayStop&&i.fireCallback(t.onAutoplayStop,i)},i.loopCreated=!1,i.removeLoopedSlides=function(){if(i.loopCreated)for(var e=0;e<i.slides.length;e++)i.slides[e].getData("looped")===!0&&i.wrapper.removeChild(i.slides[e])},i.createLoop=function(){if(i.slides.length===0)return;t.slidesPerView==="auto"?i.loopedSlides=t.loopedSlides||1:i.loopedSlides=t.slidesPerView+t.loopAdditionalSlides,i.loopedSlides>i.slides.length&&(i.loopedSlides=i.slides.length);var e="",n="",r,o="",u=i.slides.length,a=Math.floor(i.loopedSlides/u),f=i.loopedSlides%u;for(r=0;r<a*u;r++){var l=r;if(r>=u){var c=Math.floor(r/u);l=r-u*c}o+=i.slides[l].outerHTML}for(r=0;r<f;r++)n+=X(t.slideDuplicateClass,i.slides[r].outerHTML);for(r=u-f;r<u;r++)e+=X(t.slideDuplicateClass,i.slides[r].outerHTML);var h=e+o+s.innerHTML+o+n;s.innerHTML=h,i.loopCreated=!0,i.calcSlides();for(r=0;r<i.slides.length;r++)(r<i.loopedSlides||r>=i.slides.length-i.loopedSlides)&&i.slides[r].setData("looped",!0);i.callPlugins("onCreateLoop")},i.fixLoop=function(){var e;if(i.activeIndex<i.loopedSlides)e=i.slides.length-i.loopedSlides*3+i.activeIndex,i.swipeTo(e,0,!1);else if(t.slidesPerView==="auto"&&i.activeIndex>=i.loopedSlides*2||i.activeIndex>i.slides.length-t.slidesPerView*2)e=-i.slides.length+i.activeIndex+i.loopedSlides,i.swipeTo(e,0,!1)},i.loadSlides=function(){var e="";i.activeLoaderIndex=0;var n=t.loader.slides,r=t.loader.loadAllSlides?n.length:t.slidesPerView*(1+t.loader.surroundGroups);for(var s=0;s<r;s++)t.loader.slidesHTMLType==="outer"?e+=n[s]:e+="<"+t.slideElement+' class="'+t.slideClass+'" data-swiperindex="'+s+'">'+n[s]+"</"+t.slideElement+">";i.wrapper.innerHTML=e,i.calcSlides(!0),t.loader.loadAllSlides||i.wrapperTransitionEnd(i.reloadSlides,!0)},i.reloadSlides=function(){var e=t.loader.slides,n=parseInt(i.activeSlide().data("swiperindex"),10);if(n<0||n>e.length-1)return;i.activeLoaderIndex=n;var r=Math.max(0,n-t.slidesPerView*t.loader.surroundGroups),s=Math.min(n+t.slidesPerView*(1+t.loader.surroundGroups)-1,e.length-1);if(n>0){var u=-o*(n-r);i.setWrapperTranslate(u),i.setWrapperTransition(0)}var a;if(t.loader.logic==="reload"){i.wrapper.innerHTML="";var f="";for(a=r;a<=s;a++)f+=t.loader.slidesHTMLType==="outer"?e[a]:"<"+t.slideElement+' class="'+t.slideClass+'" data-swiperindex="'+a+'">'+e[a]+"</"+t.slideElement+">";i.wrapper.innerHTML=f}else{var l=1e3,c=0;for(a=0;a<i.slides.length;a++){var h=i.slides[a].data("swiperindex");h<r||h>s?i.wrapper.removeChild(i.slides[a]):(l=Math.min(h,l),c=Math.max(h,c))}for(a=r;a<=s;a++){var p;a<l&&(p=document.createElement(t.slideElement),p.className=t.slideClass,p.setAttribute("data-swiperindex",a),p.innerHTML=e[a],i.wrapper.insertBefore(p,i.wrapper.firstChild)),a>c&&(p=document.createElement(t.slideElement),p.className=t.slideClass,p.setAttribute("data-swiperindex",a),p.innerHTML=e[a],i.wrapper.appendChild(p))}}i.reInit(!0)},et()};Swiper.prototype={plugins:{},wrapperTransitionEnd:function(e,t){"use strict";function o(){e(n),n.params.queueEndCallbacks&&(n._queueEndCallbacks=!1);if(!t)for(s=0;s<i.length;s++)n.h.removeEventListener(r,i[s],o)}var n=this,r=n.wrapper,i=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],s;if(e)for(s=0;s<i.length;s++)n.h.addEventListener(r,i[s],o)},getWrapperTranslate:function(e){"use strict";var t=this.wrapper,n,r,i,s;return typeof e=="undefined"&&(e=this.params.mode==="horizontal"?"x":"y"),this.support.transforms&&this.params.useCSS3Transforms?(i=window.getComputedStyle(t,null),window.WebKitCSSMatrix?s=new WebKitCSSMatrix(i.webkitTransform==="none"?"":i.webkitTransform):(s=i.MozTransform||i.OTransform||i.MsTransform||i.msTransform||i.transform||i.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),n=s.toString().split(",")),e==="x"&&(window.WebKitCSSMatrix?r=s.m41:n.length===16?r=parseFloat(n[12]):r=parseFloat(n[4])),e==="y"&&(window.WebKitCSSMatrix?r=s.m42:n.length===16?r=parseFloat(n[13]):r=parseFloat(n[5]))):(e==="x"&&(r=parseFloat(t.style.left,10)||0),e==="y"&&(r=parseFloat(t.style.top,10)||0)),r||0},setWrapperTranslate:function(e,t,n){"use strict";var r=this.wrapper.style,i={x:0,y:0,z:0},s;arguments.length===3?(i.x=e,i.y=t,i.z=n):(typeof t=="undefined"&&(t=this.params.mode==="horizontal"?"x":"y"),i[t]=e),this.support.transforms&&this.params.useCSS3Transforms?(s=this.support.transforms3d?"translate3d("+i.x+"px, "+i.y+"px, "+i.z+"px)":"translate("+i.x+"px, "+i.y+"px)",r.webkitTransform=r.MsTransform=r.msTransform=r.MozTransform=r.OTransform=r.transform=s):(r.left=i.x+"px",r.top=i.y+"px"),this.callPlugins("onSetWrapperTransform",i),this.params.onSetWrapperTransform&&this.fireCallback(this.params.onSetWrapperTransform,this,i)},setWrapperTransition:function(e){"use strict";var t=this.wrapper.style;t.webkitTransitionDuration=t.MsTransitionDuration=t.msTransitionDuration=t.MozTransitionDuration=t.OTransitionDuration=t.transitionDuration=e/1e3+"s",this.callPlugins("onSetWrapperTransition",{duration:e}),this.params.onSetWrapperTransition&&this.fireCallback(this.params.onSetWrapperTransition,this,e)},h:{getWidth:function(e,t,n){"use strict";var r=window.getComputedStyle(e,null).getPropertyValue("width"),i=parseFloat(r);if(isNaN(i)||r.indexOf("%")>0)i=e.offsetWidth-parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-left"))-parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-right"));return t&&(i+=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-left"))+parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-right"))),n?Math.round(i):i},getHeight:function(e,t,n){"use strict";if(t)return e.offsetHeight;var r=window.getComputedStyle(e,null).getPropertyValue("height"),i=parseFloat(r);if(isNaN(i)||r.indexOf("%")>0)i=e.offsetHeight-parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-top"))-parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-bottom"));return t&&(i+=parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-top"))+parseFloat(window.getComputedStyle(e,null).getPropertyValue("padding-bottom"))),n?Math.round(i):i},getOffset:function(e){"use strict";var t=e.getBoundingClientRect(),n=document.body,r=e.clientTop||n.clientTop||0,i=e.clientLeft||n.clientLeft||0,s=window.pageYOffset||e.scrollTop,o=window.pageXOffset||e.scrollLeft;return document.documentElement&&!window.pageYOffset&&(s=document.documentElement.scrollTop,o=document.documentElement.scrollLeft),{top:t.top+s-r,left:t.left+o-i}},windowWidth:function(){"use strict";if(window.innerWidth)return window.innerWidth;if(document.documentElement&&document.documentElement.clientWidth)return document.documentElement.clientWidth},windowHeight:function(){"use strict";if(window.innerHeight)return window.innerHeight;if(document.documentElement&&document.documentElement.clientHeight)return document.documentElement.clientHeight},windowScroll:function(){"use strict";if(typeof pageYOffset!="undefined")return{left:window.pageXOffset,top:window.pageYOffset};if(document.documentElement)return{left:document.documentElement.scrollLeft,top:document.documentElement.scrollTop}},addEventListener:function(e,t,n,r){"use strict";typeof r=="undefined"&&(r=!1),e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on"+t,n)},removeEventListener:function(e,t,n,r){"use strict";typeof r=="undefined"&&(r=!1),e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent("on"+t,n)}},setTransform:function(e,t){"use strict";var n=e.style;n.webkitTransform=n.MsTransform=n.msTransform=n.MozTransform=n.OTransform=n.transform=t},setTranslate:function(e,t){"use strict";var n=e.style,r={x:t.x||0,y:t.y||0,z:t.z||0},i=this.support.transforms3d?"translate3d("+r.x+"px,"+r.y+"px,"+r.z+"px)":"translate("+r.x+"px,"+r.y+"px)";n.webkitTransform=n.MsTransform=n.msTransform=n.MozTransform=n.OTransform=n.transform=i,this.support.transforms||(n.left=r.x+"px",n.top=r.y+"px")},setTransition:function(e,t){"use strict";var n=e.style;n.webkitTransitionDuration=n.MsTransitionDuration=n.msTransitionDuration=n.MozTransitionDuration=n.OTransitionDuration=n.transitionDuration=t+"ms"},support:{touch:window.Modernizr&&Modernizr.touch===!0||function(){"use strict";return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}(),transforms3d:window.Modernizr&&Modernizr.csstransforms3d===!0||function(){"use strict";var e=document.createElement("div").style;return"webkitPerspective"in e||"MozPerspective"in e||"OPerspective"in e||"MsPerspective"in e||"perspective"in e}(),transforms:window.Modernizr&&Modernizr.csstransforms===!0||function(){"use strict";var e=document.createElement("div").style;return"transform"in e||"WebkitTransform"in e||"MozTransform"in e||"msTransform"in e||"MsTransform"in e||"OTransform"in e}(),transitions:window.Modernizr&&Modernizr.csstransitions===!0||function(){"use strict";var e=document.createElement("div").style;return"transition"in e||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"MsTransition"in e||"OTransition"in e}(),classList:function(){"use strict";var e=document.createElement("div").style;return"classList"in e}()},browser:{ie8:function(){"use strict";var e=-1;if(navigator.appName==="Microsoft Internet Explorer"){var t=navigator.userAgent,n=new RegExp(/MSIE ([0-9]{1,}[\.0-9]{0,})/);n.exec(t)!==null&&(e=parseFloat(RegExp.$1))}return e!==-1&&e<9}(),ie10:window.navigator.msPointerEnabled,ie11:window.navigator.pointerEnabled}},(window.jQuery||window.Zepto)&&function(e){"use strict";e.fn.swiper=function(t){var n=new Swiper(e(this)[0],t);return e(this).data("swiper",n),n}}(window.jQuery||window.Zepto),typeof module!="undefined"&&(module.exports=Swiper),typeof define=="function"&&define.amd&&define("lib-app/swiper/idangerous.swiper",[],function(){"use strict";return Swiper}),define("lib-build/css!lib-app/swiper/idangerous.swiper",[],function(){}),define("storymaps/tpl/ui/mobile/Footer",["lib-build/css!./Footer","lib-build/tpl!./FooterTpl","lib-build/tpl!./FooterEntryTpl","storymaps/common/utils/CommonHelper","dojo/has","dojo/topic","lib-app/swiper/idangerous.swiper","lib-build/css!lib-app/swiper/idangerous.swiper"],function(e,t,n,r,i,s,o){return function(i,u,a){function h(e,r,s){var f="",h=e.length;l=null,$.each(e,function(t,i){var o=i.title,u=i18n.viewer.mobileFooter.lblEnd;t!=h-1&&e[t+1].title?u=i18n.viewer.mobileFooter.lblNext+": "+e[t+1].title:t===0&&(u="");if(r=="bullet"||r=="accordion")s.reverse?o=h-t+(o?" - "+o:""):o=t+1+(o?" - "+o:"");f+=n({title:o||"&nbsp;",next:u,enableLegend:i.media.type=="webmap",enableInfo:!!i.description})}),i.html(t({entriesHTML:f})),c=new o(i.find(".swiper-container")[0],{mode:"horizontal",loop:!1,keyboardControl:!1,onSlideChangeEnd:function(e){l!=e.activeIndex&&a(e.activeIndex),d(),c.resizeFix()},onTouchStart:function(){i.tooltip("destroy")}}),v(),d(),e.length<2&&(i.tooltip("destroy"),!u&&i.hasClass("hasDesktopBtn")&&i.removeClass("hasDesktopBtn").addClass("oneEntry"))}function p(e){i.css({color:e.text,backgroundColor:e.panel}),r.addCSSRule(".footerMobile .tooltip-inner { 						background-color: "+e.header+"; 						color: "+e.headerTitle+"; 					}					.footerMobile .tooltip-arrow { 						border-top-color: "+e.header+" !important; 					}","MobileFooterTooltip")}function d(){i.find(".embed-btn-left").toggleClass("disabled",!c.activeIndex),i.find(".embed-btn-right").toggleClass("disabled",c.activeIndex===c.slides.length-1)}function v(){i.find(".embed-btn").click(function(){var e=$(this).parent();e.hasClass("disabled")||(e.hasClass("embed-btn-left")?c.swipePrev():c.swipeNext())})}function m(){$("body").hasClass("hasTouch")?(i.tooltip({title:'<span class="footerTooltip"><span class="glyphicon glyphicon-resize-horizontal" style="vertical-align: -2px;"></span> '+i18n.viewer.mobileFooter.swipeInvite+"</span>",html:!0,trigger:"manual",container:".footerMobile"}).on("shown.bs.tooltip",function(){var e=$(this).attr("aria-describedby");$("#"+e).click(function(){i.tooltip("destroy")})}),s.subscribe("tpl-ready",function(){setTimeout(function(){i.tooltip("show")},3e3)})):i.addClass("hasDesktopBtn")}var f=null,l=null,c=null;this.init=function(e){e=e||{},f=e.entries,h(e.entries,e.appLayout,e.layoutOpt),p(e.appColors)},this.update=function(e){p(e.appColors)},this.resize=function(){c&&c.resizeFix()},this.showEntryIndex=function(e){if(!c)return;if(!i.is(":visible"))return;l!=e&&(c.swipeTo(e),d()),l=e},this.removeMobileInvite=function(){i.tooltip("destroy")},m()}}),define("lib-build/css!storymaps/common/mapcontrols/command/MapCommand",[],function(){}),define("storymaps/common/mapcontrols/command/MapCommand",["lib-build/css!./MapCommand","dojo/has","esri/geometry/Point","dojo/on","esri/symbols/PictureMarkerSymbol","esri/layers/GraphicsLayer","esri/graphic","esri/config"],function(e,t,n,r,i,s,o,u){return function(a,f,l,c){function m(e){if(e)$(a.container).find(".mapCommandHomeBtn").addClass("loading"),h=Date.now();else{var t=Date.now()-h,n=0;t<450&&(n=450-t),setTimeout(function(){$(a.container).find(".mapCommandHomeBtn").removeClass("loading"),h=0},n)}}function g(){console.log("getDeviceLocation");var e=1e4,t=!1;setTimeout(function(){t||$(a.container).find(".mapCommandLocation").addClass("loading")},300),navigator.geolocation.getCurrentPosition(function(e){t=!0,$(a.container).find(".mapCommandLocation").removeClass("loading");var r=new n(e.coords.longitude,e.coords.latitude);l&&typeof l=="function"&&l(!0,r,e);if(a.spatialReference.wkid!=102100&&a.spatialReference.wkid!=4326){u.defaults.geometryService.project([r],a.spatialReference,function(e){if(!e||!e[0])return;y(e[0])});return}y(r)},function(e){t=!0,b(e)},{enableHighAccuracy:!0,maximumAge:12e4,timeout:e}),setTimeout(function(){t||b()},e)}function y(e){v.clear(),v.add(new o(e,d)),setTimeout(function(){$("#locateLayer_layer image").fadeOut({duration:800})},1e4)}function b(e){console.log("getDeviceLocationError",e),$(a.container).find(".mapCommandLocation").removeClass("loading"),l(!1,null)}var h=0,p=$('<div class="esriSimpleSliderIncrementButton"><div class="mapCommandHomeBtn" title="'+(i18n.viewer.mapFromCommon?i18n.viewer.mapFromCommon.home:"Zoom Home")+'" role="button" tabindex="0"></div></div>'),d=new i("resources/common/icons/mapcommand-location-marker.png",21,21),v=new s({id:"locateLayer"});p.click(function(){if(h!==0&&$("body").hasClass("mobile-view"))return;f&&typeof f=="function"?f(a._params.extent):a.setExtent(a._params.extent)}),$(a.container).find(".esriSimpleSlider div:nth-child(1)").after(p),r(a,"update-start",function(){h===0&&m(!0)}),r(a,"update-end",function(){m(!1)}),this.setMobile=function(e){$(".esriSimpleSlider, .mapCommandHomeBtn",a.container).toggleClass("touch",!!e)},this.destroy=function(){$(a.container).find(".esriSimpleSliderIncrementButton").remove(),$(a.container).find(".mapCommandLocation").remove()},this.startLoading=function(){m(!0)},this.stopLoading=function(){m(!1)},this.enableLocationButton=function(e){$(a.container).toggleClass("has-locator",e),$(".mapCommandLocation",a.container).toggleClass("hidden",!e)},navigator&&navigator.geolocation&&(window.top!==window.self?!1:window.location.protocol.search("https")>=0)&&($(".esriSimpleSlider",a.container).after('<div class="esriSimpleSlider esriSimpleSliderVertical mapCommandLocation"></div>'),$(".mapCommandLocation",a.container).click(g),this.enableLocationButton(c),a.addLayer(v)),this.setMobile(app.appCfg.mapCommandLargerTouch||app.appCfg.mapCommandLargerTouch===undefined&&t("touch"))}}),define("lib-build/tpl!storymaps/common/mapcontrols/legend/Legend",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="legendContainer mapControls">\n	<div class="titleBtn">\n		<span class="collapseBtn">\n			<div class="glyphicon glyphicon-chevron-down"></div>\n			<div class="glyphicon glyphicon-chevron-up"></div>\n		</span>\n		'+((__t=title)==null?"":__t)+'\n	</div>\n\n	<div class="content">\n		<div class="legendDijitContainer"></div>\n		',isInBuilder&&(__p+='\n			<div class="settingsGear glyphicon glyphicon-wrench"></div>\n			<div class="settingsOverlay">\n				<div class="settings-title">'+((__t=settings)==null?"":__t)+'</div>\n				<div class="settings-content">\n					<!-- Open by default -->\n					<div class="checkbox">\n						<label>\n							<input type="checkbox" class="expandStartup" />\n							'+((__t=openDefault)==null?"":__t)+"\n						</label>\n					</div>\n				</div>\n			</div>\n		"),__p+="\n	</div>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/mapcontrols/legend/Legend",[],function(){}),define("lib-build/css!storymaps/common/mapcontrols/Common",[],function(){}),define("storymaps/common/mapcontrols/legend/Legend",["lib-build/tpl!./Legend","lib-build/css!./Legend","lib-build/css!../Common","storymaps/common/utils/CommonHelper","esri/dijit/Legend","esri/arcgis/utils","dojo/topic"],function(e,t,n,r,i,s,o){return function(n,u,a){function d(){h.find(".legendDijitContainer").html('<div class="legendDijit"></div>'),l=new i({map:n.map,layerInfos:s.getLegendLayers(n)},h.find(".legendDijit")[0]),l.startup()}function v(){l&&l.destroy(),l=null}function m(){h.find(".legendContainer").toggleClass("collapsed"),h.find(".settingsOverlay").hide()}function g(){h.find(".titleBtn").click(m),h.find(".settingsGear").click(function(){h.find(".settingsOverlay").is(":visible")?h.off("mouseleave"):h.mouseleave(function(){h.find(".settingsOverlay").toggle(),h.off("mouseleave"),h.find(".content").removeClass("settingsOpen")}),h.find(".settingsOverlay").toggle(),h.find(".content").toggleClass("settingsOpen")}),h.find(".expandStartup").change(y),f.updatePlacementSettings(a)}function y(){c.openByDefault=h.find(".expandStartup").prop("checked"),o.publish("BUILDER_INCREMENT_COUNTER",1)}var f=this,l=null,c=null,h=a.container,p={isInBuilder:u,title:i18n.viewer.mapFromCommon.legend};u&&(p.settings=i18n.commonMapControls.common.settings,p.openDefault=i18n.commonMapControls.common.openDefault),h.html(e(p)),this.toggle=function(e){h.toggle(!!e),e&&!l?d():e||v()},this.toggleExpanded=function(e){h.find(".legendContainer").toggleClass("collapsed",!e)},this.setColors=function(e){h.find(".legendContainer").css({backgroundColor:e.mapControls,color:e.text}),h.find(".titleBtn").css("color",e.softText),h.find(".settingsGear, .collapseBtn").css("color",e.softBtn),r.addCSSRule(".mainMediaContainer .legendContainer ::-webkit-scrollbar-thumb { background-color:"+e.header+"; }","MapControlLegendDropdownScrollbar")},this.updatePlacementSettings=function(e){h.find(".legendContainer").toggleClass("isInlined",e.mode=="panel"),e.container[0]!=h[0]&&(e.container.html(h.find(".legendContainer")),h=e.container)},this.setSettings=function(e){c=e,h.find(".expandStartup").prop("checked",c.openByDefault)},g()}}),define("lib-build/tpl!storymaps/common/mapcontrols/overview/Overview",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="overviewContainer mapControls">\n	<div class="titleBtn">\n		<span class="collapseBtn">\n			<div class="glyphicon glyphicon-chevron-down"></div>\n			<div class="glyphicon glyphicon-chevron-up"></div>\n		</span>\n		'+((__t=title)==null?"":__t)+'\n	</div>\n\n	<div class="content">\n		<div class="overviewMapContainer">\n			<!-- Map is injected here -->\n		</div>\n		',isInBuilder&&(__p+='\n			<div class="settingsGear glyphicon glyphicon-wrench"></div>\n			<div class="settingsOverlay">\n				<div class="settings-title">'+((__t=settings)==null?"":__t)+'</div>\n				<div class="settings-content">\n					<!-- Open by default -->\n					<div class="checkbox">\n						<label>\n							<input type="checkbox" class="expandStartup" />\n							'+((__t=openDefault)==null?"":__t)+'\n						</label>\n					</div>\n\n					<!-- Basemap -->\n					<div class="btn-group dropup basemap-dropdown">\n						<button type="button" class="btn btn-default btn-sm dropdown-toggle basemapBtn" data-toggle="dropdown">\n							'+((__t=basemapGalleryBtnLabel)==null?"":__t)+' <span class="caret"></span>\n						</button>\n						<ul class="dropdown-menu basemaps dropdown-menu-form pull-right" role="menu"></ul>\n					</div>\n					<div id="basemapGallery"></div>\n\n					<!-- Expand factor -->\n					<div class="spinnerLabel">\n						<label for="expandFactorSpinner">'+((__t=expandFactorLabel)==null?"":__t)+'</label>\n						<a class="locateBtnHelp" data-original-title="" title="">\n							<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -5px;">\n						</a>\n					</div>\n\n					<div class="input-group expandFactorSpinner">\n						<input type="text" class="form-control input-small input-xs" id="expandFactorSpinner" value="2">\n						<div class="input-group-btn-vertical">\n							<button class="btn btn-default btn-xs"><i class="glyphicon glyphicon-chevron-up"></i></button>\n							<button class="btn btn-default btn-xs"><i class="glyphicon glyphicon-chevron-down"></i></button>\n						</div>\n					</div>\n				</div>\n			</div>\n		'),__p+="\n	</div>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/mapcontrols/overview/Overview",[],function(){}),define("storymaps/common/mapcontrols/overview/Overview",["lib-build/tpl!./Overview","lib-build/css!./Overview","lib-build/css!../Common","esri/dijit/OverviewMap","esri/dijit/BasemapGallery","esri/layers/ArcGISTiledMapServiceLayer","esri/arcgis/utils","dojo/Deferred","dojo/dom","dojo/on","dojo/topic"],function(e,t,n,r,i,s,o,u,a,f,l){return function(n,i,s){function c(e){i.find(".overviewMapContainer").html('<div class="overviewMap"></div>'),o=new r({map:n,visible:!0,color:"transparent",opacity:1},i.find(".overviewMap")[0]),o.startup();var t=e?e.header:a;t&&i.find(".ovwHighlight").css("border","3px solid "+t)}function h(){o&&o.destroy(),o=null}function p(){i.find(".overviewContainer").toggleClass("collapsed"),i.find(".settingsOverlay").hide()}function d(){i.find(".titleBtn").click(p),i.find(".settingsGear").click(function(){i.find(".settingsOverlay").is(":visible")?i.off("mouseleave"):i.mouseleave(function(){i.find(".settingsOverlay").toggle(),i.off("mouseleave")}),i.find(".settingsOverlay").toggle()}),i.find(".expandStartup").change(v)}function v(){u.openByDefault=i.find(".expandStartup").prop("checked"),l.publish("BUILDER_INCREMENT_COUNTER",1)}var o=null,u=null,a=null,f={isInBuilder:s,title:i18n.viewer.mapFromCommon.overview,overlayHeader:"",basemapGalleryBtnLabel:"",expandFactorLabel:""};s&&(f.settings=i18n.commonMapControls.common.settings,f.openDefault=i18n.commonMapControls.common.openDefault,f.basemapGalleryBtnLabel=i18n.commonMapControls.overview.basemapGalleryBtnLabel,f.expandFactorLabel=i18n.commonMapControls.overview.expandFactorLabel),i.append(e(f)),this.toggle=function(e,t){i.toggle(!!e),e&&!o?c(t):e||h()},this.toggleExpanded=function(e){i.find(".overviewContainer").toggleClass("collapsed",!e)},this.setColors=function(e){a=e.mapControls,i.find(".overviewContainer").css({backgroundColor:a,color:e.text}),i.find(".titleBtn").css("color",e.softText),i.find(".settingsGear, .collapseBtn").css("color",e.softBtn),i.find(".ovwHighlight").css("border","3px solid "+a)},this.setSettings=function(e){u=e,i.find(".expandStartup").prop("checked",u.openByDefault)},d()}}),define("lib-build/tpl!storymaps/common/mapcontrols/geocoder/Geocoder",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="geocoderBtn">\n	<div class="geocoderContainer"></div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/mapcontrols/geocoder/Geocoder",[],function(){}),define("storymaps/common/mapcontrols/geocoder/Geocoder",["lib-build/tpl!./Geocoder","lib-build/css!./Geocoder","../../utils/CommonHelper"],function(e,t,n){return function(r,i,s,o){function l(){$(r.container).find(".esriSimpleSlider").last().after(e({})),c(),u.toggle(s)}function c(){var e=$(r.container).find(".geocoderBtn");f=n.createGeocoder({map:r,domNode:e.find(".geocoderContainer")[0],enableButtonMode:!0,searchOptions:o}).then(function(t){a=t,e.find(".esriGeocoderContainer input, .esriGeocoderSearch").attr("tabindex","-1")})}var u=this,a=null,f;this.toggle=function(e){if(!app.isInBuilder){var t=app.data.getWebAppData();if(t.getMapOptions&&(!t.getMapOptions().geocoder||!t.getMapOptions().geocoder.enable))return;if(t.getGeneralOptions&&!t.getGeneralOptions().geocoder)return}var n=$(r.container).find(".geocoderBtn");!a&&(!f||f.isRejected())&&c(e),$(r.container).toggleClass("has-geocoder",e),n.toggle(e)},l()}}),define("lib-build/tpl!storymaps/common/ui/autoplay/Autoplay",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="autoplay-container">\n	<div class="backdrop"></div>\n	<div class="btn-play-container status-pause">\n		<span class="btn-play glyphicon glyphicon-play"></span>\n	</div>\n	<div class="slider-container ">\n		<input type="text" class="span2" value="" />\n	</div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/ui/autoplay/Autoplay",[],function(){}),!function(e){var t=function(t,n){this.element=e(t),this.picker=e('<div class="slider"><div class="slider-track"><div class="slider-selection"></div><div class="slider-handle"></div><div class="slider-handle"></div></div><div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div></div>').insertBefore(this.element).append(this.element),this.id=this.element.data("slider-id")||n.id,this.id&&(this.picker[0].id=this.id),typeof Modernizr!="undefined"&&Modernizr.touch&&(this.touchCapable=!0);var r=this.element.data("slider-tooltip")||n.tooltip;this.tooltip=this.picker.find(".tooltip"),this.tooltipInner=this.tooltip.find("div.tooltip-inner"),this.orientation=this.element.data("slider-orientation")||n.orientation;switch(this.orientation){case"vertical":this.picker.addClass("slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight",this.tooltip.addClass("right")[0].style.left="100%";break;default:this.picker.addClass("slider-horizontal").css("width",this.element.outerWidth()),this.orientation="horizontal",this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth",this.tooltip.addClass("top")[0].style.top=-this.tooltip.outerHeight()-14+"px"}this.min=this.element.data("slider-min")||n.min,this.max=this.element.data("slider-max")||n.max,this.step=this.element.data("slider-step")||n.step,this.value=this.element.data("slider-value")||n.value,this.value[1]&&(this.range=!0),this.selection=this.element.data("slider-selection")||n.selection,this.selectionEl=this.picker.find(".slider-selection"),this.selection==="none"&&this.selectionEl.addClass("hide"),this.selectionElStyle=this.selectionEl[0].style,this.handle1=this.picker.find(".slider-handle:first"),this.handle1Stype=this.handle1[0].style,this.handle2=this.picker.find(".slider-handle:last"),this.handle2Stype=this.handle2[0].style;var i=this.element.data("slider-handle")||n.handle;switch(i){case"round":this.handle1.addClass("round"),this.handle2.addClass("round");break;case"triangle":this.handle1.addClass("triangle"),this.handle2.addClass("triangle")}this.range?(this.value[0]=Math.max(this.min,Math.min(this.max,this.value[0])),this.value[1]=Math.max(this.min,Math.min(this.max,this.value[1]))):(this.value=[Math.max(this.min,Math.min(this.max,this.value))],this.handle2.addClass("hide"),this.selection=="after"?this.value[1]=this.max:this.value[1]=this.min),this.diff=this.max-this.min,this.percentage=[(this.value[0]-this.min)*100/this.diff,(this.value[1]-this.min)*100/this.diff,this.step*100/this.diff],this.offset=this.picker.offset(),this.size=this.picker[0][this.sizePos],this.formater=n.formater,this.layout(),this.touchCapable?this.picker.on({touchstart:e.proxy(this.mousedown,this)}):this.picker.on({mousedown:e.proxy(this.mousedown,this)}),r==="show"?this.picker.on({mouseenter:e.proxy(this.showTooltip,this),mouseleave:e.proxy(this.hideTooltip,this)}):this.tooltip.addClass("hide")};t.prototype={constructor:t,over:!1,inDrag:!1,showTooltip:function(){this.tooltip.addClass("in"),this.over=!0},hideTooltip:function(){this.inDrag===!1&&this.tooltip.removeClass("in"),this.over=!1},layout:function(){this.handle1Stype[this.stylePos]=this.percentage[0]+"%",this.handle2Stype[this.stylePos]=this.percentage[1]+"%",this.orientation=="vertical"?(this.selectionElStyle.top=Math.min(this.percentage[0],this.percentage[1])+"%",this.selectionElStyle.height=Math.abs(this.percentage[0]-this.percentage[1])+"%"):(this.selectionElStyle.left=Math.min(this.percentage[0],this.percentage[1])+"%",this.selectionElStyle.width=Math.abs(this.percentage[0]-this.percentage[1])+"%"),this.range?(this.tooltipInner.text(this.formater(this.value[0])+" : "+this.formater(this.value[1])),this.tooltip[0].style[this.stylePos]=this.size*(this.percentage[0]+(this.percentage[1]-this.percentage[0])/2)/100-(this.orientation==="vertical"?this.tooltip.outerHeight()/2:this.tooltip.outerWidth()/2)+"px"):(this.tooltipInner.text(this.formater(this.value[0])),this.tooltip[0].style[this.stylePos]=this.size*this.percentage[0]/100-(this.orientation==="vertical"?this.tooltip.outerHeight()/2:this.tooltip.outerWidth()/2)+"px")},mousedown:function(t){this.touchCapable&&t.type==="touchstart"&&(t=t.originalEvent),this.offset=this.picker.offset(),this.size=this.picker[0][this.sizePos];var n=this.getPercentage(t);if(this.range){var r=Math.abs(this.percentage[0]-n),i=Math.abs(this.percentage[1]-n);this.dragged=r<i?0:1}else this.dragged=0;this.percentage[this.dragged]=n,this.layout(),this.touchCapable?e(document).on({touchmove:e.proxy(this.mousemove,this),touchend:e.proxy(this.mouseup,this)}):e(document).on({mousemove:e.proxy(this.mousemove,this),mouseup:e.proxy(this.mouseup,this)}),this.inDrag=!0;var s=this.calculateValue();return this.element.trigger({type:"slideStart",value:s}).trigger({type:"slide",value:s}),!1},mousemove:function(e){this.touchCapable&&e.type==="touchmove"&&(e=e.originalEvent);var t=this.getPercentage(e);this.range&&(this.dragged===0&&this.percentage[1]<t?(this.percentage[0]=this.percentage[1],this.dragged=1):this.dragged===1&&this.percentage[0]>t&&(this.percentage[1]=this.percentage[0],this.dragged=0)),this.percentage[this.dragged]=t,this.layout();var n=this.calculateValue();return this.element.trigger({type:"slide",value:n}).data("value",n).prop("value",n),!1},mouseup:function(t){this.touchCapable?e(document).off({touchmove:this.mousemove,touchend:this.mouseup}):e(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.inDrag=!1,this.over==0&&this.hideTooltip(),this.element;var n=this.calculateValue();return this.element.trigger({type:"slideStop",value:n}).data("value",n).prop("value",n),!1},calculateValue:function(){var e;return this.range?(e=[this.min+Math.round(this.diff*this.percentage[0]/100/this.step)*this.step,this.min+Math.round(this.diff*this.percentage[1]/100/this.step)*this.step],this.value=e):(e=this.min+Math.round(this.diff*this.percentage[0]/100/this.step)*this.step,this.value=[e,this.value[1]]),e},getPercentage:function(e){this.touchCapable&&(e=e.touches[0]);var t=(e[this.mousePos]-this.offset[this.stylePos])*100/this.size;return t=Math.round(t/this.percentage[2])*this.percentage[2],Math.max(0,Math.min(100,t))},getValue:function(){return this.range?this.value:this.value[0]},setValue:function(e){this.value=e,this.range?(this.value[0]=Math.max(this.min,Math.min(this.max,this.value[0])),this.value[1]=Math.max(this.min,Math.min(this.max,this.value[1]))):(this.value=[Math.max(this.min,Math.min(this.max,this.value))],this.handle2.addClass("hide"),this.selection=="after"?this.value[1]=this.max:this.value[1]=this.min),this.diff=this.max-this.min,this.percentage=[(this.value[0]-this.min)*100/this.diff,(this.value[1]-this.min)*100/this.diff,this.step*100/this.diff],this.layout()}},e.fn.slider=function(n,r){return this.each(function(){var i=e(this),s=i.data("slider"),o=typeof n=="object"&&n;s||i.data("slider",s=new t(this,e.extend({},e.fn.slider.defaults,o))),typeof n=="string"&&s[n](r)})},e.fn.slider.defaults={min:0,max:10,step:1,orientation:"horizontal",value:5,selection:"before",tooltip:"show",handle:"round",formater:function(e){return e}},e.fn.slider.Constructor=t}(window.jQuery),define("lib-app/bootstrap-slider/js/bootstrap-slider",function(){}),define("lib-build/css!lib-app/bootstrap-slider/css/slider",[],function(){}),define("storymaps/common/ui/autoplay/Autoplay",["lib-build/tpl!./Autoplay","lib-build/css!./Autoplay","dojo/topic","dojo/has","lib-app/bootstrap-slider/js/bootstrap-slider","lib-build/css!lib-app/bootstrap-slider/css/slider"],function(e,t,n,r){var i=6e3,s=10;return function(n,o){function h(e,t){console.log("Autoplay: start, delay:",e,"immediate:",t),u=!0,a&&clearTimeout(a),t?d(e):a=setTimeout(function(){d(e)},e)}function p(){if(!u)return;console.log("Autoplay: pause"),u=!1,a&&clearTimeout(a)}function d(e){f=o(),a=setTimeout(function(){d(e)},e)}function v(){return n.find(".btn-play-container").hasClass("status-play")}function m(e){n.find(".btn-play-container").removeClass("status-play status-pause"),n.find(".btn-play").removeClass("glyphicon-play glyphicon-pause"),n.find(".btn-play-container").addClass(e?"status-play":"status-pause"),n.find(".btn-play").addClass(e?"glyphicon-pause":"glyphicon-play")}function g(){var e=!v();e?y(!0):p(),m(e)}function y(e){var t=n.find(".slider input").slider("getValue").val()||s;h(t*1e3,e)}function b(){var e=Date.now();l>Date.now()-150&&n.removeClass("fade"),l=e}function w(){!c&&Date.now()>l+i&&n.addClass("fade")}function E(){n.find(".btn-play-container").click(g),n.find(".slider-container input").slider({min:5,max:60,value:s,formater:function(e){return e+"s"}}),n.find(".slider-container input").on("slideStop",function(){v()&&y(!1)}),r("touch")||(l=Date.now(),n.hover(function(){c=!0},function(){c=!1,w()}),$(window).mousemove(b),setInterval(w,1e3))}var u=!1,a=null,f=null,l=null,c=!1;(!n||!o||typeof o!="function")&&console.log("Autoplay: failed to initialize"),n.append(e({})).show(),E(),this.init=function(e){if(!e)return;if(e.color)if(e.useBackdrop)n.find(".backdrop").css({backgroundColor:e.color,display:"block"}),n.find(".autoplay-container").css({backgroundColor:"inherit"});else{n.find(".autoplay-container").css({backgroundColor:e.color});if(e.color=="#FFF8E9"||e.color=="#FFFFFF"||e.color=="#D4E6C3")e.themeMajor="white2"}e.themeMajor&&n.addClass("theme-"+e.themeMajor)},this.start=function(){y(!1),m(!0)},this.stop=function(){p(),m(!1)},this.onNavigationEvent=function(e){v()&&e!=f&&g()}}}),define("lib-build/css!storymaps/common/_resources/font/sharing/css/fontello",[],function(){}),define("lib-build/css!storymaps/common/utils/SocialSharing",[],function(){}),define("lib-build/css!storymaps/common/ui/loadingIndicator/LoadingIndicator",[],function(){}),define("lib-build/css!storymaps/tpl/ui/Common",[],function(){}),define("lib-build/css!storymaps/tpl/ui/StoryText",[],function(){}),define("lib-build/css!storymaps/tpl/ui/mobile/Common",[],function(){}),define("lib-build/css!storymaps/tpl/ui/Responsive",[],function(){}),define("storymaps/tpl/core/MainView",["lib-build/css!./MainView","../ui/MainStage","./Config","./Data","./WebApplicationData","./Helper","../ui/desktop/AccordionPanel","../ui/desktop/NavBar","../ui/desktop/DescriptionAndLegendPanel","../ui/mobile/Header","../ui/mobile/EntryInfo","../ui/mobile/Footer","../ui/mobile/PopupUtils","storymaps/common/mapcontrols/command/MapCommand","storymaps/common/mapcontrols/legend/Legend","storymaps/common/mapcontrols/overview/Overview","storymaps/common/mapcontrols/geocoder/Geocoder","storymaps/common/ui/autoplay/Autoplay","lib-build/css!storymaps/common/_resources/font/sharing/css/fontello.css","lib-build/css!storymaps/common/utils/SocialSharing.css","lib-build/css!storymaps/common/ui/loadingIndicator/LoadingIndicator.css","storymaps/common/utils/CommonHelper","dojo/has","dojo/topic","esri/arcgis/utils","esri/geometry/Extent","../ui/StoryText","lib-build/css!../ui/Common","lib-build/css!../ui/StoryText","lib-build/css!../ui/mobile/Common","lib-build/css!../ui/Responsive"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C){return function(y){function w(e){var t=e.itemInfo.itemData,n=t.applicationProperties,r=n&&n.viewing&&n.viewing.search,i=t.operationalLayers||[];if(!r)return;return r.layers.forEach(function(e){_.find(i,function(t){if(t.id===e.id)return e.name=t.name,e.title=t.title,!0})}),r}function k(e,t){var n=i.getLegendPlacement(),r=e.siblings(".legend");return $("body").hasClass("mobile-view")?(n="panel",r=e.siblings(".mobilePopup").find(".legendMobile")):n=="panel"&&(r=app.ui.descLegendPanel.getLegendContainer(t)),{mode:n,container:r}}function L(){var e=app.data.getStoryLength(),t=0,n=parseInt(E.getUrlParams().entry,10);app.data.cleanEntriesMarkup(),n&&(t=n-1),t>=e&&(t=0),e&&app.data.setCurrentSectionIndex(t);if(e){$("body").addClass("layout-"+i.getLayoutId()),D(),b.handleWindowResize();if(app.data.getCurrentSection().media.type!="webmap")A();else{var r,s;r=x.subscribe("story-loaded-map",function(){r.remove(),s.remove(),A()}),s=x.subscribe("story-entry-map-timeout",function(){r.remove(),s.remove(),A()})}}else A()}function A(){i.isBlank()?app.isInBuilder?b.isProd()?y.showInitPopup():b.portalLogin().then(y.showInitPopup,function(){b.initError("noLayerNoHostedFS")}):E.getAppID(b.isProd())?app.userCanEdit?E.switchToBuilder():b.initError("notConfiguredDesktop"):b.initError("noLayer"):b.appInitComplete(),y&&y.updateUI()}function O(){var e=i.getLayoutId(),t=i.getColors(),n=i.getLayoutOptions(),r=app.data.getStoryEntries(),s=app.data.getCurrentSectionIndex();e=="accordion"?(n.panel.position=="left"?$("#accordionPanel").parent().children().eq(0).is("#accordionPanel")||$("#mainStagePanel").before($("#accordionPanel")):$("#accordionPanel").parent().children().eq(0).is("#mainStagePanel")||$("#accordionPanel").before($("#mainStagePanel")),app.ui.accordionPanel.init(r,s,n,t),app.ui.descLegendPanel.destroy()):(app.ui.navBar.init(r,s,e,n,t),app.ui.descLegendPanel.init(r,s,n,t,R())),M()&&(app.ui.mobileHeader.init({title:i.getTitle(),subtitle:i.getSubtitle(),headerCfg:b.getHeaderUserCfg({useMobileLogo:!0}),entries:r,entryIndex:s,appLayout:e,layoutOpt:n,appColors:t}),app.ui.mobileEntryInfo.init({entries:r,entryIndex:s}),h.setColors(t),app.ui.mobileFooter.init({entries:r,entryIndex:s,appLayout:e,layoutOpt:n,appColors:t})),app.ui.autoplay&&app.ui.autoplay.init({color:t.panel,themeMajor:t.themeMajor,useBackdrop:!1})}function M(){return S("ie")===undefined||S("ie")>8}function D(){app.ui.mainStage.updateMainMediaContainers(),O(),B(),C.createMediaFullScreenButton(),C.styleSectionPanelContent(),q(app.data.getCurrentSectionIndex()),y&&y.updateUI()}function P(e){D(),q(e.index)}function H(){var e=i.getLayoutId(),t=i.getColors(),n=i.getLayoutOptions();e=="accordion"?app.ui.accordionPanel.update(n,t):(app.ui.navBar.update(e,n,t),app.ui.descLegendPanel.update(n,t,R())),M()&&(app.ui.mobileHeader.update({layoutOpt:n,appColors:t}),h.setColors(t),app.ui.mobileFooter.update({appColors:t}))}function B(){var e=i.getColors();E.addCSSRule(".textEditorContent a, .accordionPanel .builder-lbl { color: "+e.textLink+"; }"),E.addCSSRule(".accordionPanel .builder-content-panel-group:not(.disabled):hover .builder-lbl { color: "+e.text+" !important; }")}function j(){var e=app.data.getCurrentSection(),t=e&&e.media&&e.media.type=="webmap",n=0;if(t){var r=$(".mainMediaContainer.active"),i=r.find(".geocoderBtn"),s=r.find(".mapCommandLocation"),o=r.find(".esriSimpleSliderTL");n=Math.max(i&&i.position()?i.position().top+i.height():0,s&&s.position()?s.position().top+s.height():0,o&&o.position()?o.position().top+o.height():0)}$("#descLegendPanel .descLegendPanelInner").css("min-height",n?n+20:"inherit")}function F(){var e=["tab","bullet"],t=["small","medium","large"],n="body:not(.mobile-view).layout-";$.each(app.cfg.LAYOUTS,function(r,i){e.indexOf(i.id)!=-1&&$.each(t,function(e,t){var r="calc("+parseInt(i.sizes[t],10)+"% + 20px)";E.addCSSRule(n+i.id+"-left-"+t+" .esriSimpleSlider,"+n+i.id+"-left-"+t+" .geocoderBtn"+"{ left:"+r+"; }"),E.addCSSRule(n+i.id+"-left-"+t+" .mainMediaContainer .overviewContainer"+"{ left: inherit; right: 20px; }"),E.addCSSRule(n+i.id+"-right-"+t+" .mainMediaContainer .overviewContainer"+"{ left: 20px; }"),E.addCSSRule(n+i.id+"-right-"+t+" .mainMediaContainer .legendContainer"+"{ right:"+r+"; }")})})}function I(e){E.addCSSRule(".mobilePopup { max-height:"+Math.min(e.height-120,300)+"px; }","MobilePopup")}function q(e){var t=i.getLayoutId(),n=i.getLayoutOptions(),r=!1;console.log("tpl.core.MainView - navigateStoryToIndex - ",e);if(e<0||e>app.data.getStoryLength()-1)return;var s=app.data.getStoryByIndex(e);if(app.data.getCurrentSection()){var o=app.data.getCurrentSection(),u=o&&o.media?o.media.type:null,a=s&&s.media?s.media.type:null;u!=a&&(r=!0)}M()&&(!s||s.media.type!="webmap"||!s.media.webmap.popup)&&h.close($(".mainMediaContainer.active .mapContainer").siblings(".mobileInfoWindow")),app.data.setCurrentSectionIndex(e);var f=R(),l=t=="accordion"||f.description||f.legend&&n.legend=="panel";$("body").toggleClass("layout-"+t+"-"+n.panel.position,l).toggleClass("layout-"+t+"-"+n.panel.position+"-"+n.panel.sizeLbl,l),t=="accordion"?app.ui.accordionPanel.showEntryIndex(e):(app.ui.navBar.showEntryIndex(e),app.ui.descLegendPanel.showEntryIndex(e,!1,f),j()),M()&&(app.ui.mobileHeader.showEntryIndex(e),app.ui.mobileEntryInfo.showEntryIndex(e,f),app.ui.mobileFooter.showEntryIndex(e)),app.ui.mainStage.updateMainMediaWithStoryMainMedia(e,r),$(".mediaBackContainer").hide()}function R(){var e=app.data.getCurrentSection(),t=i.getLayoutId(),n=i.getLayoutOptions();return!e||!e.media||!e.media[e.media.type]?{}:{description:!(t!="accordion"&&!n.description||!e.description&&!app.isInBuilder),legend:e.media.type=="webmap"&&!!e.media.webmap.legend&&!!e.media.webmap.legend.enable}}function U(e){var t=R(),n=app.data.getCurrentEntryIndex(),r=!1,i=-1;if(!e||!e.from||!e.direction)return;e.from=="nav"?(app.isInBuilder&&(r=!0),n===0&&e.direction=="backward"?r=!0:t.description&&e.direction=="forward"?app.ui.descLegendPanel.focus():r=!0):e.from=="panel"&&e.direction=="forward"?r=!0:e.from=="panel"&&e.direction=="backward"&&x.publish("story-navigate-entry",n);if(r){if(e.direction=="forward"){if(!(n<app.data.getStoryLength()-1))return window!=window.top?parent.document.focus():app.ui.headerDesktop.focus({area:"social"}),!1;i=n+1}else if(e.direction=="backward"){if(!(n>0))return app.ui.headerDesktop.focus({area:"title"}),!1;i=n-1}x.publish("story-navigate-entry",i)}}function z(){var e=app.data.getCurrentSection(),t=!!(e&&e.media&&e.media.type=="webmap"&&e.media.webmap),n=t?!!e.media.webmap.extent:!1,r=t?e.media.webmap.id:null;if(!t)return;n?x.publish("CORE_UPDATE_EXTENT",new N(e.media.webmap.extent)):x.publish("CORE_UPDATE_EXTENT",app.maps[r].response.map._params.extent)}var b=null;this.init=function(e){return b=e,app.isInBuilder&&S("ie")&&S("ie")<10?(i18n.viewer.errors.noBuilderIE=i18n.viewer.errors.noBuilderIE.replace("%VERSION%",10).replace("%UPGRADE%",i18n.viewer.errors.upgradeBrowser),b.initError("noBuilderIE"),!1):S("ie")&&S("ie")<=8?(i18n.viewer.errors.noViewerIE=i18n.viewer.errors.noViewerIE.replace("%VERSION%",9).replace("%UPGRADE%",i18n.viewer.errors.upgradeBrowser),b.initError("noViewerIE"),!1):($(document).bind("touchmove",function(e){$(e.target).parents(".legendContainer, #descLegendPanel, #accordionPanel, .mobilePopup, #headerMobile, .settings-layout").length||e.preventDefault()}),app.data=new r,app.ui.mainStage=new t($("#mainStagePanel"),app.isInBuilder,this),app.ui.accordionPanel=new o($("#accordionPanel"),app.isInBuilder,q),app.ui.navBar=new u($("#nav-bar"),app.isInBuilder,q),app.ui.descLegendPanel=new a($("#descLegendPanel"),app.isInBuilder),F(),app.ui.mobileHeader=new f($("#headerMobile"),app.isInBuilder,q),app.ui.mobileEntryInfo=new l($("#mobileInfoBtn")),app.ui.mobileFooter=new c($("#footerMobile"),app.isInBuilder,q),!app.isInBuilder&&E.getUrlParams().autoplay!==undefined&&E.getUrlParams().autoplay!=="false"&&(app.ui.autoplay=new g($("#autoplay"),function(){var e=0;return app.data.getCurrentEntryIndex()!=app.data.getStoryLength()-1&&(e=app.data.getCurrentEntryIndex()+1),setTimeout(function(){x.publish("story-navigate-entry",e)},50),e}),x.subscribe("tpl-ready",function(){$("body").hasClass("mobile-view")||app.ui.autoplay.start()}),x.subscribe("story-load-entry",function(e){app.ui.autoplay.onNavigationEvent(e)})),x.subscribe("story-navigate-entry",q),x.subscribe("story-update-entries",D),x.subscribe("story-update-entry",P),x.subscribe("story-entry-reset-map-extent",z),x.subscribe("ADDEDIT_LOAD_WEBMAP",app.ui.mainStage.loadTmpWebmap),x.subscribe("ADDEDIT_SHOW_WEBMAP",app.ui.mainStage.showWebmapById),x.subscribe("ADDEDIT_RELOAD_CURRENT_WEBMAP",app.ui.mainStage.reloadCurrentWebmap),x.subscribe("story-loaded-map",function(e){e.index==app.data.getCurrentSectionIndex()&&j()}),$("body").on("mousedown","*",function(e){($(this).is(":focus")||$(this).is(e.target))&&$(this).css("outline-style")=="none"&&($(this).css("outline","none").on("blur",function(){$(this).off("blur").css("outline","")}),$(this).parents(".image-container").length&&$(this).parents(".image-container").css("outline","none").on("blur",function(){$(this).off("blur").css("outline","")}),$(this).parents("figure.caption").length&&$(this).parents("figure.caption").css("outline","none").on("blur",function(){$(this).off("blur").css("outline","")}),$(this).parents("p").length&&$(this).parents("p").css("outline","none").on("blur",function(){$(this).off("blur").css("outline","")}),$(this).parents(".accordion-header-content").length&&$(this).parents(".accordion-header-content").css("outline","none").on("blur",function(){$(this).off("blur").css("outline","")}))}),x.subscribe("story-tab-navigation",U),!0)},this.webAppConfigLoaded=function(){app.data.setStoryStorage(i.getStoryStorage()),app.isGalleryCreation=!app.data.getWebAppData().getOriginalData()||!Object.keys(app.data.getWebAppData().getOriginalData().values).length,app.isWebMapCreation=app.data.getWebAppData().isBlank()},this.loadFirstWebmap=function(){},this.loadWebmapFromData=function(){L()},this.loadWebmap=function(e,t,n){console.log("tpl.core.MainView - loadWebMap - webmapId:",e);var r=null;return T.createMap(e,t,{mapOptions:{slider:!0,autoResize:!1,showAttribution:!0,infoWindow:r,extent:n},usePopupManager:!0,ignorePopups:!1,bingMapsKey:app.cfg.BING_MAPS_KEY,editable:!1,layerMixins:app.data.getAppProxies()})},this.firstWebmapLoaded=function(){},this.startFromScratch=function(){A()},this.getMapConfig=function(e,t){return{response:e,mapCommand:new p(e.map,z,b.zoomToDeviceLocation,app.data.getWebAppData().getLocateBtn()),legend:new d(e,app.isInBuilder,k(t,e.itemInfo.item.id)),overview:new v(e.map,t.siblings(".overview"),app.isInBuilder),geocoder:new m(e.map,app.isInBuilder,app.data.getWebAppData().getGeocoder(),w(e))}},this.updateUI=function(){var e=app.data.getWebAppData().getColors(),t=app.data.getWebAppData().getLayoutId();if($("body").hasClass("switchLayout")){var n=$.map($("body").attr("class").split(" "),function(e){return e.match(/layout-/)?e:null}).join(" ");$("body").removeClass("switchLayout").removeClass(n),O(t),setTimeout(function(){q(app.data.getCurrentSectionIndex()),D()},50)}$("body").addClass("layout-"+t).attr("data-theme-major",e.themeMajor),$.each(Object.keys(app.maps),function(e,t){app.maps[t].mapCommand.enableLocationButton(i.getLocateBtn()),app.maps[t].geocoder.toggle(i.getGeocoder()),app.maps[t].legend.updatePlacementSettings(k($(app.maps[t].response.map.container),t))}),B(),H(),app.ui.mainStage.updateMainStageWithLayoutSettings()},this.resize=function(e){var t=i.getLayoutId();$("#mainStagePanelInner, #accordionPanel > .content").height($("#contentPanel").height()),t=="accordion"?app.ui.accordionPanel.resize(e):(app.ui.navBar.resize(e),app.ui.descLegendPanel.resize(e)),M()&&app.ui.mobileFooter.resize(e);var n=app.data.getCurrentSectionIndex();app.ui.mobileFooter.showEntryIndex(n),C.styleSectionPanelContent(),app.ui.mainStage.updateMainStageWithLayoutSettings();var r=window.location!=window.parent.location?!0:!1;!S("ios")&&!r&&I(e),e.isMobileView&&app.ui.autoplay&&app.ui.autoplay.stop()},this.setMapExtent=function(e,t){return b.setMapExtent(e,t)},this.getLayoutExtent=function(e,t,n){return s.getLayoutExtent(e,t,n)},this.checkConfigFileIsOK=function(){return n.checkConfigFileIsOK()},this.appInitComplete=function(){this.updateUI(),b.cleanLoadingTimeout(),$(window).resize();var e=app.data.getWebAppData().isBlank()||app.data.getWebAppItem().access=="private"||app.data.getWebAppItem().access=="shared";app.ui.headerDesktop&&app.ui.headerDesktop.toggleSocialBtnAppSharing(e),app.ui.autoplay&&(app.ui.headerDesktop&&app.ui.headerDesktop.enableAutoplay(),app.ui.mobileHeader&&app.ui.mobileHeader.enableAutoplay()),app.isDirectCreation||b.displayApp(),x.publish("tpl-ready"),app.ui.mainStage.preloadAllMaps();var t=window.location!=window.parent.location?!0:!1;S("ios")&&t&&I({height:$(window).height})},this.onHashChange=function(){},this.prepareMobileViewSwitch=function(){},this.initLocalization=function(){}}}),define("lib-build/css!storymaps/common/builder/Builder",[],function(){}),define("lib-build/css!lib-app/font-awesome/css/font-awesome.min",[],function(){}),define("lib-build/tpl!storymaps/common/builder/BuilderPanel",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<h3 class="appTitle"><!--'+((__t=title)==null?"":__t)+'--></h3>\n<div class="buttons btn-group">\n	<button class="builder-cmd builder-settings" title="'+((__t=btnSettings)==null?"":__t)+'">\n		<span class="builder-cmd-hidden-label">'+((__t=btnSettings)==null?"":__t)+'</span>\n	</button>\n	<button class="builder-cmd builder-share" data-title="'+((__t=tooltipFirstSave)==null?"":__t)+'" data-placement="bottom" title="'+((__t=btnShare)==null?"":__t)+'">\n		<span class="builder-cmd-hidden-label">'+((__t=btnShare)==null?"":__t)+'</span>\n	</button>\n	<button class="builder-cmd builder-preview" data-title="'+((__t=tooltipNotShared)==null?"":__t)+'" data-placement="bottom" title="'+((__t=btnPreview)==null?"":__t)+'">\n		<span class="builder-cmd-hidden-label">'+((__t=btnPreview)==null?"":__t)+'</span>\n	</button>\n	<button class="builder-cmd builder-help" title="'+((__t=btnHelp)==null?"":__t)+'">\n		<span class="builder-cmd-hidden-label">'+((__t=btnHelp)==null?"":__t)+'</span>\n</div>\n<div class="status-bar">\n	<div class="status-bar-info">\n		<span class="status-msg"></span>\n		<span class="status-btns">\n			<button class="btn btn-warning check-story"></button>\n			<button type="button" class="btn btn-default builder-save disabled" tabindex="-1">'+((__t=btnSave)==null?"":__t)+'</button>\n		</span>\n	</div>\n</div>\n<div class="builder-mask"></div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/BuilderPanel",[],function(){}),define("lib-build/tpl!storymaps/common/builder/SaveErrorPopup",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\n	<div class="modal-content">\n		<div class="modal-logo"></div>\n		<div class="modal-header">\n			<h4 class="modal-title">'+((__t=title)==null?"":__t)+'</h4>\n		</div>\n\n		<div class="modal-body">\n			'+((__t=content)==null?"":__t)+'\n		</div>\n\n		<div class="modal-footer">\n			<button type="button" class="btn btn-primary" data-dismiss="modal">'+((__t=btnOk)==null?"":__t)+"</button>\n		</div>\n	</div>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/SaveErrorPopup",[],function(){}),define("storymaps/common/builder/SaveErrorPopup",["lib-build/tpl!./SaveErrorPopup","lib-build/css!./SaveErrorPopup","../utils/CommonHelper","dojo/Deferred","dojo/i18n!commonResources/nls/core.js?v="+app.version],function(e,t,n,r,i){return function(n){n.append(e({title:i.commonCore.saveError.title,content:i.commonCore.saveError.err1Div1+"<br /><br />"+i.commonCore.saveError.err1Div2,btnOk:i.commonCore.saveError.btnOk})),this.present=function(){var e=new r;return n.on("hide.bs.modal",function(){e.resolve()}),n.modal({keyboard:!0}),e}}}),define("lib-build/tpl!storymaps/common/builder/SaveErrorPopupSocial",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\n	<div class="modal-content">\n		<div class="modal-logo"></div>\n		<div class="modal-header">\n			<h4 class="modal-title">'+((__t=title)==null?"":__t)+'</h4>\n		</div>\n\n		<div class="modal-body">\n			<div class="panel1">\n				'+((__t=panel1)==null?"":__t)+'\n				<a href="#" class="help" data-toggle="tooltip">\n					<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -5px;"/>\n				</a>\n			</div>\n			<div class="panel2">\n				<div class="panel2lbl">'+((__t=panel2)==null?"":__t)+'</div>\n				<div class="form-group">\n					<div class="radio">\n						<label>\n							<input type="radio" name="optErrorSocial" value="story" checked>\n							<span>\n								'+((__t=panel2q1)==null?"":__t)+'\n								<a href="#" class="help" data-toggle="tooltip" title="'+((__t=panel2q1tooltip)==null?"":__t)+'">\n									<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -5px;"/>\n								</a>\n							</span>\n						</label>\n					</div>\n					<div class="radio">\n						<label>\n							<input type="radio" name="optErrorSocial" value="item">\n							<span>'+((__t=panel2q2)==null?"":__t)+'</span>\n						</label>\n					</div>\n				</div>\n			</div>\n			<div class="panel3">'+((__t=panel3)==null?"":__t)+'</div>\n		</div>\n\n		<div class="modal-footer">\n			<div class="stop-asking">\n				<div class="checkbox">\n					<label class="disabled">\n						<input type="checkbox" value="" disabled>\n						'+((__t=panel4)==null?"":__t)+'\n					</label>\n				</div>\n			</div>\n			<button type="button" class="btn btn-primary">'+((__t=btnSave)==null?"":__t)+"</button>\n		</div>\n	</div>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/SaveErrorPopupSocial",[],function(){}),define("storymaps/common/builder/SaveErrorPopupSocial",["lib-build/tpl!./SaveErrorPopupSocial","lib-build/css!./SaveErrorPopupSocial","../utils/CommonHelper","storymaps/tpl/core/WebApplicationData","dojo/Deferred","dojo/i18n!commonResources/nls/core.js?v="+app.version],function(e,t,n,r,i,s){return function(o){function a(){o.find("input[name='optErrorSocial']").change(function(){var e=o.find("input[name='optErrorSocial']:checked").val();e=="story"?(o.find(".stop-asking input").attr("disabled","disabled").prop("checked",!1),o.find(".stop-asking label").addClass("disabled")):(o.find(".stop-asking input").removeAttr("disabled"),o.find(".stop-asking label").removeClass("disabled"))}),o.find(".btn-primary").click(function(){o.find(".stop-asking input").is(":checked")&&r.setDoNotWarnTitle(!0),u.resolve({choice:o.find("input[name='optErrorSocial']:checked").val()}),o.modal("hide")})}var u=null;o.append(e({title:s.commonCore.saveErrorSocial.title,panel1:s.commonCore.saveErrorSocial.panel1,panel2:s.commonCore.saveErrorSocial.panel2,panel2q1:s.commonCore.saveErrorSocial.panel2q1,panel2q1tooltip:s.commonCore.saveErrorSocial.panel2q1tooltip,panel2q2:s.commonCore.saveErrorSocial.panel2q2,panel3:s.commonCore.saveErrorSocial.panel3.replace("${MYSTORIES}",'<a href="'+n.getMyStoriesURL()+'" target="_blank">'+s.commonCore.common.mystories+"</a>"),panel4:s.commonCore.saveErrorSocial.panel4,btnSave:s.commonCore.common.save})),a(),this.present=function(){return u=new i,o.find(".panel1 .help").tooltip({title:s.commonCore.saveErrorSocial.panel1tooltip+'<img src="resources/tpl/builder/icons/builder-help-social.png"/>',html:!0,placement:"right"}),o.find(".panel2 .help").tooltip(),o.modal({keyboard:!1}),u}}}),define("storymaps/common/builder/BuilderPanel",["lib-build/tpl!./BuilderPanel","lib-build/css!./BuilderPanel","dojo/i18n!commonResources/nls/core.js?v="+app.version,"storymaps/common/utils/CommonHelper","./SaveErrorPopup","./SaveErrorPopupSocial","dojo/topic"],function(e,t,n,r,i,s,o){return function(u,a,f,l){function v(){console.log("common.builder.Builder - save");if(u.find(".builder-save").hasClass("disabled")){app.appCfg.noAppTitleInitScreen&&!app.data.getWebAppData().getTitle()&&$("#headerDesktop").find(".title").addClass("titleEmpty");return}u.find(".builder-save").addClass("saving").html('<span class="small-loader"></span>'+n.commonCore.builderPanel.buttonSaving),T(!1);if(app.isDirectCreationFirstSave){var e=app.data.getWebAppData().getTitle(),t=app.data.getWebAppData().getSubtitle();if(!e){c.saveFailed("NONAME");return}app.portal.getPortalUser().getItems().then(function(r){var i=!1;r&&$.each(r,function(t,n){n.title&&n.title.toLowerCase()==e.toLowerCase()&&(i=!0)}),i?(u.find(".builder-save").removeClass("saving").html(n.commonCore.common.save),p.present().then(function(){app.appCfg.useStandardHeader?app.ui.headerDesktop.setTitleError():app.builder.openEditPopup({sectionIndex:0,displayTab:"main-stage"})})):f(e,t)})}else if(app.appCfg.useWebmapInApp&&app.isGalleryCreation)l();else{var r="",i="";app.data.getWebAppData().getTitle()&&(r=app.data.getWebAppData().getTitle().trim()),app.data.getWebAppItem()&&app.data.getWebAppItem().title&&(i=app.data.getWebAppItem().title.trim());if(!app.builder.titleMatchOnLoad&&!app.data.getWebAppData().getDoNotWarnTitle()&&app.data.getWebAppItem().access=="public"&&r!=i)app.builder.titleMatchDialogDisplayed?a(app.builder.titleFromItem):(app.builder.titleMatchDialogDisplayed=!0,d.present().then(function(e){app.builder.titleFromItem=e&&e.choice=="item",a(app.builder.titleFromItem)}));else{var s=app.data.getWebAppData().getDoNotWarnTitle()||app.data.getWebAppItem().access!="public"&&!app.builder.titleMatchOnLoad;a(s)}}}function m(){E(),h.openSettingPopup(!1)}function g(){E(),o.publish("OPEN_HELP")}function y(){$(this).hasClass("disabled")||window.open(r.getAppViewModeURL()+"&preview","_blank")}function b(){$(this).hasClass("disabled")||app.builder.openSharePopup(!1)}function w(){u.find(".save-counter").removeClass("pendingChanges").html(n.commonCore.builderPanel.noPendingChange),u.find(".builder-save").addClass("disabled")}function E(){u.find(".builder-save").tooltip("hide")}function S(){var e="#"+u.attr("id");u.find(".builder-save").tooltip("destroy"),u.find(".builder-save").tooltip({html:!0,trigger:"manual",placement:"left",title:'<script>$("'+e+' .builder-save").next(".tooltip").addClass("save-fail-popover");'+'$("'+e+' .builder-save").next(".tooltip").find(".stepHidden").css("display", "none");'+"</script>"+'<div class="stepHidden stepFailed" style="color: red; width: 180px;">'+n.commonCore.builderPanel.saveError+" "+'<button type="button" class="btn btn-xs" onclick="app.builder.hideSaveConfirmation()" style="vertical-align: 1px;">'+n.commonCore.common.close+"</button> "+"</div>"})}function x(){u.find(".builder-save").tooltip("hide")}function T(){c.updateSharingStatus(),c.resize()}function N(){u.find(".status-msg").show();var e=app.data.getWebAppItem().access;app.isDirectCreationFirstSave||app.isGalleryCreation?u.find(".status-msg").html(n.commonCore.builderPanel.status6):app.mystories&&app.mystories.hasCheckErrors?e=="public"?u.find(".status-msg").html(n.commonCore.builderPanel.status1):e=="account"||e=="org"?u.find(".status-msg").html(n.commonCore.builderPanel.status1):u.find(".status-msg").html(n.commonCore.builderPanel.status2):e=="public"?u.find(".status-msg").html(n.commonCore.builderPanel.status3):e=="account"||e=="org"?u.find(".status-msg").html(n.commonCore.builderPanel.status4):u.find(".status-msg").html(n.commonCore.builderPanel.status5),c.resize()}function C(){app.builder.openSharePopup()}function k(e){var t=u.find(".check-story");app.data.getStoryLength()?e=="start"?(t.html('<span class="small-loader"></span>'+n.commonCore.builderPanel.checking).show().css("cursor","default").off("click"),u.find(".status-msg").hide()):e=="error"?(t.html(n.commonCore.builderPanel.fix).show().css("cursor","pointer").click(C),c.updateSharingStatus()):(t.hide(),c.updateSharingStatus()):t.hide()}function L(){}u.append(e({title:n.commonCore.builderPanel.panelHeader.replace("%TPL_NAME%",app.cfg.TPL_NAME),btnSave:n.commonCore.common.save,btnShare:n.commonCore.builderPanel.buttonShare,btnSettings:n.commonCore.builderPanel.buttonSettings,btnHelp:n.commonCore.builderPanel.buttonHelp,btnPreview:n.commonCore.builderPanel.buttonPreview,tooltipFirstSave:n.commonCore.builderPanel.tooltipFirstSave,tooltipNotShared:n.commonCore.builderPanel.tooltipNotShared2,saveCounter:n.commonCore.builderPanel.noPendingChange}));var c=this,h=null,p=null,d=null;this.init=function(e){h=e,p=new i($("#saveErrorPopup")),d=new s($("#saveErrorPopupSocial")),L(),u.removeClass("hide"),app.builder.hideSaveConfirmation=x,u.find(".builder-save").click(v),u.find(".builder-share").click(b),u.find(".builder-settings").click(m),u.find(".builder-help").click(g),u.find(".builder-preview").click(y),$(window).bind("keydown",function(e){(e.ctrlKey||e.metaKey)&&String.fromCharCode(e.which).toLowerCase()=="s"&&!u.find(".builder-save").attr("disabled")&&!app.initScreenIsOpen&&(e.preventDefault(),v())}),S(),o.subscribe("MYSTORIES_SCAN",k),k("start")},this.saveSucceeded=function(){(app.isDirectCreationFirstSave||app.isGalleryCreation)&&app.builder.openSharePopup(!0),w(),T(!0),u.find(".builder-save").html('<span class="glyphicon glyphicon-ok"></span> '+n.commonCore.builderPanel.buttonSaved),setTimeout(function(){u.find(".builder-save").removeClass("saving").html(n.commonCore.common.save)},3500)},this.saveFailed=function(){u.find(".builder-save").removeClass("saving").html(n.commonCore.common.save),u.find(".builder-save").tooltip("show"),u.find(".builder-save").next(".tooltip").find(".stepFailed").css("display","block"),T(!0)},this.hasPendingChange=function(){return!u.find(".builder-save").hasClass("disabled")},this.incrementSaveCounter=function(){var e="";e=n.commonCore.builderPanel.unSavedChangePlural,u.find(".save-counter").addClass("pendingChanges").html(e),u.find(".builder-save").toggleClass("disabled",app.isDirectCreationFirstSave&&!app.data.getStoryLength()||!app.data.getWebAppData().getTitle()),app.isDirectCreationFirstSave&&app.data.getStoryLength()&&u.find(".status-bar").removeClass("hideCounterAndSharing")},this.updateSharingStatus=function(){var e=app.isDirectCreationFirstSave||app.isGalleryCreation||app.isWebMapCreation||app.isWebMapFirstSave,t=app.data.getWebAppItem().access=="private"||app.data.getWebAppItem().access=="shared";u.find(".builder-share").toggleClass("disabled",!!e),u.find(".builder-preview").tooltip("destroy").removeClass("disabled"),e?u.find(".builder-share").tooltip({trigger:"hover"}):u.find(".builder-share").tooltip("destroy"),e||app.isWebMapFirstSave?u.find(".builder-preview").addClass("disabled").tooltip({trigger:"hover",title:n.commonCore.builderPanel.tooltipFirstSave}):t?u.find(".builder-preview").tooltip({trigger:"hover",title:n.commonCore.builderPanel.tooltipNotShared2}):u.find(".builder-preview").tooltip("destroy"),app.ui.headerDesktop&&app.ui.headerDesktop.toggleSocialBtnAppSharing(t),app.ui.mobileHeader&&app.ui.mobileHeader.toggleSocialBtnAppSharing(t),N()},this.resize=function(){var e=u.find(".status-msg"),t=u.find(".status-btns button");u.removeClass("conflicting-text more-conflicting-text"),t.removeClass("btn-xs"),e.css("max-width","auto");var n=u.find(".buttons")[0],r=e[0];if(n&&r){n.getBoundingClientRect().right+10>=r.getBoundingClientRect().left&&u.addClass("conflicting-text"),n.getBoundingClientRect().right+10>=r.getBoundingClientRect().left&&u.addClass("more-conflicting-text");var i=n.getBoundingClientRect().right;i+10>=r.getBoundingClientRect().left&&(t.addClass("btn-xs"),e.css("max-width",parseInt(r.getBoundingClientRect().right-i,10)))}}}}),define("lib-build/tpl!storymaps/common/builder/settings/SettingsPopup",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\n	<div class="modal-content">\n		<div class="modal-logo"></div>\n		<div class="modal-header">\n			<h3 class="modal-title"></h3>\n		</div>\n		<ul class="settingsPopupHeader modal-tabs nav nav-tabs">\n			<!-- Tab injected here -->\n		</ul>\n		<div class="modal-body">\n			<!-- Views injected here -->\n		</div>\n		<div class="modal-footer">\n			<span class="error"></span>\n			<button class="btnSave btn btn-primary" data-dismiss="modal"></button>\n			<button class="btnClose btn btn-naked btn-close" data-dismiss="modal" aria-hidden="true"></button>\n		</div>\n	</div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/settings/SettingsPopup",[],function(){}),define("storymaps/common/builder/settings/SettingsPopup",["lib-build/tpl!./SettingsPopup","lib-build/css!./SettingsPopup","storymaps/common/utils/CommonHelper","dojo/topic"],function(e,t,n,r){var i=null;return function(s){function c(){if($(this).hasClass("disabled"))return;p($(this).index())}function h(){var e=[],t=-1;$.each(o,function(n,r){var i=r.save();i===!1&&(t=n),e.push(i)});if(t!=-1)return p(t),!1;r.publish("SETTINGS_POPUP_SAVE",{settings:e})}function p(e){u.removeClass("active disabled"),a.hide(),u.eq(e).addClass("active"),o[e].show(),a.eq(e).show(),i=e}s.append(e({}));var o=[],u=null,a=s.find(".tab-content"),f=s.find(".btnSave"),l=s.find(".btnClose");this.init=function(e){o=e.getSettingsTab(),s.find(".settingsPopupHeader").empty(),s.find(".modal-body").empty(),$.each(o,function(){s.find(".settingsPopupHeader").append('<li class="tab"><a></a></li>'),s.find(".modal-body").append('<div class="tab-content"></div>')}),u=s.find(".tab"),a=s.find(".tab-content"),$.each(o,function(e,t){t.init(u.eq(e).find("a"),a.eq(e)),t.initLocalization()}),u.click(c),f.click(h)},this.present=function(e,t){var r=0,a=!app.isProduction&&n.getUrlParams().debugParam?n.getUrlParams().debugParam:null;u.removeClass("disabled"),l.removeAttr("disabled"),$(".error-msg",s).hide(),$(".modal-header .close",s).attr("data-dismiss","modal"),$(".modal-footer .error",s).hide(),$.each(o,function(n,r){r.present(e[n],n==t)}),t?r=t:a?r=a:i&&(r=i),p(r),t&&(u.addClass("disabled"),u.eq(t).removeClass("disabled"),l.attr("disabled","disabled"),$(".modal-header .close",s).attr("data-dismiss","none")),s.modal({keyboard:!t})},this.initLocalization=function(){s.find(".modal-title").html(i18n.commonCore.settings.header),s.find(".btnClose").html(i18n.commonCore.common.cancel),s.find(".btnSave").html(i18n.commonCore.common.apply),s.find(".error").html(i18n.commonCore.settings.tabError)}}}),define("storymaps/common/builder/BuilderHelper",[],function(){return{getBlankAppJSON:function(){return{itemType:"text",guid:null,name:null,type:"Web Mapping Application",typeKeywords:app.cfg.WEBAPP_KEYWORD_GENERIC.concat(app.cfg.WEBAPP_KEYWORD_APP),description:null,tags:app.cfg.WEBAPP_TAG,snippet:null,thumbnail:"thumbnail/ago_downloaded.png",documentation:null,extent:[],lastModified:-1,spatialReference:null,accessInformation:null,licenseInfo:null,culture:"en-us",properties:null,size:116,appCategories:[],industries:[],languages:[],largeThumbnail:null,banner:null,screenshots:[],listed:!1,ownerFolder:null,commentsEnabled:!0,numComments:0,numRatings:0,avgRating:0,numViews:1}},getBlankWebmapJSON:function(){var e={latestWkid:3857,wkid:102100};return app.map&&app.map.spatialReference&&(e=app.map.spatialReference),{item:{id:"",guid:null,name:null,type:"Web Map",typeKeywords:app.cfg.WEBMAP_KEYWORD,description:null,tags:app.cfg.WEBMAP_TAG,snippet:null,thumbnail:"thumbnail/ago_downloaded.png",documentation:null,extent:[[-180,-90],[180,90]],spatialReference:null,accessInformation:null,licenseInfo:null,culture:"en-us",properties:null,url:null,size:233,appCategories:[],industries:[],languages:[],largeThumbnail:null,banner:null,screenshots:[],listed:!1,ownerFolder:null,commentsEnabled:!0,numComments:0,numRatings:0,avgRating:0,numViews:1},itemData:{operationalLayers:[],baseMap:{baseMapLayers:[{id:"defaultBasemap",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer"}],title:"Topographic"},spatialReference:e,version:"2.9"}}}}}),define("storymaps/common/utils/WebMapHelper",["esri/request","esri/renderers/jsonUtils","dojo/Deferred","dojo/_base/lang","dojo/_base/array"],function(e,t,n,r,i){return{findLayerTypeById:function(e,t){var n="";return i.forEach(e.operationalLayers,function(e){e.id==t&&(n=e.type)}),n},saveWebmap:function(e,t){var i=new n;this.prepareWebmapItemForCloning(e);var s=r.clone(e.item),o=r.clone(e.itemData);s.tags=s.tags?s.tags.join(","):"",s.typeKeywords=s.typeKeywords?s.typeKeywords.join(","):"";var u=t.getPortalUser(),a=this.getSharingURL(t)+"content/users/"+(app.appCfg.useWebmapOwnerAsSave?s.owner:u.credential.userId)+(s.ownerFolder?"/"+s.ownerFolder:"")+(s.id?"/items/"+s.id+"/update":"/addItem"),f={item:s.item,title:s.title,tags:s.tags,extent:JSON.stringify(s.extent),text:JSON.stringify(o),type:s.type,typeKeywords:s.typeKeywords,overwrite:!0,thumbnailURL:s.thumbnailURL};return this.request(a,f,!0).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i},serializeGraphicsLayerToFeatureCollection:function(e){return this._serializeGraphicsLayerToFeatureCollection(e,e.visible,e.graphics)},_serializeGraphicsLayerToFeatureCollection:function(e,t,n){var r={layers:[{featureSet:{features:[],geometryType:e.geometryType},id:e.id,layerDefinition:{geometryType:e.geometryType,objectIdField:e.objectIdField,name:e.name,type:e.type,typeIdField:e.typeIdField,drawingInfo:{renderer:{type:"simple",symbol:{type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/RedSphere.png",imageData:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII=",contentType:"image/png",width:15,height:15}}},fields:[],types:[],capabilities:e.capabilities},layerObject:null,opacity:e.opacity,visibility:t}],showLegend:!0};return $.each(e.fields,function(e,t){r.layers[0].layerDefinition.fields.push({name:t.name,alias:t.alias,type:t.type,editable:t.editable,domain:null})}),$.each(n,function(e,t){r.layers[0].featureSet.features.push({attributes:t.attributes,geometry:t.geometry})}),r},request:function(t,n,i,s){var o=i||!1;return n=n||{},s=s||"",e({url:t,content:r.mixin(n,{f:"json",token:s}),callbackParamName:"callback",handleAs:"json"},{usePost:o})},prepareWebmapItemForCloning:function(e){var n={latestWkid:3857,wkid:102100};app.map&&app.map.spatialReference&&(n=app.map.spatialReference),e.itemData.spatialReference||(e.itemData.spatialReference=n),e.itemData.authoringApp="StoryMapShortlist",e.itemData.authoringAppVersion=app.version,parseFloat(e.itemData.version)<2.9&&(e.itemData.version="2.9"),delete e.itemData._ssl,i.forEach(e.itemData.baseMap.baseMapLayers,function(e){delete e.errors,delete e.layerObject,delete e.resourceInfo,delete e.firstLayer,delete e.baseMapLayer}),i.forEach(e.itemData.operationalLayers,function(e){delete e.errors,delete e.layerObject,delete e.resourceInfo,e.id.indexOf("shortlist-layer")>=0&&!e.layerType&&(e.layerType="ArcGISFeatureLayer"),e.featureCollection&&e.featureCollection.layers&&i.forEach(e.featureCollection.layers,function(e){delete e.layerObject}),e.featureCollection&&e.featureCollection.featureSet&&e.featureCollection.featureSet.features&&i.forEach(e.featureCollection.featureSet.features,function(e){delete e._shape,delete e._graphicsLayer}),e.type=="CSV"&&e.featureCollection&&delete e.featureCollection,i.forEach(e.layers,function(e){delete e.drawingInfo,e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.renderer&&(e.layerDefinition.drawingInfo.renderer=t.fromJson(e.layerDefinition.drawingInfo.renderer).toJson())}),e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.renderer&&(e.layerDefinition.drawingInfo.renderer=t.fromJson(e.layerDefinition.drawingInfo.renderer).toJson())})},getSharingURL:function(e){var t=e.portalUrl;return t.match("/sharing/rest/$")?t=t.split("/").slice(0,-2).join("/")+"/":t.match("/sharing/rest$")?t=t.split("/").slice(0,-1).join("/")+"/":t.match("/sharing$")&&(t+="/"),t}}}),define("storymaps/common/builder/media/image/ImageUploadHelper",["dojo/Deferred","dojo/_base/lang"],function(e,t){return{photoSettings:{maxFileSize:1e7,widths:[1500],thumbHeight:150,logoWidth:250,logoName:"sm_series_logo",quality:.8},loadImageFromFile:function(t,n){var r=new e;return t.type.indexOf("gif")>=0?this.handleGifFile(t,n).then(r.resolve,r.reject):this.handleImageFile(t,n).then(r.resolve,r.reject),r},processLogo:function(n){var r=new e,i=this.getExt(n.name,n.type);return this.createNewImage(n).then(t.hitch(this,function(e){if(n.type.indexOf("gif")>=0){if(!this.validateDimensions(e,{width:this.photoSettings.logoWidth})){r.reject({reason:"gif dimensions",details:this.photoSettings.logoWidth});return}}else{var t=this.createCanvasAndDataUrl(e,n.type,{width:this.photoSettings.logoWidth});n=t.file}if(!this.validateFileSize(n)){r.reject({reason:"filesize"});return}r.resolve({type:"image",height:e.height,width:e.width,file:n,logoName:this.photoSettings.logoName,name:this.photoSettings.logoName+"__"+(new Date).getTime()+"."+i})})),r},getExt:function(e,t){var n=e.lastIndexOf(".");return n>=0?e.substr(n+1).toLowerCase():t.substr(t.indexOf("/")+1)},handleGifFile:function(n){var r=new e;return this.validateFileSize(n)?(this.createNewImage(n).then(t.hitch(this,function(e){if(!this.validateDimensions(e,{width:this.photoSettings.widths[0]})){r.reject({reason:"gif dimensions"});return}r.resolve({type:"image",file:n,width:e.width,height:e.height,dataUrl:null})}),r.reject),r):(console.warn("gif file size too big!"),r.reject({reason:"filesize"}),r)},handleImageFile:function(n,r){var i=new e;return this.createNewImage(n).then(t.hitch(this,function(e){var t=[],s,o=_.sortBy(this.photoSettings.widths).reverse();_.each(o,function(r){var o=this.createCanvasAndDataUrl(e,n.type,{width:r});if(!this.validateFileSize(o.file)){i.reject({reason:"compressed filesize"});return}(!t.length||t[t.length-1].width!==o.width)&&t.push(_.omit(o,"dataUrl")),s=s||o.dataUrl},this);var u;app.appCfg.imageUploadThumbWidth?u=this.createCanvasAndDataUrl(e,n.type,{width:app.appCfg.imageUploadThumbWidth}):u=this.createCanvasAndDataUrl(e,n.type,{height:this.photoSettings.thumbHeight});var a=r?s:u.dataUrl;i.resolve({type:"image",files:t,width:t[0].width,height:t[0].height,dataUrl:a,thumb:u.file})}),i.reject),i},createCanvasAndDataUrl:function(e,t,n){var r=this.createNewCanvas(e,n),i=r.toDataURL(t,this.photoSettings.quality),s=this.dataURItoBlob(i);return{width:r.width,height:r.height,dataUrl:i,file:s}},validateFileSize:function(e){return e.size<=this.photoSettings.maxFileSize},validateDimensions:function(e,t){return t.width?e.width<=t.width:t.height?e.height<=t.height:(console.warn("trying to validateDimensions without dimensionOptions",t),!1)},createNewImage:function(t){var n=new e,r=new Image,i=window.URL||window.webkitURL;if(!i){n.reject({reason:"no window.URL"});return}return r.src=i.createObjectURL(t),r.onload=function(){this.onload=null,i.revokeObjectURL(t),n.resolve(this)},n},createNewCanvas:function(e,t){var n=this.getPhotoSize(e,t),r=document.createElement("canvas");return r.width=n.width,r.height=n.height,r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),r},getPhotoSize:function(e,t){var n=e.height,r=e.width;if(!this.validateDimensions(e,t)){var i=r/n;t.width?(r=t.width,n=r/i):t.height?(n=t.height,r=i*n):console.warn("sizeOptions dont include width or height",t)}return{height:Math.round(n),width:Math.round(r)}},dataURItoBlob:function(e){var t;e.split(",")[0].indexOf("base64")>=0?t=atob(e.split(",")[1]):t=unescape(e.split(",")[1]);var n=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(t.length);for(var i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return new Blob([r],{type:n})}}}),define("storymaps/common/builder/media/image/FileUploadHelper",["dojo/Deferred","dojo/promise/all","dojo/_base/lang","esri/request","./ImageUploadHelper"],function(e,t,n,r,i){return{uploadTypesAccepted:{image:["png","jpeg","jpg","gif","bmp"]},ignoreNames:[i.photoSettings.logoName],checkDnD:function(){return!navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i)&&"draggable"in document.createElement("span")&&typeof window.FileReader!="undefined"},disableWindowDnD:function(){if(window.dndDisabled)return;window.dndDisabled=!0,window.addEventListener("dragover",this.preventEvent),window.addEventListener("drop",this.preventEvent)},preventEvent:function(e){e&&e.preventDefault()},preventAndStopEvent:function(e){e&&(e.preventDefault(),e.stopPropagation())},findFilesFromDrop:function(e){return e=e.originalEvent||e,e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length?e.dataTransfer.files:!1},validateTypeOnDrag:function(e){var t=0,n=!0;while(t<e.length&&n){var r=this.getSimplifiedType(e[t].type);n=_.has(this.uploadTypesAccepted,r),t++}return n},validateFile:function(e){var t=this.getExt(e.name,e.type),n=this.getSimplifiedType(e.type),r=_.flatten(_.map(this.uploadTypesAccepted,function(e){return e}));return r.some(function(r){return r===t||r===e.type||r===n})},getSimplifiedType:function(e){return e.substring(0,e.indexOf("/"))},getExt:function(e,t){var n=e.lastIndexOf(".");return n>=0?e.substr(n+1).toLowerCase():t.substr(t.indexOf("/")+1)},getNameWithoutExtension:function(e){var t=e.lastIndexOf(".");return t>=0?e.substr(0,t):e},getStrippedName:function(e){return e=this.getNameWithoutExtension(e),e.replace("__thumb","").replace(/__[0-9]{13}/,"").replace(/__w[0-9]+/,"")},getResourceWidth:function(e){var t=e.match(/__w[0-9]+/);return t?parseInt(t[0].slice(3),10):null},getDateNum:function(e){var t=e.match(/__[0-9]{13}/);return t?parseInt(t[0].slice(2),10):""},getFileIdFromUrl:function(e){var t=this.getResourcesUrl().replace(/http[s]?\:\/\//,"").replace(/^\/\//,"").replace("//","/"),n=e.replace(/http[s]?\:\/\//,"").replace(/^\/\//,"").replace("//","/");if(n.indexOf(t)<0)return"";var r=decodeURIComponent(n.substr(n.lastIndexOf("/")+1));return this.getStrippedName(r)+"_"+this.getDateNum(r)},getUploadBaseName:function(e,t){var n=this.getNameWithoutExtension(e.name).replace(/[<>"'()*%!?&]/g,""),r=this.getExt(e.name,e.type),i=n+"__"+((new Date).getTime()+(t||0));return i+"."+r},processFile:function(e,t){var n=this.getSimplifiedType(e.type);switch(n){case"image":return i.loadImageFromFile(e,t);case"audio":case"video":console.warn("unhandled file type",n);return;default:console.warn("unknown file type",e);return}},uploadSingleResource:function(t){var i=new e,s=this.getUploadUrl();if(!s)return i.reject(),i;var o=t.baseName||t.name,u=this.getNameWithoutExtension(o),a=this.getExt(o);t.thumb&&(t.thumbName=u+"__thumb"+"."+a),_.each(t.files,function(e){e.name=u+"__w"+e.width+"."+a});var f=this.getFormDataFromFileDetails(t);return r({url:s,handleAs:"json",form:f},{usePost:!0}).then(n.hitch(this,function(e){if(e.success){var n=this.getResourcesUrl();if(!n){i.reject("No resourcesUrl");return}t.files?e.sizes=_.map(t.files,function(e){return this.getSizesObj(e.name)},this):t.file&&(e.picUrl=this.getSizesObj(o).url,e.name=o),t.baseName&&(e.displayName=this.getStrippedName(t.baseName)+"."+a),t.thumb&&(e.thumbUrl=n+"/"+encodeURIComponent(t.thumbName)),i.resolve(e)}})),i},getSizesObj:function(e){return{name:e,url:this.getResourcesUrl()+"/"+encodeURIComponent(e),width:this.getResourceWidth(e)}},getAppItem:function(){return app.data&&app.data.getWebAppItem&&app.data.getWebAppItem()},getUploadUrl:function(){var e=this.getOwnerItemUrl();return e?e+"/addResources":!1},getRemoveUrl:function(){var e=this.getOwnerItemUrl();return e?e+"/removeResources":!1},getOwnerItemUrl:function(){var e=this.getAppItem(),t=this.getSharingUrl();if(!e||!t)return!1;var n=t+"/content/users/"+e.owner,r=e.ownerFolder;return n+(r?"/"+r:"")+"/items/"+e.id},getSharingUrl:function(){var e=app.portal;return e?"https://"+e.portalHostname.replace(/\/$/,"")+"/sharing/rest":!1},getResourcesUrl:function(){var e=this.getAppItem(),t=this.getSharingUrl();return!e||!t?!1:t+"/content/items/"+e.id+"/resources"},getPlainResources:function(){var t=new e,n=this.getResourcesUrl();return n?r({url:n,handleAs:"json",content:{num:1e3,f:"json"}}):(t.reject(),t)},getStoryResources:function(){var t=new e;return this.getPlainResources().then(n.hitch(this,this.handleResourceReturn,t),n.hitch(this,this.handleQueryError)),t},handleResourceReturn:function(e,t){var n=this.formatResults(t.resources);e.resolve(n)},removeResources:function(n){var r=new e,i=this.getRemoveUrl();if(!i)return r.reject(),r;var s=[];return n.file&&s.push(this.removeResource(n.file)),n.thumbFile&&s.push(this.removeResource(n.thumbFile)),n.sizes&&_.map(n.sizes,function(e){s.push(this.removeResource(e.name))},this),t(s).then(function(e){var t=_.every(e,function(e){return e.success});t?r.resolve():r.reject()}),r},removeResource:function(e){return r({url:this.getRemoveUrl(),handleAs:"json",content:{resource:e,f:"json"}},{usePost:!0})},cleanupLogos:function(e){e=e||"";var t=e.slice(e.lastIndexOf("/")+1);this.removeResourcesWithPrefix(i.photoSettings.logoName,t)},removeResourcesWithPrefix:function(r,i){var s=new e,o=this.getAppItem();return!o||!o.id?(s.resolve(),s):(i=i||"",this.getPlainResources().then(n.hitch(this,function(e){var n=[];_.each(e.resources,function(e){var t=e.resource;t.match("^"+r)&&t!==i&&n.push(this.removeResource(e.resource))},this),n.length&&t(n).then(s.resolve,s.reject),s.resolve()}),s.reject),s)},formatResults:function(e){var t=this.getResourcesUrl(),r=this,i={};return e.forEach(n.hitch(this,function(e){var n=e.resource,s=_.some(this.ignoreNames,function(e){return n.indexOf(e)===0});if(s)return;_.contains(this.ignoreNames,n);var o=r.getExt(n);if(!r.getResourceType(o))return;var u=r.getStrippedName(n),a=r.getDateNum(n),f=u+"_"+a;i[f]||(i[f]={fileId:f,sizes:[],displayName:decodeURIComponent(u)+"."+o,modified:a?new Date(a):"",thumbFile:"",resourcesUrl:t}),n.match("__thumb")?i[f].thumbFile=n:i[f].sizes.push({name:n,url:t+"/"+encodeURIComponent(n),width:r.getResourceWidth(n)||0})})),_.each(i,function(e,t){e.sizes.length||delete i[t]}),_.toArray(i)},getResourceType:function(e){if(!e)return!1;e=e.toLowerCase();var t;return _.some(this.uploadTypesAccepted,function(n,r){if(_.contains(n,e))return t=r,!0}),t||!1},handleQueryError:function(e,t){e.reject(t)},getFormDataFromFileDetails:function(e){var t=new FormData;return t.append("f","json"),this.addFilesToFormData(t,e),t},addFilesToFormData:function(e,t){t.files?_.each(t.files,function(t,n){e.append("file"+n,t.file,t.name)}):e.append("file",t.file,t.baseName||t.name),t.thumb&&e.append("thumb",t.thumb,t.thumbName)}}}),define("storymaps/common/builder/Builder",["lib-build/css!./Builder","lib-build/css!lib-app/font-awesome/css/font-awesome.min","esri/arcgis/Portal","./BuilderPanel","./settings/SettingsPopup","./BuilderHelper","./MyStoriesWrapper","../utils/CommonHelper","../utils/WebMapHelper","./media/image/FileUploadHelper","dojo/_base/lang","dojo/_base/array","dojo/_base/Color","dojo/has","esri/arcgis/utils","esri/IdentityManager","esri/request","dojo/topic","lib-app/history.min"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){function S(e,t){y=e,b=t,E=new i($("#settingsPopup")),console.log("common.builder.Builder - init");if(!u.getAppID(y.isProd())&&!app.isDirectCreation){console.error("common.builder.Builder - abort builder initialization, no appid supplied");return}app.isDirectCreation?console.log("common.builder.Builder - Builder start in direct creation mode"):app.isGalleryCreation&&console.log("common.builder.Builder - Builder start in gallery creation mode"),$("body").addClass("builder-mode"),b.init(E),w.init(b),E.init(b),E.initLocalization(),g.subscribe("BUILDER_INCREMENT_COUNTER",w.incrementSaveCounter),g.subscribe("HEADER_EDITED",F),g.subscribe("BUILDER-MY-STORIES-CHECK",o.scanStory),window.onbeforeunload=function(e){e=e||window.event;if(!w.hasPendingChange())return;return e&&(e.returnValue=i18n.commonCore.builderPanel.closeWithPendingChange),i18n.commonCore.builderPanel.closeWithPendingChange},app.builder.cleanApp=Z}function x(){var e="",t="";app.data.getWebAppData().getTitle()&&(e=app.data.getWebAppData().getTitle().trim()),app.data.getWebAppItem()&&app.data.getWebAppItem().title&&(t=app.data.getWebAppItem().title.trim()),app.builder.titleMatchOnLoad=t==e,app.data.getWebAppData().isBlank()&&(app.builder.titleMatchOnLoad=!0),app.data.getWebAppData().getAppGeocoders&&C();var n;(n=app.portal)&&(n=n.portalProperties)&&(n=n.sharedTheme)&&(T(n)&&!app.appCfg.noAppThemes&&L(n),N(n)&&M(n)),app.appCfg.noAppThemes||D();var r;if(!app.appCfg.noAppThemes&&(r=app.data.getWebAppData().getTheme())&&(r=r.colors)&&r.name&&r.name.match(/-org$|-modified$/)){var i="#418abb",s="#67AAE5",o="#404040",a="#939393";$("body").addClass("builder-shadows");var f=u.colorsAreSimilar(r.media,s)||u.colorsAreSimilar(r.media,i);$("body").toggleClass("media-blues",f);var l=u.colorsAreSimilar(r.media,o);$("body").toggleClass("media-dark",l);var c=u.colorsAreSimilar(r.media,a);$("body").toggleClass("media-gray",c);var h=u.colorsAreSimilar(r.panel,i);$("body").toggleClass("panel-blues",h)}w.updateSharingStatus(),b.appInitComplete()}function T(e){var t=!1;return e.header&&(t=A(e.header.text)||A(e.header.background)),!t&&e.body&&(t=A(e.body.text)||A(e.body.background)||A(e.body.link)),!t&&e.button&&(t=A(e.button.text)||A(e.button.background)),t}function N(e){return e.logo&&e.logo.small}function C(){app.data.getWebAppData().getAppGeocoders()||k()}function k(){if(app.portal.helperServices.geocode&&app.portal.helperServices.geocode.length){var e=[],t=[];$.each(app.portal.helperServices.geocode,function(n,r){if(r.url){if(window.location.protocol=="https:"&&r.url.indexOf("https")<0)return;e.push($.getJSON(r.url+"?f=json")),t.push(r)}}),$.when.apply($,e).done(function(){var n=e.length>1?arguments:[arguments],r=[];$.each(n,function(e,n){var i=n[0],s=n[1];if(!i||i.error||!i.singleLineAddressField||!s||s!=="success")return;var o=t[e];r.push({singleLineFieldName:i.singleLineAddressField.name,name:i.name||o.name,placeholder:o.placeholder,url:o.url})}),app.data.getWebAppData().setAppGeocoders(r);if(app.data.getWebAppItem().id){if(app.isGalleryCreation&&app.appCfg.disableGalleryCreationSaveGeocoders)return;U(!1,function(){})}})}}function L(e){var t=app.data.getWebAppData(),n={header:{text:A(e.header.text)||"#fff",background:A(e.header.background)||"#333"},body:{text:A(e.body.text)||"#333",background:A(e.body.background)||"#fff",link:A(e.body.link||e.body.text)||"#666"},button:{text:A(e.button.text)||"#ccc",background:A(e.button.background)||"#999"}},r=n.body.link||n.body.text,i={group:"org",themeMajor:P(n.header.background),header:n.header.background,headerText:n.header.text,headerTitle:n.header.text,panel:n.body.background,text:n.body.text,textLink:r,media:H(n),mapControls:n.body.background,softText:n.body.text,softBtn:n.body.text,esriLogo:P(n.header.background),esriLogoMobile:"black"},s=app.isInitializing&&!t.getTheme().colors;app.cfg.LAYOUTS.forEach(function(e){var o=e.themes.some(function(e){return e.name.match(/-org$/)?!0:!1});if(!o){var u={name:e.id+"-org"};e.id==="tab"||e.id==="bullet"?l.mixin(u,{tabActive:n.button.background,tabTextActive:n.button.text,tab:O(n.button.background,.75),tabText:O(n.button.text,.6),tabHover:O(n.button.background,.9),tabTextHover:O(n.button.text,.8)}):e.id==="accordion"&&l.mixin(u,{accordionNumber:r,accordionTitle:r,accordionArrowActive:r,accordionArrow:O(r,.6),accordionArrowHover:O(r,.8)}),e.themes.push(l.mixin(u,i))}s&&e.id===t.getLayout().id&&(t.setTheme({colors:e.themes[e.themes.length-1]}),g.publish("CORE_UPDATE_UI"))});if(s&&!t.getLayout().id){var o=app.cfg.LAYOUTS[0];t.setTheme({colors:o[o.length-1]})}}function A(e){return!e||e==="no-color"?!1:e}function O(e,t){var n=new h(e);return n.a=t,n.toString()}function M(e){app.cfg.HEADER_ORG_LOGO_URL=e.logo.small;if(app.isInitializing&&!app.data.getWebAppData().getHeader().logoURL){var t=y.getHeaderUserCfg(),n=e.logo.link?e.logo.link.trim():"";l.mixin(t,{logoURL:e.logo.small,logoTarget:n}),app.data.getWebAppData().setHeader(t),g.publish("CORE_UPDATE_UI")}}function D(){var e=app.data.getWebAppData().getTheme(),t=e.colors;if(!t||!t.name)return;var n=t.name.split("-"),r=n[0],i=["header","headerText","headerTitle","panel","text","textLink","media","mapControls","softText","softBtn"],s=["tab","tabActive","tabHover","tabText","tabTextHover","tabTextActive"],o=["accordionArrow, accordionArrowHover","accordionArrowActive","accordionNumber","accordionTitle"],u=app.cfg.LAYOUTS.some(function(e){if(r!==e.id)return!1;var n;return e.id==="tab"||e.id==="bullet"?n=i.concat(s):e.id==="accordion"&&(n=i.concat(o)),e.themes.some(function(e){return n.every(function(n){return t[n]===e[n]})})});if(u)return;app.cfg.LAYOUTS.forEach(function(e){var i={name:e.id+"-"+n.slice(1).join("-"),group:"modified"};i.name.match(/-modified$/)||(i.name+="-modified");if(r===e.id){l.mixin(t,i),app.data.getWebAppData().setTheme({colors:t}),g.publish("CORE_UPDATE_UI"),e.themes.push(t);return}var s;if(e.id==="tab"||e.id==="bullet"){for(s in t)t.hasOwnProperty(s)&&o.indexOf(s)<0&&s!=="name"&&s!=="group"&&(i[s]=t[s]);var u="#333",a="#eee";t=l.mixin({tabActive:u,tabTextActive:a,tab:O(u,.75),tabText:O(a,.6),tabHover:O(u,.9),tabTextHover:O(a,.8),group:"modified"},i)}else if(e.id==="accordion"){for(s in t)t.hasOwnProperty(s)&&o.indexOf(s)<0&&s!=="name"&&(i[s]=t[s]);t=l.mixin({accordionNumber:t.textLink,accordionTitle:t.textLink,accordionArrowActive:t.textLink,accordionArrow:O(t.textLink,.6),accordionArrowHover:O(t.textLink,.8),group:"modified"},i)}e.themes.push(t)})}function P(e){var t=B(e);return t>=128?"black":"white"}function H(){return"#eee"}function B(e){var t=new h(e),n=t.toRgb();return(n[0]*299+n[1]*587+n[2]*114)/1e3}function j(e){w.resize(),b.resize(e)}function F(e){if(!e.src)return;e.src=="title"?(e.value==i18n.commonCore.inlineFieldEdit.enterTitle&&(e.value=""),!app.data.getWebMap()||e.value!=app.data.getWebMap().item.title?e.value!=app.data.getWebAppData().getTitle()&&(app.data.getWebAppData().setTitle(e.value),w.incrementSaveCounter()):app.data.getWebAppData().setTitle("")):e.src=="subtitle"&&(e.value==i18n.commonCore.inlineFieldEdit.enterSubtitle&&(e.value=""),!app.data.getWebMap()||e.value!=app.data.getWebMap().item.snippet?e.value!=app.data.getWebAppData().getSubtitle()&&(app.data.getWebAppData().setSubtitle(e.value),w.incrementSaveCounter()):app.data.getWebAppData().setSubtitle(""))}function I(e){if(!app.portal){console.error("Fatal error - not signed in"),G("APP");return}app.portal.signIn().then(function(){U(e,function(e){if(!e||!e.success){G("APP");return}!app.data.getWebAppData().getIsExternalData||!app.data.getWebAppData().getIsExternalData()?X(function(e){if(!e||!e.success){G("WEBMAP");return}Q({success:!0})}):app.data.getWebAppData().getIsExternalData()&&Q({success:!0})})},function(e){G("APP",e)})}function q(e,t){if(!app.portal){console.error("Fatal error - not signed in"),G("APP");return}var n=v.findCredential(Y()).userId;app.data.setWebAppItem(l.mixin(s.getBlankAppJSON(),{title:e,snippet:t,uploaded:Date.now(),modified:Date.now(),owner:n,access:"private"}));var r=function(e){if(!e||!e.success){G("APP");return}var t=document.location.protocol+"//"+document.location.host+document.location.pathname;t.match(/index\.html$/)||(t+="index.html"),app.data.setWebAppItem(l.mixin(app.data.getWebAppItem(),{id:e.id,item:e.item,url:t+"?appid="+e.id})),app.isDirectCreationOpenData&&(app.data.getWebAppItem().tags.push("open-data-favorite"),app.data.getWebAppItem().properties={content:"story map",datasetType:"story map",url:t+"?appid="+e.id});var n=function(){U(!1,function(e){if(!e||!e.success){G("APP");return}console.log("common.builder.Builder - firstSaveForDirectCreation - appid:",e.id," webmap:",null),Q({success:!0}),app.isDirectCreationFirstSave=!1,w.updateSharingStatus(),g.publish("DIRECT_CREATION_SAVE"),History.replaceState({},"","index.html?appid="+e.id+"&edit")})};if(app.isDirectCreationOpenData){var r=app.portal.getPortalUser().favGroupId,i=Y()+"/sharing/rest/content/items/"+e.id+"/share";m({url:i,handleAs:"json",content:{everyone:!1,org:!1,groups:r,items:e.id}},{usePost:!0}).then(n,n)}else n()};app.portal.signIn().then(function(){if(app.appCfg.webmapStory){var i=app.data.getWebMap();l.mixin(i.item,{title:e,snippet:t,uploaded:Date.now(),modified:Date.now(),owner:n,access:"private"}),X(function(e){if(!e||!e.success){G("WEBMAP");return}app.data.getWebAppData().setWebmap(e.id);var t=app.data.getWebMap();l.mixin(t.item,{id:e.id,item:e.item}),K(),U(!1,r)})}else U(!1,r)},function(e){G("APP",e)})}function R(){if(!app.portal){console.error("Fatal error - not signed in"),G("APP");return}var e=v.findCredential(Y()).userId,t=app.data.getWebMap();l.mixin(t.item,{title:app.data.getWebMap().item.title?app.data.getWebMap().item.title:app.data.getWebAppItem().title,uploaded:Date.now(),modified:Date.now(),owner:e}),app.data.getWebAppItem().ownerFolder&&(t.item.ownerFolder=app.data.getWebAppItem().ownerFolder),app.portal.signIn().then(function(){X(function(e){if(!e||!e.success||!e.id){G("WEBMAP");return}app.data.getWebAppData().setWebmap(e.id);var t=app.data.getWebMap();l.mixin(t.item,{id:e.id,item:e.item}),K(),U(!1,function(t){if(!t||!t.success){G("APP");return}var n=function(){console.log("common.builder.Builder - builderGalleryCreationFirstSave - appid:",t.id," webmap:",e.id),Q({success:!0}),app.isGalleryCreation=!1,w.updateSharingStatus(),History.replaceState({},"","index.html?appid="+t.id+"&edit")},r=app.data.getWebAppItem().access;if(r!="private"){var i=[app.data.getWebMap().item.id];J(i.join(","),r).then(function(e){var t=e&&e.results&&e.results.length==i.length;t?($.each(e.results,function(e,n){n.success||(t=!1)}),t?n():G("WEBMAP")):G("WEBMAP")})}else n()})})},function(e){G("APP",e)})}function U(e,t){var n=Y(),r=l.clone(app.data.getWebAppItem()),i=r.owner||v.findCredential(n).userId,s=v.findCredential(n).token;delete r.avgRating,delete r.modified,delete r.numComments,delete r.numRatings,delete r.numViews,delete r.size,r.typeKeywords||(r.typeKeywords=[]),r.typeKeywords=r.typeKeywords.concat(app.cfg.WEBAPP_KEYWORD_APP),r.typeKeywords=r.typeKeywords.concat(app.cfg.WEBAPP_KEYWORD_GENERIC);var o=$.map(app.cfg.LAYOUTS,function(e){return"layout-"+e.id});r.typeKeywords=$.grep(r.typeKeywords,function(e){return $.inArray(e,o)==-1}),r.typeKeywords.push("layout-"+app.data.getWebAppData().getLayoutId()),r.typeKeywords=$.grep(r.typeKeywords,function(e,t){return t==$.inArray(e,r.typeKeywords)}),r.tags=r.tags?r.tags.join(","):"",r.typeKeywords=r.typeKeywords.join(","),r.serviceProxyParams=JSON.stringify(r.serviceProxyParams),e||(r.title=app.data.getWebAppData().getTitle()),r.properties&&(r.properties=JSON.stringify(r.properties)),r.url&&r.url.match(/apps\/[a-zA-Z]+\/\?appid=/)&&(r.url=r.url.replace("/?appid=","/index.html?appid=")),r=l.mixin(r,{f:"json",token:s,overwrite:!0,text:z()});var u=n+"/sharing/rest/content/users/"+i+(r.ownerFolder?"/"+r.ownerFolder:"");r.id?u+="/items/"+r.id+"/update":u+="/addItem";var a=m({url:u,handleAs:"json",content:r},{usePost:!0});a.then(t,G)}function z(){var e=app.data.getWebAppData().get(),t=e&&e.values&&e.values.settings&&e.values.settings.header&&e.values.settings.header.logoURL;t&&(t=W(t,t),e.values.settings.header.logoURL=t);var n=u.isAppResource(t)?t:$("#uploadLogoInput").val();n&&(n=u.possiblyRemoveToken(n)),f.cleanupLogos(n);var r=$(".settings-simulator .imgLogo"),i=r.attr("src");i&&i.indexOf(t)<0&&r.attr("src",t);var s=e&&e.values&&e.values.story&&e.values.story.entries;return s&&_.each(s,function(e){var t=$(e.description);_.each(t.find("img"),function(t){e.description=W(e.description,t.src)})}),JSON.stringify(e)}function W(e,t){var n=u.possiblyRemoveToken(t);if(t!==n){var r=n.replace(/^https?\:\/\//,"//"),i=t.replace(/^https?\:\/\//,"//").split("?");return e.match(i[0]+"\\?"+i[1])?e.replace(i[0]+"?"+i[1],r):e.replace(decodeURI(i[0])+"?"+i[1],r)}return e}function X(e){app.isDirectCreationFirstSave||app.appCfg.useWebmapInApp&&app.isGalleryCreation||app.appCfg.webmapStory?(b.preWebmapSave&&b.preWebmapSave(),a.saveWebmap(app.data.getWebMap(),app.portal).then(function(t){if(app.maps[app.data.getWebAppData().getWebmap()]&&app.data.getWebAppItem()&&app.maps[app.data.getWebAppData().getWebmap()].response.itemInfo.item.owner!=app.data.getWebAppItem().owner){var n=app.data.getWebMap();l.mixin(n.item,{id:t.id,item:t.item}),app.data.getWebAppData().setWebmap(t.id);var r=Y(),i=l.clone(app.data.getWebAppItem()),s=i.owner||v.findCredential(r).userId,o=v.findCredential(r).token;i=l.mixin(i,{f:"json",token:o,overwrite:!0,text:JSON.stringify(app.data.getWebAppData().get())});var u=r+"/sharing/rest/content/users/"+s+(i.ownerFolder?"/"+i.ownerFolder:"");u+="/items/"+i.id+"/update";var a=m({url:u,handleAs:"json",content:i},{usePost:!0});a.then(e,G)}e(t)},G)):e({success:!0})}function V(e,t){e!="public"&&e!="account"&&e!="org"&&(e="public");var n=[];e=="account"||e=="org"?(app.data.getWebMap()&&app.data.getWebMap().item.access=="private"&&app.data.getWebMap().item.owner==app.portal.getPortalUser().username&&n.push(app.data.getWebMap().item.id),app.data.getWebAppItem().access=="private"&&n.push(app.data.getWebAppItem().id)):(app.data.getWebMap()&&app.data.getWebMap().item.access!="public"&&app.data.getWebMap().item.owner==app.portal.getPortalUser().username&&n.push(app.data.getWebMap().item.id),app.data.getWebAppItem().access!="public"&&n.push(app.data.getWebAppItem().id)),J(n.join(","),e).then(function(r){var i=r&&r.results&&r.results.length==n.length;i&&($.each(r.results,function(e,t){t.success||(i=!1)}),app.data.getWebMap()&&(app.data.getWebMap().item.access=e),app.data.getWebAppItem().access=e,w.updateSharingStatus()),t(i)})}function J(e,t){var n=Y(),r=v.findCredential(n).userId,i=v.findCredential(n).token,s={f:"json",token:i,items:e,groups:"",everyone:"",org:""};t=="public"&&(s.everyone=!0);if(t=="account"||t=="org")s.org=!0;return m({url:n+"/sharing/rest/content/users/"+r+"/shareItems",handleAs:"json",content:s},{usePost:!0})}function K(){var e=Y(),t=v.findCredential(e).userId,n=v.findCredential(e).token,r=app.data.getWebMap().item.id,i={f:"json",token:n,groups:"",everyone:"",org:""};return m({url:e+"/sharing/rest/content/users/"+t+"/items/"+r+"/protect",handleAs:"json",content:i},{usePost:!0})}function Q(e){e&&e.success?(app.mystories=app.mystories||{},app.mystories.isChecking=!0,app.isWebMapCreation=!1,w.saveSucceeded(),app.data.updateAfterSave(),app.isGalleryCreation||app.isDirectCreationFirstSave||app.isWebMapFirstSave?(app.isDirectCreationFirstSave=!1,app.isGalleryCreation=!1,app.isWebMapFirstSave=!1,setTimeout(window.myStoriesInit,200)):o.scanStory(),w.updateSharingStatus()):G()}function G(e,t){w.saveFailed(e,t)}function Y(){return d.arcgisUrl.split("/sharing/")[0]}function Z(){if(!app.portal){console.error("Fatal error - not signed in");return}return app.portal.signIn().then(function(){var e=Y(),t=v.findCredential(e).userId,n=v.findCredential(e).token,r=l.clone(app.data.getWebAppItem());delete r.avgRating,delete r.modified,delete r.numComments,delete r.numRatings,delete r.numViews,delete r.size,r=l.mixin(r,{f:"json",token:n,overwrite:!0,text:JSON.stringify(app.data.getWebAppData().getBlank())});var i=m({url:e+"/sharing/rest/content/users/"+t+(r.ownerFolder?"/"+r.ownerFolder:"")+"/addItem",handleAs:"json",content:r},{usePost:!0});i.then(function(){console.log("Web Application data cleaned successfully")},function(){console.log("Web Application data cleaning has failed")})},function(e){console.error("Web Application data cleaning has failed",e)}),"Cleaning ..."}var y=null,b=null,w=new r($("#builderPanel"),I,q,R),E=null;return{init:S,resize:j,appInitComplete:x,shareAppAndWebmap:V}}),define("lib-build/tpl!storymaps/tpl/builder/BuilderView",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal fade" id="settingsPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\n<div class="modal" id="initPopup" role="dialog" data-backdrop="static"></div>\n\n<div class="modal fade builderShare" id="sharePopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\n<div class="modal fade builderShareError" id="sharePopupError" role="dialog" data-backdrop="static" tabindex="-1"></div>\n\n<div class="modal fade saveErrorPopup" id="saveErrorPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\n<div class="modal fade saveErrorPopupSocial" id="saveErrorPopupSocial" role="dialog" data-backdrop="static" tabindex="-1"></div>\n\n<div class="modal fade addEditPopup" id="addEditPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\n<div class="modal fade editorDialog editorDialogInlineMedia" id="editorDialogInlineMedia" role="dialog" data-backdrop="static" tabindex="-1"></div>\n\n<div class="modal fade organizePopup" id="organizePopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\n\n<div class="modal fade mapErrorDialog" id="mapErrorDialog" role="dialog" data-backdrop="static" tabindex="-1"></div>\n<div class="modal fade mapEditPopupNewMap" id="mapEditPopupNewMap" role="dialog" data-backdrop="static" tabindex="-1"></div>\n<div class="modal fade mapEditPopup" id="mapEditPopup" role="dialog" data-backdrop="static" tabindex="-1"></div>\n';return __p}}),define("lib-build/css!storymaps/tpl/builder/BuilderView",[],function(){}),define("lib-build/css!storymaps/tpl/builder/Common",[],function(){}),define("lib-build/tpl!storymaps/common/builder/Landing",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="builderLanding">\n	<div class="landing-add-container">\n		<div class="landing-lbl">'+((__t=lblAdd)==null?"":__t)+'</div>\n		<div class="add-title-wrapper">\n			<input type="text" class="form-control add-title" spellcheck="true" placeholder="'+((__t=phAdd)==null?"":__t)+'"/>\n			<span class="landing-btn disabled"></span>\n		</div>\n	</div>\n\n	<div class="btnSeparator ',hasBuilderTour||(__p+=" disabled "),__p+='" >\n		<span class="solidline"></span>\n		'+((__t=lblOR)==null?"":__t)+'\n		<span class="solidline"></span>\n	</div>\n\n	<div class="landing-tour-container ',hasBuilderTour||(__p+=" disabled "),__p+='">\n		<div class="landing-btn"></div>\n		<div class="landing-lbl">'+((__t=lblHelp)==null?"":__t)+"</div>\n	</div>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/Landing",[],function(){}),define("storymaps/common/builder/Landing",["lib-build/tpl!./Landing","lib-build/css!./Landing"],function(e){return function(n,r,i){function u(){return n.find(".landing-add-container .add-title").val()}function a(){n.find(".landing-add-container .landing-btn").toggleClass("disabled",!u())}function f(){if(!$(this).hasClass("disabled")){var e=$(".add-title-wrapper input").val().trim();if(!e)return;var t=o&&_.some(o,function(t){return t.title&&t.title.toLowerCase()===e.toLowerCase()});if(t&&app.data.getWebAppItem().title!==e){$("#saveErrorPopup").modal("show");return}app.data.getWebAppData().setTitle(e),$(".builder-save").removeClass("disabled").trigger("click"),setTimeout(function(){r(u())},1e3),$("#sharePopup").one("show.bs.modal",function(e){e.stopImmediatePropagation(),e.preventDefault()}),$("#sharePopupError").one("show.bs.modal",function(e){e.stopImmediatePropagation(),e.preventDefault()})}}function l(e){e.keyCode==13&&$(this).val()&&f()}function c(){n.find(".landing-add-container .add-title").bind("input propertychange",a).keyup(l),n.find(".landing-add-container .landing-btn").click(f),n.find(".landing-tour-container").click(i),$("#builderQuotes").html('<div style="padding: 0 18%">'+s[Math.floor(Math.random()*s.length)].join("<br />")+"</div>")}var s=[["&ldquo;There's always room for a story that can transport people to another place.&rdquo;","--J.K. Rowling"],["&ldquo;Storytelling is the most powerful way to put ideas into the world today.&rdquo;","--Robert McKee"],["&ldquo;The stories we tell literally make the world. If you want to change the world, you need to change your story. This truth applies both to individuals and institutions.&rdquo;","--Michael Margolis"],["&ldquo;The shortest distance between a human being and the truth is a story.&rdquo;","--Anthony de Mello"],["&ldquo;People don’t want more information. They are up to their eyeballs in information. They want faith–faith in you, your goals, your success, in the story you tell.&rdquo;","--Annette Simmons"],["&ldquo;I truly believe that people are looking for stories that really mean something–stories that are redemptive, inspiring, and bigger than an individual.&rdquo;","--Scott Harrison"],["&ldquo;If you wish to influence an individual or a group to embrace a particular value in their daily lives, tell them a compelling story.&rdquo;","--Annette Simmons"],["&ldquo;If you tell me, it’s an essay. If you show me, it’s a story.&rdquo;","--Barbara Greene"],["&ldquo;If you don’t know the trees you may be lost in the forest, but if you don’t know the stories you may be lost in life.&rdquo;","--Siberian Elder"],["&ldquo;Stories are the creative conversion of life itself into a more powerful, clearer, more meaningful experience. They are the currency of human contact.&rdquo;","--Robert McKee"]],o;n.append(e({lblAdd:i18n.builder.landing.lblAdd,phAdd:i18n.builder.landing.phAdd,lblOR:i18n.builder.landing.lblOR,lblHelp:i18n.builder.landing.lblHelp,hasBuilderTour:!app.appCfg.disableBuilderTour})),c(),this.toggle=function(e){i18n.builder.landing.lblAdd.match("%LAYOUT_TITLE%")&&n.find(".landing-add-container .landing-lbl").html(i18n.builder.landing.lblAdd.replace("%LAYOUT_TITLE%",app.data.getCurrentLayoutStaticConfig().title)),!u()&&(app.isGalleryCreation||app.isWebMapCreation)&&(n.find(".landing-add-container .add-title").val(app.data.getWebAppItem().title).select(),a()),!o&&app.portal&&app.portal.getPortalUser&&app.portal.getPortalUser().getItems().then(function(e){o=e}),n.toggle(e),$("#builderQuotes").toggle(e),focus()},this.focus=function(){n.find(".landing-add-container .add-title").focus()}}}),define("lib-build/tpl!storymaps/tpl/builder/Help",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="builderHelp">\n	<div class="builderHelpContainer">\n		<div class="help-header">\n			<div class="help-logo"></div>\n			'+((__t=lblHelp)==null?"":__t)+'\n		</div>\n		<div class="helpNav">\n			<div class="stroke-bg"></div>\n			<div class="helpBtns">\n				<div class="helpBtn helpAdd">\n					<div class="helpImg"></div>\n					<div class="helpLbl">'+((__t=lblAdd)==null?"":__t)+'</div>\n				</div>\n				<div class="helpBtn helpSettings">\n					<div class="helpImg"></div>\n					<div class="helpLbl">'+((__t=lblSettings)==null?"":__t)+'</div>\n				</div>\n				<div class="helpBtn helpOrganize">\n					<div class="helpImg"></div>\n					<div class="helpLbl">'+((__t=lblOrga)==null?"":__t)+'</div>\n				</div>\n				<div class="helpBtn helpEdits">\n					<div class="helpImg"></div>\n					<div class="helpLbl">'+((__t=lblEdit)==null?"":__t)+'</div>\n				</div>\n				<div class="helpBtn helpPublish">\n					<div class="helpImg"></div>\n					<div class="helpLbl">'+((__t=lblPublish)==null?"":__t)+'</div>\n				</div>\n				<div class="helpBtn helpTips">\n					<div class="helpImg"></div>\n					<div class="helpLbl">'+((__t=lblTips)==null?"":__t)+'</div>\n				</div>\n			</div>\n		</div>\n		\n		<div class="helpText"></div>\n		\n		<div class="helpFooter">\n			'+((__t=lblMore)==null?"":__t)+' <button class="btn btn-external-help">'+((__t=lblLink)==null?"":__t)+'</button>\n			<span class="footerBtn">\n				<button class="btn btn-next">'+((__t=btnNext)==null?"":__t)+'</button>\n				<button class="btn btn-close btn-naked">'+((__t=btnClose)==null?"":__t)+"</button>\n			</span>\n		</div>\n	</div>\n</div>";return __p}}),define("lib-build/css!storymaps/tpl/builder/Help",[],function(){}),define("storymaps/tpl/builder/Help",["lib-build/tpl!./Help","lib-build/css!./Help","../core/WebApplicationData"],function(e,t,n){return function(r){function a(){var e=$("body").width(),t=$("body").height(),n=$(".builder-content-panel:visible .builder-add"),r=$(".builder-content-panel:visible .builder-organize"),i=[n.length?{left:n[0].getBoundingClientRect().left,top:n[0].getBoundingClientRect().top,width:n.outerWidth(),height:n.outerHeight()}:{},{left:$(".builder-settings")[0].getBoundingClientRect().left,top:$(".builder-settings")[0].getBoundingClientRect().top,width:$(".builder-settings").width(),height:$(".builder-settings").height()},r.length?{left:r[0].getBoundingClientRect().left,top:r[0].getBoundingClientRect().top,width:r.outerWidth(),height:r.outerHeight()}:{},null,{left:$(".builder-share")[0].getBoundingClientRect().left,top:$(".builder-share")[0].getBoundingClientRect().top,width:$(".builder-share").width(),height:$(".builder-share").height()},null];$("#builderHelpMaskOverlay").attr("width",e).attr("height",t);var s=document.getElementById("builderHelpMaskOverlay").getContext("2d");s.globalAlpha=.6,s.fillStyle="#000",s.fillRect(0,0,e,t);if(!i[o])return;s.globalCompositeOperation="destination-out",s.fillRect(i[o].left-7,i[o].top-7,i[o].width+14,i[o].height+12),s.globalCompositeOperation="source-over",s.lineWidth=4,s.strokeStyle="#428BC9",s.shadowOffsetX=3,s.shadowOffsetY=3,s.shadowBlur=5,s.shadowColor="#000",f(s,i[o].left-7,i[o].top-7,i[o].width+14,i[o].height+12,5,!1,!0)}function f(e,t,n,r,i,s,o,u){typeof u=="undefined"&&(u=!0),typeof s=="undefined"&&(s=5),e.beginPath(),e.moveTo(t+s,n),e.lineTo(t+r-s,n),e.quadraticCurveTo(t+r,n,t+r,n+s),e.lineTo(t+r,n+i-s),e.quadraticCurveTo(t+r,n+i,t+r-s,n+i),e.lineTo(t+s,n+i),e.quadraticCurveTo(t,n+i,t,n+i-s),e.lineTo(t,n+s),e.quadraticCurveTo(t,n,t+s,n),e.closePath(),u&&e.stroke(),o&&e.fill()}function l(){var e=["<span>"+i18n.builder.help.content1Div1.replace(/%TPL_NAME%/g,app.cfg.TPL_NAME)+"<br /><br />"+i18n.builder.help.content1Div2+"</span>","<span>"+i18n.builder.help.content2Div1.replace(/%TPL_NAME%/g,app.cfg.TPL_NAME)+"<br /><br />"+i18n.builder.help.content2Div2.replace(/%TPL_NAME%/g,app.cfg.TPL_NAME)+"</span>","<span><img class='floatright' src='resources/tpl/builder/icons/builder-help-topic3.png' style='margin-top: 15px'/><br />"+i18n.builder.help.content3Div1.replace(/%TPL_NAME%/g,app.cfg.TPL_NAME)+"<br /><br />"+i18n.builder.help.content3Div2.replace(/%TPL_NAME%/g,app.cfg.TPL_NAME)+"</span>","<span><img class='floatright' src='resources/tpl/builder/icons/builder-help-topic4.png' /><br />"+i18n.builder.help.content4Div1.replace(/%TPL_NAME%/g,app.cfg.TPL_NAME)+"<span>","<span><img class='floatright' style='margin-top:18px' src='resources/tpl/builder/icons/builder-help-topic5.png' /><br />"+i18n.builder.help.content5Div1.replace(/%TPL_NAME%/g,app.cfg.TPL_NAME)+"<br /><br />"+i18n.builder.help.content5Div2.replace(/%TPL_NAME%/g,app.cfg.TPL_NAME)+"</span>","<span>"+i18n.builder.help.content6AltDiv1+"<table style='width: 100%; text-align: center; margin: 10px 0;'>"+" <tr>"+"  <td><strong>"+i18n.builder.help.content6AltDiv2+"</strong></td>"+"  <td><strong>"+i18n.builder.help.content6AltDiv3+"</strong></td>"+" </tr>"+" <tr>"+"  <td><img class='tips-sync-on'  src='resources/tpl/builder/icons/builder-help-topic6-sync-placeholder.png' /></td>"+"  <td><img class='tips-sync-off' src='resources/tpl/builder/icons/builder-help-topic6-sync-placeholder.png' /></td>"+" </tr>"+"</table>"+i18n.builder.help.content6AltDiv4+"</div>"+"</span>"];r.find(".helpText").html(e[o]),r.find(".tips-sync-on").hover(function(){$(this).attr("src","resources/tpl/builder/icons/builder-help-topic6-sync-on.gif")},function(){$(this).attr("src","resources/tpl/builder/icons/builder-help-topic6-sync-placeholder.png")}),r.find(".tips-sync-off").hover(function(){$(this).attr("src","resources/tpl/builder/icons/builder-help-topic6-sync-off.gif")},function(){$(this).attr("src","resources/tpl/builder/icons/builder-help-topic6-sync-placeholder.png")})}function c(){v(),a(),h(),l(),p()}function h(){r.find(".helpBtn").removeClass("active").eq(o).addClass("active")}function p(){r.find(".helpFooter .btn-next").toggle(o!=s-1)}function d(e){$("#builderHelpMaskOverlay").toggle(e)}function v(e){var t=o===0,n=o===2;if(app.data.getStoryLength()>0)return;e&&(t=n=!1),$(".builder-content-panel").toggle(t||n),$("#sidePanel .builder, #floatingPanel .builder").toggleClass("large",t||n),t?$(".builder-add").addClass("active"):n&&$(".builder-organize").addClass("active")}function m(){d(!1),v(!0),r.hide(),u&&u(),n.getLayoutId()=="float"&&app.ui.floatingPanel.enableSwiperKeybordEvent()}function g(){$("body").append('<canvas id="builderHelpMaskOverlay"></canvas>'),r.find(".helpBtn").click(function(){o=$(this).index(),c()}),r.find(".btn-external-help").click(function(){window.open(app.cfg.HELP_URL,"_blank")}),r.find(".helpFooter .btn-next").click(function(){o++,o==s?m():c()}),r.find(".helpFooter .btn-close").click(m),$(document).keyup(function(e){e.keyCode==27&&r.is(":visible")&&m()}),$(window).resize(a)}var i=["add","settings","organize","edit","share","tips"],s=6,o=0,u=null;r.append(e({lblHelp:i18n.builder.help.lblHelp,lblAdd:i18n.builder.help.lblAdd,lblSettings:i18n.builder.help.lblSettings,lblOrga:i18n.builder.help.lblOrga,lblEdit:i18n.builder.help.lblEdit,lblPublish:i18n.builder.help.lblPublish,lblTips:i18n.builder.help.lblTips,lblMore:i18n.builder.help.lblMore,lblLink:i18n.builder.help.lblLink,btnNext:i18n.commonCore.common.next,btnClose:i18n.commonCore.common.close})),g(),this.show=function(e,t){var s=$.inArray(e,i);s==-1&&(s=0),d(!0),r.find(".helpFooter .btn").removeClass("btn-success"),r.find(".helpBtn").eq(s).click(),u=t,n.getLayoutId()=="float"&&app.ui.floatingPanel.disableSwiperKeybordEvent(),r.show()}}}),define("lib-build/tpl!storymaps/tpl/builder/InitPopup",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\n	<div class="modal-content">\n		<div class="modal-header">\n			<h3 class="modal-title">'+((__t=title)==null?"":__t)+'</h3>\n		</div>\n		<div class="modal-body">\n			<div>\n				<div class="step initPopupViewSettingsLayout"></div>\n			</div>\n		</div>\n		<div class="modal-footer">\n			<span class="modal-footer-left"></span>\n			<button class="btnNext btn btn-primary"></button>\n			<button class="btnPrev btn btn-naked btn-close"></button>\n		</div>\n	</div>\n</div>';return __p}}),define("lib-build/css!storymaps/tpl/builder/InitPopup",[],function(){}),define("lib-build/tpl!storymaps/common/builder/settings/ViewLayoutVertical",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="settings-layout settings-layout-vertical">\n	',initMode&&(__p+='\n		<p class="explain">\n			'+((__t=explain)==null?"":__t)+'\n			<a href="#" class="help" data-toggle="tooltip" title="'+((__t=helpExplain)==null?"":__t)+'">\n				<img src="resources/tpl/builder/icons/builder-help.png" style="vertical-align: -4px;"/>\n			</a>\n		</p>\n	'),__p+='\n\n	<div class="layouts">\n		<!-- ViewLayoutVerticalItem are injected here -->\n	</div>\n\n	',initMode&&(__p+='\n		<div class="start-btn-container">\n			<button type="button" class="btn btn-primary btn-start" disabled="disabled">'+((__t=start)==null?"":__t)+"</button>\n		</div>\n	"),__p+="\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/settings/ViewLayoutCommon",[],function(){}),define("lib-build/css!storymaps/common/builder/settings/ViewLayoutVertical",[],function(){}),define("lib-build/tpl!storymaps/common/builder/settings/ViewLayoutVerticalItem",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="layout">\n	<div class="layout-selected"></div>\n	<div class="layout-thumb-container">\n		<img class="layout-thumb" src="'+((__t=thumbnail)==null?"":__t)+'"/>\n	</div>\n	<div class="layout-content">\n		<div class="layout-title">'+((__t=title)==null?"":__t)+'</div>\n		<div class="layout-description">'+((__t=description)==null?"":__t)+'</div>\n		<div class="layout-live"><a target="_blank" href="'+((__t=viewExampleURL)==null?"":__t)+'">'+((__t=viewExample)==null?"":__t)+"</a></div>\n	</div>\n</div>\n";return __p}}),define("storymaps/common/builder/settings/ViewLayoutVertical",["lib-build/tpl!./ViewLayoutVertical","lib-build/css!./ViewLayoutCommon","lib-build/css!./ViewLayoutVertical","lib-build/tpl!./ViewLayoutVerticalItem","dojo/topic"],function(e,t,n,r,i){return function(){function a(){f($(this).index()),u!="init"&&i.publish("SETTINGS_LAYOUT_CHANGE",n.getSelectedLayout())}function f(e){o.find(".layout").removeClass("selected"),o.find(".layout").eq(e).addClass("selected"),o.find(".btn-start").removeAttr("disabled")}function l(){i.publish("SETTINGS_LAYOUT_CHANGE",n.getSelectedLayout())}var n=this,s=null,o=null,u=null;this.init=function(t,n,r){s=t,o=n,u=r,o.append(e({initMode:r=="init",explain:i18n.commonCore.settingsLayout.explain,helpExplain:r=="init"?i18n.commonCore.settingsLayout.explainInit:null,start:i18n.commonCore.common.start})),o.find(".help").tooltip({placement:"right",trigger:"hover"}),o.find(".btn-start").click(l)},this.present=function(e){var t=$.map(app.cfg.LAYOUTS,function(t){return t.id==e.id}).indexOf(!0);f(t>0?t:0),o.find(".layout").click(a)},this.show=function(){setTimeout(function(){var e=o.find(".layout.selected").position().top,t=o.find(".layouts")[0].scrollTop+e;o.find(".layouts").scrollTop(t>50?t:0)},200)},this.getTitle=function(){return s},this.getView=function(){return o},this.save=function(){return{id:this.getSelectedLayout()}},this.getSelectedLayout=function(){return app.cfg.LAYOUTS[o.find(".layout.selected").index()].id},this.initLocalization=function(){s.html(i18n.commonCore.settingsLayout.title),$.each(app.cfg.LAYOUTS,function(e,t){o.find(".layouts").append(r({title:t.title,description:t.description,thumbnail:t.thumbnail,viewExample:i18n.commonCore.settingsLayout.viewExample,viewExampleURL:t.liveApp}))})}}}),define("storymaps/tpl/builder/InitPopup",["lib-build/tpl!./InitPopup","lib-build/css!./InitPopup","storymaps/common/builder/settings/ViewLayoutVertical","dojo/Deferred","dojo/topic"],function(e,t,n,r,i){return function(s){function c(){if(!s.find(".step:visible").index()&&!a.hasClass("btn-success")){a.html(i18n.builder.initPopup.startBtn).removeAttr("disabled").removeClass("btn-primary").addClass("btn-success"),s.find(".tabs-step").eq(1).click();return}f.remove(),o.resolve({id:l.home.getSelectedLayout()}),$("body").unbind("keydown",h)}function h(e){e.keyCode==13&&c()}function p(){s.find(".tabs-step").click(function(){$(this).tab("show"),s.find(".step").hide().eq($(this).parent().index()?1:0).show(),$(this).parent().index()&&a.html(i18n.builder.initPopup.startBtn).removeAttr("disabled").removeClass("btn-primary").addClass("btn-success")})}s.append(e({title:i18n.builder.initPopup.title+'<span class="builder-logo"></span>'}));var o=null,u=s.find(".btnPrev"),a=s.find(".btnNext"),f=null,l={home:new n};p(),this.init=function(){},this.present=function(){return o=new r,u.hide(),a.removeAttr("disabled"),a.html(i18n.builder.initPopup.nextBtn).show(),a.click(c),l.home.init($("<div></div>"),s.find(".initPopupViewSettingsLayout"),"init"),l.home.initLocalization(),l.home.present({}),s.find(".initPopupViewSettingsLayout").show(),a.html(i18n.builder.initPopup.startBtn).removeAttr("disabled").removeClass("btn-primary").addClass("btn-success"),s.modal({keyboard:!1}),s.find(".navContainer").css("margin-left",Math.floor(-s.find(".navContainer .nav").eq(0).width()/2)),f=i.subscribe("SETTINGS_LAYOUT_CHANGE",c),$("body").bind("keydown",h),o},this.initLocalization=function(){}}}),define("lib-build/tpl!storymaps/common/builder/SharePopup",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\n	<div class="modal-content">\n		<div class="modal-logo"></div>\n		<div class="modal-header">\n			<h3 class="modal-title">'+((__t=title)==null?"":__t)+'</h3>\n		</div>\n		<div class="modal-body">\n			<div class="sharing-container">\n				<div class="btn-group app-sharing-container">\n					<div class="app-sharing-wrapper">\n						<div class="app-sharing-loading"></div>\n						<button class="app-sharing-icon glyphicon glyphicon-user" data-sharing="private" title="'+((__t=btnPrivateTooltip)==null?"":__t)+'"><span class="app-sharing-private">'+((__t=btnPrivate)==null?"":__t)+'</span></button>\n					</div>\n					<div class="app-sharing-wrapper">\n						<div class="app-sharing-loading"></div>\n						<button class="app-sharing-icon share-group" data-sharing="organization" title="'+((__t=btnOrgTooltip)==null?"":__t)+'">'+((__t=btnOrg)==null?"":__t)+'</button>\n					</div>\n					<div class="app-sharing-wrapper">\n						<div class="app-sharing-loading"></div>\n						<button class="app-sharing-icon share-globe" data-sharing="public" title="'+((__t=btnPublicTooltip)==null?"":__t)+'">'+((__t=btnPublic)==null?"":__t)+'</button>\n					</div>\n					<span class="preview-container">\n						<button class="btn btn-naked btn-link btn-open"></button>\n					</span>\n				</div>\n				<div class="sharing-action-result hide"></div>\n			</div>\n\n			<div class="story-checked-container hide">\n				<div class="story-status"></div>\n\n				<div class="views">\n					<div class="view view-share active" style="text-align: center">\n						<table style="width: 100%">\n							<tr style="vertical-align: top;">\n								<td style="width: 50%">\n									<div class="socialize-title">'+((__t=socialize)==null?"":__t)+'</div>\n									<div class="share-url-panel"></div>\n									<div class="social-container">\n										<i class="shareIcon blackHover share_facebook icon-facebook-squared"></i>\n										<i class="shareIcon blackHover share_twitter icon-twitter"></i>\n									</div>\n								</td>\n								<td style="width: 50%">\n									<div class="embed-title">'+((__t=embedTitle)==null?"":__t)+'</div>\n									<div class="share-embed-panel"></div>\n								</td>\n							</tr>\n						</table>\n						<div class="my-stories-call">'+((__t=mystoriesinvite2)==null?"":__t)+'</div>\n					</div>\n					<div class="view view-my-stories">\n						<iframe id="my-stories-frame"></iframe>\n					</div>\n					<div class="view view-private-story">\n						<div class="private-story-call-to-action"></div>\n					</div>\n				</div>\n\n				<div class="view-toggle-container">\n					<div class="btn btn-default view-toggle-btn">'+((__t=btnToggle)==null?"":__t)+'</div>\n				</div>\n			</div>\n\n			<div class="story-checking-container">\n				<div style="margin: 20px 0;">\n					<img src="resources/tpl/viewer/icons/loading-light.gif" />\n				</div>\n				'+((__t=loadingMessage)==null?"":__t)+'\n			</div>\n		</div>\n		<div class="modal-footer">\n			<span class="footer-msg"></span>\n			<button class="btnClose btn btn-naked btn-close" data-dismiss="modal" aria-hidden="true">'+((__t=close)==null?"":__t)+"</button>\n		</div>\n	</div>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/SharePopup",[],function(){}),define("lib-build/tpl!storymaps/common/builder/SharePopupError",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\n	<div class="modal-content">\n		<div class="modal-logo"></div>\n		<div class="modal-header">\n			<h4 class="modal-title">'+((__t=title)==null?"":__t)+'</h4>\n		</div>\n\n		<div class="modal-body">\n			<div class="error-msg"></div>\n		</div>\n\n		<div class="modal-footer">\n		<span class="error"></span>\n			<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal">'+((__t=btnClose)==null?"":__t)+"</button>\n		</div>\n	</div>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/SharePopupError",[],function(){}),define("storymaps/common/builder/SharePopupError",["lib-build/tpl!./SharePopupError","lib-build/css!./SharePopupError"],function(e){return function(n){n.html(e({title:i18n.commonCore.share.shareTitle,btnClose:i18n.commonCore.common.close})),this.present=function(e){var t="";e.error=="DOMAIN"?t+=i18n.commonCore.share.notavailable1.replace("%PRODUCT%",e.isPortal?"Portal for ArcGIS":"ArcGIS Online"):e.error=="PORTAL"?t+=i18n.commonCore.share.notavailable2:e.error=="DEV"&&(t+=i18n.commonCore.share.notavailable6),t+="<br /><br />",e.error=="DOMAIN"?t+=i18n.commonCore.share.notavailable3.replace("%LINK%",'<a href="'+e.mystoriesURL+'" target="_blank">'+i18n.commonCore.share.notavailable4+"</a>"):(t+=i18n.commonCore.share.notavailable3.replace("%LINK%",'<a href="'+e.itemURL+'" target="_blank">'+i18n.commonCore.share.notavailable5+"</a>"),t+=" ",t+=i18n.commonCore.share.notavailable7.replace("%MYCONTENT%",'<a href="'+e.mycontentURL+'" target="_blank">'+i18n.commonCore.share.notavailable8+"</a>")),n.find(".error-msg").html(t),n.modal({keyboard:!0})}}}),define("storymaps/common/builder/SharePopup",["lib-build/tpl!./SharePopup","lib-build/css!./SharePopup","./SharePopupError","./MyStoriesWrapper","../utils/CommonHelper","../ui/share/ShareURLPanel","../ui/share/ShareEmbedPanel","../utils/HeaderHelper","dojo/topic","dojo/has"],function(e,t,n,r,i,s,o,u,a,f){return function(l){function v(){var e=app.data.getWebAppItem().access=="private"||app.data.getWebAppItem().access=="shared";l.find(".views .view-my-stories").hasClass("active")?(e?(l.find(".views .view-share").toggleClass("active",!1),l.find(".views .view-my-stories").toggleClass("active",!1),l.find(".views .view-private-story").toggleClass("active",!0),l.find(".view-toggle-btn").html(i18n.commonCore.share.viewToggle1)):(l.find(".views .view-share").toggleClass("active",!0),l.find(".views .view-my-stories").toggleClass("active",!1),l.find(".views .view-private-story").toggleClass("active",!1),l.find(".view-toggle-btn").html(i18n.commonCore.share.viewToggle1)),f("ff")&&$("#my-stories-hidden-container").removeClass("active")):(l.find(".views .view-share").toggleClass("active",!1),l.find(".views .view-my-stories").toggleClass("active",!0),l.find(".views .view-private-story").toggleClass("active",!1),l.find(".view-toggle-btn").html(i18n.commonCore.share.viewToggle2),c.updateMyStoriesPosition())}function m(){var e=$(this).data("sharing"),t=e=="private"?0:e=="organization"?1:2,n=l.find(".app-sharing-icon.active").index();console.log("Changing sharing level to:",e),l.find(".app-sharing-icon").removeClass("active"),$(this).addClass("active"),l.find(".app-sharing-icon").addClass("locked"),l.find(".sharing-action-result").addClass("hide"),l.find(".app-sharing-wrapper").eq(t).find(".app-sharing-loading").show(),l.find(".btn-open").addClass("disabled"),app.mystories.share(e).then(g,function(e){e.needsUserInput&&e.delayPromise?(app.mystories.hasCheckErrors=!0,e.delayPromise.then(g,function(e){y(e,n)}),b({postSharing:!0,previousLevelIndex:n,targetLevelIndex:t,needsUserInput:!0})):y(e,n)})}function g(e){console.log(e),app.mystories.hasCheckErrors=!e.allClear,l.find(".app-sharing-icon").removeClass("locked"),l.find(".app-sharing-loading").hide(),l.find(".btn-open").removeClass("disabled"),e.storyAndContent&&l.find(".sharing-action-result").removeClass("hide").addClass("status-ok").html(e.message),e.targetAccess=="private"?app.data.getWebAppItem().access="private":e.targetAccess=="organization"?app.data.getWebAppItem().access="org":e.targetAccess=="public"&&(app.data.getWebAppItem().access="public"),b()}function y(e,t){console.error("sharing failed"),app.mystories.hasCheckErrors=!e.allClear,l.find(".app-sharing-icon").removeClass("locked active"),l.find(".app-sharing-icon").eq(t).addClass("active"),l.find(".app-sharing-loading").hide(),l.find(".btn-open").removeClass("disabled"),l.find(".sharing-action-result").removeClass("hide status-ok").html(e.message)}function b(e){var t=app.data.getWebAppItem().access,n=t=="private"||t=="shared",r=t=="account"||t=="org",i=app.isDirectCreationFirstSave||app.isGalleryCreation,s=n?0:r?1:2,o="";e=e||{},l.find(".story-checked-container").toggleClass("hide",app.mystories.isChecking),l.find(".story-checking-container").toggleClass("hide",!app.mystories.isChecking),l.find(".app-sharing-icon").removeClass("locked active"),i?l.find(".app-sharing-icon").addClass("locked"):n||e.needsUserInput&&e.targetLevelIndex===0?l.find(".app-sharing-icon").eq(0).addClass("active"):r||e.needsUserInput&&e.targetLevelIndex===1?l.find(".app-sharing-icon").eq(1).addClass("active"):l.find(".app-sharing-icon").eq(2).addClass("active");var u;!i&&!app.mystories.forcedIgnoreIssues&&(e.needsUserInput?(u=e.targetLevelIndex,l.find(".app-sharing-loading").hide(),u==2?l.find(".app-sharing-icon").eq(2).toggleClass("locked",!0):u==1?(l.find(".app-sharing-icon").eq(2).toggleClass("locked",!0),l.find(".app-sharing-icon").eq(1).toggleClass("locked",!0)):u===0&&l.find(".app-sharing-icon").eq(0).toggleClass("locked",!0)):app.mystories.hasCheckErrors?(u=e.postSharing?e.previousLevelIndex:s,u==2?l.find(".app-sharing-icon").toggleClass("locked",!1):u==1?(l.find(".app-sharing-icon").toggleClass("locked",!0),l.find(".app-sharing-icon").eq(0).toggleClass("locked",!1)):u===0&&l.find(".app-sharing-icon").toggleClass("locked",!0)):l.find(".app-sharing-icon").toggleClass("locked",app.mystories.isChecking));if(!app.mystories.isChecking){if(app.mystories.hasCheckErrors||app.mystories.forcedIgnoreIssues)o+=i18n.commonCore.share.statusError;l.find(".story-status").hide();if(app.mystories.hasCheckErrors||app.mystories.forcedIgnoreIssues){l.find(".story-status").html(o).show();if(n){var h=i18n.commonCore.share.statusPrivate;h+="<br />",h+=i18n.commonCore.share.statusNoErrPrivate,l.find(".private-story-call-to-action").html(h)}}else n&&(o+=i18n.commonCore.share.statusPrivate,o+="<br />",o+=i18n.commonCore.share.statusNoErrPrivate,l.find(".private-story-call-to-action").html(o));if(!e.isRefresh||app.mystories.forcedIgnoreIssues){var p=!!(app.mystories.hasCheckErrors&&!app.mystories.forcedIgnoreIssues||e.needsUserInput||i);l.find(".views .view-share").toggleClass("active",(!app.mystories.hasCheckErrors||!!app.mystories.forcedIgnoreIssues)&&!e.needsUserInput&&!n&&!i),l.find(".views .view-my-stories").toggleClass("active",p),l.find(".views .view-private-story").toggleClass("active",(!app.mystories.hasCheckErrors||app.mystories.forcedIgnoreIssues)&&!e.needsUserInput&&n),f("ff")&&($("#my-stories-hidden-container").toggleClass("active",p),p&&c.updateMyStoriesPosition())}}l.find(".btn-open").toggle(!i),l.find(".btn-open").html(n?i18n.commonCore.share.preview:i18n.commonCore.share.viewlive),l.find(".view-toggle-container").toggleClass("hide",app.mystories.hasCheckErrors&&!app.mystories.forcedIgnoreIssues||i),l.find(".view-toggle-btn").html(i18n.commonCore.share.viewToggle1),a.publish("MYSTORIES_SCAN",app.mystories.hasCheckErrors||e.needsUserInput?"error":null)}function w(){l.find(".app-sharing-icon").click(m),l.find(".view-toggle-btn").click(v),l.find(".btn-open").off("click").click(function(){window.open(i.getAppViewModeURL()+"&preview","_blank")}),l.on("hide.bs.modal",function(){f("ff")&&$("#my-stories-hidden-container").removeClass("active")}),l.on("shown.bs.modal",function(){f("ff")&&c.updateMyStoriesPosition()})}l.append(e({title:i18n.commonCore.share.shareTitle,btnPrivate:i18n.commonCore.share.btnPrivate,btnPrivateTooltip:i18n.commonCore.share.btnPrivateTooltip,btnOrg:i18n.commonCore.share.btnOrg,btnOrgTooltip:i18n.commonCore.share.btnOrgTooltip,btnPublic:i18n.commonCore.share.btnPublic,btnPublicTooltip:i18n.commonCore.share.btnPublicTooltip,loadingMessage:i18n.commonCore.share.loadingMessage,btnToggle:i18n.commonCore.share.viewToggle1,socialize:i18n.commonCore.share.socialize,embedTitle:i18n.viewer.shareFromCommon.embed,mystoriesinvite2:i18n.commonCore.share.mystoriesinvite2.replace("${MYSTORIES}",'<a href="'+i.getMyStoriesURL()+'" target="_blank">'+i18n.commonCore.common.mystories+"</a>"),close:i18n.commonCore.common.close}));var c=this,h=new n($("#sharePopupError")),p=new s(l.find(".share-url-panel")),d=new o(l.find(".share-embed-panel"));w(),a.subscribe("MY-STORIES-REFRESH",function(){b({isRefresh:!0})}),this.present=function(e,t){var n=i.getAppViewModeURL();if(!app.portal.hasMyStories||!app.isProduction||!r.myStoriesIsSameDomain()){var s="";!app.isProduction&&!app.portal.hasMyStories?s="DEV":app.isProduction&&app.isPortal&&r.myStoriesIsSameDomain()&&!app.portal.hasMyStories?s="PORTAL":app.isProduction&&(!app.portal.hasMyStories||!r.myStoriesIsSameDomain())&&(s="DOMAIN");if(s){h.present({error:s,isPortal:app.isPortal,itemURL:i.getItemURL(app.data.getWebAppItem().id),mycontentURL:i.getMyContentURL(),mystoriesURL:i.getMyStoriesURL()});return}}p.present(n,!1),d.present(n),u.setSocial(l,t),u.initEvents(l,"bottom");if(app.mystories){l.find(".app-sharing-icon").tooltip({placement:"top",container:".app-sharing-container",trigger:"hover"}),b();var o='<a href="'+i.getMyStoriesURL()+'" target="_blank">'+i18n.commonCore.share.mystoriesinvite+"</a>";l.find(".footer-msg").html(o)}else l.find(".app-sharing-icon").removeClass("active").addClass("locked");l.find(".sharing-action-result").addClass("hide");var a=app.portal.isOrganization!==!1,f=app.data.getWebAppItem().access,c=a&&$.inArray("portal:user:shareToOrg",app.portal.getPortalUser().privileges)>-1,v=!a||$.inArray("portal:user:shareToPublic",app.portal.getPortalUser().privileges)>-1,m=app.data.getWebAppItem().itemControl,g=f=="private"||f=="shared",y=f=="account"||f=="org",w=app.data.getWebAppItem().owner==app.portal.getPortalUser().username;m=="update"?(c=!1,v=!1):m=="admin"&&!w&&(c=$.inArray("portal:admin:shareToOrg",app.portal.getPortalUser().privileges)>-1,v=$.inArray("portal:admin:shareToPublic",app.portal.getPortalUser().privileges)>-1),y?c=!0:g||(v=!0),l.find(".app-sharing-wrapper").eq(0).addClass("enabled"),l.find(".app-sharing-wrapper").eq(1).toggleClass("enabled",c),l.find(".app-sharing-wrapper").eq(2).toggleClass("enabled",v),l.find(".app-sharing-wrapper.enabled:last").addClass("lastBtn"),l.modal({keyboard:!0})},this.updateMyStoriesPosition=function(){if(f("ff")){var e=l.find(".view-my-stories")[0].getBoundingClientRect();$("#my-stories-hidden-container").addClass("active").css({top:e.top,left:e.left,width:e.right-e.left,height:l.find(".story-status").is(":visible")?270:300})}}}}),define("lib-build/tpl!storymaps/tpl/builder/settings/ViewLayoutOptions",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="settings-layoutoptions">\n	<div class="checkbox opt-description-container">\n		<label>\n			<input type="checkbox" class="opt-checkbox-description" />\n			'+((__t=lblDescription)==null?"":__t)+'\n		</label>\n	</div>\n	\n	<div class="opt-container opt-legend-container">\n		<strong>'+((__t=lblLegend)==null?"":__t)+'</strong>\n		<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipLegend)==null?"":__t)+'">\n			<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n		</a>\n		<div class="form-group container-padding" style="margin-top: -5px">\n			<div class="radio">\n				<label>\n					<input type="radio" name="optionsLegend" value="panel">\n					<span></span>\n				</label>\n			</div>\n			<div class="radio">\n				<label>\n					<input type="radio" name="optionsLegend" value="dropdown">\n					</span>'+((__t=lblDropdown)==null?"":__t)+'</span>\n				</label>\n			</div>\n		</div>\n	</div>\n	\n	<div class="opt-container opt-panel-container">\n		<strong class="opt-panel-container-lbl"></strong>\n		<div class="container-padding" style="margin-top: 8px">\n			<div class="btn-group btn-position">\n				<button type="button" class="btn btn-default btn-xs" data-value="left">'+((__t=cfgLeft)==null?"":__t)+'</button>\n				<button type="button" class="btn btn-default btn-xs" data-value="right">'+((__t=cfgRight)==null?"":__t)+'</button>\n			</div>\n			\n			<div class="btn-group btn-size">\n				<button type="button" class="btn btn-default btn-xs" data-value="small">'+((__t=cfgSmall)==null?"":__t)+'</button>\n				<button type="button" class="btn btn-default btn-xs" data-value="medium">'+((__t=cfgMedium)==null?"":__t)+'</button>\n				<button type="button" class="btn btn-default btn-xs" data-value="large">'+((__t=cfgLarge)==null?"":__t)+'</button>\n			</div>\n		</div>\n	</div>\n	\n	<div class="opt-container opt-extras-container">\n		<div class="checkbox opt-numbering-container">\n			<label>\n				<input type="checkbox" class="opt-checkbox-numbering" />\n				'+((__t=lblNumbering)==null?"":__t)+'\n			</label>\n		</div>\n		<div class="checkbox opt-reverse-container">\n			<label>\n				<input type="checkbox" class="opt-checkbox-reverse" />\n				'+((__t=lblReverse)==null?"":__t)+'\n			</label>\n		</div>\n	</div>\n	\n	<div class="opt-container opt-panel-map-overlap-container">\n		<div class="checkbox">\n			<label>\n				<input type="checkbox" class="opt-checkbox-overlap" />\n				<span class="lbl-checkbox-overlap"></span>\n			</label>\n		</div>\n	</div>\n	\n	<div class="preview"></div>\n	\n	<!-- <div class="debug">DEBUG</div>  -->\n</div>';return __p}}),define("lib-build/css!storymaps/tpl/builder/settings/ViewLayoutOptions",[],function(){}),define("storymaps/tpl/builder/settings/ViewLayoutOptions",["lib-build/tpl!./ViewLayoutOptions","lib-build/css!./ViewLayoutOptions","dojo/topic","../../core/WebApplicationData"],function(e,t,n,r){return function(){function f(){if(!u||!a)return;var e=u=="accordion",t=u=="tab",n=u=="bullet",r=o.find(".opt-checkbox-description").prop("checked"),s=o.find("input[name=optionsLegend]:checked").val()=="panel";o.find(".settings-layoutoptions").attr("data-layout",u),o.find(".opt-description-container").toggle(!e),o.find(".opt-legend-container").toggle(t),o.find("input[name=optionsLegend]").eq(0).siblings().html(r?i18n.builder.settingsLayoutOptions.lblBelowDesc:i18n.builder.settingsLayoutOptions.lblOnPanel);var f=!e&&!o.find(".opt-checkbox-description").prop("checked")&&o.find("input[name=optionsLegend]:checked").val()!="panel";o.find(".opt-panel-container").toggleClass("disabled",f);var l=i18n.builder.settingsLayoutOptions.lblPanelAccordion;u!="accordion"&&(r&&s?l=i18n.builder.settingsLayoutOptions.lblPanelDescAndLegend:r?l=i18n.builder.settingsLayoutOptions.lblPanelDesc:s?l=i18n.builder.settingsLayoutOptions.lblPanelLegend:l=i18n.builder.settingsLayoutOptions.lblPanelDescAndOrLegend),o.find(".opt-panel-container-lbl").html(l),o.find(".opt-extras-container").toggle(e||n),o.find(".opt-numbering-container").toggle(e),o.find(".opt-reverse-container").toggle(e||n),o.find(".opt-reverse-container").toggleClass("disabled",u=="accordion"&&!o.find(".opt-checkbox-numbering").is(":checked")),o.find(".opt-panel-map-overlap-container").toggle(t||n).toggleClass("disabled",f),o.find(".lbl-checkbox-overlap").html(l+" "+i18n.builder.settingsLayoutOptions.canOverlapMap),o.find(".preview").html(app.appCfg.getLayoutThumbnail({layout:u,options:i.save(),theme:a.colors,contentLabel:!0}))}function l(){$(this).siblings().removeClass("btn-primary"),$(this).addClass("btn-primary"),c()}function c(){f(),n.publish("SETTINGS_LAYOUT_OPTIONS_CHANGE",{layoutCfg:i.save()})}function h(e){return e.css("display")=="block"}function p(){n.subscribe("SETTINGS_LAYOUT_CHANGE",function(e){u=="accordion"&&e!="accordion"&&o.find("input[name=optionsLegend]").eq(0).click(),u=e,f()}),n.subscribe("SETTINGS_THEME_CHANGE",function(e){a=e,f()}),o.find(".opt-checkbox-description").change(c),o.find("input[name=optionsLegend]").change(c),o.find(".btn-position .btn").click(l),o.find(".btn-size .btn").click(l),o.find(".opt-checkbox-numbering").click(c),o.find(".opt-checkbox-reverse").click(c),o.find(".help").tooltip({trigger:"hover"}),o.find(".debug").click(function(){console.log(i.save())})}var i=this,s=null,o=null,u=null,a=null;this.init=function(t,n){s=t,o=n,o.append(e({lblDescription:i18n.builder.settingsLayoutOptions.lblDescription,lblLegend:i18n.builder.settingsLayoutOptions.lblLegend,tooltipLegend:i18n.builder.settingsLayoutOptions.tooltipLegend,lblDropdown:i18n.builder.settingsLayoutOptions.lblDropdown,cfgLeft:i18n.builder.settingsLayoutOptions.cfgLeft,cfgRight:i18n.builder.settingsLayoutOptions.cfgRight,cfgSmall:i18n.builder.settingsLayoutOptions.cfgSmall,cfgMedium:i18n.builder.settingsLayoutOptions.cfgMedium,cfgLarge:i18n.builder.settingsLayoutOptions.cfgLarge,lblNumbering:i18n.builder.settingsLayoutOptions.lblNumbering,lblReverse:i18n.builder.settingsLayoutOptions.lblReverse})),p()},this.present=function(e){u=r.getLayoutId(),a=r.getTheme(),e=e||{},o.find(".opt-checkbox-legend").prop("checked",e.legend=="dropdown"),o.find(".opt-checkbox-description").prop("checked",e.description===!0);var t=["panel","dropdown"].indexOf(e.legend);o.find("input[name=optionsLegend]").eq(t>0?t:0).click();var n=e.panel?e.panel.position:"left",i=e.panel?e.panel.sizeLbl:"medium";o.find('.btn-position .btn[data-value="'+n+'"]').click(),o.find('.btn-size .btn[data-value="'+i+'"]').click(),o.find(".opt-checkbox-numbering").prop("checked",e.numbering===undefined||e.numbering===!0),o.find(".opt-checkbox-reverse").prop("checked",e.reverse===!0),o.find(".opt-checkbox-overlap").prop("checked",e.panelMapOverlap===!0),f()},this.show=function(){},this.save=function(){var e={};h(o.find(".opt-description-container"))?e.description=o.find(".opt-checkbox-description").prop("checked"):e.description=!0,h(o.find(".opt-legend-container"))?e.legend=o.find("input[name=optionsLegend]:checked").val():u=="accordion"?e.legend="dropdown":e.legend="panel",o.find(".opt-panel-container").hasClass("disabled")||(e.panel={position:o.find(".btn-position .btn-primary").data("value"),size:o.find(".btn-size .btn-primary").data("value")}),h(o.find(".opt-numbering-container"))&&(e.numbering=o.find(".opt-checkbox-numbering").prop("checked")),h(o.find(".opt-reverse-container"))&&(e.reverse=o.find(".opt-checkbox-reverse").prop("checked"));var t=o.find(".opt-panel-map-overlap-container");return h(t)&&(e.panelMapOverlap=!t.hasClass("disabled")&&o.find(".opt-checkbox-overlap").prop("checked")),e},this.initLocalization=function(){s.html(i18n.builder.settingsLayoutOptions.title)}}}),define("lib-build/tpl!storymaps/tpl/builder/settings/ViewMapOptions",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="settings-mapoptions">\n	<div class="checkbox">\n		<label>\n			<input type="checkbox" class="opt-checkbox-overview" />\n			'+((__t=lblOverview)==null?"":__t)+'\n			<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipOverview)==null?"":__t)+'">\n				<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n			</a>\n		</label>\n	</div>\n	<div class="checkbox">\n		<label>\n			<input type="checkbox" class="opt-checkbox-locateBtn" />\n			'+((__t=lblLocate)==null?"":__t)+'\n			<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipLocate)==null?"":__t)+'">\n				<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n			</a>\n		</label>\n	</div>\n	<div class="checkbox">\n		<label>\n			<input type="checkbox" class="opt-checkbox-geocoder" />\n			'+((__t=lblGeocoder)==null?"":__t)+'\n			<a href="#" class="help" data-toggle="tooltip" data-html="true" data-placement="right" title="'+((__t=tooltipGeocoder)==null?"":__t)+'">\n				<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n			</a>\n		</label>\n	</div>\n\n	<div class="checkbox" style="margin-top: 28px">\n		<label>\n			<input type="checkbox" class="opt-checkbox-sync" />\n			'+((__t=lblSync)==null?"":__t)+'\n			<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipSync)==null?"":__t)+'">\n				<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n			</a>\n		</label>\n	</div>\n</div>';return __p}}),define("lib-build/css!storymaps/tpl/builder/settings/ViewMapOptions",[],function(){}),define("storymaps/tpl/builder/settings/ViewMapOptions",["lib-build/tpl!./ViewMapOptions","lib-build/css!./ViewMapOptions"],function(e){return function(){var n=null,r=null,i=null;this.init=function(t,i){n=t,r=i,r.append(e({hello:i18n.builder.settingsMapOptions.hello,lblOverview:i18n.builder.settingsMapOptions.lblOverview,tooltipOverview:i18n.builder.settingsMapOptions.tooltipOverview,lblLocate:i18n.builder.settingsMapOptions.lblLocate,tooltipLocate:i18n.builder.settingsMapOptions.tooltipLocate,lblGeocoder:i18n.builder.settingsMapOptions.lblGeocoder,tooltipGeocoder:i18n.builder.settingsMapOptions.tooltipGeocoder,lblSync:i18n.builder.settingsMapOptions.lblSync,tooltipSync:i18n.builder.settingsMapOptions.tooltipSync})),r.find(".help").tooltip({trigger:"hover"})},this.present=function(e){r.find(".opt-checkbox-overview").prop("checked",e.overview&&e.overview.enable),r.find(".opt-checkbox-locateBtn").prop("checked",e.locateBtn&&e.locateBtn.enable),r.find(".opt-checkbox-geocoder").prop("checked",e.geocoder&&e.geocoder.enable),r.find(".opt-checkbox-sync").prop("checked",e.mapsSync),i=e},this.show=function(){},this.save=function(){return{overview:{enable:r.find(".opt-checkbox-overview").prop("checked"),openByDefault:i&&i.overview?!!i.overview.openByDefault:!0},locateBtn:{enable:r.find(".opt-checkbox-locateBtn").prop("checked")},geocoder:{enable:r.find(".opt-checkbox-geocoder").prop("checked")},mapsSync:r.find(".opt-checkbox-sync").prop("checked")}},this.initLocalization=function(){n.html(i18n.builder.settingsMapOptions.title)}}}),define("lib-build/tpl!storymaps/common/builder/settings/ViewTheme",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="settings-colors">\n	<div class="themes">\n		<!-- themes are injected here -->\n	</div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/settings/ViewTheme",[],function(){}),define("storymaps/common/builder/settings/ViewTheme",["lib-build/tpl!./ViewTheme","lib-build/css!./ViewTheme","dojo/topic"],function(e,t,n){return function(){function l(e){if(!o)return;var t=$.grep(app.cfg.LAYOUTS,function(e){return e.id==o}),n=s.find(".layout-thumbnail.selected").index(),r="";a=t[0].themes||[],n==-1&&(n=0),f&&$.each(a,function(e,t){f==t.group&&(n=e)}),e&&$.each(a,function(t,r){e.name==r.name&&(n=t,f=r.group)}),$.each(a,function(e,t){r+=app.appCfg.getLayoutThumbnail({layout:o,theme:t,options:u,selected:n==e})}),s.find(".themes").html(r),s.find(".layout-thumbnail").click(c).eq(n).addClass("selected")}function c(){s.find(".layout-thumbnail").removeClass("selected"),$(this).addClass("selected"),f=a[$(this).index()].group,n.publish("SETTINGS_THEME_CHANGE",r.save())}var r=this,i=null,s=null,o=null,u=null,a=null,f=null;this.init=function(t,a){i=t,s=a,s.append(e({})),n.subscribe("SETTINGS_LAYOUT_CHANGE",function(e){o=e,s.find(".themes").html(""),l(),n.publish("SETTINGS_THEME_CHANGE",r.save())}),n.subscribe("SETTINGS_LAYOUT_OPTIONS_CHANGE",function(e){u=e.layoutCfg,l()})},this.present=function(e){o=e.layout,u=e.layoutCfg,f=null,l(e.theme?e.theme.colors:null)},this.save=function(){return{colors:s.find(".layout-thumbnail.selected").data("colors")}},this.show=function(){},this.getTitle=function(){return i},this.getView=function(){return s},this.initLocalization=function(){i.html(i18n.commonCore.settingsTheme.title)}}}),define("lib-build/tpl!storymaps/common/builder/settings/ViewHeader",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="settings-header">\n	<div class="settings-simulator">\n		<img class="imgLogo"/>\n	</div>\n	<div class="settings-content">\n		<form role="form" class="form1">\n			<div class="form-group form-inline form-horizontal">\n				<div class="radio">\n					<label>\n						<input type="radio" name="optionsLogo" id="optionsRadios1" value="esri" checked>\n						<span class="logoText">'+((__t=logoEsriRadio)==null?"":__t)+'</span>\n					</label>\n				</div>\n				<div class="radio orgLogo">\n					<label>\n						<input type="radio" name="optionsLogo" id="optionsRadios2" value="org">\n						<span class="logoText">'+((__t=logoOrgRadio)==null?"":__t)+'</span>\n					</label>\n				</div>\n				<div class="radio">\n					<label>\n						<input type="radio" name="optionsLogo" id="optionsRadios3" value="custom">\n						<span class="logoText">'+((__t=logoCustomRadio)==null?"":__t)+'</span>\n					</label>\n				</div>\n				<div class="radio">\n					<label>\n						<input type="radio" name="optionsLogo" id="optionsRadios4" value="none">\n						<span class="logoText">'+((__t=logoNoneRadio)==null?"":__t)+'</span>\n					</label>\n				</div>\n				<div class="optionsLogoCustom">\n					<table class="settings-table">\n						<tr class="hide-except-custom">\n							<td class="td-lbl">'+((__t=logoCustomLabel)==null?"":__t)+'</td>\n							<td class="td-first">\n								<div class="logo-btn-group btn-group">\n									<button type="button" id="uploadRadio" class="btn btn-default btn-sm active" title="'+((__t=logoCustomUploadTooltip)==null?"":__t)+'">\n										<span class="fa fa-upload"></span>\n						      </button>\n									<button type="button" id="linkRadio" class="btn btn-default btn-sm" title="'+((__t=logoCustomLinkTooltip)==null?"":__t)+'">\n										<span class="fa fa-link"></span>\n									</button>\n								</div>\n							</td>\n							<td class="td-input">\n									<div id="uploadBtn" class="btn btn-default btn-sm btn-file" title="'+((__t=logoCustomUploadTooltip)==null?"":__t)+'">\n										<span class="fa fa-upload"></span>\n										<span>'+((__t=logoCustomUploadButton)==null?"":__t)+'</span>\n							        <input class="file-input" type="file" accept=".png,.jpeg,.jpg,.gif,.bmp"></input>\n						      </div>\n								<input class="form-control input-sm" id="logoInput" type="text" placeholder="'+((__t=logoCustomLinkPlaceholder)==null?"":__t)+'">\n								<input class="hidden" id="uploadLogoInput" type="text"">\n								<span class="uploadHelp fa fa-info-circle" data-toggle="tooltip" data-title="'+((__t=logoCustomUploadHelp)==null?"":__t)+'"></span>\n							</td>\n						</tr>\n						<tr class="upload-warnings hidden">\n							<td></td>\n							<td class="td-input" colspan="2">\n								<span class="info-text"></span>\n							</td>\n						</tr>\n						<tr>\n							<td class="td-lbl">'+((__t=logoLink)==null?"":__t)+'</td>\n							<td class="td-input variable-colspan" colspan="2">\n								<input class="form-control input-sm" id="logoTargetInput" type="text" spellcheck="true" placeholder="'+((__t=logoCustomTargetPlaceholder)==null?"":__t)+'">\n							</td>\n						</tr>\n					</table>\n				</div>\n			</div>\n		</form>\n\n		<form class="form2">\n			<div class="form-group socialConfig">\n				<div class="checkbox">\n					<label>\n						<input type="checkbox" class="enableFB" />\n						<span class="social-lbl">Facebook</span>\n					</label>\n				</div>\n				<div class="checkbox">\n					<label>\n						<input type="checkbox" class="enableTwitter" />\n						<span class="social-lbl">Twitter</span>\n					</label>\n				</div>\n				<div class="checkbox">\n					<label>\n						<input type="checkbox" class="enableBitly" />\n						<span class="social-lbl" style="word-break: break-all;">'+((__t=share)==null?"":__t)+'</span>\n					</label>\n				</div>\n			</div>\n			<table class="settings-table">\n				<tr>\n					<td class="td-lbl">'+((__t=logoSocialText)==null?"":__t)+'</td>\n					<td class="td-input"><input id="selectSocialText" type="text" class="form-control input-sm" /></td>\n				</tr>\n				<tr>\n					<td class="td-lbl">'+((__t=logoLink)==null?"":__t)+'</td>\n					<td class="td-input"><input id="selectSocialLink" type="text" class="form-control input-sm" /></td>\n				</tr>\n			</table>\n		</form>\n	</div>\n	<form class="form-config-size">\n		<div class="checkbox">\n			<label>\n				<input type="checkbox" class="enableCompact" />\n				<span>'+((__t=lblSmallHeader)==null?"":__t)+"</span>\n			</label>\n		</div>\n	</form>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/settings/ViewHeader",[],function(){}),define("storymaps/common/builder/settings/ViewHeader",["lib-build/tpl!./ViewHeader","lib-build/css!./ViewHeader","../media/image/FileUploadHelper","../media/image/ImageUploadHelper","../../utils/CommonHelper","dojo/_base/lang"],function(e,t,n,r,i,s){return function(o){function p(){var e=$("input[name='optionsLogo']:checked",a).val(),t=e!=="custom",n=t&&e!=="org",r=e==="custom"?"2":"1",i=a.find(".optionsLogoCustom").toggleClass("hidden",n);i.find(".hide-except-custom").toggleClass("hidden",t),i.find(".variable-colspan").attr("colspan",r)}function d(e){var t;if(e==="link")t=$("#linkRadio");else if(e==="upload")t=$("#uploadRadio");else{t=$(e.target).closest(".btn");if(t.attr("disabled"))return}v(t),L()}function v(e){var t=a.find(".logo-btn-group");e=e||t.find(".btn.active");var n=e.closest("#uploadRadio").length===1;t.find(".btn").removeClass("active"),e.addClass("active"),a.find("#uploadBtn").toggleClass("hidden",!n),a.find("#logoInput").toggleClass("hidden",n)}function m(){v($("#linkRadio")),$("#uploadRadio").attr("disabled","disabled")}function g(e){var t=e.target.files?e.target.files[0]:null;if(!t){console.warn("no file",e);return}if(!n.validateFile(t)){console.warn("file not valid"),S();return}r.processLogo(t).then(s.hitch(this,y),s.hitch(this,x))}function y(e){n.uploadSingleResource(e).then(s.hitch(this,b),s.hitch(this,w))}function b(e){var t=i.prependURLHTTP(i.possiblyAddToken(e.picUrl));a.find("#uploadLogoInput").val(t),a.find(".imgLogo").attr("src",t).show(),E()}function w(e){console.warn("uploadFileError",e),S(),E()}function E(){var e=l.find("input");if(!e.length)return;e[0].value=""}function S(e){a.find(".info-text").text(e||i18n.commonCore.settingsHeader.logoUploadGenericError);var t=a.find(".upload-warnings");t.removeClass("hidden"),setTimeout(function(){t.addClass("hidden")},6e3)}function x(e){console.warn("processError",e);if(!e||!e.reason)return;var t;e.reason==="gif dimensions"&&(t=i18n.commonCore.settingsHeader.logoUploadSizeError.replace("${PIXEL-WIDTH}",e.details)),S(t),E()}function T(){O()}function N(){}function C(){h=!0,a.find(".imgLogo").hide()}function k(e){if(e.keyCode==13)return h=!1,L(),!1;e.keyCode==8&&($("#logoTargetInput").focus(),$("#logoInput").focus())}function L(){var e=$("#linkRadio",a).hasClass("active")?"#logoInput":"#uploadLogoInput",t=$(e,a).val().trim();app.cfg.HEADER_ORG_LOGO_URL&&app.cfg.HEADER_ORG_LOGO_URL===t&&(t=""),a.find(".imgLogo").attr("src",i.prependURLHTTP(i.possiblyAddToken(t))).show()}function A(e){e.keyCode==8&&($("#logoInput").focus(),$("#logoTargetInput").focus())}function O(){var e=$("input[name=optionsLogo]:checked",a).val();a.find(".imgLogo").hide(),e=="custom"?i.getItemId()?($("#uploadRadio").removeAttr("disabled"),v(),L()):m():e=="esri"?a.find(".imgLogo").attr("src","resources/tpl/viewer/icons/esri-logo.png").show():e=="org"&&a.find(".imgLogo").attr("src",app.cfg.HEADER_ORG_LOGO_URL).show()}var u=null,a=null,f=null,l=null,c=null,h=!1;o=o||{},this.init=function(t,n){u=t,a=n,a.append(e(_.extend({},i18n.commonCore.settingsHeader,{share:i18n.commonCore.builderPanel.buttonShare}))),f=a.find("#logoInput"),c=a.find("#logoTargetInput"),f.keydown(k),f.focusout(L),c.keydown(A),l=a.find("#uploadBtn"),l.on("change",g),$(".logo-btn-group").on("click",d),$("input[type=radio]",a).click(T),$("#imgLogo",a).error(C),$("#imgLogo",a).load(N),$("input[name='optionsLogo']",a).change(p),a.find(".form-config-size").toggle(o.smallSizeOpt),a.find(".uploadHelp").tooltip({trigger:"hover"})},this.present=function(e){var t=e.logoURL,n=app.data.getWebAppData().getColors(),r;$("#headerSimulator",a).css("background-color",n),t==app.cfg.HEADER_LOGO_URL||t==null?(r=$('input[value="esri"]',a),$("#imgLogo",a).show(),f.val(""),c.val("")):t==="NO_LOGO"?(r=$('input[value="none"]',a),f.val(""),c.val("")):($("#imgLogo",a).attr("src",t).show(),c.val(e.logoTarget),t===app.cfg.HEADER_ORG_LOGO_URL?r=$('input[value="org"]',a):(r=$('input[value="custom"]',a),i.isAppResource(t)?($("#uploadLogoInput",a).val(t),d("upload")):($("#logoInput",a).val(t),d("link")))),r.attr("checked","checked"),p(),$("#selectSocialText",a).val(e.linkText===undefined?app.cfg.HEADER_LINK_TEXT:e.linkText),$("#selectSocialLink",a).val(e.linkURL===undefined?app.cfg.HEADER_LINK_URL:e.linkURL),$("#selectSocialText",a).blur(function(){$(window).scrollTop(0)}),$("#selectSocialLink",a).blur(function(){$(window).scrollTop(0)}),$("#logoInput",a).blur(function(){$(window).scrollTop(0)}),c.blur(function(){$(window).scrollTop(0)}),app.cfg.HEADER_SOCIAL.facebook?(!e.social||e.social.facebook)&&$(".enableFB",a).prop("checked",!0):$(".enableFB",a).attr("disabled","disabled").parent().addClass("disabled").attr("title",i18n.commonCore.common.disabledAdmin),app.cfg.HEADER_SOCIAL.twitter?(!e.social||e.social.twitter)&&$(".enableTwitter",a).prop("checked",!0):$(".enableTwitter",a).attr("disabled","disabled").parent().addClass("disabled").attr("title",i18n.commonCore.common.disabledAdmin),!app.cfg.HEADER_SOCIAL.bitly||!app.cfg.HEADER_SOCIAL.bitly.enable||!app.cfg.HEADER_SOCIAL.bitly.login||!app.cfg.HEADER_SOCIAL.bitly.key?$(".enableBitly",a).attr("disabled","disabled").parent().addClass("disabled").attr("title",i18n.commonCore.common.disabledAdmin):(!e.social||e.social.bitly)&&$(".enableBitly",a).prop("checked",!0),app.cfg.HEADER_ORG_LOGO_URL||$(".orgLogo",a).hide(),O(),a.find(".enableCompact").prop("checked",e.compactSize||e.compactSize===undefined)},this.show=function(){},this.save=function(){var e=a.find("input[name=optionsLogo]:checked").val(),t,n,r=a.find(".imgLogo").attr("src");e=="esri"?(t=null,n=""):e=="none"||!r?(t="NO_LOGO",n=""):(t=h?app.cfg.HEADER_LOGO_URL:i.prependURLHTTP(r),n=c.val());var s=$("#selectSocialText",a).val()||"";s=s.replace(/<\/?script>/g,"");var o=$("#selectSocialLink",a).val()||"";return o=o.replace(/<\/?script>/g,""),{linkText:s,linkURL:i.prependURLHTTP(o),logoURL:t,logoTarget:i.prependURLHTTP(n),social:{facebook:$(".enableFB").prop("checked"),twitter:$(".enableTwitter").prop("checked"),bitly:$(".enableBitly").prop("checked")},compactSize:a.find(".enableCompact").prop("checked")}},this.initLocalization=function(){u.html(i18n.commonCore.settingsHeader.title)}}}),define("lib-build/tpl!storymaps/tpl/builder/addedit/Popup",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="backdrop"></div>\n<div class="modal-dialog">\n	<div class="modal-content">\n		<div class="modal-logo"></div>\n		<div class="modal-header">\n			<h4 class="modal-title"></h4>\n		</div>\n		\n		<div class="modal-body">\n			<!-- Title field -->\n			<div class="form-group titleContainer">\n				<input type="text" class="form-control title clear" placeholder="" spellcheck="true"/>\n				<span class="glyphicon glyphicon-remove form-control-feedback"></span>\n			</div>\n			\n			<div class="tab-pane viewMediaSelectorContainer"></div>\n		</div>\n		\n		<div class="modal-footer">\n			<span class="modal-footer-left"><button class="btn btn-back btn-naked">< '+((__t=btnBack)==null?"":__t)+'</button></span>\n			<span class="btnSubmitWrapper" data-toggle="tooltip"">\n				<button class="btnSubmit btn btn-primary" ></button>\n			</span>\n			<button class="btnCancel btn btn-naked btn-close">'+((__t=btnCancel)==null?"":__t)+'</button>\n			<div class="btnSubmitTooltipContainer"></div>\n		</div>\n	</div>\n</div>';return __p}}),define("lib-build/css!storymaps/tpl/builder/addedit/Popup",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/MediaSelector",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="mediaSelector">\n	<label class="lblSelect">'+((__t=lblSelect)==null?"":__t)+':</label>\n	<span class="media-types">\n		<form>\n			<div class="media-type-wrapper ',hasMap||(__p+=" disabled "),__p+='">\n				<label class="checkbox-inline media-type">\n					<input type="radio" name="media-type" value="map"> '+((__t=lblMap)==null?"":__t)+'\n					<span class="icon fa fa-map-o"></span>\n				</label>\n				<div class="mediaContainersArrow"></div>\n			</div>\n\n			<div class="media-type-wrapper">\n				<label class="checkbox-inline media-type">\n					<input type="radio" name="media-type" value="image"> '+((__t=lblImage)==null?"":__t)+'\n					<span class="icon fa fa-camera"></span>\n				</label>\n				<div class="mediaContainersArrow"></div>\n			</div>\n\n			<div class="media-type-wrapper ',hasVideo||(__p+=" disabled "),__p+='">\n				<label class="checkbox-inline media-type">\n					<input type="radio" name="media-type" value="video"> '+((__t=lblVideo)==null?"":__t)+'\n					<span class="icon fa fa-video-camera"></span>\n				</label>\n				<div class="mediaContainersArrow"></div>\n			</div>\n\n			<div class="media-type-wrapper ',hasWebPage||(__p+=" disabled "),__p+='">\n				<label class="checkbox-inline media-type">\n					<input type="radio" name="media-type" value="webpage"> '+((__t=lblExternal)==null?"":__t)+'\n					<span class="icon fa fa-external-link"></span>\n				</label>\n				<div class="mediaContainersArrow"></div>\n			</div>\n		</form>\n	</span>\n\n	<div class="mediaContainers">\n		<div class="mainMediaTypeContainer mapMediaContainer ',hasMap||(__p+=" disabled "),__p+='"></div>\n		<div class="mainMediaTypeContainer imageMediaContainer"></div>\n		<div class="mainMediaTypeContainer videoMediaContainer"></div>\n		<div class="mainMediaTypeContainer webpageMediaContainer"></div>\n	</div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/media/MediaSelector",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/map/WebMapSelector",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="webmapSelector">\n	<table class="map-cfg">\n		<tr class="map-cfg-webmap">\n			<td class="map-cfg-title">\n				'+((__t=lblWebmap)==null?"":__t)+'\n			</td>\n			<td class="map-cfg-btns">\n				<div class="webmaps-list-container">\n					<table style="width: 100%;">\n						<tr>\n							<td>\n								<div class="radio-value btn-group" style="width: 100%;">\n									<button class="btn btn-default dropdown-toggle webmaps-list-btn" type="button" data-toggle="dropdown">\n										<span class="webmaps-list-btn-inner"></span>&nbsp;<span class="caret"></span>\n									</button>\n									<ul class="dropdown-menu webmaps-list"></ul>\n								</div>\n							</td>\n							<td class="selected-map-edit-container">\n								<span class="btn btn-naked selected-map-edit" style="padding-right: 0px">\n									<span class="glyphicon glyphicon-edit" style="margin-right: 3px;"></span>\n									'+((__t=lblEdit)==null?"":__t)+'\n								</span>\n								<span class="selected-map-sharing-status"></span>\n								<!--\n								<a href="#" class="help" data-toggle="tooltip" data-placement="right" data-original-title="" title="Make sure your webmaps are shared publicly">\n									<img src="resources/tpl/builder/icons/builder-help.png">\n								</a>\n								 -->\n							</td>\n						</tr>\n					</table>\n				</div>\n			</td>\n		</tr>\n\n		<tr class="map-cfg-row map-cfg-location">\n			<td class="map-cfg-title">\n				'+((__t=lblLocation)==null?"":__t)+'\n			</td>\n			<td class="map-cfg-btns">\n				<div class="regular-control">\n					<span class="btn-group">\n						<button type="button" class="btn btn-default btn-xs" data-value="default">\n							'+((__t=webmapDefault)==null?"":__t)+'\n						</button>\n						<button type="button" class="btn btn-default btn-xs" data-value="custom">\n							'+((__t=customCfg)==null?"":__t)+'&nbsp;\n						</button>\n					</span>\n					<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipLocation)==null?"":__t)+'">\n						<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n					</a>\n				</div>\n				<div class="inherit-alt">\n					'+((__t=lblLocationAlt)==null?"":__t)+'\n					<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipLocationAlt)==null?"":__t)+'">\n						<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n					</a>\n				</div>\n			</td>\n		</tr>\n\n		<tr class="map-cfg-row map-cfg-content">\n			<td class="map-cfg-title">\n				'+((__t=lblContent)==null?"":__t)+'\n			</td>\n			<td class="map-cfg-btns">\n				<span class="btn-group">\n					<button type="button" class="btn btn-default btn-xs" data-value="default">\n						'+((__t=webmapDefault)==null?"":__t)+'\n					</button>\n					<button type="button" class="btn btn-default btn-xs" data-value="custom">\n						'+((__t=customCfg)==null?"":__t)+'&nbsp;\n					</button>\n				</span>\n				<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipContent)==null?"":__t)+'">\n					<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n				</a>\n			</td>\n		</tr>\n\n		<tr class="map-cfg-row map-cfg-popup">\n			<td class="map-cfg-title">\n				'+((__t=lblPopup)==null?"":__t)+'\n			</td>\n			<td class="map-cfg-btns">\n				<span class="btn-group">\n					<button type="button" class="btn btn-default btn-xs" data-value="default">\n						'+((__t=webmapDefault)==null?"":__t)+'\n					</button>\n					<button type="button" class="btn btn-default btn-xs" data-value="custom">\n						'+((__t=customCfg)==null?"":__t)+'&nbsp;\n					</button>\n				</span>\n				<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipPopup)==null?"":__t)+'">\n					<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n				</a>\n			</td>\n		</tr>\n\n		<tr class="map-cfg-row map-cfg-controls">\n			<td class="map-cfg-title">\n				'+((__t=lblControls)==null?"":__t)+'\n			</td>\n			<td class="map-cfg-btns">\n				<div class="checkbox map-cfg-controls-overview">\n					<label>\n						<input type="checkbox" class="opt-checkbox-overview" />\n						'+((__t=lblOverview)==null?"":__t)+'\n						<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipOverview)==null?"":__t)+'">\n							<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n						</a>\n					</label>\n				</div>\n				<div class="checkbox">\n					<label>\n						<input type="checkbox" class="opt-checkbox-legend" />\n						'+((__t=lblLegend)==null?"":__t)+'\n						<a href="#" class="help" data-toggle="tooltip" data-placement="right" title="'+((__t=tooltipLegend)==null?"":__t)+'">\n							<img class="helpImg" src="resources/tpl/builder/icons/builder-help.png">\n						</a>\n					</label>\n				</div>\n			</td>\n		</tr>\n	</table>\n\n	<div class="webmap-loading">\n\n	</div>\n\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/media/map/WebMapSelector",[],function(){}),define("storymaps/common/builder/browse-dialog/js/_RefreshMixin",["dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/on"],function(e,t,n,r){function i(e){typeof e!="object"&&(e=new Error(e)),e.grid=this,r.emit(this.domNode,"dgrid-error",{grid:this,error:e,cancelable:!0,bubbles:!0})&&console.error(e)}var s=e(null,{_trackError:function(e){var s;typeof e=="string"&&(e=t.hitch(this,e));try{s=e()}catch(o){i.call(this,o)}return n.when(s,t.hitch(this,function(){r.emit(this.domNode,"refresh",{cancelable:!0,bubbles:!0})}),t.hitch(this,i))}});return s}),define("storymaps/common/builder/browse-dialog/js/PortalItemStore",["dojo/_base/declare","dojo/_base/lang","esri/arcgis/Portal"],function(e,t,n){return e(null,{idProperty:"id",constructor:function(t){e.safeMixin(this,t),this.portalUrl=this.portal&&this.portal.portalUrl},getIdentity:function(e){return e[this.idProperty]},query:function(e,r){var e=e,i=t.isObject(e)?e:{q:e};if(r){i=t.mixin(i,{num:r.count,start:(r.start||0)+1});if(r.sort&&r.sort.length){var s=r.sort[0];i=t.mixin(i,{sortField:encodeURIComponent(s.attribute==="created"?"uploaded":s.attribute),sortOrder:s.descending?"desc":"asc"})}}if(this.galleryType==="webmap")var o=this.portal.queryItems(i).then(function(e){return e.results.total=e.total,e.results});else var o=this.portal.queryGroups(i).then(function(e){return e.results.total=e.total,e.results});return n.PortalResult(o)}})}),define("storymaps/common/builder/browse-dialog/js/Grid",["dojo/_base/declare","dojo/Evented","dojo/string","dojo/_base/lang","dojo/_base/array","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dgrid/Grid","./_RefreshMixin","dgrid/Selection","dgrid/extensions/Pagination","dojo/query","dojo/store/Memory","dojo/store/Cache","./PortalItemStore","dojo/store/Observable","put-selector/put","dgrid/util/mouse"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){return e([s,t],{postMixInProperties:function(){this.inherited(arguments),this._supportedViews=["gallery","details"],this._galleryTemplate=this._galleryTemplate||"<div class='itemGrid'><img alt='' src='${thumbnailUrl:_formatThumbnail}'><div class='itemTitle'>${title:_formatTitle}</div><div class='itemOwner'>${owner}</div><p class='itemText snippet' style='display:none;'>${snippet}</p></div>",this._renderers=r.mixin(this._renderers||{},{gallery:r.hitch(this,function(t){t.snippet=t.snippet||t.description||t.title||"";var r=g("div"),i=new(e([s,o,u],{templateString:n.substitute(this._galleryTemplate,t,null,this)}));return r.appendChild(i.domNode),r})})},_formatTitle:function(e){return e||(e=""),e},_formatThumbnail:function(e){return e||"resources/common/icons/browse-dialog/default.png"},buildRendering:function(){this.inherited(arguments);var t=e([a,c,l,f]),n=this.columns||{id:{label:"id"},title:{label:"title"},type:{label:"type"},modified:{label:"last modified"},snippet:{label:"snippet"}};this._view=this.view||"gallery",this._query=this.query,this._queryOptions=this.queryOptions||{sort:this.sort||[{attribute:"modified",descending:!0}]},this._store=this.store||new d(new v({portal:this.portal,galleryType:this.galleryType}),new p({data:[]})),this._rowsPerPage=this.rowsPerPage||8,this._sort=this.sort||[{attribute:"title",descending:!1}],this._pagingLinks=this.pagingLinks?3:!1,this._grid=new t({columns:n,showHeader:!1,selectionMode:"single",renderRow:this._renderers[this._view],store:this._store,query:this._query,loadingMessage:"Loading...",noDataMessage:"No results found",showLoadingMessage:!0,firstLastArrows:this._pagingLinks,previousNextArrows:this._pagingLinks,rowsPerPage:this._rowsPerPage,pagingLinks:this._pagingLinks,pagingTextBox:!0,sort:this._sort},this.domNode),this._grid.startup()},postCreate:function(){this.inherited(arguments),this.own(this._grid.on(y.enterRow,r.hitch(this,"_showSnippet",!0)),this._grid.on(y.leaveRow,r.hitch(this,"_showSnippet",!1)),this._grid.on("refresh",r.hitch(this,"_onGridRefresh")),this._grid.on(".dgrid-row:click",r.hitch(this,"_onRowClick")))},_onGridRefresh:function(e){this.emit("onRefresh",{currentPage:this._grid._currentPage}),this._pagingLinks&&(h(".dgrid-navigation")[this._grid._total<=this._grid.rowsPerPage?"addClass":"removeClass"]("hide"),h(".dgrid-pagination")[this._grid._total===0?"addClass":"removeClass"]("hide"))},_onRowClick:function(e){this.emit("onItemClick",{row:this._grid.row(e)})},_showSnippet:function(e,t){var n=this._grid.row(t);n&&(h(".itemGrid .itemTitle",n.element)[e?"addClass":"removeClass"]("hover"),h(".itemGrid .itemOwner",n.element).style("display",e?"none":""),h(".itemGrid > img",n.element).style("display",e?"none":""))},_getGridAttr:function(){return this._grid},refresh:function(){this._grid&&this._grid.set("query",this._query,this._queryOptions)},gotoPage:function(e){this._grid.query=this._query,this._grid.queryOptions=this._queryOptions,this._grid._sort=this._queryOptions.sort,this._grid.gotoPage(e)},_setViewAttr:function(e){e=i.indexOf(this._supportedViews,e)===-1?this._view:e,this._view=e,this._grid&&(this._grid.renderRow=this._renderers[e],g(this._grid.domNode,"!gallery!details."+e))},_setStoreAttr:function(e){this._store=e},_setQueryAttr:function(e,t){this._query=e||this._query,this._queryOptions=t||this._queryOptions},_setItemsAttr:function(e){this._store=this._store||new m(p({data:e})),this._store&&this._store.setData?this._store.setData(e):this._store=new m(p({data:e})),this.set("store",this._store),this.set("view",this._view)}})}),define("text!storymaps/common/builder/browse-dialog/js/templates/BrowseIdDlg.html",[],function(){return'<div class="widgetContent" >\n  <div data-dojo-type="dijit/Dialog" id="browse-id-dialog" title="${i18n.title}" execute="">\n    <div data-dojo-attach-point="formNode" class="esriItemLinks dijitDialogPaneContentArea">\n      <div id="browse-id-box" style="border:#333 1px solid; width:565px; min-height:330px; padding:0; overflow:hidden;">            \n        <div class="esriFloatLeading esriLeadingMargin1" style="width:250px; margin-top:10px;">\n          <select data-dojo-attach-point="_filterSelect"  data-dojo-type="dijit/form/Select" sortByLabel="false" maxHeight=\'350\' style="width:240px;">\n          </select>\n        </div>  \n        <div class="search esriFloatTrailing esriTrailingMargin1" style="width:250px;">\n          <div id="search-form" style="position:relative;">\n            <input class="esriSearchBox" type="text" data-dojo-type="dijit/form/TextBox" trim="true" id="browse-id-search-box" data-dojo-attach-point="searchText" data-dojo-attach-event="onKeyPress:_onSearchKeyPress,onFocus:_onSearchBoxFocus,onBlur:_onSearchBoxBlur" alt="${i18n.searchTitle}" title="${i18n.searchTitle}" placeholder="${i18n.placeholder}" />\n            <button class="esriLeadingMargin13 esriSearchButton dijitDialogCloseIcon hide" id="clear-box_submit" alt="${i18n.searchTitle}" title="searchTitle" data-dojo-attach-point="clearButton" data-dojo-attach-event="onclick:_onSearchClear" >&nbsp;&nbsp;</button>\n          </div>\n        </div>\n        <div style="position:relative; width:565px;clear:both;" data-dojo-attach-point="gallery"  id="gallery"></div>\n      </div>\n    </div>\n    <div class="submitButtons dijitDialogPaneActionBar esriPositionRight0">\n      <input data-dojo-type="dijit/form/Button" name="cancel" class="cancel esriFloatTrailing" type="button" data-dojo-attach-event="onClick:onCancel" label="${i18n.cancel}">\n      <input data-dojo-type="dijit/form/Button" name="ok" class="ok esriFloatTrailing calcite blue" type="button" data-dojo-attach-event="onClick:onClose" label="${i18n.ok}">\n    </div>\n  </div>\n</div>\n'}),define("storymaps/common/builder/browse-dialog/js/BrowseIdDlg",["require","dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/event","dojo/dom-class","dojo/keys","dijit/registry","dojo/on","dojo/i18n!commonResources/nls/webmap.js?v="+app.version,"dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","./Grid","esri/arcgis/Portal","text!./templates/BrowseIdDlg.html","dijit/Dialog","dijit/form/Select","dijit/form/Button"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){return t([l,c,h],{templateString:v,constructor:function(e){r.mixin(this,e)},postMixInProperties:function(){this.inherited(arguments),this.i18n={},this.galleryType==="webmap"?this.i18n=f.configure.mapdlg:this.i18n=f.configure.groupdlg,this.selected=null},postCreate:function(){var e=[];e.push({label:this.i18n.items.contentLabel,value:"content"},{label:this.i18n.items.organizationLabel,value:"org"},{label:app.isPortal?app.portal.name:this.i18n.items.onlineLabel,value:"online"}),this.galleryType==="webmap"&&e.push({label:this.i18n.items.favoritesLabel,value:"favorites"}),this._filterSelect.set("options",e),this._filterSelectHandler=a(this._filterSelect,"change",r.hitch(this,"doSearch"));var t={},n=this.portal.user;n.username&&(t.q="owner: "+n.username),this.galleryType==="webmap"&&(t.q+=' type:"Web Map" -type:"Web Mapping Application"'),this._grid=new p({portal:this.portal,query:t,pagingLinks:!0,galleryType:this.galleryType,view:"gallery"},"gallery"),this._grid.refresh(),a(this._grid,"onItemClick",r.hitch(this,function(e){var t=e.row;e.row.data&&e.row.data.id&&(this.selected=t.data)})),$("#dijit_form_Button_2_label, .dijitSelectLabel, .dijitButtonText, .dijitButtonContents, .dijitArrowButtonInner, .dijitArrowButtonContainer, .dijitMenuItem, .dijitMenuItemLabel").addClass("needsclick")},destroy:function(){this._filterSelectHandler.remove(),this.inherited(arguments)},doSearch:function(){var e=this._filterSelect.get("value"),t=this.portal.user,n=null,i=[];if(this.searchText.getValue()&&this.searchText.getValue().match(/^[A-Fa-f0-9]{32}$/))i.id=this.searchText.getValue();else{this.searchText.getValue()&&(n=this.searchText.getValue()),e==="org"&&(i.orgid=t.orgId),e==="content"&&(i.owner=t.username),e==="favorites"&&(i.group=t.favGroupId);if(e==="online"&&this.galleryType==="group"){var s=this.searchText.getValue();s===""&&(i.access="public")}}this.galleryType==="webmap"&&(i.type='"Web Map" -type:"Web Mapping Application"');var o="";for(var u in i){var a=i[u];o+=u+":"+a+" "}var f={};n&&(o=n+" "+o),f.q=r.trim(o),console.log(f.q),this._grid.set("query",f),this._grid.refresh()},_onSearchClear:function(e){i.stop(e),e!=null&&e.prefentDefault&&e.preventDefault(),this.searchText.setValue(""),s.add("clear-box_submit","hide"),this.doSearch()},_onSearchBoxFocus:function(e){},_onSearchBoxBlur:function(e){this.searchText.getValue()==""},_onSearchKeyPress:function(e){e.keyCode==o.ENTER&&(i.stop(e),this.doSearch()),e.keyCode==8&&this.searchText.getValue().length==1?s.add("clear-box_submit","hide"):s.remove("clear-box_submit","hide"),this.onSearchFieldKeyPress(e)},onSearchFieldKeyPress:function(e){},onClose:function(){u.byId("browse-id-dialog").hide()},onCancel:function(){this.set("selected",null),u.byId("browse-id-dialog").hide()},show:function(e){u.byId("browse-id-dialog").show(),this._grid.refresh()}})}),define("lib-build/css!storymaps/common/builder/browse-dialog/css/browse-dialog",[],function(){}),define("lib-build/css!storymaps/common/builder/browse-dialog/storymaps-override",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/map/MapConfigOverlay",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="mapConfigOverlay toc">\n	<!--\n	<div class="expandButton">\n		<span class="toc-title">\n			'+((__t=tocTitle)==null?"":__t)+'\n		</span>\n		<span class="toc-toggle"></span>\n	</div>\n	-->\n	<div class="header">'+((__t=tocTitle)==null?"":__t)+'</div>\n	<div class="explain">'+((__t=tocExplain)==null?"":__t)+'</div>\n	<div class="tocContainer"><!-- TOC is injected here --></div>\n	<div class="btns">\n		<button type="button" class="btn btn-primary save">'+((__t=tocSave)==null?"":__t)+'</button>\n		<div style="margin-top:10px">\n			<button type="button" class="btn btn-sm btn-naked reset">'+((__t=btnReset)==null?"":__t)+'</button> |\n			<button type="button" class="btn btn-sm btn-naked cancel">'+((__t=btnCancel)==null?"":__t)+'</button>\n		</div>\n	</div>\n</div>\n\n<div class="mapConfigOverlay position">\n	<div class="header">'+((__t=extentTitle)==null?"":__t)+'</div>\n	<div class="explain">'+((__t=extentExplain)==null?"":__t)+'</div>\n	<div class="btns">\n		<button type="button" class="btn btn-primary save">'+((__t=extentSave)==null?"":__t)+'</button>\n		<div style="margin-top:10px">\n			<button type="button" class="btn btn-sm btn-naked reset">'+((__t=btnReset)==null?"":__t)+'</button> |\n			<button type="button" class="btn btn-sm btn-naked cancel">'+((__t=btnCancel)==null?"":__t)+'</button>\n		</div>\n	</div>\n</div>\n\n<div class="mapConfigOverlay popup">\n	<div class="header">'+((__t=popupTitle)==null?"":__t)+'</div>\n	<div class="explain">'+((__t=popupExplain)==null?"":__t)+'</div>\n	<div class="btns">\n		<button type="button" class="btn btn-primary save">'+((__t=popupSave)==null?"":__t)+'</button>\n		<div style="margin-top:10px">\n			<button type="button" class="btn btn-sm btn-naked reset">'+((__t=btnReset)==null?"":__t)+'</button> |\n			<button type="button" class="btn btn-sm btn-naked cancel">'+((__t=btnCancel)==null?"":__t)+"</button>\n		</div>\n	</div>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/media/map/MapConfigOverlay",[],function(){}),define("text!lib-app/arcgis-dijit-table-of-contents/js/dijit/templates/TableOfContents.html",[],function(){return'<div class="${theme}" role="presentation">\n    <div class="${css.container}">\n          <div data-dojo-attach-point="_layersNode"></div>\n    </div>\n</div>'}),define("lib-app/arcgis-dijit-table-of-contents/js/TableOfContents",["dojo/Evented","dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/on","text!./dijit/templates/TableOfContents.html","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/_base/event","dojo/_base/array"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=t([s,o,e],{declaredClass:"esri.dijit.TableOfContents",templateString:a,options:{theme:"TableOfContents",map:null,layers:null,visible:!0},constructor:function(e,t){var r=n.mixin({},this.options,e);this.domNode=t,this.set("map",r.map),this.set("layers",r.layers),this.set("theme",r.theme),this.set("visible",r.visible),this.watch("theme",this._updateThemeWatch),this.watch("visible",this._visible),this.watch("layers",this._refreshLayers),this.watch("map",this.refresh),this.css={container:"toc-container",layer:"toc-layer",firstLayer:"toc-first-layer",title:"toc-title",titleContainer:"toc-title-container",content:"toc-content",titleCheckbox:"toc-checkbox",checkboxCheck:"icon-check-1",titleText:"toc-text",accountText:"toc-account",visible:"toc-visible",settingsIcon:"icon-cog",settings:"toc-settings",actions:"toc-actions",account:"toc-account",clear:"clear"}},startup:function(){this.map||(this.destroy(),console.log("TableOfContents::map required")),this.map.loaded?this._init():u.once(this.map,"load",n.hitch(this,function(){this._init()}))},destroy:function(){this._removeEvents(),this.inherited(arguments)},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},refresh:function(){this._createList()},_createList:function(){var e=this.get("layers");this._nodes=[],this._removeEvents(),this._layersNode.innerHTML="";if(e&&e.length){for(var t=0;t<e.length;t++){var n=e[t],r=n.layerObject||(n.featureCollection?n.featureCollection.layers[0].layerObject:null);if(!r)continue;var i=this.css.titleCheckbox,s=this.css.layer;t===e.length-1&&(s+=" ",s+=this.css.firstLayer),r.visible&&(s+=" ",s+=this.css.visible,i+=" ",i+=this.css.checkboxCheck);var o=c.create("div",{className:s});c.place(o,this._layersNode,"first");var u=c.create("div",{className:this.css.title});c.place(u,o,"last");var a=c.create("div",{className:this.css.titleContainer});c.place(a,u,"last");var f=c.create("div",{className:i});c.place(f,a,"last");var l=c.create("div",{className:this.css.titleText,title:n.title,innerHTML:n.title});c.place(l,a,"last");var h;n.account&&(h=c.create("a",{className:this.css.accountText,id:n.account}),c.place(h,l,"last"));var p,d;n.settings&&(p=c.create("div",{className:this.css.settings,id:n.settings}),c.place(p,a,"last"),d=c.create("div",{className:this.css.settingsIcon}),c.place(d,p,"last"));var v=c.create("div",{className:this.css.clear});c.place(v,a,"last");var m={checkbox:f,title:u,titleContainer:a,titleText:l,accountText:h,settingsIcon:d,settingsDiv:p,layer:o};this._nodes.push(m),this._checkboxEvent(t)}this._setLayerEvents()}},_refreshLayers:function(){this.refresh()},_removeEvents:function(){var e;if(this._checkEvents&&this._checkEvents.length)for(e=0;e<this._checkEvents.length;e++)this._checkEvents[e].remove();if(this._layerEvents&&this._layerEvents.length)for(e=0;e<this._layerEvents.length;e++)this._layerEvents[e].remove();this._checkEvents=[],this._layerEvents=[]},_toggleVisible:function(e,t){f.toggle(this._nodes[e].layer,this.css.visible,t),f.toggle(this._nodes[e].checkbox,this.css.checkboxCheck,t),this.emit("toggle",{index:e,visible:t})},_layerEvent:function(e,t){if(!e)return;var r=u(e,"visibility-change",n.hitch(this,function(e){this._toggleVisible(t,e.visible)}));this._layerEvents.push(r)},_featureCollectionVisible:function(e,t,n){var r,i=e.visibleLayers,s=e.featureCollection.layers;i&&i.length?r=p.every(i,function(e){return s[e].layerObject.visible===n}):r=p.every(s,function(e){return e.layerObject.visible===n}),r&&this._toggleVisible(t,n)},_createFeatureLayerEvent:function(e,t,r){var i=e.featureCollection.layers,s=u(i[r].layerObject,"visibility-change",n.hitch(this,function(n){var r=n.visible;this._featureCollectionVisible(e,t,r)}));this._layerEvents.push(s)},_featureLayerEvent:function(e,t){var n=e.featureCollection.layers;if(n&&n.length)for(var r=0;r<n.length;r++)this._createFeatureLayerEvent(e,t,r)},_setLayerEvents:function(){var e=this.get("layers"),t;if(e&&e.length)for(var n=0;n<e.length;n++){var r=e[n];r.featureCollection&&r.featureCollection.layers&&r.featureCollection.layers.length?this._featureLayerEvent(r,n):(t=r.layerObject,this._layerEvent(t,n))}},_getLayerVisibility:function(e){if(this.layers&&this.layers.length){var t=this.layers[e],n=t.layerObject,r=t.featureCollection;if(r)return visibleLayers=t.visibleLayers,visibleLayers&&visibleLayers.length?r.layers[visibleLayers[0]].layerObject.visible:r.layers[0].layerObject.visible;if(n)return t.layerObject.visible}},_toggleLayer:function(e,t){if(this.layers&&this.layers.length){var n,r=this.layers[e],i=r.layerObject,s=r.featureCollection,o,u;if(s){o=r.visibleLayers;if(o&&o.length){n=!s.layers[o[0]].layerObject.visible,n=t!==undefined?t:n;for(u=0;u<o.length;u++)i=s.layers[o[u]].layerObject,i.setVisibility(n)}else{n=!s.layers[0].layerObject.visible,n=t!==undefined?t:n;for(u=0;u<s.layers.length;u++)i=s.layers[u].layerObject,i.setVisibility(n)}}else i&&(n=!r.layerObject.visible,n=t!==undefined?t:n,i.setVisibility(n))}},_checkboxEvent:function(e){var t=function(t){if(!t.ctrlKey)this._toggleLayer(e),h.stop(t);else{var n=this.get("layers"),r=this._getLayerVisibility(e);if(n&&n.length)for(var i=0;i<n.length;i++)this._toggleLayer(i,!r);h.stop(t)}};if(!this._nodes[e])return;var r=u(this._nodes[e].checkbox,"click",n.hitch(this,t));this._checkEvents.push(r);var i=u(this._nodes[e].titleText,"click",n.hitch(this,t));this._checkEvents.push(i)},_init:function(){this._visible(),this._createList(),this.set("loaded",!0),this.emit("load",{})},_updateThemeWatch:function(){var e=arguments[1],t=arguments[2];f.remove(this.domNode,e),f.add(this.domNode,t)},_visible:function(){this.get("visible")?l.set(this.domNode,"display","block"):l.set(this.domNode,"display","none")}});return r("extend-esri")&&n.setObject("dijit.TableOfContents",d,i),d}),define("lib-build/css!lib-app/arcgis-dijit-table-of-contents/css/TableOfContents",[],function(){}),define("storymaps/common/builder/media/map/MapConfigOverlay",["lib-build/tpl!./MapConfigOverlay","lib-build/css!./MapConfigOverlay","dojo/i18n!commonResources/nls/webmap.js?v="+app.version,"dojo/i18n!commonResources/nls/media.js?v="+app.version,"lib-app/arcgis-dijit-table-of-contents/js/TableOfContents","lib-build/css!lib-app/arcgis-dijit-table-of-contents/css/TableOfContents","esri/geometry/Extent","dojo/Deferred","dojo/on","dojo/topic"],function(e,t,n,r,i,s,o,u,a,f){function C(e,t){return c=new u,h=t,m=!1,y=!1,p=app.map._params.extent,d=app.map.extent,v=t?!!t.extent:!1,g=a(app.map,"extent-change",_),f.subscribe("CORE_UPDATE_EXTENT",M),$(".mainMediaContainer.active .mapControls").addClass("hidden"),S=!1,x=app.mapItem?app.mapItem.itemData.operationalLayers:[],E=t?!!t.layers:!1,T=x?j():[],F(),v?m=JSON.stringify(app.lastExtentSet)!=JSON.stringify(t.extent):m=JSON.stringify(app.lastExtentSet)!=JSON.stringify(app.map.mapJournalInitExtent)&&JSON.stringify(app.lastExtentSet)!=JSON.stringify(p),console.log(JSON.stringify(app.lastExtentSet)!=JSON.stringify(app.map.mapJournalInitExtent),JSON.stringify(app.lastExtentSet)!=JSON.stringify(p),app.lastExtentSet,app.map.mapJournalInitExtent,p,v,E),z(e),c}function k(){$(".mainMediaContainer.active .mapControls").removeClass("hidden"),W(),g.remove();var e=j();c.resolve({extent:m?app.map.extent:null,layers:e&&e.length?e:null,popup:U()})}function L(){l.find(".position .save").click(k),l.find(".position .reset").click(A),l.find(".position .cancel").click(O),l.find(".toc .save").click(k),l.find(".toc .reset").click(P),l.find(".toc .cancel").click(H),l.find(".popup .save").click(k),l.find(".popup .reset").click(R),l.find(".popup .cancel").click(R)}function A(){app.map.setExtent(p).then(function(){m=!1})}function O(){app.ignoreNextEvent=!0,y=!0,app.map.setExtent(d).then(function(){m=v,k()})}function M(){y=!0,m=!1}function _(){y?y=!1:m=!0}function D(){b&&b.destroy();if($(".mainMediaContainer.active .mapContainer").hasClass("has-geocoder"))return}function P(){$.each(x,function(e,t){t.layerObject?t.layerObject.setVisibility(t.visibility):t.featureCollection&&$.each(t.featureCollection.layers,function(e,n){n.layerObject.setVisibility(t.visibility)})})}function H(){$.each(x,function(e,t){var n=t.layerObject||(t.featureCollection?t.featureCollection.layers[0].layerObject:null),r=$(T).filter(function(e,t){return t.id==n.id}),i=r.length?r[0].visibility:t.visibility;t.layerObject?n.setVisibility(i):$.each(t.featureCollection.layers,function(e,t){t.layerObject.setVisibility(i)})}),k()}function B(){S=j().length>0}function j(){var e=[];return $.each(x,function(t,n){var r=n.layerObject||(n.featureCollection?n.featureCollection.layers[0].layerObject:null);r&&n.visibility!=r.visible&&e.push({id:r.id,visibility:r.visible})}),e}function F(){w&&w.destroy(),l.find(".tocContainer").html('<div class="TableOfContents"></div>'),w=new i({map:app.map,layers:x},l.find(".TableOfContents")[0]),(!x||!x.length)&&l.find(".TableOfContents").html('<div style="margin-bottom: 10px;">'+n.commonWebmap.configure.tocNoData+"</div>"),a(w,"toggle",B),a(w,"load",function(){l.find(".toc-checkbox").addClass("glyphicon glyphicon-unchecked")}),w.startup()}function I(){}function q(){}function R(){app.map.infoWindow.hide(),app.map.infoWindow.clearFeatures(),k()}function U(){var e=app.map.infoWindow.getSelectedFeature();if(!e)return null;var t=e.getLayer(),n=t.fields;if(!n)return null;var r;t.objectIdField?r=[{name:t.objectIdField}]:(r=$.grep(n,function(e){return e.type=="esriFieldTypeOID"}),t&&n&&!r.length&&(r=$.grep(n,function(e){return e.name=="OBJECTID"||e.name=="FID"}),r.length||(r=$.grep(n,function(e){return e.type=="esriFieldTypeInteger"}))));if(r.length){var i=r[0].name;return{layerId:t.id,fieldName:i,fieldValue:e.attributes[i],anchorPoint:app.map.infoWindow.location.toJson()}}return null}function z(e){$("body").addClass("has-builder-mask"),$(".panelEditBtn").fadeOut(),e=="LOCATION"?(l.find(".mapConfigOverlay.position").show(),D()):e=="CONTENT"?l.find(".mapConfigOverlay.toc").show():e=="POPUP"&&(l.find(".mapConfigOverlay.popup").show(),N=[app.map.infoWindow.on("show",I),app.map.infoWindow.on("hide",q)]),e!="LOCATION"&&(app.map.disableMapNavigation(),$(app.map.__container).parent().find(".esriSimpleSliderTL").hide())}function W(){$("body").removeClass("has-builder-mask"),$(".panelEditBtn").fadeIn(),l.find(".mapConfigOverlay").hide(),app.map.enableMapNavigation(),$(app.map.__container).parent().find(".esriSimpleSliderTL").show(),$(".mainMediaContainer.active .geocoder").hide(),N&&(N[0].remove(),N[1].remove(),N=null)}var l=$("#mainStagePanel"),c=null,h=null,p=null,d=null,v=null,m=null,g=null,y=null,b=null,w=null,E=null,S=null,x=null,T=null,N=null;return l.append(e({btnReset:n.commonWebmap.configure.btnReset,btnCancel:n.commonWebmap.configure.btnCancel,tocTitle:n.commonWebmap.configure.tocTitle,tocExplain:n.commonWebmap.configure.tocExplain+" "+n.commonWebmap.configure.hintNavigation,tocSave:n.commonWebmap.configure.tocSave,tocHint:n.commonWebmap.configure.hintNavigation,extentTitle:n.commonWebmap.configure.extentTitle,extentExplain:n.commonWebmap.configure.extentExplain,extentSave:n.commonWebmap.configure.extentSave,popupTitle:n.commonWebmap.configure.popupTitle,popupExplain:n.commonWebmap.configure.popupExplain+" "+n.commonWebmap.configure.hintNavigation,popupSave:n.commonWebmap.configure.popupSave})),L(),{present:C}}),define("storymaps/common/builder/media/map/MapViewerWrapperUtils",["esri/arcgis/utils"],function(e){return{isWhiteListedDomain:function(){return document.location.host.match(/\.esri\.com$/)||document.location.host.match(/\.arcgis\.com$/)},getMapViewerLink:function(e){return this.getMapViewerURL()+"?webmap="+e},getMapViewerURL:function(){return this.getPortalURL()+"/home/webmap/viewer.html"},getPortalURL:function(){var t=e.arcgisUrl.split("/sharing/")[0];return app.portal.allSSL&&(t=t.replace("http:","https:")),t},getPortalDomain:function(){var e=document.createElement("a");return e.setAttribute("href",this.getPortalURL()),e.protocol+"//"+e.hostname},viewerIsSameDomain:function(){var e=this.getPortalURL().split("//").slice(-1)[0],t=e.split("."),n=document.location.host,r=n.split(".");return e==n||e.split("/").length>1&&e.split("/")[0]==n?!0:r.length<3?n==e:r.slice(1).join(".")==t.slice(-2).join(".")}}}),define("lib-build/tpl!storymaps/common/builder/media/map/ErrorDialog",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\n	<div class="modal-content">\n		<div class="modal-logo"></div>\n		<div class="modal-header">\n			<h4 class="modal-title"></h4>\n		</div>\n\n		<div class="modal-body">\n			<div class="error-msg"></div>\n		</div>\n\n		<div class="modal-footer">\n		<span class="error"></span>\n			<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal">'+((__t=btnClose)==null?"":__t)+"</button>\n		</div>\n	</div>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/media/map/ErrorDialog",[],function(){}),define("storymaps/common/builder/media/map/ErrorDialog",["lib-build/tpl!./ErrorDialog","lib-build/css!./ErrorDialog","dojo/topic"],function(e,t,n){return function(r){function i(){r.on("show.bs.modal",function(){$("#addEditPopup .backdrop").show()}),r.on("hide.bs.modal",function(){$("#addEditPopup .backdrop").hide()})}r.html(e({btnClose:i18n.commonCore.common.close})),i(),this.present=function(e){var t="";r.find(".modal-title").html(e.newMap?i18n.commonWebmap.editor.newTitle:i18n.commonWebmap.editor.editTitle),e.error=="DOMAIN"?t+=i18n.commonWebmap.editor.notavailable2.replace("%PRODUCT%",e.isPortal?"Portal for ArcGIS":"ArcGIS Online"):e.error=="PORTAL"?t+=i18n.commonWebmap.editor.notavailable3:e.error=="DEV_TOKEN"?t+="Sorry, creating or editing a map in development mode require some extra configuration.":e.error=="DEV_FAIL"&&(t+="Sorry, creating or editing a map is not supported in development environment."),e.error!="DEV_FAIL"&&e.error!="TOUCH_ONLY"&&(t+="<br /><br />"),e.error=="DEV_TOKEN"?t+="To enable the map editor, please read the instructions in <i>app/storymaps/common/builder/media/map/MapViewerWrapper.js</i>.":e.error=="DEV_FAIL"?t+="":e.newMap?t+=i18n.commonWebmap.editor.notavailable4.replace("%MV%",'<a href="'+e.url+'" target="_blank">'+i18n.commonWebmap.editor.notavailable6+"</a>"):t+=i18n.commonWebmap.editor.notavailable5.replace("%MV%",'<a href="'+e.url+'" target="_blank">'+i18n.commonWebmap.editor.notavailable6+"</a>").replace("%apply%",'<a class="map-reload">'+i18n.commonWebmap.editor.notavailable7+"</a>"),r.find(".error-msg").html(t),r.find(".map-reload").click(function(){n.publish("ADDEDIT_RELOAD_CURRENT_WEBMAP")}),r.modal({keyboard:!0})}}}),define("storymaps/common/builder/media/map/WebMapSelector",["lib-build/tpl!./WebMapSelector","lib-build/css!./WebMapSelector","../../browse-dialog/js/BrowseIdDlg","lib-build/css!../../browse-dialog/css/browse-dialog","lib-build/css!../../browse-dialog/storymaps-override","./MapConfigOverlay","./MapViewerWrapperUtils","./ErrorDialog","esri/geometry/Extent","dojo/Deferred","dojo/topic","dijit/registry","dojo/on","dojo/_base/lang","dojo/has"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){return function(r,i,a,f){function w(e,t){r.find(".webmaps-list").empty();var n=app.appCfg.mapsUseTermSection?i18n.commonWebmap.selector.sections:i18n.commonWebmap.selector.entries,i=app.appCfg.mapsUseTermSection?i18n.commonWebmap.selector.section:i18n.commonWebmap.selector.entry;$.each(t,function(e,t){var r=t.title||'<span class="smallLoader titleLoader"></span><span style="text-transform: uppercase">'+i18n.commonWebmap.selector.loadingTitle+"</span>",s=t.sharing?t.sharing:'<span class="smallLoader"></span>',o="";t.entries&&t.entries.length&&(t.entries.length==1?o+=i+" "+t.entries[0]:o+=n+" "+t.entries.join(", ")),t.actions&&t.actions.length&&(o+=o?" "+i18n.commonWebmap.selector.and+" ":"",t.actions.length==1?o+=i18n.commonWebmap.selector.action.toLowerCase()+" "+t.actions[0]:o+=i18n.commonWebmap.selector.actions.toLowerCase()+" "+t.actions.join(", ")),!t.entries&&!t.actions&&(o=i18n.commonWebmap.selector.originalWebmap.replace("%TPL_NAME%",app.cfg.TPL_NAME)),E("",t.id,r,o,s)}),E("action-btn browse-webmap","",i18n.commonWebmap.selector.browseMaps,""),E("action-btn create-webmap","",i18n.commonWebmap.selector.createMap,""),e?(r.find(".webmaps-list-btn-inner").data("webmap",e).html('<span class="title">'+app.data.getWebmapTitle(e)+'</span><span class="info">'+i18n.commonWebmap.selector.current+"</span>"),r.find(".selected-map-sharing-status").html(app.data.getWebmapSharing(e))):r.find(".webmaps-list-btn-inner").html(i18n.commonWebmap.selector.select),r.find(".selected-map-edit").toggle(!!e),r.find(".webmaps-list li:not(.action-btn) a").click(function(){r.find(".webmaps-list-btn-inner").data("webmap",$(this).find(".webmap-entry").data("webmap")).html($(this).find(".title").eq(0).clone()),r.find(".selected-map-sharing-status").html($(this).find(".sharing-status").html()),r.find(".map-cfg-row").fadeIn(),_(),y={}}),r.find(".browse-webmap a").click(function(){g.show()}),r.find(".create-webmap a").click(A)}function E(e,t,n,i,s){r.find(".webmaps-list").append('<li class="'+e+'">'+'<a data-href="#">'+'<span class="webmap-entry" data-webmap="'+t+'">'+'<span class="title">'+n+"</span>"+'<span class="info">'+i+"</span>"+(s?'<span class="sharing-status">'+s+"</span>":"")+"</span>"+"</a>"+"</li>")}function S(e){var t=r.find('.webmaps-list .webmap-entry[data-webmap="'+e.id+'"]');t.find(".title").html(e.title),t.find(".sharing-status").html(e.sharing)}function x(){g=new n({portal:app.portal,galleryType:"webmap"}),h(g._grid,"onItemClick",function(){g.onClose()}),h(g,"close",function(){g.get("selected")&&T(g.get("selected").id,g.get("selected").title,!1)})}function T(e,t,n){var i=n?i18n.commonWebmap.selector.newCreatedMap:i18n.commonWebmap.selector.newMap;r.find(".webmaps-list-btn-inner").data("webmap",e).html('<span class="title">'+t+"</span>"+'<span class="info">'+i+"</span>"),r.find(".selected-map-edit").toggle(!0),y={},_(),f&&f({newMedia:{type:"webmap",webmap:{id:e,title:t}}}),v.postDisplay()}function N(){r.find(".help").tooltip({trigger:"hover"}),l.subscribe("LOADED_WEBMAP_INFOS",S),r.find(".map-cfg-row .btn-group .btn").click(function(){$(this).parent().find(".btn").removeClass("btn-primary"),$(this).addClass("btn-primary")}),r.find('.map-cfg-location .btn[data-value="custom"]').click(function(){D("LOCATION")}),r.find('.map-cfg-content .btn[data-value="custom"]').click(function(){D("CONTENT")}),r.find('.map-cfg-popup .btn[data-value="custom"]').click(function(){D("POPUP")}),r.find(".selected-map-edit").click(O)}function C(){return r.find(".webmaps-list-btn-inner").data("webmap")}function k(){var e=C();return e&&e.match(/^[A-Fa-f0-9]{32}$/)}function L(){return m.media&&m.media.webmap&&m.media.webmap.id==C()}function A(){M()?b.present({newMap:!0,error:"TOUCH_ONLY",url:o.getMapViewerURL(),isPortal:app.isPortal}):!app.isPortal&&!o.isWhiteListedDomain()&&app.isProduction?b.present({newMap:!0,error:"DOMAIN",url:o.getMapViewerURL(),isPortal:app.isPortal}):app.isPortal&&!o.viewerIsSameDomain()&&app.isProduction?b.present({newMap:!0,error:"DOMAIN",url:o.getMapViewerURL(),isPortal:app.isPortal}):app.isPortal&&!app.portal.hasMyStories?b.present({newMap:!0,error:"PORTAL",url:o.getMapViewerURL(),isPortal:app.isPortal}):app.builder.openMapViewer({newMap:!0,title:app.builder.getAddEditEntryTitle()}).then(function(e){e.newMap&&T(e.newMapInfos.id,e.newMapInfos.title,!0)},function(e){(e=="DEV_TOKEN"||e=="DEV_FAIL")&&b.present({newMap:!0,error:e})})}function O(){M()?b.present({newMap:!1,error:"TOUCH_ONLY",url:o.getMapViewerLink(C()),isPortal:app.isPortal}):!app.isPortal&&!o.isWhiteListedDomain()&&app.isProduction?b.present({newMap:!1,error:"DOMAIN",url:o.getMapViewerLink(C()),isPortal:app.isPortal}):app.isPortal&&!o.viewerIsSameDomain()&&app.isProduction?b.present({newMap:!1,error:"DOMAIN",url:o.getMapViewerLink(C()),isPortal:app.isPortal}):app.isPortal&&!app.portal.hasMyStories?b.present({newMap:!1,error:"PORTAL",url:o.getMapViewerLink(C()),isPortal:app.isPortal}):app.builder.openMapViewer({id:C()}).then(function(e){e.newMap&&T(e.newMapInfos.id,e.newMapInfos.title,!0)},function(e){(e=="DEV_TOKEN"||e=="DEV_FAIL")&&b.present({newMap:!1,error:e})})}function M(){return d("touch")&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(navigator.userAgent)}function _(e,t,n){var i=e||!!y.extent,s=t||!!y.layers,o=n||!!y.popup;r.find('.map-cfg .map-cfg-location .btn[data-value="default"]').toggleClass("btn-primary",!i),r.find('.map-cfg .map-cfg-location .btn[data-value="custom"]').toggleClass("btn-primary",i),r.find('.map-cfg .map-cfg-content .btn[data-value="default"]').toggleClass("btn-primary",!s),r.find('.map-cfg .map-cfg-content .btn[data-value="custom"]').toggleClass("btn-primary",s),r.find('.map-cfg .map-cfg-popup .btn[data-value="default"]').toggleClass("btn-primary",!o),r.find('.map-cfg .map-cfg-popup .btn[data-value="custom"]').toggleClass("btn-primary",o),C()&&r.find(".map-cfg-row").show(),f&&f()}function D(e){var t=C();r.find(".map-cfg").addClass("disabled"),r.find(".map-cfg-info").hide().addClass("disabled"),r.find(".webmap-loading").show().html(i18n.commonCore.common.loading+"...");if(!t)return;if(L())P(e,y);else if($.inArray(t,m.webmaps)!=-1){var n=l.subscribe("ADDEDIT_WEBMAP_DONE",function(){n.remove(),P(e)});l.publish("ADDEDIT_SHOW_WEBMAP",t)}else{var i,s;i=l.subscribe("ADDEDIT_WEBMAP_DONE",function(){i.remove(),s.remove(),P(e)}),s=l.subscribe("ADDEDIT_LOAD_WEBMAP_FAIL",function(){i.remove(),s.remove(),_(),r.find(".webmap-loading").show().html('<div class="error">'+i18n.viewer.errors.mapLoadingFail+"</div>"),setTimeout(function(){r.find(".webmap-loading").hide(),r.find(".map-cfg").removeClass("disabled")},3e3)}),l.publish("ADDEDIT_LOAD_WEBMAP",t)}}function P(e,t){i(),s.present(e,t||{}).then(function(t){e=="LOCATION"?y.extent=t.extent?t.extent.toJson():null:e=="CONTENT"?y.layers=t.layers:e=="POPUP"&&(y.popup=t.popup),_(),a(),r.find(".webmap-loading").hide(),r.find(".map-cfg").removeClass("disabled")})}var v=this,m=null,g=null,y=null,b=new u($("#mapErrorDialog"));r.append(e({lblWebmap:i18n.commonWebmap.selector.lblWebMap,lblEdit:i18n.commonCore.common.edit,lblLocation:i18n.commonWebmap.selector.lblLocation,lblContent:i18n.commonWebmap.selector.lblContent,lblPopup:i18n.commonWebmap.selector.lblPopup,lblControls:i18n.commonWebmap.selector.lblControls,lblOverview:i18n.commonWebmap.selector.lblOverview,lblLegend:i18n.commonWebmap.selector.lblLegend,webmapDefault:i18n.commonWebmap.selector.webmapDefault,customCfg:i18n.commonWebmap.selector.customCfg,tooltipLocation:i18n.commonWebmap.selector.tooltipLocation,tooltipContent:i18n.commonWebmap.selector.tooltipContent,tooltipPopup:i18n.commonWebmap.selector.tooltipPopup,tooltipOverview:i18n.commonWebmap.selector.tooltipOverview,tooltipLegend:i18n.commonWebmap.selector.tooltipLegend,mapCfgInvite:i18n.commonWebmap.selector.mapCfgInvite,lblLocationAlt:i18n.commonWebmap.selector.lblLocationAlt,tooltipLocationAlt:i18n.commonWebmap.selector.tooltipLocationAlt})),N(),this.present=function(e){var t=e.media&&e.media.type=="webmap";e.options=e.options||{},m=e,y={},t&&(y={extent:e.media.webmap.extent,layers:e.media.webmap.layers,popup:e.media.webmap.popup,legend:e.media.webmap.legend,overview:e.media.webmap.overview},e.mode=="add"&&(y.extent=app.map?app.map.extent.toJson():null)),r.find(".webmaps-list-btn-inner").data("webmap",""),r.find(".selected-map-sharing-status").html(""),w(t?e.media.webmap.id:"",e.webmaps),r.find(".map-cfg-row").toggle(!!t&&app.data.getStoryLength()!==0);var n=!0;e.options.mapsSyncAppOption&&(n=e.options.showLocationControl),r.find(".map-cfg-location .regular-control").toggle(n),r.find(".map-cfg-location .inherit-alt").toggle(!n);var i=!1,s=!1;t&&(i=e.media.webmap.overview?e.media.webmap.overview.enable:!1,s=e.media.webmap.legend?e.media.webmap.legend.enable:!1),r.find(".opt-checkbox-overview").prop("checked",i),r.find(".opt-checkbox-legend").prop("checked",s),r.find(".map-cfg-controls-overview").toggle(!e.options.hideOverview),r.find(".lbl-configure").html(i18n.commonWebmap.selector.btnConfigure);var o=null,u=null,a=null;m.mode=="edit"&&L()&&(o=!!m.media.webmap.extent,u=!!m.media.webmap.layers,a=!!m.media.webmap.popup),r.find(".map-cfg-controls").toggleClass("disable",!!m.disableMapExtras),_(o,u,a),c.byId("browse-id-dialog")&&(c.byId("browse-id-dialog").destroy(),c.byId("browse-id-search-box").destroy(),c.byId("gallery")&&c.byId("gallery").destroy(),g=null),x(),this.postDisplay()},this.checkError=function(){var e=!k();return r.find(".webmapIdFieldContainer").toggleClass("has-feedback has-error",e),e},this.getData=function(){var e=null,t=C(),n=r.find('.map-cfg .map-cfg-location .btn[data-value="custom"]').hasClass("btn-primary"),i=r.find('.map-cfg .map-cfg-content .btn[data-value="custom"]').hasClass("btn-primary"),s=r.find('.map-cfg .map-cfg-popup .btn[data-value="custom"]').hasClass("btn-primary");return k()?(e={id:t,extent:n&&y?y.extent:null,layers:i&&y?y.layers:null,popup:s&&y?y.popup:null,legend:{enable:r.find(".opt-checkbox-legend").prop("checked"),openByDefault:y&&y.legend?y.legend.openByDefault:!1}},m.options.hideOverview||p.mixin(e,{overview:{enable:r.find(".opt-checkbox-overview").prop("checked"),openByDefault:y&&y.overview?y.overview.openByDefault:!0}}),e):null},this.activate=function(){v.postDisplay()},this.postDisplay=function(){if(r.find(".webmapSelector").width()===0)return;r.find(".selected-map-edit-container").css("width",r.find(".selected-map-edit").width())}}}),define("lib-build/tpl!storymaps/common/builder/media/image/Selector",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="imageSelector">\n	<div class="selectorView viewHomeContainer"></div>\n  <div class="selectorView viewUploadContainer"></div>\n	<div class="selectorView viewFlickrContainer"></div>\n	<div class="selectorView viewPicasaContainer"></div>\n	<div class="selectorView mediaSelectorPickerContainer"></div>\n	<div class="selectorView mediaSelectorConfigureContainer"></div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/media/image/Selector",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/image/ViewHome",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="imageSelectorHome">\n	<table class="imageSelectorTable">\n		<tr>\n			<td class="btn-container btn-select-upload ',disableImageUpload&&(__p+=" disabled "),__p+='">\n				<span class="fa fa-upload"></span>\n				<span class="title">'+((__t=lblUpload)==null?"":__t)+'</span>\n			</td>\n			<td class="btn-container btn-select-flickr">\n				<span class="fa fa-flickr"></span>\n				<span class="title">Flickr</span>\n			</td>\n			<td class="btn-container btn-select-picasa">\n				<span class="fa fa-google"></span>\n				<span class="title">Google+</span>\n			</td>\n			<td class="btn-container btn-select-url">\n				<span class="fa fa-link"></span>\n				<span class="title">'+((__t=lblLink)==null?"":__t)+'</span>\n			</td>\n		</tr>\n	</table>\n</div>\n<div class="facebook-warning"></div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/media/image/ViewHome",[],function(){}),define("storymaps/common/builder/media/image/ViewHome",["lib-build/tpl!./ViewHome","lib-build/css!./ViewHome","storymaps/common/utils/CommonHelper","dojo/has"],function(e,t,n,r){return function(i,s){function u(){i.find(".btn-select-upload").click(function(){s("upload")}),i.find(".btn-select-flickr").click(function(){s("flickr")}),i.find(".btn-select-picasa").click(function(){s("picasa")}),i.find(".btn-select-url").click(function(){var e=o?o:{};app.appCfg.mediaPickerConfigureForceMode!="shortlist"&&(e.fromService=!1),e.mode="showURL",e.media||(e.media={}),e.media.type="image",e.media.image=e.media.image?e.media.image:{},s("configure",e)}),app.cfg.AUTHORIZED_IMPORT_SOURCE.flickr||i.find(".btn-select-flickr").addClass("disabled").unbind("click"),app.cfg.AUTHORIZED_IMPORT_SOURCE.picasa||i.find(".btn-select-picasa").addClass("disabled").unbind("click"),!r("touch")&&!app.cfg.AUTHORIZED_IMPORT_SOURCE.flickr&&i.find(".btn-select-flickr").tooltip({trigger:"hover",placement:"top",html:!0,title:i18n.commonCore.common.disabledAdmin,container:"body"}),!r("touch")&&!app.cfg.AUTHORIZED_IMPORT_SOURCE.picasa&&i.find(".btn-select-picasa").tooltip({trigger:"hover",placement:"top",html:!0,title:i18n.commonCore.common.disabledAdmin,container:"body"}),app.appCfg.disableFBWarning||i.find(".facebook-warning").html(i18n.commonMedia.imageSelectorFacebook.warning.replace("${learn}",'<a href="http://links.esri.com/storymaps/facebook_support" target="_blank">'+i18n.commonMedia.imageSelectorFacebook.learn+"</a>"))}var o=null;i.append(e({disableImageUpload:app.appCfg.disableImageUpload,lblUpload:i18n.commonMedia.mediaSelector.lblUpload,lblLink:i18n.commonMedia.mediaSelector.lblLink})),u(),this.present=function(e){$.isEmptyObject(e.media)||(o=e),i.find(".imageSelectorHome").toggleClass("two-choices",e.mode=="import"),i.find(".btn-select-url").toggle(e.mode!="import"),i.find(".btn-select-upload").toggle(n.getItemId()||app.isDirectCreationFirstSave?!0:!1),app.appCfg.disableImageImportUpload&&e.mode=="import"&&i.find(".btn-select-upload").toggle(!1),i.show()},this.updateParams=function(e){o=e}}}),define("lib-build/tpl!storymaps/common/builder/media/image/ViewUpload",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="imageSelectorUpload drag-area drag-default uploader">\n  <div class="header">\n    <div>\n      <span class="drop-label">'+((__t=lblDrop)==null?"":__t)+'</span>\n      <!-- this used to be a button, but firefox wouldn\'t open\n        a file-input nested inside a button -->\n      <div class="btn btn-sm btn-default btn-file">\n        <span class="">'+((__t=lblUploadButton)==null?"":__t)+'</span>\n        <input class="file-input" type="file" accept=".png,.jpeg,.jpg,.gif,.bmp"></input>\n      </div>\n      <span class="uploadHelp fa fa-info-circle" data-toggle="tooltip" data-title="'+((__t=infoUpload)==null?"":__t)+'"></span>\n      <span class="uploadWait smallLoader hidden"></span>\n    </div>\n    <div class="info-text warning-text"></div>\n  </div>\n  <div class="resources"></div>\n</div>\n';return __p}}),define("lib-build/tpl!storymaps/common/builder/media/image/ViewResourceItem",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="resource-item '+((__t=usedClass)==null?"":__t)+'">\n  <div class="img-wrapper">\n    <img src="'+((__t=tokenizedThumbUrl||picUrl)==null?"":__t)+'" />\n  </div>\n  <div class="title">'+((__t=displayName)==null?"":__t)+"</div>\n  ",usedClass&&(__p+='\n    <span class="remove floating-btn">\n      <span class="fa fa-trash"></span>\n    </span>\n  '),__p+="\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/media/image/ViewUpload",[],function(){}),define("storymaps/common/builder/media/image/ViewUpload",["dojo/_base/declare","dojo/_base/lang","dojo/topic","./FileUploadHelper","storymaps/common/utils/CommonHelper","lib-build/tpl!./ViewUpload","lib-build/tpl!./ViewResourceItem","lib-build/css!./ViewUpload"],function(e,t,n,r,i,s,o){return e([],{uploadEnabled:!1,dragging:!1,fileError:!1,canCheckFileOnDrag:!1,hasDnD:!1,constructor:function(e,t,n,r){this.showView=t,n=n?n:null,r=r?r:null,this.setupUI(e,n,r)},present:function(){this.uploadEnabled?this.showAppResources():this.setupUI(this.container),this.container.show(),this.toggleLoadingIndicator(!1)},setupUI:function(e,t,n){this.container=e;if(!this.uploadEnabled&&!i.getItemId())return;t||this.container.html(s(i18n.commonMedia.imageSelectorUpload)),this.uploader=this.container.find(".uploader"),this.fileInput=this.container.find(".file-input"),this.resourcesContainer=this.container.find(".resources"),this.warningText=this.container.find(".warning-text"),this.container.find(".uploadHelp").tooltip({trigger:"hover"}),n||this.showAppResources(),this.uploadEnabled=!0,this.setupDnD()},setupDnD:function(){this.hasDnD=r.checkDnD(),this.hasDnD&&(r.disableWindowDnD(),this.uploader.on("dragover",t.hitch(this,this.onDragOver)),this.uploader.on("dragleave",t.hitch(this,this.onDragLeave)),this.uploader.on("drop",t.hitch(this,this.onDrop))),this.fileInput.on("change",t.hitch(this,this.onFileChange))},showAppResources:function(){var e=this;r.getStoryResources().then(function(n){var i=app.data.getAllImageUrls(),s=_.map(i,function(e){return r.getFileIdFromUrl(e).toLowerCase()});e.resourcesContainer.empty(),_.each(n,function(n){var r=_.contains(s,n.fileId.toLowerCase());n.usedClass=r?"":"unused",n.tokenizedThumbUrl=e.getTokenizedThumbUrl(n);var i=$(o(n));i.on("click",t.hitch(e,e.selectImage,n)),i.find(".remove").on("click",t.hitch(e,e.removeResource,n)),i.on("dragstart",function(){return!1}),e.resourcesContainer.append(i)}),e.container.find(".tooltip").tooltip("hide"),e.resourcesContainer.find(".remove").tooltip({html:!0,trigger:"hover",container:e.container,placement:"left",title:i18n.commonMedia.imageSelectorUpload.tooltipRemove,delay:{show:500,hide:200}})})},getTokenizedThumbUrl:function(e){var t;return e.thumbFile?t=e.thumbFile:e.file?t=e.file:e.sizes&&(t=_.min(e.sizes,"width").name),t||console.warn("no thumbFile?",e),i.possiblyAddToken(e.resourcesUrl+"/"+encodeURIComponent(t))},onDragOver:function(e){r.preventAndStopEvent(e);if(this.dragging)return;this.dragging=!0,e=e.originalEvent||e;var t=e.dataTransfer,n;t&&(t.files&&t.files.length?n=this.getDragClassAndMsg(t.files):t.items&&t.items.length&&(n=this.getDragClassAndMsg(t.items))),this.setUploaderTimerOrClass(n)},getDragClassAndMsg:function(e){var t=r.validateTypeOnDrag(e);return t?t&&e.length>1?{dragClass:"drag-warning",msg:i18n.commonMedia.imageSelectorUpload.warningOneFile}:{dragClass:"drag-success"}:{dragClass:"drag-error",msg:i18n.commonMedia.imageSelectorUpload.warningFileTypes}},onDragLeave:function(e){r.preventAndStopEvent(e),this.dragging=!1,this.setUploaderClass()},onDrop:function(e){this.dragging=!1,this.setUploaderClass();var t=r.findFilesFromDrop(e);t&&(r.preventAndStopEvent(e),this.onFileChange(t))},getEXIF:function(e,t){var n=new FileReader;n.onload=function(e){return t(e.target.result)},n.readAsArrayBuffer(e)},onFileChange:function(e){var t=e.target?e.target.files:e;if(!t||!t.length)return;var n=t[0];this.processFile(n)},processFile:function(e){if(!r.validateFile(e)){this.setUploaderTimerOrClass({dragClass:"drag-error",msg:i18n.commonMedia.imageSelectorUpload.warningFileTypes});return}this.toggleLoadingIndicator(!0),this.setUploaderClass();var n=r.getUploadBaseName(e,0);app.appCfg.useImageEXIF&&window.EXIF&&this.getEXIF(e,function(t){var n,r,s=window.EXIF.readFromBinaryFile(t);s.GPSLatitude&&s.GPSLatitude[0]&&(n=i.convertToDegrees(s.GPSLatitude),s.GPSLatitudeRef=="S"&&(n=-Math.abs(n)),e.lat=n),s.GPSLatitude&&s.GPSLongitude[0]&&(r=i.convertToDegrees(s.GPSLongitude),s.GPSLongitudeRef=="W"&&(r=-Math.abs(r)),e.lng=r)}),r.processFile(e,!0).then(t.hitch(this,function(t){_.extend(t,{baseName:n}),app.appCfg.useImageEXIF&&(e.lat&&_.extend(t,{lat:e.lat}),e.lng&&_.extend(t,{lng:e.lng})),this.uploadFile(t)}),t.hitch(this,function(e){this.toggleLoadingIndicator(!1),console.warn("errback",e);var t;e.reason==="filesize"&&(t=i18n.commonMedia.imageSelectorUpload.warningFileSize),this.setUploaderTimerOrClass({dragClass:"drag-error",msg:t})}))},toggleLoadingIndicator:function(e){this.container.find(".uploadWait").toggleClass("hidden",!e)},uploadFile:function(e){r.uploadSingleResource(e).then(t.hitch(this,function(t){t.name=t.displayName||e.baseName,e.lat&&(t.lat=e.lat),e.lng&&(t.lng=e.lng);var r=new Image;r.src=i.possiblyAddToken(t.picUrl||t.sizes[0].url),this.toggleLoadingIndicator(!1);if(app.appCfg.mediaPickerSkipConfigure){n.publish("IMAGEUPLOADED",t);return}this.showView("configure",{media:t,fromService:!0})}))},setUploaderTimerOrClass:function(e){e.dragClass&&e.dragClass.indexOf("error")>=0||e.dragClass.indexOf("warning")>=0?(this.setUploaderClass(e.dragClass),this.setWarningText(e.msg),setTimeout(t.hitch(this,function(){this.dragging||(this.setUploaderClass(),this.setWarningText())}),3e3)):this.setUploaderClass(e.dragClass)},setWarningText:function(e){e=e||"",this.warningText.text(e)},setUploaderClass:function(e){if(!e){this.setWarningText();if(this.uploader.hasClass("drag-default"))return}this.uploader.removeClass("drag-default drag-error drag-warning drag-success").addClass(e||"drag-default")},removeResource:function(e,n){r.preventAndStopEvent(n),r.removeResources(e).then(t.hitch(this,this.showAppResources))},selectImage:function(e){_.extend(e,{name:e.displayName}),this.showView("configure",{media:e,fromService:!0})}})}),define("lib-build/tpl!storymaps/common/builder/media/image/ViewFlickr",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="imageSelectorFlickr">\n	<form class="form-inline" role="form" onsubmit="return false;">\n		<div class="form-group">\n			<span class="icon fa fa-flickr"></span>\n			<span class="title">Flickr</span>\n			<input type="text" class="form-control userName" value="" placeholder="'+((__t=fieldUserName)==null?"":__t)+'"/>\n		</div>\n		<button class="btn btn-primary btn-userLogin">'+((__t=btnSearch)==null?"":__t)+'</button>\n		<span class="loadingMsg"></span>\n	</form>\n	<div class="errorMsg"></div>\n	<div class="sets"></div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/media/image/ViewFlickr",[],function(){}),define("storymaps/common/utils/connector/Flickr",["dojo/Deferred","dojo/_base/lang"],function(e,t){return function(r){function s(){return l("flickr.tags.getListUser",{user_id:i})}function o(){return l("flickr.photosets.getList",{user_id:i})}function u(n,r){var s=new e;r.photoSize=r.photoSize||"b",r.thumbSize=r.thumbSize||"m";var o=t.mixin({extras:"geo,description"},{user_id:i},r);return l(n,o).done(function(e){(!e||e.stat!="ok")&&s.reject();var t=[],n=[];e.photos?n=e.photos.photo:e.photoset&&(n=e.photoset.photo),$.each(n,function(e,n){t.push({name:n.title||"",description:n.description?n.description._content||"":"",pic_url:f(n,r.photoSize),thumb_url:f(n,r.thumbSize),lat:n.latitude||"",lng:n.longitude||"",is_video:!1})}),s.resolve(t)}),s}function a(e){return $.each(e,function(e,t){t._thumbnail="https://farm2.static.flickr.com/"+t.server+"/"+t.primary+"_"+t.secret+"_s"+".jpg"}),e}function f(e,t){return"https://farm"+e.farm+".static.flickr.com/"+e.server+"/"+e.id+"_"+e.secret+"_"+t+".jpg"}function l(e,t){var n="https://api.flickr.com/services/rest/?method="+e+"&format=json"+"&api_key="+r+(t?"&"+$.param(t):"")+"&jsoncallback=?";return $.getJSON(n)}var i=null;if(!r){console.error("Flickr initialization error - missing apiKey parameter");return}this.connect=function(t,n,r){var u=new e;return n=n===!1?!1:!0,r=r===!1?!1:!0,l("flickr.people.findByUsername",{username:t}).done(function(e){e&&e.stat=="ok"?(i=e.user.id,n&&r?$.when(s(),o()).done(function(e,t){u.resolve({tags:e[0].who.tags.tag,sets:a(t[0].photosets.photoset)})}):n?o().then(function(e){u.resolve({sets:a(e.photosets.photoset)})}):r?s().then(function(e){u.resolve({tags:e.who.tags.tag})}):u.resolve({})):u.reject()}),u},this.getPicturesInSet=function(e,n){return u("flickr.photosets.getPhotos",t.mixin({photoset_id:e},n))},this.getPicturesByTag=function(e,n){return u("flickr.photos.search",t.mixin({tags:e},n))}}}),define("lib-build/tpl!storymaps/common/builder/media/image/ViewFlickrSet",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="set" data-id="'+((__t=id)==null?"":__t)+'" style="'+((__t=style)==null?"":__t)+'">\n	<img src="'+((__t=thumb)==null?"":__t)+'" />\n	<div>'+((__t=title)==null?"":__t)+" ("+((__t=nb)==null?"":__t)+")</div>\n</div>\n";return __p}}),define("storymaps/common/builder/media/image/ViewFlickr",["lib-build/tpl!./ViewFlickr","lib-build/css!./ViewFlickr","storymaps/common/utils/connector/Flickr","lib-build/tpl!./ViewFlickrSet"],function(e,t,n,r){return function(i,s){function u(){var e=i.find(".userName").val(),t=i.parents(".smallSize").length?3:4;f(),o.connect(e,!0,!1).then(function(e){var n="";if(!e||!e.sets||!e.sets.length){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.mediaSelector.noData);return}$.each(e.sets,function(e,i){n+=r({id:i.id,thumb:i._thumbnail,title:i.title._content,nb:i.photos,style:e%t===0?"clear:both":""})}),i.find(".sets").removeClass("disabled").show().html(n),i.find(".sets").off("click").click(a),i.find(".loadingMsg").html('<span class="glyphicon glyphicon-ok"></span>')},function(){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.imageSelectorFlickr.signInMsg2)})}function a(e){f(),i.find(".sets").addClass("disabled"),o.getPicturesInSet($(e.target).data("id")||$(e.target).parents(".set").data("id"),{per_page:500}).then(function(e){i.find(".loadingMsg").html(""),i.find(".sets").removeClass("disabled");if(!e.length)return;s("picker",{data:e})},function(){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.imageSelectorFlickr.loadingFailed)})}function f(){i.find(".loadingMsg").html('<span class="smallLoader"></span>'),i.find(".errorMsg").hide()}function l(){i.find(".btn-userLogin").click(u),i.find(".userName").bind("input propertychange",function(){$(this).val()?i.find(".btn-userLogin").removeAttr("disabled"):i.find(".btn-userLogin").attr("disabled","disabled"),i.find(".loadingMsg").html(""),i.find(".errorMsg").hide(),i.find(".sets").html("")}).keyup(function(e){e.keyCode==13&&$(this).val()&&u()})}var o=new n(app.cfg.FLICKR_API_KEY);i.append(e({fieldUserName:i18n.commonMedia.imageSelectorFlickr.userInputLbl,btnSearch:i18n.commonMedia.mediaSelector.userLookup})),l(),this.present=function(e){if(!e||!e.isReturning)i.find(".userName").val()||i.find(".btn-userLogin").attr("disabled","disabled");i.show();var t=i.find(".imageSelectorFlickr");if(t.width()){var n=t.find(".userName");n.css("width",t.width()-(n.position().left-t.position().left)-t.find(".btn-userLogin").outerWidth()-30).focus()}}}}),define("lib-build/tpl!storymaps/common/builder/media/image/ViewPicasa",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="imageSelectorPicasa">\n	<form class="form-inline" role="form" onsubmit="return false;">\n		<div class="form-group">\n			<span class="icon fa fa-google"></span>\n			<span class="title">Google+</span>\n			<input type="text" class="form-control userName" value="" placeholder="'+((__t=fieldUserName)==null?"":__t)+'"/>\n		</div>\n		<button class="btn btn-primary btn-userLogin">'+((__t=btnSearch)==null?"":__t)+'</button>\n		<span class="loadingMsg"></span>\n	</form>\n	<div class="errorMsg"></div>\n	<div class="albums"></div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/media/image/ViewPicasa",[],function(){}),define("storymaps/common/utils/connector/Picasa",["dojo/Deferred"],function(e){return function(){this.getAlbums=function(t){var n=new e,r=document.location.protocol+"//picasaweb.google.com/data/feed/base/user/"+t+"?alt=json&access=public";return t?($.ajax({url:r,dataType:"jsonp",timeout:4e3}).then(function(e){var t=[];e&&e.feed&&e.feed.entry&&$.each(e.feed.entry,function(e,n){t.push({url:n.id.$t,title:n.title.$t||"",thumbnailUrl:n.media$group.media$thumbnail[0].url})}),n.resolve(t)},function(){n.reject()}),n):(n.reject(),n)},this.getAlbum=function(t,n){var r=new e,i=t.replace("/data/entry/base/","/data/feed/base/")+"&kind=photo&fields=title,subtitle,icon,entry(title,gphoto:numphotos,media:group(media:content,media:thumbnail,media:description),georss:where)";return t?(i+="&imgmax=1600",i+=n?"&max-results="+n:"",$.getJSON(i,function(e){var t=[];$.each(e.feed.entry,function(e,n){var r=n.media$group.media$content[0].url||"",i=n.media$group.media$thumbnail[2].url||"";r=r.replace("https://","http://"),i=i.replace("https://","http://");var s={name:n.media$group.media$description.$t||"",description:"",pic_url:r,thumb_url:i,lat:"",lng:"",is_video:!1};n.georss$where&&n.georss$where.gml$Point&&n.georss$where.gml$Point.gml$pos&&n.georss$where.gml$Point.gml$pos.$t&&n["georss$where"]["gml$Point"]["gml$pos"]["$t"].split(" ").length==2&&(s.lat=n.georss$where.gml$Point.gml$pos.$t.split(" ")[0],s.lng=n.georss$where.gml$Point.gml$pos.$t.split(" ")[1]),t.push(s)}),r.resolve(t)}),r):(r.reject(),r)}}}),define("lib-build/tpl!storymaps/common/builder/media/image/ViewPicasaAlbum",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="album" data-id="'+((__t=id)==null?"":__t)+'" style="'+((__t=style)==null?"":__t)+'">\n	<img src="'+((__t=thumb)==null?"":__t)+'" class="album-thumb" />\n	<div>'+((__t=title)==null?"":__t)+"</div>\n</div>\n";return __p}}),define("storymaps/common/builder/media/image/ViewPicasa",["lib-build/tpl!./ViewPicasa","lib-build/css!./ViewPicasa","storymaps/common/utils/connector/Picasa","lib-build/tpl!./ViewPicasaAlbum"],function(e,t,n,r){return function(i,s){function u(){var e=i.find(".userName").val(),t=i.parents(".smallSize").length?3:4;f(),o.getAlbums(e).then(function(e){var n="";if(!e||!e.length){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.mediaSelector.noData);return}$.each(e,function(e,i){n+=r({id:i.url,thumb:i.thumbnailUrl,title:i.title,style:e%t===0?"clear:both":""})}),i.find(".albums").removeClass("disabled").show().html(n),i.find(".albums").off("click").click(a),i.find(".loadingMsg").html('<span class="glyphicon glyphicon-ok"></span>')},function(){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.imageSelectorPicasa.signInMsg2)})}function a(e){f(),i.find(".albums").addClass("disabled"),o.getAlbum($(e.target).parents(".album").data("id"),200).then(function(e){i.find(".loadingMsg").html(""),i.find(".albums").removeClass("disabled");if(!e.length)return;s("picker",{data:e})},function(){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.imageSelectorFlickr.loadingFailed)})}function f(){i.find(".loadingMsg").html('<span class="smallLoader"></span>'),i.find(".errorMsg").hide()}function l(){i.find(".btn-userLogin").click(u),i.find(".userName").bind("input propertychange",function(){$(this).val()?i.find(".btn-userLogin").removeAttr("disabled"):i.find(".btn-userLogin").attr("disabled","disabled"),i.find(".loadingMsg").html(""),i.find(".errorMsg").hide(),i.find(".albums").html("")}).keyup(function(e){e.keyCode==13&&$(this).val()&&u()})}var o=new n(app.cfg.FLICKR_API_KEY);i.append(e({fieldUserName:i18n.commonMedia.imageSelectorPicasa.userInputLbl,btnSearch:i18n.commonMedia.mediaSelector.userLookup})),l(),this.present=function(e){if(!e||!e.isReturning)i.find(".userName").val()||i.find(".btn-userLogin").attr("disabled","disabled");i.show();var t=i.find(".imageSelectorPicasa");if(t.width()){var n=t.find(".userName");n.css("width",t.width()-(n.position().left-t.position().left)-t.find(".btn-userLogin").outerWidth()-30).focus()}}}}),define("lib-build/css!storymaps/common/builder/media/ViewPicker",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/ViewPickerItem",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="mediaItem" data-id="'+((__t=id)==null?"":__t)+'" style="'+((__t=style)==null?"":__t)+'">\n	<img class="mediaImg" src="'+((__t=thumb)==null?"":__t)+'" />\n	<div>'+((__t=title)==null?"":__t)+"</div>\n</div>\n";return __p}}),define("storymaps/common/builder/media/ViewPicker",["lib-build/css!./ViewPicker","lib-build/tpl!./ViewPickerItem"],function(e,t){return function(n,r,i){var s=null;this.present=function(e){if(!e.isReturning){var o="";s=e,$.each(e.data,function(e,n){o+=t({id:e,title:n.name,thumb:n.thumb_url,style:e%2===0?"clear:both":""})}),n.html(o)}n.off("click"),n.find(".mediaItem").off("click"),e.mode=="import"?($(".opt-checkbox-select-all").attr("checked",!1),$(".opt-select-all-container").show(),n.find(".mediaItem").addClass("import"),$(".opt-checkbox-select-all").off("change").change(function(){n.find(".mediaItem").toggleClass("selected",$(this).is(":checked")),i&&i("import")}),n.find(".mediaItem").on("click",function(){$(this).toggleClass("selected"),i&&i()})):n.click(function(e){var t=$(e.target).parents(".mediaItem").index();t!=-1&&r("configure",{mode:s.mode,fromService:!0,media:s.data[t]})}),n.find(".mediaItem").removeClass("selected"),n.show()},this.getData=function(){var e=[];return s&&s.data&&$.each(n.find(".mediaItem.selected"),function(t,n){e.push(s.data[$(n).data("id")])}),e},this.checkError=function(){return!n.find(".mediaItem.selected").length}}}),define("lib-build/css!storymaps/common/builder/media/ViewConfigure",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/ViewConfigure",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="mediaSelectorConfigure">\n	<form role="form">\n		<div class="form-group">\n			<label>'+((__t=lblURL)==null?"":__t)+'\n				<span class="configureHelp fa fa-info-circle" data-toggle="tooltip" data-title="'+((__t=lblURLHelp)==null?"":__t)+'"></span>\n			</label>\n			<input type="text" class="form-control mediaURL" placeholder="'+((__t=lblURLPH)==null?"":__t)+'">\n			<p class="mediaURLError">'+((__t=lblURLError)==null?"":__t)+"</p>\n		</div>\n		",mode=="inlineText"&&(__p+='\n			<div class="inline-image">\n				<div class="form-group">\n					<label style="display: block">'+((__t=lblLabel)==null?"":__t)+'</label>\n					<textarea class="form-control mediaTitle" spellcheck="true" placeholder="'+((__t=lblLabelPH)==null?"":__t)+'" style="height: 74px; margin-top: 5px;"></textarea>\n				</div>\n				<div class="form-group">\n					<div class="checkbox">\n						<label>\n							<input type="checkbox" value="opt-maximize">\n							'+((__t=lblMaximize)==null?"":__t)+'\n							<span class="configureHelp fa fa-info-circle" data-toggle="tooltip" data-title="'+((__t=lblMaximizeHelp)==null?"":__t)+'"></span>\n						</label>\n					</div>\n				</div>\n			</div>\n			<div class="inline-video">\n				<label style="display: block; margin-bottom: 15px; margin-left: 122px;">'+((__t=lblPosition)==null?"":__t)+'</label>\n				<div style="text-align: center">\n					<div class="media-configure-position" data-val="fit">\n						<div class="position-selected"></div>\n						<img class="position-img" src="resources/common/icons/media-configure-position-fit.png" />\n						<div class="position-lbl">'+((__t=lblPosition3)==null?"":__t)+"</div>\n						<div>"+((__t=lblPosition3Explain2)==null?"":__t)+'</div>\n					</div>\n\n					<div class="media-configure-position" data-val="custom">\n						<div class="position-selected"></div>\n						<img class="position-img" src="resources/common/icons/media-configure-position-custom.png" />\n						<div class="position-lbl">'+((__t=lblPosition5)==null?"":__t)+'</div>\n						<div class="position-params">\n							<div>\n								<input type="text" class="form-control input-sm posCustomW" placeholder="'+((__t=phWidth)==null?"":__t)+'" style="display: inline-block; width: 65px;">\n								<a href="#" class="dimHelp" data-toggle="tooltip">\n									<img src="resources/tpl/builder/icons/builder-help.png"/>\n								</a>\n							</div>\n							<div style="margin-top: 2px;">\n								<input type="text" class="form-control input-sm posCustomH" placeholder="'+((__t=phHeight)==null?"":__t)+'" style="display: inline-block; width: 65px;">\n								<a href="#" class="dimHelp2" data-toggle="tooltip">\n									<img src="resources/tpl/builder/icons/builder-help.png"/>\n								</a>\n							</div>\n						</div>\n					</div>\n				</div>\n			</div>\n			<!--\n			<div class="form-group">\n				<label style="display: block">Alignment</label>\n				<label class="checkbox-inline" style="margin-left: -18px;">\n					<input type="radio" name="mediaDisplay" value="none"> None\n				</label>\n				<label class="checkbox-inline">\n					<input type="radio" name="mediaDisplay" value="left"> Left\n				</label>\n				<label class="checkbox-inline">\n					<input type="radio" name="mediaDisplay" value="center"> Center\n				</label>\n				<label class="checkbox-inline">\n					<input type="radio" name="mediaDisplay" value="right"> Right\n				</label>\n			</div>\n			-->\n		'),mode=="mainMedia"&&(__p+='\n			<div class="form-group position-image">\n				<label style="display: block; margin-bottom: 15px;">'+((__t=lblPosition)==null?"":__t)+'</label>\n				<div>\n					<div class="media-configure-position" data-val="fill">\n						<div class="position-selected"></div>\n						<img class="position-img" src="resources/common/icons/media-configure-position-fill.png" />\n						<div class="position-lbl">'+((__t=lblPosition2)==null?"":__t)+"</div>\n						<div>"+((__t=lblPosition2Explain)==null?"":__t)+'</div>\n					</div>\n\n					<div class="media-configure-position" data-val="fit">\n						<div class="position-selected"></div>\n						<img class="position-img" src="resources/common/icons/media-configure-position-fit.png" />\n						<div class="position-lbl">'+((__t=lblPosition3)==null?"":__t)+"</div>\n						<div>"+((__t=lblPosition3Explain)==null?"":__t)+'</div>\n					</div>\n\n					<div class="media-configure-position" data-val="stretch">\n						<div class="position-selected"></div>\n						<img class="position-img" src="resources/common/icons/media-configure-position-stretch.png" />\n						<div class="position-lbl">'+((__t=lblPosition4)==null?"":__t)+"</div>\n						<div>"+((__t=lblPosition4Explain)==null?"":__t)+'</div>\n					</div>\n\n					<div class="media-configure-position" data-val="center">\n						<div class="position-selected"></div>\n						<img class="position-img" src="resources/common/icons/media-configure-position-center.png" />\n						<div class="position-lbl">'+((__t=lblPosition1)==null?"":__t)+'</div>\n					</div>\n				</div>\n			</div>\n			<div class="form-group position-video">\n				<label style="display: block; margin-bottom: 15px; margin-left: 7px;">'+((__t=lblPosition)==null?"":__t)+'</label>\n				<div style="text-align: center">\n					<div class="media-configure-position" data-val="stretch">\n						<div class="position-selected"></div>\n						<img class="position-img" src="resources/common/icons/media-configure-position-stretch.png" />\n						<div class="position-lbl">'+((__t=lblPosition2)==null?"":__t)+'</div>\n					</div>\n\n					<div class="media-configure-position" data-val="fit">\n						<div class="position-selected"></div>\n						<img class="position-img" src="resources/common/icons/media-configure-position-fit.png" />\n						<div class="position-lbl">'+((__t=lblPosition3)==null?"":__t)+'</div>\n					</div>\n\n					<div class="media-configure-position" data-val="center">\n						<div class="position-selected"></div>\n						<img class="position-img" src="resources/common/icons/media-configure-position-center.png" />\n						<div class="position-lbl">'+((__t=lblPosition1)==null?"":__t)+'</div>\n					</div>\n\n					<div class="media-configure-position" data-val="custom">\n						<div class="position-selected"></div>\n						<img class="position-img" src="resources/common/icons/media-configure-position-custom.png" />\n						<div class="position-lbl">'+((__t=lblPosition5)==null?"":__t)+'</div>\n						<div class="position-params">\n							<div>\n								<input type="text" class="form-control input-sm posCustomW" placeholder="'+((__t=phWidth)==null?"":__t)+'" style="display: inline-block; width: 65px;">\n								<a href="#" class="dimHelp" data-toggle="tooltip">\n									<img src="resources/tpl/builder/icons/builder-help.png"/>\n								</a>\n							</div>\n							<div style="margin-top: 2px;">\n								<input type="text" class="form-control input-sm posCustomH" placeholder="'+((__t=phHeight)==null?"":__t)+'" style="display: inline-block; width: 65px;">\n								<a href="#" class="dimHelp2" data-toggle="tooltip">\n									<img src="resources/tpl/builder/icons/builder-help.png"/>\n								</a>\n							</div>\n						</div>\n					</div>\n				</div>\n			</div>\n\n		'),mode=="shortlist"&&(__p+='\n			<div class="form-group">\n				<label>'+((__t=lblThumbURL)==null?"":__t)+'\n					<span class="configureHelp fa fa-info-circle" data-toggle="tooltip" data-title="'+((__t=lblThumbURLHelp)==null?"":__t)+'"></span>\n				</label>\n				<input type="text" class="form-control mediaThumbURL" placeholder="'+((__t=lblURLPH)==null?"":__t)+'">\n				<p class="mediaThumbURLError">'+((__t=lblURLError)==null?"":__t)+"</p>\n			</div>\n		"),__p+='\n\n		<div class="form-group mediaUnloadStrategy">\n			<div class="checkbox">\n				<label>\n					<input type="checkbox" class="navigateOutUnload" />\n					'+((__t=unloadLbl)==null?"":__t)+'\n					<a href="#" class="unloadHelp" data-toggle="tooltip" data-title="'+((__t=unloadHelp)==null?"":__t)+'">\n						<img src="resources/tpl/builder/icons/builder-help.png"/>\n					</a>\n				</label>\n			</div>\n		</div>\n		<div class="form-group embedProtocol">\n			<div class="checkbox">\n				<label>\n					<input type="checkbox" class="embedProtocolSecure" />\n					'+((__t=embedProtocolLabel)==null?"":__t)+'\n				</label>\n				<div class="embedProtocolHelp">\n					'+((__t=embedProtocolInfo)==null?"":__t)+"\n				</div>\n			</div>\n		</div>\n	</form>\n</div>\n";return __p}}),define("storymaps/common/builder/media/ViewConfigure",["lib-build/css!./ViewConfigure","lib-build/tpl!./ViewConfigure","../../utils/CommonHelper","dojo/_base/lang","dojo/Deferred"],function(e,t,n,r,i){return function(s,o){function h(){s.find(".imageDetailsLbl").click(function(){s.find(".imageDetailsContainer").toggleClass("expanded")}),s.find(".media-configure-position").off("click").click(function(){var e=$(this).data("val");s.find(".media-configure-position").removeClass("selected"),$(this).addClass("selected"),s.find('.media-configure-position[data-val="custom"]').find(".position-params").toggleClass("disabled",e!="custom")}),s.find(".dimHelp").tooltip("destroy").tooltip({title:i18n.commonMedia.mediaConfigure.tooltipDimension,html:!0,trigger:"hover"}),s.find(".dimHelp2").tooltip("destroy").tooltip({title:i18n.commonMedia.mediaConfigure.tooltipDimension2,html:!0,trigger:"hover"}),s.find(".maximizeHelp, .unloadHelp, .configureHelp").tooltip({html:!0,trigger:"hover",placement:app.appCfg.mediaPickerConfigureForceMode=="shortlist"?"bottom":"top"})}var u=["center","fill","fit","stretch","custom"],a=null,f=null,l=null;app.appCfg.mediaPickerConfigureForceMode&&(o.mode=app.appCfg.mediaPickerConfigureForceMode);var c=r.mixin({mode:o.mode,phWidth:i18n.commonCore.common.width,phHeight:i18n.commonCore.common.height,embedProtocolInfo:location.protocol=="https:"?i18n.commonMedia.mediaConfigure.embedProtocolWarning1:i18n.commonMedia.mediaConfigure.embedProtocolWarning2},i18n.commonMedia.mediaConfigure);app.appCfg.mediaPickerConfigureForceMode==="shortlist"&&r.mixin(c,{lblURLHelp:i18n.builder.detailPanelBuilder.imageSizeHelperUpdated,lblThumbURLHelp:i18n.builder.detailPanelBuilder.thumbnailHelp||"The recommended thumbnail size & shape is 280 x 210 pixels (4:3 width:height ratio). Larger thumbnails can slow performance. 4:3 aspect ratio thumbnails fit into their tiles without being cropped.",lblThumbURL:i18n.builder.detailPanelBuilder.thumbnailLink}),s.append(t(c)),h(),this.present=function(e){var t=e.media,r=null;this.imageSizes=null,e.media&&e.media.image&&(e.media.pic_url&&(e.media.pic_url.indexOf("flickr")||e.media.pic_url.indexOf("googleusercontent"))&&(e.fromService=!0),e.media.image&&e.media.image.url&&(e.media.image.url.indexOf("flickr")||e.media.image.url.indexOf("googleusercontent"))&&(e.fromService=!0),e.media.thumb_url&&(e.media.thumb_url.indexOf("flickr")||e.media.thumb_url.indexOf("googleusercontent"))&&(e.fromService=!0)),e.fromService&&(e.media.is_video?t={type:"video",video:{title:e.media.name,titleDisplay:"caption",url:e.media.pic_url}}:(this.imageSizes=e.media.sizes,t={type:"image",image:{title:e.media.description||e.media.name,titleDisplay:"caption",url:e.media.pic_url||(this.imageSizes?this.imageSizes[0].url:e.media.picUrl)||e.media.image.url,sizes:e.media.sizes,thumb_url:e.media.thumb_url?e.media.thumb_url:""}})),t&&t.type=="image"&&t.image&&(r={width:e.fromService?null:t[t.type].width,height:e.fromService?null:t[t.type].height},t.image.activateFullScreen=e.media.activateFullScreen),f=t?t.type:"image",a=t,l=e;var i=t?t[t.type].url:"";i&&app.appCfg.mediaPickerConfigureForceMode!="shortlist"&&e.mode=="showURL"&&!e.media.resourcesUrl&&!e.media.pic_url&&(i="",l.fromService=!1),i&&app.appCfg.mediaPickerConfigureForceMode=="shortlist"&&i.indexOf(!1)&&(i=n.possiblyAddToken(i)),s.find(".mediaURL").val(i).keyup(function(){l.fromService&&t&&t.type&&t[t.type].url!=s.find(".mediaURL").val()&&(l.fromService=!1),app.appCfg.mediaPickerConfigureForceMode=="shortlist"&&s.find(".mediaThumbURL").val().length&&s.parent().parent().parent().parent().parent().parent().parent().find(".modal-footer").find(".btnSubmit").attr("disabled",!1),s.find(".mediaURLError").fadeOut()}).on("paste",function(){l.fromService&&t&&t.type&&t[t.type].url!=s.find(".mediaURL").val()&&(l.fromService=!1),app.appCfg.mediaPickerConfigureForceMode=="shortlist"&&s.find(".mediaThumbURL").val().length&&s.parent().parent().parent().parent().parent().parent().parent().find(".modal-footer").find(".btnSubmit").attr("disabled",!1),s.find(".mediaURLError").fadeOut()}).parent().toggle((e.fromService===!1||app.appCfg.mediaPickerConfigureForceMode=="shortlist"&&e.mode=="showURL")&&f=="image"&&f=="image"),s.find(".mediaURLError").hide();var c=t?t[t.type].thumb_url:"";c&&app.appCfg.mediaPickerConfigureForceMode=="shortlist"&&c.indexOf(!1)&&(c=n.possiblyAddToken(c)),s.find(".mediaThumbURL").val(c).keyup(function(){l.fromService&&t&&t.type&&t[t.type].thumb_url!=s.find(".mediaThumbURL").val()&&(l.fromService=!1),app.appCfg.mediaPickerConfigureForceMode=="shortlist"&&s.find(".mediaURL").val().length&&s.parent().parent().parent().parent().parent().parent().parent().find(".modal-footer").find(".btnSubmit").attr("disabled",!1),s.find(".mediaThumbURLError").fadeOut()}).on("paste",function(){l.fromService&&t&&t.type&&t[t.type].thumb_url!=s.find(".mediaThumbURL").val()&&(l.fromService=!1),app.appCfg.mediaPickerConfigureForceMode=="shortlist"&&s.find(".mediaURL").val().length&&s.parent().parent().parent().parent().parent().parent().parent().find(".modal-footer").find(".btnSubmit").attr("disabled",!1),s.find(".mediaThumbURLError").fadeOut()});var h=f=="webpage"&&t[t.type].frameTag;h&&s.find(".mediaURL").val(t[t.type].frameTag),s.find(".position-image").toggle(f=="image"),s.find(".position-video").toggle(f=="video"||f=="webpage"),s.find(".media-configure-position").removeClass("selected");var p=f=="image"?u[1]:u[3],d=null,v=null;if(e.media&&e.media.type){var m=e.media[e.media.type].display;d=e.media[e.media.type].width,v=e.media[e.media.type].height,$.inArray(m,u)!=-1&&(p=m)}var g=f=="image"?".position-image":".position-video";o.mode=="inlineText"&&(f=="video"||f=="webpage")&&(g=".inline-video",!d&&!v&&(p="fit")),(f=="video"||f=="webpage")&&p=="fit"&&(d="",v=""),s.find(g).find(".media-configure-position[data-val="+p+"]").addClass("selected").click(),s.find(".posCustomW").val(d||""),s.find(".posCustomH").val(v||""),s.find(".inline-image").toggle(f=="image"),s.find(".inline-video").toggle(f=="video"||f=="webpage"),s.find(".mediaTitle").val(t?t[t.type].title:""),s.find('[value="opt-maximize"]').prop("checked",t?t[t.type].activateFullScreen:!1),s.find(".mediaUnloadStrategy").toggle(f=="webpage"),s.find(".navigateOutUnload").prop("checked",!e.media||!e.media[e.media.type]||e.media[e.media.type].unload===undefined||e.media[e.media.type].unload);if(f=="webpage"){var y=location.protocol=="https:",b;t[t.type].url?b=t[t.type].url.match(/https:\/\//):b=$(t[t.type].frameTag).attr("src").match(/https:\/\//),s.find(".embedProtocol").find("label").toggleClass("disabled",y),s.find(".embedProtocolSecure").prop("checked",b)}s.find(".embedProtocol").toggle(f=="webpage"),s.show(),s.find(".mediaURL").focus()},this.checkError=function(e){var t=!1;s.find(".mediaURLError, .mediaThumbURLError").fadeOut();if(l.fromService===!1&&f=="image"){var r=new i,o=e.html();e.html(i18n.commonMedia.mediaConfigure.lblURLCheck);var u=null;if(app.appCfg.mediaPickerConfigureForceMode=="shortlist"){var a=n.prependURLHTTP(s.find(".mediaURL").val().trim()),c=n.prependURLHTTP(s.find(".mediaThumbURL").val().trim());u=new Image,u.src=a,u.onload=function(){var t=new Image;t.src=c,t.onload=function(){e.html(o),r.resolve(!1)},t.onerror=function(){c&&s.find(".mediaThumbURLError").fadeIn(),e.html(o),r.resolve(!0)}},u.onerror=function(){s.find(".mediaURLError").fadeIn();var t=new Image;t.src=c,t.onload=function(){e.html(o),r.resolve(!0)},t.onerror=function(){s.find(".mediaThumbURLError").fadeIn(),e.html(o),r.resolve(!0)}}}else u=new Image,u.src=n.prependURLHTTP(s.find(".mediaURL").val().trim()),u.onload=function(){e.html(o),r.resolve(!1)},u.onerror=function(){s.find(".mediaURLError").fadeIn(),e.html(o),r.resolve(!0)};return r}return t},this.getData=function(){var e=s.find(".media-configure-position.selected").data("val"),t={url:s.find(".mediaURL").val().trim(),type:f};this.imageSizes&&r.mixin(t,{sizes:this.imageSizes}),o.mode=="inlineText"?f=="image"?r.mixin(t,{title:s.find(".mediaTitle").val(),width:s.find(".imgActualWidth").val(),height:s.find(".imgActualHeight").val(),type:f,activateFullScreen:s.find('[value="opt-maximize"]').prop("checked")}):(r.mixin(t,{display:e}),e=="custom"&&r.mixin(t,{width:s.find(".inline-video .posCustomW").val(),height:s.find(".inline-video .posCustomH").val()})):app.appCfg.mediaPickerConfigureForceMode=="shortlist"?r.mixin(t,{thumb_url:s.find(".mediaThumbURL").val()}):(r.mixin(t,{display:e}),e=="custom"&&r.mixin(t,{width:s.find(".position-video .posCustomW").val(),height:s.find(".position-video .posCustomH").val()})),f=="webpage"&&(t.unload=s.find(".navigateOutUnload").prop("checked"));if(f=="webpage"&&a.webpage.frameTag){var i=t.url,u=$(i);s.find(".embedProtocolSecure").prop("checked")?u.attr("src",n.convertURLHTTPS(u.attr("src"))):u.attr("src",n.convertURLHTTP(u.attr("src"))),t.frameTag=u.prop("outerHTML").replace(/ xmlns="[^"]*"/,""),t.url="",t.ts=(new Date).getTime()}else f=="webpage"?s.find(".embedProtocolSecure").prop("checked")?t.url=n.convertURLHTTPS(t.url):t.url=n.convertURLHTTP(t.url):(t.url=n.prependURLHTTP(t.url),t.thumb_url&&(t.thumb_url=n.prependURLHTTP(t.thumb_url)));return t}}}),define("storymaps/common/builder/media/image/Selector",["lib-build/tpl!./Selector","lib-build/css!./Selector","./ViewHome","./ViewUpload","./ViewFlickr","./ViewPicasa","../ViewPicker","../ViewConfigure"],function(e,t,n,r,i,s,o,u){return function(a,f,l,c){function b(e,t,n){if(!y[e])return;t=t||{},t.mode=t.mode||g,g=t.mode,e=="home"?m=!1:e!="configure"&&(v=e),n||d.push({name:h,params:p}),h=e,p=t,c.toggle(h!="home"),e!="home"&&(y.home.updateParams(t),c.off("click").click(function(){var e=d.pop()||{name:"home"};b(e.name||"home",e.params,!0)})),a.find(".selectorView").hide(),(!p||!p.fromService||!app.appCfg.mediaPickerSkipConfigure||p.mode=="showURL")&&y[e].present(t),app.appCfg.mediaPickerConfigureForceMode=="shortlist"&&(e=="picker"&&g=="import"?$(".opt-select-all-container").show():$(".opt-select-all-container").hide(),a.parents(".modal-content").find(".modal-footer .btnSubmit").toggle(e=="configure"||g=="import")),l&&l(g)}function w(){}a.append(e({lblStep1:i18n.commonMedia.imageSelector.lblStep1,lblStep2:i18n.commonMedia.imageSelector.lblStep2,lblStep3:i18n.commonMedia.imageSelector.lblStep3}));var h=null,p=null,d=null,v=null,m=!1,g=null,y={home:new n(a.find(".viewHomeContainer"),b),upload:new r(a.find(".viewUploadContainer"),b),flickr:new i(a.find(".viewFlickrContainer"),b),picasa:new s(a.find(".viewPicasaContainer"),b),picker:new o(a.find(".mediaSelectorPickerContainer"),b,l),configure:new u(a.find(".mediaSelectorConfigureContainer"),f.configure,b)};w(),this.present=function(e){d=[],h=null,p=null,g=e.mode,y.home.updateParams({}),e.mode=="edit"&&e.media&&e.media.type=="image"?b("configure",{mode:e.mode,media:e.media}):e.keepLastDataSource&&m&&v!=null?(e.isReturning=!0,b(v,e)):b("home",e)},this.checkError=function(e){var t=!1;return h=="configure"?p.fromService&&app.appCfg.mediaPickerSkipConfigure?t=!1:t=y[h].checkError(e):g=="import"?t=y[h].checkError(e):t=!0,a.toggleClass("error",t),m=!t,t},this.getData=function(){return h=="configure"?p.fromService&&app.appCfg.mediaPickerSkipConfigure?(p.media.url=p.media.pic_url,p.media):y[h].getData():h=="picker"&&g=="import"?y[h].getData():null},this.activate=function(){c.toggle(h!="home"),h!="home"&&c.off("click").click(function(){var e=d.pop()||{name:"home"};b(e.name||"home",e.params,!0)})},this.deactivate=function(){c.hide().off("click")}}}),define("lib-build/tpl!storymaps/common/builder/media/video/Selector",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="videoSelector">\n	<div class="selectorView viewHomeContainer"></div>\n	<div class="selectorView viewYoutubeContainer"></div>\n	<div class="selectorView viewVimeoContainer"></div>\n	<div class="selectorView viewOtherContainer"></div>\n	<div class="selectorView mediaSelectorPickerContainer"></div>\n	<div class="selectorView mediaSelectorConfigureContainer"></div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/media/video/Selector",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/video/ViewHome",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="videoSelectorHome">\n	<table class="videoSelectorTable">\n		<tr>\n			<td class="btn-container btn-select-youtube">\n				<span class="fa fa-youtube"></span>\n				<span class="title">YouTube</span>\n			</td>\n			<td class="btn-container btn-select-vimeo">\n				<span class="fa fa-vimeo"></span>\n				<span class="title">Vimeo</span>\n			</td>\n			<td class="btn-container btn-select-other">\n				<span class="fa fa-link"></span>\n				<span class="title">'+((__t=lblLink)==null?"":__t)+"</span>\n			</td>\n		</tr>\n	</table>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/media/video/ViewHome",[],function(){}),define("storymaps/common/builder/media/video/ViewHome",["lib-build/tpl!./ViewHome","lib-build/css!./ViewHome"],function(e){return function(n,r){function i(){n.find(".btn-select-youtube").click(function(){r("youtube")}),n.find(".btn-select-vimeo").click(function(){r("vimeo")}),n.find(".btn-select-other").click(function(){r("other")})}n.append(e({lblLink:i18n.commonMedia.mediaSelector.lblLink,lblOther:i18n.commonMedia.videoSelectorHome.other})),i(),this.present=function(){n.show()}}}),define("lib-build/tpl!storymaps/common/builder/media/video/ViewVideoCommon",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="videoSelectorView">\n	<form class="form-inline" role="form" onsubmit="return false;">\n		<div class="form-group">\n			<span class="icon fa fa-'+((__t=faIcon)==null?"":__t)+'"></span>\n			<span class="title">'+((__t=serviceName)==null?"":__t)+'</span>\n			<input type="text" class="form-control url" value="" placeholder="'+((__t=fieldUrl)==null?"":__t)+'"/>\n		</div>\n		<button class="btn btn-primary btn-check">'+((__t=btnCheck)==null?"":__t)+'</button>\n		<span class="loadingMsg"></span>\n	</form>\n	<div class="errorMsg"></div>\n	<div class="result-container">\n		<div class="video-detail-container"></div>\n	</div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/media/video/ViewVideoCommon",[],function(){}),define("storymaps/common/utils/connector/Youtube",["dojo/Deferred"],function(e){return function(){function n(t){var n=new e,r="https://www.googleapis.com/youtube/v3/videos?part=snippet&id="+t+"&key="+app.cfg.YOUTUBE_API_KEY;return $.ajax({url:r,timeout:4e3}).then(function(e){e&&e.items&&e.items.length?n.resolve(e.items[0].snippet):n.reject()},function(e){n.reject(e)}),n}function r(e){var t=/(youtube\.com\/(watch\?v\=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/.exec(e);return t&&t.length==4?t[3]:null}function i(e){return"//www.youtube.com/embed/"+e+"?wmode=opaque&rel=0"}this.checkVideoUrl=function(t,s){var o=new e,u=r(t);return u?s?n(u).then(function(e){e?o.resolve({title:e.title,description:e.description,user:e.channelTitle,thumbUrl:e.thumbnails["default"].url,embedUrl:i(u),viewCount:null,likeCount:null}):o.reject()},function(e){e&&e.status==403?o.reject("NOT_AUTHORIZED"):o.reject("NOT_FOUND")}):o.resolve({title:"",description:"",user:"",thumbUrl:"",embedUrl:i(u),viewCount:null,likeCount:null,fetchVideoSnippet:!1}):o.reject("INVALID_URL"),o}}}),define("lib-build/tpl!storymaps/common/builder/media/video/ViewVideoCommonDetail",[],function(){return function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="video-detail">\n	',typeof fetchVideoSnippet=="undefined"||fetchVideoSnippet?__p+='\n		<table>\n			<tr>\n				<td><img src="'+((__t=thumbUrl)==null?"":__t)+'" /></td>\n				<td style="padding-left: 10px">\n					<strong>\n						'+((__t=title)==null?"":__t)+'\n					</strong>\n					<div style="max-height: 100px; overflow-y: auto; word-wrap: break-word; word-break: break-word;">\n						'+((__t=description)==null?"":__t)+"\n					</div>\n				</td>\n			</tr>\n		</table>\n	":__p+='\n		<div style="font-style: italic; margin: 15px 0 25px 0;">'+((__t=videoNotChecked)==null?"":__t)+"</div>\n	",__p+='\n	<div style="text-align: center; margin-top: 10px;">\n		<button class="btn btn-primary btn-select-video">'+((__t=btnSelect)==null?"":__t)+"</button>\n	</div>\n</div>\n";return __p}}),define("storymaps/common/builder/media/video/ViewYoutube",["lib-build/tpl!./ViewVideoCommon","lib-build/css!./ViewVideoCommon","storymaps/common/utils/connector/Youtube","lib-build/tpl!./ViewVideoCommonDetail"],function(e,t,n,r){return function(i,s){function u(){var e=i.find(".url").val(),t=!app.isPortal||!app.cfg.YOUTUBE_DISABLE_ON_PORTAL;a(),o.checkVideoUrl(e,t).then(function(e){i.find(".loadingMsg").html('<span class="glyphicon glyphicon-ok"></span>'),i.find(".video-detail-container").fadeIn().html(r({fetchVideoSnippet:t,thumbUrl:e.thumbUrl,title:e.title,description:e.description,btnSelect:i18n.commonMedia.videoSelectorCommon.select,videoNotChecked:i18n.commonMedia.videoSelectorYoutube.videoNotChecked})),i.find(".btn-select-video").click(function(){s("configure",{mode:"add",fromService:!0,media:{name:e.title||"",description:e.description||"",pic_url:e.embedUrl,thumb_url:e.thumbUrl,lat:"",lng:"",is_video:!0}})})},function(e){i.find(".loadingMsg").html(""),e=="NOT_AUTHORIZED"?i.find(".errorMsg").show().html(i18n.commonMedia.videoSelectorYoutube.checkFailedAPI):i.find(".errorMsg").show().html(i18n.commonMedia.videoSelectorCommon.notFound)})}function a(){i.find(".loadingMsg").html('<span class="smallLoader"></span>'),i.find(".errorMsg").hide(),i.find(".btn-check").attr("disabled","disabled")}function f(){i.find(".btn-check").click(u),i.find(".url").bind("input propertychange",function(){$(this).val()?i.find(".btn-check").removeAttr("disabled"):i.find(".btn-check").attr("disabled","disabled"),i.find(".loadingMsg").html(""),i.find(".errorMsg").hide(),i.find(".video-detail-container").fadeOut().empty()}).keyup(function(e){e.keyCode==13&&$(this).val()&&u()})}var o=new n;i.append(e({faIcon:"youtube",serviceName:"YouTube",fieldUrl:i18n.commonMedia.videoSelectorYoutube.url+"...",btnCheck:i18n.commonMedia.videoSelectorCommon.check})),f(),this.present=function(e){if(!e||!e.isReturning)i.find(".url").val()||i.find(".btn-check").attr("disabled","disabled");i.show();var t=i.find(".videoSelectorView");if(t.width()){var n=t.find(".url");n.css("width",t.width()-(n.position().left-t.position().left)-t.find(".btn-check").outerWidth()-30).focus()}}}}),define("storymaps/common/utils/connector/Vimeo",["dojo/Deferred"],function(e){return function(){function n(t){var n=new e,r="//vimeo.com/api/v2/video/"+t+".json";return $.ajax({type:"GET",url:r,jsonp:"callback",dataType:"jsonp",timeout:4e3}).then(function(e){e&&e[0]?n.resolve(e[0]):n.reject()},function(){n.reject()}),n}function r(e){return"//player.vimeo.com/video/"+e+"?transparent=0"}this.checkVideoUrl=function(t){var i=new e,s=/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/.exec(t);if(s&&s.length==6){var o=s[5];n(o).then(function(e){e?i.resolve({title:e.title,description:e.description,user:e.user_name,thumbUrl:e.thumbnail_small,embedUrl:r(o),viewCount:e.stats_number_of_plays,likeCount:e.stats_number_of_likes}):i.reject()},function(){i.reject("NOT_FOUND")})}else i.reject("INVALID_URL");return i}}}),define("storymaps/common/builder/media/video/ViewVimeo",["lib-build/tpl!./ViewVideoCommon","lib-build/css!./ViewVideoCommon","storymaps/common/utils/connector/Vimeo","lib-build/tpl!./ViewVideoCommonDetail"],function(e,t,n,r){return function(i,s){function u(){var e=i.find(".url").val();a(),o.checkVideoUrl(e).then(function(e){i.find(".loadingMsg").html('<span class="glyphicon glyphicon-ok"></span>'),i.find(".video-detail-container").fadeIn().html(r({thumbUrl:e.thumbUrl,title:e.title,description:e.description,btnSelect:i18n.commonMedia.videoSelectorCommon.select})),i.find(".btn-select-video").click(function(){s("configure",{mode:"add",fromService:!0,media:{name:e.title||"",description:e.description||"",pic_url:e.embedUrl,thumb_url:e.thumbUrl,lat:"",lng:"",is_video:!0}})})},function(){i.find(".loadingMsg").html(""),i.find(".errorMsg").show().html(i18n.commonMedia.videoSelectorCommon.notFound)})}function a(){i.find(".loadingMsg").html('<span class="smallLoader"></span>'),i.find(".errorMsg").hide(),i.find(".btn-check").attr("disabled","disabled")}function f(){i.find(".btn-check").click(u),i.find(".url").bind("input propertychange",function(){$(this).val()?i.find(".btn-check").removeAttr("disabled"):i.find(".btn-check").attr("disabled","disabled"),i.find(".loadingMsg").html(""),i.find(".errorMsg").hide(),i.find(".video-detail-container").fadeOut().empty()}).keyup(function(e){e.keyCode==13&&$(this).val()&&u()})}var o=new n;i.append(e({serviceName:"vimeo",faIcon:"vimeo",fieldUrl:i18n.commonMedia.videoSelectorVimeo.url+"...",btnCheck:i18n.commonMedia.videoSelectorCommon.check})),f(),this.present=function(e){if(!e||!e.isReturning)i.find(".url").val()||i.find(".btn-check").attr("disabled","disabled");i.show();var t=i.find(".videoSelectorView");if(t.width()){var n=t.find(".url");n.css("width",t.width()-(n.position().left-t.position().left)-t.find(".btn-check").outerWidth()-30).focus()}}}}),define("lib-build/tpl!storymaps/common/builder/media/video/ViewOther",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="videoSelectorOther">\n	<div class="explain">'+((__t=explain)==null?"":__t)+"</div>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/media/video/ViewOther",[],function(){}),define("storymaps/common/builder/media/video/ViewOther",["lib-build/tpl!./ViewOther","lib-build/css!./ViewOther"],function(e){return function(n){function r(){}n.append(e({explain:i18n.commonMedia.videoSelectorOther.explain1+" "+i18n.commonMedia.videoSelectorOther.explain2.replace("%WEBPAGE%","<strong>"+i18n.commonMedia.videoSelectorOther.webpage+"</strong>")+'<div style="width: 100%; text-align: center; margin: 5px 0 15px 0"><div class="media-video-help-embed-dailymotion"></div></div>'+i18n.commonMedia.videoSelectorOther.explain3.replace("%WEBPAGE%","<strong>"+i18n.commonMedia.videoSelectorOther.webpage+"</strong>").replace("%EXAMPLE%",'<a href="https://developerscorner.storymaps.arcgis.com/a-simple-way-to-host-videos-for-story-maps-2b73874289e4/" target="_blank">Video.js</a>')})),r(),this.present=function(){n.show()}}}),define("storymaps/common/builder/media/video/Selector",["lib-build/tpl!./Selector","lib-build/css!./Selector","./ViewHome","./ViewYoutube","./ViewVimeo","./ViewOther","../ViewConfigure"],function(e,t,n,r,i,s,o){return function(u,a,f,l){function g(e,t,n){if(!m[e])return;e=="home"?v=!1:e!="configure"&&(d=e),n||p.push({name:c,params:h}),c=e,h=t,l.toggle(c!="home"),e!="home"&&l.off("click").click(function(){var e=p.pop()||{name:"home"};g(e.name||"home",e.params,!0)}),u.find(".selectorView").hide(),m[e].present(t),f&&f()}function y(){}u.append(e({}));var c=null,h=null,p=null,d=null,v=!1,m={home:new n(u.find(".viewHomeContainer"),g),youtube:new r(u.find(".viewYoutubeContainer"),g),vimeo:new i(u.find(".viewVimeoContainer"),g),other:new s(u.find(".viewOtherContainer"),g),configure:new o(u.find(".mediaSelectorConfigureContainer"),a.configure,g)};y(),this.present=function(e){p=[],c=null,h=null,e.mode=="edit"&&e.media&&e.media.type=="video"?g("configure",{mode:e.mode,media:e.media}):e.keepLastDataSource&&v&&d!=null?g(d,{isReturning:!0}):g("home")},this.checkError=function(){var e=!1;return c=="configure"?e=m[c].checkError():e=!0,u.toggleClass("error",e),v=!e,e},this.getData=function(){return c=="configure"?m[c].getData():null},this.activate=function(){l.toggle(c!="home"),c!="home"&&l.off("click").click(function(){var e=p.pop()||{name:"home"};g(e.name||"home",e.params,!0)})},this.deactivate=function(){l.hide().off("click")}}}),define("lib-build/tpl!storymaps/common/builder/media/webpage/Selector",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="videoSelector">\n	<div class="selectorView viewHomeContainer"></div>\n	<div class="selectorView mediaSelectorConfigureContainer"></div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/media/webpage/Selector",[],function(){}),define("lib-build/tpl!storymaps/common/builder/media/webpage/ViewHome",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="webpageSelectorHome">	\n	<div class="form-group">\n		<label>'+((__t=lblUrl)==null?"":__t)+'</label>\n		<input type="text" class="form-control url" placeholder="'+((__t=phURL)==null?"":__t)+'"/>\n		<button class="btn btn-primary btn-cfg btn-cfg-url">'+((__t=btnConfigure)==null?"":__t)+'</button>\n	</div>\n\n	<div class="separator">\n		<span class="solidline"></span>\n		'+((__t=lblOR)==null?"":__t)+'\n		<span class="solidline"></span>\n	</div>\n\n	<div class="form-group">\n		<label>'+((__t=lblEmbed)==null?"":__t)+'</label>\n		<textarea class="form-control textarea" placeholder="'+((__t=phEmbed)==null?"":__t)+'"></textarea>\n		<button class="btn btn-primary btn-cfg btn-cfg-embed">'+((__t=btnConfigure)==null?"":__t)+'</button>\n	</div>\n\n	<div class="error"></div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/media/webpage/ViewHome",[],function(){}),define("storymaps/common/builder/media/webpage/ViewHome",["lib-build/tpl!./ViewHome","lib-build/css!./ViewHome","storymaps/common/utils/CommonHelper"],function(e,t,n){return function(r,i){function s(){var e=o(),t=u();return r.find(".error").toggle(e&&t).html(i18n.commonMedia.webpageSelectorHome.lblError1),e&&t||!e&&!t}function o(){var e=r.find(".url").val();return!!e}function u(){var e=r.find(".textarea").val();return!!e}function a(){if(s())return null;var e=r.find(".url").val(),t=r.find(".textarea").val();if(e)e=n.convertURLHTTPS(e);else{var i=$(t.trim());i.attr("src",n.convertURLHTTPS(i.attr("src"))),t=i.prop("outerHTML").replace(/ xmlns="[^"]*"/,"")}return{url:e,frameTag:t}}function f(){r.find(".btn-cfg-url").attr("disabled",!o()||u()),r.find(".btn-cfg-embed").attr("disabled",!u()||o()),s()}function l(){r.find(".url").bind("input propertychange",f),r.find(".textarea").bind("input propertychange",f),r.find(".btn-cfg-url").click(function(){i("configure",{media:{type:"webpage",webpage:a()}})}),r.find(".btn-cfg-embed").click(function(){var e=r.find(".textarea").val().trim();if(!e.match(/^<iframe.*<\/iframe>$/)||e.match(/<iframe/g).length>2){r.find(".error").show().html(i18n.commonMedia.webpageSelectorHome.lblError2.replace("%IFRAMETAG%",'"&lt;iframe&gt;"'));return}i("configure",{media:{type:"webpage",webpage:a()}})})}r.append(e({lblUrl:i18n.commonMedia.webpageSelectorHome.lblUrl,lblEmbed:i18n.commonMedia.webpageSelectorHome.lblEmbed,phURL:"http://www.esri.com",phEmbed:"<iframe width=&quot;100%&quot; height=&quot;600px&quot; src=&quot;http://...&quot;></iframe>",lblOR:i18n.commonMedia.webpageSelectorHome.lblOR,btnConfigure:i18n.commonMedia.webpageSelectorHome.configure})),l(),this.present=function(e){r.show(),e&&e.mode=="edit"&&e.media&&e.media.type=="webpage"?(r.find(".url").val(e.media.webpage.url||""),r.find(".textarea").val(e.media.webpage.frameTag||"")):(r.find(".url").val(""),r.find(".textarea").val("")),f(),this.postDisplay()},this.postDisplay=function(){r.find(".webpageSelectorHome").width()&&r.find(".url, .textarea").css("width",r.find(".webpageSelectorHome").width()-5-r.find(".btn-cfg").outerWidth()),r.find(r.find(".textarea").val()?".textarea":".url").focus()}}}),define("storymaps/common/builder/media/webpage/Selector",["lib-build/tpl!./Selector","lib-build/css!./Selector","./ViewHome","../ViewConfigure"],function(e,t,n,r){return function(i,s,o,u){function d(e,t,n){if(!p[e])return;e=="home"?h=!1:e!="configure"&&(c=e),n||l.push({name:a,params:f}),a=e,f=t,u.toggle(a!="home"),e!="home"&&u.off("click").click(function(){var e=l.pop()||{name:"home"};d(e.name||"home",e.params,!0)}),i.find(".selectorView").hide(),p[e].present(t),o&&o()}function v(){}i.append(e({}));var a=null,f=null,l=null,c=null,h=!1,p={home:new n(i.find(".viewHomeContainer"),d),configure:new r(i.find(".mediaSelectorConfigureContainer"),s.configure,d)};v(),this.present=function(e){l=[],a=null,f=null,e.mode=="edit"&&e.media&&e.media.type=="webpage"?(d("home",{mode:e.mode,media:e.media}),d("configure",{mode:e.mode,media:e.media})):e.keepLastDataSource&&h&&c!=null?d(c,{isReturning:!0}):d("home")},this.checkError=function(){var e=!1;return a=="configure"?e=p[a].checkError():e=!0,i.toggleClass("error",e),h=!e,e},this.getData=function(){return a=="configure"?p[a].getData():null},this.activate=function(){u.toggle(a!="home"),a!="home"?u.off("click").click(function(){var e=l.pop()||{name:"home"};d(e.name||"home",e.params,!0)}):p[a].postDisplay()},this.deactivate=function(){u.hide().off("click")}}}),define("storymaps/common/builder/media/MediaSelector",["lib-build/tpl!./MediaSelector","lib-build/css!./MediaSelector","./map/WebMapSelector","./image/Selector","./video/Selector","./webpage/Selector"],function(e,t,n,r,i,s){return function(o,u,a,f,l){function b(){o.find(".media-type").eq(d?0:1).click().focus().click()}function w(e){var t=$.inArray(e.media.type,["webmap","image","video","frame"]);o.find(".media-type").eq(t).click().focus().click()}function E(){o.find(".media-type").click(function(){p=h[$(this).parents(".media-type-wrapper").index()],o.find(".media-type-wrapper").removeClass("current"),$(this).parents(".media-type-wrapper").addClass("current"),o.find(".mainMediaTypeContainer").hide().removeClass("current").eq($(this).parents(".media-type-wrapper").index()).addClass("current").show(),c.activate(),f&&f(p)})}o.append(e({hasMap:!!u,lblMap:i18n.commonMedia.mediaSelector.lblMap,lblImage:i18n.commonMedia.mediaSelector.lblImage,lblVideo:i18n.commonMedia.mediaSelector.lblVideo,lblExternal:i18n.commonMedia.mediaSelector.lblExternal,lblSelect:a?i18n.commonMedia.mediaSelector.lblSelect1:i18n.commonMedia.mediaSelector.lblSelect2,notImplemented:i18n.commonMedia.mediaSelector.notImplemented,hasVideo:!app.appCfg.mediaPickerDisableVideo,hasWebPage:!app.appCfg.mediaPickerDisableWebPage}));var c=this,h=["webmap","image","video","webpage"],p=null,d=null,v=null,m=new r(o.find(".imageMediaContainer"),{configure:{mode:u?"mainMedia":"inlineText"}},f,l),g=new i(o.find(".videoMediaContainer"),{configure:{mode:u?"mainMedia":"inlineText"}},f,l),y=new s(o.find(".webpageMediaContainer"),{configure:{mode:u?"mainMedia":"inlineText"}},f,l);u&&(d=new n(o.find(".mapMediaContainer"),u.onOpenConfigure,u.onCloseConfigure,f)),o.find(".mediaSelector").toggleClass("smallSize",a),E(),this.present=function(e){d&&(d.present(e),d.activate()),m.present(e),g.present(e),y.present(e),v=e.mode,o.find(".lblSelect, .media-types").toggle(!!(u||!app.appCfg.mediaPickerDisableVideo||!app.appCfg.mediaPickerDisableWebPage)),e.mode=="add"||e.mode=="import"?b(e):w(e)},this.getData=function(){var e=o.find(".mainMediaTypeContainer.current").index();return e===0?{media:{type:"webmap",webmap:d.getData()}}:e==1&&v=="import"?m.getData():e==1?{media:{type:"image",image:m.getData()}}:e==2?{media:{type:"video",video:g.getData()}}:e==3?{media:{type:"webpage",webpage:y.getData()}}:{}},this.checkError=function(e){var t=o.find(".mainMediaTypeContainer.current").index();return t===0?d.checkError():t==1?m.checkError(e):t==2?g.checkError():t==3?y.checkError():!0},this.activate=function(){m.deactivate(),g.deactivate(),y.deactivate(),p=="webmap"&&(d.activate(),setTimeout(d.activate,0)),p=="image"?m.activate():p=="video"?g.activate():p=="webpage"&&y.activate()},this.postDisplay=function(){d.postDisplay()}}}),define("storymaps/tpl/builder/addedit/Popup",["lib-build/tpl!./Popup","lib-build/css!./Popup","storymaps/common/builder/media/MediaSelector","storymaps/common/utils/CommonHelper","../../core/WebApplicationData","../../core/Helper","esri/geometry/Extent","dojo/Deferred","dojo/topic","dojo/has"],function(e,t,n,r,i,s,o,u,a,f){return function(r){function m(){r.find(".title").bind("input propertychange",E),r.find(".btnCancel").click(function(){r.modal("hide"),l.reject()}),r.on("shown.bs.modal",function(){g(),d.postDisplay()}),r.on("hide.bs.modal",function(){if(!v){app.isAddEditInProgress=!1;try{l.reject()}catch(e){}r.removeClass("temporaryHide")}else v=!1}),p.click(w),a.subscribe("TOGGLE-ADD-EDIT",y)}function g(){c.layout!="bullet"&&(f("ios")||r.find(".title").focus()),E()}function y(){r.hasClass("in")?(v=!0,r.addClass("temporaryHide")):r.removeClass("temporaryHide"),r.modal("toggle")}function b(e){e&&e.newMedia&&e.newMedia.type=="webmap"&&(r.find(".title").val()||r.find(".title").val(e.newMedia.webmap.title)),E()}function w(){var e=[],t=r.find(".title").val().replace(/<\/?script>/g,""),n=d.getData(),i=function(){if(!t&&c.layout!="bullet")r.find(".titleContainer").addClass("has-feedback has-error");else if(!e.length){if(n.media&&n.media.type=="webmap"&&n.media.webmap.extent){var i=s.getLayoutExtent(new o(n.media.webmap.extent),!0,!1);n.media.webmap.extent=i.toJson()}l.resolve({title:t,creaDate:Date.now(),status:"PUBLISHED",media:n.media,description:c.mode=="add"?"":c.entry.description}),r.modal("hide")}},a=d.checkError(p);if(a instanceof u){a.then(function(t){t&&e.push(0),i()});return}a&&e.push(0),i()}function E(){var e=r.find(".title").val().replace(/<\/?script>/g,""),t=d.getData(),n=!0;(e||c.layout=="bullet")&&t.media&&t.media.type&&t.media[t.media.type]&&(n=!1),c.mode=="edit"?p.html(i18n.commonCore.common.save):p.html(i18n.commonCore.common.add),p.toggleClass("disabled",!!n);if(n){var i=i18n.builder.addEditPopup.stepMainStageNextTooltip;r.find(".btnSubmitWrapper").tooltip("destroy").tooltip({container:".btnSubmitTooltipContainer",title:i.replace("%LBL_LAYOUT%",app.data.getWebAppData().getLayoutProperties().itemLbl.toLowerCase())})}else r.find(".btnSubmitWrapper").tooltip("destroy")}r.append(e({btnCancel:i18n.commonCore.common.cancel,btnBack:i18n.commonCore.common.back}));var l=null,c=null,h=null,p=r.find(".btnSubmit"),d=new n(r.find(".viewMediaSelectorContainer"),{onOpenConfigure:y,onCloseConfigure:y},!1,b,r.find(".btn-back")),v=null;m(),this.present=function(e){l=new u,c=e,h=[],v=!1,app.isAddEditInProgress=!0,e.mode=="add"?(r.find(".modal-logo").removeClass("edit"),r.find(".modal-title").html(i18n.builder.addEditPopup.titleAdd+" "+app.data.getWebAppData().getLayoutProperties().itemLbl),p.html(i18n.commonCore.common.add)):(r.find(".modal-logo").addClass("edit"),r.find(".modal-title").html(i18n.builder.addEditPopup.titleEdit+" "+app.data.getWebAppData().getLayoutProperties().itemLbl),p.html(i18n.commonCore.common.save)),r.find(".title").attr("placeholder",i18n.builder.addEditPopup.titlePlaceholder.replace("%LBL_LAYOUT%",app.data.getWebAppData().getLayoutProperties().itemLbl)),r.toggleClass("isAdding",e.mode=="add"),r.toggleClass("isEditing",e.mode!="add"),E(),r.find(".titleContainer").removeClass("has-feedback has-error").find(".title").val(e.mode=="edit"?e.entry.title:"");var t=!1;if(i.getMapOptions().mapsSync===!1)t=!0;else if(e.webmaps.length===0)t=!0;else{var n=Number.MAX_VALUE;$.each(e.webmaps,function(e,t){var r=Math.min.apply(null,t.entries);n=Math.min(n,r)});if(n===Number.MAX_VALUE||e.entryIndex<n)t=!0}return d.present({mode:e.mode,webmaps:e.webmaps,media:e.entry?e.entry.media:null,options:{mapsSyncAppOption:app.appCfg.mapsSyncAppOption,showLocationControl:t,hideOverview:!0}}),r.modal({keyboard:!0}),l},this.close=function(){r.modal("hide"),l.reject()},this.getAddEditEntryTitle=function(){return r.find(".title").val().replace(/<\/?script>/g,"")},this.initLocalization=function(){}}}),define("lib-build/tpl!storymaps/tpl/builder/OrganizePopup",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\n	<div class="modal-content">\n		<div class="modal-logo"></div>\n		<div class="modal-header">\n			<h4 class="modal-title">'+((__t=title)==null?"":__t)+'</h4>\n		</div>\n\n		<div class="modal-body">\n			<div class="organizeHeader"></div>\n			\n			<div class="organizeTableContainer">\n				<table class="organizeTable table table-striped">\n					<thead>\n					<tr style="height: 39px">\n						<th class="moverHeader">&nbsp;</th>\n						<th>'+((__t=lblColTitle)==null?"":__t)+'</th>\n						<th style="width: 80px;">'+((__t=lblColStatus)==null?"":__t)+'</th>\n						<th style="width: 44px;"></th>\n					</tr>\n					</thead>\n					<tbody class="rows">\n						<!-- rows -->\n					</tbody>\n				</table>\n			</div>\n		</div>\n\n		<div class="modal-footer">\n			<button type="button" class="btn btnApply btn-primary"></button>\n			<button type="button" class="btn btnCancel btn-naked btn-close" data-dismiss="modal">'+((__t=btnCancel)==null?"":__t)+"</button>\n		</div>\n	</div>\n</div>";return __p}}),define("lib-build/css!storymaps/tpl/builder/OrganizePopup",[],function(){}),define("lib-build/tpl!storymaps/tpl/builder/OrganizePopupEntry",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<tr class="sectionRow ui-state-highlight" data-index="'+((__t=index)==null?"":__t)+'">\n	<td class="mover"></td>\n	<td class="entryTitle">'+((__t=title)==null?"":__t)+'</td>\n	<td class="status" data-value="'+((__t=statusVal)==null?"":__t)+'">\n		<div class="btn-group dropup">\n			<button class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown">\n				<span class="status-list-btn" data-value="'+((__t=statusVal)==null?"":__t)+'">'+((__t=statusLbl)==null?"":__t)+'</span>&nbsp;<span class="caret"></span>\n			</button>\n			<ul class="dropdown-menu status-list" role="menu"></ul>\n		</div>\n	</td>\n	<td>\n		<button type="button" class="btn btn-default btn-md glyphicon glyphicon-trash deleteSectionBtn" data-toggle="tooltip" title="'+((__t=helpDelete)==null?"":__t)+'"></button>\n	</td>\n</tr>';return __p}}),function(e,t){function n(t,n){var i,s,o,u=t.nodeName.toLowerCase();return"area"===u?(i=t.parentNode,s=i.name,t.href&&s&&"map"===i.nodeName.toLowerCase()?(o=e("img[usemap=#"+s+"]")[0],!!o&&r(o)):!1):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&r(t)}function r(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var i=0,s=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,r){return"number"==typeof n?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),r&&r.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var r,i,s=e(this[0]);s.length&&s[0]!==document;){if(r=s.css("position"),("absolute"===r||"relative"===r||"fixed"===r)&&(i=parseInt(s.css("zIndex"),10),!isNaN(i)&&0!==i))return i;s=s.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++i)})},removeUniqueId:function(){return this.each(function(){s.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function i(t,n,r,i){return e.each(s,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),i&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var s="Width"===r?["Left","Right"]:["Top","Bottom"],o=r.toLowerCase(),u={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?u["inner"+r].call(this):this.each(function(){e(this).css(o,i(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return"number"!=typeof t?u["outer"+r].call(this,t):this.each(function(){e(this).css(o,i(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(i&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(r=0;i.length>r;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var r=n&&"left"===n?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)}})}(jQuery),function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n,r=0;null!=(n=t[r]);r++)try{e(n).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(n,r,i){var s,o,u,a,f={},l=n.split(".")[0];n=n.split(".")[1],s=l+"-"+n,i||(i=r,r=e.Widget),e.expr[":"][s.toLowerCase()]=function(t){return!!e.data(t,s)},e[l]=e[l]||{},o=e[l][n],u=e[l][n]=function(e,n){return this._createWidget?(arguments.length&&this._createWidget(e,n),t):new u(e,n)},e.extend(u,o,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),a=new r,a.options=e.widget.extend({},a.options),e.each(i,function(n,i){return e.isFunction(i)?(f[n]=function(){var e=function(){return r.prototype[n].apply(this,arguments)},t=function(e){return r.prototype[n].apply(this,e)};return function(){var n,r=this._super,s=this._superApply;return this._super=e,this._superApply=t,n=i.apply(this,arguments),this._super=r,this._superApply=s,n}}(),t):(f[n]=i,t)}),u.prototype=e.widget.extend(a,{widgetEventPrefix:o?a.widgetEventPrefix||n:n},f,{constructor:u,namespace:l,widgetName:n,widgetFullName:s}),o?(e.each(o._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,u,n._proto)}),delete o._childConstructors):r._childConstructors.push(u),e.widget.bridge(n,u)},e.widget.extend=function(n){for(var i,o,u=r.call(arguments,1),a=0,f=u.length;f>a;a++)for(i in u[a])o=u[a][i],u[a].hasOwnProperty(i)&&o!==t&&(n[i]=e.isPlainObject(o)?e.isPlainObject(n[i])?e.widget.extend({},n[i],o):e.widget.extend({},o):o);return n},e.widget.bridge=function(n,i){var o=i.prototype.widgetFullName||n;e.fn[n]=function(u){var a="string"==typeof u,f=r.call(arguments,1),l=this;return u=!a&&f.length?e.widget.extend.apply(null,[u].concat(f)):u,a?this.each(function(){var r,i=e.data(this,o);return i?e.isFunction(i[u])&&"_"!==u.charAt(0)?(r=i[u].apply(i,f),r!==i&&r!==t?(l=r&&r.jquery?l.pushStack(r.get()):r,!1):t):e.error("no such method '"+u+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+u+"'")}):this.each(function(){var t=e.data(this,o);t?t.option(u||{})._init():e.data(this,o,new i(u,this))}),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i,s,o,u=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(u={},i=n.split("."),n=i.shift(),i.length){for(s=u[n]=e.widget.extend({},this.options[n]),o=0;i.length-1>o;o++)s[i[o]]=s[i[o]]||{},s=s[i[o]];if(n=i.pop(),1===arguments.length)return s[n]===t?null:s[n];s[n]=r}else{if(1===arguments.length)return this.options[n]===t?null:this.options[n];u[n]=r}return this._setOptions(u),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(n,r,i){var s,o=this;"boolean"!=typeof n&&(i=r,r=n,n=!1),i?(r=s=e(r),this.bindings=this.bindings.add(r)):(i=r,r=this.element,s=this.widget()),e.each(i,function(i,u){function f(){return n||o.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof u?o[u]:u).apply(o,arguments):t}"string"!=typeof u&&(f.guid=u.guid=u.guid||f.guid||e.guid++);var l=i.match(/^(\w+)\s*(.*)$/),c=l[1]+o.eventNamespace,h=l[2];h?s.delegate(h,c,f):r.bind(c,f)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];if(r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){"string"==typeof i&&(i={effect:i});var o,u=i?i===!0||"number"==typeof i?n:i.effect||n:t;i=i||{},"number"==typeof i&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}})}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){return!0===e.data(n.target,t.widgetName+".preventClickEvent")?(e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):undefined}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(n){if(!t){this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var r=this,i=1===n.which,s="string"==typeof this.options.cancel&&n.target.nodeName?e(n.target).closest(this.options.cancel).length:!1;return i&&!s&&this._mouseCapture(n)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=this._mouseStart(n)!==!1,!this._mouseStarted)?(n.preventDefault(),!0):(!0===e.data(n.target,this.widgetName+".preventClickEvent")&&e.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function n(e,t,n){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?n/100:1)]}function r(t,n){return parseInt(e.css(t,n),10)||0}function i(t){var n=t[0];return 9===n.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(n)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var s,o=Math.max,u=Math.abs,a=Math.round,f=/left|center|right/,l=/top|center|bottom/,c=/[\+\-]\d+(\.[\d]+)?%?/,h=/^\w+/,p=/%$/,d=e.fn.position;e.position={scrollbarWidth:function(){if(s!==t)return s;var n,r,i=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=i.children()[0];return e("body").append(i),n=o.offsetWidth,i.css("overflow","scroll"),r=o.offsetWidth,n===r&&(r=i[0].clientWidth),i.remove(),s=n-r},getScrollInfo:function(t){var n=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),r=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),i="scroll"===n||"auto"===n&&t.width<t.element[0].scrollWidth,s="scroll"===r||"auto"===r&&t.height<t.element[0].scrollHeight;return{width:s?e.position.scrollbarWidth():0,height:i?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]),i=!!n[0]&&9===n[0].nodeType;return{element:n,isWindow:r,isDocument:i,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return d.apply(this,arguments);t=e.extend({},t);var s,p,v,m,g,y,b=e(t.of),w=e.position.getWithinInfo(t.within),E=e.position.getScrollInfo(w),S=(t.collision||"flip").split(" "),x={};return y=i(b),b[0].preventDefault&&(t.at="left top"),p=y.width,v=y.height,m=y.offset,g=e.extend({},m),e.each(["my","at"],function(){var e,n,r=(t[this]||"").split(" ");1===r.length&&(r=f.test(r[0])?r.concat(["center"]):l.test(r[0])?["center"].concat(r):["center","center"]),r[0]=f.test(r[0])?r[0]:"center",r[1]=l.test(r[1])?r[1]:"center",e=c.exec(r[0]),n=c.exec(r[1]),x[this]=[e?e[0]:0,n?n[0]:0],t[this]=[h.exec(r[0])[0],h.exec(r[1])[0]]}),1===S.length&&(S[1]=S[0]),"right"===t.at[0]?g.left+=p:"center"===t.at[0]&&(g.left+=p/2),"bottom"===t.at[1]?g.top+=v:"center"===t.at[1]&&(g.top+=v/2),s=n(x.at,p,v),g.left+=s[0],g.top+=s[1],this.each(function(){var i,f,l=e(this),c=l.outerWidth(),h=l.outerHeight(),d=r(this,"marginLeft"),y=r(this,"marginTop"),T=c+d+r(this,"marginRight")+E.width,N=h+y+r(this,"marginBottom")+E.height,C=e.extend({},g),L=n(x.my,l.outerWidth(),l.outerHeight());"right"===t.my[0]?C.left-=c:"center"===t.my[0]&&(C.left-=c/2),"bottom"===t.my[1]?C.top-=h:"center"===t.my[1]&&(C.top-=h/2),C.left+=L[0],C.top+=L[1],e.support.offsetFractions||(C.left=a(C.left),C.top=a(C.top)),i={marginLeft:d,marginTop:y},e.each(["left","top"],function(n,r){e.ui.position[S[n]]&&e.ui.position[S[n]][r](C,{targetWidth:p,targetHeight:v,elemWidth:c,elemHeight:h,collisionPosition:i,collisionWidth:T,collisionHeight:N,offset:[s[0]+L[0],s[1]+L[1]],my:t.my,at:t.at,within:w,elem:l})}),t.using&&(f=function(e){var n=m.left-C.left,r=n+p-c,i=m.top-C.top,s=i+v-h,a={target:{element:b,left:m.left,top:m.top,width:p,height:v},element:{element:l,left:C.left,top:C.top,width:c,height:h},horizontal:0>r?"left":n>0?"right":"center",vertical:0>s?"top":i>0?"bottom":"middle"};c>p&&p>u(n+r)&&(a.horizontal="center"),h>v&&v>u(i+s)&&(a.vertical="middle"),a.important=o(u(n),u(r))>o(u(i),u(s))?"horizontal":"vertical",t.using.call(this,e,a)}),l.offset(e.extend(C,{using:f}))})},e.ui.position={fit:{left:function(e,t){var n,r=t.within,i=r.isWindow?r.scrollLeft:r.offset.left,s=r.width,u=e.left-t.collisionPosition.marginLeft,a=i-u,f=u+t.collisionWidth-s-i;t.collisionWidth>s?a>0&&0>=f?(n=e.left+a+t.collisionWidth-s-i,e.left+=a-n):e.left=f>0&&0>=a?i:a>f?i+s-t.collisionWidth:i:a>0?e.left+=a:f>0?e.left-=f:e.left=o(e.left-u,e.left)},top:function(e,t){var n,r=t.within,i=r.isWindow?r.scrollTop:r.offset.top,s=t.within.height,u=e.top-t.collisionPosition.marginTop,a=i-u,f=u+t.collisionHeight-s-i;t.collisionHeight>s?a>0&&0>=f?(n=e.top+a+t.collisionHeight-s-i,e.top+=a-n):e.top=f>0&&0>=a?i:a>f?i+s-t.collisionHeight:i:a>0?e.top+=a:f>0?e.top-=f:e.top=o(e.top-u,e.top)}},flip:{left:function(e,t){var n,r,i=t.within,s=i.offset.left+i.scrollLeft,o=i.width,a=i.isWindow?i.scrollLeft:i.offset.left,f=e.left-t.collisionPosition.marginLeft,l=f-a,c=f+t.collisionWidth-o-a,h="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,d=-2*t.offset[0];0>l?(n=e.left+h+p+d+t.collisionWidth-o-s,(0>n||u(l)>n)&&(e.left+=h+p+d)):c>0&&(r=e.left-t.collisionPosition.marginLeft+h+p+d-a,(r>0||c>u(r))&&(e.left+=h+p+d))},top:function(e,t){var n,r,i=t.within,s=i.offset.top+i.scrollTop,o=i.height,a=i.isWindow?i.scrollTop:i.offset.top,f=e.top-t.collisionPosition.marginTop,l=f-a,c=f+t.collisionHeight-o-a,h="top"===t.my[1],p=h?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,d="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,v=-2*t.offset[1];0>l?(r=e.top+p+d+v+t.collisionHeight-o-s,e.top+p+d+v>l&&(0>r||u(l)>r)&&(e.top+=p+d+v)):c>0&&(n=e.top-t.collisionPosition.marginTop+p+d+v-a,e.top+p+d+v>c&&(n>0||c>u(n))&&(e.top+=p+d+v))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in r)t.style[s]=r[s];t.appendChild(u),n=o||document.documentElement,n.insertBefore(t,n.firstChild),u.style.cssText="position: absolute; left: 10.7432222px;",i=e(u).offset().left,e.support.offsetFractions=i>10&&11>i,t.innerHTML="",n.removeChild(t)}()}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(n){var r=this.options;return this.helper||r.disabled||e(n.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(n),this.handle?(e(r.iframeFix===!0?"iframe":r.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(n){var r=this.options;return this.helper=this._createHelper(n),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:n.pageX-this.offset.left,top:n.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(n),this.originalPageX=n.pageX,this.originalPageY=n.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this._setContainment(),this._trigger("start",n)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,n),this._mouseDrag(n,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,n),!0)},_mouseDrag:function(n,r){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(n),this.positionAbs=this._convertPositionTo("absolute"),!r){var i=this._uiHash();if(this._trigger("drag",n,i)===!1)return this._mouseUp({}),!1;this.position=i.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,n),!1},_mouseStop:function(n){var r=this,i=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,n)),this.dropped&&(i=this.dropped,this.dropped=!1),"original"!==this.options.helper||e.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!i||"valid"===this.options.revert&&i||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",n)!==!1&&r._clear()}):this._trigger("stop",n)!==!1&&this._clear(),!1):!1},_mouseUp:function(n){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,n),e.ui.mouse.prototype._mouseUp.call(this,n)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(n){return this.options.handle?!!e(n.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(n){var r=this.options,i=e.isFunction(r.helper)?e(r.helper.apply(this.element[0],[n])):"clone"===r.helper?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo("parent"===r.appendTo?this.element[0].parentNode:r.appendTo),i[0]===this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_adjustOffsetFromHelper:function(n){"string"==typeof n&&(n=n.split(" ")),e.isArray(n)&&(n={left:+n[0],top:+n[1]||0}),"left"in n&&(this.offset.click.left=n.left+this.margins.left),"right"in n&&(this.offset.click.left=this.helperProportions.width-n.right+this.margins.left),"top"in n&&(this.offset.click.top=n.top+this.margins.top),"bottom"in n&&(this.offset.click.top=this.helperProportions.height-n.bottom+this.margins.top)},_getParentOffset:function(){var n=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(n.left+=this.scrollParent.scrollLeft(),n.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(n={top:0,left:0}),{top:n.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:n.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var n,r,i,s=this.options;return s.containment?"window"===s.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):"document"===s.containment?(this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):s.containment.constructor===Array?(this.containment=s.containment,undefined):("parent"===s.containment&&(s.containment=this.helper[0].parentNode),r=e(s.containment),i=r[0],i&&(n="hidden"!==r.css("overflow"),this.containment=[(parseInt(r.css("borderLeftWidth"),10)||0)+(parseInt(r.css("paddingLeft"),10)||0),(parseInt(r.css("borderTopWidth"),10)||0)+(parseInt(r.css("paddingTop"),10)||0),(n?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(r.css("borderRightWidth"),10)||0)-(parseInt(r.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(n?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(r.css("borderBottomWidth"),10)||0)-(parseInt(r.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=r),undefined):(this.containment=null,undefined)},_convertPositionTo:function(n,r){r||(r=this.position);var i="absolute"===n?1:-1,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:s.scrollTop(),left:s.scrollLeft()}),{top:r.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*i,left:r.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*i}},_generatePosition:function(n){var r,i,s,o,u=this.options,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=n.pageX,l=n.pageY;return this.offset.scroll||(this.offset.scroll={top:a.scrollTop(),left:a.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(i=this.relative_container.offset(),r=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):r=this.containment,n.pageX-this.offset.click.left<r[0]&&(f=r[0]+this.offset.click.left),n.pageY-this.offset.click.top<r[1]&&(l=r[1]+this.offset.click.top),n.pageX-this.offset.click.left>r[2]&&(f=r[2]+this.offset.click.left),n.pageY-this.offset.click.top>r[3]&&(l=r[3]+this.offset.click.top)),u.grid&&(s=u.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/u.grid[1])*u.grid[1]:this.originalPageY,l=r?s-this.offset.click.top>=r[1]||s-this.offset.click.top>r[3]?s:s-this.offset.click.top>=r[1]?s-u.grid[1]:s+u.grid[1]:s,o=u.grid[0]?this.originalPageX+Math.round((f-this.originalPageX)/u.grid[0])*u.grid[0]:this.originalPageX,f=r?o-this.offset.click.left>=r[0]||o-this.offset.click.left>r[2]?o:o-this.offset.click.left>=r[0]?o-u.grid[0]:o+u.grid[0]:o)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(n,r,i){return i=i||this._uiHash(),e.ui.plugin.call(this,n,[r,i]),"drag"===n&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,n,r,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(n,r){var i=e(this).data("ui-draggable"),s=i.options,o=e.extend({},r,{item:i.element});i.sortables=[],e(s.connectToSortable).each(function(){var r=e.data(this,"ui-sortable");r&&!r.options.disabled&&(i.sortables.push({instance:r,shouldRevert:r.options.revert}),r.refreshPositions(),r._trigger("activate",n,o))})},stop:function(n,r){var i=e(this).data("ui-draggable"),s=e.extend({},r,{item:i.element});e.each(i.sortables,function(){this.instance.isOver?(this.instance.isOver=0,i.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(n),this.instance.options.helper=this.instance.options._helper,"original"===i.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",n,s))})},drag:function(n,r){var i=e(this).data("ui-draggable"),s=this;e.each(i.sortables,function(){var o=!1,u=this;this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(i.sortables,function(){return this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this!==u&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(u.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(s).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return r.helper[0]},n.target=this.instance.currentItem[0],this.instance._mouseCapture(n,!0),this.instance._mouseStart(n,!0,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i._trigger("toSortable",n),i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i),this.instance.currentItem&&this.instance._mouseDrag(n)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",n,this.instance._uiHash(this.instance)),this.instance._mouseStop(n,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i._trigger("fromSortable",n),i.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var n=e("body"),r=e(this).data("ui-draggable").options;n.css("cursor")&&(r._cursor=n.css("cursor")),n.css("cursor",r.cursor)},stop:function(){var n=e(this).data("ui-draggable").options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(n,r){var i=e(r.helper),s=e(this).data("ui-draggable").options;i.css("opacity")&&(s._opacity=i.css("opacity")),i.css("opacity",s.opacity)},stop:function(n,r){var i=e(this).data("ui-draggable").options;i._opacity&&e(r.helper).css("opacity",i._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var n=e(this).data("ui-draggable");n.scrollParent[0]!==document&&"HTML"!==n.scrollParent[0].tagName&&(n.overflowOffset=n.scrollParent.offset())},drag:function(n){var r=e(this).data("ui-draggable"),i=r.options,s=!1;r.scrollParent[0]!==document&&"HTML"!==r.scrollParent[0].tagName?(i.axis&&"x"===i.axis||(r.overflowOffset.top+r.scrollParent[0].offsetHeight-n.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed:n.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&"y"===i.axis||(r.overflowOffset.left+r.scrollParent[0].offsetWidth-n.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed:n.pageX-r.overflowOffset.left<i.scrollSensitivity&&(r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&"x"===i.axis||(n.pageY-e(document).scrollTop()<i.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(n.pageY-e(document).scrollTop())<i.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed))),i.axis&&"y"===i.axis||(n.pageX-e(document).scrollLeft()<i.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(n.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed)))),s!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,n)}}),e.ui.plugin.add("draggable","snap",{start:function(){var n=e(this).data("ui-draggable"),r=n.options;n.snapElements=[],e(r.snap.constructor!==String?r.snap.items||":data(ui-draggable)":r.snap).each(function(){var r=e(this),i=r.offset();this!==n.element[0]&&n.snapElements.push({item:this,width:r.outerWidth(),height:r.outerHeight(),top:i.top,left:i.left})})},drag:function(n,r){var i,s,o,u,a,f,l,c,h,p,d=e(this).data("ui-draggable"),v=d.options,m=v.snapTolerance,g=r.offset.left,y=g+d.helperProportions.width,b=r.offset.top,w=b+d.helperProportions.height;for(h=d.snapElements.length-1;h>=0;h--)a=d.snapElements[h].left,f=a+d.snapElements[h].width,l=d.snapElements[h].top,c=l+d.snapElements[h].height,a-m>y||g>f+m||l-m>w||b>c+m||!e.contains(d.snapElements[h].item.ownerDocument,d.snapElements[h].item)?(d.snapElements[h].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,n,e.extend(d._uiHash(),{snapItem:d.snapElements[h].item})),d.snapElements[h].snapping=!1):("inner"!==v.snapMode&&(i=m>=Math.abs(l-w),s=m>=Math.abs(c-b),o=m>=Math.abs(a-y),u=m>=Math.abs(f-g),i&&(r.position.top=d._convertPositionTo("relative",{top:l-d.helperProportions.height,left:0}).top-d.margins.top),s&&(r.position.top=d._convertPositionTo("relative",{top:c,left:0}).top-d.margins.top),o&&(r.position.left=d._convertPositionTo("relative",{top:0,left:a-d.helperProportions.width}).left-d.margins.left),u&&(r.position.left=d._convertPositionTo("relative",{top:0,left:f}).left-d.margins.left)),p=i||s||o||u,"outer"!==v.snapMode&&(i=m>=Math.abs(l-b),s=m>=Math.abs(c-w),o=m>=Math.abs(a-g),u=m>=Math.abs(f-y),i&&(r.position.top=d._convertPositionTo("relative",{top:l,left:0}).top-d.margins.top),s&&(r.position.top=d._convertPositionTo("relative",{top:c-d.helperProportions.height,left:0}).top-d.margins.top),o&&(r.position.left=d._convertPositionTo("relative",{top:0,left:a}).left-d.margins.left),u&&(r.position.left=d._convertPositionTo("relative",{top:0,left:f-d.helperProportions.width}).left-d.margins.left)),!d.snapElements[h].snapping&&(i||s||o||u||p)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,n,e.extend(d._uiHash(),{snapItem:d.snapElements[h].item})),d.snapElements[h].snapping=i||s||o||u||p)}}),e.ui.plugin.add("draggable","stack",{start:function(){var n,r=this.data("ui-draggable").options,i=e.makeArray(e(r.stack)).sort(function(n,r){return(parseInt(e(n).css("zIndex"),10)||0)-(parseInt(e(r).css("zIndex"),10)||0)});i.length&&(n=parseInt(e(i[0]).css("zIndex"),10)||0,e(i).each(function(r){e(this).css("zIndex",n+r)}),this.css("zIndex",n+i.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(n,r){var i=e(r.helper),s=e(this).data("ui-draggable").options;i.css("zIndex")&&(s._zIndex=i.css("zIndex")),i.css("zIndex",s.zIndex)},stop:function(n,r){var i=e(this).data("ui-draggable").options;i._zIndex&&e(r.helper).css("zIndex",i._zIndex)}})}(jQuery),function(e){function t(e,t,n){return e>t&&t+n>e}e.widget("ui.droppable",{version:"1.10.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,n=this.options,r=n.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(r)?r:function(e){return e.is(r)},this.proportions=function(){return arguments.length?(t=arguments[0],undefined):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},e.ui.ddmanager.droppables[n.scope]=e.ui.ddmanager.droppables[n.scope]||[],e.ui.ddmanager.droppables[n.scope].push(this),n.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=0,n=e.ui.ddmanager.droppables[this.options.scope];n.length>t;t++)n[t]===this&&n.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,n){"accept"===t&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)))},_out:function(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)))},_drop:function(t,n){var r=n||e.ui.ddmanager.current,i=!1;return r&&(r.currentItem||r.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"ui-droppable");return t.options.greedy&&!t.options.disabled&&t.options.scope===r.options.scope&&t.accept.call(t.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(i=!0,!1):undefined}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(e,n,r){if(!n.offset)return!1;var i,s,o=(e.positionAbs||e.position.absolute).left,u=(e.positionAbs||e.position.absolute).top,a=o+e.helperProportions.width,f=u+e.helperProportions.height,l=n.offset.left,c=n.offset.top,h=l+n.proportions().width,p=c+n.proportions().height;switch(r){case"fit":return o>=l&&h>=a&&u>=c&&p>=f;case"intersect":return o+e.helperProportions.width/2>l&&h>a-e.helperProportions.width/2&&u+e.helperProportions.height/2>c&&p>f-e.helperProportions.height/2;case"pointer":return i=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,s=(e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,t(s,c,n.proportions().height)&&t(i,l,n.proportions().width);case"touch":return(u>=c&&p>=u||f>=c&&p>=f||c>u&&f>p)&&(o>=l&&h>=o||a>=l&&h>=a||l>o&&a>h);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r,i,s=e.ui.ddmanager.droppables[t.options.scope]||[],o=n?n.type:null,u=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(r=0;s.length>r;r++)if(!(s[r].options.disabled||t&&!s[r].accept.call(s[r].element[0],t.currentItem||t.element))){for(i=0;u.length>i;i++)if(u[i]===s[r].element[0]){s[r].proportions().height=0;continue e}s[r].visible="none"!==s[r].element.css("display"),s[r].visible&&("mousedown"===o&&s[r]._activate.call(s[r],n),s[r].offset=s[r].element.offset(),s[r].proportions({width:s[r].element[0].offsetWidth,height:s[r].element[0].offsetHeight}))}},drop:function(t,n){var r=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(r=this._drop.call(this,n)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,n)))}),r},dragStart:function(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var r,s,o,u=e.ui.intersect(t,this,this.options.tolerance),a=!u&&this.isover?"isout":u&&!this.isover?"isover":null;a&&(this.options.greedy&&(s=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return e.data(this,"ui-droppable").options.scope===s}),o.length&&(r=e.data(o[0],"ui-droppable"),r.greedyChild="isover"===a)),r&&"isover"===a&&(r.isover=!1,r.isout=!0,r._out.call(r,n)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,n),r&&"isout"===a&&(r.isout=!1,r.isover=!0,r._over.call(r,n)))}})},dragStop:function(t,n){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}}}(jQuery),function(e){function t(e){return parseInt(e,10)||0}function n(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,n,r,i,s,o=this,u=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!u.aspectRatio,aspectRatio:u.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:u.helper||u.ghost||u.animate?u.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=u.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},n=0;t.length>n;n++)r=e.trim(t[n]),s="ui-resizable-"+r,i=e("<div class='ui-resizable-handle "+s+"'></div>"),i.css({zIndex:u.zIndex}),"se"===r&&i.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(i);this._renderAxis=function(t){var n,r,i,s;t=t||this.element;for(n in this.handles)this.handles[n].constructor===String&&(this.handles[n]=e(this.handles[n],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(r=e(this.handles[n],this.element),s=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth(),i=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(i,s),this._proportionallyResize()),e(this.handles[n]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(i=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=i&&i[1]?i[1]:"se")}),u.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){u.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){u.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,n=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(n(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_mouseCapture:function(t){var n,r,i=!1;for(n in this.handles)r=e(this.handles[n])[0],(r===t.target||e.contains(r,t.target))&&(i=!0);return!this.options.disabled&&i},_mouseStart:function(n){var r,i,s,o=this.options,u=this.element.position(),a=this.element;return this.resizing=!0,/absolute/.test(a.css("position"))?a.css({position:"absolute",top:a.css("top"),left:a.css("left")}):a.is(".ui-draggable")&&a.css({position:"absolute",top:u.top,left:u.left}),this._renderProxy(),r=t(this.helper.css("left")),i=t(this.helper.css("top")),o.containment&&(r+=e(o.containment).scrollLeft()||0,i+=e(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:r,top:i},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalPosition={left:r,top:i},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalMousePosition={left:n.pageX,top:n.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,s=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===s?this.axis+"-resize":s),a.addClass("ui-resizable-resizing"),this._propagate("start",n),!0},_mouseDrag:function(t){var n,r=this.helper,i={},s=this.originalMousePosition,o=this.axis,u=this.position.top,a=this.position.left,f=this.size.width,l=this.size.height,c=t.pageX-s.left||0,h=t.pageY-s.top||0,p=this._change[o];return p?(n=p.apply(this,[t,c,h]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(n=this._updateRatio(n,t)),n=this._respectSize(n,t),this._updateCache(n),this._propagate("resize",t),this.position.top!==u&&(i.top=this.position.top+"px"),this.position.left!==a&&(i.left=this.position.left+"px"),this.size.width!==f&&(i.width=this.size.width+"px"),this.size.height!==l&&(i.height=this.size.height+"px"),r.css(i),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(i)||this._trigger("resize",t,this.ui()),!1):!1},_mouseStop:function(t){this.resizing=!1;var n,r,i,s,o,u,a,f=this.options,l=this;return this._helper&&(n=this._proportionallyResizeElements,r=n.length&&/textarea/i.test(n[0].nodeName),i=r&&e.ui.hasScroll(n[0],"left")?0:l.sizeDiff.height,s=r?0:l.sizeDiff.width,o={width:l.helper.width()-s,height:l.helper.height()-i},u=parseInt(l.element.css("left"),10)+(l.position.left-l.originalPosition.left)||null,a=parseInt(l.element.css("top"),10)+(l.position.top-l.originalPosition.top)||null,f.animate||this.element.css(e.extend(o,{top:a,left:u})),l.helper.height(l.size.height),l.helper.width(l.size.width),this._helper&&!f.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,r,s,o,u,a=this.options;u={minWidth:n(a.minWidth)?a.minWidth:0,maxWidth:n(a.maxWidth)?a.maxWidth:1/0,minHeight:n(a.minHeight)?a.minHeight:0,maxHeight:n(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||e)&&(t=u.minHeight*this.aspectRatio,s=u.minWidth/this.aspectRatio,r=u.maxHeight*this.aspectRatio,o=u.maxWidth/this.aspectRatio,t>u.minWidth&&(u.minWidth=t),s>u.minHeight&&(u.minHeight=s),u.maxWidth>r&&(u.maxWidth=r),u.maxHeight>o&&(u.maxHeight=o)),this._vBoundaries=u},_updateCache:function(e){this.offset=this.helper.offset(),n(e.left)&&(this.position.left=e.left),n(e.top)&&(this.position.top=e.top),n(e.height)&&(this.size.height=e.height),n(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,r=this.size,s=this.axis;return n(e.height)?e.width=e.height*this.aspectRatio:n(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(r.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(r.height-e.height),e.left=t.left+(r.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,r=this.axis,s=n(e.width)&&t.maxWidth&&t.maxWidth<e.width,o=n(e.height)&&t.maxHeight&&t.maxHeight<e.height,u=n(e.width)&&t.minWidth&&t.minWidth>e.width,a=n(e.height)&&t.minHeight&&t.minHeight>e.height,f=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,c=/sw|nw|w/.test(r),h=/nw|ne|n/.test(r);return u&&(e.width=t.minWidth),a&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),o&&(e.height=t.maxHeight),u&&c&&(e.left=f-t.minWidth),s&&c&&(e.left=f-t.maxWidth),a&&h&&(e.top=l-t.minHeight),o&&h&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var e,t,n,r,i,s=this.helper||this.element;for(e=0;this._proportionallyResizeElements.length>e;e++){if(i=this._proportionallyResizeElements[e],!this.borderDif)for(this.borderDif=[],n=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],r=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")],t=0;n.length>t;t++)this.borderDif[t]=(parseInt(n[t],10)||0)+(parseInt(r[t],10)||0);i.css({height:s.height()-this.borderDif[0]-this.borderDif[2]||0,width:s.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var n=this.originalSize,r=this.originalPosition;return{left:r.left+t,width:n.width-t}},n:function(e,t,n){var r=this.originalSize,i=this.originalPosition;return{top:i.top+n,height:r.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]))},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),"resize"!==t&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).data("ui-resizable"),r=n.options,i=n._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:n.sizeDiff.height,u=s?0:n.sizeDiff.width,a={width:n.size.width-u,height:n.size.height-o},f=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,l=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(a,l&&f?{top:l,left:f}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};i&&i.length&&e(i[0]).css({width:r.width,height:r.height}),n._updateCache(r),n._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var n,r,i,s,o,u,a,f=e(this).data("ui-resizable"),l=f.options,c=f.element,h=l.containment,p=h instanceof e?h.get(0):/parent/.test(h)?c.parent().get(0):h;p&&(f.containerElement=e(p),/document/.test(h)||h===document?(f.containerOffset={left:0,top:0},f.containerPosition={left:0,top:0},f.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(n=e(p),r=[],e(["Top","Right","Left","Bottom"]).each(function(e,i){r[e]=t(n.css("padding"+i))}),f.containerOffset=n.offset(),f.containerPosition=n.position(),f.containerSize={height:n.innerHeight()-r[3],width:n.innerWidth()-r[1]},i=f.containerOffset,s=f.containerSize.height,o=f.containerSize.width,u=e.ui.hasScroll(p,"left")?p.scrollWidth:o,a=e.ui.hasScroll(p)?p.scrollHeight:s,f.parentData={element:p,left:i.left,top:i.top,width:u,height:a}))},resize:function(t){var n,r,i,s,o=e(this).data("ui-resizable"),u=o.options,a=o.containerOffset,f=o.position,l=o._aspectRatio||t.shiftKey,c={top:0,left:0},h=o.containerElement;h[0]!==document&&/static/.test(h.css("position"))&&(c=a),f.left<(o._helper?a.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-a.left:o.position.left-c.left),l&&(o.size.height=o.size.width/o.aspectRatio),o.position.left=u.helper?a.left:0),f.top<(o._helper?a.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-a.top:o.position.top),l&&(o.size.width=o.size.height*o.aspectRatio),o.position.top=o._helper?a.top:0),o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top,n=Math.abs((o._helper?o.offset.left-c.left:o.offset.left-c.left)+o.sizeDiff.width),r=Math.abs((o._helper?o.offset.top-c.top:o.offset.top-a.top)+o.sizeDiff.height),i=o.containerElement.get(0)===o.element.parent().get(0),s=/relative|absolute/.test(o.containerElement.css("position")),i&&s&&(n-=Math.abs(o.parentData.left)),n+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-n,l&&(o.size.height=o.size.width/o.aspectRatio)),r+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-r,l&&(o.size.width=o.size.height*o.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.containerOffset,i=t.containerPosition,s=t.containerElement,o=e(t.helper),u=o.offset(),a=o.outerWidth()-t.sizeDiff.width,f=o.outerHeight()-t.sizeDiff.height;t._helper&&!n.animate&&/relative/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f}),t._helper&&!n.animate&&/static/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof n.alsoResize||n.alsoResize.parentNode?r(n.alsoResize):n.alsoResize.length?(n.alsoResize=n.alsoResize[0],r(n.alsoResize)):e.each(n.alsoResize,function(e){r(e)})},resize:function(t,n){var r=e(this).data("ui-resizable"),i=r.options,s=r.originalSize,o=r.originalPosition,u={height:r.size.height-s.height||0,width:r.size.width-s.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0},a=function(t,r){e(t).each(function(){var t=e(this),i=e(this).data("ui-resizable-alsoresize"),s={},o=r&&r.length?r:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var n=(i[t]||0)+(u[t]||0);n&&n>=0&&(s[t]=n||null)}),t.css(s)})};"object"!=typeof i.alsoResize||i.alsoResize.nodeType?a(i.alsoResize):e.each(i.alsoResize,function(e,t){a(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof n.ghost?n.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size,i=t.originalSize,s=t.originalPosition,o=t.axis,u="number"==typeof n.grid?[n.grid,n.grid]:n.grid,a=u[0]||1,f=u[1]||1,l=Math.round((r.width-i.width)/a)*a,c=Math.round((r.height-i.height)/f)*f,h=i.width+l,p=i.height+c,d=n.maxWidth&&h>n.maxWidth,v=n.maxHeight&&p>n.maxHeight,m=n.minWidth&&n.minWidth>h,g=n.minHeight&&n.minHeight>p;n.grid=u,m&&(h+=a),g&&(p+=f),d&&(h-=a),v&&(p-=f),/^(se|s|e)$/.test(o)?(t.size.width=h,t.size.height=p):/^(ne)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.top=s.top-c):/^(sw)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.left=s.left-l):(p-f>0?(t.size.height=p,t.position.top=s.top-c):(t.size.height=f,t.position.top=s.top+i.height-f),h-a>0?(t.size.width=h,t.position.left=s.left-l):(t.size.width=a,t.position.left=s.left+i.width-a))}})}(jQuery),function(e){e.widget("ui.selectable",e.ui.mouse,{version:"1.10.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var n,r=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){n=e(r.options.filter,r.element[0]),n.addClass("ui-selectee"),n.each(function(){var n=e(this),r=n.offset();e.data(this,"selectable-item",{element:this,$element:n,left:r.left,top:r.top,right:r.left+n.outerWidth(),bottom:r.top+n.outerHeight(),startselected:!1,selected:n.hasClass("ui-selected"),selecting:n.hasClass("ui-selecting"),unselecting:n.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=n.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(n){var r=this,i=this.options;this.opos=[n.pageX,n.pageY],this.options.disabled||(this.selectees=e(i.filter,this.element[0]),this._trigger("start",n),e(i.appendTo).append(this.helper),this.helper.css({left:n.pageX,top:n.pageY,width:0,height:0}),i.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var i=e.data(this,"selectable-item");i.startselected=!0,n.metaKey||n.ctrlKey||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,r._trigger("unselecting",n,{unselecting:i.element}))}),e(n.target).parents().addBack().each(function(){var i,s=e.data(this,"selectable-item");return s?(i=!n.metaKey&&!n.ctrlKey||!s.$element.hasClass("ui-selected"),s.$element.removeClass(i?"ui-unselecting":"ui-selected").addClass(i?"ui-selecting":"ui-unselecting"),s.unselecting=!i,s.selecting=i,s.selected=i,i?r._trigger("selecting",n,{selecting:s.element}):r._trigger("unselecting",n,{unselecting:s.element}),!1):undefined}))},_mouseDrag:function(n){if(this.dragged=!0,!this.options.disabled){var r,i=this,s=this.options,o=this.opos[0],u=this.opos[1],a=n.pageX,f=n.pageY;return o>a&&(r=a,a=o,o=r),u>f&&(r=f,f=u,u=r),this.helper.css({left:o,top:u,width:a-o,height:f-u}),this.selectees.each(function(){var r=e.data(this,"selectable-item"),c=!1;r&&r.element!==i.element[0]&&("touch"===s.tolerance?c=!(r.left>a||o>r.right||r.top>f||u>r.bottom):"fit"===s.tolerance&&(c=r.left>o&&a>r.right&&r.top>u&&f>r.bottom),c?(r.selected&&(r.$element.removeClass("ui-selected"),r.selected=!1),r.unselecting&&(r.$element.removeClass("ui-unselecting"),r.unselecting=!1),r.selecting||(r.$element.addClass("ui-selecting"),r.selecting=!0,i._trigger("selecting",n,{selecting:r.element}))):(r.selecting&&((n.metaKey||n.ctrlKey)&&r.startselected?(r.$element.removeClass("ui-selecting"),r.selecting=!1,r.$element.addClass("ui-selected"),r.selected=!0):(r.$element.removeClass("ui-selecting"),r.selecting=!1,r.startselected&&(r.$element.addClass("ui-unselecting"),r.unselecting=!0),i._trigger("unselecting",n,{unselecting:r.element}))),r.selected&&(n.metaKey||n.ctrlKey||r.startselected||(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,i._trigger("unselecting",n,{unselecting:r.element})))))}),!1}},_mouseStop:function(n){var r=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,r._trigger("unselected",n,{unselected:s.element})}),e(".ui-selecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,r._trigger("selected",n,{selected:s.element})}),this._trigger("stop",n),this.helper.remove(),!1}})}(jQuery),function(e){function t(e,t,n){return e>t&&t+n>e}function n(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||n(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){"disabled"===t?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var r=null,i=!1,s=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,s.widgetName+"-item")===s?(r=e(this),!1):undefined}),e.data(t.target,s.widgetName+"-item")===s&&(r=e(t.target)),r?!this.options.handle||n||(e(this.options.handle,r).find("*").addBack().each(function(){this===t.target&&(i=!0)}),i)?(this.currentItem=r,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,n,r){var i,s,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(s=this.document.find("body"),this.storedCursor=s.css("cursor"),s.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(s)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var n,r,i,s,o=this.options,u=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-e(document).scrollTop()<o.scrollSensitivity?u=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(u=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed)),t.pageX-e(document).scrollLeft()<o.scrollSensitivity?u=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(u=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed))),u!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),n=this.items.length-1;n>=0;n--)if(r=this.items[n],i=r.item[0],s=this._intersectsWithPointer(r),s&&r.instance===this.currentContainer&&i!==this.currentItem[0]&&this.placeholder[1===s?"next":"prev"]()[0]!==i&&!e.contains(this.placeholder[0],i)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],i):!0)){if(this.direction=1===s?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var r=this,i=this.placeholder.offset(),s=this.options.axis,o={};s&&"x"!==s||(o.left=i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),s&&"y"!==s||(o.top=i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c="x"===this.options.axis||r+f>u&&a>r+f,h="y"===this.options.axis||t+l>s&&o>t+l,p=c&&h;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>s&&o>n-this.helperProportions.width/2&&r+this.helperProportions.height/2>u&&a>i-this.helperProportions.height/2},_intersectsWithPointer:function(e){var n="x"===this.options.axis||t(this.positionAbs.top+this.offset.click.top,e.top,e.height),r="y"===this.options.axis||t(this.positionAbs.left+this.offset.click.left,e.left,e.width),i=n&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return i?this.floating?o&&"right"===o||"down"===s?2:1:s&&("down"===s?2:1):!1},_intersectsWithSides:function(e){var n=t(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),r=t(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?"right"===s&&r||"left"===s&&!r:i&&("down"===i&&n||"up"===i&&!n)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function n(){u.push(this)}var r,i,s,o,u=[],a=[],f=this._connectWith();if(f&&t)for(r=f.length-1;r>=0;r--)for(s=e(f[r]),i=s.length-1;i>=0;i--)o=e.data(s[i],this.widgetFullName),o&&o!==this&&!o.options.disabled&&a.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(a.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),r=a.length-1;r>=0;r--)a[r][0].each(n);return e(u)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;t.length>n;n++)if(t[n]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n,r,i,s,o,u,a,f,l=this.items,c=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(n=h.length-1;n>=0;n--)for(i=e(h[n]),r=i.length-1;r>=0;r--)s=e.data(i[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&(c.push([e.isFunction(s.options.items)?s.options.items.call(s.element[0],t,{item:this.currentItem}):e(s.options.items,s.element),s]),this.containers.push(s));for(n=c.length-1;n>=0;n--)for(o=c[n][1],u=c[n][0],r=0,f=u.length;f>r;r++)a=e(u[r]),a.data(this.widgetName+"-item",o),l.push({item:a,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var n,r,i,s;for(n=this.items.length-1;n>=0;n--)r=this.items[n],r.instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item,t||(r.width=i.outerWidth(),r.height=i.outerHeight()),s=i.offset(),r.left=s.left,r.top=s.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)s=this.containers[n].element.offset(),this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var n,r=t.options;r.placeholder&&r.placeholder.constructor!==String||(n=r.placeholder,r.placeholder={element:function(){var r=t.currentItem[0].nodeName.toLowerCase(),s=e("<"+r+">",t.document[0]).addClass(n||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===r?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(s)}):"img"===r&&s.attr("src",t.currentItem.attr("src")),n||s.css("visibility","hidden"),s},update:function(e,o){(!n||r.forcePlaceholderSize)&&(o.height()||o.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),o.width()||o.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(r.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),r.placeholder.update(t,t.placeholder)},_contactContainers:function(r){var s,o,u,a,f,l,c,h,p,d,v=null,m=null;for(s=this.containers.length-1;s>=0;s--)if(!e.contains(this.currentItem[0],this.containers[s].element[0]))if(this._intersectsWith(this.containers[s].containerCache)){if(v&&e.contains(this.containers[s].element[0],v.element[0]))continue;v=this.containers[s],m=s}else this.containers[s].containerCache.over&&(this.containers[s]._trigger("out",r,this._uiHash(this)),this.containers[s].containerCache.over=0);if(v)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",r,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(u=1e4,a=null,d=v.floating||n(this.currentItem),f=d?"left":"top",l=d?"width":"height",c=this.positionAbs[f]+this.offset.click[f],o=this.items.length-1;o>=0;o--)e.contains(this.containers[m].element[0],this.items[o].item[0])&&this.items[o].item[0]!==this.currentItem[0]&&(!d||t(this.positionAbs.top+this.offset.click.top,this.items[o].top,this.items[o].height))&&(h=this.items[o].item.offset()[f],p=!1,Math.abs(h-c)>Math.abs(h+this.items[o][l]-c)&&(p=!0,h+=this.items[o][l]),u>Math.abs(h-c)&&(u=Math.abs(h-c),a=this.items[o],this.direction=p?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return;a?this._rearrange(r,a,null,!0):this._rearrange(r,null,this.containers[m].element,!0),this._trigger("change",r,this._uiHash()),this.containers[m]._trigger("change",r,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",r,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):"clone"===n.helper?this.currentItem.clone():this.currentItem;return r.parents("body").length||e("parent"!==n.appendTo?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!r[0].style.width||n.forceHelperSize)&&r.width(this.currentItem.width()),(!r[0].style.height||n.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,i=this.options;"parent"===i.containment&&(i.containment=this.helper[0].parentNode),("document"===i.containment||"window"===i.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===i.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===i.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(i.containment)||(t=e(i.containment)[0],n=e(i.containment).offset(),r="hidden"!==e(t).css("overflow"),this.containment=[n.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,n.left+(r?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(r?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,n){n||(n=this.position);var r="absolute"===t?1:-1,i="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(i[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():s?0:i.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():s?0:i.scrollLeft())*r}},_generatePosition:function(t){var n,r,i=this.options,s=t.pageX,o=t.pageY,u="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(u[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),i.grid&&(n=this.originalPageY+Math.round((o-this.originalPageY)/i.grid[1])*i.grid[1],o=this.containment?n-this.offset.click.top>=this.containment[1]&&n-this.offset.click.top<=this.containment[3]?n:n-this.offset.click.top>=this.containment[1]?n-i.grid[1]:n+i.grid[1]:n,r=this.originalPageX+Math.round((s-this.originalPageX)/i.grid[0])*i.grid[0],s=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-i.grid[0]:r+i.grid[0]:r)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:u.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:u.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i===this.counter&&this.refreshPositions(!r)})},_clear:function(e,t){function n(e,t,n){return function(r){n._trigger(e,r,t._uiHash(t))}}this.reverting=!1;var r,i=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(r in this._storedCSS)("auto"===this._storedCSS[r]||"static"===this._storedCSS[r])&&(this._storedCSS[r]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&i.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||i.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(i.push(function(e){this._trigger("remove",e,this._uiHash())}),i.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),i.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),r=this.containers.length-1;r>=0;r--)t||i.push(n("deactivate",this,this.containers[r])),this.containers[r].containerCache.over&&(i.push(n("out",this,this.containers[r])),this.containers[r].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),r=0;i.length>r;r++)i[r].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(r=0;i.length>r;r++)i[r].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}(jQuery),function(e,t){var n="ui-effects-";e.effects={effect:{}},function(e,t){function n(e,t,n){var r=c[t.type]||{};return null==e?n||!t.def?null:t.def:(e=r.floor?~~e:parseFloat(e),isNaN(e)?t.def:r.mod?(e+r.mod)%r.mod:0>e?0:e>r.max?r.max:e)}function r(n){var r=f(),i=r._rgba=[];return n=n.toLowerCase(),d(a,function(e,s){var o,u=s.re.exec(n),a=u&&s.parse(u),f=s.space||"rgba";return a?(o=r[f](a),r[l[f].cache]=o[l[f].cache],i=r._rgba=o._rgba,!1):t}),i.length?("0,0,0,0"===i.join()&&e.extend(i,s.transparent),r):s[n]}function i(e,t,n){return n=(n+1)%1,1>6*n?e+6*(t-e)*n:1>2*n?t:2>3*n?e+6*(t-e)*(2/3-n):e}var s,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",u=/^([\-+])=\s*(\d+\.?\d*)/,a=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],f=e.Color=function(t,n,r,i){return new e.Color.fn.parse(t,n,r,i)},l={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},c={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},h=f.support={},p=e("<p>")[0],d=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",h.rgba=p.style.backgroundColor.indexOf("rgba")>-1,d(l,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),f.fn=e.extend(f.prototype,{parse:function(i,o,u,a){if(i===t)return this._rgba=[null,null,null,null],this;(i.jquery||i.nodeType)&&(i=e(i).css(o),o=t);var c=this,h=e.type(i),p=this._rgba=[];return o!==t&&(i=[i,o,u,a],h="array"),"string"===h?this.parse(r(i)||s._default):"array"===h?(d(l.rgba.props,function(e,t){p[t.idx]=n(i[t.idx],t)}),this):"object"===h?(i instanceof f?d(l,function(e,t){i[t.cache]&&(c[t.cache]=i[t.cache].slice())}):d(l,function(t,r){var s=r.cache;d(r.props,function(e,t){if(!c[s]&&r.to){if("alpha"===e||null==i[e])return;c[s]=r.to(c._rgba)}c[s][t.idx]=n(i[e],t,!0)}),c[s]&&0>e.inArray(null,c[s].slice(0,3))&&(c[s][3]=1,r.from&&(c._rgba=r.from(c[s])))}),this):t},is:function(e){var n=f(e),r=!0,i=this;return d(l,function(e,s){var o,u=n[s.cache];return u&&(o=i[s.cache]||s.to&&s.to(i._rgba)||[],d(s.props,function(e,n){return null!=u[n.idx]?r=u[n.idx]===o[n.idx]:t})),r}),r},_space:function(){var e=[],t=this;return d(l,function(n,r){t[r.cache]&&e.push(n)}),e.pop()},transition:function(e,t){var r=f(e),i=r._space(),s=l[i],o=0===this.alpha()?f("transparent"):this,u=o[s.cache]||s.to(o._rgba),a=u.slice();return r=r[s.cache],d(s.props,function(e,i){var s=i.idx,o=u[s],f=r[s],l=c[i.type]||{};null!==f&&(null===o?a[s]=f:(l.mod&&(f-o>l.mod/2?o+=l.mod:o-f>l.mod/2&&(o-=l.mod)),a[s]=n((f-o)*t+o,i)))}),this[i](a)},blend:function(t){if(1===this._rgba[3])return this;var n=this._rgba.slice(),r=n.pop(),i=f(t)._rgba;return f(e.map(n,function(e,t){return(1-r)*i[t]+r*e}))},toRgbaString:function(){var t="rgba(",n=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===n[3]&&(n.pop(),t="rgb("),t+n.join()+")"},toHslaString:function(){var t="hsla(",n=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===n[3]&&(n.pop(),t="hsl("),t+n.join()+")"},toHexString:function(t){var n=this._rgba.slice(),r=n.pop();return t&&n.push(~~(255*r)),"#"+e.map(n,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),f.fn.parse.prototype=f.fn,l.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,n,r=e[0]/255,i=e[1]/255,s=e[2]/255,o=e[3],u=Math.max(r,i,s),a=Math.min(r,i,s),f=u-a,l=u+a,c=.5*l;return t=a===u?0:r===u?60*(i-s)/f+360:i===u?60*(s-r)/f+120:60*(r-i)/f+240,n=0===f?0:.5>=c?f/l:f/(2-l),[Math.round(t)%360,n,c,null==o?1:o]},l.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,n=e[1],r=e[2],s=e[3],o=.5>=r?r*(1+n):r+n-r*n,u=2*r-o;return[Math.round(255*i(u,o,t+1/3)),Math.round(255*i(u,o,t)),Math.round(255*i(u,o,t-1/3)),s]},d(l,function(r,i){var s=i.props,o=i.cache,a=i.to,l=i.from;f.fn[r]=function(r){if(a&&!this[o]&&(this[o]=a(this._rgba)),r===t)return this[o].slice();var i,u=e.type(r),c="array"===u||"object"===u?r:arguments,h=this[o].slice();return d(s,function(e,t){var r=c["object"===u?e:t.idx];null==r&&(r=h[t.idx]),h[t.idx]=n(r,t)}),l?(i=f(l(h)),i[o]=h,i):f(h)},d(s,function(t,n){f.fn[t]||(f.fn[t]=function(i){var s,o=e.type(i),a="alpha"===t?this._hsla?"hsla":"rgba":r,f=this[a](),l=f[n.idx];return"undefined"===o?l:("function"===o&&(i=i.call(this,l),o=e.type(i)),null==i&&n.empty?this:("string"===o&&(s=u.exec(i),s&&(i=l+parseFloat(s[2])*("+"===s[1]?1:-1))),f[n.idx]=i,this[a](f)))})})}),f.hook=function(t){var n=t.split(" ");d(n,function(t,n){e.cssHooks[n]={set:function(t,i){var s,o,u="";if("transparent"!==i&&("string"!==e.type(i)||(s=r(i)))){if(i=f(s||i),!h.rgba&&1!==i._rgba[3]){for(o="backgroundColor"===n?t.parentNode:t;(""===u||"transparent"===u)&&o&&o.style;)try{u=e.css(o,"backgroundColor"),o=o.parentNode}catch(a){}i=i.blend(u&&"transparent"!==u?u:"_default")}i=i.toRgbaString()}try{t.style[n]=i}catch(a){}}},e.fx.step[n]=function(t){t.colorInit||(t.start=f(t.elem,n),t.end=f(t.end),t.colorInit=!0),e.cssHooks[n].set(t.elem,t.start.transition(t.end,t.pos))}})},f.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return d(["Top","Right","Bottom","Left"],function(n,r){t["border"+r+"Color"]=e}),t}},s=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function n(t){var n,r,i=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,s={};if(i&&i.length&&i[0]&&i[i[0]])for(r=i.length;r--;)n=i[r],"string"==typeof i[n]&&(s[e.camelCase(n)]=i[n]);else for(n in i)"string"==typeof i[n]&&(s[n]=i[n]);return s}function r(t,n){var r,i,o={};for(r in n)i=n[r],t[r]!==i&&(s[r]||(e.fx.step[r]||!isNaN(parseFloat(i)))&&(o[r]=i));return o}var i=["add","remove","toggle"],s={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,n){e.fx.step[n]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(jQuery.style(e.elem,n,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(t,s,o,u){var a=e.speed(s,o,u);return this.queue(function(){var s,o=e(this),u=o.attr("class")||"",f=a.children?o.find("*").addBack():o;f=f.map(function(){var t=e(this);return{el:t,start:n(this)}}),s=function(){e.each(i,function(e,n){t[n]&&o[n+"Class"](t[n])})},s(),f=f.map(function(){return this.end=n(this.el[0]),this.diff=r(this.start,this.end),this}),o.attr("class",u),f=f.map(function(){var t=this,n=e.Deferred(),r=e.extend({},a,{queue:!1,complete:function(){n.resolve(t)}});return this.el.animate(this.diff,r),n.promise()}),e.when.apply(e,f.get()).done(function(){s(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),a.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(n,r,i,s){return r?e.effects.animateClass.call(this,{add:n},r,i,s):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(n,r,i,s){return arguments.length>1?e.effects.animateClass.call(this,{remove:n},r,i,s):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(n){return function(r,i,s,o,u){return"boolean"==typeof i||i===t?s?e.effects.animateClass.call(this,i?{add:r}:{remove:r},s,o,u):n.apply(this,arguments):e.effects.animateClass.call(this,{toggle:r},i,s,o)}}(e.fn.toggleClass),switchClass:function(t,n,r,i,s){return e.effects.animateClass.call(this,{add:n,remove:t},r,i,s)}})}(),function(){function r(t,n,r,i){return e.isPlainObject(t)&&(n=t,t=t.effect),t={effect:t},null==n&&(n={}),e.isFunction(n)&&(i=n,r=null,n={}),("number"==typeof n||e.fx.speeds[n])&&(i=r,r=n,n={}),e.isFunction(r)&&(i=r,r=null),n&&e.extend(t,n),r=r||n.duration,t.duration=e.fx.off?0:"number"==typeof r?r:r in e.fx.speeds?e.fx.speeds[r]:e.fx.speeds._default,t.complete=i||n.complete,t}function s(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.10.4",save:function(e,t){for(var r=0;t.length>r;r++)null!==t[r]&&e.data(n+t[r],e[0].style[t[r]])},restore:function(e,r){var s,o;for(o=0;r.length>o;o++)null!==r[o]&&(s=e.data(n+r[o]),s===t&&(s=""),e.css(r[o],s))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var n,r;switch(e[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=e[0]/t.height}switch(e[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=e[1]/t.width}return{x:r,y:n}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var n={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},r=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),i={width:t.width(),height:t.height()},s=document.activeElement;try{s.id}catch(o){s=document.body}return t.wrap(r),(t[0]===s||e.contains(t[0],s))&&e(s).focus(),r=t.parent(),"static"===t.css("position")?(r.css({position:"relative"}),t.css({position:"relative"})):(e.extend(n,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,r){n[r]=t.css(r),isNaN(parseInt(n[r],10))&&(n[r]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(i),r.css(n).show()},removeWrapper:function(t){var n=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===n||e.contains(t[0],n))&&e(n).focus()),t},setTransition:function(t,n,r,i){return i=i||{},e.each(n,function(e,n){var s=t.cssUnit(n);s[0]>0&&(i[n]=s[0]*r+s[1])}),i}}),e.fn.extend({effect:function(){function t(t){function r(){e.isFunction(s)&&s.call(i[0]),e.isFunction(t)&&t()}var i=e(this),s=n.complete,u=n.mode;(i.is(":hidden")?"hide"===u:"show"===u)?(i[u](),r()):o.call(i[0],n,r)}var n=r.apply(this,arguments),i=n.mode,s=n.queue,o=e.effects.effect[n.effect];return e.fx.off||!o?i?this[i](n.duration,n.complete):this.each(function(){n.complete&&n.complete.call(this)}):s===!1?this.each(t):this.queue(s||"fx",t)},show:function(e){return function(t){if(s(t))return e.apply(this,arguments);var n=r.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(t){if(s(t))return e.apply(this,arguments);var n=r.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(t){if(s(t)||"boolean"==typeof t)return e.apply(this,arguments);var n=r.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var n=this.css(t),r=[];return e.each(["em","px","%","pt"],function(e,t){n.indexOf(t)>0&&(r=[parseFloat(n),t])}),r}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,n){t[n]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,n=4;((t=Math.pow(2,--n))-1)/11>e;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,n){e.easing["easeIn"+t]=n,e.easing["easeOut"+t]=function(e){return 1-n(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?n(2*e)/2:1-n(-2*e+2)/2}})}()}(jQuery),function(e){e.effects.effect.drop=function(n,r){var i,s=e(this),o=["position","top","bottom","left","right","opacity","height","width"],u=e.effects.setMode(s,n.mode||"hide"),a="show"===u,f=n.direction||"left",l="up"===f||"down"===f?"top":"left",c="up"===f||"left"===f?"pos":"neg",h={opacity:a?1:0};e.effects.save(s,o),s.show(),e.effects.createWrapper(s),i=n.distance||s["top"===l?"outerHeight":"outerWidth"](!0)/2,a&&s.css("opacity",0).css(l,"pos"===c?-i:i),h[l]=(a?"pos"===c?"+=":"-=":"pos"===c?"-=":"+=")+i,s.animate(h,{queue:!1,duration:n.duration,easing:n.easing,complete:function(){"hide"===u&&s.hide(),e.effects.restore(s,o),e.effects.removeWrapper(s),r()}})}}(jQuery),function(e){e.effects.effect.fade=function(n,r){var i=e(this),s=e.effects.setMode(i,n.mode||"toggle");i.animate({opacity:s},{queue:!1,duration:n.duration,easing:n.easing,complete:r})}}(jQuery),function(e){e.effects.effect.highlight=function(n,r){var i=e(this),s=["backgroundImage","backgroundColor","opacity"],o=e.effects.setMode(i,n.mode||"show"),u={backgroundColor:i.css("backgroundColor")};"hide"===o&&(u.opacity=0),e.effects.save(i,s),i.show().css({backgroundImage:"none",backgroundColor:n.color||"#ffff99"}).animate(u,{queue:!1,duration:n.duration,easing:n.easing,complete:function(){"hide"===o&&i.hide(),e.effects.restore(i,s),r()}})}}(jQuery),define("lib-app/jquery-ui-1.10.4.custom.min",function(){}),function(e){function s(e,t){if(e.originalEvent.touches.length>1)return;e.preventDefault();var n=e.originalEvent.changedTouches[0],r=document.createEvent("MouseEvents");r.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(r)}e.support.touch="ontouchend"in document;if(!e.support.touch)return;var t=e.ui.mouse.prototype,n=t._mouseInit,r=t._mouseDestroy,i;t._touchStart=function(e){var t=this;if(i||!t._mouseCapture(e.originalEvent.changedTouches[0]))return;i=!0,t._touchMoved=!1,s(e,"mouseover"),s(e,"mousemove"),s(e,"mousedown")},t._touchMove=function(e){if(!i)return;this._touchMoved=!0,s(e,"mousemove")},t._touchEnd=function(e){if(!i)return;s(e,"mouseup"),s(e,"mouseout"),this._touchMoved||s(e,"click"),i=!1},t._mouseInit=function(){var t=this;t.element.bind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),n.call(t)},t._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),r.call(t)}}(jQuery),define("lib-app/jquery.ui.touch-punch",function(){}),define("storymaps/tpl/builder/OrganizePopup",["lib-build/tpl!./OrganizePopup","lib-build/css!./OrganizePopup","lib-build/tpl!./OrganizePopupEntry","lib-app/jquery-ui-1.10.4.custom.min","lib-app/jquery.ui.touch-punch","dojo/Deferred"],function(e,t,n,r,i,s){return function(r){function f(){var e=$(this).closest("tr").first();return e.fadeOut("fast",function(){e.remove(),a++,h()}),!1}function l(){var e=[],t=0,n=r.find(".sectionRow").get();$.each($(n),function(n,r){var i=$(r),s=i.data("index"),o=i.find(".status-list-btn").data("value"),a=u.story.entries[s];a.status=o,e.push(a),s===u.sectionIndex&&(t=n)}),o.resolve({entries:e,sectionIndex:t}),r.modal("hide")}function c(){r.find(".btnApply").click(l),r.on("hide.bs.modal",function(){o.reject()}),i=!0}function h(){a?r.find(".btnApply").html(i18n.builder.organizePopup.btnApplyWarning.replace("%NB%",a).replace("%LBL_LAYOUT%",app.data.getWebAppData().getLayoutProperties()[a>1?"itemsLbl":"itemLbl"])).removeClass("btn-primary").addClass("btn-danger"):r.find(".btnApply").html(i18n.commonCore.common.apply).removeClass("btn-danger").addClass("btn-primary")}var i=!1,o=null,u=null,a=null;r.append(e({title:i18n.builder.organizePopup.title,lblColTitle:i18n.builder.organizePopup.lblColTitle,lblColStatus:i18n.builder.organizePopup.lblColStatus,btnCancel:i18n.commonCore.common.cancel})),this.present=function(e){var t="";o=new s,u=e;if(!e||!e.story||!e.story.entries||e.sectionIndex==null)return o.reject();a=0,i||c(),r.find(".organizeHeader").html(i18n.builder.organizePopup.lblHeader.replace("%LBL_LAYOUT%",app.data.getWebAppData().getLayoutProperties().itemsLbl.toLowerCase()));var l=u.story.entries.length;$.each(u.story.entries,function(r,i){var s=i.title;if(e.appLayout=="bullet"||e.appLayout=="accordion")e.layoutOpt.reverse?s=l-r+(s?" - "+s:""):s=r+1+(s?" - "+s:"");t+=n({index:r,title:s,statusVal:i.status,statusLbl:app.builderCfg.STATUS[i.status],helpDelete:i18n.builder.organizePopup.deleteTooltip})}),r.find(".rows").html(t),$.each(Object.keys(app.builderCfg.STATUS),function(e,t){r.find(".status-list").append('<li><a data-value="'+t+'">'+app.builderCfg.STATUS[t]+"</a></li>")}),r.find(".status-list a").click(function(){$(this).parents(".btn-group").find(".status-list-btn").data("value",$(this).data("value")).text($(this).text())}),r.find(".dropdown-toggle").dropdown(),r.find("*[data-toggle=tooltip]").tooltip({trigger:"hover"}),r.find(".deleteSectionBtn").click(f),r.find(".rows").toggleClass("noreorder",u.story.entries.length<=1);if(u.story.entries.length>1)r.find(".organizeTable tbody").sortable({axis:"y",opacity:"0.4",cursor:"move",helper:function(e,t){var n=t.children(),r=t.clone();return r.children().each(function(e){$(this).outerWidth(n.eq(e).outerWidth())}),r}});else try{r.find(".organizeTable tbody").sortable("destroy")}catch(p){}return h(),r.modal({keyboard:!0}),o},this.close=function(){r.modal("hide"),o.reject()}}}),define("lib-build/tpl!storymaps/common/builder/media/map/EditDialog",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\n	<div class="modal-content">\n		<div class="modal-logo"></div>\n		<div class="modal-header">\n			<h4 class="modal-title"></h4>\n		</div>\n\n		<div class="modal-body">\n			<div class="loading-container">\n				<div style="padding-top: 200px;">\n					<img src="resources/tpl/viewer/icons/loading-light.gif" />\n				</div>\n				<div class="loading-lbl">'+((__t=loadingLabel)==null?"":__t)+'</div>\n			</div>\n			<div class="error-container hide">\n				<div class="error-msg"></div>\n			</div>\n\n			<div class="webmap-builder-container">\n				<iframe class="webmap-builder"></iframe>\n			</div>\n\n		</div>\n\n		<div class="modal-footer">\n			<span class="error"></span>\n			<button class="btnSubmit btn btn-primary hide" ></button>\n			<button type="button" class="btn btnCancel btn-naked btn-close"></button>\n		</div>\n	</div>\n</div>\n';return __p}}),define("lib-build/css!storymaps/common/builder/media/map/EditDialog",[],function(){}),define("storymaps/common/builder/media/map/MapViewerWrapper",["./MapViewerWrapperUtils"],function(e){var t={mapViewerOpt:"embedded=1&hide=bm,share,save,analysis,directions,measure"},n="";return function(i){function c(){u?clearInterval(a):s.send({type:"isLoaded"})}function h(){f||(f=setInterval(d,1e3))}function p(){f&&(clearInterval(f),f=null)}function d(){s.send({type:"hasUnsavedChanges"})}function v(t){if(t.origin!==e.getPortalDomain())return;var n=_.isString(t.data)?JSON.parse(t.data):t.data;if(!n||!n.type)return;console.log("MV received",n);switch(n.type){case"mapSaved":i.onSaveSucceed(n.webmapId,n.title);break;case"mapSaveError":i.onSaveError(n);break;case"webmapId":h(),setTimeout(function(){s.send({type:"isWebmapEditable"})},1e3);break;case"webmapEditable":n.value||i.onEnableSave();break;case"unsavedChanges":n.value&&i.onEnableSave();break;case"loaded":u=n.value,u?(console.log("MV loaded - map too"),o?setTimeout(function(){s.send({type:"isWebmapEditable"})},1e3):(i.onLoad(),s.send({type:"getWebmapId"}),o=!0)):(console.log("MV loaded - map not yet"),o||(setTimeout(i.onLoad,500),s.send({type:"getWebmapId"})),o=!0);break;case"newViewerBaseUrl":break;case"message":i.onError(n.message)}}var s=this,o=!1,u=!1,a=null,f=null,l=!1;window.addEventListener("message",v,!1),this.load=function(r,s){var f="";if(!r&&!s)throw"INVALID CALL TO MapViewerWrapper.load";if(!i||!i.onSaveSucceed||!i.onSaveError||!i.onLoad||!i.onError||!i.onEnableSave||!i.frameWindow)throw"INVALID CALL TO MapViewerWrapper.load";f+=e.getMapViewerURL(),r?f+="?"+t.mapViewerOpt:(f+="?webmap="+s,f+="&"+t.mapViewerOpt),f+="&locale="+dojo.locale;if(e.isWhiteListedDomain()&&!e.viewerIsSameDomain()&&dojo.cookie("esri_auth"))f+="#"+JSON.parse(dojo.cookie("esri_auth")).token;else if(e.isWhiteListedDomain()&&!e.viewerIsSameDomain()&&n)f+="#"+n;else{if(!e.isWhiteListedDomain()&&!app.isProduction)throw"DEV_FAIL";if(e.isWhiteListedDomain()&&!app.isProduction&&!n)throw"DEV_TOKEN"}return o=!1,u=!1,l=!1,a=setInterval(c,500),f},this.cancelLoading=function(){clearInterval(a),p()},this.send=function(t){console.log("MV sending",t);try{i.frameWindow.postMessage(JSON.stringify(t),e.getPortalURL())}catch(n){i.onError(n)}},this.close=function(){a&&clearInterval(a),p()}}}),define("lib-build/tpl!storymaps/common/builder/media/map/NewMapDialog",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\n	<div class="modal-content">\n		<div class="modal-logo"></div>\n		<div class="modal-header">\n			<h4 class="modal-title">'+((__t=newTitle)==null?"":__t)+'</h4>\n		</div>\n\n		<div class="modal-body">\n			<form>\n				<div class="form-group"> <!-- has-feedback -->\n					<label for="inputNewMapTitle">'+((__t=titleLbl)==null?"":__t)+'</label>\n					<input type="text" class="form-control" id="inputNewMapTitle" placeholder="'+((__t=titlePh)==null?"":__t)+'">\n					<!--<span class="glyphicon glyphicon-asterisk form-control-feedback" aria-hidden="true"></span>-->\n				</div>\n				<div class="form-group" style="display: none">\n					<label for="inputNewMapTags">Tags</label>\n					<input type="text" class="form-control" id="inputNewMapTags" placeholder="Tags">\n				</div>\n				<!--\n				<div class="form-group">\n					<label for="inputNewMapFolder">Folder</label>\n					<div class="dropdown">\n						<button class="btn btn-default dropdown-toggle" type="button" id="dropdownnewMapFolder" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\n							Fetching folders...\n							<span class="caret"></span>\n						</button>\n						<ul class="dropdown-menu" aria-labelledby="dropdownnewMapFolder">\n							<li><a href="#">Foo</a></li>\n							<li><a href="#">bar</a></li>\n						</ul>\n					</div>\n				</div>\n				-->\n				<div class="form-group folder-label">\n					'+((__t=lblFolder)==null?"":__t)+'\n				</div>\n			</form>\n		</div>\n\n		<div class="modal-footer">\n		<span class="error"></span>\n			<button class="btnSubmit btn btn-primary"></button>\n			<button type="button" class="btn btnCancel btn-naked btn-close">'+((__t=btnCancel)==null?"":__t)+"</button>\n		</div>\n	</div>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/media/map/NewMapDialog",[],function(){}),define("storymaps/common/builder/media/map/NewMapDialog",["lib-build/tpl!./NewMapDialog","lib-build/css!./NewMapDialog","dojo/Deferred"],function(e,t,n){return function(r){function o(){if(!r.find("#inputNewMapTitle").val())return;if(r.find(".btnSubmit").hasClass("disabled"))return;i.resolve({title:r.find("#inputNewMapTitle").val(),tags:r.find("#inputNewMapTags").val(),folderId:s.folderId}),r.find(".btnSubmit").addClass("disabled").html('<span class="small-loader"></span>'+i18n.commonWebmap.editor.creating),r.find(".modal-footer .error").html("").hide()}function u(){i.reject(),r.modal("hide")}function a(){var e=r.find("#inputNewMapTitle").val();r.find(".btnSubmit").toggleClass("disabled",!e)}function f(e){e.keyCode==13&&o()}function l(){r.find(".btnSubmit").click(o),r.find(".btnCancel").click(u),r.find("#inputNewMapTitle").bind("input propertychange",a),r.on("show.bs.modal",function(){$("#addEditPopup .backdrop").show()}),r.on("shown.bs.modal",function(){r.find("#inputNewMapTitle").focus()}),r.on("hide.bs.modal",function(){$("#addEditPopup .backdrop").hide(),r.unbind("keydown",f)})}var i=null,s=null;r.append(e({newTitle:i18n.commonWebmap.editor.newTitle,titleLbl:i18n.commonWebmap.editor.titleLbl,titlePh:i18n.commonWebmap.editor.titlePh,lblFolder:i18n.commonWebmap.editor.folderLbl,btnCancel:i18n.commonCore.common.cancel})),l(),this.present=function(e){return i=new n,s=e,r.find("#inputNewMapTitle").val(e.title),r.find("#inputNewMapTags").val(e.tags),r.find(".folder-label").toggle(!!e.folderId),r.find(".btnSubmit").html(i18n.commonCore.common.create),a(),r.bind("keydown",f),r.modal({keyboard:!0}),i},this.saveSuccess=function(){var e=new n;return r.find(".btnSubmit").addClass("disabled").html('<span class="glyphicon glyphicon-ok"></span> '+i18n.commonWebmap.editor.successCreate),setTimeout(function(){r.modal("hide"),e.resolve()},800),e},this.saveError=function(e){r.find(".btnSubmit").removeClass("disabled").html(i18n.commonCore.common.create);var t=i18n.commonWebmap.editor.errorCreate;return e.messageCode=="VIEWER_0001"&&(t=i18n.commonWebmap.editor.errorDuplicate),r.find(".modal-footer .error").html(t).show(),i=new n,i}}}),+function(e){"use strict";var t=!1,n=function(n,r){var i=this;this.init("confirmation",n,r),e(n).on("show.bs.confirmation",function(t){i.options.onShow(t,this),e(this).addClass("open");var n=i.options,r=n.all_selector;n.singleton&&e(r).not(i.$element).each(function(){e(this).hasClass("open")&&e(this).confirmation("hide")})}),e(n).on("hide.bs.confirmation",function(t){i.options.onHide(t,this),e(this).removeClass("open")}),e(n).on("shown.bs.confirmation",function(n){var r=i.options,s=r.all_selector;i.isPopout()&&(t||(t=e("body").on("click",function(n){if(i.$element.is(n.target))return;if(i.$element.has(n.target).length)return;if(e(".popover").has(n.target).length)return;i.hide(),i.inState.click=!1,e("body").unbind(n),t=!1;return})))}),e(n).on("click",function(e){e.preventDefault()})};if(!e.fn.popover||!e.fn.tooltip)throw new Error("Confirmation requires popover.js and tooltip.js");n.VERSION="1.0.3",n.DEFAULTS=e.extend({},e.fn.popover.Constructor.DEFAULTS,{placement:"right",title:"Are you sure?",btnOkClass:"btn btn-sm btn-danger",btnOkLabel:"Delete",btnOkIcon:"glyphicon glyphicon-ok",btnCancelClass:"btn btn-sm btn-default",btnCancelLabel:"Cancel",btnCancelIcon:"glyphicon glyphicon-remove",href:"#",target:"_self",singleton:!0,popout:!0,onShow:function(e,t){},onHide:function(e,t){},onConfirm:function(e,t){},onCancel:function(e,t){},template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"><a data-apply="confirmation">Yes</a><a data-dismiss="confirmation">No</a></div></div>'}),n.prototype=e.extend({},e.fn.popover.Constructor.prototype),n.prototype.constructor=n,n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.setContent=function(){var t=this,n=this.tip(),r=this.getTitle(),i=n.find('[data-apply="confirmation"]'),s=n.find('[data-dismiss="confirmation"]'),o=this.options;i.addClass(this.getBtnOkClass()).html(this.getBtnOkLabel()).prepend(e("<i></i>").addClass(this.getBtnOkIcon())," ").attr("href",this.getHref()).attr("target",this.getTarget()).off("click").on("click",function(e){o.onConfirm(e,t.$element),t.$element.attr("type")=="submit"&&t.$element.closest("form:first").submit(),t.hide(),t.inState.click=!1}),s.addClass(this.getBtnCancelClass()).html(this.getBtnCancelLabel()).prepend(e("<i></i>").addClass(this.getBtnCancelIcon())," ").off("click").on("click",function(e){o.onCancel(e,t.$element),t.hide(),t.inState.click=!1}),n.find(".popover-title")[this.options.html?"html":"text"](r),n.removeClass("fade top bottom left right in"),n.find(".popover-title").html()||n.find(".popover-title").hide()},n.prototype.getBtnOkClass=function(){var e=this.$element,t=this.options;return e.attr("data-btnOkClass")||(typeof t.btnOkClass=="function"?t.btnOkClass.call(e[0]):t.btnOkClass)},n.prototype.getBtnOkLabel=function(){var e=this.$element,t=this.options;return e.attr("data-btnOkLabel")||(typeof t.btnOkLabel=="function"?t.btnOkLabel.call(e[0]):t.btnOkLabel)},n.prototype.getBtnOkIcon=function(){var e=this.$element,t=this.options;return e.attr("data-btnOkIcon")||(typeof t.btnOkIcon=="function"?t.btnOkIcon.call(e[0]):t.btnOkIcon)},n.prototype.getBtnCancelClass=function(){var e=this.$element,t=this.options;return e.attr("data-btnCancelClass")||(typeof t.btnCancelClass=="function"?t.btnCancelClass.call(e[0]):t.btnCancelClass)},n.prototype.getBtnCancelLabel=function(){var e=this.$element,t=this.options;return e.attr("data-btnCancelLabel")||(typeof t.btnCancelLabel=="function"?t.btnCancelLabel.call(e[0]):t.btnCancelLabel)},n.prototype.getBtnCancelIcon=function(){var e=this.$element,t=this.options;return e.attr("data-btnCancelIcon")||(typeof t.btnCancelIcon=="function"?t.btnCancelIcon.call(e[0]):t.btnCancelIcon)},n.prototype.getHref=function(){var e=this.$element,t=this.options;return e.attr("data-href")||(typeof t.href=="function"?t.href.call(e[0]):t.href)},n.prototype.getTarget=function(){var e=this.$element,t=this.options;return e.attr("data-target")||(typeof t.target=="function"?t.target.call(e[0]):t.target)},n.prototype.isPopout=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-popout")||(typeof n.popout=="function"?n.popout.call(t[0]):n.popout),e=="false"&&(e=!1),e};var r=e.fn.confirmation;e.fn.confirmation=function(t){var r=this;return this.each(function(){var i=e(this),s=i.data("bs.confirmation"),o=typeof t=="object"&&t;o=o||{},o.all_selector=r.selector;if(!s&&t=="destroy")return;s||i.data("bs.confirmation",s=new n(this,o)),typeof t=="string"&&s[t]()})},e.fn.confirmation.Constructor=n,e.fn.confirmation.noConflict=function(){return e.fn.confirmation=r,this}}(jQuery),define("lib-app/bootstrap-confirmation",function(){}),define("storymaps/common/builder/media/map/EditDialog",["lib-build/tpl!./EditDialog","lib-build/css!./EditDialog","./MapViewerWrapper","./MapViewerWrapperUtils","./NewMapDialog","dojo/Deferred","dojo/topic","dojo/has","lib-app/bootstrap-confirmation"],function(e,t,n,r,i,s,o,u){return function(a){function b(e){console.log("New map dialog saved",e),m=e;var t=function(){p=!0,c.send({type:"saveNewMap",title:e.title,tags:e.tags,folderId:e.folderId})};if(h)t();else var n=setInterval(function(){console.log("MV - Waiting for the map viewer to load to create the map"),h&&(t(),clearInterval(n))},500)}function w(){r.cancelLoading(),u("ff")&&a.modal("hide")}function E(){a.removeClass("firefox-hide-fix"),a.find(".modal-footer .error").hide(),a.find(".modal-title").html(i18n.commonWebmap.editor.editTitle),a.find(".btnSubmit").addClass("disabled"),C(),a.find(".btn-close").html(i18n.commonCore.common.close)}function S(){a.find(".webmap-builder-container").addClass("hide"),a.find(".loading-container").removeClass("hide"),a.find(".btnSubmit").removeClass("hide").addClass("disabled").html(i18n.commonCore.common.save),C()}function x(){a.find(".webmap-builder-container").removeClass("hide"),a.find(".loading-container").addClass("hide"),h=!0}function T(e){console.error(e),a.find(".error-container").removeClass("hide"),a.find(".error-msg").html("Fatal error, the map editor cannot be loaded<br />"+e),a.find(".loading-container").addClass("hide"),a.find(".webmap-builder-container").addClass("hide")}function N(){if(y)return;a.find(".btnSubmit").removeClass("disabled").html(i18n.commonCore.common.save),C(!0)}function C(e){if(a.find(".btnCancel").hasClass("open"))return;if(e&&a.find(".btnCancel").hasClass("has-confirmation"))return;a.find(".btnCancel").off("click").confirmation("destroy"),e?(a.find(".btnCancel").confirmation({container:".mapEditPopup .modal-dialog",placement:"top",title:i18n.commonWebmap.editor.cancelTitle,btnOkLabel:i18n.commonCore.common.yes,btnCancelLabel:i18n.commonCore.common.no,onConfirm:function(){L(!0)},btnCancelClass:"btn btn-sm btn-default btn-cancel-popover"}),a.find(".btnCancel").addClass("has-confirmation")):a.find(".btnCancel").click(L).removeClass("has-confirmation")}function k(){if(!h)return;if(a.find(".btnSubmit").hasClass("disabled"))return;y=!0,a.find(".btnSubmit").addClass("disabled").html('<span class="small-loader"></span>'+i18n.commonWebmap.editor.saving),C(),a.find(".modal-footer .error").html("").hide(),c.send({type:"saveMap"})}function L(e){a.modal("hide"),e===!0&&a.find(".webmap-builder").attr("src","about:blank")}function A(){c.close(),f&&(v&&o.publish("ADDEDIT_RELOAD_CURRENT_WEBMAP"),v||d?f.resolve({newMap:d,newMapInfos:m}):f.reject())}function O(e,t){p?(m.id=e,p=!1,d=!0,l.saveSuccess().then(function(){u("ff")?a.removeClass("firefox-hide-fix"):a.modal({keyboard:!1})})):g.id&&g.id!=e?(g.id=e,m={id:e,title:t||""},d=!0,M()):(v=!0,M(),o.publish("BUILDER-MY-STORIES-CHECK"))}function M(){a.find(".btnSubmit").addClass("disabled").html('<span class="glyphicon glyphicon-ok"></span> '+i18n.commonWebmap.editor.success),setTimeout(function(){a.find(".btnSubmit").html(i18n.commonCore.common.save),a.find(".btnSubmit").toggleClass("disabled",!0),y=!1},2e3)}function _(e){p?l.saveError(e).then(b,w):(a.find(".btnSubmit").removeClass("disabled").html(i18n.commonCore.common.save),a.find(".modal-footer .error").html(i18n.commonWebmap.editor.errorSave).show())}function D(){a.find(".btnSubmit").click(k),a.on("hide.bs.modal",A)}function P(){return a.find(".webmap-builder")[0].contentWindow}a.append(e({loadingLabel:i18n.commonWebmap.editor.loading}));var f=null,l=null,c=null,h=!1,p=!1,d=!1,v=!1,m=null,g=null,y=!1;D(),c=new n({frameWindow:P(),onSaveSucceed:O,onSaveError:_,onLoad:x,onError:T,onEnableSave:N}),this.present=function(e){f=new s,h=!1,p=!1,d=!1,v=!1,m=null,g=e,E();var t="";try{t=c.load(e.newMap,e.id)}catch(n){return T(n),f.reject(n),f}if(e.newMap){l||(l=new i($("#mapEditPopupNewMap")));var r=e.title||"";l.present({title:r,tags:["map"],folderId:app.data.getWebAppItem().ownerFolder}).then(b,w),u("ff")&&a.addClass("firefox-hide-fix").modal({keyboard:!1})}else a.modal({keyboard:!1});return S(),setTimeout(function(){a.find(".webmap-builder").attr("src",t)},50),f}}}),function(){if(window.CKEDITOR&&window.CKEDITOR.dom)return;window.CKEDITOR||(window.CKEDITOR=function(){var e=/(^|.*[\\\/])ckeditor\.js(?:\?.*|;.*)?$/i,t={timestamp:"F7J9",version:"4.5.3",revision:"6c70c82",rnd:Math.floor(900*Math.random())+100,_:{pending:[],basePathSrcPattern:e},status:"unloaded",basePath:function(){var t=window.CKEDITOR_BASEPATH||"";if(!t)for(var n=document.getElementsByTagName("script"),r=0;r<n.length;r++){var i=n[r].src.match(e);if(i){t=i[1];break}}-1==t.indexOf(":/")&&"//"!=t.slice(0,2)&&(t=0===t.indexOf("/")?location.href.match(/^.*?:\/\/[^\/]*/)[0]+t:location.href.match(/^[^\?]*\/(?:)/)[0]+t);if(!t)throw'The CKEditor installation path could not be automatically detected. Please set the global variable "CKEDITOR_BASEPATH" before creating editor instances.';return t}(),getUrl:function(e){return-1==e.indexOf(":/")&&0!==e.indexOf("/")&&(e=this.basePath+e),this.timestamp&&"/"!=e.charAt(e.length-1)&&!/[&?]t=/.test(e)&&(e+=(0<=e.indexOf("?")?"&":"?")+"t="+this.timestamp),e},domReady:function(){function e(){try{document.addEventListener?(document.removeEventListener("DOMContentLoaded",e,!1),t()):document.attachEvent&&"complete"===document.readyState&&(document.detachEvent("onreadystatechange",e),t())}catch(n){}}function t(){for(var e;e=n.shift();)e()}var n=[];return function(t){function r(){try{document.documentElement.doScroll("left")}catch(t){setTimeout(r,1);return}e()}n.push(t),"complete"===document.readyState&&setTimeout(e,1);if(1==n.length)if(document.addEventListener)document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",e),window.attachEvent("onload",e),t=!1;try{t=!window.frameElement}catch(i){}document.documentElement.doScroll&&t&&r()}}}()},n=window.CKEDITOR_GETURL;if(n){var r=t.getUrl;t.getUrl=function(e){return n.call(t,e)||r.call(t,e)}}return t}()),CKEDITOR.event||(CKEDITOR.event=function(){},CKEDITOR.event.implementOn=function(e){var t=CKEDITOR.event.prototype,n;for(n in t)e[n]==null&&(e[n]=t[n])},CKEDITOR.event.prototype=function(){function e(e){var r=t(this);return r[e]||(r[e]=new n(e))}var t=function(e){return e=e.getPrivate&&e.getPrivate()||e._||(e._={}),e.events||(e.events={})},n=function(e){this.name=e,this.listeners=[]};return n.prototype={getListenerIndex:function(e){for(var t=0,n=this.listeners;t<n.length;t++)if(n[t].fn==e)return t;return-1}},{define:function(t,n){var r=e.call(this,t);CKEDITOR.tools.extend(r,n,!0)},on:function(t,n,r,i,s){function o(e,s,o,a){return e={name:t,sender:this,editor:e,data:s,listenerData:i,stop:o,cancel:a,removeListener:u},n.call(r,e)===!1?!1:e.data}function u(){l.removeListener(t,n)}var f=e.call(this,t);if(f.getListenerIndex(n)<0){f=f.listeners,r||(r=this),isNaN(s)&&(s=10);var l=this;o.fn=n,o.priority=s;for(var c=f.length-1;c>=0;c--)if(f[c].priority<=s)return f.splice(c+1,0,o),{removeListener:u};f.unshift(o)}return{removeListener:u}},once:function(){var e=Array.prototype.slice.call(arguments),t=e[1];return e[1]=function(e){return e.removeListener(),t.apply(this,arguments)},this.on.apply(this,e)},capture:function(){CKEDITOR.event.useCapture=1;var e=this.on.apply(this,arguments);return CKEDITOR.event.useCapture=0,e},fire:function(){var e=0,n=function(){e=1},r=0,i=function(){r=1};return function(s,o,u){var l=t(this)[s],s=e,c=r;e=r=0;if(l){var p=l.listeners;if(p.length)for(var p=p.slice(0),v,m=0;m<p.length;m++){if(l.errorProof)try{v=p[m].call(this,u,o,n,i)}catch(g){}else v=p[m].call(this,u,o,n,i);v===!1?r=1:typeof v!="undefined"&&(o=v);if(e||r)break}}return o=r?!1:typeof o=="undefined"?!0:o,e=s,r=c,o}}(),fireOnce:function(e,n,r){return n=this.fire(e,n,r),delete t(this)[e],n},removeListener:function(e,n){var r=t(this)[e];if(r){var i=r.getListenerIndex(n);i>=0&&r.listeners.splice(i,1)}},removeAllListeners:function(){var e=t(this),n;for(n in e)delete e[n]},hasListeners:function(e){return(e=t(this)[e])&&e.listeners.length>0}}}()),CKEDITOR.editor||(CKEDITOR.editor=function(){CKEDITOR._.pending.push([this,arguments]),CKEDITOR.event.call(this)},CKEDITOR.editor.prototype.fire=function(e,t){return e in{instanceReady:1,loaded:1}&&(this[e]=!0),CKEDITOR.event.prototype.fire.call(this,e,t,this)},CKEDITOR.editor.prototype.fireOnce=function(e,t){return e in{instanceReady:1,loaded:1}&&(this[e]=!0),CKEDITOR.event.prototype.fireOnce.call(this,e,t,this)},CKEDITOR.event.implementOn(CKEDITOR.editor.prototype)),CKEDITOR.env||(CKEDITOR.env=function(){var e=navigator.userAgent.toLowerCase(),t=e.match(/edge[ \/](\d+.?\d*)/),n=e.indexOf("trident/")>-1,n=!!t||!!n,n={ie:n,edge:!!t,webkit:!n&&e.indexOf(" applewebkit/")>-1,air:e.indexOf(" adobeair/")>-1,mac:e.indexOf("macintosh")>-1,quirks:document.compatMode=="BackCompat"&&(!document.documentMode||document.documentMode<10),mobile:e.indexOf("mobile")>-1,iOS:/(ipad|iphone|ipod)/.test(e),isCustomDomain:function(){if(!this.ie)return!1;var e=document.domain,t=window.location.hostname;return e!=t&&e!="["+t+"]"},secure:location.protocol=="https:"};n.gecko=navigator.product=="Gecko"&&!n.webkit&&!n.ie,n.webkit&&(e.indexOf("chrome")>-1?n.chrome=!0:n.safari=!0);var r=0;return n.ie&&(r=t?parseFloat(t[1]):n.quirks||!document.documentMode?parseFloat(e.match(/msie (\d+)/)[1]):document.documentMode,n.ie9Compat=r==9,n.ie8Compat=r==8,n.ie7Compat=r==7,n.ie6Compat=r<7||n.quirks),n.gecko&&(t=e.match(/rv:([\d\.]+)/))&&(t=t[1].split("."),r=t[0]*1e4+(t[1]||0)*100+(t[2]||0)*1),n.air&&(r=parseFloat(e.match(/ adobeair\/(\d+)/)[1])),n.webkit&&(r=parseFloat(e.match(/ applewebkit\/(\d+)/)[1])),n.version=r,n.isCompatible=!(n.ie&&r<7)&&!(n.gecko&&r<4e4)&&!(n.webkit&&r<534),n.hidpi=window.devicePixelRatio>=2,n.needsBrFiller=n.gecko||n.webkit||n.ie&&r>10,n.needsNbspFiller=n.ie&&r<11,n.cssClass="cke_browser_"+(n.ie?"ie":n.gecko?"gecko":n.webkit?"webkit":"unknown"),n.quirks&&(n.cssClass=n.cssClass+" cke_browser_quirks"),n.ie&&(n.cssClass=n.cssClass+(" cke_browser_ie"+(n.quirks?"6 cke_browser_iequirks":n.version))),n.air&&(n.cssClass=n.cssClass+" cke_browser_air"),n.iOS&&(n.cssClass=n.cssClass+" cke_browser_ios"),n.hidpi&&(n.cssClass=n.cssClass+" cke_hidpi"),n}()),"unloaded"==CKEDITOR.status&&function(){CKEDITOR.event.implementOn(CKEDITOR),CKEDITOR.loadFullCore=function(){if(CKEDITOR.status!="basic_ready")CKEDITOR.loadFullCore._load=1;else{delete CKEDITOR.loadFullCore;var e=document.createElement("script");e.type="text/javascript",e.src=CKEDITOR.basePath+"ckeditor.js",document.getElementsByTagName("head")[0].appendChild(e)}},CKEDITOR.loadFullCoreTimeout=0,CKEDITOR.add=function(e){(this._.pending||(this._.pending=[])).push(e)},function(){CKEDITOR.domReady(function(){var e=CKEDITOR.loadFullCore,t=CKEDITOR.loadFullCoreTimeout;e&&(CKEDITOR.status="basic_ready",e&&e._load?e():t&&setTimeout(function(){CKEDITOR.loadFullCore&&CKEDITOR.loadFullCore()},t*1e3))})}(),CKEDITOR.status="basic_loaded"}(),CKEDITOR.dom={},function(){var e=[],t=CKEDITOR.env.gecko?"-moz-":CKEDITOR.env.webkit?"-webkit-":CKEDITOR.env.ie?"-ms-":"",n=/&/g,r=/>/g,i=/</g,s=/"/g,o=/&(lt|gt|amp|quot|nbsp|shy|#\d{1,5});/g,u={lt:"<",gt:">",amp:"&",quot:'"',nbsp:" ",shy:"­"},a=function(e,t){return t[0]=="#"?String.fromCharCode(parseInt(t.slice(1),10)):u[t]};CKEDITOR.on("reset",function(){e=[]}),CKEDITOR.tools={arrayCompare:function(e,t){if(!e&&!t)return!0;if(!e||!t||e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0},getIndex:function(e,t){for(var n=0;n<e.length;++n)if(t(e[n]))return n;return-1},clone:function(e){var t;if(e&&e instanceof Array){t=[];for(var n=0;n<e.length;n++)t[n]=CKEDITOR.tools.clone(e[n]);return t}if(e===null||typeof e!="object"||e instanceof String||e instanceof Number||e instanceof Boolean||e instanceof Date||e instanceof RegExp||e.nodeType||e.window===e)return e;t=new e.constructor;for(n in e)t[n]=CKEDITOR.tools.clone(e[n]);return t},capitalize:function(e,t){return e.charAt(0).toUpperCase()+(t?e.slice(1):e.slice(1).toLowerCase())},extend:function(e){var t=arguments.length,n,r;typeof (n=arguments[t-1])=="boolean"?t--:typeof (n=arguments[t-2])=="boolean"&&(r=arguments[t-1],t-=2);for(var i=1;i<t;i++){var s=arguments[i],o;for(o in s)if(n===!0||e[o]==null)if(!r||o in r)e[o]=s[o]}return e},prototypedCopy:function(e){var t=function(){};return t.prototype=e,new t},copy:function(e){var t={},n;for(n in e)t[n]=e[n];return t},isArray:function(e){return Object.prototype.toString.call(e)=="[object Array]"},isEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},cssVendorPrefix:function(e,n,r){return r?t+e+":"+n+";"+e+":"+n:(r={},r[e]=n,r[t+e]=n,r)},cssStyleToDomStyle:function(){var e=document.createElement("div").style,t=typeof e.cssFloat!="undefined"?"cssFloat":typeof e.styleFloat!="undefined"?"styleFloat":"float";return function(e){return e=="float"?t:e.replace(/-./g,function(e){return e.substr(1).toUpperCase()})}}(),buildStyleHtml:function(e){for(var e=[].concat(e),t,n=[],r=0;r<e.length;r++)if(t=e[r])/@import|[{}]/.test(t)?n.push("<style>"+t+"</style>"):n.push('<link type="text/css" rel=stylesheet href="'+t+'">');return n.join("")},htmlEncode:function(e){return e===void 0||e===null?"":(""+e).replace(n,"&amp;").replace(r,"&gt;").replace(i,"&lt;")},htmlDecode:function(e){return e.replace(o,a)},htmlEncodeAttr:function(e){return CKEDITOR.tools.htmlEncode(e).replace(s,"&quot;")},htmlDecodeAttr:function(e){return CKEDITOR.tools.htmlDecode(e)},transformPlainTextToHtml:function(e,t){var n=t==CKEDITOR.ENTER_BR,r=this.htmlEncode(e.replace(/\r\n/g,"\n")),r=r.replace(/\t/g,"&nbsp;&nbsp; &nbsp;"),i=t==CKEDITOR.ENTER_P?"p":"div";if(!n){var s=/\n{2}/g;if(s.test(r))var o="<"+i+">",u="</"+i+">",r=o+r.replace(s,function(){return u+o})+u}return r=r.replace(/\n/g,"<br>"),n||(r=r.replace(RegExp("<br>(?=</"+i+">)"),function(e){return CKEDITOR.tools.repeat(e,2)})),r=r.replace(/^ | $/g,"&nbsp;"),r=r.replace(/(>|\s) /g,function(e,t){return t+"&nbsp;"}).replace(/ (?=<)/g,"&nbsp;")},getNextNumber:function(){var e=0;return function(){return++e}}(),getNextId:function(){return"cke_"+this.getNextNumber()},getUniqueId:function(){for(var e="e",t=0;t<8;t++)e+=Math.floor((1+Math.random())*65536).toString(16).substring(1);return e},override:function(e,t){var n=t(e);return n.prototype=e.prototype,n},setTimeout:function(e,t,n,r,i){return i||(i=window),n||(n=i),i.setTimeout(function(){r?e.apply(n,[].concat(r)):e.apply(n)},t||0)},trim:function(){var e=/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g;return function(t){return t.replace(e,"")}}(),ltrim:function(){var e=/^[ \t\n\r]+/g;return function(t){return t.replace(e,"")}}(),rtrim:function(){var e=/[ \t\n\r]+$/g;return function(t){return t.replace(e,"")}}(),indexOf:function(e,t){if(typeof t=="function"){for(var n=0,r=e.length;n<r;n++)if(t(e[n]))return n}else{if(e.indexOf)return e.indexOf(t);n=0;for(r=e.length;n<r;n++)if(e[n]===t)return n}return-1},search:function(e,t){var n=CKEDITOR.tools.indexOf(e,t);return n>=0?e[n]:null},bind:function(e,t){return function(){return e.apply(t,arguments)}},createClass:function(e){var t=e.$,n=e.base,r=e.privates||e._,i=e.proto,e=e.statics;!t&&(t=function(){n&&this.base.apply(this,arguments)});if(r)var s=t,t=function(){var e=this._||(this._={}),t;for(t in r){var n=r[t];e[t]=typeof n=="function"?CKEDITOR.tools.bind(n,this):n}s.apply(this,arguments)};return n&&(t.prototype=this.prototypedCopy(n.prototype),t.prototype.constructor=t,t.base=n,t.baseProto=n.prototype,t.prototype.base=function(){this.base=n.prototype.base,n.apply(this,arguments),this.base=arguments.callee}),i&&this.extend(t.prototype,i,!0),e&&this.extend(t,e,!0),t},addFunction:function(t,n){return e.push(function(){return t.apply(n||this,arguments)})-1},removeFunction:function(t){e[t]=null},callFunction:function(t){var n=e[t];return n&&n.apply(window,Array.prototype.slice.call(arguments,1))},cssLength:function(){var e=/^-?\d+\.?\d*px$/,t;return function(n){return t=CKEDITOR.tools.trim(n+"")+"px",e.test(t)?t:n||""}}(),convertToPx:function(){var e;return function(t){return e||(e=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;margin:0px;padding:0px;border:0px;"></div>',CKEDITOR.document),CKEDITOR.document.getBody().append(e)),/%$/.test(t)?t:(e.setStyle("width",t),e.$.clientWidth)}}(),repeat:function(e,t){return Array(t+1).join(e)},tryThese:function(){for(var e,t=0,n=arguments.length;t<n;t++){var r=arguments[t];try{e=r();break}catch(i){}}return e},genKey:function(){return Array.prototype.slice.call(arguments).join("-")},defer:function(e){return function(){var t=arguments,n=this;window.setTimeout(function(){e.apply(n,t)},0)}},normalizeCssText:function(e,t){var n=[],r,i=CKEDITOR.tools.parseCssText(e,!0,t);for(r in i)n.push(r+":"+i[r]);return n.sort(),n.length?n.join(";")+";":""},convertRgbToHex:function(e){return e.replace(/(?:rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\))/gi,function(e,t,n,r){e=[t,n,r];for(t=0;t<3;t++)e[t]=("0"+parseInt(e[t],10).toString(16)).slice(-2);return"#"+e.join("")})},parseCssText:function(e,t,n){var r={};return n&&(n=new CKEDITOR.dom.element("span"),n.setAttribute("style",e),e=CKEDITOR.tools.convertRgbToHex(n.getAttribute("style")||"")),!e||e==";"?r:(e.replace(/&quot;/g,'"').replace(/\s*([^:;\s]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(e,n,i){t&&(n=n.toLowerCase(),n=="font-family"&&(i=i.toLowerCase().replace(/["']/g,"").replace(/\s*,\s*/g,",")),i=CKEDITOR.tools.trim(i)),r[n]=i}),r)},writeCssText:function(e,t){var n,r=[];for(n in e)r.push(n+":"+e[n]);return t&&r.sort(),r.join("; ")},objectCompare:function(e,t,n){var r;if(!e&&!t)return!0;if(!e||!t)return!1;for(r in e)if(e[r]!=t[r])return!1;if(!n)for(r in t)if(e[r]!=t[r])return!1;return!0},objectKeys:function(e){var t=[],n;for(n in e)t.push(n);return t},convertArrayToObject:function(e,t){var n={};arguments.length==1&&(t=!0);for(var r=0,i=e.length;r<i;++r)n[e[r]]=t;return n},fixDomain:function(){for(var e;;)try{e=window.parent.document.domain;break}catch(t){e=e?e.replace(/.+?(?:\.|$)/,""):document.domain;if(!e)break;document.domain=e}return!!e},eventsBuffer:function(e,t,n){function r(){s=(new Date).getTime(),i=!1,n?t.call(n):t()}var i,s=0;return{input:function(){if(!i){var t=(new Date).getTime()-s;t<e?i=setTimeout(r,e-t):r()}},reset:function(){i&&clearTimeout(i),i=s=0}}},enableHtml5Elements:function(e,t){for(var n=["abbr","article","aside","audio","bdi","canvas","data","datalist","details","figcaption","figure","footer","header","hgroup","main","mark","meter","nav","output","progress","section","summary","time","video"],r=n.length,i;r--;)i=e.createElement(n[r]),t&&e.appendChild(i)},checkIfAnyArrayItemMatches:function(e,t){for(var n=0,r=e.length;n<r;++n)if(e[n].match(t))return!0;return!1},checkIfAnyObjectPropertyMatches:function(e,t){for(var n in e)if(n.match(t))return!0;return!1},transparentImageData:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="}}(),CKEDITOR.dtd=function(){var e=CKEDITOR.tools.extend,t=function(e,t){for(var n=CKEDITOR.tools.clone(e),r=1;r<arguments.length;r++){var t=arguments[r],i;for(i in t)delete n[i]}return n},n={},r={},i={address:1,article:1,aside:1,blockquote:1,details:1,div:1,dl:1,fieldset:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,menu:1,nav:1,ol:1,p:1,pre:1,section:1,table:1,ul:1},s={command:1,link:1,meta:1,noscript:1,script:1,style:1},o={},u={"#":1},a={center:1,dir:1,noframes:1};return e(n,{a:1,abbr:1,area:1,audio:1,b:1,bdi:1,bdo:1,br:1,button:1,canvas:1,cite:1,code:1,command:1,datalist:1,del:1,dfn:1,em:1,embed:1,i:1,iframe:1,img:1,input:1,ins:1,kbd:1,keygen:1,label:1,map:1,mark:1,meter:1,noscript:1,object:1,output:1,progress:1,q:1,ruby:1,s:1,samp:1,script:1,select:1,small:1,span:1,strong:1,sub:1,sup:1,textarea:1,time:1,u:1,"var":1,video:1,wbr:1},u,{acronym:1,applet:1,basefont:1,big:1,font:1,isindex:1,strike:1,style:1,tt:1}),e(r,i,n,a),t={a:t(n,{a:1,button:1}),abbr:n,address:r,area:o,article:r,aside:r,audio:e({source:1,track:1},r),b:n,base:o,bdi:n,bdo:n,blockquote:r,body:r,br:o,button:t(n,{a:1,button:1}),canvas:n,caption:r,cite:n,code:n,col:o,colgroup:{col:1},command:o,datalist:e({option:1},n),dd:r,del:n,details:e({summary:1},r),dfn:n,div:r,dl:{dt:1,dd:1},dt:r,em:n,embed:o,fieldset:e({legend:1},r),figcaption:r,figure:e({figcaption:1},r),footer:r,form:r,h1:n,h2:n,h3:n,h4:n,h5:n,h6:n,head:e({title:1,base:1},s),header:r,hgroup:{h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},hr:o,html:e({head:1,body:1},r,s),i:n,iframe:u,img:o,input:o,ins:n,kbd:n,keygen:o,label:n,legend:n,li:r,link:o,main:r,map:r,mark:n,menu:e({li:1},r),meta:o,meter:t(n,{meter:1}),nav:r,noscript:e({link:1,meta:1,style:1},n),object:e({param:1},n),ol:{li:1},optgroup:{option:1},option:u,output:n,p:n,param:o,pre:n,progress:t(n,{progress:1}),q:n,rp:n,rt:n,ruby:e({rp:1,rt:1},n),s:n,samp:n,script:u,section:r,select:{optgroup:1,option:1},small:n,source:o,span:n,strong:n,style:u,sub:n,summary:n,sup:n,table:{caption:1,colgroup:1,thead:1,tfoot:1,tbody:1,tr:1},tbody:{tr:1},td:r,textarea:u,tfoot:{tr:1},th:r,thead:{tr:1},time:t(n,{time:1}),title:u,tr:{th:1,td:1},track:o,u:n,ul:{li:1},"var":n,video:e({source:1,track:1},r),wbr:o,acronym:n,applet:e({param:1},r),basefont:o,big:n,center:r,dialog:o,dir:{li:1},font:n,isindex:o,noframes:r,strike:n,tt:n},e(t,{$block:e({audio:1,dd:1,dt:1,figcaption:1,li:1,video:1},i,a),$blockLimit:{article:1,aside:1,audio:1,body:1,caption:1,details:1,dir:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,header:1,hgroup:1,main:1,menu:1,nav:1,ol:1,section:1,table:1,td:1,th:1,tr:1,ul:1,video:1},$cdata:{script:1,style:1},$editable:{address:1,article:1,aside:1,blockquote:1,body:1,details:1,div:1,fieldset:1,figcaption:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,main:1,nav:1,p:1,pre:1,section:1},$empty:{area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},$inline:n,$list:{dl:1,ol:1,ul:1},$listItem:{dd:1,dt:1,li:1},$nonBodyContent:e({body:1,head:1,html:1},t.head),$nonEditable:{applet:1,audio:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,param:1,script:1,textarea:1,video:1},$object:{applet:1,audio:1,button:1,hr:1,iframe:1,img:1,input:1,object:1,select:1,table:1,textarea:1,video:1},$removeEmpty:{abbr:1,acronym:1,b:1,bdi:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,mark:1,meter:1,output:1,q:1,ruby:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,time:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},$transparent:{a:1,audio:1,canvas:1,del:1,ins:1,map:1,noscript:1,object:1,video:1},$intermediate:{caption:1,colgroup:1,dd:1,dt:1,figcaption:1,legend:1,li:1,optgroup:1,option:1,rp:1,rt:1,summary:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1}}),t}(),CKEDITOR.dom.event=function(e){this.$=e},CKEDITOR.dom.event.prototype={getKey:function(){return this.$.keyCode||this.$.which},getKeystroke:function(){var e=this.getKey();if(this.$.ctrlKey||this.$.metaKey)e+=CKEDITOR.CTRL;return this.$.shiftKey&&(e+=CKEDITOR.SHIFT),this.$.altKey&&(e+=CKEDITOR.ALT),e},preventDefault:function(e){var t=this.$;t.preventDefault?t.preventDefault():t.returnValue=!1,e&&this.stopPropagation()},stopPropagation:function(){var e=this.$;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},getTarget:function(){var e=this.$.target||this.$.srcElement;return e?new CKEDITOR.dom.node(e):null},getPhase:function(){return this.$.eventPhase||2},getPageOffset:function(){var e=this.getTarget().getDocument().$;return{x:this.$.pageX||this.$.clientX+(e.documentElement.scrollLeft||e.body.scrollLeft),y:this.$.pageY||this.$.clientY+(e.documentElement.scrollTop||e.body.scrollTop)}}},CKEDITOR.CTRL=1114112,CKEDITOR.SHIFT=2228224,CKEDITOR.ALT=4456448,CKEDITOR.EVENT_PHASE_CAPTURING=1,CKEDITOR.EVENT_PHASE_AT_TARGET=2,CKEDITOR.EVENT_PHASE_BUBBLING=3,CKEDITOR.dom.domObject=function(e){e&&(this.$=e)},CKEDITOR.dom.domObject.prototype=function(){var e=function(e,t){return function(n){typeof CKEDITOR!="undefined"&&e.fire(t,new CKEDITOR.dom.event(n))}};return{getPrivate:function(){var e;return(e=this.getCustomData("_"))||this.setCustomData("_",e={}),e},on:function(t){var n=this.getCustomData("_cke_nativeListeners");return n||(n={},this.setCustomData("_cke_nativeListeners",n)),n[t]||(n=n[t]=e(this,t),this.$.addEventListener?this.$.addEventListener(t,n,!!CKEDITOR.event.useCapture):this.$.attachEvent&&this.$.attachEvent("on"+t,n)),CKEDITOR.event.prototype.on.apply(this,arguments)},removeListener:function(e){CKEDITOR.event.prototype.removeListener.apply(this,arguments);if(!this.hasListeners(e)){var t=this.getCustomData("_cke_nativeListeners"),n=t&&t[e];n&&(this.$.removeEventListener?this.$.removeEventListener(e,n,!1):this.$.detachEvent&&this.$.detachEvent("on"+e,n),delete t[e])}},removeAllListeners:function(){var e=this.getCustomData("_cke_nativeListeners"),t;for(t in e){var n=e[t];this.$.detachEvent?this.$.detachEvent("on"+t,n):this.$.removeEventListener&&this.$.removeEventListener(t,n,!1),delete e[t]}CKEDITOR.event.prototype.removeAllListeners.call(this)}}}(),function(e){var t={};CKEDITOR.on("reset",function(){t={}}),e.equals=function(e){try{return e&&e.$===this.$}catch(t){return!1}},e.setCustomData=function(e,n){var r=this.getUniqueId();return(t[r]||(t[r]={}))[e]=n,this},e.getCustomData=function(e){var n=this.$["data-cke-expando"];return(n=n&&t[n])&&e in n?n[e]:null},e.removeCustomData=function(e){var n=this.$["data-cke-expando"],n=n&&t[n],r,i;return n&&(r=n[e],i=e in n,delete n[e]),i?r:null},e.clearCustomData=function(){this.removeAllListeners();var e=this.$["data-cke-expando"];e&&delete t[e]},e.getUniqueId=function(){return this.$["data-cke-expando"]||(this.$["data-cke-expando"]=CKEDITOR.tools.getNextNumber())},CKEDITOR.event.implementOn(e)}(CKEDITOR.dom.domObject.prototype),CKEDITOR.dom.node=function(e){return e?new CKEDITOR.dom[e.nodeType==CKEDITOR.NODE_DOCUMENT?"document":e.nodeType==CKEDITOR.NODE_ELEMENT?"element":e.nodeType==CKEDITOR.NODE_TEXT?"text":e.nodeType==CKEDITOR.NODE_COMMENT?"comment":e.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT?"documentFragment":"domObject"](e):this},CKEDITOR.dom.node.prototype=new CKEDITOR.dom.domObject,CKEDITOR.NODE_ELEMENT=1,CKEDITOR.NODE_DOCUMENT=9,CKEDITOR.NODE_TEXT=3,CKEDITOR.NODE_COMMENT=8,CKEDITOR.NODE_DOCUMENT_FRAGMENT=11,CKEDITOR.POSITION_IDENTICAL=0,CKEDITOR.POSITION_DISCONNECTED=1,CKEDITOR.POSITION_FOLLOWING=2,CKEDITOR.POSITION_PRECEDING=4,CKEDITOR.POSITION_IS_CONTAINED=8,CKEDITOR.POSITION_CONTAINS=16,CKEDITOR.tools.extend(CKEDITOR.dom.node.prototype,{appendTo:function(e,t){return e.append(this,t),e},clone:function(e,t){function n(r){r["data-cke-expando"]&&(r["data-cke-expando"]=!1);if(r.nodeType==CKEDITOR.NODE_ELEMENT||r.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT){!t&&r.nodeType==CKEDITOR.NODE_ELEMENT&&r.removeAttribute("id",!1);if(e)for(var r=r.childNodes,i=0;i<r.length;i++)n(r[i])}}function r(t){if(t.type==CKEDITOR.NODE_ELEMENT||t.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT){if(t.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var n=t.getName();n[0]==":"&&t.renameNode(n.substring(1))}if(e)for(n=0;n<t.getChildCount();n++)r(t.getChild(n))}}var i=this.$.cloneNode(e);return n(i),i=new CKEDITOR.dom.node(i),CKEDITOR.env.ie&&CKEDITOR.env.version<9&&(this.type==CKEDITOR.NODE_ELEMENT||this.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT)&&r(i),i},hasPrevious:function(){return!!this.$.previousSibling},hasNext:function(){return!!this.$.nextSibling},insertAfter:function(e){return e.$.parentNode.insertBefore(this.$,e.$.nextSibling),e},insertBefore:function(e){return e.$.parentNode.insertBefore(this.$,e.$),e},insertBeforeMe:function(e){return this.$.parentNode.insertBefore(e.$,this.$),e},getAddress:function(e){for(var t=[],n=this.getDocument().$.documentElement,r=this.$;r&&r!=n;){var i=r.parentNode;i&&t.unshift(this.getIndex.call({$:r},e)),r=i}return t},getDocument:function(){return new CKEDITOR.dom.document(this.$.ownerDocument||this.$.parentNode.ownerDocument)},getIndex:function(e){function t(e,n){var r=n?e.nextSibling:e.previousSibling;return!r||r.nodeType!=CKEDITOR.NODE_TEXT?null:r.nodeValue?r:t(r,n)}var n=this.$,r=-1,i;if(!this.$.parentNode||e&&n.nodeType==CKEDITOR.NODE_TEXT&&!n.nodeValue&&!t(n)&&!t(n,!0))return-1;do if(!e||n==this.$||n.nodeType!=CKEDITOR.NODE_TEXT||!i&&!!n.nodeValue)r++,i=n.nodeType==CKEDITOR.NODE_TEXT;while(n=n.previousSibling);return r},getNextSourceNode:function(e,t,n){if(n&&!n.call)var r=n,n=function(e){return!e.equals(r)};var e=!e&&this.getFirst&&this.getFirst(),i;if(!e){if(this.type==CKEDITOR.NODE_ELEMENT&&n&&n(this,!0)===!1)return null;e=this.getNext()}for(;!e&&(i=(i||this).getParent());){if(n&&n(i,!0)===!1)return null;e=i.getNext()}return!e||n&&n(e)===!1?null:t&&t!=e.type?e.getNextSourceNode(!1,t,n):e},getPreviousSourceNode:function(e,t,n){if(n&&!n.call)var r=n,n=function(e){return!e.equals(r)};var e=!e&&this.getLast&&this.getLast(),i;if(!e){if(this.type==CKEDITOR.NODE_ELEMENT&&n&&n(this,!0)===!1)return null;e=this.getPrevious()}for(;!e&&(i=(i||this).getParent());){if(n&&n(i,!0)===!1)return null;e=i.getPrevious()}return!e||n&&n(e)===!1?null:t&&e.type!=t?e.getPreviousSourceNode(!1,t,n):e},getPrevious:function(e){var t=this.$,n;do n=(t=t.previousSibling)&&t.nodeType!=10&&new CKEDITOR.dom.node(t);while(n&&e&&!e(n));return n},getNext:function(e){var t=this.$,n;do n=(t=t.nextSibling)&&new CKEDITOR.dom.node(t);while(n&&e&&!e(n));return n},getParent:function(e){var t=this.$.parentNode;return t&&(t.nodeType==CKEDITOR.NODE_ELEMENT||e&&t.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT)?new CKEDITOR.dom.node(t):null},getParents:function(e){var t=this,n=[];do n[e?"push":"unshift"](t);while(t=t.getParent());return n},getCommonAncestor:function(e){if(e.equals(this))return this;if(e.contains&&e.contains(this))return e;var t=this.contains?this:this.getParent();do if(t.contains(e))return t;while(t=t.getParent());return null},getPosition:function(e){var t=this.$,n=e.$;if(t.compareDocumentPosition)return t.compareDocumentPosition(n);if(t==n)return CKEDITOR.POSITION_IDENTICAL;if(this.type==CKEDITOR.NODE_ELEMENT&&e.type==CKEDITOR.NODE_ELEMENT){if(t.contains){if(t.contains(n))return CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING;if(n.contains(t))return CKEDITOR.POSITION_IS_CONTAINED+CKEDITOR.POSITION_FOLLOWING}if("sourceIndex"in t)return t.sourceIndex<0||n.sourceIndex<0?CKEDITOR.POSITION_DISCONNECTED:t.sourceIndex<n.sourceIndex?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING}for(var t=this.getAddress(),e=e.getAddress(),n=Math.min(t.length,e.length),r=0;r<n;r++)if(t[r]!=e[r])return t[r]<e[r]?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING;return t.length<e.length?CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_IS_CONTAINED+CKEDITOR.POSITION_FOLLOWING},getAscendant:function(e,t){var n=this.$,r,i;t||(n=n.parentNode),typeof e=="function"?(i=!0,r=e):(i=!1,r=function(t){return t=typeof t.nodeName=="string"?t.nodeName.toLowerCase():"",typeof e=="string"?t==e:t in e});for(;n;){if(r(i?new CKEDITOR.dom.node(n):n))return new CKEDITOR.dom.node(n);try{n=n.parentNode}catch(s){n=null}}return null},hasAscendant:function(e,t){var n=this.$;t||(n=n.parentNode);for(;n;){if(n.nodeName&&n.nodeName.toLowerCase()==e)return!0;n=n.parentNode}return!1},move:function(e,t){e.append(this.remove(),t)},remove:function(e){var t=this.$,n=t.parentNode;if(n){if(e)for(;e=t.firstChild;)n.insertBefore(t.removeChild(e),t);n.removeChild(t)}return this},replace:function(e){this.insertBefore(e),e.remove()},trim:function(){this.ltrim(),this.rtrim()},ltrim:function(){for(var e;this.getFirst&&(e=this.getFirst());){if(e.type==CKEDITOR.NODE_TEXT){var t=CKEDITOR.tools.ltrim(e.getText()),n=e.getLength();if(!t){e.remove();continue}t.length<n&&(e.split(n-t.length),this.$.removeChild(this.$.firstChild))}break}},rtrim:function(){for(var e;this.getLast&&(e=this.getLast());){if(e.type==CKEDITOR.NODE_TEXT){var t=CKEDITOR.tools.rtrim(e.getText()),n=e.getLength();if(!t){e.remove();continue}t.length<n&&(e.split(t.length),this.$.lastChild.parentNode.removeChild(this.$.lastChild))}break}CKEDITOR.env.needsBrFiller&&(e=this.$.lastChild)&&e.type==1&&e.nodeName.toLowerCase()=="br"&&e.parentNode.removeChild(e)},isReadOnly:function(e){var t=this;this.type!=CKEDITOR.NODE_ELEMENT&&(t=this.getParent()),CKEDITOR.env.edge&&t&&t.is("textarea")&&(e=!0);if(!e&&t&&typeof t.$.isContentEditable!="undefined")return!t.$.isContentEditable&&!t.data("cke-editable");for(;t;){if(t.data("cke-editable"))return!1;if(t.hasAttribute("contenteditable"))return t.getAttribute("contenteditable")=="false";t=t.getParent()}return!0}}),CKEDITOR.dom.window=function(e){CKEDITOR.dom.domObject.call(this,e)},CKEDITOR.dom.window.prototype=new CKEDITOR.dom.domObject,CKEDITOR.tools.extend(CKEDITOR.dom.window.prototype,{focus:function(){this.$.focus()},getViewPaneSize:function(){var e=this.$.document,t=e.compatMode=="CSS1Compat";return{width:(t?e.documentElement.clientWidth:e.body.clientWidth)||0,height:(t?e.documentElement.clientHeight:e.body.clientHeight)||0}},getScrollPosition:function(){var e=this.$;return"pageXOffset"in e?{x:e.pageXOffset||0,y:e.pageYOffset||0}:(e=e.document,{x:e.documentElement.scrollLeft||e.body.scrollLeft||0,y:e.documentElement.scrollTop||e.body.scrollTop||0})},getFrame:function(){var e=this.$.frameElement;return e?new CKEDITOR.dom.element.get(e):null}}),CKEDITOR.dom.document=function(e){CKEDITOR.dom.domObject.call(this,e)},CKEDITOR.dom.document.prototype=new CKEDITOR.dom.domObject,CKEDITOR.tools.extend(CKEDITOR.dom.document.prototype,{type:CKEDITOR.NODE_DOCUMENT,appendStyleSheet:function(e){if(this.$.createStyleSheet)this.$.createStyleSheet(e);else{var t=new CKEDITOR.dom.element("link");t.setAttributes({rel:"stylesheet",type:"text/css",href:e}),this.getHead().append(t)}},appendStyleText:function(e){if(this.$.createStyleSheet){var t=this.$.createStyleSheet("");t.cssText=e}else{var n=new CKEDITOR.dom.element("style",this);n.append(new CKEDITOR.dom.text(e,this)),this.getHead().append(n)}return t||n.$.sheet},createElement:function(e,t){var n=new CKEDITOR.dom.element(e,this);return t&&(t.attributes&&n.setAttributes(t.attributes),t.styles&&n.setStyles(t.styles)),n},createText:function(e){return new CKEDITOR.dom.text(e,this)},focus:function(){this.getWindow().focus()},getActive:function(){var e;try{e=this.$.activeElement}catch(t){return null}return new CKEDITOR.dom.element(e)},getById:function(e){return(e=this.$.getElementById(e))?new CKEDITOR.dom.element(e):null},getByAddress:function(e,t){for(var n=this.$.documentElement,r=0;n&&r<e.length;r++){var i=e[r];if(t)for(var s=-1,o=0;o<n.childNodes.length;o++){var u=n.childNodes[o];if(t!==!0||u.nodeType!=3||!u.previousSibling||u.previousSibling.nodeType!=3){s++;if(s==i){n=u;break}}}else n=n.childNodes[i]}return n?new CKEDITOR.dom.node(n):null},getElementsByTag:function(e,t){return!(CKEDITOR.env.ie&&document.documentMode<=8)&&t&&(e=t+":"+e),new CKEDITOR.dom.nodeList(this.$.getElementsByTagName(e))},getHead:function(){var e=this.$.getElementsByTagName("head")[0];return e=e?new CKEDITOR.dom.element(e):this.getDocumentElement().append(new CKEDITOR.dom.element("head"),!0)},getBody:function(){return new CKEDITOR.dom.element(this.$.body)},getDocumentElement:function(){return new CKEDITOR.dom.element(this.$.documentElement)},getWindow:function(){return new CKEDITOR.dom.window(this.$.parentWindow||this.$.defaultView)},write:function(e){this.$.open("text/html","replace"),CKEDITOR.env.ie&&(e=e.replace(/(?:^\s*<!DOCTYPE[^>]*?>)|^/i,'$&\n<script data-cke-temp="1">('+CKEDITOR.tools.fixDomain+")();</script>")),this.$.write(e),this.$.close()},find:function(e){return new CKEDITOR.dom.nodeList(this.$.querySelectorAll(e))},findOne:function(e){return(e=this.$.querySelector(e))?new CKEDITOR.dom.element(e):null},_getHtml5ShivFrag:function(){var e=this.getCustomData("html5ShivFrag");return e||(e=this.$.createDocumentFragment(),CKEDITOR.tools.enableHtml5Elements(e,!0),this.setCustomData("html5ShivFrag",e)),e}}),CKEDITOR.dom.nodeList=function(e){this.$=e},CKEDITOR.dom.nodeList.prototype={count:function(){return this.$.length},getItem:function(e){return e<0||e>=this.$.length?null:(e=this.$[e])?new CKEDITOR.dom.node(e):null}},CKEDITOR.dom.element=function(e,t){typeof e=="string"&&(e=(t?t.$:document).createElement(e)),CKEDITOR.dom.domObject.call(this,e)},CKEDITOR.dom.element.get=function(e){return(e=typeof e=="string"?document.getElementById(e)||document.getElementsByName(e)[0]:e)&&(e.$?e:new CKEDITOR.dom.element(e))},CKEDITOR.dom.element.prototype=new CKEDITOR.dom.node,CKEDITOR.dom.element.createFromHtml=function(e,t){var n=new CKEDITOR.dom.element("div",t);return n.setHtml(e),n.getFirst().remove()},CKEDITOR.dom.element.setMarker=function(e,t,n,r){var i=t.getCustomData("list_marker_id")||t.setCustomData("list_marker_id",CKEDITOR.tools.getNextNumber()).getCustomData("list_marker_id"),s=t.getCustomData("list_marker_names")||t.setCustomData("list_marker_names",{}).getCustomData("list_marker_names");return e[i]=t,s[n]=1,t.setCustomData(n,r)},CKEDITOR.dom.element.clearAllMarkers=function(e){for(var t in e)CKEDITOR.dom.element.clearMarkers(e,e[t],1)},CKEDITOR.dom.element.clearMarkers=function(e,t,n){var r=t.getCustomData("list_marker_names"),i=t.getCustomData("list_marker_id"),s;for(s in r)t.removeCustomData(s);t.removeCustomData("list_marker_names"),n&&(t.removeCustomData("list_marker_id"),delete e[i])},function(){function e(e,t){return(" "+e+" ").replace(s," ").indexOf(" "+t+" ")>-1}function t(e){var t=!0;return e.$.id||(e.$.id="cke_tmp_"+CKEDITOR.tools.getNextNumber(),t=!1),function(){t||e.removeAttribute("id")}}function n(e,t){return"#"+e.$.id+" "+t.split(/,\s*/).join(", #"+e.$.id+" ")}function r(e){for(var t=0,n=0,r=o[e].length;n<r;n++)t+=parseInt(this.getComputedStyle(o[e][n])||0,10)||0;return t}var i=!!document.createElement("span").classList,s=/[\n\t\r]/g;CKEDITOR.tools.extend(CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_ELEMENT,addClass:i?function(e){return this.$.classList.add(e),this}:function(t){var n=this.$.className;return n&&(e(n,t)||(n+=" "+t)),this.$.className=n||t,this},removeClass:i?function(e){var t=this.$;return t.classList.remove(e),t.className||t.removeAttribute("class"),this}:function(t){var n=this.getAttribute("class");return n&&e(n,t)&&((n=n.replace(RegExp("(?:^|\\s+)"+t+"(?=\\s|$)"),"").replace(/^\s+/,""))?this.setAttribute("class",n):this.removeAttribute("class")),this},hasClass:function(t){return e(this.$.className,t)},append:function(e,t){return typeof e=="string"&&(e=this.getDocument().createElement(e)),t?this.$.insertBefore(e.$,this.$.firstChild):this.$.appendChild(e.$),e},appendHtml:function(e){if(this.$.childNodes.length){var t=new CKEDITOR.dom.element("div",this.getDocument());t.setHtml(e),t.moveChildren(this)}else this.setHtml(e)},appendText:function(e){this.$.text!=null&&CKEDITOR.env.ie&&CKEDITOR.env.version<9?this.$.text=this.$.text+e:this.append(new CKEDITOR.dom.text(e))},appendBogus:function(e){if(e||CKEDITOR.env.needsBrFiller){for(e=this.getLast();e&&e.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.rtrim(e.getText());)e=e.getPrevious();if(!e||!e.is||!e.is("br"))e=this.getDocument().createElement("br"),CKEDITOR.env.gecko&&e.setAttribute("type","_moz"),this.append(e)}},breakParent:function(e,t){var n=new CKEDITOR.dom.range(this.getDocument());n.setStartAfter(this),n.setEndAfter(e);var r=n.extractContents(!1,t||!1);n.insertNode(this.remove()),r.insertAfterNode(this)},contains:document.compareDocumentPosition?function(e){return!!(this.$.compareDocumentPosition(e.$)&16)}:function(e){var t=this.$;return e.type!=CKEDITOR.NODE_ELEMENT?t.contains(e.getParent().$):t!=e.$&&t.contains(e.$)},focus:function(){function e(){try{this.$.focus()}catch(e){}}return function(t){t?CKEDITOR.tools.setTimeout(e,100,this):e.call(this)}}(),getHtml:function(){var e=this.$.innerHTML;return CKEDITOR.env.ie?e.replace(/<\?[^>]*>/g,""):e},getOuterHtml:function(){if(this.$.outerHTML)return this.$.outerHTML.replace(/<\?[^>]*>/,"");var e=this.$.ownerDocument.createElement("div");return e.appendChild(this.$.cloneNode(!0)),e.innerHTML},getClientRect:function(){var e=CKEDITOR.tools.extend({},this.$.getBoundingClientRect());return!e.width&&(e.width=e.right-e.left),!e.height&&(e.height=e.bottom-e.top),e},setHtml:CKEDITOR.env.ie&&CKEDITOR.env.version<9?function(e){try{var t=this.$;if(this.getParent())return t.innerHTML=e;var n=this.getDocument()._getHtml5ShivFrag();return n.appendChild(t),t.innerHTML=e,n.removeChild(t),e}catch(r){this.$.innerHTML="",t=new CKEDITOR.dom.element("body",this.getDocument()),t.$.innerHTML=e;for(t=t.getChildren();t.count();)this.append(t.getItem(0));return e}}:function(e){return this.$.innerHTML=e},setText:function(){var e=document.createElement("p");return e.innerHTML="x",e=e.textContent,function(t){this.$[e?"textContent":"innerText"]=t}}(),getAttribute:function(){var e=function(e){return this.$.getAttribute(e,2)};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(e){switch(e){case"class":e="className";break;case"http-equiv":e="httpEquiv";break;case"name":return this.$.name;case"tabindex":return e=this.$.getAttribute(e,2),e!==0&&this.$.tabIndex===0&&(e=null),e;case"checked":return e=this.$.attributes.getNamedItem(e),(e.specified?e.nodeValue:this.$.checked)?"checked":null;case"hspace":case"value":return this.$[e];case"style":return this.$.style.cssText;case"contenteditable":case"contentEditable":return this.$.attributes.getNamedItem("contentEditable").specified?this.$.getAttribute("contentEditable"):null}return this.$.getAttribute(e,2)}:e}(),getChildren:function(){return new CKEDITOR.dom.nodeList(this.$.childNodes)},getComputedStyle:document.defaultView&&document.defaultView.getComputedStyle?function(e){var t=this.getWindow().$.getComputedStyle(this.$,null);return t?t.getPropertyValue(e):""}:function(e){return this.$.currentStyle[CKEDITOR.tools.cssStyleToDomStyle(e)]},getDtd:function(){var e=CKEDITOR.dtd[this.getName()];return this.getDtd=function(){return e},e},getElementsByTag:CKEDITOR.dom.document.prototype.getElementsByTag,getTabIndex:function(){var e=this.$.tabIndex;return e===0&&!CKEDITOR.dtd.$tabIndex[this.getName()]&&parseInt(this.getAttribute("tabindex"),10)!==0?-1:e},getText:function(){return this.$.textContent||this.$.innerText||""},getWindow:function(){return this.getDocument().getWindow()},getId:function(){return this.$.id||null},getNameAtt:function(){return this.$.name||null},getName:function(){var e=this.$.nodeName.toLowerCase();if(CKEDITOR.env.ie&&document.documentMode<=8){var t=this.$.scopeName;t!="HTML"&&(e=t.toLowerCase()+":"+e)}return this.getName=function(){return e},this.getName()},getValue:function(){return this.$.value},getFirst:function(e){var t=this.$.firstChild;return(t=t&&new CKEDITOR.dom.node(t))&&e&&!e(t)&&(t=t.getNext(e)),t},getLast:function(e){var t=this.$.lastChild;return(t=t&&new CKEDITOR.dom.node(t))&&e&&!e(t)&&(t=t.getPrevious(e)),t},getStyle:function(e){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(e)]},is:function(){var e=this.getName();if(typeof arguments[0]=="object")return!!arguments[0][e];for(var t=0;t<arguments.length;t++)if(arguments[t]==e)return!0;return!1},isEditable:function(e){var t=this.getName();return this.isReadOnly()||this.getComputedStyle("display")=="none"||this.getComputedStyle("visibility")=="hidden"||CKEDITOR.dtd.$nonEditable[t]||CKEDITOR.dtd.$empty[t]||this.is("a")&&(this.data("cke-saved-name")||this.hasAttribute("name"))&&!this.getChildCount()?!1:e!==!1?(e=CKEDITOR.dtd[t]||CKEDITOR.dtd.span,!!e&&!!e["#"]):!0},isIdentical:function(e){var t=this.clone(0,1),e=e.clone(0,1);t.removeAttributes(["_moz_dirty","data-cke-expando","data-cke-saved-href","data-cke-saved-name"]),e.removeAttributes(["_moz_dirty","data-cke-expando","data-cke-saved-href","data-cke-saved-name"]);if(t.$.isEqualNode)return t.$.style.cssText=CKEDITOR.tools.normalizeCssText(t.$.style.cssText),e.$.style.cssText=CKEDITOR.tools.normalizeCssText(e.$.style.cssText),t.$.isEqualNode(e.$);t=t.getOuterHtml(),e=e.getOuterHtml();if(CKEDITOR.env.ie&&CKEDITOR.env.version<9&&this.is("a")){var n=this.getParent();n.type==CKEDITOR.NODE_ELEMENT&&(n=n.clone(),n.setHtml(t),t=n.getHtml(),n.setHtml(e),e=n.getHtml())}return t==e},isVisible:function(){var e=(this.$.offsetHeight||this.$.offsetWidth)&&this.getComputedStyle("visibility")!="hidden",t,n;return e&&CKEDITOR.env.webkit&&(t=this.getWindow(),!t.equals(CKEDITOR.document.getWindow())&&(n=t.$.frameElement)&&(e=(new CKEDITOR.dom.element(n)).isVisible())),!!e},isEmptyInlineRemoveable:function(){if(!CKEDITOR.dtd.$removeEmpty[this.getName()])return!1;for(var e=this.getChildren(),t=0,n=e.count();t<n;t++){var r=e.getItem(t);if((r.type!=CKEDITOR.NODE_ELEMENT||!r.data("cke-bookmark"))&&(r.type==CKEDITOR.NODE_ELEMENT&&!r.isEmptyInlineRemoveable()||r.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(r.getText())))return!1}return!0},hasAttributes:CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(){for(var e=this.$.attributes,t=0;t<e.length;t++){var n=e[t];switch(n.nodeName){case"class":if(this.getAttribute("class"))return!0;case"data-cke-expando":continue;default:if(n.specified)return!0}}return!1}:function(){var e=this.$.attributes,t=e.length,n={"data-cke-expando":1,_moz_dirty:1};return t>0&&(t>2||!n[e[0].nodeName]||t==2&&!n[e[1].nodeName])},hasAttribute:function(){function e(e){var t=this.$.attributes.getNamedItem(e);if(this.getName()=="input")switch(e){case"class":return this.$.className.length>0;case"checked":return!!this.$.checked;case"value":return e=this.getAttribute("type"),e=="checkbox"||e=="radio"?this.$.value!="on":!!this.$.value}return t?t.specified:!1}return CKEDITOR.env.ie?CKEDITOR.env.version<8?function(t){return t=="name"?!!this.$.name:e.call(this,t)}:e:function(e){return!!this.$.attributes.getNamedItem(e)}}(),hide:function(){this.setStyle("display","none")},moveChildren:function(e,t){var n=this.$,e=e.$;if(n!=e){var r;if(t)for(;r=n.lastChild;)e.insertBefore(n.removeChild(r),e.firstChild);else for(;r=n.firstChild;)e.appendChild(n.removeChild(r))}},mergeSiblings:function(){function e(e,t,n){if(t&&t.type==CKEDITOR.NODE_ELEMENT){for(var r=[];t.data("cke-bookmark")||t.isEmptyInlineRemoveable();){r.push(t),t=n?t.getNext():t.getPrevious();if(!t||t.type!=CKEDITOR.NODE_ELEMENT)return}if(e.isIdentical(t)){for(var i=n?e.getLast():e.getFirst();r.length;)r.shift().move(e,!n);t.moveChildren(e,!n),t.remove(),i&&i.type==CKEDITOR.NODE_ELEMENT&&i.mergeSiblings()}}}return function(t){if(t===!1||CKEDITOR.dtd.$removeEmpty[this.getName()]||this.is("a"))e(this,this.getNext(),!0),e(this,this.getPrevious())}}(),show:function(){this.setStyles({display:"",visibility:""})},setAttribute:function(){var e=function(e,t){return this.$.setAttribute(e,t),this};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(t,n){return t=="class"?this.$.className=n:t=="style"?this.$.style.cssText=n:t=="tabindex"?this.$.tabIndex=n:t=="checked"?this.$.checked=n:t=="contenteditable"?e.call(this,"contentEditable",n):e.apply(this,arguments),this}:CKEDITOR.env.ie8Compat&&CKEDITOR.env.secure?function(t,n){if(t=="src"&&n.match(/^http:\/\//))try{e.apply(this,arguments)}catch(r){}else e.apply(this,arguments);return this}:e}(),setAttributes:function(e){for(var t in e)this.setAttribute(t,e[t]);return this},setValue:function(e){return this.$.value=e,this},removeAttribute:function(){var e=function(e){this.$.removeAttribute(e)};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(e){e=="class"?e="className":e=="tabindex"?e="tabIndex":e=="contenteditable"&&(e="contentEditable"),this.$.removeAttribute(e)}:e}(),removeAttributes:function(e){if(CKEDITOR.tools.isArray(e))for(var t=0;t<e.length;t++)this.removeAttribute(e[t]);else for(t in e)e.hasOwnProperty(t)&&this.removeAttribute(t)},removeStyle:function(e){var t=this.$.style;if(!!t.removeProperty||e!="border"&&e!="margin"&&e!="padding")t.removeProperty?t.removeProperty(e):t.removeAttribute(CKEDITOR.tools.cssStyleToDomStyle(e)),this.$.style.cssText||this.removeAttribute("style");else{var n=["top","left","right","bottom"],r;e=="border"&&(r=["color","style","width"]);for(var t=[],i=0;i<n.length;i++)if(r)for(var s=0;s<r.length;s++)t.push([e,n[i],r[s]].join("-"));else t.push([e,n[i]].join("-"));for(e=0;e<t.length;e++)this.removeStyle(t[e])}},setStyle:function(e,t){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(e)]=t,this},setStyles:function(e){for(var t in e)this.setStyle(t,e[t]);return this},setOpacity:function(e){CKEDITOR.env.ie&&CKEDITOR.env.version<9?(e=Math.round(e*100),this.setStyle("filter",e>=100?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+e+")")):this.setStyle("opacity",e)},unselectable:function(){this.setStyles(CKEDITOR.tools.cssVendorPrefix("user-select","none"));if(CKEDITOR.env.ie){this.setAttribute("unselectable","on");for(var e,t=this.getElementsByTag("*"),n=0,r=t.count();n<r;n++)e=t.getItem(n),e.setAttribute("unselectable","on")}},getPositionedAncestor:function(){for(var e=this;e.getName()!="html";){if(e.getComputedStyle("position")!="static")return e;e=e.getParent()}return null},getDocumentPosition:function(e){var t=0,n=0,r=this.getDocument(),i=r.getBody(),s=r.$.compatMode=="BackCompat";if(document.documentElement.getBoundingClientRect){var o=this.$.getBoundingClientRect(),u=r.$.documentElement,a=u.clientTop||i.$.clientTop||0,f=u.clientLeft||i.$.clientLeft||0,l=!0;CKEDITOR.env.ie&&(l=r.getDocumentElement().contains(this),r=r.getBody().contains(this),l=s&&r||!s&&l),l&&(CKEDITOR.env.webkit||CKEDITOR.env.ie&&CKEDITOR.env.version>=12?(t=i.$.scrollLeft||u.scrollLeft,n=i.$.scrollTop||u.scrollTop):(n=s?i.$:u,t=n.scrollLeft,n=n.scrollTop),t=o.left+t-f,n=o.top+n-a)}else{a=this;for(f=null;a&&a.getName()!="body"&&a.getName()!="html";){t+=a.$.offsetLeft-a.$.scrollLeft,n+=a.$.offsetTop-a.$.scrollTop,a.equals(this)||(t+=a.$.clientLeft||0,n+=a.$.clientTop||0);for(;f&&!f.equals(a);)t-=f.$.scrollLeft,n-=f.$.scrollTop,f=f.getParent();f=a,a=(o=a.$.offsetParent)?new CKEDITOR.dom.element(o):null}}return e&&(o=this.getWindow(),a=e.getWindow(),!o.equals(a)&&o.$.frameElement&&(e=(new CKEDITOR.dom.element(o.$.frameElement)).getDocumentPosition(e),t+=e.x,n+=e.y)),!document.documentElement.getBoundingClientRect&&CKEDITOR.env.gecko&&!s&&(t+=this.$.clientLeft?1:0,n+=this.$.clientTop?1:0),{x:t,y:n}},scrollIntoView:function(e){var t=this.getParent();if(t)do{(t.$.clientWidth&&t.$.clientWidth<t.$.scrollWidth||t.$.clientHeight&&t.$.clientHeight<t.$.scrollHeight)&&!t.is("body")&&this.scrollIntoParent(t,e,1);if(t.is("html")){var n=t.getWindow();try{var r=n.$.frameElement;r&&(t=new CKEDITOR.dom.element(r))}catch(i){}}}while(t=t.getParent())},scrollIntoParent:function(e,t,n){function u(t,n){/body|html/.test(e.getName())?e.getWindow().$.scrollBy(t,n):(e.$.scrollLeft=e.$.scrollLeft+t,e.$.scrollTop=e.$.scrollTop+n)}function a(e,t){var n={x:0,y:0};if(!e.is(l?"body":"html")){var r=e.$.getBoundingClientRect();n.x=r.left,n.y=r.top}return r=e.getWindow(),r.equals(t)||(r=a(CKEDITOR.dom.element.get(r.$.frameElement),t),n.x=n.x+r.x,n.y=n.y+r.y),n}function f(e,t){return parseInt(e.getComputedStyle("margin-"+t)||0,10)||0}var r,i,s,o;!e&&(e=this.getWindow()),s=e.getDocument();var l=s.$.compatMode=="BackCompat";e instanceof CKEDITOR.dom.window&&(e=l?s.getBody():s.getDocumentElement()),s=e.getWindow(),i=a(this,s);var c=a(e,s),h=this.$.offsetHeight;r=this.$.offsetWidth;var p=e.$.clientHeight,d=e.$.clientWidth;s=i.x-f(this,"left")-c.x||0,o=i.y-f(this,"top")-c.y||0,r=i.x+r+f(this,"right")-(c.x+d)||0,i=i.y+h+f(this,"bottom")-(c.y+p)||0,(o<0||i>0)&&u(0,t===!0?o:t===!1?i:o<0?o:i),n&&(s<0||r>0)&&u(s<0?s:r,0)},setState:function(e,t,n){t=t||"cke";switch(e){case CKEDITOR.TRISTATE_ON:this.addClass(t+"_on"),this.removeClass(t+"_off"),this.removeClass(t+"_disabled"),n&&this.setAttribute("aria-pressed",!0),n&&this.removeAttribute("aria-disabled");break;case CKEDITOR.TRISTATE_DISABLED:this.addClass(t+"_disabled"),this.removeClass(t+"_off"),this.removeClass(t+"_on"),n&&this.setAttribute("aria-disabled",!0),n&&this.removeAttribute("aria-pressed");break;default:this.addClass(t+"_off"),this.removeClass(t+"_on"),this.removeClass(t+"_disabled"),n&&this.removeAttribute("aria-pressed"),n&&this.removeAttribute("aria-disabled")}},getFrameDocument:function(){var e=this.$;try{e.contentWindow.document}catch(t){e.src=e.src}return e&&new CKEDITOR.dom.document(e.contentWindow.document)},copyAttributes:function(e,t){for(var n=this.$.attributes,t=t||{},r=0;r<n.length;r++){var i=n[r],s=i.nodeName.toLowerCase(),o;if(!(s in t))if(s=="checked"&&(o=this.getAttribute(s)))e.setAttribute(s,o);else if(!CKEDITOR.env.ie||this.hasAttribute(s))o=this.getAttribute(s),o===null&&(o=i.nodeValue),e.setAttribute(s,o)}this.$.style.cssText!==""&&(e.$.style.cssText=this.$.style.cssText)},renameNode:function(e){if(this.getName()!=e){var t=this.getDocument(),e=new CKEDITOR.dom.element(e,t);this.copyAttributes(e),this.moveChildren(e),this.getParent(!0)&&this.$.parentNode.replaceChild(e.$,this.$),e.$["data-cke-expando"]=this.$["data-cke-expando"],this.$=e.$,delete this.getName}},getChild:function(){function e(e,t){var n=e.childNodes;if(t>=0&&t<n.length)return n[t]}return function(t){var n=this.$;if(t.slice)for(t=t.slice();t.length>0&&n;)n=e(n,t.shift());else n=e(n,t);return n?new CKEDITOR.dom.node(n):null}}(),getChildCount:function(){return this.$.childNodes.length},disableContextMenu:function(){this.on("contextmenu",function(e){e.data.getTarget().hasClass("cke_enable_context_menu")||e.data.preventDefault()})},getDirection:function(e){return e?this.getComputedStyle("direction")||this.getDirection()||this.getParent()&&this.getParent().getDirection(1)||this.getDocument().$.dir||"ltr":this.getStyle("direction")||this.getAttribute("dir")},data:function(e,t){return e="data-"+e,t===void 0?this.getAttribute(e):(t===!1?this.removeAttribute(e):this.setAttribute(e,t),null)},getEditor:function(){var e=CKEDITOR.instances,t,n;for(t in e){n=e[t];if(n.element.equals(this)&&n.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO)return n}return null},find:function(e){var r=t(this),e=new CKEDITOR.dom.nodeList(this.$.querySelectorAll(n(this,e)));return r(),e},findOne:function(e){var r=t(this),e=this.$.querySelector(n(this,e));return r(),e?new CKEDITOR.dom.element(e):null},forEach:function(e,t,n){if(!n&&(!t||this.type==t))var r=e(this);if(r!==!1)for(var n=this.getChildren(),i=0;i<n.count();i++)r=n.getItem(i),r.type==CKEDITOR.NODE_ELEMENT?r.forEach(e,t):(!t||r.type==t)&&e(r)}});var o={width:["border-left-width","border-right-width","padding-left","padding-right"],height:["border-top-width","border-bottom-width","padding-top","padding-bottom"]};CKEDITOR.dom.element.prototype.setSize=function(e,t,n){typeof t=="number"&&(n&&(!CKEDITOR.env.ie||!CKEDITOR.env.quirks)&&(t-=r.call(this,e)),this.setStyle(e,t+"px"))},CKEDITOR.dom.element.prototype.getSize=function(e,t){var n=Math.max(this.$["offset"+CKEDITOR.tools.capitalize(e)],this.$["client"+CKEDITOR.tools.capitalize(e)])||0;return t&&(n-=r.call(this,e)),n}}(),CKEDITOR.dom.documentFragment=function(e){e=e||CKEDITOR.document,this.$=e.type==CKEDITOR.NODE_DOCUMENT?e.$.createDocumentFragment():e},CKEDITOR.tools.extend(CKEDITOR.dom.documentFragment.prototype,CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,insertAfterNode:function(e){e=e.$,e.parentNode.insertBefore(this.$,e.nextSibling)},getHtml:function(){var e=new CKEDITOR.dom.element("div");return this.clone(1,1).appendTo(e),e.getHtml().replace(/\s*data-cke-expando=".*?"/g,"")}},!0,{append:1,appendBogus:1,clone:1,getFirst:1,getHtml:1,getLast:1,getParent:1,getNext:1,getPrevious:1,appendTo:1,moveChildren:1,insertBefore:1,insertAfterNode:1,replace:1,trim:1,type:1,ltrim:1,rtrim:1,getDocument:1,getChildCount:1,getChild:1,getChildren:1}),function(){function e(e,t){var n=this.range;if(this._.end)return null;if(!this._.start){this._.start=1;if(n.collapsed)return this.end(),null;n.optimize()}var r,i=n.startContainer;r=n.endContainer;var s=n.startOffset,o=n.endOffset,u,a=this.guard,f=this.type,l=e?"getPreviousSourceNode":"getNextSourceNode";if(!e&&!this._.guardLTR){var c=r.type==CKEDITOR.NODE_ELEMENT?r:r.getParent(),h=r.type==CKEDITOR.NODE_ELEMENT?r.getChild(o):r.getNext();this._.guardLTR=function(e,t){return(!t||!c.equals(e))&&(!h||!e.equals(h))&&(e.type!=CKEDITOR.NODE_ELEMENT||!t||!e.equals(n.root))}}if(e&&!this._.guardRTL){var p=i.type==CKEDITOR.NODE_ELEMENT?i:i.getParent(),d=i.type==CKEDITOR.NODE_ELEMENT?s?i.getChild(s-1):null:i.getPrevious();this._.guardRTL=function(e,t){return(!t||!p.equals(e))&&(!d||!e.equals(d))&&(e.type!=CKEDITOR.NODE_ELEMENT||!t||!e.equals(n.root))}}var v=e?this._.guardRTL:this._.guardLTR;u=a?function(e,t){return v(e,t)===!1?!1:a(e,t)}:v,this.current?r=this.current[l](!1,f,u):(e?r.type==CKEDITOR.NODE_ELEMENT&&(r=o>0?r.getChild(o-1):u(r,!0)===!1?null:r.getPreviousSourceNode(!0,f,u)):(r=i,r.type==CKEDITOR.NODE_ELEMENT&&!(r=r.getChild(s))&&(r=u(i,!0)===!1?null:i.getNextSourceNode(!0,f,u))),r&&u(r)===!1&&(r=null));for(;r&&!this._.end;){this.current=r;if(!this.evaluator||this.evaluator(r)!==!1){if(!t)return r}else if(t&&this.evaluator)return!1;r=r[l](!1,f,u)}return this.end(),this.current=null}function t(t){for(var n,r=null;n=e.call(this,t);)r=n;return r}CKEDITOR.dom.walker=CKEDITOR.tools.createClass({$:function(e){this.range=e,this._={}},proto:{end:function(){this._.end=1},next:function(){return e.call(this)},previous:function(){return e.call(this,1)},checkForward:function(){return e.call(this,0,1)!==!1},checkBackward:function(){return e.call(this,1,1)!==!1},lastForward:function(){return t.call(this)},lastBackward:function(){return t.call(this,1)},reset:function(){delete this.current,this._={}}}});var n={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},r={absolute:1,fixed:1};CKEDITOR.dom.element.prototype.isBlockBoundary=function(e){return this.getComputedStyle("float")!="none"||this.getComputedStyle("position")in r||!n[this.getComputedStyle("display")]?!!(this.is(CKEDITOR.dtd.$block)||e&&this.is(e)):!0},CKEDITOR.dom.walker.blockBoundary=function(e){return function(t){return t.type!=CKEDITOR.NODE_ELEMENT||!t.isBlockBoundary(e)}},CKEDITOR.dom.walker.listItemBoundary=function(){return this.blockBoundary({br:1})},CKEDITOR.dom.walker.bookmark=function(e,t){function n(e){return e&&e.getName&&e.getName()=="span"&&e.data("cke-bookmark")}return function(r){var i,s;return i=r&&r.type!=CKEDITOR.NODE_ELEMENT&&(s=r.getParent())&&n(s),i=e?i:i||n(r),!!(t^i)}},CKEDITOR.dom.walker.whitespaces=function(e){return function(t){var n;return t&&t.type==CKEDITOR.NODE_TEXT&&(n=!CKEDITOR.tools.trim(t.getText())||CKEDITOR.env.webkit&&t.getText()=="​"),!!(e^n)}},CKEDITOR.dom.walker.invisible=function(e){var t=CKEDITOR.dom.walker.whitespaces(),n=CKEDITOR.env.webkit?1:0;return function(r){return t(r)?r=1:(r.type==CKEDITOR.NODE_TEXT&&(r=r.getParent()),r=r.$.offsetWidth<=n),!!(e^r)}},CKEDITOR.dom.walker.nodeType=function(e,t){return function(n){return!!(t^n.type==e)}},CKEDITOR.dom.walker.bogus=function(e){function t(e){return!s(e)&&!o(e)}return function(n){var r=CKEDITOR.env.needsBrFiller?n.is&&n.is("br"):n.getText&&i.test(n.getText());return r&&(r=n.getParent(),n=n.getNext(t),r=r.isBlockBoundary()&&(!n||n.type==CKEDITOR.NODE_ELEMENT&&n.isBlockBoundary())),!!(e^r)}},CKEDITOR.dom.walker.temp=function(e){return function(t){return t.type!=CKEDITOR.NODE_ELEMENT&&(t=t.getParent()),t=t&&t.hasAttribute("data-cke-temp"),!!(e^t)}};var i=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,s=CKEDITOR.dom.walker.whitespaces(),o=CKEDITOR.dom.walker.bookmark(),u=CKEDITOR.dom.walker.temp();CKEDITOR.dom.walker.ignored=function(e){return function(t){return t=s(t)||o(t)||u(t),!!(e^t)}};var a=CKEDITOR.dom.walker.ignored();CKEDITOR.dom.walker.empty=function(e){return function(t){for(var n=0,r=t.getChildCount();n<r;++n)if(!a(t.getChild(n)))return!!e;return!e}};var f=CKEDITOR.dom.walker.empty(),l=CKEDITOR.dom.walker.validEmptyBlockContainers=CKEDITOR.tools.extend(function(e){var t={},n;for(n in e)CKEDITOR.dtd[n]["#"]&&(t[n]=1);return t}(CKEDITOR.dtd.$block),{caption:1,td:1,th:1});CKEDITOR.dom.walker.editable=function(e){return function(t){return!!(e^(a(t)?0:t.type==CKEDITOR.NODE_TEXT||t.type==CKEDITOR.NODE_ELEMENT&&(t.is(CKEDITOR.dtd.$inline)||t.is("hr")||t.getAttribute("contenteditable")=="false"||!CKEDITOR.env.needsBrFiller&&t.is(l)&&f(t))?1:0))}},CKEDITOR.dom.element.prototype.getBogus=function(){var e=this;do e=e.getPreviousSourceNode();while(o(e)||s(e)||e.type==CKEDITOR.NODE_ELEMENT&&e.is(CKEDITOR.dtd.$inline)&&!e.is(CKEDITOR.dtd.$empty));return e&&(CKEDITOR.env.needsBrFiller?e.is&&e.is("br"):e.getText&&i.test(e.getText()))?e:!1}}(),CKEDITOR.dom.range=function(e){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null,this.collapsed=!0;var t=e instanceof CKEDITOR.dom.document;this.document=t?e:e.getDocument(),this.root=t?e.getBody():e},function(){function e(e){e.collapsed=e.startContainer&&e.endContainer&&e.startContainer.equals(e.endContainer)&&e.startOffset==e.endOffset}function t(e,t,n,r,i){function s(e,t,n,r){var s=n?e.getPrevious():e.getNext();return r&&a?s:(l||r?t.append(e.clone(!0,i),n):(e.remove(),f&&t.append(e)),s)}function o(){var e,t,n,r=Math.min(E.length,S.length);for(e=0;e<r;e++){t=E[e],n=S[e];if(!t.equals(n))return e}return e-1}function u(){var t=x-1,n=g&&y&&!c.equals(h);t<T-1||t<N-1||n?(n?e.moveToPosition(h,CKEDITOR.POSITION_BEFORE_START):N==t+1&&m?e.moveToPosition(S[t],CKEDITOR.POSITION_BEFORE_END):e.moveToPosition(S[t+1],CKEDITOR.POSITION_BEFORE_START),r&&(t=E[t+1])&&t.type==CKEDITOR.NODE_ELEMENT&&(n=CKEDITOR.dom.element.createFromHtml('<span data-cke-bookmark="1" style="display:none">&nbsp;</span>',e.document),n.insertAfter(t),t.mergeSiblings(!1),e.moveToBookmark({startNode:n}))):e.collapse(!0)}e.optimizeBookmark();var a=t===0,f=t==1,l=t==2,t=l||f,c=e.startContainer,h=e.endContainer,p=e.startOffset,d=e.endOffset,v,m,g,y,b,w;if(l&&h.type==CKEDITOR.NODE_TEXT&&c.equals(h))c=e.document.createText(c.substring(p,d)),n.append(c);else{h.type==CKEDITOR.NODE_TEXT?l?w=!0:h=h.split(d):h.getChildCount()>0?d>=h.getChildCount()?(h=h.getChild(d-1),m=!0):h=h.getChild(d):y=m=!0,c.type==CKEDITOR.NODE_TEXT?l?b=!0:c.split(p):c.getChildCount()>0?p===0?(c=c.getChild(p),v=!0):c=c.getChild(p-1):g=v=!0;for(var E=c.getParents(),S=h.getParents(),x=o(),T=E.length-1,N=S.length-1,C=n,k,L,A,O=-1,M=x;M<=T;M++){L=E[M],A=L.getNext();for(M==T&&!(L.equals(S[M])&&T<N)?v?s(L,C,!1,g):b&&C.append(e.document.createText(L.substring(p))):t&&(k=C.append(L.clone(0,i)));A;){if(A.equals(S[M])){O=M;break}A=s(A,C)}C=k}C=n;for(M=x;M<=N;M++){n=S[M],A=n.getPrevious();if(n.equals(E[M]))t&&(C=C.getChild(0));else{M==N&&!(n.equals(E[M])&&N<T)?m?s(n,C,!1,y):w&&C.append(e.document.createText(n.substring(0,d))):t&&(k=C.append(n.clone(0,i)));if(M>O)for(;A;)A=s(A,C,!0);C=k}}l||u()}}function n(){var e=!1,t=CKEDITOR.dom.walker.whitespaces(),n=CKEDITOR.dom.walker.bookmark(!0),r=CKEDITOR.dom.walker.bogus();return function(i){return n(i)||t(i)?!0:r(i)&&!e?e=!0:i.type==CKEDITOR.NODE_TEXT&&(i.hasAscendant("pre")||CKEDITOR.tools.trim(i.getText()).length)||i.type==CKEDITOR.NODE_ELEMENT&&!i.is(s)?!1:!0}}function r(e){var t=CKEDITOR.dom.walker.whitespaces(),n=CKEDITOR.dom.walker.bookmark(1);return function(r){return n(r)||t(r)?!0:!e&&o(r)||r.type==CKEDITOR.NODE_ELEMENT&&r.is(CKEDITOR.dtd.$removeEmpty)}}function i(e){return function(){var t;return this[e?"getPreviousNode":"getNextNode"](function(e){return!t&&f(e)&&(t=e),a(e)&&(!o(e)||!e.equals(t))})}}var s={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},o=CKEDITOR.dom.walker.bogus(),u=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,a=CKEDITOR.dom.walker.editable(),f=CKEDITOR.dom.walker.ignored(!0);CKEDITOR.dom.range.prototype={clone:function(){var e=new CKEDITOR.dom.range(this.root);return e._setStartContainer(this.startContainer),e.startOffset=this.startOffset,e._setEndContainer(this.endContainer),e.endOffset=this.endOffset,e.collapsed=this.collapsed,e},collapse:function(e){e?(this._setEndContainer(this.startContainer),this.endOffset=this.startOffset):(this._setStartContainer(this.endContainer),this.startOffset=this.endOffset),this.collapsed=!0},cloneContents:function(e){var n=new CKEDITOR.dom.documentFragment(this.document);return this.collapsed||t(this,2,n,!1,typeof e=="undefined"?!0:e),n},deleteContents:function(e){this.collapsed||t(this,0,null,e)},extractContents:function(e,n){var r=new CKEDITOR.dom.documentFragment(this.document);return this.collapsed||t(this,1,r,e,typeof n=="undefined"?!0:n),r},createBookmark:function(e){var t,n,r,i,s=this.collapsed;return t=this.document.createElement("span"),t.data("cke-bookmark",1),t.setStyle("display","none"),t.setHtml("&nbsp;"),e&&(r="cke_bm_"+CKEDITOR.tools.getNextNumber(),t.setAttribute("id",r+(s?"C":"S"))),s||(n=t.clone(),n.setHtml("&nbsp;"),e&&n.setAttribute("id",r+"E"),i=this.clone(),i.collapse(),i.insertNode(n)),i=this.clone(),i.collapse(!0),i.insertNode(t),n?(this.setStartAfter(t),this.setEndBefore(n)):this.moveToPosition(t,CKEDITOR.POSITION_AFTER_END),{startNode:e?r+(s?"C":"S"):t,endNode:e?r+"E":n,serializable:e,collapsed:s}},createBookmark2:function(){function e(e){var n=e.container,r=e.offset,i;i=n;var s=r;i=i.type!=CKEDITOR.NODE_ELEMENT||s===0||s==i.getChildCount()?0:i.getChild(s-1).type==CKEDITOR.NODE_TEXT&&i.getChild(s).type==CKEDITOR.NODE_TEXT,i&&(n=n.getChild(r-1),r=n.getLength()),n.type==CKEDITOR.NODE_ELEMENT&&r>1&&(r=n.getChild(r-1).getIndex(!0)+1);if(n.type==CKEDITOR.NODE_TEXT){i=n;for(s=0;(i=i.getPrevious())&&i.type==CKEDITOR.NODE_TEXT;)s+=i.getLength();i=s,n.getText()?r+=i:(s=n.getPrevious(t),i?(r=i,n=s?s.getNext():n.getParent().getFirst()):(n=n.getParent(),r=s?s.getIndex(!0)+1:0))}e.container=n,e.offset=r}var t=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_TEXT,!0);return function(t){var n=this.collapsed,r={container:this.startContainer,offset:this.startOffset},i={container:this.endContainer,offset:this.endOffset};return t&&(e(r),n||e(i)),{start:r.container.getAddress(t),end:n?null:i.container.getAddress(t),startOffset:r.offset,endOffset:i.offset,normalized:t,collapsed:n,is2:!0}}}(),moveToBookmark:function(e){if(e.is2){var t=this.document.getByAddress(e.start,e.normalized),n=e.startOffset,r=e.end&&this.document.getByAddress(e.end,e.normalized),e=e.endOffset;this.setStart(t,n),r?this.setEnd(r,e):this.collapse(!0)}else t=(n=e.serializable)?this.document.getById(e.startNode):e.startNode,e=n?this.document.getById(e.endNode):e.endNode,this.setStartBefore(t),t.remove(),e?(this.setEndBefore(e),e.remove()):this.collapse(!0)},getBoundaryNodes:function(){var e=this.startContainer,t=this.endContainer,n=this.startOffset,r=this.endOffset,i;if(e.type==CKEDITOR.NODE_ELEMENT){i=e.getChildCount();if(i>n)e=e.getChild(n);else if(i<1)e=e.getPreviousSourceNode();else{for(e=e.$;e.lastChild;)e=e.lastChild;e=new CKEDITOR.dom.node(e),e=e.getNextSourceNode()||e}}if(t.type==CKEDITOR.NODE_ELEMENT){i=t.getChildCount();if(i>r)t=t.getChild(r).getPreviousSourceNode(!0);else if(i<1)t=t.getPreviousSourceNode();else{for(t=t.$;t.lastChild;)t=t.lastChild;t=new CKEDITOR.dom.node(t)}}return e.getPosition(t)&CKEDITOR.POSITION_FOLLOWING&&(e=t),{startNode:e,endNode:t}},getCommonAncestor:function(e,t){var n=this.startContainer,r=this.endContainer,n=n.equals(r)?e&&n.type==CKEDITOR.NODE_ELEMENT&&this.startOffset==this.endOffset-1?n.getChild(this.startOffset):n:n.getCommonAncestor(r);return t&&!n.is?n.getParent():n},optimize:function(){var e=this.startContainer,t=this.startOffset;e.type!=CKEDITOR.NODE_ELEMENT&&(t?t>=e.getLength()&&this.setStartAfter(e):this.setStartBefore(e)),e=this.endContainer,t=this.endOffset,e.type!=CKEDITOR.NODE_ELEMENT&&(t?t>=e.getLength()&&this.setEndAfter(e):this.setEndBefore(e))},optimizeBookmark:function(){var e=this.startContainer,t=this.endContainer;e.is&&e.is("span")&&e.data("cke-bookmark")&&this.setStartAt(e,CKEDITOR.POSITION_BEFORE_START),t&&t.is&&t.is("span")&&t.data("cke-bookmark")&&this.setEndAt(t,CKEDITOR.POSITION_AFTER_END)},trim:function(e,t){var n=this.startContainer,r=this.startOffset,i=this.collapsed;if((!e||i)&&n&&n.type==CKEDITOR.NODE_TEXT){if(r)if(r>=n.getLength())r=n.getIndex()+1,n=n.getParent();else{var s=n.split(r),r=n.getIndex()+1,n=n.getParent();this.startContainer.equals(this.endContainer)?this.setEnd(s,this.endOffset-this.startOffset):n.equals(this.endContainer)&&(this.endOffset=this.endOffset+1)}else r=n.getIndex(),n=n.getParent();this.setStart(n,r);if(i){this.collapse(!0);return}}n=this.endContainer,r=this.endOffset,!t&&!i&&n&&n.type==CKEDITOR.NODE_TEXT&&(r?(r>=n.getLength()||n.split(r),r=n.getIndex()+1):r=n.getIndex(),n=n.getParent(),this.setEnd(n,r))},enlarge:function(e,t){function n(e){return e&&e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("contenteditable")?null:e}var r=RegExp(/[^\s\ufeff]/);switch(e){case CKEDITOR.ENLARGE_INLINE:var i=1;case CKEDITOR.ENLARGE_ELEMENT:if(this.collapsed)break;var s=this.getCommonAncestor(),o=this.root,u,a,f,l,c,h=!1,p,d;p=this.startContainer;var v=this.startOffset;p.type==CKEDITOR.NODE_TEXT?(v&&(p=!CKEDITOR.tools.trim(p.substring(0,v)).length&&p,h=!!p),p&&!(l=p.getPrevious())&&(f=p.getParent())):(v&&(l=p.getChild(v-1)||p.getLast()),l||(f=p));for(f=n(f);f||l;){if(f&&!l){!c&&f.equals(s)&&(c=!0);if(i?f.isBlockBoundary():!o.contains(f))break;if(!h||f.getComputedStyle("display")!="inline")h=!1,c?u=f:this.setStartBefore(f);l=f.getPrevious()}for(;l;){p=!1;if(l.type==CKEDITOR.NODE_COMMENT)l=l.getPrevious();else{if(l.type==CKEDITOR.NODE_TEXT)d=l.getText(),r.test(d)&&(l=null),p=/[\s\ufeff]$/.test(d);else if((l.$.offsetWidth>(CKEDITOR.env.webkit?1:0)||t&&l.is("br"))&&!l.data("cke-bookmark"))if(h&&CKEDITOR.dtd.$removeEmpty[l.getName()]){d=l.getText();if(r.test(d))l=null;else for(var v=l.$.getElementsByTagName("*"),m=0,g;g=v[m++];)if(!CKEDITOR.dtd.$removeEmpty[g.nodeName.toLowerCase()]){l=null;break}l&&(p=!!d.length)}else l=null;p&&(h?c?u=f:f&&this.setStartBefore(f):h=!0);if(l){p=l.getPrevious();if(!f&&!p){f=l,l=null;break}l=p}else f=null}}f&&(f=n(f.getParent()))}p=this.endContainer,v=this.endOffset,f=l=null,c=h=!1;var y=function(e,t){var n=new CKEDITOR.dom.range(o);n.setStart(e,t),n.setEndAt(o,CKEDITOR.POSITION_BEFORE_END);var n=new CKEDITOR.dom.walker(n),i;for(n.guard=function(e){return e.type!=CKEDITOR.NODE_ELEMENT||!e.isBlockBoundary()};i=n.next();){if(i.type!=CKEDITOR.NODE_TEXT)return!1;d=i!=e?i.getText():i.substring(t);if(r.test(d))return!1}return!0};p.type==CKEDITOR.NODE_TEXT?CKEDITOR.tools.trim(p.substring(v)).length?h=!0:(h=!p.getLength(),v==p.getLength()?(l=p.getNext())||(f=p.getParent()):y(p,v)&&(f=p.getParent())):(l=p.getChild(v))||(f=p);for(;f||l;){if(f&&!l){!c&&f.equals(s)&&(c=!0);if(i?f.isBlockBoundary():!o.contains(f))break;if(!h||f.getComputedStyle("display")!="inline")h=!1,c?a=f:f&&this.setEndAfter(f);l=f.getNext()}for(;l;){p=!1;if(l.type==CKEDITOR.NODE_TEXT)d=l.getText(),y(l,0)||(l=null),p=/^[\s\ufeff]/.test(d);else if(l.type==CKEDITOR.NODE_ELEMENT){if((l.$.offsetWidth>0||t&&l.is("br"))&&!l.data("cke-bookmark"))if(h&&CKEDITOR.dtd.$removeEmpty[l.getName()]){d=l.getText();if(r.test(d))l=null;else{v=l.$.getElementsByTagName("*");for(m=0;g=v[m++];)if(!CKEDITOR.dtd.$removeEmpty[g.nodeName.toLowerCase()]){l=null;break}}l&&(p=!!d.length)}else l=null}else p=1;p&&h&&(c?a=f:this.setEndAfter(f));if(l){p=l.getNext();if(!f&&!p){f=l,l=null;break}l=p}else f=null}f&&(f=n(f.getParent()))}u&&a&&(s=u.contains(a)?a:u,this.setStartBefore(s),this.setEndAfter(s));break;case CKEDITOR.ENLARGE_BLOCK_CONTENTS:case CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:f=new CKEDITOR.dom.range(this.root),o=this.root,f.setStartAt(o,CKEDITOR.POSITION_AFTER_START),f.setEnd(this.startContainer,this.startOffset),f=new CKEDITOR.dom.walker(f);var b,w,E=CKEDITOR.dom.walker.blockBoundary(e==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),S=null,x=function(e){if(e.type==CKEDITOR.NODE_ELEMENT&&e.getAttribute("contenteditable")=="false")if(S){if(S.equals(e)){S=null;return}}else S=e;else if(S)return;var t=E(e);return t||(b=e),t},i=function(e){var t=x(e);return!t&&e.is&&e.is("br")&&(w=e),t};f.guard=x,f=f.lastBackward(),b=b||o,this.setStartAt(b,!b.is("br")&&(!f&&this.checkStartOfBlock()||f&&b.contains(f))?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_AFTER_END);if(e==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS){f=this.clone(),f=new CKEDITOR.dom.walker(f);var T=CKEDITOR.dom.walker.whitespaces(),N=CKEDITOR.dom.walker.bookmark();f.evaluator=function(e){return!T(e)&&!N(e)};if((f=f.previous())&&f.type==CKEDITOR.NODE_ELEMENT&&f.is("br"))break}f=this.clone(),f.collapse(),f.setEndAt(o,CKEDITOR.POSITION_BEFORE_END),f=new CKEDITOR.dom.walker(f),f.guard=e==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?i:x,b=S=w=null,f=f.lastForward(),b=b||o,this.setEndAt(b,!f&&this.checkEndOfBlock()||f&&b.contains(f)?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_BEFORE_START),w&&this.setEndAfter(w)}},shrink:function(e,t,n){if(!this.collapsed){var e=e||CKEDITOR.SHRINK_TEXT,r=this.clone(),i=this.startContainer,s=this.endContainer,o=this.startOffset,u=this.endOffset,a=1,f=1;i&&i.type==CKEDITOR.NODE_TEXT&&(o?o>=i.getLength()?r.setStartAfter(i):(r.setStartBefore(i),a=0):r.setStartBefore(i)),s&&s.type==CKEDITOR.NODE_TEXT&&(u?u>=s.getLength()?r.setEndAfter(s):(r.setEndAfter(s),f=0):r.setEndBefore(s));var r=new CKEDITOR.dom.walker(r),l=CKEDITOR.dom.walker.bookmark();r.evaluator=function(t){return t.type==(e==CKEDITOR.SHRINK_ELEMENT?CKEDITOR.NODE_ELEMENT:CKEDITOR.NODE_TEXT)};var c;return r.guard=function(t,r){return l(t)?!0:e==CKEDITOR.SHRINK_ELEMENT&&t.type==CKEDITOR.NODE_TEXT||r&&t.equals(c)||n===!1&&t.type==CKEDITOR.NODE_ELEMENT&&t.isBlockBoundary()||t.type==CKEDITOR.NODE_ELEMENT&&t.hasAttribute("contenteditable")?!1:(!r&&t.type==CKEDITOR.NODE_ELEMENT&&(c=t),!0)},a&&(i=r[e==CKEDITOR.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(i,t?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_START),f&&(r.reset(),(r=r[e==CKEDITOR.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(r,t?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_END)),!!a||!!f}},insertNode:function(e){this.optimizeBookmark(),this.trim(!1,!0);var t=this.startContainer,n=t.getChild(this.startOffset);n?e.insertBefore(n):t.append(e),e.getParent()&&e.getParent().equals(this.endContainer)&&this.endOffset++,this.setStartBefore(e)},moveToPosition:function(e,t){this.setStartAt(e,t),this.collapse(!0)},moveToRange:function(e){this.setStart(e.startContainer,e.startOffset),this.setEnd(e.endContainer,e.endOffset)},selectNodeContents:function(e){this.setStart(e,0),this.setEnd(e,e.type==CKEDITOR.NODE_TEXT?e.getLength():e.getChildCount())},setStart:function(t,n){t.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[t.getName()]&&(n=t.getIndex(),t=t.getParent()),this._setStartContainer(t),this.startOffset=n,this.endContainer||(this._setEndContainer(t),this.endOffset=n),e(this)},setEnd:function(t,n){t.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[t.getName()]&&(n=t.getIndex()+1,t=t.getParent()),this._setEndContainer(t),this.endOffset=n,this.startContainer||(this._setStartContainer(t),this.startOffset=n),e(this)},setStartAfter:function(e){this.setStart(e.getParent(),e.getIndex()+1)},setStartBefore:function(e){this.setStart(e.getParent(),e.getIndex())},setEndAfter:function(e){this.setEnd(e.getParent(),e.getIndex()+1)},setEndBefore:function(e){this.setEnd(e.getParent(),e.getIndex())},setStartAt:function(t,n){switch(n){case CKEDITOR.POSITION_AFTER_START:this.setStart(t,0);break;case CKEDITOR.POSITION_BEFORE_END:t.type==CKEDITOR.NODE_TEXT?this.setStart(t,t.getLength()):this.setStart(t,t.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setStartBefore(t);break;case CKEDITOR.POSITION_AFTER_END:this.setStartAfter(t)}e(this)},setEndAt:function(t,n){switch(n){case CKEDITOR.POSITION_AFTER_START:this.setEnd(t,0);break;case CKEDITOR.POSITION_BEFORE_END:t.type==CKEDITOR.NODE_TEXT?this.setEnd(t,t.getLength()):this.setEnd(t,t.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setEndBefore(t);break;case CKEDITOR.POSITION_AFTER_END:this.setEndAfter(t)}e(this)},fixBlock:function(e,t){var n=this.createBookmark(),r=this.document.createElement(t);this.collapse(e),this.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS),this.extractContents().appendTo(r),r.trim(),this.insertNode(r);var i=r.getBogus();return i&&i.remove(),r.appendBogus(),this.moveToBookmark(n),r},splitBlock:function(e,t){var n=new CKEDITOR.dom.elementPath(this.startContainer,this.root),r=new CKEDITOR.dom.elementPath(this.endContainer,this.root),i=n.block,s=r.block,o=null;return n.blockLimit.equals(r.blockLimit)?(e!="br"&&(i||(i=this.fixBlock(!0,e),s=(new CKEDITOR.dom.elementPath(this.endContainer,this.root)).block),s||(s=this.fixBlock(!1,e))),n=i&&this.checkStartOfBlock(),r=s&&this.checkEndOfBlock(),this.deleteContents(),i&&i.equals(s)&&(r?(o=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(s,CKEDITOR.POSITION_AFTER_END),s=null):n?(o=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(i,CKEDITOR.POSITION_BEFORE_START),i=null):(s=this.splitElement(i,t||!1),i.is("ul","ol")||i.appendBogus())),{previousBlock:i,nextBlock:s,wasStartOfBlock:n,wasEndOfBlock:r,elementPath:o}):null},splitElement:function(e,t){if(!this.collapsed)return null;this.setEndAt(e,CKEDITOR.POSITION_BEFORE_END);var n=this.extractContents(!1,t||!1),r=e.clone(!1,t||!1);return n.appendTo(r),r.insertAfter(e),this.moveToPosition(e,CKEDITOR.POSITION_AFTER_END),r},removeEmptyBlocksAtEnd:function(){function e(e){return function(r){return t(r)||n(r)||r.type==CKEDITOR.NODE_ELEMENT&&r.isEmptyInlineRemoveable()||e.is("table")&&r.is("caption")?!1:!0}}var t=CKEDITOR.dom.walker.whitespaces(),n=CKEDITOR.dom.walker.bookmark(!1);return function(t){for(var n=this.createBookmark(),r=this[t?"endPath":"startPath"](),i=r.block||r.blockLimit,s;i&&!i.equals(r.root)&&!i.getFirst(e(i));)s=i.getParent(),this[t?"setEndAt":"setStartAt"](i,CKEDITOR.POSITION_AFTER_END),i.remove(1),i=s;this.moveToBookmark(n)}}(),startPath:function(){return new CKEDITOR.dom.elementPath(this.startContainer,this.root)},endPath:function(){return new CKEDITOR.dom.elementPath(this.endContainer,this.root)},checkBoundaryOfElement:function(e,t){var n=t==CKEDITOR.START,i=this.clone();return i.collapse(n),i[n?"setStartAt":"setEndAt"](e,n?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END),i=new CKEDITOR.dom.walker(i),i.evaluator=r(n),i[n?"checkBackward":"checkForward"]()},checkStartOfBlock:function(){var e=this.startContainer,t=this.startOffset;return CKEDITOR.env.ie&&t&&e.type==CKEDITOR.NODE_TEXT&&(e=CKEDITOR.tools.ltrim(e.substring(0,t)),u.test(e)&&this.trim(0,1)),this.trim(),e=new CKEDITOR.dom.elementPath(this.startContainer,this.root),t=this.clone(),t.collapse(!0),t.setStartAt(e.block||e.blockLimit,CKEDITOR.POSITION_AFTER_START),e=new CKEDITOR.dom.walker(t),e.evaluator=n(),e.checkBackward()},checkEndOfBlock:function(){var e=this.endContainer,t=this.endOffset;return CKEDITOR.env.ie&&e.type==CKEDITOR.NODE_TEXT&&(e=CKEDITOR.tools.rtrim(e.substring(t)),u.test(e)&&this.trim(1,0)),this.trim(),e=new CKEDITOR.dom.elementPath(this.endContainer,this.root),t=this.clone(),t.collapse(!1),t.setEndAt(e.block||e.blockLimit,CKEDITOR.POSITION_BEFORE_END),e=new CKEDITOR.dom.walker(t),e.evaluator=n(),e.checkForward()},getPreviousNode:function(e,t,n){var r=this.clone();return r.collapse(1),r.setStartAt(n||this.root,CKEDITOR.POSITION_AFTER_START),n=new CKEDITOR.dom.walker(r),n.evaluator=e,n.guard=t,n.previous()},getNextNode:function(e,t,n){var r=this.clone();return r.collapse(),r.setEndAt(n||this.root,CKEDITOR.POSITION_BEFORE_END),n=new CKEDITOR.dom.walker(r),n.evaluator=e,n.guard=t,n.next()},checkReadOnly:function(){function e(e,t){for(;e;){if(e.type==CKEDITOR.NODE_ELEMENT){if(e.getAttribute("contentEditable")=="false"&&!e.data("cke-editable"))return 0;if(e.is("html")||e.getAttribute("contentEditable")=="true"&&(e.contains(t)||e.equals(t)))break}e=e.getParent()}return 1}return function(){var t=this.startContainer,n=this.endContainer;return!e(t,n)||!e(n,t)}}(),moveToElementEditablePosition:function(e,t){if(e.type==CKEDITOR.NODE_ELEMENT&&!e.isEditable(!1))return this.moveToPosition(e,t?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),!0;for(var n=0;e;){if(e.type==CKEDITOR.NODE_TEXT){t&&this.endContainer&&this.checkEndOfBlock()&&u.test(e.getText())?this.moveToPosition(e,CKEDITOR.POSITION_BEFORE_START):this.moveToPosition(e,t?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),n=1;break}if(e.type==CKEDITOR.NODE_ELEMENT)if(e.isEditable())this.moveToPosition(e,t?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_START),n=1;else if(t&&e.is("br")&&this.endContainer&&this.checkEndOfBlock())this.moveToPosition(e,CKEDITOR.POSITION_BEFORE_START);else if(e.getAttribute("contenteditable")=="false"&&e.is(CKEDITOR.dtd.$block))return this.setStartBefore(e),this.setEndAfter(e),!0;var r=e,i=n,s=void 0;r.type==CKEDITOR.NODE_ELEMENT&&r.isEditable(!1)&&(s=r[t?"getLast":"getFirst"](f)),!i&&!s&&(s=r[t?"getPrevious":"getNext"](f)),e=s}return!!n},moveToClosestEditablePosition:function(e,t){var n,r=0,i,s,o=[CKEDITOR.POSITION_AFTER_END,CKEDITOR.POSITION_BEFORE_START];e?(n=new CKEDITOR.dom.range(this.root),n.moveToPosition(e,o[t?0:1])):n=this.clone();if(e&&!e.is(CKEDITOR.dtd.$block))r=1;else if(i=n[t?"getNextEditableNode":"getPreviousEditableNode"]())r=1,(s=i.type==CKEDITOR.NODE_ELEMENT)&&i.is(CKEDITOR.dtd.$block)&&i.getAttribute("contenteditable")=="false"?(n.setStartAt(i,CKEDITOR.POSITION_BEFORE_START),n.setEndAt(i,CKEDITOR.POSITION_AFTER_END)):!CKEDITOR.env.needsBrFiller&&s&&i.is(CKEDITOR.dom.walker.validEmptyBlockContainers)?(n.setEnd(i,0),n.collapse()):n.moveToPosition(i,o[t?1:0]);return r&&this.moveToRange(n),!!r},moveToElementEditStart:function(e){return this.moveToElementEditablePosition(e)},moveToElementEditEnd:function(e){return this.moveToElementEditablePosition(e,!0)},getEnclosedNode:function(){var e=this.clone();e.optimize();if(e.startContainer.type!=CKEDITOR.NODE_ELEMENT||e.endContainer.type!=CKEDITOR.NODE_ELEMENT)return null;var e=new CKEDITOR.dom.walker(e),t=CKEDITOR.dom.walker.bookmark(!1,!0),n=CKEDITOR.dom.walker.whitespaces(!0);e.evaluator=function(e){return n(e)&&t(e)};var r=e.next();return e.reset(),r&&r.equals(e.previous())?r:null},getTouchedStartNode:function(){var e=this.startContainer;return this.collapsed||e.type!=CKEDITOR.NODE_ELEMENT?e:e.getChild(this.startOffset)||e},getTouchedEndNode:function(){var e=this.endContainer;return this.collapsed||e.type!=CKEDITOR.NODE_ELEMENT?e:e.getChild(this.endOffset-1)||e},getNextEditableNode:i(),getPreviousEditableNode:i(1),scrollIntoView:function(){var e=new CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",this.document),t,n,r,i=this.clone();i.optimize(),(r=i.startContainer.type==CKEDITOR.NODE_TEXT)?(n=i.startContainer.getText(),t=i.startContainer.split(i.startOffset),e.insertAfter(i.startContainer)):i.insertNode(e),e.scrollIntoView(),r&&(i.startContainer.setText(n),t.remove()),e.remove()},_setStartContainer:function(e){this.startContainer=e},_setEndContainer:function(e){this.endContainer=e}}}(),CKEDITOR.POSITION_AFTER_START=1,CKEDITOR.POSITION_BEFORE_END=2,CKEDITOR.POSITION_BEFORE_START=3,CKEDITOR.POSITION_AFTER_END=4,CKEDITOR.ENLARGE_ELEMENT=1,CKEDITOR.ENLARGE_BLOCK_CONTENTS=2,CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS=3,CKEDITOR.ENLARGE_INLINE=4,CKEDITOR.START=1,CKEDITOR.END=2,CKEDITOR.SHRINK_ELEMENT=1,CKEDITOR.SHRINK_TEXT=2,"use strict",function(){function e(e){arguments.length<1||(this.range=e,this.forceBrBreak=0,this.enlargeBr=1,this.enforceRealBlocks=0,this._||(this._={}))}function t(e){var t=[];return e.forEach(function(e){if(e.getAttribute("contenteditable")=="true")return t.push(e),!1},CKEDITOR.NODE_ELEMENT,!0),t}function n(e,r,i,s){e:{s==null&&(s=t(i));for(var o;o=s.shift();)if(o.getDtd().p){s={element:o,remaining:s};break e}s=null}return s?(o=CKEDITOR.filter.instances[s.element.data("cke-filter")])&&!o.check(r)?n(e,r,i,s.remaining):(r=new CKEDITOR.dom.range(s.element),r.selectNodeContents(s.element),r=r.createIterator(),r.enlargeBr=e.enlargeBr,r.enforceRealBlocks=e.enforceRealBlocks,r.activeFilter=r.filter=o,e._.nestedEditable={element:s.element,container:i,remaining:s.remaining,iterator:r},1):0}function r(e,t,n){return t?(e=e.clone(),e.collapse(!n),e.checkBoundaryOfElement(t,n?CKEDITOR.START:CKEDITOR.END)):!1}var i=/^[\r\n\t ]+$/,s=CKEDITOR.dom.walker.bookmark(!1,!0),o=CKEDITOR.dom.walker.whitespaces(!0),u=function(e){return s(e)&&o(e)},a={dd:1,dt:1,li:1};e.prototype={getNextParagraph:function(e){var t,o,l,h,p,e=e||"p";if(this._.nestedEditable){if(t=this._.nestedEditable.iterator.getNextParagraph(e))return this.activeFilter=this._.nestedEditable.iterator.activeFilter,t;this.activeFilter=this.filter;if(n(this,e,this._.nestedEditable.container,this._.nestedEditable.remaining))return this.activeFilter=this._.nestedEditable.iterator.activeFilter,this._.nestedEditable.iterator.getNextParagraph(e);this._.nestedEditable=null}if(!this.range.root.getDtd()[e])return null;if(!this._.started){var d=this.range.clone();o=d.startPath();var v=d.endPath(),m=!d.collapsed&&r(d,o.block),g=!d.collapsed&&r(d,v.block,1);d.shrink(CKEDITOR.SHRINK_ELEMENT,!0),m&&d.setStartAt(o.block,CKEDITOR.POSITION_BEFORE_END),g&&d.setEndAt(v.block,CKEDITOR.POSITION_AFTER_START),o=d.endContainer.hasAscendant("pre",!0)||d.startContainer.hasAscendant("pre",!0),d.enlarge(this.forceBrBreak&&!o||!this.enlargeBr?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS);if(!d.collapsed){o=new CKEDITOR.dom.walker(d.clone()),v=CKEDITOR.dom.walker.bookmark(!0,!0),o.evaluator=v,this._.nextNode=o.next(),o=new CKEDITOR.dom.walker(d.clone()),o.evaluator=v,o=o.previous(),this._.lastNode=o.getNextSourceNode(!0,null,d.root),this._.lastNode&&this._.lastNode.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(this._.lastNode.getText())&&this._.lastNode.getParent().isBlockBoundary()&&(v=this.range.clone(),v.moveToPosition(this._.lastNode,CKEDITOR.POSITION_AFTER_END),v.checkEndOfBlock()&&(v=new CKEDITOR.dom.elementPath(v.endContainer,v.root),this._.lastNode=(v.block||v.blockLimit).getNextSourceNode(!0)));if(!this._.lastNode||!d.root.contains(this._.lastNode))this._.lastNode=this._.docEndMarker=d.document.createText(""),this._.lastNode.insertAfter(o);d=null}this._.started=1,o=d}v=this._.nextNode,d=this._.lastNode;for(this._.nextNode=null;v;){var m=0,g=v.hasAscendant("pre"),y=v.type!=CKEDITOR.NODE_ELEMENT,w=0;if(y)v.type==CKEDITOR.NODE_TEXT&&i.test(v.getText())&&(y=0);else{var E=v.getName();if(CKEDITOR.dtd.$block[E]&&v.getAttribute("contenteditable")=="false"){t=v,n(this,e,t);break}if(v.isBlockBoundary(this.forceBrBreak&&!g&&{br:1})){if(E=="br")y=1;else if(!o&&!v.getChildCount()&&E!="hr"){t=v,l=v.equals(d);break}o&&(o.setEndAt(v,CKEDITOR.POSITION_BEFORE_START),E!="br"&&(this._.nextNode=v)),m=1}else{if(v.getFirst()){o||(o=this.range.clone(),o.setStartAt(v,CKEDITOR.POSITION_BEFORE_START)),v=v.getFirst();continue}y=1}}y&&!o&&(o=this.range.clone(),o.setStartAt(v,CKEDITOR.POSITION_BEFORE_START)),l=(!m||y)&&v.equals(d);if(o&&!m)for(;!v.getNext(u)&&!l;){E=v.getParent();if(E.isBlockBoundary(this.forceBrBreak&&!g&&{br:1})){m=1,y=0,l||E.equals(d),o.setEndAt(E,CKEDITOR.POSITION_BEFORE_END);break}v=E,y=1,l=v.equals(d),w=1}y&&o.setEndAt(v,CKEDITOR.POSITION_AFTER_END),v=this._getNextSourceNode(v,w,d);if((l=!v)||m&&o)break}if(!t){if(!o)return this._.docEndMarker&&this._.docEndMarker.remove(),this._.nextNode=null;t=new CKEDITOR.dom.elementPath(o.startContainer,o.root),v=t.blockLimit,m={div:1,th:1,td:1},t=t.block;if(!t&&v&&!this.enforceRealBlocks&&m[v.getName()]&&o.checkStartOfBlock()&&o.checkEndOfBlock()&&!v.equals(o.root))t=v;else if(!t||this.enforceRealBlocks&&t.is(a))t=this.range.document.createElement(e),o.extractContents().appendTo(t),t.trim(),o.insertNode(t),h=p=!0;else if(t.getName()!="li"){if(!o.checkStartOfBlock()||!o.checkEndOfBlock())t=t.clone(!1),o.extractContents().appendTo(t),t.trim(),p=o.splitBlock(),h=!p.wasStartOfBlock,p=!p.wasEndOfBlock,o.insertNode(t)}else l||(this._.nextNode=t.equals(d)?null:this._getNextSourceNode(o.getBoundaryNodes().endNode,1,d))}return h&&(h=t.getPrevious())&&h.type==CKEDITOR.NODE_ELEMENT&&(h.getName()=="br"?h.remove():h.getLast()&&h.getLast().$.nodeName.toLowerCase()=="br"&&h.getLast().remove()),p&&(h=t.getLast())&&h.type==CKEDITOR.NODE_ELEMENT&&h.getName()=="br"&&(!CKEDITOR.env.needsBrFiller||h.getPrevious(s)||h.getNext(s))&&h.remove(),this._.nextNode||(this._.nextNode=l||t.equals(d)||!d?null:this._getNextSourceNode(t,1,d)),t},_getNextSourceNode:function(e,t,n){function r(e){return!e.equals(n)&&!e.equals(i)}for(var i=this.range.root,e=e.getNextSourceNode(t,null,r);!s(e);)e=e.getNextSourceNode(t,null,r);return e}},CKEDITOR.dom.range.prototype.createIterator=function(){return new e(this)}}(),CKEDITOR.command=function(e,t){this.uiItems=[],this.exec=function(n){return this.state==CKEDITOR.TRISTATE_DISABLED||!this.checkAllowed()?!1:(this.editorFocus&&e.focus(),this.fire("exec")===!1?!0:t.exec.call(this,e,n)!==!1)},this.refresh=function(e,n){return!this.readOnly&&e.readOnly?!0:this.context&&!n.isContextFor(this.context)?(this.disable(),!0):this.checkAllowed(!0)?(this.startDisabled||this.enable(),this.modes&&!this.modes[e.mode]&&this.disable(),this.fire("refresh",{editor:e,path:n})===!1?!0:t.refresh&&t.refresh.apply(this,arguments)!==!1):(this.disable(),!0)};var n;this.checkAllowed=function(t){return!t&&typeof n=="boolean"?n:n=e.activeFilter.checkFeature(this)},CKEDITOR.tools.extend(this,t,{modes:{wysiwyg:1},editorFocus:1,contextSensitive:!!t.context,state:CKEDITOR.TRISTATE_DISABLED}),CKEDITOR.event.call(this)},CKEDITOR.command.prototype={enable:function(){this.state==CKEDITOR.TRISTATE_DISABLED&&this.checkAllowed()&&this.setState(!this.preserveState||typeof this.previousState=="undefined"?CKEDITOR.TRISTATE_OFF:this.previousState)},disable:function(){this.setState(CKEDITOR.TRISTATE_DISABLED)},setState:function(e){return this.state==e||e!=CKEDITOR.TRISTATE_DISABLED&&!this.checkAllowed()?!1:(this.previousState=this.state,this.state=e,this.fire("state"),!0)},toggleState:function(){this.state==CKEDITOR.TRISTATE_OFF?this.setState(CKEDITOR.TRISTATE_ON):this.state==CKEDITOR.TRISTATE_ON&&this.setState(CKEDITOR.TRISTATE_OFF)}},CKEDITOR.event.implementOn(CKEDITOR.command.prototype),CKEDITOR.ENTER_P=1,CKEDITOR.ENTER_BR=2,CKEDITOR.ENTER_DIV=3,CKEDITOR.config={customConfig:"config.js",autoUpdateElement:!0,language:"",defaultLanguage:"en",contentsLangDirection:"",enterMode:CKEDITOR.ENTER_P,forceEnterMode:!1,shiftEnterMode:CKEDITOR.ENTER_BR,docType:"<!DOCTYPE html>",bodyId:"",bodyClass:"",fullPage:!1,height:200,extraPlugins:"",removePlugins:"",protectedSource:[],tabIndex:0,width:"",baseFloatZIndex:1e4,blockedKeystrokes:[CKEDITOR.CTRL+66,CKEDITOR.CTRL+73,CKEDITOR.CTRL+85]},function(){function e(e,t,n,r,i){var s,u,e=[];for(s in t){u=t[s],u=typeof u=="boolean"?{}:typeof u=="function"?{match:u}:L(u),s.charAt(0)!="$"&&(u.elements=s),n&&(u.featureName=n.toLowerCase());var a=u;a.elements=o(a.elements,/\s+/)||null,a.propertiesOnly=a.propertiesOnly||a.elements===!0;var f=/\s*,\s*/,l=void 0;for(l in _){a[l]=o(a[l],f)||null;var c=a,h=D[l],p=o(a[D[l]],f),d=a[l],v=[],m=!0,y=void 0;p?m=!1:p={};for(y in d)y.charAt(0)=="!"&&(y=y.slice(1),v.push(y),p[y]=!0,m=!1);for(;y=v.pop();)d[y]=d["!"+y],delete d["!"+y];c[h]=(m?!1:p)||null}a.match=a.match||null,r.push(u),e.push(u)}for(var t=i.elements,i=i.generic,b,n=0,r=e.length;n<r;++n){s=L(e[n]),u=s.classes===!0||s.styles===!0||s.attributes===!0,a=s,l=h=f=void 0;for(f in _)a[f]=g(a[f]);c=!0;for(l in D){f=D[l],h=a[f],p=[],d=void 0;for(d in h)d.indexOf("*")>-1?p.push(RegExp("^"+d.replace(/\*/g,".*")+"$")):p.push(d);h=p,h.length&&(a[f]=h,c=!1)}a.nothingRequired=c,a.noProperties=!(a.attributes||a.classes||a.styles);if(s.elements===!0||s.elements===null)i[u?"unshift":"push"](s);else{a=s.elements,delete s.elements;for(b in a)t[b]?t[b][u?"unshift":"push"](s):t[b]=[s]}}}function t(e,t,r,i){if(!e.match||e.match(t))if(i||u(e,t)){e.propertiesOnly||(r.valid=!0),r.allAttributes||(r.allAttributes=n(e.attributes,t.attributes,r.validAttributes)),r.allStyles||(r.allStyles=n(e.styles,t.styles,r.validStyles));if(!r.allClasses){e=e.classes,t=t.classes,i=r.validClasses;if(e)if(e===!0)e=!0;else{for(var s=0,o=t.length,a;s<o;++s)a=t[s],i[a]||(i[a]=e(a));e=!1}else e=!1;r.allClasses=e}}}function n(e,t,n){if(!e)return!1;if(e===!0)return!0;for(var r in t)n[r]||(n[r]=e(r));return!1}function r(e,t,n){if(!e.match||e.match(t)){if(e.noProperties)return!1;n.hadInvalidAttribute=i(e.attributes,t.attributes)||n.hadInvalidAttribute,n.hadInvalidStyle=i(e.styles,t.styles)||n.hadInvalidStyle,e=e.classes,t=t.classes;if(e){for(var r=!1,s=e===!0,o=t.length;o--;)if(s||e(t[o]))t.splice(o,1),r=!0;e=r}else e=!1;n.hadInvalidClass=e||n.hadInvalidClass}}function i(e,t){if(!e)return!1;var n=!1,r=e===!0,i;for(i in t)if(r||e(i))delete t[i],n=!0;return n}function s(e,t,n){return e.disabled||e.customConfig&&!n||!t?!1:(e._.cachedChecks={},!0)}function o(e,t){if(!e)return!1;if(e===!0)return e;if(typeof e=="string")return e=A(e),e=="*"?!0:CKEDITOR.tools.convertArrayToObject(e.split(t));if(CKEDITOR.tools.isArray(e))return e.length?CKEDITOR.tools.convertArrayToObject(e):!1;var n={},r=0,i;for(i in e)n[i]=e[i],r++;return r?n:!1}function u(e,t){if(e.nothingRequired)return!0;var n,r,i,s;if(i=e.requiredClasses){s=t.classes;for(n=0;n<i.length;++n){r=i[n];if(typeof r=="string"){if(CKEDITOR.tools.indexOf(s,r)==-1)return!1}else if(!CKEDITOR.tools.checkIfAnyArrayItemMatches(s,r))return!1}}return a(t.styles,e.requiredStyles)&&a(t.attributes,e.requiredAttributes)}function a(e,t){if(!t)return!0;for(var n=0,r;n<t.length;++n){r=t[n];if(typeof r=="string"){if(!(r in e))return!1}else if(!CKEDITOR.tools.checkIfAnyObjectPropertyMatches(e,r))return!1}return!0}function f(e){if(!e)return{};for(var e=e.split(/\s*,\s*/).sort(),t={};e.length;)t[e.shift()]=O;return t}function l(e){for(var t,n,r,i,s={},o=1,e=A(e);t=e.match(P);)(n=t[2])?(r=c(n,"styles"),i=c(n,"attrs"),n=c(n,"classes")):r=i=n=null,s["$"+o++]={elements:t[1],classes:n,styles:r,attributes:i},e=e.slice(t[0].length);return s}function c(e,t){var n=e.match(H[t]);return n?A(n[1]):null}function h(e){var t=e.styleBackup=e.attributes.style,n=e.classBackup=e.attributes["class"];e.styles||(e.styles=CKEDITOR.tools.parseCssText(t||"",1)),e.classes||(e.classes=n?n.split(/\s+/):[])}function p(e,n,i,s){var o=0,u;s.toHtml&&(n.name=n.name.replace(B,"$1"));if(s.doCallbacks&&e.elementCallbacks){e:for(var a=e.elementCallbacks,f=0,l=a.length,c;f<l;++f)if(c=a[f](n)){u=c;break e}if(u)return u}if(s.doTransform)if(u=e._.transformations[n.name]){h(n);for(a=0;a<u.length;++a)E(e,n,u[a]);v(n)}if(s.doFilter){e:{a=n.name,f=e._,e=f.allowedRules.elements[a],u=f.allowedRules.generic,a=f.disallowedRules.elements[a],f=f.disallowedRules.generic,l=s.skipRequired,c={valid:!1,validAttributes:{},validClasses:{},validStyles:{},allAttributes:!1,allClasses:!1,allStyles:!1,hadInvalidAttribute:!1,hadInvalidClass:!1,hadInvalidStyle:!1};var p,d;if(!e&&!u)e=null;else{h(n);if(a){p=0;for(d=a.length;p<d;++p)if(r(a[p],n,c)===!1){e=null;break e}}if(f){p=0;for(d=f.length;p<d;++p)r(f[p],n,c)}if(e){p=0;for(d=e.length;p<d;++p)t(e[p],n,c,l)}if(u){p=0;for(d=u.length;p<d;++p)t(u[p],n,c,l)}e=c}}if(!e)return i.push(n),k;if(!e.valid)return i.push(n),k;d=e.validAttributes;var g=e.validStyles;u=e.validClasses;var a=n.attributes,y=n.styles,f=n.classes,l=n.classBackup,b=n.styleBackup,w,S,x=[];c=[];var T=/^data-cke-/;p=!1,delete a.style,delete a["class"],delete n.classBackup,delete n.styleBackup;if(!e.allAttributes)for(w in a)d[w]||(T.test(w)?w!=(S=w.replace(/^data-cke-saved-/,""))&&!d[S]&&(delete a[w],p=!0):(delete a[w],p=!0));if(!e.allStyles||e.hadInvalidStyle){for(w in y)e.allStyles||g[w]?x.push(w+":"+y[w]):p=!0;x.length&&(a.style=x.sort().join("; "))}else b&&(a.style=b);if(!e.allClasses||e.hadInvalidClass){for(w=0;w<f.length;++w)(e.allClasses||u[f[w]])&&c.push(f[w]);c.length&&(a["class"]=c.sort().join(" ")),l&&c.length<l.split(/\s+/).length&&(p=!0)}else l&&(a["class"]=l);p&&(o=k);if(!s.skipFinalValidation&&!m(n))return i.push(n),k}return s.toHtml&&(n.name=n.name.replace(j,"cke:$1")),o}function d(e){var t=[],n;for(n in e)n.indexOf("*")>-1&&t.push(n.replace(/\*/g,".*"));return t.length?RegExp("^(?:"+t.join("|")+")$"):null}function v(e){var t=e.attributes,n;delete t.style,delete t["class"];if(n=CKEDITOR.tools.writeCssText(e.styles,!0))t.style=n;e.classes.length&&(t["class"]=e.classes.sort().join(" "))}function m(e){switch(e.name){case"a":if(!e.children.length&&!e.attributes.name)return!1;break;case"img":if(!e.attributes.src)return!1}return!0}function g(e){if(!e)return!1;if(e===!0)return!0;var t=d(e);return function(n){return n in e||t&&n.match(t)}}function y(){return new CKEDITOR.htmlParser.element("br")}function b(e){return e.type==CKEDITOR.NODE_ELEMENT&&(e.name=="br"||C.$block[e.name])}function w(e,t,n){var r=e.name;if(C.$empty[r]||!e.children.length)r=="hr"&&t=="br"?e.replaceWith(y()):(e.parent&&n.push({check:"it",el:e.parent}),e.remove());else if(C.$block[r]||r=="tr")if(t=="br")e.previous&&!b(e.previous)&&(t=y(),t.insertBefore(e)),e.next&&!b(e.next)&&(t=y(),t.insertAfter(e)),e.replaceWithChildren();else{var r=e.children,i;e:{i=C[t];for(var s=0,o=r.length,u;s<o;++s){u=r[s];if(u.type==CKEDITOR.NODE_ELEMENT&&!i[u.name]){i=!1;break e}}i=!0}if(i)e.name=t,e.attributes={},n.push({check:"parent-down",el:e});else{i=e.parent;for(var s=i.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||i.name=="body",a,f,o=r.length;o>0;)u=r[--o],s&&(u.type==CKEDITOR.NODE_TEXT||u.type==CKEDITOR.NODE_ELEMENT&&C.$inline[u.name])?(a||(a=new CKEDITOR.htmlParser.element(t),a.insertAfter(e),n.push({check:"parent-down",el:a})),a.add(u,0)):(a=null,f=C[i.name]||C.span,u.insertAfter(e),i.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&u.type==CKEDITOR.NODE_ELEMENT&&!f[u.name]&&n.push({check:"el-up",el:u}));e.remove()}}else r in{style:1,script:1}?e.remove():(e.parent&&n.push({check:"it",el:e.parent}),e.replaceWithChildren())}function E(e,t,n){var r,i;for(r=0;r<n.length;++r){i=n[r];if((!i.check||e.check(i.check,!1))&&(!i.left||i.left(t))){i.right(t,F);break}}}function S(e,t){var n=t.getDefinition(),r=n.attributes,i=n.styles,s,o,u,a;if(e.name!=n.element)return!1;for(s in r)if(s=="class"){n=r[s].split(/\s+/);for(u=e.classes.join("|");a=n.pop();)if(u.indexOf(a)==-1)return!1}else if(e.attributes[s]!=r[s])return!1;for(o in i)if(e.styles[o]!=i[o])return!1;return!0}function x(e,t){var n,r;return typeof e=="string"?n=e:e instanceof CKEDITOR.style?r=e:(n=e[0],r=e[1]),[{element:n,left:r,right:function(e,n){n.transform(e,t)}}]}function T(e){return function(t){return S(t,e)}}function N(e){return function(t,n){n[e](t)}}var C=CKEDITOR.dtd,k=1,L=CKEDITOR.tools.copy,A=CKEDITOR.tools.trim,O="cke-test",M=["","p","br","div"];CKEDITOR.FILTER_SKIP_TREE=2,CKEDITOR.filter=function(e){this.allowedContent=[],this.disallowedContent=[],this.elementCallbacks=null,this.disabled=!1,this.editor=null,this.id=CKEDITOR.tools.getNextNumber(),this._={allowedRules:{elements:{},generic:[]},disallowedRules:{elements:{},generic:[]},transformations:{},cachedTests:{}},CKEDITOR.filter.instances[this.id]=this;if(e instanceof CKEDITOR.editor){e=this.editor=e,this.customConfig=!0;var t=e.config.allowedContent;t===!0?this.disabled=!0:(t||(this.customConfig=!1),this.allow(t,"config",1),this.allow(e.config.extraAllowedContent,"extra",1),this.allow(M[e.enterMode]+" "+M[e.shiftEnterMode],"default",1),this.disallow(e.config.disallowedContent))}else this.customConfig=!1,this.allow(e,"default",1)},CKEDITOR.filter.instances={},CKEDITOR.filter.prototype={allow:function(t,n,r){if(!s(this,t,r))return!1;var i,o;if(typeof t=="string")t=l(t);else if(t instanceof CKEDITOR.style){if(t.toAllowedContentRules)return this.allow(t.toAllowedContentRules(this.editor),n,r);i=t.getDefinition(),t={},r=i.attributes,t[i.element]=i={styles:i.styles,requiredStyles:i.styles&&CKEDITOR.tools.objectKeys(i.styles)},r&&(r=L(r),i.classes=r["class"]?r["class"].split(/\s+/):null,i.requiredClasses=i.classes,delete r["class"],i.attributes=r,i.requiredAttributes=r&&CKEDITOR.tools.objectKeys(r))}else if(CKEDITOR.tools.isArray(t)){for(i=0;i<t.length;++i)o=this.allow(t[i],n,r);return o}return e(this,t,n,this.allowedContent,this._.allowedRules),!0},applyTo:function(e,t,n,r){if(this.disabled)return!1;var i=this,s=[],o=this.editor&&this.editor.config.protectedSource,u,a=!1,f={doFilter:!n,doTransform:!0,doCallbacks:!0,toHtml:t};e.forEach(function(e){if(e.type==CKEDITOR.NODE_ELEMENT){if(e.attributes["data-cke-filter"]=="off")return!1;if(!t||e.name!="span"||!~CKEDITOR.tools.objectKeys(e.attributes).join("|").indexOf("data-cke-")){u=p(i,e,s,f);if(u&k)a=!0;else if(u&2)return!1}}else if(e.type==CKEDITOR.NODE_COMMENT&&e.value.match(/^\{cke_protected\}(?!\{C\})/)){var n;e:{var r=decodeURIComponent(e.value.replace(/^\{cke_protected\}/,""));n=[];var l,c,h;if(o)for(c=0;c<o.length;++c)if((h=r.match(o[c]))&&h[0].length==r.length){n=!0;break e}r=CKEDITOR.htmlParser.fragment.fromHtml(r),r.children.length==1&&(l=r.children[0]).type==CKEDITOR.NODE_ELEMENT&&p(i,l,n,f),n=!n.length}n||s.push(e)}},null,!0),s.length&&(a=!0);for(var l,e=[],r=M[r||(this.editor?this.editor.enterMode:CKEDITOR.ENTER_P)],c;n=s.pop();)n.type==CKEDITOR.NODE_ELEMENT?w(n,r,e):n.remove();for(;l=e.pop();){n=l.el;if(n.parent){c=C[n.parent.name]||C.span;switch(l.check){case"it":C.$removeEmpty[n.name]&&!n.children.length?w(n,r,e):m(n)||w(n,r,e);break;case"el-up":n.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&!c[n.name]&&w(n,r,e);break;case"parent-down":n.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&!c[n.name]&&w(n.parent,r,e)}}}return a},checkFeature:function(e){return this.disabled||!e?!0:(e.toFeature&&(e=e.toFeature(this.editor)),!e.requiredContent||this.check(e.requiredContent))},disable:function(){this.disabled=!0},disallow:function(t){return s(this,t,!0)?(typeof t=="string"&&(t=l(t)),e(this,t,null,this.disallowedContent,this._.disallowedRules),!0):!1},addContentForms:function(e){if(!this.disabled&&e){var t,n,r=[],i;for(t=0;t<e.length&&!i;++t)n=e[t],(typeof n=="string"||n instanceof CKEDITOR.style)&&this.check(n)&&(i=n);if(i){for(t=0;t<e.length;++t)r.push(x(e[t],i));this.addTransformations(r)}}},addElementCallback:function(e){this.elementCallbacks||(this.elementCallbacks=[]),this.elementCallbacks.push(e)},addFeature:function(e){return this.disabled||!e?!0:(e.toFeature&&(e=e.toFeature(this.editor)),this.allow(e.allowedContent,e.name),this.addTransformations(e.contentTransformations),this.addContentForms(e.contentForms),e.requiredContent&&(this.customConfig||this.disallowedContent.length)?this.check(e.requiredContent):!0)},addTransformations:function(e){var t,n;if(!this.disabled&&e){var r=this._.transformations,i;for(i=0;i<e.length;++i){t=e[i];var s=void 0,o=void 0,u=void 0,a=void 0,f=void 0,l=void 0;n=[];for(o=0;o<t.length;++o)u=t[o],typeof u=="string"?(u=u.split(/\s*:\s*/),a=u[0],f=null,l=u[1]):(a=u.check,f=u.left,l=u.right),s||(s=u,s=s.element?s.element:a?a.match(/^([a-z0-9]+)/i)[0]:s.left.getDefinition().element),f instanceof CKEDITOR.style&&(f=T(f)),n.push({check:a==s?null:a,left:f,right:typeof l=="string"?N(l):l});t=s,r[t]||(r[t]=[]),r[t].push(n)}}},check:function(e,t,n){if(this.disabled)return!0;if(CKEDITOR.tools.isArray(e)){for(var r=e.length;r--;)if(this.check(e[r],t,n))return!0;return!1}var i,s;if(typeof e=="string"){s=e+"<"+(t===!1?"0":"1")+(n?"1":"0")+">";if(s in this._.cachedChecks)return this._.cachedChecks[s];r=l(e).$1,i=r.styles;var o=r.classes;r.name=r.elements,r.classes=o=o?o.split(/\s*,\s*/):[],r.styles=f(i),r.attributes=f(r.attributes),r.children=[],o.length&&(r.attributes["class"]=o.join(" ")),i&&(r.attributes.style=CKEDITOR.tools.writeCssText(r.styles)),i=r}else r=e.getDefinition(),i=r.styles,o=r.attributes||{},i?(i=L(i),o.style=CKEDITOR.tools.writeCssText(i,!0)):i={},i={name:r.element,attributes:o,classes:o["class"]?o["class"].split(/\s+/):[],styles:i,children:[]};var o=CKEDITOR.tools.clone(i),u=[],a;if(t!==!1&&(a=this._.transformations[i.name])){for(r=0;r<a.length;++r)E(this,i,a[r]);v(i)}return p(this,o,u,{doFilter:!0,doTransform:t!==!1,skipRequired:!n,skipFinalValidation:!n}),t=u.length>0?!1:CKEDITOR.tools.objectCompare(i.attributes,o.attributes,!0)?!0:!1,typeof e=="string"&&(this._.cachedChecks[s]=t),t},getAllowedEnterMode:function(){var e=["p","div","br"],t={p:CKEDITOR.ENTER_P,div:CKEDITOR.ENTER_DIV,br:CKEDITOR.ENTER_BR};return function(n,r){var i=e.slice(),s;if(this.check(M[n]))return n;for(r||(i=i.reverse());s=i.pop();)if(this.check(s))return t[s];return CKEDITOR.ENTER_BR}}(),destroy:function(){delete CKEDITOR.filter.instances[this.id],delete this._,delete this.allowedContent,delete this.disallowedContent}};var _={styles:1,attributes:1,classes:1},D={styles:"requiredStyles",attributes:"requiredAttributes",classes:"requiredClasses"},P=/^([a-z0-9\-*\s]+)((?:\s*\{[!\w\-,\s\*]+\}\s*|\s*\[[!\w\-,\s\*]+\]\s*|\s*\([!\w\-,\s\*]+\)\s*){0,3})(?:;\s*|$)/i,H={styles:/{([^}]+)}/,attrs:/\[([^\]]+)\]/,classes:/\(([^\)]+)\)/},B=/^cke:(object|embed|param)$/,j=/^(object|embed|param)$/,F=CKEDITOR.filter.transformationsTools={sizeToStyle:function(e){this.lengthToStyle(e,"width"),this.lengthToStyle(e,"height")},sizeToAttribute:function(e){this.lengthToAttribute(e,"width"),this.lengthToAttribute(e,"height")},lengthToStyle:function(e,t,n){n=n||t;if(!(n in e.styles)){var r=e.attributes[t];r&&(/^\d+$/.test(r)&&(r+="px"),e.styles[n]=r)}delete e.attributes[t]},lengthToAttribute:function(e,t,n){n=n||t;if(!(n in e.attributes)){var r=e.styles[t],i=r&&r.match(/^(\d+)(?:\.\d*)?px$/);i?e.attributes[n]=i[1]:r==O&&(e.attributes[n]=O)}delete e.styles[t]},alignmentToStyle:function(e){if(!("float"in e.styles)){var t=e.attributes.align;if(t=="left"||t=="right")e.styles["float"]=t}delete e.attributes.align},alignmentToAttribute:function(e){if(!("align"in e.attributes)){var t=e.styles["float"];if(t=="left"||t=="right")e.attributes.align=t}delete e.styles["float"]},matchesStyle:S,transform:function(e,t){if(typeof t=="string")e.name=t;else{var n=t.getDefinition(),r=n.styles,i=n.attributes,s,o,u,a;e.name=n.element;for(s in i)if(s=="class"){n=e.classes.join("|");for(u=i[s].split(/\s+/);a=u.pop();)n.indexOf(a)==-1&&e.classes.push(a)}else e.attributes[s]=i[s];for(o in r)e.styles[o]=r[o]}}}}(),function(){CKEDITOR.focusManager=function(e){return e.focusManager?e.focusManager:(this.hasFocus=!1,this.currentActive=null,this._={editor:e},this)},CKEDITOR.focusManager._={blurDelay:200},CKEDITOR.focusManager.prototype={focus:function(e){this._.timer&&clearTimeout(this._.timer),e&&(this.currentActive=e),!this.hasFocus&&!this._.locked&&((e=CKEDITOR.currentInstance)&&e.focusManager.blur(1),this.hasFocus=!0,(e=this._.editor.container)&&e.addClass("cke_focus"),this._.editor.fire("focus"))},lock:function(){this._.locked=1},unlock:function(){delete this._.locked},blur:function(e){function t(){if(this.hasFocus){this.hasFocus=!1;var e=this._.editor.container;e&&e.removeClass("cke_focus"),this._.editor.fire("blur")}}if(!this._.locked){this._.timer&&clearTimeout(this._.timer);var n=CKEDITOR.focusManager._.blurDelay;e||!n?t.call(this):this._.timer=CKEDITOR.tools.setTimeout(function(){delete this._.timer,t.call(this)},n,this)}},add:function(e,t){var n=e.getCustomData("focusmanager");if(!n||n!=this){n&&n.remove(e);var n="focus",r="blur";t&&(CKEDITOR.env.ie?(n="focusin",r="focusout"):CKEDITOR.event.useCapture=1);var i={blur:function(){e.equals(this.currentActive)&&this.blur()},focus:function(){this.focus(e)}};e.on(n,i.focus,this),e.on(r,i.blur,this),t&&(CKEDITOR.event.useCapture=0),e.setCustomData("focusmanager",this),e.setCustomData("focusmanager_handlers",i)}},remove:function(e){e.removeCustomData("focusmanager");var t=e.removeCustomData("focusmanager_handlers");e.removeListener("blur",t.blur),e.removeListener("focus",t.focus)}}}(),CKEDITOR.keystrokeHandler=function(e){return e.keystrokeHandler?e.keystrokeHandler:(this.keystrokes={},this.blockedKeystrokes={},this._={editor:e},this)},function(){var e,t=function(t){var t=t.data,n=t.getKeystroke(),r=this.keystrokes[n],i=this._.editor;return e=i.fire("key",{keyCode:n,domEvent:t})===!1,e||(r&&(e=i.execCommand(r,{from:"keystrokeHandler"})!==!1),e||(e=!!this.blockedKeystrokes[n])),e&&t.preventDefault(!0),!e},n=function(t){e&&(e=!1,t.data.preventDefault(!0))};CKEDITOR.keystrokeHandler.prototype={attach:function(e){e.on("keydown",t,this),CKEDITOR.env.gecko&&CKEDITOR.env.mac&&e.on("keypress",n,this)}}}(),function(){CKEDITOR.lang={languages:{af:1,ar:1,bg:1,bn:1,bs:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,"en-au":1,"en-ca":1,"en-gb":1,en:1,eo:1,es:1,et:1,eu:1,fa:1,fi:1,fo:1,"fr-ca":1,fr:1,gl:1,gu:1,he:1,hi:1,hr:1,hu:1,id:1,is:1,it:1,ja:1,ka:1,km:1,ko:1,ku:1,lt:1,lv:1,mk:1,mn:1,ms:1,nb:1,nl:1,no:1,pl:1,"pt-br":1,pt:1,ro:1,ru:1,si:1,sk:1,sl:1,sq:1,"sr-latn":1,sr:1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,"zh-cn":1,zh:1},rtl:{ar:1,fa:1,he:1,ku:1,ug:1},load:function(e,t,n){if(!e||!CKEDITOR.lang.languages[e])e=this.detect(t,e);var r=this,t=function(){r[e].dir=r.rtl[e]?"rtl":"ltr",n(e,r[e])};this[e]?t():CKEDITOR.scriptLoader.load(CKEDITOR.getUrl("lang/"+e+".js"),t,this)},detect:function(e,t){var n=this.languages,t=t||navigator.userLanguage||navigator.language||e,r=t.toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/),i=r[1],r=r[2];return n[i+"-"+r]?i=i+"-"+r:n[i]||(i=null),CKEDITOR.lang.detect=i?function(){return i}:function(e){return e},i||e}}}(),CKEDITOR.scriptLoader=function(){var e={},t={};return{load:function(n,r,i,s){var o=typeof n=="string";o&&(n=[n]),i||(i=CKEDITOR);var u=n.length,f=[],l=[],c=function(e){r&&(o?r.call(i,e):r.call(i,f,l))};if(u===0)c(!0);else{var h=function(e,t){(t?f:l).push(e),--u<=0&&(s&&CKEDITOR.document.getDocumentElement().removeStyle("cursor"),c(t))},p=function(n,r){e[n]=1;var i=t[n];delete t[n];for(var s=0;s<i.length;s++)i[s](n,r)},v=function(n){if(e[n])h(n,!0);else{var i=t[n]||(t[n]=[]);i.push(h);if(!(i.length>1)){var s=new CKEDITOR.dom.element("script");s.setAttributes({type:"text/javascript",src:n}),r&&(CKEDITOR.env.ie&&CKEDITOR.env.version<11?s.$.onreadystatechange=function(){if(s.$.readyState=="loaded"||s.$.readyState=="complete")s.$.onreadystatechange=null,p(n,!0)}:(s.$.onload=function(){setTimeout(function(){p(n,!0)},0)},s.$.onerror=function(){p(n,!1)})),s.appendTo(CKEDITOR.document.getHead())}}};s&&CKEDITOR.document.getDocumentElement().setStyle("cursor","wait");for(var m=0;m<u;m++)v(n[m])}},queue:function(){function e(){var e;(e=t[0])&&this.load(e.scriptUrl,e.callback,CKEDITOR,0)}var t=[];return function(n,r){var i=this;t.push({scriptUrl:n,callback:function(){r&&r.apply(this,arguments),t.shift(),e.call(i)}}),t.length==1&&e.call(this)}}()}}(),CKEDITOR.resourceManager=function(e,t){this.basePath=e,this.fileName=t,this.registered={},this.loaded={},this.externals={},this._={waitingList:{}}},CKEDITOR.resourceManager.prototype={add:function(e,t){if(this.registered[e])throw'[CKEDITOR.resourceManager.add] The resource name "'+e+'" is already registered.';var n=this.registered[e]=t||{};return n.name=e,n.path=this.getPath(e),CKEDITOR.fire(e+CKEDITOR.tools.capitalize(this.fileName)+"Ready",n),this.get(e)},get:function(e){return this.registered[e]||null},getPath:function(e){var t=this.externals[e];return CKEDITOR.getUrl(t&&t.dir||this.basePath+e+"/")},getFilePath:function(e){var t=this.externals[e];return CKEDITOR.getUrl(this.getPath(e)+(t?t.file:this.fileName+".js"))},addExternal:function(e,t,n){for(var e=e.split(","),r=0;r<e.length;r++){var i=e[r];n||(t=t.replace(/[^\/]+$/,function(e){return n=e,""})),this.externals[i]={dir:t,file:n||this.fileName+".js"}}},load:function(e,t,n){CKEDITOR.tools.isArray(e)||(e=e?[e]:[]);for(var r=this.loaded,i=this.registered,s=[],o={},u={},a=0;a<e.length;a++){var f=e[a];if(f)if(!r[f]&&!i[f]){var l=this.getFilePath(f);s.push(l),l in o||(o[l]=[]),o[l].push(f)}else u[f]=this.get(f)}CKEDITOR.scriptLoader.load(s,function(e,i){if(i.length)throw'[CKEDITOR.resourceManager.load] Resource name "'+o[i[0]].join(",")+'" was not found at "'+i[0]+'".';for(var s=0;s<e.length;s++)for(var a=o[e[s]],f=0;f<a.length;f++){var l=a[f];u[l]=this.get(l),r[l]=1}t.call(n,u)},this)}},CKEDITOR.plugins=new CKEDITOR.resourceManager("plugins/","plugin"),CKEDITOR.plugins.load=CKEDITOR.tools.override(CKEDITOR.plugins.load,function(e){var t={};return function(n,r,i){var s={},o=function(n){e.call(this,n,function(e){CKEDITOR.tools.extend(s,e);var n=[],u;for(u in e){var a=e[u],l=a&&a.requires;if(!t[u]){if(a.icons)for(var p=a.icons.split(","),v=p.length;v--;)CKEDITOR.skin.addIcon(p[v],a.path+"icons/"+(CKEDITOR.env.hidpi&&a.hidpi?"hidpi/":"")+p[v]+".png");t[u]=1}if(l){l.split&&(l=l.split(","));for(a=0;a<l.length;a++)s[l[a]]||n.push(l[a])}}if(n.length)o.call(this,n);else{for(u in s)a=s[u],a.onLoad&&!a.onLoad._called&&(a.onLoad()===!1&&delete s[u],a.onLoad._called=1);r&&r.call(i||window,s)}},this)};o.call(this,n)}}),CKEDITOR.plugins.setLang=function(e,t,n){var r=this.get(e),e=r.langEntries||(r.langEntries={}),r=r.lang||(r.lang=[]);r.split&&(r=r.split(",")),CKEDITOR.tools.indexOf(r,t)==-1&&r.push(t),e[t]=n},CKEDITOR.ui=function(e){return e.ui?e.ui:(this.items={},this.instances={},this.editor=e,this._={handlers:{}},this)},CKEDITOR.ui.prototype={add:function(e,t,n){n.name=e.toLowerCase();var r=this.items[e]={type:t,command:n.command||null,args:Array.prototype.slice.call(arguments,2)};CKEDITOR.tools.extend(r,n)},get:function(e){return this.instances[e]},create:function(e){var t=this.items[e],n=t&&this._.handlers[t.type],r=t&&t.command&&this.editor.getCommand(t.command),n=n&&n.create.apply(this,t.args);return this.instances[e]=n,r&&r.uiItems.push(n),n&&!n.type&&(n.type=t.type),n},addHandler:function(e,t){this._.handlers[e]=t},space:function(e){return CKEDITOR.document.getById(this.spaceId(e))},spaceId:function(e){return this.editor.id+"_"+e}},CKEDITOR.event.implementOn(CKEDITOR.ui),function(){function e(e,r,s){CKEDITOR.event.call(this),e=e&&CKEDITOR.tools.clone(e);if(r!==void 0){if(!(r instanceof CKEDITOR.dom.element))throw Error("Expect element of type CKEDITOR.dom.element.");if(!s)throw Error("One of the element modes must be specified.");if(CKEDITOR.env.ie&&CKEDITOR.env.quirks&&s==CKEDITOR.ELEMENT_MODE_INLINE)throw Error("Inline element mode is not supported on IE quirks.");if(!(s==CKEDITOR.ELEMENT_MODE_INLINE?r.is(CKEDITOR.dtd.$editable)||r.is("textarea"):s==CKEDITOR.ELEMENT_MODE_REPLACE?!r.is(CKEDITOR.dtd.$nonBodyContent):1))throw Error('The specified element mode is not supported on element: "'+r.getName()+'".');this.element=r,this.elementMode=s,this.name=this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO&&(r.getId()||r.getNameAtt())}else this.elementMode=CKEDITOR.ELEMENT_MODE_NONE;this._={},this.commands={},this.templates={},this.name=this.name||t(),this.id=CKEDITOR.tools.getNextId(),this.status="unloaded",this.config=CKEDITOR.tools.prototypedCopy(CKEDITOR.config),this.ui=new CKEDITOR.ui(this),this.focusManager=new CKEDITOR.focusManager(this),this.keystrokeHandler=new CKEDITOR.keystrokeHandler(this),this.on("readOnly",n),this.on("selectionChange",function(e){i(this,e.data.path)}),this.on("activeFilterChange",function(){i(this,this.elementPath(),!0)}),this.on("mode",n),this.on("instanceReady",function(){this.config.startupFocus&&this.focus()}),CKEDITOR.fire("instanceCreated",null,this),CKEDITOR.add(this),CKEDITOR.tools.setTimeout(function(){o(this,e)},0,this)}function t(){do var e="editor"+ ++h;while(CKEDITOR.instances[e]);return e}function n(){var e=this.commands,t;for(t in e)r(this,e[t])}function r(e,t){t[t.startDisabled?"disable":e.readOnly&&!t.readOnly?"disable":t.modes[e.mode]?"enable":"disable"]()}function i(e,t,n){if(t){var r,i,s=e.commands;for(i in s)r=s[i],(n||r.contextSensitive)&&r.refresh(e,t)}}function s(e){var t=e.config.customConfig;if(!t)return!1;var t=CKEDITOR.getUrl(t),n=p[t]||(p[t]={});return n.fn?(n.fn.call(e,e.config),(CKEDITOR.getUrl(e.config.customConfig)==t||!s(e))&&e.fireOnce("customConfigLoaded")):CKEDITOR.scriptLoader.queue(t,function(){n.fn=CKEDITOR.editorConfig?CKEDITOR.editorConfig:function(){},s(e)}),!0}function o(e,t){e.on("customConfigLoaded",function(){if(t){if(t.on)for(var n in t.on)e.on(n,t.on[n]);CKEDITOR.tools.extend(e.config,t,!0),delete e.config.on}n=e.config,e.readOnly=n.readOnly?!0:e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?e.element.is("textarea")?e.element.hasAttribute("disabled")||e.element.hasAttribute("readonly"):e.element.isReadOnly():e.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE?e.element.hasAttribute("disabled")||e.element.hasAttribute("readonly"):!1,e.blockless=e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?!e.element.is("textarea")&&!CKEDITOR.dtd[e.element.getName()].p:!1,e.tabIndex=n.tabIndex||e.element&&e.element.getAttribute("tabindex")||0,e.activeEnterMode=e.enterMode=e.blockless?CKEDITOR.ENTER_BR:n.enterMode,e.activeShiftEnterMode=e.shiftEnterMode=e.blockless?CKEDITOR.ENTER_BR:n.shiftEnterMode,n.skin&&(CKEDITOR.skinName=n.skin),e.fireOnce("configLoaded"),e.dataProcessor=new CKEDITOR.htmlDataProcessor(e),e.filter=e.activeFilter=new CKEDITOR.filter(e),u(e)}),t&&t.customConfig!=null&&(e.config.customConfig=t.customConfig),s(e)||e.fireOnce("customConfigLoaded")}function u(e){CKEDITOR.skin.loadPart("editor",function(){a(e)})}function a(e){CKEDITOR.lang.load(e.config.language,e.config.defaultLanguage,function(t,n){var r=e.config.title;e.langCode=t,e.lang=CKEDITOR.tools.prototypedCopy(n),e.title=typeof r=="string"||r===!1?r:[e.lang.editor,e.name].join(", "),e.config.contentsLangDirection||(e.config.contentsLangDirection=e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?e.element.getDirection(1):e.lang.dir),e.fire("langLoaded"),f(e)})}function f(e){e.getStylesSet(function(t){e.once("loaded",function(){e.fire("stylesSet",{styles:t})},null,null,1),l(e)})}function l(e){var t=e.config,n=t.plugins,r=t.extraPlugins,i=t.removePlugins;if(r)var s=RegExp("(?:^|,)(?:"+r.replace(/\s*,\s*/g,"|")+")(?=,|$)","g"),n=n.replace(s,""),n=n+(","+r);if(i)var o=RegExp("(?:^|,)(?:"+i.replace(/\s*,\s*/g,"|")+")(?=,|$)","g"),n=n.replace(o,"");CKEDITOR.env.air&&(n+=",adobeair"),CKEDITOR.plugins.load(n.split(","),function(n){var r=[],i=[],s=[];e.plugins=n;for(var u in n){var a=n[u],f=a.lang,l=null,c=a.requires,h;CKEDITOR.tools.isArray(c)&&(c=c.join(","));if(c&&(h=c.match(o)))for(;c=h.pop();)CKEDITOR.tools.setTimeout(function(e,t){throw Error('Plugin "'+e.replace(",","")+'" cannot be removed from the plugins list, because it\'s required by "'+t+'" plugin.')},0,null,[c,u]);f&&!e.lang[u]&&(f.split&&(f=f.split(",")),CKEDITOR.tools.indexOf(f,e.langCode)>=0?l=e.langCode:(l=e.langCode.replace(/-.*/,""),l=l!=e.langCode&&CKEDITOR.tools.indexOf(f,l)>=0?l:CKEDITOR.tools.indexOf(f,"en")>=0?"en":f[0]),!a.langEntries||!a.langEntries[l]?s.push(CKEDITOR.getUrl(a.path+"lang/"+l+".js")):(e.lang[u]=a.langEntries[l],l=null)),i.push(l),r.push(a)}CKEDITOR.scriptLoader.load(s,function(){for(var n=["beforeInit","init","afterInit"],s=0;s<n.length;s++)for(var o=0;o<r.length;o++){var u=r[o];s===0&&i[o]&&u.lang&&u.langEntries&&(e.lang[u.name]=u.langEntries[i[o]]),u[n[s]]&&u[n[s]](e)}e.fireOnce("pluginsLoaded"),t.keystrokes&&e.setKeystroke(e.config.keystrokes);for(o=0;o<e.config.blockedKeystrokes.length;o++)e.keystrokeHandler.blockedKeystrokes[e.config.blockedKeystrokes[o]]=1;e.status="loaded",e.fireOnce("loaded"),CKEDITOR.fire("instanceLoaded",null,e)})})}function c(){var e=this.element;if(e&&this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO){var t=this.getData();return this.config.htmlEncodeOutput&&(t=CKEDITOR.tools.htmlEncode(t)),e.is("textarea")?e.setValue(t):e.setHtml(t),!0}return!1}e.prototype=CKEDITOR.editor.prototype,CKEDITOR.editor=e;var h=0,p={};CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{addCommand:function(e,t){t.name=e.toLowerCase();var n=new CKEDITOR.command(this,t);return this.mode&&r(this,n),this.commands[e]=n},_attachToForm:function(){function e(e){t.updateElement(),t._.required&&!n.getValue()&&t.fire("required")===!1&&e.data.preventDefault()}var t=this,n=t.element,r=new CKEDITOR.dom.element(n.$.form);n.is("textarea")&&r&&(r.on("submit",e),r.$.submit&&r.$.submit.call&&r.$.submit.apply&&(r.$.submit=CKEDITOR.tools.override(r.$.submit,function(t){return function(){e(),t.apply?t.apply(this):t()}})),t.on("destroy",function(){r.removeListener("submit",e)}))},destroy:function(e){this.fire("beforeDestroy"),!e&&c.call(this),this.editable(null),this.filter.destroy(),delete this.filter,delete this.activeFilter,this.status="destroyed",this.fire("destroy"),this.removeAllListeners(),CKEDITOR.remove(this),CKEDITOR.fire("instanceDestroyed",null,this)},elementPath:function(e){if(!e){e=this.getSelection();if(!e)return null;e=e.getStartElement()}return e?new CKEDITOR.dom.elementPath(e,this.editable()):null},createRange:function(){var e=this.editable();return e?new CKEDITOR.dom.range(e):null},execCommand:function(e,t){var n=this.getCommand(e),r={name:e,commandData:t,command:n};if(n&&n.state!=CKEDITOR.TRISTATE_DISABLED&&this.fire("beforeCommandExec",r)!==!1){r.returnValue=n.exec(r.commandData);if(!n.async&&this.fire("afterCommandExec",r)!==!1)return r.returnValue}return!1},getCommand:function(e){return this.commands[e]},getData:function(e){!e&&this.fire("beforeGetData");var t=this._.data;return typeof t!="string"&&(t=(t=this.element)&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE?t.is("textarea")?t.getValue():t.getHtml():""),t={dataValue:t},!e&&this.fire("getData",t),t.dataValue},getSnapshot:function(){var e=this.fire("getSnapshot");return typeof e!="string"&&(e=(e=this.element)&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE?e.is("textarea")?e.getValue():e.getHtml():""),e},loadSnapshot:function(e){this.fire("loadSnapshot",e)},setData:function(e,t,n){var r=!0,i=t;t&&typeof t=="object"&&(n=t.internal,i=t.callback,r=!t.noSnapshot),!n&&r&&this.fire("saveSnapshot"),(i||!n)&&this.once("dataReady",function(e){!n&&r&&this.fire("saveSnapshot"),i&&i.call(e.editor)}),e={dataValue:e},!n&&this.fire("setData",e),this._.data=e.dataValue,!n&&this.fire("afterSetData",e)},setReadOnly:function(e){e=e==null||e,this.readOnly!=e&&(this.readOnly=e,this.keystrokeHandler.blockedKeystrokes[8]=+e,this.editable().setReadOnly(e),this.fire("readOnly"))},insertHtml:function(e,t,n){this.fire("insertHtml",{dataValue:e,mode:t,range:n})},insertText:function(e){this.fire("insertText",e)},insertElement:function(e){this.fire("insertElement",e)},getSelectedHtml:function(e){var t=this.editable(),n=this.getSelection(),n=n&&n.getRanges();return!t||!n||n.length===0?null:(t=t.getHtmlFromRange(n[0]),e?t.getHtml():t)},extractSelectedHtml:function(e,t){var n=this.editable(),r=this.getSelection().getRanges();return!n||r.length===0?null:(r=r[0],n=n.extractHtmlFromRange(r,t),t||this.getSelection().selectRanges([r]),e?n.getHtml():n)},focus:function(){this.fire("beforeFocus")},checkDirty:function(){return this.status=="ready"&&this._.previousValue!==this.getSnapshot()},resetDirty:function(){this._.previousValue=this.getSnapshot()},updateElement:function(){return c.call(this)},setKeystroke:function(){for(var e=this.keystrokeHandler.keystrokes,t=CKEDITOR.tools.isArray(arguments[0])?arguments[0]:[[].slice.call(arguments,0)],n,r,i=t.length;i--;)n=t[i],r=0,CKEDITOR.tools.isArray(n)&&(r=n[1],n=n[0]),r?e[n]=r:delete e[n]},addFeature:function(e){return this.filter.addFeature(e)},setActiveFilter:function(e){e||(e=this.filter),this.activeFilter!==e&&(this.activeFilter=e,this.fire("activeFilterChange"),e===this.filter?this.setActiveEnterMode(null,null):this.setActiveEnterMode(e.getAllowedEnterMode(this.enterMode),e.getAllowedEnterMode(this.shiftEnterMode,!0)))},setActiveEnterMode:function(e,t){e=e?this.blockless?CKEDITOR.ENTER_BR:e:this.enterMode,t=t?this.blockless?CKEDITOR.ENTER_BR:t:this.shiftEnterMode;if(this.activeEnterMode!=e||this.activeShiftEnterMode!=t)this.activeEnterMode=e,this.activeShiftEnterMode=t,this.fire("activeEnterModeChange")},showNotification:function(e){alert(e)}})}(),CKEDITOR.ELEMENT_MODE_NONE=0,CKEDITOR.ELEMENT_MODE_REPLACE=1,CKEDITOR.ELEMENT_MODE_APPENDTO=2,CKEDITOR.ELEMENT_MODE_INLINE=3,CKEDITOR.htmlParser=function(){this._={htmlPartsRegex:/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)--\>)|(?:([^\/\s>]+)((?:\s+[\w\-:.]+(?:\s*=\s*?(?:(?:"[^"]*")|(?:'[^']*')|[^\s"'\/>]+))?)*)[\S\s]*?(\/?)>))/g}},function(){var e=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,t={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1};CKEDITOR.htmlParser.prototype={onTagOpen:function(){},onTagClose:function(){},onText:function(){},onCDATA:function(){},onComment:function(){},parse:function(n){for(var r,i,s=0,o;r=this._.htmlPartsRegex.exec(n);){i=r.index,i>s&&(s=n.substring(s,i),o?o.push(s):this.onText(s)),s=this._.htmlPartsRegex.lastIndex;if(i=r[1]){i=i.toLowerCase(),o&&CKEDITOR.dtd.$cdata[i]&&(this.onCDATA(o.join("")),o=null);if(!o){this.onTagClose(i);continue}}if(o)o.push(r[0]);else if(i=r[3]){i=i.toLowerCase();if(!/="/.test(i)){var u={},f,l=r[4];r=!!r[5];if(l)for(;f=e.exec(l);){var c=f[1].toLowerCase();f=f[2]||f[3]||f[4]||"",u[c]=!f&&t[c]?c:CKEDITOR.tools.htmlDecodeAttr(f)}this.onTagOpen(i,u,r),!o&&CKEDITOR.dtd.$cdata[i]&&(o=[])}}else(i=r[2])&&this.onComment(i)}n.length>s&&this.onText(n.substring(s,n.length))}}}(),CKEDITOR.htmlParser.basicWriter=CKEDITOR.tools.createClass({$:function(){this._={output:[]}},proto:{openTag:function(e){this._.output.push("<",e)},openTagClose:function(e,t){t?this._.output.push(" />"):this._.output.push(">")},attribute:function(e,t){typeof t=="string"&&(t=CKEDITOR.tools.htmlEncodeAttr(t)),this._.output.push(" ",e,'="',t,'"')},closeTag:function(e){this._.output.push("</",e,">")},text:function(e){this._.output.push(e)},comment:function(e){this._.output.push("<!--",e,"-->")},write:function(e){this._.output.push(e)},reset:function(){this._.output=[],this._.indent=!1},getHtml:function(e){var t=this._.output.join("");return e&&this.reset(),t}}}),"use strict",function(){CKEDITOR.htmlParser.node=function(){},CKEDITOR.htmlParser.node.prototype={remove:function(){var e=this.parent.children,t=CKEDITOR.tools.indexOf(e,this),n=this.previous,r=this.next;n&&(n.next=r),r&&(r.previous=n),e.splice(t,1),this.parent=null},replaceWith:function(e){var t=this.parent.children,n=CKEDITOR.tools.indexOf(t,this),r=e.previous=this.previous,i=e.next=this.next;r&&(r.next=e),i&&(i.previous=e),t[n]=e,e.parent=this.parent,this.parent=null},insertAfter:function(e){var t=e.parent.children,n=CKEDITOR.tools.indexOf(t,e),r=e.next;t.splice(n+1,0,this),this.next=e.next,this.previous=e,e.next=this,r&&(r.previous=this),this.parent=e.parent},insertBefore:function(e){var t=e.parent.children,n=CKEDITOR.tools.indexOf(t,e);t.splice(n,0,this),this.next=e,(this.previous=e.previous)&&(e.previous.next=this),e.previous=this,this.parent=e.parent},getAscendant:function(e){var t=typeof e=="function"?e:typeof e=="string"?function(t){return t.name==e}:function(t){return t.name in e},n=this.parent;for(;n&&n.type==CKEDITOR.NODE_ELEMENT;){if(t(n))return n;n=n.parent}return null},wrapWith:function(e){return this.replaceWith(e),e.add(this),e},getIndex:function(){return CKEDITOR.tools.indexOf(this.parent.children,this)},getFilterContext:function(e){return e||{}}}}(),"use strict",CKEDITOR.htmlParser.comment=function(e){this.value=e,this._={isBlockLike:!1}},CKEDITOR.htmlParser.comment.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_COMMENT,filter:function(e,t){var n=this.value;return(n=e.onComment(t,n,this))?typeof n!="string"?(this.replaceWith(n),!1):(this.value=n,!0):(this.remove(),!1)},writeHtml:function(e,t){t&&this.filter(t),e.comment(this.value)}}),"use strict",function(){CKEDITOR.htmlParser.text=function(e){this.value=e,this._={isBlockLike:!1}},CKEDITOR.htmlParser.text.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(e,t){if(!(this.value=e.onText(t,this.value,this)))return this.remove(),!1},writeHtml:function(e,t){t&&this.filter(t),e.text(this.value)}})}(),"use strict",function(){CKEDITOR.htmlParser.cdata=function(e){this.value=e},CKEDITOR.htmlParser.cdata.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(){},writeHtml:function(e){e.write(this.value)}})}(),"use strict",CKEDITOR.htmlParser.fragment=function(){this.children=[],this.parent=null,this._={isBlockLike:!0,hasInlineStarted:!1}},function(){function e(e){return e.attributes["data-cke-survive"]?!1:e.name=="a"&&e.attributes.href||CKEDITOR.dtd.$removeEmpty[e.name]}var t=CKEDITOR.tools.extend({table:1,ul:1,ol:1,dl:1},CKEDITOR.dtd.table,CKEDITOR.dtd.ul,CKEDITOR.dtd.ol,CKEDITOR.dtd.dl),n={ol:1,ul:1},r=CKEDITOR.tools.extend({},{html:1},CKEDITOR.dtd.html,CKEDITOR.dtd.body,CKEDITOR.dtd.head,{style:1,script:1}),i={ul:"li",ol:"li",dl:"dd",table:"tbody",tbody:"tr",thead:"tr",tfoot:"tr",tr:"td"};CKEDITOR.htmlParser.fragment.fromHtml=function(s,o,u){function f(e){var t;if(w.length>0)for(var n=0;n<w.length;n++){var r=w[n],i=r.name,s=CKEDITOR.dtd[i],o=S.name&&CKEDITOR.dtd[S.name];(!o||o[i])&&(!e||!s||s[e]||!CKEDITOR.dtd[e])?(t||(l(),t=1),r=r.clone(),r.parent=S,S=r,w.splice(n,1),n--):i==S.name&&(p(S,S.parent,1),n--)}}function l(){for(;E.length;)p(E.shift(),S)}function h(e){if(e._.isBlockLike&&e.name!="pre"&&e.name!="textarea"){var t=e.children.length,n=e.children[t-1],r;n&&n.type==CKEDITOR.NODE_TEXT&&((r=CKEDITOR.tools.rtrim(n.value))?n.value=r:e.children.length=t-1)}}function p(t,n,r){var n=n||S||y,i=S;t.previous===void 0&&(v(n,t)&&(S=n,g.onTagOpen(u,{}),t.returnPoint=n=S),h(t),(!e(t)||t.children.length)&&n.add(t),t.name=="pre"&&(T=!1),t.name=="textarea"&&(x=!1)),t.returnPoint?(S=t.returnPoint,delete t.returnPoint):S=r?n:i}function v(e,t){if((e==y||e.name=="body")&&u&&(!e.name||CKEDITOR.dtd[e.name][u])){var n,r;return(n=t.attributes&&(r=t.attributes["data-cke-real-element-type"])?r:t.name)&&n in CKEDITOR.dtd.$inline&&!(n in CKEDITOR.dtd.head)&&!t.isOrphan||t.type==CKEDITOR.NODE_TEXT}}function m(e,t){return e in CKEDITOR.dtd.$listItem||e in CKEDITOR.dtd.$tableContent?e==t||e=="dt"&&t=="dd"||e=="dd"&&t=="dt":!1}var g=new CKEDITOR.htmlParser,y=o instanceof CKEDITOR.htmlParser.element?o:typeof o=="string"?new CKEDITOR.htmlParser.element(o):new CKEDITOR.htmlParser.fragment,w=[],E=[],S=y,x=y.name=="textarea",T=y.name=="pre";g.onTagOpen=function(i,s,o,u){s=new CKEDITOR.htmlParser.element(i,s),s.isUnknown&&o&&(s.isEmpty=!0),s.isOptionalClose=u;if(e(s))w.push(s);else{if(i=="pre")T=!0;else{if(i=="br"&&T){S.add(new CKEDITOR.htmlParser.text("\n"));return}i=="textarea"&&(x=!0)}if(i=="br")E.push(s);else{for(;;){u=(o=S.name)?CKEDITOR.dtd[o]||(S._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):r;if(!(!s.isUnknown&&!S.isUnknown&&!u[i]))break;if(S.isOptionalClose)g.onTagClose(o);else if(i in n&&o in n)o=S.children,(o=o[o.length-1])&&o.name=="li"||p(o=new CKEDITOR.htmlParser.element("li"),S),!s.returnPoint&&(s.returnPoint=S),S=o;else if(i in CKEDITOR.dtd.$listItem&&!m(i,o))g.onTagOpen(i=="li"?"ul":"dl",{},0,1);else if(o in t&&!m(i,o))!s.returnPoint&&(s.returnPoint=S),S=S.parent;else{o in CKEDITOR.dtd.$inline&&w.unshift(S);if(!S.parent){s.isOrphan=1;break}p(S,S.parent,1)}}f(i),l(),s.parent=S,s.isEmpty?p(s):S=s}}},g.onTagClose=function(e){for(var t=w.length-1;t>=0;t--)if(e==w[t].name){w.splice(t,1);return}for(var n=[],r=[],i=S;i!=y&&i.name!=e;)i._.isBlockLike||r.unshift(i),n.push(i),i=i.returnPoint||i.parent;if(i!=y){for(t=0;t<n.length;t++){var s=n[t];p(s,s.parent)}S=i,i._.isBlockLike&&l(),p(i,i.parent),i==S&&(S=S.parent),w=w.concat(r)}e=="body"&&(u=!1)},g.onText=function(e){if((!S._.hasInlineStarted||E.length)&&!T&&!x){e=CKEDITOR.tools.ltrim(e);if(e.length===0)return}var n=S.name,s=n?CKEDITOR.dtd[n]||(S._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):r;!x&&!s["#"]&&n in t?(g.onTagOpen(i[n]||""),g.onText(e)):(l(),f(),!T&&!x&&(e=e.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," ")),e=new CKEDITOR.htmlParser.text(e),v(S,e)&&this.onTagOpen(u,{},0,1),S.add(e))},g.onCDATA=function(e){S.add(new CKEDITOR.htmlParser.cdata(e))},g.onComment=function(e){l(),f(),S.add(new CKEDITOR.htmlParser.comment(e))},g.parse(s);for(l();S!=y;)p(S,S.parent,1);return h(y),y},CKEDITOR.htmlParser.fragment.prototype={type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,add:function(e,t){isNaN(t)&&(t=this.children.length);var n=t>0?this.children[t-1]:null;if(n){if(e._.isBlockLike&&n.type==CKEDITOR.NODE_TEXT){n.value=CKEDITOR.tools.rtrim(n.value);if(n.value.length===0){this.children.pop(),this.add(e);return}}n.next=e}e.previous=n,e.parent=this,this.children.splice(t,0,e),this._.hasInlineStarted||(this._.hasInlineStarted=e.type==CKEDITOR.NODE_TEXT||e.type==CKEDITOR.NODE_ELEMENT&&!e._.isBlockLike)},filter:function(e,t){t=this.getFilterContext(t),e.onRoot(t,this),this.filterChildren(e,!1,t)},filterChildren:function(e,t,n){if(this.childrenFilteredBy!=e.id){n=this.getFilterContext(n),t&&!this.parent&&e.onRoot(n,this),this.childrenFilteredBy=e.id;for(t=0;t<this.children.length;t++)this.children[t].filter(e,n)===!1&&t--}},writeHtml:function(e,t){t&&this.filter(t),this.writeChildrenHtml(e)},writeChildrenHtml:function(e,t,n){var r=this.getFilterContext();n&&!this.parent&&t&&t.onRoot(r,this),t&&this.filterChildren(t,!1,r),t=0,n=this.children;for(r=n.length;t<r;t++)n[t].writeHtml(e)},forEach:function(e,t,n){if(!n&&(!t||this.type==t))var r=e(this);if(r!==!1)for(var n=this.children,i=0;i<n.length;i++)r=n[i],r.type==CKEDITOR.NODE_ELEMENT?r.forEach(e,t):(!t||r.type==t)&&e(r)},getFilterContext:function(e){return e||{}}}}(),"use strict",function(){function e(){this.rules=[]}function t(t,n,r,i){var s,o;for(s in n)(o=t[s])||(o=t[s]=new e),o.add(n[s],r,i)}CKEDITOR.htmlParser.filter=CKEDITOR.tools.createClass({$:function(t){this.id=CKEDITOR.tools.getNextNumber(),this.elementNameRules=new e,this.attributeNameRules=new e,this.elementsRules={},this.attributesRules={},this.textRules=new e,this.commentRules=new e,this.rootRules=new e,t&&this.addRules(t,10)},proto:{addRules:function(e,n){var r;typeof n=="number"?r=n:n&&"priority"in n&&(r=n.priority),typeof r!="number"&&(r=10),typeof n!="object"&&(n={}),e.elementNames&&this.elementNameRules.addMany(e.elementNames,r,n),e.attributeNames&&this.attributeNameRules.addMany(e.attributeNames,r,n),e.elements&&t(this.elementsRules,e.elements,r,n),e.attributes&&t(this.attributesRules,e.attributes,r,n),e.text&&this.textRules.add(e.text,r,n),e.comment&&this.commentRules.add(e.comment,r,n),e.root&&this.rootRules.add(e.root,r,n)},applyTo:function(e){e.filter(this)},onElementName:function(e,t){return this.elementNameRules.execOnName(e,t)},onAttributeName:function(e,t){return this.attributeNameRules.execOnName(e,t)},onText:function(e,t,n){return this.textRules.exec(e,t,n)},onComment:function(e,t,n){return this.commentRules.exec(e,t,n)},onRoot:function(e,t){return this.rootRules.exec(e,t)},onElement:function(e,t){for(var n=[this.elementsRules["^"],this.elementsRules[t.name],this.elementsRules.$],r,i=0;i<3;i++)if(r=n[i]){r=r.exec(e,t,this);if(r===!1)return null;if(r&&r!=t)return this.onNode(e,r);if(t.parent&&!t.name)break}return t},onNode:function(e,t){var n=t.type;return n==CKEDITOR.NODE_ELEMENT?this.onElement(e,t):n==CKEDITOR.NODE_TEXT?new CKEDITOR.htmlParser.text(this.onText(e,t.value)):n==CKEDITOR.NODE_COMMENT?new CKEDITOR.htmlParser.comment(this.onComment(e,t.value)):null},onAttribute:function(e,t,n,r){return(n=this.attributesRules[n])?n.exec(e,r,t,this):r}}}),CKEDITOR.htmlParser.filterRulesGroup=e,e.prototype={add:function(e,t,n){this.rules.splice(this.findIndex(t),0,{value:e,priority:t,options:n})},addMany:function(e,t,n){for(var r=[this.findIndex(t),0],i=0,s=e.length;i<s;i++)r.push({value:e[i],priority:t,options:n});this.rules.splice.apply(this.rules,r)},findIndex:function(e){for(var t=this.rules,n=t.length-1;n>=0&&e<t[n].priority;)n--;return n+1},exec:function(e,t){var n=t instanceof CKEDITOR.htmlParser.node||t instanceof CKEDITOR.htmlParser.fragment,r=Array.prototype.slice.call(arguments,1),i=this.rules,s=i.length,o,u,a,f;for(f=0;f<s;f++){n&&(o=t.type,u=t.name),a=i[f];if(!(e.nonEditable&&!a.options.applyToAll||e.nestedEditable&&a.options.excludeNestedEditable)){a=a.value.apply(null,r);if(a===!1||n&&a&&(a.name!=u||a.type!=o))return a;a!=null&&(r[0]=t=a)}}return t},execOnName:function(e,t){for(var n=0,r=this.rules,i=r.length,s;t&&n<i;n++)s=r[n],!(e.nonEditable&&!s.options.applyToAll||e.nestedEditable&&s.options.excludeNestedEditable)&&(t=t.replace(s.value[0],s.value[1]));return t}}}(),function(){function e(e,t){function u(e){return e||CKEDITOR.env.needsNbspFiller?new CKEDITOR.htmlParser.text(" "):new CKEDITOR.htmlParser.element("br",{"data-cke-bogus":1})}function a(e,t){return function(i){if(i.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var o=[],a=n(i),l,h;if(a)for(f(a,1)&&o.push(a);a;)s(a)&&(l=r(a))&&f(l)&&((h=r(l))&&!s(h)?o.push(l):(u(c).insertAfter(l),l.remove())),a=a.previous;for(a=0;a<o.length;a++)o[a].remove();if(o=!e||(typeof t=="function"?t(i):t)!==!1)!c&&!CKEDITOR.env.needsBrFiller&&i.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT?o=!1:!c&&!CKEDITOR.env.needsBrFiller&&(document.documentMode>7||i.name in CKEDITOR.dtd.tr||i.name in CKEDITOR.dtd.$listItem)?o=!1:(o=n(i),o=!o||i.name=="form"&&o.name=="input");o&&i.add(u(e))}}}function f(e,t){if((!c||CKEDITOR.env.needsBrFiller)&&e.type==CKEDITOR.NODE_ELEMENT&&e.name=="br"&&!e.attributes["data-cke-eol"])return!0;var n;if(e.type==CKEDITOR.NODE_TEXT&&(n=e.value.match(m))){n.index&&((new CKEDITOR.htmlParser.text(e.value.substring(0,n.index))).insertBefore(e),e.value=n[0]);if(!CKEDITOR.env.needsBrFiller&&c&&(!t||e.parent.name in h))return!0;if(!c)if((n=e.previous)&&n.name=="br"||!n||s(n))return!0}return!1}var l={elements:{}},c=t=="html",h=CKEDITOR.tools.extend({},w),p;for(p in h)"#"in y[p]||delete h[p];for(p in h)l.elements[p]=a(c,e.config.fillEmptyBlocks);return l.root=a(c,!1),l.elements.br=function(e){return function(t){if(t.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var n=t.attributes;if("data-cke-bogus"in n||"data-cke-eol"in n)delete n["data-cke-bogus"];else{for(n=t.next;n&&i(n);)n=n.next;var a=r(t);!n&&s(t.parent)?o(t.parent,u(e)):s(n)&&a&&!s(a)&&u(e).insertBefore(n)}}}}(c),l}function t(e,t){return e!=CKEDITOR.ENTER_BR&&t!==!1?e==CKEDITOR.ENTER_DIV?"div":"p":!1}function n(e){for(e=e.children[e.children.length-1];e&&i(e);)e=e.previous;return e}function r(e){for(e=e.previous;e&&i(e);)e=e.previous;return e}function i(e){return e.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(e.value)||e.type==CKEDITOR.NODE_ELEMENT&&e.attributes["data-cke-bookmark"]}function s(e){return e&&(e.type==CKEDITOR.NODE_ELEMENT&&e.name in w||e.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT)}function o(e,t){var n=e.children[e.children.length-1];e.children.push(t),t.parent=e,n&&(n.next=t,t.previous=n)}function u(e){e=e.attributes,e.contenteditable!="false"&&(e["data-cke-editable"]=e.contenteditable?"true":1),e.contenteditable="false"}function a(e){e=e.attributes;switch(e["data-cke-editable"]){case"true":e.contenteditable="true";break;case"1":delete e.contenteditable}}function f(e){return e.replace(N,function(e,t,n){return"<"+t+n.replace(C,function(e,t){return k.test(t)&&n.indexOf("data-cke-saved-"+t)==-1?" data-cke-saved-"+e+" data-cke-"+CKEDITOR.rnd+"-"+e:e})+">"})}function l(e,t){return e.replace(t,function(e,t,n){return e.indexOf("<textarea")===0&&(e=t+p(n).replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</textarea>"),"<cke:encoded>"+encodeURIComponent(e)+"</cke:encoded>"})}function c(e){return e.replace(O,function(e,t){return decodeURIComponent(t)})}function h(e){return e.replace(/<\!--(?!{cke_protected})[\s\S]+?--\>/g,function(e){return"<!--"+g+"{C}"+encodeURIComponent(e).replace(/--/g,"%2D%2D")+"-->"})}function p(e){return e.replace(/<\!--\{cke_protected\}\{C\}([\s\S]+?)--\>/g,function(e,t){return decodeURIComponent(t)})}function d(e,t){var n=t._.dataStore;return e.replace(/<\!--\{cke_protected\}([\s\S]+?)--\>/g,function(e,t){return decodeURIComponent(t)}).replace(/\{cke_protected_(\d+)\}/g,function(e,t){return n&&n[t]||""})}function v(e,t){for(var n=[],r=t.config.protectedSource,i=t._.dataStore||(t._.dataStore={id:1}),s=/<\!--\{cke_temp(comment)?\}(\d*?)--\>/g,r=[/<script[\s\S]*?(<\/script>|$)/gi,/<noscript[\s\S]*?<\/noscript>/gi,/<meta[\s\S]*?\/?>/gi].concat(r),e=e.replace(/<\!--[\s\S]*?--\>/g,function(e){return"<!--{cke_tempcomment}"+(n.push(e)-1)+"-->"}),o=0;o<r.length;o++)e=e.replace(r[o],function(e){return e=e.replace(s,function(e,t,r){return n[r]}),/cke_temp(comment)?/.test(e)?e:"<!--{cke_temp}"+(n.push(e)-1)+"-->"});return e=e.replace(s,function(e,t,r){return"<!--"+g+(t?"{C}":"")+encodeURIComponent(n[r]).replace(/--/g,"%2D%2D")+"-->"}),e=e.replace(/<\w+(?:\s+(?:(?:[^\s=>]+\s*=\s*(?:[^'"\s>]+|'[^']*'|"[^"]*"))|[^\s=\/>]+))+\s*\/?>/g,function(e){return e.replace(/<\!--\{cke_protected\}([^>]*)--\>/g,function(e,t){return i[i.id]=decodeURIComponent(t),"{cke_protected_"+i.id++ +"}"})}),e=e.replace(/<(title|iframe|textarea)([^>]*)>([\s\S]*?)<\/\1>/g,function(e,n,r,i){return"<"+n+r+">"+d(p(i),t)+"</"+n+">"})}CKEDITOR.htmlDataProcessor=function(n){var r,i,s=this;this.editor=n,this.dataFilter=r=new CKEDITOR.htmlParser.filter,this.htmlFilter=i=new CKEDITOR.htmlParser.filter,this.writer=new CKEDITOR.htmlParser.basicWriter,r.addRules(E),r.addRules(S,{applyToAll:!0}),r.addRules(e(n,"data"),{applyToAll:!0}),i.addRules(x),i.addRules(T,{applyToAll:!0}),i.addRules(e(n,"html"),{applyToAll:!0}),n.on("toHtml",function(e){var e=e.data,r=e.dataValue,i,r=v(r,n),r=l(r,A),r=f(r),r=l(r,L),r=r.replace(M,"$1cke:$2"),r=r.replace(D,"<cke:$1$2></cke:$1>"),r=r.replace(/(<pre\b[^>]*>)(\r\n|\n)/g,"$1$2$2"),r=r.replace(/([^a-z0-9<\-])(on\w{3,})(?!>)/gi,"$1data-cke-"+CKEDITOR.rnd+"-$2");i=e.context||n.editable().getName();var s;CKEDITOR.env.ie&&CKEDITOR.env.version<9&&i=="pre"&&(i="div",r="<pre>"+r+"</pre>",s=1),i=n.document.createElement(i),i.setHtml("a"+r),r=i.getHtml().substr(1),r=r.replace(RegExp("data-cke-"+CKEDITOR.rnd+"-","ig"),""),s&&(r=r.replace(/^<pre>|<\/pre>$/gi,"")),r=r.replace(_,"$1$2"),r=c(r),r=p(r),i=e.fixForBody===!1?!1:t(e.enterMode,n.config.autoParagraph),r=CKEDITOR.htmlParser.fragment.fromHtml(r,e.context,i),i&&(s=r,!s.children.length&&CKEDITOR.dtd[s.name][i]&&(i=new CKEDITOR.htmlParser.element(i),s.add(i))),e.dataValue=r},null,null,5),n.on("toHtml",function(e){e.data.filter.applyTo(e.data.dataValue,!0,e.data.dontFilter,e.data.enterMode)&&n.fire("dataFiltered")},null,null,6),n.on("toHtml",function(e){e.data.dataValue.filterChildren(s.dataFilter,!0)},null,null,10),n.on("toHtml",function(e){var e=e.data,t=e.dataValue,n=new CKEDITOR.htmlParser.basicWriter;t.writeChildrenHtml(n),t=n.getHtml(!0),e.dataValue=h(t)},null,null,15),n.on("toDataFormat",function(e){var r=e.data.dataValue;e.data.enterMode!=CKEDITOR.ENTER_BR&&(r=r.replace(/^<br *\/?>/i,"")),e.data.dataValue=CKEDITOR.htmlParser.fragment.fromHtml(r,e.data.context,t(e.data.enterMode,n.config.autoParagraph))},null,null,5),n.on("toDataFormat",function(e){e.data.dataValue.filterChildren(s.htmlFilter,!0)},null,null,10),n.on("toDataFormat",function(e){e.data.filter.applyTo(e.data.dataValue,!1,!0)},null,null,11),n.on("toDataFormat",function(e){var t=e.data.dataValue,r=s.writer;r.reset(),t.writeChildrenHtml(r),t=r.getHtml(!0),t=p(t),t=d(t,n),e.data.dataValue=t},null,null,15)},CKEDITOR.htmlDataProcessor.prototype={toHtml:function(e,t,n,r){var i=this.editor,s,o,u,a;return t&&typeof t=="object"?(s=t.context,n=t.fixForBody,r=t.dontFilter,o=t.filter,u=t.enterMode,a=t.protectedWhitespaces):s=t,!s&&s!==null&&(s=i.editable().getName()),i.fire("toHtml",{dataValue:e,context:s,fixForBody:n,dontFilter:r,filter:o||i.filter,enterMode:u||i.enterMode,protectedWhitespaces:a}).dataValue},toDataFormat:function(e,t){var n,r,i;return t&&(n=t.context,r=t.filter,i=t.enterMode),!n&&n!==null&&(n=this.editor.editable().getName()),this.editor.fire("toDataFormat",{dataValue:e,filter:r||this.editor.filter,context:n,enterMode:i||this.editor.enterMode}).dataValue}};var m=/(?:&nbsp;|\xa0)$/,g="{cke_protected}",y=CKEDITOR.dtd,b=["caption","colgroup","col","thead","tfoot","tbody"],w=CKEDITOR.tools.extend({},y.$blockLimit,y.$block),E={elements:{input:u,textarea:u}},S={attributeNames:[[/^on/,"data-cke-pa-on"],[/^data-cke-expando$/,""]]},x={elements:{embed:function(e){var t=e.parent;if(t&&t.name=="object"){var n=t.attributes.width,t=t.attributes.height;n&&(e.attributes.width=n),t&&(e.attributes.height=t)}},a:function(e){if(!e.children.length&&!e.attributes.name&&!e.attributes["data-cke-saved-name"])return!1}}},T={elementNames:[[/^cke:/,""],[/^\?xml:namespace$/,""]],attributeNames:[[/^data-cke-(saved|pa)-/,""],[/^data-cke-.*/,""],["hidefocus",""]],elements:{$:function(e){var t=e.attributes;if(t){if(t["data-cke-temp"])return!1;for(var n=["name","href","src"],r,i=0;i<n.length;i++)r="data-cke-saved-"+n[i],r in t&&delete t[n[i]]}return e},table:function(e){e.children.slice(0).sort(function(e,t){var n,r;return e.type==CKEDITOR.NODE_ELEMENT&&t.type==e.type&&(n=CKEDITOR.tools.indexOf(b,e.name),r=CKEDITOR.tools.indexOf(b,t.name)),n>-1&&r>-1&&n!=r||(n=e.parent?e.getIndex():-1,r=t.parent?t.getIndex():-1),n>r?1:-1})},param:function(e){return e.children=[],e.isEmpty=!0,e},span:function(e){e.attributes["class"]=="Apple-style-span"&&delete e.name},html:function(e){delete e.attributes.contenteditable,delete e.attributes["class"]},body:function(e){delete e.attributes.spellcheck,delete e.attributes.contenteditable},style:function(e){var t=e.children[0];t&&t.value&&(t.value=CKEDITOR.tools.trim(t.value)),e.attributes.type||(e.attributes.type="text/css")},title:function(e){var t=e.children[0];!t&&o(e,t=new CKEDITOR.htmlParser.text),t.value=e.attributes["data-cke-title"]||""},input:a,textarea:a},attributes:{"class":function(e){return CKEDITOR.tools.ltrim(e.replace(/(?:^|\s+)cke_[^\s]*/g,""))||!1}}};CKEDITOR.env.ie&&(T.attributes.style=function(e){return e.replace(/(^|;)([^\:]+)/g,function(e){return e.toLowerCase()})});var N=/<(a|area|img|input|source)\b([^>]*)>/gi,C=/([\w-:]+)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,k=/^(href|src|name)$/i,L=/(?:<style(?=[ >])[^>]*>[\s\S]*?<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,A=/(<textarea(?=[ >])[^>]*>)([\s\S]*?)(?:<\/textarea>)/gi,O=/<cke:encoded>([^<]*)<\/cke:encoded>/gi,M=/(<\/?)((?:object|embed|param|html|body|head|title)[^>]*>)/gi,_=/(<\/?)cke:((?:html|body|head|title)[^>]*>)/gi,D=/<cke:(param|embed)([^>]*?)\/?>(?!\s*<\/cke:\1)/gi}(),"use strict",CKEDITOR.htmlParser.element=function(e,t){this.name=e,this.attributes=t||{},this.children=[];var n=e||"",r=n.match(/^cke:(.*)/);r&&(n=r[1]),n=!(!CKEDITOR.dtd.$nonBodyContent[n]&&!CKEDITOR.dtd.$block[n]&&!CKEDITOR.dtd.$listItem[n]&&!CKEDITOR.dtd.$tableContent[n]&&!CKEDITOR.dtd.$nonEditable[n]&&n!="br"),this.isEmpty=!!CKEDITOR.dtd.$empty[e],this.isUnknown=!CKEDITOR.dtd[e],this._={isBlockLike:n,hasInlineStarted:this.isEmpty||!n}},CKEDITOR.htmlParser.cssStyle=function(e){var t={};return((e instanceof CKEDITOR.htmlParser.element?e.attributes.style:e)||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(e,n,r){n=="font-family"&&(r=r.replace(/["']/g,"")),t[n.toLowerCase()]=r}),{rules:t,populate:function(e){var t=this.toString();t&&(e instanceof CKEDITOR.dom.element?e.setAttribute("style",t):e instanceof CKEDITOR.htmlParser.element?e.attributes.style=t:e.style=t)},toString:function(){var e=[],n;for(n in t)t[n]&&e.push(n,":",t[n],";");return e.join("")}}},function(){function e(e){return function(t){return t.type==CKEDITOR.NODE_ELEMENT&&(typeof e=="string"?t.name==e:t.name in e)}}var t=function(e,t){return e=e[0],t=t[0],e<t?-1:e>t?1:0},n=CKEDITOR.htmlParser.fragment.prototype;CKEDITOR.htmlParser.element.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_ELEMENT,add:n.add,clone:function(){return new CKEDITOR.htmlParser.element(this.name,this.attributes)},filter:function(e,t){var n=this,r,i,t=n.getFilterContext(t);if(t.off)return!0;n.parent||e.onRoot(t,n);for(;;){r=n.name;if(!(i=e.onElementName(t,r)))return this.remove(),!1;n.name=i;if(!(n=e.onElement(t,n)))return this.remove(),!1;if(n!==this)return this.replaceWith(n),!1;if(n.name==r)break;if(n.type!=CKEDITOR.NODE_ELEMENT)return this.replaceWith(n),!1;if(!n.name)return this.replaceWithChildren(),!1}r=n.attributes;var s,o;for(s in r){o=s;for(i=r[s];;){if(!(o=e.onAttributeName(t,s))){delete r[s];break}if(o==s)break;delete r[s],s=o}o&&((i=e.onAttribute(t,n,o,i))===!1?delete r[o]:r[o]=i)}return n.isEmpty||this.filterChildren(e,!1,t),!0},filterChildren:n.filterChildren,writeHtml:function(e,n){n&&this.filter(n);var r=this.name,i=[],s=this.attributes,o,u;e.openTag(r,s);for(o in s)i.push([o,s[o]]);e.sortAttributes&&i.sort(t),o=0;for(u=i.length;o<u;o++)s=i[o],e.attribute(s[0],s[1]);e.openTagClose(r,this.isEmpty),this.writeChildrenHtml(e),this.isEmpty||e.closeTag(r)},writeChildrenHtml:n.writeChildrenHtml,replaceWithChildren:function(){for(var e=this.children,t=e.length;t;)e[--t].insertAfter(this);this.remove()},forEach:n.forEach,getFirst:function(t){if(!t)return this.children.length?this.children[0]:null;typeof t!="function"&&(t=e(t));for(var n=0,r=this.children.length;n<r;++n)if(t(this.children[n]))return this.children[n];return null},getHtml:function(){var e=new CKEDITOR.htmlParser.basicWriter;return this.writeChildrenHtml(e),e.getHtml()},setHtml:function(e){for(var e=this.children=CKEDITOR.htmlParser.fragment.fromHtml(e).children,t=0,n=e.length;t<n;++t)e[t].parent=this},getOuterHtml:function(){var e=new CKEDITOR.htmlParser.basicWriter;return this.writeHtml(e),e.getHtml()},split:function(e){for(var t=this.children.splice(e,this.children.length-e),n=this.clone(),r=0;r<t.length;++r)t[r].parent=n;return n.children=t,t[0]&&(t[0].previous=null),e>0&&(this.children[e-1].next=null),this.parent.add(n,this.getIndex()+1),n},addClass:function(e){if(!this.hasClass(e)){var t=this.attributes["class"]||"";this.attributes["class"]=t+(t?" ":"")+e}},removeClass:function(e){var t=this.attributes["class"];t&&((t=CKEDITOR.tools.trim(t.replace(RegExp("(?:\\s+|^)"+e+"(?:\\s+|$)")," ")))?this.attributes["class"]=t:delete this.attributes["class"])},hasClass:function(e){var t=this.attributes["class"];return t?RegExp("(?:^|\\s)"+e+"(?=\\s|$)").test(t):!1},getFilterContext:function(e){var t=[];e||(e={off:!1,nonEditable:!1,nestedEditable:!1}),!e.off&&this.attributes["data-cke-processor"]=="off"&&t.push("off",!0),!e.nonEditable&&this.attributes.contenteditable=="false"?t.push("nonEditable",!0):e.nonEditable&&!e.nestedEditable&&this.attributes.contenteditable=="true"&&t.push("nestedEditable",!0);if(t.length)for(var e=CKEDITOR.tools.copy(e),n=0;n<t.length;n+=2)e[t[n]]=t[n+1];return e}},!0)}(),function(){var e={},t=/{([^}]+)}/g,n=/([\\'])/g,r=/\n/g,i=/\r/g;CKEDITOR.template=function(s){if(e[s])this.output=e[s];else{var o=s.replace(n,"\\$1").replace(r,"\\n").replace(i,"\\r").replace(t,function(e,t){return"',data['"+t+"']==undefined?'{"+t+"}':data['"+t+"'],'"});this.output=e[s]=Function("data","buffer","return buffer?buffer.push('"+o+"'):['"+o+"'].join('');")}}}(),delete CKEDITOR.loadFullCore,CKEDITOR.instances={},CKEDITOR.document=new CKEDITOR.dom.document(document),CKEDITOR.add=function(e){CKEDITOR.instances[e.name]=e,e.on("focus",function(){CKEDITOR.currentInstance!=e&&(CKEDITOR.currentInstance=e,CKEDITOR.fire("currentInstance"))}),e.on("blur",function(){CKEDITOR.currentInstance==e&&(CKEDITOR.currentInstance=null,CKEDITOR.fire("currentInstance"))}),CKEDITOR.fire("instance",null,e)},CKEDITOR.remove=function(e){delete CKEDITOR.instances[e.name]},function(){var e={};CKEDITOR.addTemplate=function(t,n){var r=e[t];return r?r:(r={name:t,source:n},CKEDITOR.fire("template",r),e[t]=new CKEDITOR.template(r.source))},CKEDITOR.getTemplate=function(t){return e[t]}}(),function(){var e=[];CKEDITOR.addCss=function(t){e.push(t)},CKEDITOR.getCss=function(){return e.join("\n")}}(),CKEDITOR.on("instanceDestroyed",function(){CKEDITOR.tools.isEmpty(this.instances)&&CKEDITOR.fire("reset")}),CKEDITOR.TRISTATE_ON=1,CKEDITOR.TRISTATE_OFF=2,CKEDITOR.TRISTATE_DISABLED=0,function(){CKEDITOR.inline=function(e,t){if(!CKEDITOR.env.isCompatible)return null;e=CKEDITOR.dom.element.get(e);if(e.getEditor())throw'The editor instance "'+e.getEditor().name+'" is already attached to the provided element.';var n=new CKEDITOR.editor(t,e,CKEDITOR.ELEMENT_MODE_INLINE),r=e.is("textarea")?e:null;return r?(n.setData(r.getValue(),null,!0),e=CKEDITOR.dom.element.createFromHtml('<div contenteditable="'+!!n.readOnly+'" class="cke_textarea_inline">'+r.getValue()+"</div>",CKEDITOR.document),e.insertAfter(r),r.hide(),r.$.form&&n._attachToForm()):n.setData(e.getHtml(),null,!0),n.on("loaded",function(){n.fire("uiReady"),n.editable(e),n.container=e,n.ui.contentsElement=e,n.setData(n.getData(1)),n.resetDirty(),n.fire("contentDom"),n.mode="wysiwyg",n.fire("mode"),n.status="ready",n.fireOnce("instanceReady"),CKEDITOR.fire("instanceReady",null,n)},null,null,1e4),n.on("destroy",function(){r&&(n.container.clearCustomData(),n.container.remove(),r.show()),n.element.clearCustomData(),delete n.element}),n},CKEDITOR.inlineAll=function(){var e,t,n;for(n in CKEDITOR.dtd.$editable)for(var r=CKEDITOR.document.getElementsByTag(n),i=0,s=r.count();i<s;i++)e=r.getItem(i),e.getAttribute("contenteditable")=="true"&&(t={element:e,config:{}},CKEDITOR.fire("inline",t)!==!1&&CKEDITOR.inline(e,t.config))},CKEDITOR.domReady(function(){!CKEDITOR.disableAutoInline&&CKEDITOR.inlineAll()})}(),CKEDITOR.replaceClass="ckeditor",function(){function e(e,r,i,s){if(!CKEDITOR.env.isCompatible)return null;e=CKEDITOR.dom.element.get(e);if(e.getEditor())throw'The editor instance "'+e.getEditor().name+'" is already attached to the provided element.';var o=new CKEDITOR.editor(r,e,s);return s==CKEDITOR.ELEMENT_MODE_REPLACE&&(e.setStyle("visibility","hidden"),o._.required=e.hasAttribute("required"),e.removeAttribute("required")),i&&o.setData(i,null,!0),o.on("loaded",function(){n(o),s==CKEDITOR.ELEMENT_MODE_REPLACE&&o.config.autoUpdateElement&&e.$.form&&o._attachToForm(),o.setMode(o.config.startupMode,function(){o.resetDirty(),o.status="ready",o.fireOnce("instanceReady"),CKEDITOR.fire("instanceReady",null,o)})}),o.on("destroy",t),o}function t(){var e=this.container,t=this.element;e&&(e.clearCustomData(),e.remove()),t&&(t.clearCustomData(),this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&(t.show(),this._.required&&t.setAttribute("required","required")),delete this.element)}function n(e){var t=e.name,n=e.element,r=e.elementMode,i=e.fire("uiSpace",{space:"top",html:""}).html,s=e.fire("uiSpace",{space:"bottom",html:""}).html,o=new CKEDITOR.template('<{outerEl} id="cke_{name}" class="{id} cke cke_reset cke_chrome cke_editor_{name} cke_{langDir} '+CKEDITOR.env.cssClass+'"  dir="{langDir}" lang="{langCode}" role="application"'+(e.title?' aria-labelledby="cke_{name}_arialbl"':"")+">"+(e.title?'<span id="cke_{name}_arialbl" class="cke_voice_label">{voiceLabel}</span>':"")+'<{outerEl} class="cke_inner cke_reset" role="presentation">{topHtml}<{outerEl} id="{contentId}" class="cke_contents cke_reset" role="presentation"></{outerEl}>{bottomHtml}</{outerEl}></{outerEl}>'),t=CKEDITOR.dom.element.createFromHtml(o.output({id:e.id,name:t,langDir:e.lang.dir,langCode:e.langCode,voiceLabel:e.title,topHtml:i?'<span id="'+e.ui.spaceId("top")+'" class="cke_top cke_reset_all" role="presentation" style="height:auto">'+i+"</span>":"",contentId:e.ui.spaceId("contents"),bottomHtml:s?'<span id="'+e.ui.spaceId("bottom")+'" class="cke_bottom cke_reset_all" role="presentation">'+s+"</span>":"",outerEl:CKEDITOR.env.ie?"span":"div"}));r==CKEDITOR.ELEMENT_MODE_REPLACE?(n.hide(),t.insertAfter(n)):n.append(t),e.container=t,e.ui.contentsElement=e.ui.space("contents"),i&&e.ui.space("top").unselectable(),s&&e.ui.space("bottom").unselectable(),n=e.config.width,r=e.config.height,n&&t.setStyle("width",CKEDITOR.tools.cssLength(n)),r&&e.ui.space("contents").setStyle("height",CKEDITOR.tools.cssLength(r)),t.disableContextMenu(),CKEDITOR.env.webkit&&t.on("focus",function(){e.focus()}),e.fireOnce("uiReady")}CKEDITOR.replace=function(t,n){return e(t,n,null,CKEDITOR.ELEMENT_MODE_REPLACE)},CKEDITOR.appendTo=function(t,n,r){return e(t,n,r,CKEDITOR.ELEMENT_MODE_APPENDTO)},CKEDITOR.replaceAll=function(){for(var e=document.getElementsByTagName("textarea"),t=0;t<e.length;t++){var n=null,r=e[t];if(r.name||r.id){if(typeof arguments[0]=="string"){if(!RegExp("(?:^|\\s)"+arguments[0]+"(?:$|\\s)").test(r.className))continue}else if(typeof arguments[0]=="function"){n={};if(arguments[0](r,n)===!1)continue}this.replace(r,n)}}},CKEDITOR.editor.prototype.addMode=function(e,t){(this._.modes||(this._.modes={}))[e]=t},CKEDITOR.editor.prototype.setMode=function(e,t){var n=this,r=this._.modes;if(e!=n.mode&&!!r&&!!r[e]){n.fire("beforeSetMode",e);if(n.mode){var i=n.checkDirty(),r=n._.previousModeData,s,o=0;n.fire("beforeModeUnload"),n.editable(0),n._.previousMode=n.mode,n._.previousModeData=s=n.getData(1),n.mode=="source"&&r==s&&(n.fire("lockSnapshot",{forceUpdate:!0}),o=1),n.ui.space("contents").setHtml(""),n.mode=""}else n._.previousModeData=n.getData(1);this._.modes[e](function(){n.mode=e,i!==void 0&&!i&&n.resetDirty(),o?n.fire("unlockSnapshot"):e=="wysiwyg"&&n.fire("saveSnapshot"),setTimeout(function(){n.fire("mode"),t&&t.call(n)},0)})}},CKEDITOR.editor.prototype.resize=function(e,t,n,r){var i=this.container,s=this.ui.space("contents"),o=CKEDITOR.env.webkit&&this.document&&this.document.getWindow().$.frameElement,r=r?this.container.getFirst(function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasClass("cke_inner")}):i;r.setSize("width",e,!0),o&&(o.style.width="1%");var u=(r.$.offsetHeight||0)-(s.$.clientHeight||0),i=Math.max(t-(n?0:u),0),t=n?t+u:t;s.setStyle("height",i+"px"),o&&(o.style.width="100%"),this.fire("resize",{outerHeight:t,contentsHeight:i,outerWidth:e||r.getSize("width")})},CKEDITOR.editor.prototype.getResizable=function(e){return e?this.ui.space("contents"):this.container},CKEDITOR.domReady(function(){CKEDITOR.replaceClass&&CKEDITOR.replaceAll(CKEDITOR.replaceClass)})}(),CKEDITOR.config.startupMode="wysiwyg",function(){function i(e){var t=e.editor,n=e.data.path,r=n.blockLimit,i=e.data.selection,o=i.getRanges()[0],a;if(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller)if(i=s(i,n))i.appendBogus(),a=CKEDITOR.env.ie;if(l(t,n.block,r)&&o.collapsed&&!o.getCommonAncestor().isReadOnly()){n=o.clone(),n.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS),r=new CKEDITOR.dom.walker(n),r.guard=function(e){return!u(e)||e.type==CKEDITOR.NODE_COMMENT||e.isReadOnly()};if(!r.checkForward()||n.checkStartOfBlock()&&n.checkEndOfBlock())t=o.fixBlock(!0,t.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p"),CKEDITOR.env.needsBrFiller||(t=t.getFirst(u))&&t.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(t.getText()).match(/^(?:&nbsp;|\xa0)$/)&&t.remove(),a=1,e.cancel()}a&&o.select()}function s(e,t){if(e.isFake)return 0;var n=t.block||t.blockLimit,r=n&&n.getLast(u);if(n&&n.isBlockBoundary()&&(!r||r.type!=CKEDITOR.NODE_ELEMENT||!r.isBlockBoundary())&&!n.is("pre")&&!n.getBogus())return n}function o(e){var t=e.data.getTarget();t.is("input")&&(t=t.getAttribute("type"),(t=="submit"||t=="reset")&&e.data.preventDefault())}function u(e){return d(e)&&v(e)}function a(e,t){return function(n){var r=n.data.$.toElement||n.data.$.fromElement||n.data.$.relatedTarget,r=r&&r.nodeType==CKEDITOR.NODE_ELEMENT?new CKEDITOR.dom.element(r):null;(!r||!t.equals(r)&&!t.contains(r))&&e.call(this,n)}}function f(e){function t(e){return function(t,r){r&&t.type==CKEDITOR.NODE_ELEMENT&&t.is(i)&&(n=t);if(!r&&u(t)&&(!e||!g(t)))return!1}}var n,r=e.getRanges()[0],e=e.root,i={table:1,ul:1,ol:1,dl:1};if(r.startPath().contains(i)){var s=r.clone();s.collapse(1),s.setStartAt(e,CKEDITOR.POSITION_AFTER_START),e=new CKEDITOR.dom.walker(s),e.guard=t(),e.checkBackward();if(n)return s=r.clone(),s.collapse(),s.setEndAt(n,CKEDITOR.POSITION_AFTER_END),e=new CKEDITOR.dom.walker(s),e.guard=t(!0),n=!1,e.checkForward(),n}return null}function l(e,t,n){return e.config.autoParagraph!==!1&&e.activeEnterMode!=CKEDITOR.ENTER_BR&&(e.editable().equals(n)&&!t||t&&t.getAttribute("contenteditable")=="true")}function c(e){return e.activeEnterMode!=CKEDITOR.ENTER_BR&&e.config.autoParagraph!==!1?e.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p":!1}function h(e){var t=e.editor;t.getSelection().scrollIntoView(),setTimeout(function(){t.fire("saveSnapshot")},0)}function p(e,t,n){for(var r=e.getCommonAncestor(t),t=e=n?t:e;(e=e.getParent())&&!r.equals(e)&&e.getChildCount()==1;)t=e;t.remove()}var e,t,n,r;CKEDITOR.editable=CKEDITOR.tools.createClass({base:CKEDITOR.dom.element,$:function(e,t){this.base(t.$||t),this.editor=e,this.status="unloaded",this.hasFocus=!1,this.setup()},proto:{focus:function(){var e;if(CKEDITOR.env.webkit&&!this.hasFocus){e=this.editor._.previousActive||this.getDocument().getActive();if(this.contains(e)){e.focus();return}}try{this.$[CKEDITOR.env.ie&&this.getDocument().equals(CKEDITOR.document)?"setActive":"focus"]()}catch(t){if(!CKEDITOR.env.ie)throw t}CKEDITOR.env.safari&&!this.isInline()&&(e=CKEDITOR.document.getActive(),e.equals(this.getWindow().getFrame())||this.getWindow().focus())},on:function(e,t){var n=Array.prototype.slice.call(arguments,0);return CKEDITOR.env.ie&&/^focus|blur$/.exec(e)&&(e=e=="focus"?"focusin":"focusout",t=a(t,this),n[0]=e,n[1]=t),CKEDITOR.dom.element.prototype.on.apply(this,n)},attachListener:function(e){!this._.listeners&&(this._.listeners=[]);var t=Array.prototype.slice.call(arguments,1),t=e.on.apply(e,t);return this._.listeners.push(t),t},clearListeners:function(){var e=this._.listeners;try{for(;e.length;)e.pop().removeListener()}catch(t){}},restoreAttrs:function(){var e=this._.attrChanges,t,n;for(n in e)e.hasOwnProperty(n)&&(t=e[n],t!==null?this.setAttribute(n,t):this.removeAttribute(n))},attachClass:function(e){var t=this.getCustomData("classes");this.hasClass(e)||(!t&&(t=[]),t.push(e),this.setCustomData("classes",t),this.addClass(e))},changeAttr:function(e,t){var n=this.getAttribute(e);t!==n&&(!this._.attrChanges&&(this._.attrChanges={}),e in this._.attrChanges||(this._.attrChanges[e]=n),this.setAttribute(e,t))},insertText:function(e){this.editor.focus(),this.insertHtml(this.transformPlainTextToHtml(e),"text")},transformPlainTextToHtml:function(e){var t=this.editor.getSelection().getStartElement().hasAscendant("pre",!0)?CKEDITOR.ENTER_BR:this.editor.activeEnterMode;return CKEDITOR.tools.transformPlainTextToHtml(e,t)},insertHtml:function(e,t,n){var r=this.editor;r.focus(),r.fire("saveSnapshot"),n||(n=r.getSelection().getRanges()[0]),b(this,t||"html",e,n),n.select(),h(this),this.editor.fire("afterInsertHtml",{})},insertHtmlIntoRange:function(e,t,n){b(this,n||"html",e,t),this.editor.fire("afterInsertHtml",{intoRange:t})},insertElement:function(e,t){var n=this.editor;n.focus(),n.fire("saveSnapshot");var r=n.activeEnterMode,n=n.getSelection(),i=e.getName(),i=CKEDITOR.dtd.$block[i];t||(t=n.getRanges()[0]),this.insertElementIntoRange(e,t)&&(t.moveToPosition(e,CKEDITOR.POSITION_AFTER_END),i&&((i=e.getNext(function(e){return u(e)&&!g(e)}))&&i.type==CKEDITOR.NODE_ELEMENT&&i.is(CKEDITOR.dtd.$block)?i.getDtd()["#"]?t.moveToElementEditStart(i):t.moveToElementEditEnd(e):!i&&r!=CKEDITOR.ENTER_BR&&(i=t.fixBlock(!0,r==CKEDITOR.ENTER_DIV?"div":"p"),t.moveToElementEditStart(i)))),n.selectRanges([t]),h(this)},insertElementIntoSelection:function(e){this.insertElement(e)},insertElementIntoRange:function(e,t){var n=this.editor,r=n.config.enterMode,i=e.getName(),s=CKEDITOR.dtd.$block[i];if(t.checkReadOnly())return!1;t.deleteContents(1),t.startContainer.type==CKEDITOR.NODE_ELEMENT&&t.startContainer.is({tr:1,table:1,tbody:1,thead:1,tfoot:1})&&w(t);var o,u;if(s)for(;(o=t.getCommonAncestor(0,1))&&(u=CKEDITOR.dtd[o.getName()])&&(!u||!u[i]);)o.getName()in CKEDITOR.dtd.span?t.splitElement(o):t.checkStartOfBlock()&&t.checkEndOfBlock()?(t.setStartBefore(o),t.collapse(!0),o.remove()):t.splitBlock(r==CKEDITOR.ENTER_DIV?"div":"p",n.editable());return t.insertNode(e),!0},setData:function(e,t){t||(e=this.editor.dataProcessor.toHtml(e)),this.setHtml(e),this.fixInitialSelection(),this.status=="unloaded"&&(this.status="ready"),this.editor.fire("dataReady")},getData:function(e){var t=this.getHtml();return e||(t=this.editor.dataProcessor.toDataFormat(t)),t},setReadOnly:function(e){this.setAttribute("contenteditable",!e)},detach:function(){this.removeClass("cke_editable"),this.status="detached";var e=this.editor;this._.detach(),delete e.document,delete e.window},isInline:function(){return this.getDocument().equals(CKEDITOR.document)},fixInitialSelection:function(){function e(){var e=n.getDocument().$,t=e.getSelection(),r;if(t.anchorNode&&t.anchorNode==n.$)r=!0;else if(CKEDITOR.env.webkit){var i=n.getDocument().getActive();i&&i.equals(n)&&!t.anchorNode&&(r=!0)}r&&(r=new CKEDITOR.dom.range(n),r.moveToElementEditStart(n),e=e.createRange(),e.setStart(r.startContainer.$,r.startOffset),e.collapse(!0),t.removeAllRanges(),t.addRange(e))}function t(){var e=n.getDocument().$,t=e.selection,r=n.getDocument().getActive();t.type=="None"&&r.equals(n)&&(t=new CKEDITOR.dom.range(n),e=e.body.createTextRange(),t.moveToElementEditStart(n),t=t.startContainer,t.type!=CKEDITOR.NODE_ELEMENT&&(t=t.getParent()),e.moveToElementText(t.$),e.collapse(!0),e.select())}var n=this;CKEDITOR.env.ie&&(CKEDITOR.env.version<9||CKEDITOR.env.quirks)?this.hasFocus&&(this.focus(),t()):this.hasFocus?(this.focus(),e()):this.once("focus",function(){e()},null,null,-999)},getHtmlFromRange:function(i){return i.collapsed?new CKEDITOR.dom.documentFragment(i.document):(i={doc:this.getDocument(),range:i.clone()},e.detect(i,this),t.exclude(i),n.shrink(i),i.fragment=i.range.cloneContents(),r.rebuild(i,this),e.fix(i,this),new CKEDITOR.dom.documentFragment(i.fragment.$))},extractHtmlFromRange:function(e,t){var n=E,r={range:e,doc:e.document},i=this.getHtmlFromRange(e);if(e.collapsed)return e.optimize(),i;e.enlarge(CKEDITOR.ENLARGE_INLINE,1),n.table.detectPurge(r),r.bookmark=e.createBookmark(),delete r.range;var s=this.editor.createRange();s.moveToPosition(r.bookmark.startNode,CKEDITOR.POSITION_BEFORE_START),r.targetBookmark=s.createBookmark(),n.list.detectMerge(r,this),n.table.detectRanges(r,this),n.block.detectMerge(r,this),r.tableContentsRanges?(n.table.deleteRanges(r),e.moveToBookmark(r.bookmark),r.range=e):(e.moveToBookmark(r.bookmark),r.range=e,e.extractContents(n.detectExtractMerge(r))),e.moveToBookmark(r.targetBookmark),e.optimize(),n.fixUneditableRangePosition(e),n.list.merge(r,this),n.table.purge(r,this),n.block.merge(r,this);if(t){n=e.startPath();if(r=e.checkStartOfBlock())if(r=e.checkEndOfBlock())if(r=n.block)if(r=!e.root.equals(n.block)){e:{var r=n.block.getElementsByTag("span"),s=0,o;if(r)for(;o=r.getItem(s++);)if(!v(o)){r=!0;break e}r=!1}r=!r}r&&(e.moveToPosition(n.block,CKEDITOR.POSITION_BEFORE_START),n.block.remove())}else n.autoParagraph(this.editor,e),m(e.startContainer)&&e.startContainer.appendBogus();return e.startContainer.mergeSiblings(),i},setup:function(){var e=this.editor;this.attachListener(e,"beforeGetData",function(){var t=this.getData();this.is("textarea")||e.config.ignoreEmptyParagraph!==!1&&(t=t.replace(y,function(e,t){return t})),e.setData(t,null,1)},this),this.attachListener(e,"getSnapshot",function(e){e.data=this.getData(1)},this),this.attachListener(e,"afterSetData",function(){this.setData(e.getData(1))},this),this.attachListener(e,"loadSnapshot",function(e){this.setData(e.data,1)},this),this.attachListener(e,"beforeFocus",function(){var t=e.getSelection();(t=t&&t.getNative())&&t.type=="Control"||this.focus()},this),this.attachListener(e,"insertHtml",function(e){this.insertHtml(e.data.dataValue,e.data.mode,e.data.range)},this),this.attachListener(e,"insertElement",function(e){this.insertElement(e.data)},this),this.attachListener(e,"insertText",function(e){this.insertText(e.data)},this),this.setReadOnly(e.readOnly),this.attachClass("cke_editable"),e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?this.attachClass("cke_editable_inline"):(e.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE||e.elementMode==CKEDITOR.ELEMENT_MODE_APPENDTO)&&this.attachClass("cke_editable_themed"),this.attachClass("cke_contents_"+e.config.contentsLangDirection),e.keystrokeHandler.blockedKeystrokes[8]=+e.readOnly,e.keystrokeHandler.attach(this),this.on("blur",function(){this.hasFocus=!1},null,null,-1),this.on("focus",function(){this.hasFocus=!0},null,null,-1),e.focusManager.add(this),this.equals(CKEDITOR.document.getActive())&&(this.hasFocus=!0,e.once("contentDom",function(){e.focusManager.focus(this)},this)),this.isInline()&&this.changeAttr("tabindex",e.tabIndex);if(!this.is("textarea")){e.document=this.getDocument(),e.window=this.getWindow();var t=e.document;this.changeAttr("spellcheck",!e.config.disableNativeSpellChecker);var n=e.config.contentsLangDirection;this.getDirection(1)!=n&&this.changeAttr("dir",n);var r=CKEDITOR.getCss();r&&(n=t.getHead(),n.getCustomData("stylesheet")||(r=t.appendStyleText(r),r=new CKEDITOR.dom.element(r.ownerNode||r.owningElement),n.setCustomData("stylesheet",r),r.data("cke-temp",1))),n=t.getCustomData("stylesheet_ref")||0,t.setCustomData("stylesheet_ref",n+1),this.setCustomData("cke_includeReadonly",!e.config.disableReadonlyStyling),this.attachListener(this,"click",function(e){var e=e.data,t=(new CKEDITOR.dom.elementPath(e.getTarget(),this)).contains("a");t&&e.$.button!=2&&t.isReadOnly()&&e.preventDefault()});var i={8:1,46:1};this.attachListener(e,"key",function(t){if(e.readOnly)return!0;var n=t.data.domEvent.getKey(),r;if(n in i){var t=e.getSelection(),s,o=t.getRanges()[0],u=o.startPath(),a,l,c,n=n==8;CKEDITOR.env.ie&&CKEDITOR.env.version<11&&(s=t.getSelectedElement())||(s=f(t))?(e.fire("saveSnapshot"),o.moveToPosition(s,CKEDITOR.POSITION_BEFORE_START),s.remove(),o.select(),e.fire("saveSnapshot"),r=1):o.collapsed&&((a=u.block)&&(c=a[n?"getPrevious":"getNext"](d))&&c.type==CKEDITOR.NODE_ELEMENT&&c.is("table")&&o[n?"checkStartOfBlock":"checkEndOfBlock"]()?(e.fire("saveSnapshot"),o[n?"checkEndOfBlock":"checkStartOfBlock"]()&&a.remove(),o["moveToElementEdit"+(n?"End":"Start")](c),o.select(),e.fire("saveSnapshot"),r=1):u.blockLimit&&u.blockLimit.is("td")&&(l=u.blockLimit.getAscendant("table"))&&o.checkBoundaryOfElement(l,n?CKEDITOR.START:CKEDITOR.END)&&(c=l[n?"getPrevious":"getNext"](d))?(e.fire("saveSnapshot"),o["moveToElementEdit"+(n?"End":"Start")](c),o.checkStartOfBlock()&&o.checkEndOfBlock()?c.remove():o.select(),e.fire("saveSnapshot"),r=1):(l=u.contains(["td","th","caption"]))&&o.checkBoundaryOfElement(l,n?CKEDITOR.START:CKEDITOR.END)&&(r=1))}return!r}),e.blockless&&CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller&&this.attachListener(this,"keyup",function(t){t.data.getKeystroke()in i&&!this.getFirst(u)&&(this.appendBogus(),t=e.createRange(),t.moveToPosition(this,CKEDITOR.POSITION_AFTER_START),t.select())}),this.attachListener(this,"dblclick",function(t){if(e.readOnly)return!1;t={element:t.data.getTarget()},e.fire("doubleclick",t)}),CKEDITOR.env.ie&&this.attachListener(this,"click",o),(!CKEDITOR.env.ie||CKEDITOR.env.edge)&&this.attachListener(this,"mousedown",function(t){var n=t.data.getTarget();n.is("img","hr","input","textarea","select")&&!n.isReadOnly()&&(e.getSelection().selectElement(n),n.is("input","textarea","select")&&t.data.preventDefault())}),CKEDITOR.env.edge&&this.attachListener(this,"mouseup",function(t){(t=t.data.getTarget())&&t.is("img")&&e.getSelection().selectElement(t)}),CKEDITOR.env.gecko&&this.attachListener(this,"mouseup",function(t){if(t.data.$.button==2){t=t.data.getTarget();if(!t.getOuterHtml().replace(y,"")){var n=e.createRange();n.moveToElementEditStart(t),n.select(!0)}}}),CKEDITOR.env.webkit&&(this.attachListener(this,"click",function(e){e.data.getTarget().is("input","select")&&e.data.preventDefault()}),this.attachListener(this,"mouseup",function(e){e.data.getTarget().is("input","textarea")&&e.data.preventDefault()})),CKEDITOR.env.webkit&&this.attachListener(e,"key",function(t){if(e.readOnly)return!0;t=t.data.domEvent.getKey();if(t in i){var n=t==8,r=e.getSelection().getRanges()[0],t=r.startPath();if(r.collapsed){var s;e:{var o=t.block;if(o)if(r[n?"checkStartOfBlock":"checkEndOfBlock"]())if(!r.moveToClosestEditablePosition(o,!n)||!r.collapsed)s=!1;else{if(r.startContainer.type==CKEDITOR.NODE_ELEMENT){var u=r.startContainer.getChild(r.startOffset-(n?1:0));if(u&&u.type==CKEDITOR.NODE_ELEMENT&&u.is("hr")){e.fire("saveSnapshot"),u.remove(),s=!0;break e}}if((r=r.startPath().block)&&(!r||!r.contains(o))){e.fire("saveSnapshot");var a;(a=(n?r:o).getBogus())&&a.remove(),s=e.getSelection(),a=s.createBookmarks(),(n?o:r).moveChildren(n?r:o,!1),t.lastElement.mergeSiblings(),p(o,r,!n),s.selectBookmarks(a),s=!0}}else s=!1;else s=!1}if(!s)return}else{n=r,s=t.block,a=n.endPath().block,!s||!a||s.equals(a)?t=!1:(e.fire("saveSnapshot"),(o=s.getBogus())&&o.remove(),n.enlarge(CKEDITOR.ENLARGE_INLINE),n.deleteContents(),a.getParent()&&(a.moveChildren(s,!1),t.lastElement.mergeSiblings(),p(s,a,!0)),n=e.getSelection().getRanges()[0],n.collapse(1),n.optimize(),n.startContainer.getHtml()===""&&n.startContainer.appendBogus(),n.select(),t=!0);if(!t)return}return e.getSelection().scrollIntoView(),e.fire("saveSnapshot"),!1}},this,null,100)}}},_:{detach:function(){this.editor.setData(this.editor.getData(),0,1),this.clearListeners(),this.restoreAttrs();var e;if(e=this.removeCustomData("classes"))for(;e.length;)this.removeClass(e.pop());if(!this.is("textarea")){e=this.getDocument();var t=e.getHead();if(t.getCustomData("stylesheet")){var n=e.getCustomData("stylesheet_ref");--n?e.setCustomData("stylesheet_ref",n):(e.removeCustomData("stylesheet_ref"),t.removeCustomData("stylesheet").remove())}}this.editor.fire("contentDomUnload"),delete this.editor}}}),CKEDITOR.editor.prototype.editable=function(e){var t=this._.editable;return t&&e?0:(arguments.length&&(t=this._.editable=e?e instanceof CKEDITOR.editable?e:new CKEDITOR.editable(this,e):(t&&t.detach(),null)),t)},CKEDITOR.on("instanceLoaded",function(e){var t=e.editor;t.on("insertElement",function(e){e=e.data,e.type==CKEDITOR.NODE_ELEMENT&&(e.is("input")||e.is("textarea"))&&(e.getAttribute("contentEditable")!="false"&&e.data("cke-editable",e.hasAttribute("contenteditable")?"true":"1"),e.setAttribute("contentEditable",!1))}),t.on("selectionChange",function(e){if(!t.readOnly){var n=t.getSelection();n&&!n.isLocked&&(n=t.checkDirty(),t.fire("lockSnapshot"),i(e),t.fire("unlockSnapshot"),!n&&t.resetDirty())}})}),CKEDITOR.on("instanceCreated",function(e){var t=e.editor;t.on("mode",function(){var e=t.editable();if(e&&e.isInline()){var n=t.title;e.changeAttr("role","textbox"),e.changeAttr("aria-label",n),n&&e.changeAttr("title",n);var r=t.fire("ariaEditorHelpLabel",{}).label;if(r)if(n=this.ui.space(this.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"top":"contents")){var i=CKEDITOR.tools.getNextId(),r=CKEDITOR.dom.element.createFromHtml('<span id="'+i+'" class="cke_voice_label">'+r+"</span>");n.append(r),e.changeAttr("aria-describedby",i)}}})}),CKEDITOR.addCss(".cke_editable{cursor:text}.cke_editable img,.cke_editable input,.cke_editable textarea{cursor:default}");var d=CKEDITOR.dom.walker.whitespaces(!0),v=CKEDITOR.dom.walker.bookmark(!1,!0),m=CKEDITOR.dom.walker.empty(),g=CKEDITOR.dom.walker.bogus(),y=/(^|<body\b[^>]*>)\s*<(p|div|address|h\d|center|pre)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\2>)?\s*(?=$|<\/body>)/gi,b=function(){function e(e){return e.type==CKEDITOR.NODE_ELEMENT}function t(n,r){var i,s,u,a,f=[],l=r.range.startContainer;i=r.range.startPath();for(var l=o[l.getName()],c=0,h=n.getChildren(),p=h.count(),d=-1,v=-1,m=0,g=i.contains(o.$list);c<p;++c)i=h.getItem(c),e(i)?(u=i.getName(),g&&u in CKEDITOR.dtd.$list?f=f.concat(t(i,r)):(a=!!l[u],u=="br"&&i.data("cke-eol")&&(!c||c==p-1)&&(m=(s=c?f[c-1].node:h.getItem(c+1))&&(!e(s)||!s.is("br")),s=s&&e(s)&&o.$block[s.getName()]),d==-1&&!a&&(d=c),a||(v=c),f.push({isElement:1,isLineBreak:m,isBlock:i.isBlockBoundary(),hasBlockSibling:s,node:i,name:u,allowed:a}),s=m=0)):f.push({isElement:0,node:i,allowed:1});return d>-1&&(f[d].firstNotAllowed=1),v>-1&&(f[v].lastNotAllowed=1),f}function n(t,r){var i=[],s=t.getChildren(),u=s.count(),a,f=0,l=o[r],c=!t.is(o.$inline)||t.is("br");for(c&&i.push(" ");f<u;f++)a=s.getItem(f),e(a)&&!a.is(l)?i=i.concat(n(a,r)):i.push(a);return c&&i.push(" "),i}function r(t){return t&&e(t)&&(t.is(o.$removeEmpty)||t.is("a")&&!t.isBlockBoundary())}function i(t,n,r,s){var o=t.clone(),u,f;o.setEndAt(n,CKEDITOR.POSITION_BEFORE_END),(u=(new CKEDITOR.dom.walker(o)).next())&&e(u)&&a[u.getName()]&&(f=u.getPrevious())&&e(f)&&!f.getParent().equals(t.startContainer)&&r.contains(f)&&s.contains(u)&&u.isIdentical(f)&&(u.moveChildren(f),u.remove(),i(t,n,r,s))}function s(t,n){function r(t,n){if(n.isBlock&&n.isElement&&!n.node.is("br")&&e(t)&&t.is("br"))return t.remove(),1}var i=n.endContainer.getChild(n.endOffset),s=n.endContainer.getChild(n.endOffset-1);i&&r(i,t[t.length-1]),s&&r(s,t[0])&&(n.setEnd(n.endContainer,n.endOffset-1),n.collapse())}var o=CKEDITOR.dtd,a={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ul:1,ol:1,li:1,pre:1,dl:1,blockquote:1},f={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},h=CKEDITOR.tools.extend({},o.$inline);return delete h.br,function(a,p,d,v){var m=a.editor,g=!1;p=="unfiltered_html"&&(p="html",g=!0);if(!v.checkReadOnly()){var y=(new CKEDITOR.dom.elementPath(v.startContainer,v.root)).blockLimit||v.root,a={type:p,dontFilter:g,editable:a,editor:m,range:v,blockLimit:y,mergeCandidates:[],zombies:[]},p=a.range,v=a.mergeCandidates,b,w;a.type=="text"&&p.shrink(CKEDITOR.SHRINK_ELEMENT,!0,!1)&&(b=CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",p.document),p.insertNode(b),p.setStartAfter(b)),g=new CKEDITOR.dom.elementPath(p.startContainer),a.endPath=y=new CKEDITOR.dom.elementPath(p.endContainer);if(!p.collapsed){var m=y.block||y.blockLimit,E=p.getCommonAncestor();m&&!m.equals(E)&&!m.contains(E)&&p.checkEndOfBlock()&&a.zombies.push(m),p.deleteContents()}for(;(w=e(p.startContainer)&&p.startContainer.getChild(p.startOffset-1))&&e(w)&&w.isBlockBoundary()&&g.contains(w);)p.moveToPosition(w,CKEDITOR.POSITION_BEFORE_END);i(p,a.blockLimit,g,y),b&&(p.setEndBefore(b),p.collapse(),b.remove()),b=p.startPath();if(m=b.contains(r,!1,1))p.splitElement(m),a.inlineStylesRoot=m,a.inlineStylesPeak=b.lastElement;b=p.createBookmark(),(m=b.startNode.getPrevious(u))&&e(m)&&r(m)&&v.push(m),(m=b.startNode.getNext(u))&&e(m)&&r(m)&&v.push(m);for(m=b.startNode;(m=m.getParent())&&r(m);)v.push(m);p.moveToBookmark(b);if(b=d){b=a.range;if(a.type=="text"&&a.inlineStylesRoot){w=a.inlineStylesPeak,p=w.getDocument().createText("{cke-peak}");for(v=a.inlineStylesRoot.getParent();!w.equals(v);)p=p.appendTo(w.clone()),w=w.getParent();d=p.getOuterHtml().split("{cke-peak}").join(d)}w=a.blockLimit.getName();if(/^\s+|\s+$/.test(d)&&"span"in CKEDITOR.dtd[w])var S='<span data-cke-marker="1">&nbsp;</span>',d=S+d+S;d=a.editor.dataProcessor.toHtml(d,{context:null,fixForBody:!1,protectedWhitespaces:!!S,dontFilter:a.dontFilter,filter:a.editor.activeFilter,enterMode:a.editor.activeEnterMode}),w=b.document.createElement("body"),w.setHtml(d),S&&(w.getFirst().remove(),w.getLast().remove());if((S=b.startPath().block)&&(S.getChildCount()!=1||!S.getBogus()))e:{var x;if(w.getChildCount()==1&&e(x=w.getFirst())&&x.is(f)&&!x.hasAttribute("contenteditable")){S=x.getElementsByTag("*"),b=0;for(v=S.count();b<v;b++){p=S.getItem(b);if(!p.is(h))break e}x.moveChildren(x.getParent(1)),x.remove()}}a.dataWrapper=w,b=d}if(b){x=a.range,b=x.document;var T;w=a.blockLimit;var v=0,N,S=[],C,k,d=m=0,L,O,p=x.startContainer,g=a.endPath.elements[0],M,y=g.getPosition(p),E=!!g.getCommonAncestor(p)&&y!=CKEDITOR.POSITION_IDENTICAL&&!(y&CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_IS_CONTAINED),p=t(a.dataWrapper,a);for(s(p,x);v<p.length;v++){y=p[v];if(T=y.isLineBreak){T=x,L=w;var _=void 0,D=void 0;y.hasBlockSibling?T=1:(_=T.startContainer.getAscendant(o.$block,1),!_||!_.is({div:1,p:1})?T=0:(D=_.getPosition(L),D==CKEDITOR.POSITION_IDENTICAL||D==CKEDITOR.POSITION_CONTAINS?T=0:(L=T.splitElement(_),T.moveToPosition(L,CKEDITOR.POSITION_AFTER_START),T=1)))}if(T)d=v>0;else{T=x.startPath(),!y.isBlock&&l(a.editor,T.block,T.blockLimit)&&(k=c(a.editor))&&(k=b.createElement(k),k.appendBogus(),x.insertNode(k),CKEDITOR.env.needsBrFiller&&(N=k.getBogus())&&N.remove(),x.moveToPosition(k,CKEDITOR.POSITION_BEFORE_END));if((T=x.startPath().block)&&!T.equals(C)){if(N=T.getBogus())N.remove(),S.push(T);C=T}y.firstNotAllowed&&(m=1);if(m&&y.isElement){T=x.startContainer;for(L=null;T&&!o[T.getName()][y.name];){if(T.equals(w)){T=null;break}L=T,T=T.getParent()}if(T)L&&(O=x.splitElement(L),a.zombies.push(O),a.zombies.push(L));else{L=w.getName(),M=!v,T=v==p.length-1,L=n(y.node,L);for(var _=[],D=L.length,P=0,H=void 0,B=0,F=-1;P<D;P++)H=L[P],H==" "?(!B&&(!M||P)&&(_.push(new CKEDITOR.dom.text(" ")),F=_.length),B=1):(_.push(H),B=0);T&&F==_.length&&_.pop(),M=_}}if(M){for(;T=M.pop();)x.insertNode(T);M=0}else x.insertNode(y.node);y.lastNotAllowed&&v<p.length-1&&((O=E?g:O)&&x.setEndAt(O,CKEDITOR.POSITION_AFTER_START),m=0),x.collapse()}}p.length!=1?N=!1:(N=p[0],N=N.isElement&&N.node.getAttribute("contenteditable")=="false"),N&&(d=!0,T=p[0].node,x.setStartAt(T,CKEDITOR.POSITION_BEFORE_START),x.setEndAt(T,CKEDITOR.POSITION_AFTER_END)),a.dontMoveCaret=d,a.bogusNeededBlocks=S}N=a.range;var I;O=a.bogusNeededBlocks;for(M=N.createBookmark();C=a.zombies.pop();)C.getParent()&&(k=N.clone(),k.moveToElementEditStart(C),k.removeEmptyBlocksAtEnd());if(O)for(;C=O.pop();)CKEDITOR.env.needsBrFiller?C.appendBogus():C.append(N.document.createText(" "));for(;C=a.mergeCandidates.pop();)C.mergeSiblings();N.moveToBookmark(M);if(!a.dontMoveCaret){for(C=e(N.startContainer)&&N.startContainer.getChild(N.startOffset-1);C&&e(C)&&!C.is(o.$empty);){if(C.isBlockBoundary())N.moveToPosition(C,CKEDITOR.POSITION_BEFORE_END);else{if(r(C)&&C.getHtml().match(/(\s|&nbsp;)$/g)){I=null;break}I=N.clone(),I.moveToPosition(C,CKEDITOR.POSITION_BEFORE_END)}C=C.getLast(u)}I&&N.moveToRange(I)}}}}(),w=function(){function e(e){return e=new CKEDITOR.dom.walker(e),e.guard=function(e,t){if(t)return!1;if(e.type==CKEDITOR.NODE_ELEMENT)return e.is(CKEDITOR.dtd.$tableContent)},e.evaluator=function(e){return e.type==CKEDITOR.NODE_ELEMENT},e}function t(e,t,n){return t=e.getDocument().createElement(t),e.append(t,n),t}function n(e){var t=e.count(),n;for(t;t-->0;)n=e.getItem(t),CKEDITOR.tools.trim(n.getHtml())||(n.appendBogus(),CKEDITOR.env.ie&&CKEDITOR.env.version<9&&n.getChildCount()&&n.getFirst().remove())}return function(r){var i=r.startContainer,s=i.getAscendant("table",1),o=!1;n(s.getElementsByTag("td")),n(s.getElementsByTag("th")),s=r.clone(),s.setStart(i,0),s=e(s).lastBackward(),s||(s=r.clone(),s.setEndAt(i,CKEDITOR.POSITION_BEFORE_END),s=e(s).lastForward(),o=!0),s||(s=i),s.is("table")?(r.setStartAt(s,CKEDITOR.POSITION_BEFORE_START),r.collapse(!0),s.remove()):(s.is({tbody:1,thead:1,tfoot:1})&&(s=t(s,"tr",o)),s.is("tr")&&(s=t(s,s.getParent().is("thead")?"th":"td",o)),(i=s.getBogus())&&i.remove(),r.moveToPosition(s,o?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END))}}();e={detect:function(e,t){var n=e.range,r=n.clone(),i=n.clone(),s=new CKEDITOR.dom.elementPath(n.startContainer,t),o=new CKEDITOR.dom.elementPath(n.endContainer,t);r.collapse(1),i.collapse(),s.block&&r.checkBoundaryOfElement(s.block,CKEDITOR.END)&&(n.setStartAfter(s.block),e.prependEolBr=1),o.block&&i.checkBoundaryOfElement(o.block,CKEDITOR.START)&&(n.setEndBefore(o.block),e.appendEolBr=1)},fix:function(e,t){var n=t.getDocument(),r;e.appendEolBr&&(r=this.createEolBr(n),e.fragment.append(r)),e.prependEolBr&&(!r||r.getPrevious())&&e.fragment.append(this.createEolBr(n),1)},createEolBr:function(e){return e.createElement("br",{attributes:{"data-cke-eol":1}})}},t={exclude:function(e){var t=e.range.getBoundaryNodes(),n=t.startNode;(t=t.endNode)&&g(t)&&(!n||!n.equals(t))&&e.range.setEndBefore(t)}},r={rebuild:function(e,t){var n=e.range,r=n.getCommonAncestor(),i=new CKEDITOR.dom.elementPath(r,t),s=new CKEDITOR.dom.elementPath(n.startContainer,t),n=new CKEDITOR.dom.elementPath(n.endContainer,t),o;r.type==CKEDITOR.NODE_TEXT&&(r=r.getParent());if(i.blockLimit.is({tr:1,table:1})){var u=i.contains("table").getParent();o=function(e){return!e.equals(u)}}else if(i.block&&i.block.is(CKEDITOR.dtd.$listItem)){s=s.contains(CKEDITOR.dtd.$list),n=n.contains(CKEDITOR.dtd.$list);if(!s.equals(n)){var a=i.contains(CKEDITOR.dtd.$list).getParent();o=function(e){return!e.equals(a)}}}o||(o=function(e){return!e.equals(i.block)&&!e.equals(i.blockLimit)}),this.rebuildFragment(e,t,r,o)},rebuildFragment:function(e,t,n,r){for(var i;n&&!n.equals(t)&&r(n);)i=n.clone(0,1),e.fragment.appendTo(i),e.fragment=i,n=n.getParent()}},n={shrink:function(e){var e=e.range,t=e.startContainer,n=e.endContainer,r=e.startOffset,i=e.endOffset;t.type==CKEDITOR.NODE_ELEMENT&&t.equals(n)&&t.is("tr")&&++r==i&&e.shrink(CKEDITOR.SHRINK_TEXT)}};var E=function(){function e(e,t){var n=e.getParent();n.is(CKEDITOR.dtd.$inline)&&e[t?"insertBefore":"insertAfter"](n)}function t(t,n,r){e(n),e(r,1);for(var i;i=r.getNext();)i.insertAfter(n),n=i;m(t)&&t.remove()}function n(e,t){var n=new CKEDITOR.dom.range(e);return n.setStartAfter(t.startNode),n.setEndBefore(t.endNode),n}return{list:{detectMerge:function(e,t){var r=n(t,e.bookmark),i=r.startPath(),s=r.endPath(),o=i.contains(CKEDITOR.dtd.$list),u=s.contains(CKEDITOR.dtd.$list);e.mergeList=o&&u&&o.getParent().equals(u.getParent())&&!o.equals(u),e.mergeListItems=i.block&&s.block&&i.block.is(CKEDITOR.dtd.$listItem)&&s.block.is(CKEDITOR.dtd.$listItem);if(e.mergeList||e.mergeListItems)r=r.clone(),r.setStartBefore(e.bookmark.startNode),r.setEndAfter(e.bookmark.endNode),e.mergeListBookmark=r.createBookmark()},merge:function(e,n){if(e.mergeListBookmark){var r=e.mergeListBookmark.startNode,i=e.mergeListBookmark.endNode,s=new CKEDITOR.dom.elementPath(r,n),o=new CKEDITOR.dom.elementPath(i,n);if(e.mergeList){var u=s.contains(CKEDITOR.dtd.$list),a=o.contains(CKEDITOR.dtd.$list);u.equals(a)||(a.moveChildren(u),a.remove())}e.mergeListItems&&(s=s.contains(CKEDITOR.dtd.$listItem),o=o.contains(CKEDITOR.dtd.$listItem),s.equals(o)||t(o,r,i)),r.remove(),i.remove()}}},block:{detectMerge:function(e,t){if(!e.tableContentsRanges&&!e.mergeListBookmark){var n=new CKEDITOR.dom.range(t);n.setStartBefore(e.bookmark.startNode),n.setEndAfter(e.bookmark.endNode),e.mergeBlockBookmark=n.createBookmark()}},merge:function(e,n){if(e.mergeBlockBookmark&&!e.purgeTableBookmark){var r=e.mergeBlockBookmark.startNode,i=e.mergeBlockBookmark.endNode,s=new CKEDITOR.dom.elementPath(r,n),o=new CKEDITOR.dom.elementPath(i,n),s=s.block,o=o.block;s&&o&&!s.equals(o)&&t(o,r,i),r.remove(),i.remove()}}},table:function(){function e(e){var n=[],i,s=new CKEDITOR.dom.walker(e),o=e.startPath().contains(r),u=e.endPath().contains(r),a={};return s.guard=function(s,f){if(s.type==CKEDITOR.NODE_ELEMENT){var l="visited_"+(f?"out":"in");if(s.getCustomData(l))return;CKEDITOR.dom.element.setMarker(a,s,l,1)}f&&o&&s.equals(o)?(i=e.clone(),i.setEndAt(o,CKEDITOR.POSITION_BEFORE_END),n.push(i)):!f&&u&&s.equals(u)?(i=e.clone(),i.setStartAt(u,CKEDITOR.POSITION_AFTER_START),n.push(i)):!f&&s.type==CKEDITOR.NODE_ELEMENT&&s.is(r)&&(!o||t(s,o))&&(!u||t(s,u))&&(i=e.clone(),i.selectNodeContents(s),n.push(i))},s.lastForward(),CKEDITOR.dom.element.clearAllMarkers(a),n}function t(e,t){var n=CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_IS_CONTAINED,r=e.getPosition(t);return r===CKEDITOR.POSITION_IDENTICAL?!1:(r&n)===0}var r={td:1,th:1,caption:1};return{detectPurge:function(e){var t=e.range,n=t.clone();n.enlarge(CKEDITOR.ENLARGE_ELEMENT);var n=new CKEDITOR.dom.walker(n),i=0;n.evaluator=function(e){e.type==CKEDITOR.NODE_ELEMENT&&e.is(r)&&++i},n.checkForward();if(i>1){var n=t.startPath().contains("table"),s=t.endPath().contains("table");n&&s&&t.checkBoundaryOfElement(n,CKEDITOR.START)&&t.checkBoundaryOfElement(s,CKEDITOR.END)&&(t=e.range.clone(),t.setStartBefore(n),t.setEndAfter(s),e.purgeTableBookmark=t.createBookmark())}},detectRanges:function(i,s){var o=n(s,i.bookmark),u=o.clone(),a,f,l=o.getCommonAncestor();l.is(CKEDITOR.dtd.$tableContent)&&!l.is(r)&&(l=l.getAscendant("table",!0)),f=l,l=new CKEDITOR.dom.elementPath(o.startContainer,f),f=new CKEDITOR.dom.elementPath(o.endContainer,f),l=l.contains("table"),f=f.contains("table");if(l||f)l&&f&&t(l,f)?(i.tableSurroundingRange=u,u.setStartAt(l,CKEDITOR.POSITION_AFTER_END),u.setEndAt(f,CKEDITOR.POSITION_BEFORE_START),u=o.clone(),u.setEndAt(l,CKEDITOR.POSITION_AFTER_END),a=o.clone(),a.setStartAt(f,CKEDITOR.POSITION_BEFORE_START),a=e(u).concat(e(a))):l?f||(i.tableSurroundingRange=u,u.setStartAt(l,CKEDITOR.POSITION_AFTER_END),o.setEndAt(l,CKEDITOR.POSITION_AFTER_END)):(i.tableSurroundingRange=u,u.setEndAt(f,CKEDITOR.POSITION_BEFORE_START),o.setStartAt(f,CKEDITOR.POSITION_AFTER_START)),i.tableContentsRanges=a?a:e(o)},deleteRanges:function(e){for(var t;t=e.tableContentsRanges.pop();)t.extractContents(),m(t.startContainer)&&t.startContainer.appendBogus();e.tableSurroundingRange&&e.tableSurroundingRange.extractContents()},purge:function(e){if(e.purgeTableBookmark){var t=e.doc,n=e.range.clone(),t=t.createElement("p");t.insertBefore(e.purgeTableBookmark.startNode),n.moveToBookmark(e.purgeTableBookmark),n.deleteContents(),e.range.moveToPosition(t,CKEDITOR.POSITION_AFTER_START)}}}}(),detectExtractMerge:function(e){return!e.range.startPath().contains(CKEDITOR.dtd.$listItem)||!e.range.endPath().contains(CKEDITOR.dtd.$listItem)},fixUneditableRangePosition:function(e){e.startContainer.getDtd()["#"]||e.moveToClosestEditablePosition(null,!0)},autoParagraph:function(e,t){var n=t.startPath(),r;l(e,n.block,n.blockLimit)&&(r=c(e))&&(r=t.document.createElement(r),r.appendBogus(),t.insertNode(r),t.moveToPosition(r,CKEDITOR.POSITION_AFTER_START))}}}()}(),function(){function e(){var e=this._.fakeSelection,t;if(e){t=this.getSelection(1);if(!t||!t.isHidden())e.reset(),e=0}if(!e){e=t||this.getSelection(1);if(!e||e.getType()==CKEDITOR.SELECTION_NONE)return}this.fire("selectionCheck",e),t=this.elementPath(),t.compare(this._.selectionPreviousPath)||(CKEDITOR.env.webkit&&(this._.previousActive=this.document.getActive()),this._.selectionPreviousPath=t,this.fire("selectionChange",{selection:e,path:t}))}function t(){d=!0,p||(n.call(this),p=CKEDITOR.tools.setTimeout(n,200,this))}function n(){p=null,d&&(CKEDITOR.tools.setTimeout(e,0,this),d=!1)}function r(e){return v(e)||e.type==CKEDITOR.NODE_ELEMENT&&!e.is(CKEDITOR.dtd.$empty)?!0:!1}function i(e){function t(t,n){return!t||t.type==CKEDITOR.NODE_TEXT?!1:e.clone()["moveToElementEdit"+(n?"End":"Start")](t)}if(e.root instanceof CKEDITOR.editable){var n=e.startContainer,i=e.getPreviousNode(r,null,n),s=e.getNextNode(r,null,n);return t(i)||t(s,1)||!i&&!s&&(n.type!=CKEDITOR.NODE_ELEMENT||!n.isBlockBoundary()||!n.getBogus())?!0:!1}return!1}function s(e){return e.getCustomData("cke-fillingChar")}function o(e,t){var n=e&&e.removeCustomData("cke-fillingChar");if(n){if(t!==!1){var r,i=e.getDocument().getSelection().getNative(),s=i&&i.type!="None"&&i.getRangeAt(0);n.getLength()>1&&s&&s.intersectsNode(n.$)&&(r=a(i),s=i.focusNode==n.$&&i.focusOffset>0,i.anchorNode==n.$&&i.anchorOffset>0&&r[0].offset--,s&&r[1].offset--)}n.setText(u(n.getText())),r&&f(e.getDocument().$,r)}}function u(e){return e.replace(/\u200B( )?/g,function(e){return e[1]?" ":""})}function a(e){return[{node:e.anchorNode,offset:e.anchorOffset},{node:e.focusNode,offset:e.focusOffset}]}function f(e,t){var n=e.getSelection(),r=e.createRange();r.setStart(t[0].node,t[0].offset),r.collapse(!0),n.removeAllRanges(),n.addRange(r),n.extend(t[1].node,t[1].offset)}function l(e){var t=CKEDITOR.dom.element.createFromHtml('<div data-cke-hidden-sel="1" data-cke-temp="1" style="'+(CKEDITOR.env.ie?"display:none":"position:fixed;top:0;left:-1000px")+'">&nbsp;</div>',e.document);e.fire("lockSnapshot"),e.editable().append(t);var n=e.getSelection(1),r=e.createRange(),i=n.root.on("selectionchange",function(e){e.cancel()},null,null,0);r.setStartAt(t,CKEDITOR.POSITION_AFTER_START),r.setEndAt(t,CKEDITOR.POSITION_BEFORE_END),n.selectRanges([r]),i.removeListener(),e.fire("unlockSnapshot"),e._.hiddenSelectionContainer=t}function c(e){var t={37:1,39:1,8:1,46:1};return function(n){var r=n.data.getKeystroke();if(t[r]){var i=e.getSelection().getRanges(),s=i[0];i.length==1&&s.collapsed&&(r=s[r<38?"getPreviousEditableNode":"getNextEditableNode"]())&&r.type==CKEDITOR.NODE_ELEMENT&&r.getAttribute("contenteditable")=="false"&&(e.getSelection().fake(r),n.data.preventDefault(),n.cancel())}}}function h(e){for(var t=0;t<e.length;t++){var n=e[t];n.getCommonAncestor().isReadOnly()&&e.splice(t,1);if(!n.collapsed){if(n.startContainer.isReadOnly())for(var r=n.startContainer,i;r;){if((i=r.type==CKEDITOR.NODE_ELEMENT)&&r.is("body")||!r.isReadOnly())break;i&&r.getAttribute("contentEditable")=="false"&&n.setStartAfter(r),r=r.getParent()}r=n.startContainer,i=n.endContainer;var s=n.startOffset,o=n.endOffset,u=n.clone();r&&r.type==CKEDITOR.NODE_TEXT&&(s>=r.getLength()?u.setStartAfter(r):u.setStartBefore(r)),i&&i.type==CKEDITOR.NODE_TEXT&&(o?u.setEndAfter(i):u.setEndBefore(i)),r=new CKEDITOR.dom.walker(u),r.evaluator=function(r){if(r.type==CKEDITOR.NODE_ELEMENT&&r.isReadOnly()){var i=n.clone();return n.setEndBefore(r),n.collapsed&&e.splice(t--,1),r.getPosition(u.endContainer)&CKEDITOR.POSITION_CONTAINS||(i.setStartAfter(r),i.collapsed||e.splice(t+1,0,i)),!0}return!1},r.next()}}return e}var p,d,v=CKEDITOR.dom.walker.invisible(1),m=function(){function e(e){return function(t){var n=t.editor.createRange();return n.moveToClosestEditablePosition(t.selected,e)&&t.editor.getSelection().selectRanges([n]),!1}}function t(e){return function(t){var n=t.editor,r=n.createRange(),i;return(i=r.moveToClosestEditablePosition(t.selected,e))||(i=r.moveToClosestEditablePosition(t.selected,!e)),i&&n.getSelection().selectRanges([r]),n.fire("saveSnapshot"),t.selected.remove(),i||(r.moveToElementEditablePosition(n.editable()),n.getSelection().selectRanges([r])),n.fire("saveSnapshot"),!1}}var n=e(),r=e(1);return{37:n,38:n,39:r,40:r,8:t(),46:t(1)}}();CKEDITOR.on("instanceCreated",function(n){function r(){var e=i.getSelection();e&&e.removeAllRanges()}var i=n.editor;i.on("contentDom",function(){function n(){d=new CKEDITOR.dom.selection(i.getSelection()),d.lock()}function r(){u.removeListener("mouseup",r),l.removeListener("mouseup",r);var e=CKEDITOR.document.$.selection,t=e.createRange();e.type!="None"&&t.parentElement().ownerDocument==s.$&&t.select()}var s=i.document,u=CKEDITOR.document,a=i.editable(),f=s.getBody(),l=s.getDocumentElement(),h=a.isInline(),p,d;CKEDITOR.env.gecko&&a.attachListener(a,"focus",function(e){e.removeListener(),p!==0&&(e=i.getSelection().getNative())&&e.isCollapsed&&e.anchorNode==a.$&&(e=i.createRange(),e.moveToElementEditStart(a),e.select())},null,null,-2),a.attachListener(a,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){p&&CKEDITOR.env.webkit&&(p=i._.previousActive&&i._.previousActive.equals(s.getActive())),i.unlockSelection(p),p=0},null,null,-1),a.attachListener(a,"mousedown",function(){p=0});if(CKEDITOR.env.ie||h)g?a.attachListener(a,"beforedeactivate",n,null,null,-1):a.attachListener(i,"selectionCheck",n,null,null,-1),a.attachListener(a,CKEDITOR.env.webkit?"DOMFocusOut":"blur",function(){i.lockSelection(d),p=1},null,null,-1),a.attachListener(a,"mousedown",function(){p=0});if(CKEDITOR.env.ie&&!h){var v;a.attachListener(a,"mousedown",function(e){if(e.data.$.button==2){e=i.document.getSelection();if(!e||e.getType()==CKEDITOR.SELECTION_NONE)v=i.window.getScrollPosition()}}),a.attachListener(a,"mouseup",function(e){e.data.$.button==2&&v&&(i.document.$.documentElement.scrollLeft=v.x,i.document.$.documentElement.scrollTop=v.y),v=null}),s.$.compatMode!="BackCompat"&&((CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&l.on("mousedown",function(e){function t(e){e=e.data.$;if(r){var t=f.$.createTextRange();try{t.moveToPoint(e.clientX,e.clientY)}catch(n){}r.setEndPoint(s.compareEndPoints("StartToStart",t)<0?"EndToEnd":"StartToStart",t),r.select()}}function n(){l.removeListener("mousemove",t),u.removeListener("mouseup",n),l.removeListener("mouseup",n),r.select()}e=e.data;if(e.getTarget().is("html")&&e.$.y<l.$.clientHeight&&e.$.x<l.$.clientWidth){var r=f.$.createTextRange();try{r.moveToPoint(e.$.clientX,e.$.clientY)}catch(i){}var s=r.duplicate();l.on("mousemove",t),u.on("mouseup",n),l.on("mouseup",n)}}),CKEDITOR.env.version>7&&CKEDITOR.env.version<11&&l.on("mousedown",function(e){e.data.getTarget().is("html")&&(u.on("mouseup",r),l.on("mouseup",r))}))}a.attachListener(a,"selectionchange",e,i),a.attachListener(a,"keyup",t,i),a.attachListener(a,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){i.forceNextSelectionCheck(),i.selectionChange(1)});if(h&&(CKEDITOR.env.webkit||CKEDITOR.env.gecko)){var m;a.attachListener(a,"mousedown",function(){m=1}),a.attachListener(s.getDocumentElement(),"mouseup",function(){m&&t.call(i),m=0})}else a.attachListener(CKEDITOR.env.ie?a:s.getDocumentElement(),"mouseup",t,i);CKEDITOR.env.webkit&&a.attachListener(s,"keydown",function(e){switch(e.data.getKey()){case 13:case 33:case 34:case 35:case 36:case 37:case 39:case 8:case 45:case 46:o(a)}},null,null,-1),a.attachListener(a,"keydown",c(i),null,null,-1)}),i.on("setData",function(){i.unlockSelection(),CKEDITOR.env.webkit&&r()}),i.on("contentDomUnload",function(){i.unlockSelection()}),CKEDITOR.env.ie9Compat&&i.on("beforeDestroy",r,null,null,9),i.on("dataReady",function(){delete i._.fakeSelection,delete i._.hiddenSelectionContainer,i.selectionChange(1)}),i.on("loadSnapshot",function(){var e=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT),t=i.editable().getLast(e);t&&t.hasAttribute("data-cke-hidden-sel")&&(t.remove(),CKEDITOR.env.gecko&&(e=i.editable().getFirst(e))&&e.is("br")&&e.getAttribute("_moz_editor_bogus_node")&&e.remove())},null,null,100),i.on("key",function(e){if(i.mode=="wysiwyg"){var t=i.getSelection();if(t.isFake){var n=m[e.data.keyCode];if(n)return n({editor:i,selected:t.getSelectedElement(),selection:t,keyEvent:e})}}})}),CKEDITOR.on("instanceReady",function(e){function t(){var e=r.editable();if(e)if(e=s(e)){var t=r.document.$.getSelection();t.type!="None"&&(t.anchorNode==e.$||t.focusNode==e.$)&&(l=a(t)),i=e.getText(),e.setText(u(i))}}function n(){var e=r.editable();e&&(e=s(e))&&(e.setText(i),l&&(f(r.document.$,l),l=null))}var r=e.editor,i,l;CKEDITOR.env.webkit&&(r.on("selectionChange",function(){var e=r.editable(),t=s(e);t&&(t.getCustomData("ready")?o(e):t.setCustomData("ready",1))},null,null,-1),r.on("beforeSetMode",function(){o(r.editable())},null,null,-1),r.on("beforeUndoImage",t),r.on("afterUndoImage",n),r.on("beforeGetData",t,null,null,0),r.on("getData",n))}),CKEDITOR.editor.prototype.selectionChange=function(n){(n?e:t).call(this)},CKEDITOR.editor.prototype.getSelection=function(e){return(this._.savedSelection||this._.fakeSelection)&&!e?this._.savedSelection||this._.fakeSelection:(e=this.editable())&&this.mode=="wysiwyg"?new CKEDITOR.dom.selection(e):null},CKEDITOR.editor.prototype.lockSelection=function(e){return e=e||this.getSelection(1),e.getType()!=CKEDITOR.SELECTION_NONE?(!e.isLocked&&e.lock(),this._.savedSelection=e,!0):!1},CKEDITOR.editor.prototype.unlockSelection=function(e){var t=this._.savedSelection;return t?(t.unlock(e),delete this._.savedSelection,!0):!1},CKEDITOR.editor.prototype.forceNextSelectionCheck=function(){delete this._.selectionPreviousPath},CKEDITOR.dom.document.prototype.getSelection=function(){return new CKEDITOR.dom.selection(this)},CKEDITOR.dom.range.prototype.select=function(){var e=this.root instanceof CKEDITOR.editable?this.root.editor.getSelection():new CKEDITOR.dom.selection(this.root);return e.selectRanges([this]),e},CKEDITOR.SELECTION_NONE=1,CKEDITOR.SELECTION_TEXT=2,CKEDITOR.SELECTION_ELEMENT=3;var g=typeof window.getSelection!="function",y=1;CKEDITOR.dom.selection=function(e){if(e instanceof CKEDITOR.dom.selection)var t=e,e=e.root;var n=e instanceof CKEDITOR.dom.element;this.rev=t?t.rev:y++,this.document=e instanceof CKEDITOR.dom.document?e:e.getDocument(),this.root=n?e:this.document.getBody(),this.isLocked=0,this._={cache:{}};if(t)return CKEDITOR.tools.extend(this._.cache,t._.cache),this.isFake=t.isFake,this.isLocked=t.isLocked,this;var e=this.getNative(),r,i;if(e)if(e.getRangeAt)r=(i=e.rangeCount&&e.getRangeAt(0))&&new CKEDITOR.dom.node(i.commonAncestorContainer);else{try{i=e.createRange()}catch(s){}r=i&&CKEDITOR.dom.element.get(i.item&&i.item(0)||i.parentElement())}if(!r||r.type!=CKEDITOR.NODE_ELEMENT&&r.type!=CKEDITOR.NODE_TEXT||!this.root.equals(r)&&!this.root.contains(r))this._.cache.type=CKEDITOR.SELECTION_NONE,this._.cache.startElement=null,this._.cache.selectedElement=null,this._.cache.selectedText="",this._.cache.ranges=new CKEDITOR.dom.rangeList;return this};var b={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};CKEDITOR.dom.selection.prototype={getNative:function(){return this._.cache.nativeSel!==void 0?this._.cache.nativeSel:this._.cache.nativeSel=g?this.document.$.selection:this.document.getWindow().$.getSelection()},getType:g?function(){var e=this._.cache;if(e.type)return e.type;var t=CKEDITOR.SELECTION_NONE;try{var n=this.getNative(),r=n.type;r=="Text"&&(t=CKEDITOR.SELECTION_TEXT),r=="Control"&&(t=CKEDITOR.SELECTION_ELEMENT),n.createRange().parentElement()&&(t=CKEDITOR.SELECTION_TEXT)}catch(i){}return e.type=t}:function(){var e=this._.cache;if(e.type)return e.type;var t=CKEDITOR.SELECTION_TEXT,n=this.getNative();if(!n||!n.rangeCount)t=CKEDITOR.SELECTION_NONE;else if(n.rangeCount==1){var n=n.getRangeAt(0),r=n.startContainer;r==n.endContainer&&r.nodeType==1&&n.endOffset-n.startOffset==1&&b[r.childNodes[n.startOffset].nodeName.toLowerCase()]&&(t=CKEDITOR.SELECTION_ELEMENT)}return e.type=t},getRanges:function(){var e=g?function(){function e(e){return(new CKEDITOR.dom.node(e)).getIndex()}var t=function(t,n){t=t.duplicate(),t.collapse(n);var r=t.parentElement();if(!r.hasChildNodes())return{container:r,offset:0};for(var i=r.children,s,o,u=t.duplicate(),a=0,f=i.length-1,l=-1,c,h;a<=f;){l=Math.floor((a+f)/2),s=i[l],u.moveToElementText(s),c=u.compareEndPoints("StartToStart",t);if(c>0)f=l-1;else{if(!(c<0))return{container:r,offset:e(s)};a=l+1}}if(l==-1||l==i.length-1&&c<0){u.moveToElementText(r),u.setEndPoint("StartToStart",t),u=u.text.replace(/(\r\n|\r)/g,"\n").length,i=r.childNodes;if(!u)return s=i[i.length-1],s.nodeType!=CKEDITOR.NODE_TEXT?{container:r,offset:i.length}:{container:s,offset:s.nodeValue.length};for(r=i.length;u>0&&r>0;)o=i[--r],o.nodeType==CKEDITOR.NODE_TEXT&&(h=o,u-=o.nodeValue.length);return{container:h,offset:-u}}u.collapse(c>0?!0:!1),u.setEndPoint(c>0?"StartToStart":"EndToStart",t),u=u.text.replace(/(\r\n|\r)/g,"\n").length;if(!u)return{container:r,offset:e(s)+(c>0?0:1)};for(;u>0;)try{o=s[c>0?"previousSibling":"nextSibling"],o.nodeType==CKEDITOR.NODE_TEXT&&(u-=o.nodeValue.length,h=o),s=o}catch(p){return{container:r,offset:e(s)}}return{container:h,offset:c>0?-u:h.nodeValue.length+u}};return function(){var e=this.getNative(),n=e&&e.createRange(),r=this.getType();if(!e)return[];if(r==CKEDITOR.SELECTION_TEXT)return e=new CKEDITOR.dom.range(this.root),r=t(n,!0),e.setStart(new CKEDITOR.dom.node(r.container),r.offset),r=t(n),e.setEnd(new CKEDITOR.dom.node(r.container),r.offset),e.endContainer.getPosition(e.startContainer)&CKEDITOR.POSITION_PRECEDING&&e.endOffset<=e.startContainer.getIndex()&&e.collapse(),[e];if(r==CKEDITOR.SELECTION_ELEMENT){for(var r=[],i=0;i<n.length;i++){for(var s=n.item(i),o=s.parentNode,u=0,e=new CKEDITOR.dom.range(this.root);u<o.childNodes.length&&o.childNodes[u]!=s;u++);e.setStart(new CKEDITOR.dom.node(o),u),e.setEnd(new CKEDITOR.dom.node(o),u+1),r.push(e)}return r}return[]}}():function(){var e=[],t,n=this.getNative();if(!n)return e;for(var r=0;r<n.rangeCount;r++){var i=n.getRangeAt(r);t=new CKEDITOR.dom.range(this.root),t.setStart(new CKEDITOR.dom.node(i.startContainer),i.startOffset),t.setEnd(new CKEDITOR.dom.node(i.endContainer),i.endOffset),e.push(t)}return e};return function(t){var n=this._.cache,r=n.ranges;return r||(n.ranges=r=new CKEDITOR.dom.rangeList(e.call(this))),t?h(new CKEDITOR.dom.rangeList(r.slice())):r}}(),getStartElement:function(){var e=this._.cache;if(e.startElement!==void 0)return e.startElement;var t;switch(this.getType()){case CKEDITOR.SELECTION_ELEMENT:return this.getSelectedElement();case CKEDITOR.SELECTION_TEXT:var n=this.getRanges()[0];if(n){if(n.collapsed)t=n.startContainer,t.type!=CKEDITOR.NODE_ELEMENT&&(t=t.getParent());else{for(n.optimize();;){t=n.startContainer;if(n.startOffset!=(t.getChildCount?t.getChildCount():t.getLength())||!!t.isBlockBoundary())break;n.setStartAfter(t)}t=n.startContainer;if(t.type!=CKEDITOR.NODE_ELEMENT)return t.getParent();t=t.getChild(n.startOffset);if(!t||t.type!=CKEDITOR.NODE_ELEMENT)t=n.startContainer;else for(n=t.getFirst();n&&n.type==CKEDITOR.NODE_ELEMENT;)t=n,n=n.getFirst()}t=t.$}}return e.startElement=t?new CKEDITOR.dom.element(t):null},getSelectedElement:function(){var e=this._.cache;if(e.selectedElement!==void 0)return e.selectedElement;var t=this,n=CKEDITOR.tools.tryThese(function(){return t.getNative().createRange().item(0)},function(){for(var e=t.getRanges()[0].clone(),n,r,i=2;i&&(!(n=e.getEnclosedNode())||n.type!=CKEDITOR.NODE_ELEMENT||!b[n.getName()]||!(r=n));i--)e.shrink(CKEDITOR.SHRINK_ELEMENT);return r&&r.$});return e.selectedElement=n?new CKEDITOR.dom.element(n):null},getSelectedText:function(){var e=this._.cache;if(e.selectedText!==void 0)return e.selectedText;var t=this.getNative(),t=g?t.type=="Control"?"":t.createRange().text:t.toString();return e.selectedText=t},lock:function(){this.getRanges(),this.getStartElement(),this.getSelectedElement(),this.getSelectedText(),this._.cache.nativeSel=null,this.isLocked=1},unlock:function(e){if(this.isLocked){if(e)var t=this.getSelectedElement(),n=!t&&this.getRanges(),r=this.isFake;this.isLocked=0,this.reset(),e&&(e=t||n[0]&&n[0].getCommonAncestor())&&e.getAscendant("body",1)&&(r?this.fake(t):t?this.selectElement(t):this.selectRanges(n))}},reset:function(){this._.cache={},this.isFake=0;var e=this.root.editor;if(e&&e._.fakeSelection&&this.rev==e._.fakeSelection.rev){delete e._.fakeSelection;var t=e._.hiddenSelectionContainer;if(t){var n=e.checkDirty();e.fire("lockSnapshot"),t.remove(),e.fire("unlockSnapshot"),!n&&e.resetDirty()}delete e._.hiddenSelectionContainer}this.rev=y++},selectElement:function(e){var t=new CKEDITOR.dom.range(this.root);t.setStartBefore(e),t.setEndAfter(e),this.selectRanges([t])},selectRanges:function(e){var t=this.root.editor,t=t&&t._.hiddenSelectionContainer;this.reset();if(t)for(var t=this.root,n,r=0;r<e.length;++r)n=e[r],n.endContainer.equals(t)&&(n.endOffset=Math.min(n.endOffset,t.getChildCount()));if(e.length)if(this.isLocked){var s=CKEDITOR.document.getActive();this.unlock(),this.selectRanges(e),this.lock(),s&&!s.equals(this.root)&&s.focus()}else{var u;e:{var a,f;if(e.length==1&&!(f=e[0]).collapsed&&(u=f.getEnclosedNode())&&u.type==CKEDITOR.NODE_ELEMENT){f=f.clone(),f.shrink(CKEDITOR.SHRINK_ELEMENT,!0),(a=f.getEnclosedNode())&&a.type==CKEDITOR.NODE_ELEMENT&&(u=a);if(u.getAttribute("contenteditable")=="false")break e}u=void 0}if(u)this.fake(u);else{if(g){f=CKEDITOR.dom.walker.whitespaces(!0),a=/\ufeff|\u00a0/,t={table:1,tbody:1,tr:1},e.length>1&&(u=e[e.length-1],e[0].setEnd(u.endContainer,u.endOffset)),u=e[0];var e=u.collapsed,l,c,h;if((n=u.getEnclosedNode())&&n.type==CKEDITOR.NODE_ELEMENT&&n.getName()in b&&(!n.is("a")||!n.getText()))try{h=n.$.createControlRange(),h.addElement(n.$),h.select();return}catch(p){}if(u.startContainer.type==CKEDITOR.NODE_ELEMENT&&u.startContainer.getName()in t||u.endContainer.type==CKEDITOR.NODE_ELEMENT&&u.endContainer.getName()in t)u.shrink(CKEDITOR.NODE_ELEMENT,!0),e=u.collapsed;h=u.createBookmark(),t=h.startNode,e||(s=h.endNode),h=u.document.$.body.createTextRange(),h.moveToElementText(t.$),h.moveStart("character",1),s?(a=u.document.$.body.createTextRange(),a.moveToElementText(s.$),h.setEndPoint("EndToEnd",a),h.moveEnd("character",-1)):(l=t.getNext(f),c=t.hasAscendant("pre"),l=!(l&&l.getText&&l.getText().match(a))&&(c||!t.hasPrevious()||t.getPrevious().is&&t.getPrevious().is("br")),c=u.document.createElement("span"),c.setHtml("&#65279;"),c.insertBefore(t),l&&u.document.createText("﻿").insertBefore(t)),u.setStartBefore(t),t.remove(),e?(l?(h.moveStart("character",-1),h.select(),u.document.$.selection.clear()):h.select(),u.moveToPosition(c,CKEDITOR.POSITION_BEFORE_START),c.remove()):(u.setEndBefore(s),s.remove(),h.select())}else{s=this.getNative();if(!s)return;this.removeAllRanges();for(h=0;h<e.length;h++){if(h<e.length-1){l=e[h],c=e[h+1],a=l.clone(),a.setStart(l.endContainer,l.endOffset),a.setEnd(c.startContainer,c.startOffset);if(!a.collapsed){a.shrink(CKEDITOR.NODE_ELEMENT,!0),u=a.getCommonAncestor(),a=a.getEnclosedNode();if(u.isReadOnly()||a&&a.isReadOnly()){c.setStart(l.startContainer,l.startOffset),e.splice(h--,1);continue}}}u=e[h],c=this.document.$.createRange(),u.collapsed&&CKEDITOR.env.webkit&&i(u)&&(l=this.root,o(l,!1),a=l.getDocument().createText("​"),l.setCustomData("cke-fillingChar",a),u.insertNode(a),(l=a.getNext())&&!a.getPrevious()&&l.type==CKEDITOR.NODE_ELEMENT&&l.getName()=="br"?(o(this.root),u.moveToPosition(l,CKEDITOR.POSITION_BEFORE_START)):u.moveToPosition(a,CKEDITOR.POSITION_AFTER_END)),c.setStart(u.startContainer.$,u.startOffset);try{c.setEnd(u.endContainer.$,u.endOffset)}catch(d){if(!(d.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0))throw d;u.collapse(1),c.setEnd(u.endContainer.$,u.endOffset)}s.addRange(c)}}this.reset(),this.root.fire("selectionchange")}}},fake:function(e){var t=this.root.editor;this.reset(),l(t);var n=this._.cache,r=new CKEDITOR.dom.range(this.root);r.setStartBefore(e),r.setEndAfter(e),n.ranges=new CKEDITOR.dom.rangeList(r),n.selectedElement=n.startElement=e,n.type=CKEDITOR.SELECTION_ELEMENT,n.selectedText=n.nativeSel=null,this.isFake=1,this.rev=y++,t._.fakeSelection=this,this.root.fire("selectionchange")},isHidden:function(){var e=this.getCommonAncestor();return e&&e.type==CKEDITOR.NODE_TEXT&&(e=e.getParent()),!!e&&!!e.data("cke-hidden-sel")},createBookmarks:function(e){return e=this.getRanges().createBookmarks(e),this.isFake&&(e.isFake=1),e},createBookmarks2:function(e){return e=this.getRanges().createBookmarks2(e),this.isFake&&(e.isFake=1),e},selectBookmarks:function(e){for(var t=[],n,r=0;r<e.length;r++){var i=new CKEDITOR.dom.range(this.root);i.moveToBookmark(e[r]),t.push(i)}if(e.isFake){n=t[0].getEnclosedNode();if(!n||n.type!=CKEDITOR.NODE_ELEMENT)e.isFake=0}return e.isFake?this.fake(n):this.selectRanges(t),this},getCommonAncestor:function(){var e=this.getRanges();return e.length?e[0].startContainer.getCommonAncestor(e[e.length-1].endContainer):null},scrollIntoView:function(){this.type!=CKEDITOR.SELECTION_NONE&&this.getRanges()[0].scrollIntoView()},removeAllRanges:function(){if(this.getType()!=CKEDITOR.SELECTION_NONE){var e=this.getNative();try{e&&e[g?"empty":"removeAllRanges"]()}catch(t){}this.reset()}}}}(),"use strict",CKEDITOR.STYLE_BLOCK=1,CKEDITOR.STYLE_INLINE=2,CKEDITOR.STYLE_OBJECT=3,function(){function e(e,t){for(var n,r;e=e.getParent();){if(e.equals(t))break;if(e.getAttribute("data-nostyle"))n=e;else if(!r){var i=e.getAttribute("contentEditable");i=="false"?n=e:i=="true"&&(r=1)}}return n}function t(n){var i=n.document;if(n.collapsed)i=m(this,i),n.insertNode(i),n.moveToPosition(i,CKEDITOR.POSITION_BEFORE_END);else{var s=this.element,o=this._.definition,u,a=o.ignoreReadonly,f=a||o.includeReadonly;f==null&&(f=n.root.getCustomData("cke_includeReadonly"));var l=CKEDITOR.dtd[s];l||(u=!0,l=CKEDITOR.dtd.span),n.enlarge(CKEDITOR.ENLARGE_INLINE,1),n.trim();var c=n.createBookmark(),h=c.startNode,d=c.endNode,v=h,g;if(!a){var y=n.getCommonAncestor(),a=e(h,y),y=e(d,y);a&&(v=a.getNextSourceNode(!0)),y&&(d=y)}for(v.getPosition(d)==CKEDITOR.POSITION_FOLLOWING&&(v=0);v;){a=!1;if(v.equals(d))v=null,a=!0;else{var b=v.type==CKEDITOR.NODE_ELEMENT?v.getName():null,y=b&&v.getAttribute("contentEditable")=="false",w=b&&v.getAttribute("data-nostyle");if(b&&v.data("cke-bookmark")){v=v.getNextSourceNode(!0);continue}if(y&&f&&CKEDITOR.dtd.$block[b])for(var E=v,S=r(E),x=void 0,T=S.length,N=0,E=T&&new CKEDITOR.dom.range(E.getDocument());N<T;++N){var x=S[N],k=CKEDITOR.filter.instances[x.data("cke-filter")];if(k?k.check(this):1)E.selectNodeContents(x),t.call(this,E)}S=b?!l[b]||w?0:y&&!f?0:(v.getPosition(d)|L)==L&&(!o.childRule||o.childRule(v)):1;if(S)if((S=v.getParent())&&((S.getDtd()||CKEDITOR.dtd.span)[s]||u)&&(!o.parentRule||o.parentRule(S))){!g&&(!b||!CKEDITOR.dtd.$removeEmpty[b]||(v.getPosition(d)|L)==L)&&(g=n.clone(),g.setStartBefore(v)),b=v.type;if(b==CKEDITOR.NODE_TEXT||y||b==CKEDITOR.NODE_ELEMENT&&!v.getChildCount()){for(var b=v,O;(a=!b.getNext(C))&&(O=b.getParent(),l[O.getName()])&&(O.getPosition(h)|A)==A&&(!o.childRule||o.childRule(O));)b=O;g.setEndAfter(b)}}else a=!0;else a=!0;v=v.getNextSourceNode(w||y)}if(a&&g&&!g.collapsed){for(var a=m(this,i),y=a.hasAttributes(),w=g.getCommonAncestor(),b={},S={},x={},T={},M,_,D;a&&w;){if(w.getName()==s){for(M in o.attributes)!T[M]&&(D=w.getAttribute(_))&&(a.getAttribute(M)==D?S[M]=1:T[M]=1);for(_ in o.styles)!x[_]&&(D=w.getStyle(_))&&(a.getStyle(_)==D?b[_]=1:x[_]=1)}w=w.getParent()}for(M in S)a.removeAttribute(M);for(_ in b)a.removeStyle(_);y&&!a.hasAttributes()&&(a=null),a?(g.extractContents().appendTo(a),g.insertNode(a),p.call(this,a),a.mergeSiblings(),CKEDITOR.env.ie||a.$.normalize()):(a=new CKEDITOR.dom.element("span"),g.extractContents().appendTo(a),g.insertNode(a),p.call(this,a),a.remove(!0)),g=null}}n.moveToBookmark(c),n.shrink(CKEDITOR.SHRINK_TEXT),n.shrink(CKEDITOR.NODE_ELEMENT,!0)}}function n(e){function t(){for(var e=new CKEDITOR.dom.elementPath(r.getParent()),t=new CKEDITOR.dom.elementPath(f.getParent()),n=null,i=null,s=0;s<e.elements.length;s++){var o=e.elements[s];if(o==e.block||o==e.blockLimit)break;l.checkElementRemovable(o,!0)&&(n=o)}for(s=0;s<t.elements.length;s++){o=t.elements[s];if(o==t.block||o==t.blockLimit)break;l.checkElementRemovable(o,!0)&&(i=o)}i&&f.breakParent(i),n&&r.breakParent(n)}e.enlarge(CKEDITOR.ENLARGE_INLINE,1);var n=e.createBookmark(),r=n.startNode;if(e.collapsed){for(var i=new CKEDITOR.dom.elementPath(r.getParent(),e.root),s,o=0,u;o<i.elements.length&&(u=i.elements[o]);o++){if(u==i.block||u==i.blockLimit)break;if(this.checkElementRemovable(u)){var a;e.collapsed&&(e.checkBoundaryOfElement(u,CKEDITOR.END)||(a=e.checkBoundaryOfElement(u,CKEDITOR.START)))?(s=u,s.match=a?"start":"end"):(u.mergeSiblings(),u.is(this.element)?h.call(this,u):d(u,b(this)[u.getName()]))}}if(s){u=r;for(o=0;;o++){a=i.elements[o];if(a.equals(s))break;if(a.match)continue;a=a.clone(),a.append(u),u=a}u[s.match=="start"?"insertBefore":"insertAfter"](s)}}else{var f=n.endNode,l=this;t();for(i=r;!i.equals(f);)s=i.getNextSourceNode(),i.type==CKEDITOR.NODE_ELEMENT&&this.checkElementRemovable(i)&&(i.getName()==this.element?h.call(this,i):d(i,b(this)[i.getName()]),s.type==CKEDITOR.NODE_ELEMENT&&s.contains(r)&&(t(),s=r.getNext())),i=s}e.moveToBookmark(n),e.shrink(CKEDITOR.NODE_ELEMENT,!0)}function r(e){var t=[];return e.forEach(function(e){if(e.getAttribute("contenteditable")=="true")return t.push(e),!1},CKEDITOR.NODE_ELEMENT,!0),t}function i(e){var t=e.getEnclosedNode()||e.getCommonAncestor(!1,!0);(e=(new CKEDITOR.dom.elementPath(t,e.root)).contains(this.element,1))&&!e.isReadOnly()&&g(e,this)}function s(e){var t=e.getCommonAncestor(!0,!0);if(e=(new CKEDITOR.dom.elementPath(t,e.root)).contains(this.element,1)){var t=this._.definition,n=t.attributes;if(n)for(var r in n)e.removeAttribute(r,n[r]);if(t.styles)for(var i in t.styles)t.styles.hasOwnProperty(i)&&e.removeStyle(i)}}function o(e){var t=e.createBookmark(!0),n=e.createIterator();n.enforceRealBlocks=!0,this._.enterMode&&(n.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR);for(var r,i=e.document,s;r=n.getNextParagraph();)!r.isReadOnly()&&(n.activeFilter?n.activeFilter.check(this):1)&&(s=m(this,i,r),a(r,s));e.moveToBookmark(t)}function u(e){var t=e.createBookmark(1),n=e.createIterator();n.enforceRealBlocks=!0,n.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR;for(var r,i;r=n.getNextParagraph();)this.checkElementRemovable(r)&&(r.is("pre")?((i=this._.enterMode==CKEDITOR.ENTER_BR?null:e.document.createElement(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))&&r.copyAttributes(i),a(r,i)):h.call(this,r));e.moveToBookmark(t)}function a(e,t){var n=!t;n&&(t=e.getDocument().createElement("div"),e.copyAttributes(t));var r=t&&t.is("pre"),i=e.is("pre"),s=!r&&i;if(r&&!i){i=t,(s=e.getBogus())&&s.remove(),s=e.getHtml(),s=l(s,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),s=s.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),s=s.replace(/([ \t\n\r]+|&nbsp;)/g," "),s=s.replace(/<br\b[^>]*>/gi,"\n");if(CKEDITOR.env.ie){var o=e.getDocument().createElement("div");o.append(i),i.$.outerHTML="<pre>"+s+"</pre>",i.copyAttributes(o.getFirst()),i=o.getFirst().remove()}else i.setHtml(s);t=i}else s?t=c(n?[e.getHtml()]:f(e),t):e.moveChildren(t);t.replace(e);if(r){var n=t,u;(u=n.getPrevious(k))&&u.type==CKEDITOR.NODE_ELEMENT&&u.is("pre")&&(r=l(u.getHtml(),/\n$/,"")+"\n\n"+l(n.getHtml(),/^\n/,""),CKEDITOR.env.ie?n.$.outerHTML="<pre>"+r+"</pre>":n.setHtml(r),u.remove())}else n&&v(t)}function f(e){var t=[];return l(e.getOuterHtml(),/(\S\s*)\n(?:\s|(<span[^>]+data-cke-bookmark.*?\/span>))*\n(?!$)/gi,function(e,t,n){return t+"</pre>"+n+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(e,n){t.push(n)}),t}function l(e,t,n){var r="",i="",e=e.replace(/(^<span[^>]+data-cke-bookmark.*?\/span>)|(<span[^>]+data-cke-bookmark.*?\/span>$)/gi,function(e,t,n){return t&&(r=t),n&&(i=n),""});return r+e.replace(t,n)+i}function c(e,t){var n;e.length>1&&(n=new CKEDITOR.dom.documentFragment(t.getDocument()));for(var r=0;r<e.length;r++){var i=e[r],i=i.replace(/(\r\n|\r)/g,"\n"),i=l(i,/^[ \t]*\n/,""),i=l(i,/\n$/,""),i=l(i,/^[ \t]+|[ \t]+$/g,function(e,t){return e.length==1?"&nbsp;":t?" "+CKEDITOR.tools.repeat("&nbsp;",e.length-1):CKEDITOR.tools.repeat("&nbsp;",e.length-1)+" "}),i=i.replace(/\n/g,"<br>"),i=i.replace(/[ \t]{2,}/g,function(e){return CKEDITOR.tools.repeat("&nbsp;",e.length-1)+" "});if(n){var s=t.clone();s.setHtml(i),n.append(s)}else t.setHtml(i)}return n||t}function h(e,t){var n=this._.definition,r=n.attributes,n=n.styles,i=b(this)[e.getName()],s=CKEDITOR.tools.isEmpty(r)&&CKEDITOR.tools.isEmpty(n),o;for(o in r)(o!="class"&&!this._.definition.fullMatch||e.getAttribute(o)==w(o,r[o]))&&(!t||o.slice(0,5)!="data-")&&(s=e.hasAttribute(o),e.removeAttribute(o));for(var u in n)if(!this._.definition.fullMatch||e.getStyle(u)==w(u,n[u],true))s=s||!!e.getStyle(u),e.removeStyle(u);d(e,i,S[e.getName()]),s&&(this._.definition.alwaysRemoveElement?v(e,1):!CKEDITOR.dtd.$block[e.getName()]||this._.enterMode==CKEDITOR.ENTER_BR&&!e.hasAttributes()?v(e):e.renameNode(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))}function p(e){for(var t=b(this),n=e.getElementsByTag(this.element),r,i=n.count();--i>=0;)r=n.getItem(i),r.isReadOnly()||h.call(this,r,!0);for(var s in t)if(s!=this.element){n=e.getElementsByTag(s);for(i=n.count()-1;i>=0;i--)r=n.getItem(i),r.isReadOnly()||d(r,t[s])}}function d(e,t,n){if(t=t&&t.attributes)for(var r=0;r<t.length;r++){var i=t[r][0],s;if(s=e.getAttribute(i)){var o=t[r][1];(o===null||o.test&&o.test(s)||typeof o=="string"&&s==o)&&e.removeAttribute(i)}}n||v(e)}function v(e,t){if(!e.hasAttributes()||t)if(CKEDITOR.dtd.$block[e.getName()]){var n=e.getPrevious(k),r=e.getNext(k);n&&(n.type==CKEDITOR.NODE_TEXT||!n.isBlockBoundary({br:1}))&&e.append("br",1),r&&(r.type==CKEDITOR.NODE_TEXT||!r.isBlockBoundary({br:1}))&&e.append("br"),e.remove(!0)}else n=e.getFirst(),r=e.getLast(),e.remove(!0),n&&(n.type==CKEDITOR.NODE_ELEMENT&&n.mergeSiblings(),r&&!n.equals(r)&&r.type==CKEDITOR.NODE_ELEMENT&&r.mergeSiblings())}function m(e,t,n){var r;return r=e.element,r=="*"&&(r="span"),r=new CKEDITOR.dom.element(r,t),n&&n.copyAttributes(r),r=g(r,e),t.getCustomData("doc_processing_style")&&r.hasAttribute("id")?r.removeAttribute("id"):t.setCustomData("doc_processing_style",1),r}function g(e,t){var n=t._.definition,r=n.attributes,n=CKEDITOR.style.getStyleText(n);if(r)for(var i in r)e.setAttribute(i,r[i]);return n&&e.setAttribute("style",n),e}function y(e,t){for(var n in e)e[n]=e[n].replace(N,function(e,n){return t[n]})}function b(e){if(e._.overrides)return e._.overrides;var t=e._.overrides={},n=e._.definition.overrides;if(n){CKEDITOR.tools.isArray(n)||(n=[n]);for(var r=0;r<n.length;r++){var i=n[r],s,o;typeof i=="string"?s=i.toLowerCase():(s=i.element?i.element.toLowerCase():e.element,o=i.attributes),i=t[s]||(t[s]={});if(o){var i=i.attributes=i.attributes||[],u;for(u in o)i.push([u.toLowerCase(),o[u]])}}}return t}function w(e,t,n){var r=new CKEDITOR.dom.element("span");return r[n?"setStyle":"setAttribute"](e,t),r[n?"getStyle":"getAttribute"](e)}function E(e,t,n){for(var r=e.document,i=e.getRanges(),t=t?this.removeFromRange:this.applyToRange,s,o=i.createIterator();s=o.getNextRange();)t.call(this,s,n);e.selectRanges(i),r.removeCustomData("doc_processing_style")}var S={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,section:1,header:1,footer:1,nav:1,article:1,aside:1,figure:1,dialog:1,hgroup:1,time:1,meter:1,menu:1,command:1,keygen:1,output:1,progress:1,details:1,datagrid:1,datalist:1},x={a:1,blockquote:1,embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1,audio:1,video:1},T=/\s*(?:;\s*|$)/,N=/#\((.+?)\)/g,C=CKEDITOR.dom.walker.bookmark(0,1),k=CKEDITOR.dom.walker.whitespaces(1);CKEDITOR.style=function(e,t){if(typeof e.type=="string")return new CKEDITOR.style.customHandlers[e.type](e);var n=e.attributes;n&&n.style&&(e.styles=CKEDITOR.tools.extend({},e.styles,CKEDITOR.tools.parseCssText(n.style)),delete n.style),t&&(e=CKEDITOR.tools.clone(e),y(e.attributes,t),y(e.styles,t)),n=this.element=e.element?typeof e.element=="string"?e.element.toLowerCase():e.element:"*",this.type=e.type||(S[n]?CKEDITOR.STYLE_BLOCK:x[n]?CKEDITOR.STYLE_OBJECT:CKEDITOR.STYLE_INLINE),typeof this.element=="object"&&(this.type=CKEDITOR.STYLE_OBJECT),this._={definition:e}},CKEDITOR.style.prototype={apply:function(e){if(e instanceof CKEDITOR.dom.document)return E.call(this,e.getSelection());if(this.checkApplicable(e.elementPath(),e)){var t=this._.enterMode;t||(this._.enterMode=e.activeEnterMode),E.call(this,e.getSelection(),0,e),this._.enterMode=t}},remove:function(e){if(e instanceof CKEDITOR.dom.document)return E.call(this,e.getSelection(),1);if(this.checkApplicable(e.elementPath(),e)){var t=this._.enterMode;t||(this._.enterMode=e.activeEnterMode),E.call(this,e.getSelection(),1,e),this._.enterMode=t}},applyToRange:function(e){return this.applyToRange=this.type==CKEDITOR.STYLE_INLINE?t:this.type==CKEDITOR.STYLE_BLOCK?o:this.type==CKEDITOR.STYLE_OBJECT?i:null,this.applyToRange(e)},removeFromRange:function(e){return this.removeFromRange=this.type==CKEDITOR.STYLE_INLINE?n:this.type==CKEDITOR.STYLE_BLOCK?u:this.type==CKEDITOR.STYLE_OBJECT?s:null,this.removeFromRange(e)},applyToObject:function(e){g(e,this)},checkActive:function(e,t){switch(this.type){case CKEDITOR.STYLE_BLOCK:return this.checkElementRemovable(e.block||e.blockLimit,!0,t);case CKEDITOR.STYLE_OBJECT:case CKEDITOR.STYLE_INLINE:for(var n=e.elements,r=0,i;r<n.length;r++){i=n[r];if(this.type!=CKEDITOR.STYLE_INLINE||i!=e.block&&i!=e.blockLimit){if(this.type==CKEDITOR.STYLE_OBJECT){var s=i.getName();if(!(typeof this.element=="string"?s==this.element:s in this.element))continue}if(this.checkElementRemovable(i,!0,t))return!0}}}return!1},checkApplicable:function(e,t,n){t&&t instanceof CKEDITOR.filter&&(n=t);if(n&&!n.check(this))return!1;switch(this.type){case CKEDITOR.STYLE_OBJECT:return!!e.contains(this.element);case CKEDITOR.STYLE_BLOCK:return!!e.blockLimit.getDtd()[this.element]}return!0},checkElementMatch:function(e,t){var n=this._.definition;if(!e||!n.ignoreReadonly&&e.isReadOnly())return!1;var r=e.getName();if(typeof this.element=="string"?r==this.element:r in this.element){if(!t&&!e.hasAttributes())return!0;if(r=n._AC)n=r;else{var r={},i=0,s=n.attributes;if(s)for(var o in s)i++,r[o]=s[o];if(o=CKEDITOR.style.getStyleText(n))r.style||i++,r.style=o;r._length=i,n=n._AC=r}if(!n._length)return!0;for(var u in n)if(u!="_length"){i=e.getAttribute(u)||"";if(u=="style")e:{r=n[u],typeof r=="string"&&(r=CKEDITOR.tools.parseCssText(r)),typeof i=="string"&&(i=CKEDITOR.tools.parseCssText(i,!0)),o=void 0;for(o in r)if(!(o in i)||i[o]!=r[o]&&r[o]!="inherit"&&i[o]!="inherit"){r=!1;break e}r=!0}else r=n[u]==i;if(r){if(!t)return!0}else if(t)return!1}if(t)return!0}return!1},checkElementRemovable:function(e,t,n){if(this.checkElementMatch(e,t,n))return!0;if(t=b(this)[e.getName()]){var r;if(!(t=t.attributes))return!0;for(n=0;n<t.length;n++){r=t[n][0];if(r=e.getAttribute(r)){var i=t[n][1];if(i===null)return!0;if(typeof i=="string"){if(r==i)return!0}else if(i.test(r))return!0}}}return!1},buildPreview:function(e){var t=this._.definition,n=[],r=t.element;r=="bdo"&&(r="span");var n=["<",r],i=t.attributes;if(i)for(var s in i)n.push(" ",s,'="',i[s],'"');return(i=CKEDITOR.style.getStyleText(t))&&n.push(' style="',i,'"'),n.push(">",e||t.name,"</",r,">"),n.join("")},getDefinition:function(){return this._.definition}},CKEDITOR.style.getStyleText=function(e){var t=e._ST;if(t)return t;var t=e.styles,n=e.attributes&&e.attributes.style||"",r="";n.length&&(n=n.replace(T,";"));for(var i in t){var s=t[i],o=(i+":"+s).replace(T,";");s=="inherit"?r+=o:n+=o}return n.length&&(n=CKEDITOR.tools.normalizeCssText(n,!0)),e._ST=n+r},CKEDITOR.style.customHandlers={},CKEDITOR.style.addCustomHandler=function(e){var t=function(e){this._={definition:e},this.setup&&this.setup(e)};return t.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.style.prototype),{assignedTo:CKEDITOR.STYLE_OBJECT},e,!0),this.customHandlers[e.type]=t};var L=CKEDITOR.POSITION_PRECEDING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED,A=CKEDITOR.POSITION_FOLLOWING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED}(),CKEDITOR.styleCommand=function(e,t){this.requiredContent=this.allowedContent=this.style=e,CKEDITOR.tools.extend(this,t,!0)},CKEDITOR.styleCommand.prototype.exec=function(e){e.focus(),this.state==CKEDITOR.TRISTATE_OFF?e.applyStyle(this.style):this.state==CKEDITOR.TRISTATE_ON&&e.removeStyle(this.style)},CKEDITOR.stylesSet=new CKEDITOR.resourceManager("","stylesSet"),CKEDITOR.addStylesSet=CKEDITOR.tools.bind(CKEDITOR.stylesSet.add,CKEDITOR.stylesSet),CKEDITOR.loadStylesSet=function(e,t,n){CKEDITOR.stylesSet.addExternal(e,t,""),CKEDITOR.stylesSet.load(e,n)},CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{attachStyleStateChange:function(e,t){var n=this._.styleStateChangeCallbacks;n||(n=this._.styleStateChangeCallbacks=[],this.on("selectionChange",function(e){for(var t=0;t<n.length;t++){var r=n[t],i=r.style.checkActive(e.data.path,this)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF;r.fn.call(this,i)}})),n.push({style:e,fn:t})},applyStyle:function(e){e.apply(this)},removeStyle:function(e){e.remove(this)},getStylesSet:function(e){if(this._.stylesDefinitions)e(this._.stylesDefinitions);else{var t=this,n=t.config.stylesCombo_stylesSet||t.config.stylesSet;if(n===!1)e(null);else if(n instanceof Array)t._.stylesDefinitions=n,e(n);else{n||(n="default");var n=n.split(":"),r=n[0];CKEDITOR.stylesSet.addExternal(r,n[1]?n.slice(1).join(":"):CKEDITOR.getUrl("styles.js"),""),CKEDITOR.stylesSet.load(r,function(n){t._.stylesDefinitions=n[r],e(t._.stylesDefinitions)})}}}}),CKEDITOR.dom.comment=function(e,t){typeof e=="string"&&(e=(t?t.$:document).createComment(e)),CKEDITOR.dom.domObject.call(this,e)},CKEDITOR.dom.comment.prototype=new CKEDITOR.dom.node,CKEDITOR.tools.extend(CKEDITOR.dom.comment.prototype,{type:CKEDITOR.NODE_COMMENT,getOuterHtml:function(){return"<!--"+this.$.nodeValue+"-->"}}),"use strict",function(){var e={},t={},n;for(n in CKEDITOR.dtd.$blockLimit)n in CKEDITOR.dtd.$list||(e[n]=1);for(n in CKEDITOR.dtd.$block)n in CKEDITOR.dtd.$blockLimit||n in CKEDITOR.dtd.$empty||(t[n]=1);CKEDITOR.dom.elementPath=function(n,r){var i=null,s=null,o=[],u=n,f,r=r||n.getDocument().getBody();do if(u.type==CKEDITOR.NODE_ELEMENT){o.push(u);if(!this.lastElement){this.lastElement=u;if(u.is(CKEDITOR.dtd.$object)||u.getAttribute("contenteditable")=="false")continue}if(u.equals(r))break;if(!s){f=u.getName(),u.getAttribute("contenteditable")=="true"?s=u:!i&&t[f]&&(i=u);if(e[f]){var l;if(l=!i){if(f=f=="div"){e:{f=u.getChildren(),l=0;for(var c=f.count();l<c;l++){var h=f.getItem(l);if(h.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$block[h.getName()]){f=!0;break e}}f=!1}f=!f}l=f}l?i=u:s=u}}}while(u=u.getParent());s||(s=r),this.block=i,this.blockLimit=s,this.root=r,this.elements=o}}(),CKEDITOR.dom.elementPath.prototype={compare:function(e){var t=this.elements,e=e&&e.elements;if(!e||t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0},contains:function(e,t,n){var r;typeof e=="string"&&(r=function(t){return t.getName()==e}),e instanceof CKEDITOR.dom.element?r=function(t){return t.equals(e)}:CKEDITOR.tools.isArray(e)?r=function(t){return CKEDITOR.tools.indexOf(e,t.getName())>-1}:typeof e=="function"?r=e:typeof e=="object"&&(r=function(t){return t.getName()in e});var i=this.elements,s=i.length;t&&s--,n&&(i=Array.prototype.slice.call(i,0),i.reverse());for(t=0;t<s;t++)if(r(i[t]))return i[t];return null},isContextFor:function(e){var t;return e in CKEDITOR.dtd.$block?(t=this.contains(CKEDITOR.dtd.$intermediate)||this.root.equals(this.block)&&this.block||this.blockLimit,!!t.getDtd()[e]):!0},direction:function(){return(this.block||this.blockLimit||this.root).getDirection(1)}},CKEDITOR.dom.text=function(e,t){typeof e=="string"&&(e=(t?t.$:document).createTextNode(e)),this.$=e},CKEDITOR.dom.text.prototype=new CKEDITOR.dom.node,CKEDITOR.tools.extend(CKEDITOR.dom.text.prototype,{type:CKEDITOR.NODE_TEXT,getLength:function(){return this.$.nodeValue.length},getText:function(){return this.$.nodeValue},setText:function(e){this.$.nodeValue=e},split:function(e){var t=this.$.parentNode,n=t.childNodes.length,r=this.getLength(),i=this.getDocument(),s=new CKEDITOR.dom.text(this.$.splitText(e),i);return t.childNodes.length==n&&(e>=r?(s=i.createText(""),s.insertAfter(this)):(e=i.createText(""),e.insertAfter(s),e.remove())),s},substring:function(e,t){return typeof t!="number"?this.$.nodeValue.substr(e):this.$.nodeValue.substring(e,t)}}),function(){function e(e,t,n){var r=e.serializable,i=t[n?"endContainer":"startContainer"],s=n?"endOffset":"startOffset",o=r?t.document.getById(e.startNode):e.startNode,e=r?t.document.getById(e.endNode):e.endNode;return i.equals(o.getPrevious())?(t.startOffset=t.startOffset-i.getLength()-e.getPrevious().getLength(),i=e.getNext()):i.equals(e.getPrevious())&&(t.startOffset=t.startOffset-i.getLength(),i=e.getNext()),i.equals(o.getParent())&&t[s]++,i.equals(e.getParent())&&t[s]++,t[n?"endContainer":"startContainer"]=i,t}CKEDITOR.dom.rangeList=function(e){return e instanceof CKEDITOR.dom.rangeList?e:(e?e instanceof CKEDITOR.dom.range&&(e=[e]):e=[],CKEDITOR.tools.extend(e,t))};var t={createIterator:function(){var e=this,t=CKEDITOR.dom.walker.bookmark(),n=[],r;return{getNextRange:function(i){r=r===void 0?0:r+1;var s=e[r];if(s&&e.length>1){if(!r)for(var o=e.length-1;o>=0;o--)n.unshift(e[o].createBookmark(!0));if(i)for(var u=0;e[r+u+1];){for(var l=s.document,i=0,o=l.getById(n[u].endNode),l=l.getById(n[u+1].startNode);;){o=o.getNextSourceNode(!1);if(l.equals(o))i=1;else if(t(o)||o.type==CKEDITOR.NODE_ELEMENT&&o.isBlockBoundary())continue;break}if(!i)break;u++}for(s.moveToBookmark(n.shift());u--;)o=e[++r],o.moveToBookmark(n.shift()),s.setEnd(o.endContainer,o.endOffset)}return s}}},createBookmarks:function(t){for(var n=[],r,i=0;i<this.length;i++){n.push(r=this[i].createBookmark(t,!0));for(var s=i+1;s<this.length;s++)this[s]=e(r,this[s]),this[s]=e(r,this[s],!0)}return n},createBookmarks2:function(e){for(var t=[],n=0;n<this.length;n++)t.push(this[n].createBookmark2(e));return t},moveToBookmarks:function(e){for(var t=0;t<this.length;t++)this[t].moveToBookmark(e[t])}}}(),function(){function e(){return CKEDITOR.getUrl(CKEDITOR.skinName.split(",")[1]||"skins/"+CKEDITOR.skinName.split(",")[0]+"/")}function t(t){var n=CKEDITOR.skin["ua_"+t],r=CKEDITOR.env;if(n)for(var n=n.split(",").sort(function(e,t){return e>t?-1:1}),i=0,s;i<n.length;i++){s=n[i],r.ie&&(s.replace(/^ie/,"")==r.version||r.quirks&&s=="iequirks")&&(s="ie");if(r[s]){t+="_"+n[i];break}}return CKEDITOR.getUrl(e()+t+".css")}function n(e,n){s[e]||(CKEDITOR.document.appendStyleSheet(t(e)),s[e]=1),n&&n()}function r(e){var t=e.getById(o);return t||(t=e.getHead().append("style"),t.setAttribute("id",o),t.setAttribute("type","text/css")),t}function i(e,t,n){var r,i,s;if(CKEDITOR.env.webkit){t=t.split("}").slice(0,-1);for(i=0;i<t.length;i++)t[i]=t[i].split("{")}for(var o=0;o<e.length;o++)if(CKEDITOR.env.webkit)for(i=0;i<t.length;i++){s=t[i][1];for(r=0;r<n.length;r++)s=s.replace(n[r][0],n[r][1]);e[o].$.sheet.addRule(t[i][0],s)}else{s=t;for(r=0;r<n.length;r++)s=s.replace(n[r][0],n[r][1]);CKEDITOR.env.ie&&CKEDITOR.env.version<11?e[o].$.styleSheet.cssText=e[o].$.styleSheet.cssText+s:e[o].$.innerHTML=e[o].$.innerHTML+s}}var s={};CKEDITOR.skin={path:e,loadPart:function(t,r){CKEDITOR.skin.name!=CKEDITOR.skinName.split(",")[0]?CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(e()+"skin.js"),function(){n(t,r)}):n(t,r)},getPath:function(e){return CKEDITOR.getUrl(t(e))},icons:{},addIcon:function(e,t,n,r){e=e.toLowerCase(),this.icons[e]||(this.icons[e]={path:t,offset:n||0,bgsize:r||"16px"})},getIconStyle:function(e,t,n,r,i){var s;return e&&(e=e.toLowerCase(),t&&(s=this.icons[e+"-rtl"]),s||(s=this.icons[e])),e=n||s&&s.path||"",r=r||s&&s.offset,i=i||s&&s.bgsize||"16px",e&&"background-image:url("+CKEDITOR.getUrl(e)+");background-position:0 "+r+"px;background-size:"+i+";"}},CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{getUiColor:function(){return this.uiColor},setUiColor:function(e){var t=r(CKEDITOR.document);return(this.setUiColor=function(e){this.uiColor=e;var n=CKEDITOR.skin.chameleon,r="",s="";typeof n=="function"&&(r=n(this,"editor"),s=n(this,"panel")),e=[[a,e]],i([t],r,e),i(u,s,e)}).call(this,e)}});var o="cke_ui_color",u=[],a=/\$color/g;CKEDITOR.on("instanceLoaded",function(e){if(!CKEDITOR.env.ie||!CKEDITOR.env.quirks){var t=e.editor,e=function(e){e=(e.data[0]||e.data).element.getElementsByTag("iframe").getItem(0).getFrameDocument();if(!e.getById("cke_ui_color")){e=r(e),u.push(e);var n=t.getUiColor();n&&i([e],CKEDITOR.skin.chameleon(t,"panel"),[[a,n]])}};t.on("panelShow",e),t.on("menuShow",e),t.config.uiColor&&t.setUiColor(t.config.uiColor)}})}(),function(){if(CKEDITOR.env.webkit)CKEDITOR.env.hc=!1;else{var e=CKEDITOR.dom.element.createFromHtml('<div style="width:0;height:0;position:absolute;left:-10000px;border:1px solid;border-color:red blue"></div>',CKEDITOR.document);e.appendTo(CKEDITOR.document.getHead());try{var t=e.getComputedStyle("border-top-color"),n=e.getComputedStyle("border-right-color");CKEDITOR.env.hc=!!t&&t==n}catch(r){CKEDITOR.env.hc=!1}e.remove()}CKEDITOR.env.hc&&(CKEDITOR.env.cssClass=CKEDITOR.env.cssClass+" cke_hc"),CKEDITOR.document.appendStyleText(".cke{visibility:hidden;}"),CKEDITOR.status="loaded",CKEDITOR.fireOnce("loaded");if(e=CKEDITOR._.pending){delete CKEDITOR._.pending;for(t=0;t<e.length;t++)CKEDITOR.editor.prototype.constructor.apply(e[t][0],e[t][1]),CKEDITOR.add(e[t][0])}}(),CKEDITOR.skin.name="moono",CKEDITOR.skin.ua_editor="ie,iequirks,ie7,ie8,gecko",CKEDITOR.skin.ua_dialog="ie,iequirks,ie7,ie8",CKEDITOR.skin.chameleon=function(){var e=function(){return function(e,t){for(var n=e.match(/[^#]./g),r=0;3>r;r++){var i=n,s=r,o;o=parseInt(n[r],16),o=("0"+(0>t?0|o*(1+t):0|o+(255-o)*t).toString(16)).slice(-2),i[s]=o}return"#"+n.join("")}}(),t=function(){var e=new CKEDITOR.template("background:#{to};background-image:linear-gradient(to bottom,{from},{to});filter:progid:DXImageTransform.Microsoft.gradient(gradientType=0,startColorstr='{from}',endColorstr='{to}');");return function(t,n){return e.output({from:t,to:n})}}(),n={editor:new CKEDITOR.template("{id}.cke_chrome [border-color:{defaultBorder};] {id} .cke_top [ {defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_bottom [{defaultGradient}border-top-color:{defaultBorder};] {id} .cke_resizer [border-right-color:{ckeResizer}] {id} .cke_dialog_title [{defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_dialog_footer [{defaultGradient}outline-color:{defaultBorder};border-top-color:{defaultBorder};] {id} .cke_dialog_tab [{lightGradient}border-color:{defaultBorder};] {id} .cke_dialog_tab:hover [{mediumGradient}] {id} .cke_dialog_contents [border-top-color:{defaultBorder};] {id} .cke_dialog_tab_selected, {id} .cke_dialog_tab_selected:hover [background:{dialogTabSelected};border-bottom-color:{dialogTabSelectedBorder};] {id} .cke_dialog_body [background:{dialogBody};border-color:{defaultBorder};] {id} .cke_toolgroup [{lightGradient}border-color:{defaultBorder};] {id} a.cke_button_off:hover, {id} a.cke_button_off:focus, {id} a.cke_button_off:active [{mediumGradient}] {id} .cke_button_on [{ckeButtonOn}] {id} .cke_toolbar_separator [background-color: {ckeToolbarSeparator};] {id} .cke_combo_button [border-color:{defaultBorder};{lightGradient}] {id} a.cke_combo_button:hover, {id} a.cke_combo_button:focus, {id} .cke_combo_on a.cke_combo_button [border-color:{defaultBorder};{mediumGradient}] {id} .cke_path_item [color:{elementsPathColor};] {id} a.cke_path_item:hover, {id} a.cke_path_item:focus, {id} a.cke_path_item:active [background-color:{elementsPathBg};] {id}.cke_panel [border-color:{defaultBorder};] "),panel:new CKEDITOR.template(".cke_panel_grouptitle [{lightGradient}border-color:{defaultBorder};] .cke_menubutton_icon [background-color:{menubuttonIcon};] .cke_menubutton:hover .cke_menubutton_icon, .cke_menubutton:focus .cke_menubutton_icon, .cke_menubutton:active .cke_menubutton_icon [background-color:{menubuttonIconHover};] .cke_menuseparator [background-color:{menubuttonIcon};] a:hover.cke_colorbox, a:focus.cke_colorbox, a:active.cke_colorbox [border-color:{defaultBorder};] a:hover.cke_colorauto, a:hover.cke_colormore, a:focus.cke_colorauto, a:focus.cke_colormore, a:active.cke_colorauto, a:active.cke_colormore [background-color:{ckeColorauto};border-color:{defaultBorder};] ")};return function(r,i){var s=r.uiColor,s={id:"."+r.id,defaultBorder:e(s,-0.1),defaultGradient:t(e(s,.9),s),lightGradient:t(e(s,1),e(s,.7)),mediumGradient:t(e(s,.8),e(s,.5)),ckeButtonOn:t(e(s,.6),e(s,.7)),ckeResizer:e(s,-0.4),ckeToolbarSeparator:e(s,.5),ckeColorauto:e(s,.8),dialogBody:e(s,.7),dialogTabSelected:t("#FFFFFF","#FFFFFF"),dialogTabSelectedBorder:"#FFF",elementsPathColor:e(s,-0.6),elementsPathBg:s,menubuttonIcon:e(s,.5),menubuttonIconHover:e(s,.3)};return n[i].output(s).replace(/\[/g,"{").replace(/\]/g,"}")}}(),CKEDITOR.plugins.add("basicstyles",{init:function(e){var t=0,n=function(n,i,s,o){if(o){var o=new CKEDITOR.style(o),u=r[s];u.unshift(o),e.attachStyleStateChange(o,function(t){!e.readOnly&&e.getCommand(s).setState(t)}),e.addCommand(s,new CKEDITOR.styleCommand(o,{contentForms:u})),e.ui.addButton&&e.ui.addButton(n,{label:i,command:s,toolbar:"basicstyles,"+(t+=10)})}},r={bold:["strong","b",["span",function(e){return e=e.styles["font-weight"],"bold"==e||700<=+e}]],italic:["em","i",["span",function(e){return"italic"==e.styles["font-style"]}]],underline:["u",["span",function(e){return"underline"==e.styles["text-decoration"]}]],strike:["s","strike",["span",function(e){return"line-through"==e.styles["text-decoration"]}]],subscript:["sub"],superscript:["sup"]},i=e.config,s=e.lang.basicstyles;n("Bold",s.bold,"bold",i.coreStyles_bold),n("Italic",s.italic,"italic",i.coreStyles_italic),n("Underline",s.underline,"underline",i.coreStyles_underline),n("Strike",s.strike,"strike",i.coreStyles_strike),n("Subscript",s.subscript,"subscript",i.coreStyles_subscript),n("Superscript",s.superscript,"superscript",i.coreStyles_superscript),e.setKeystroke([[CKEDITOR.CTRL+66,"bold"],[CKEDITOR.CTRL+73,"italic"],[CKEDITOR.CTRL+85,"underline"]])}}),CKEDITOR.config.coreStyles_bold={element:"strong",overrides:"b"},CKEDITOR.config.coreStyles_italic={element:"em",overrides:"i"},CKEDITOR.config.coreStyles_underline={element:"u"},CKEDITOR.config.coreStyles_strike={element:"s",overrides:"strike"},CKEDITOR.config.coreStyles_subscript={element:"sub"},CKEDITOR.config.coreStyles_superscript={element:"sup"},function(){var e={exec:function(e){var t=e.getCommand("blockquote").state,n=e.getSelection(),r=n&&n.getRanges()[0];if(r){var i=n.createBookmarks();if(CKEDITOR.env.ie){var s=i[0].startNode,o=i[0].endNode,u;if(s&&"blockquote"==s.getParent().getName())for(u=s;u=u.getNext();)if(u.type==CKEDITOR.NODE_ELEMENT&&u.isBlockBoundary()){s.move(u,!0);break}if(o&&"blockquote"==o.getParent().getName())for(u=o;u=u.getPrevious();)if(u.type==CKEDITOR.NODE_ELEMENT&&u.isBlockBoundary()){o.move(u);break}}var a=r.createIterator();a.enlargeBr=e.config.enterMode!=CKEDITOR.ENTER_BR;if(t==CKEDITOR.TRISTATE_OFF){for(s=[];t=a.getNextParagraph();)s.push(t);1>s.length&&(t=e.document.createElement(e.config.enterMode==CKEDITOR.ENTER_P?"p":"div"),o=i.shift(),r.insertNode(t),t.append(new CKEDITOR.dom.text("﻿",e.document)),r.moveToBookmark(o),r.selectNodeContents(t),r.collapse(!0),o=r.createBookmark(),s.push(t),i.unshift(o)),u=s[0].getParent(),r=[];for(o=0;o<s.length;o++)t=s[o],u=u.getCommonAncestor(t.getParent());for(t={table:1,tbody:1,tr:1,ol:1,ul:1};t[u.getName()];)u=u.getParent();for(o=null;0<s.length;){for(t=s.shift();!t.getParent().equals(u);)t=t.getParent();t.equals(o)||r.push(t),o=t}for(;0<r.length;)if(t=r.shift(),"blockquote"==t.getName()){for(o=new CKEDITOR.dom.documentFragment(e.document);t.getFirst();)o.append(t.getFirst().remove()),s.push(o.getLast());o.replace(t)}else s.push(t);r=e.document.createElement("blockquote");for(r.insertBefore(s[0]);0<s.length;)t=s.shift(),r.append(t)}else if(t==CKEDITOR.TRISTATE_ON){o=[];for(u={};t=a.getNextParagraph();){for(s=r=null;t.getParent();){if("blockquote"==t.getParent().getName()){r=t.getParent(),s=t;break}t=t.getParent()}r&&s&&!s.getCustomData("blockquote_moveout")&&(o.push(s),CKEDITOR.dom.element.setMarker(u,s,"blockquote_moveout",!0))}CKEDITOR.dom.element.clearAllMarkers(u),t=[],s=[];for(u={};0<o.length;)a=o.shift(),r=a.getParent(),a.getPrevious()?a.getNext()?(a.breakParent(a.getParent()),s.push(a.getNext())):a.remove().insertAfter(r):a.remove().insertBefore(r),r.getCustomData("blockquote_processed")||(s.push(r),CKEDITOR.dom.element.setMarker(u,r,"blockquote_processed",!0)),t.push(a);CKEDITOR.dom.element.clearAllMarkers(u);for(o=s.length-1;0<=o;o--){r=s[o];e:{u=r;for(var a=0,f=u.getChildCount(),l=void 0;a<f&&(l=u.getChild(a));a++)if(l.type==CKEDITOR.NODE_ELEMENT&&l.isBlockBoundary()){u=!1;break e}u=!0}u&&r.remove()}if(e.config.enterMode==CKEDITOR.ENTER_BR)for(r=!0;t.length;)if(a=t.shift(),"div"==a.getName()){o=new CKEDITOR.dom.documentFragment(e.document),r&&a.getPrevious()&&(a.getPrevious().type!=CKEDITOR.NODE_ELEMENT||!a.getPrevious().isBlockBoundary())&&o.append(e.document.createElement("br"));for(r=a.getNext()&&(a.getNext().type!=CKEDITOR.NODE_ELEMENT||!a.getNext().isBlockBoundary());a.getFirst();)a.getFirst().remove().appendTo(o);r&&o.append(e.document.createElement("br")),o.replace(a),r=!1}}n.selectBookmarks(i),e.focus()}},refresh:function(e,t){this.setState(e.elementPath(t.block||t.blockLimit).contains("blockquote",1)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)},context:"blockquote",allowedContent:"blockquote",requiredContent:"blockquote"};CKEDITOR.plugins.add("blockquote",{init:function(t){t.blockless||(t.addCommand("blockquote",e),t.ui.addButton&&t.ui.addButton("Blockquote",{label:t.lang.blockquote.toolbar,command:"blockquote",toolbar:"blocks,10"}))}})}(),CKEDITOR.plugins.add("dialogui",{onLoad:function(){var e=function(e){this._||(this._={}),this._["default"]=this._.initValue=e["default"]||"",this._.required=e.required||!1;for(var t=[this._],n=1;n<arguments.length;n++)t.push(arguments[n]);return t.push(!0),CKEDITOR.tools.extend.apply(CKEDITOR.tools,t),this._},t={build:function(e,t,n){return new CKEDITOR.ui.dialog.textInput(e,t,n)}},n={build:function(e,t,n){return new CKEDITOR.ui.dialog[t.type](e,t,n)}},r={isChanged:function(){return this.getValue()!=this.getInitValue()},reset:function(e){this.setValue(this.getInitValue(),e)},setInitValue:function(){this._.initValue=this.getValue()},resetInitValue:function(){this._.initValue=this._["default"]},getInitValue:function(){return this._.initValue}},i=CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onChange:function(e,t){this._.domOnChangeRegistered||(e.on("load",function(){this.getInputElement().on("change",function(){e.parts.dialog.isVisible()&&this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0),this.on("change",t)}},!0),s=/^on([A-Z]\w+)/,o=function(e){for(var t in e)(s.test(t)||"title"==t||"type"==t)&&delete e[t];return e},u=function(e){e=e.data.getKeystroke(),e==CKEDITOR.SHIFT+CKEDITOR.ALT+36?this.setDirectionMarker("ltr"):e==CKEDITOR.SHIFT+CKEDITOR.ALT+35&&this.setDirectionMarker("rtl")};CKEDITOR.tools.extend(CKEDITOR.ui.dialog,{labeledElement:function(t,n,r,i){if(!(4>arguments.length)){var s=e.call(this,n);s.labelId=CKEDITOR.tools.getNextId()+"_label",this._.children=[];var o={role:n.role||"presentation"};n.includeLabel&&(o["aria-labelledby"]=s.labelId),CKEDITOR.ui.dialog.uiElement.call(this,t,n,r,"div",null,o,function(){var e=[],r=n.required?" cke_required":"";return n.labelLayout!="horizontal"?e.push('<label class="cke_dialog_ui_labeled_label'+r+'" ',' id="'+s.labelId+'"',s.inputId?' for="'+s.inputId+'"':"",(n.labelStyle?' style="'+n.labelStyle+'"':"")+">",n.label,"</label>",'<div class="cke_dialog_ui_labeled_content"',n.controlStyle?' style="'+n.controlStyle+'"':"",' role="presentation">',i.call(this,t,n),"</div>"):(r={type:"hbox",widths:n.widths,padding:0,children:[{type:"html",html:'<label class="cke_dialog_ui_labeled_label'+r+'" id="'+s.labelId+'" for="'+s.inputId+'"'+(n.labelStyle?' style="'+n.labelStyle+'"':"")+">"+CKEDITOR.tools.htmlEncode(n.label)+"</label>"},{type:"html",html:'<span class="cke_dialog_ui_labeled_content"'+(n.controlStyle?' style="'+n.controlStyle+'"':"")+">"+i.call(this,t,n)+"</span>"}]},CKEDITOR.dialog._.uiElementBuilders.hbox.build(t,r,e)),e.join("")})}},textInput:function(t,n,r){if(!(3>arguments.length)){e.call(this,n);var i=this._.inputId=CKEDITOR.tools.getNextId()+"_textInput",s={"class":"cke_dialog_ui_input_"+n.type,id:i,type:n.type};n.validate&&(this.validate=n.validate),n.maxLength&&(s.maxlength=n.maxLength),n.size&&(s.size=n.size),n.inputStyle&&(s.style=n.inputStyle);var o=this,a=!1;t.on("load",function(){o.getInputElement().on("keydown",function(e){e.data.getKeystroke()==13&&(a=!0)}),o.getInputElement().on("keyup",function(e){e.data.getKeystroke()==13&&a&&(t.getButton("ok")&&setTimeout(function(){t.getButton("ok").click()},0),a=!1),o.bidi&&u.call(o,e)},null,null,1e3)}),CKEDITOR.ui.dialog.labeledElement.call(this,t,n,r,function(){var e=['<div class="cke_dialog_ui_input_',n.type,'" role="presentation"'];n.width&&e.push('style="width:'+n.width+'" '),e.push("><input "),s["aria-labelledby"]=this._.labelId,this._.required&&(s["aria-required"]=this._.required);for(var t in s)e.push(t+'="'+s[t]+'" ');return e.push(" /></div>"),e.join("")})}},textarea:function(t,n,r){if(!(3>arguments.length)){e.call(this,n);var i=this,s=this._.inputId=CKEDITOR.tools.getNextId()+"_textarea",o={};n.validate&&(this.validate=n.validate),o.rows=n.rows||5,o.cols=n.cols||20,o["class"]="cke_dialog_ui_input_textarea "+(n["class"]||""),"undefined"!=typeof n.inputStyle&&(o.style=n.inputStyle),n.dir&&(o.dir=n.dir),i.bidi&&t.on("load",function(){i.getInputElement().on("keyup",u)},i),CKEDITOR.ui.dialog.labeledElement.call(this,t,n,r,function(){o["aria-labelledby"]=this._.labelId,this._.required&&(o["aria-required"]=this._.required);var e=['<div class="cke_dialog_ui_input_textarea" role="presentation"><textarea id="',s,'" '],t;for(t in o)e.push(t+'="'+CKEDITOR.tools.htmlEncode(o[t])+'" ');return e.push(">",CKEDITOR.tools.htmlEncode(i._["default"]),"</textarea></div>"),e.join("")})}},checkbox:function(t,n,r){if(!(3>arguments.length)){var i=e.call(this,n,{"default":!!n["default"]});n.validate&&(this.validate=n.validate),CKEDITOR.ui.dialog.uiElement.call(this,t,n,r,"span",null,null,function(){var e=CKEDITOR.tools.extend({},n,{id:n.id?n.id+"_checkbox":CKEDITOR.tools.getNextId()+"_checkbox"},!0),r=[],s=CKEDITOR.tools.getNextId()+"_label",u={"class":"cke_dialog_ui_checkbox_input",type:"checkbox","aria-labelledby":s};return o(e),n["default"]&&(u.checked="checked"),typeof e.inputStyle!="undefined"&&(e.style=e.inputStyle),i.checkbox=new CKEDITOR.ui.dialog.uiElement(t,e,r,"input",null,u),r.push(' <label id="',s,'" for="',u.id,'"'+(n.labelStyle?' style="'+n.labelStyle+'"':"")+">",CKEDITOR.tools.htmlEncode(n.label),"</label>"),r.join("")})}},radio:function(t,n,r){if(!(3>arguments.length)){e.call(this,n),this._["default"]||(this._["default"]=this._.initValue=n.items[0][1]),n.validate&&(this.validate=n.validate);var i=[],s=this;n.role="radiogroup",n.includeLabel=!0,CKEDITOR.ui.dialog.labeledElement.call(this,t,n,r,function(){for(var e=[],r=[],u=(n.id?n.id:CKEDITOR.tools.getNextId())+"_radio",l=0;l<n.items.length;l++){var h=n.items[l],d=h[2]!==void 0?h[2]:h[0],v=h[1]!==void 0?h[1]:h[0],m=CKEDITOR.tools.getNextId()+"_radio_input",g=m+"_label",m=CKEDITOR.tools.extend({},n,{id:m,title:null,type:null},!0),d=CKEDITOR.tools.extend({},m,{title:d},!0),y={type:"radio","class":"cke_dialog_ui_radio_input",name:u,value:v,"aria-labelledby":g},w=[];s._["default"]==v&&(y.checked="checked"),o(m),o(d),typeof m.inputStyle!="undefined"&&(m.style=m.inputStyle),m.keyboardFocusable=!0,i.push(new CKEDITOR.ui.dialog.uiElement(t,m,w,"input",null,y)),w.push(" "),new CKEDITOR.ui.dialog.uiElement(t,d,w,"label",null,{id:g,"for":y.id},h[0]),e.push(w.join(""))}return new CKEDITOR.ui.dialog.hbox(t,i,e,r),r.join("")}),this._.children=i}},button:function(t,n,r){if(arguments.length){"function"==typeof n&&(n=n(t.getParentEditor())),e.call(this,n,{disabled:n.disabled||!1}),CKEDITOR.event.implementOn(this);var i=this;t.on("load",function(){var e=this.getElement();(function(){e.on("click",function(e){i.click(),e.data.preventDefault()}),e.on("keydown",function(e){e.data.getKeystroke()in{32:1}&&(i.click(),e.data.preventDefault())})})(),e.unselectable()},this);var s=CKEDITOR.tools.extend({},n);delete s.style;var o=CKEDITOR.tools.getNextId()+"_label";CKEDITOR.ui.dialog.uiElement.call(this,t,s,r,"a",null,{style:n.style,href:"javascript:void(0)",title:n.label,hidefocus:"true","class":n["class"],role:"button","aria-labelledby":o},'<span id="'+o+'" class="cke_dialog_ui_button">'+CKEDITOR.tools.htmlEncode(n.label)+"</span>")}},select:function(t,n,r){if(!(3>arguments.length)){var i=e.call(this,n);n.validate&&(this.validate=n.validate),i.inputId=CKEDITOR.tools.getNextId()+"_select",CKEDITOR.ui.dialog.labeledElement.call(this,t,n,r,function(){var e=CKEDITOR.tools.extend({},n,{id:n.id?n.id+"_select":CKEDITOR.tools.getNextId()+"_select"},!0),r=[],s=[],u={id:i.inputId,"class":"cke_dialog_ui_input_select","aria-labelledby":this._.labelId};r.push('<div class="cke_dialog_ui_input_',n.type,'" role="presentation"'),n.width&&r.push('style="width:'+n.width+'" '),r.push(">"),n.size!==void 0&&(u.size=n.size),n.multiple!==void 0&&(u.multiple=n.multiple),o(e);for(var l=0,c;l<n.items.length&&(c=n.items[l]);l++)s.push('<option value="',CKEDITOR.tools.htmlEncode(c[1]!==void 0?c[1]:c[0]).replace(/"/g,"&quot;"),'" /> ',CKEDITOR.tools.htmlEncode(c[0]));return typeof e.inputStyle!="undefined"&&(e.style=e.inputStyle),i.select=new CKEDITOR.ui.dialog.uiElement(t,e,r,"select",null,u,s.join("")),r.push("</div>"),r.join("")})}},file:function(t,n,r){if(!(3>arguments.length)){void 0===n["default"]&&(n["default"]="");var i=CKEDITOR.tools.extend(e.call(this,n),{definition:n,buttons:[]});n.validate&&(this.validate=n.validate),t.on("load",function(){CKEDITOR.document.getById(i.frameId).getParent().addClass("cke_dialog_ui_input_file")}),CKEDITOR.ui.dialog.labeledElement.call(this,t,n,r,function(){i.frameId=CKEDITOR.tools.getNextId()+"_fileInput";var e=['<iframe frameborder="0" allowtransparency="0" class="cke_dialog_ui_input_file" role="presentation" id="',i.frameId,'" title="',n.label,'" src="javascript:void('];return e.push(CKEDITOR.env.ie?"(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"})()":"0"),e.push(')"></iframe>'),e.join("")})}},fileButton:function(t,n,r){var i=this;if(!(3>arguments.length)){e.call(this,n),n.validate&&(this.validate=n.validate);var s=CKEDITOR.tools.extend({},n),o=s.onClick;s.className=(s.className?s.className+" ":"")+"cke_dialog_ui_button",s.onClick=function(e){var r=n["for"];if(!o||o.call(this,e)!==!1)t.getContentElement(r[0],r[1]).submit(),this.disable()},t.on("load",function(){t.getContentElement(n["for"][0],n["for"][1])._.buttons.push(i)}),CKEDITOR.ui.dialog.button.call(this,t,s,r)}},html:function(){var e=/^\s*<[\w:]+\s+([^>]*)?>/,t=/^(\s*<[\w:]+(?:\s+[^>]*)?)((?:.|\r|\n)+)$/,n=/\/$/;return function(r,i,s){if(!(3>arguments.length)){var o=[],u=i.html;"<"!=u.charAt(0)&&(u="<span>"+u+"</span>");var f=i.focus;if(f){var l=this.focus;this.focus=function(){("function"==typeof f?f:l).call(this),this.fire("focus")},i.isFocusable&&(this.isFocusable=this.isFocusable),this.keyboardFocusable=!0}CKEDITOR.ui.dialog.uiElement.call(this,r,i,o,"span",null,null,""),o=o.join("").match(e),u=u.match(t)||["","",""],n.test(u[1])&&(u[1]=u[1].slice(0,-1),u[2]="/"+u[2]),s.push([u[1]," ",o[1]||"",u[2]].join(""))}}}(),fieldset:function(e,t,n,r,i){var s=i.label;this._={children:t},CKEDITOR.ui.dialog.uiElement.call(this,e,i,r,"fieldset",null,null,function(){var e=[];s&&e.push("<legend"+(i.labelStyle?' style="'+i.labelStyle+'"':"")+">"+s+"</legend>");for(var t=0;t<n.length;t++)e.push(n[t]);return e.join("")})}},!0),CKEDITOR.ui.dialog.html.prototype=new CKEDITOR.ui.dialog.uiElement,CKEDITOR.ui.dialog.labeledElement.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setLabel:function(e){var t=CKEDITOR.document.getById(this._.labelId);return 1>t.getChildCount()?(new CKEDITOR.dom.text(e,CKEDITOR.document)).appendTo(t):t.getChild(0).$.nodeValue=e,this},getLabel:function(){var e=CKEDITOR.document.getById(this._.labelId);return!e||1>e.getChildCount()?"":e.getChild(0).getText()},eventProcessors:i},!0),CKEDITOR.ui.dialog.button.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{click:function(){return this._.disabled?!1:this.fire("click",{dialog:this._.dialog})},enable:function(){this._.disabled=!1;var e=this.getElement();e&&e.removeClass("cke_disabled")},disable:function(){this._.disabled=!0,this.getElement().addClass("cke_disabled")},isVisible:function(){return this.getElement().getFirst().isVisible()},isEnabled:function(){return!this._.disabled},eventProcessors:CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onClick:function(e,t){this.on("click",function(){t.apply(this,arguments)})}},!0),accessKeyUp:function(){this.click()},accessKeyDown:function(){this.focus()},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.textInput.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return CKEDITOR.document.getById(this._.inputId)},focus:function(){var e=this.selectParentTab();setTimeout(function(){var t=e.getInputElement();t&&t.$.focus()},0)},select:function(){var e=this.selectParentTab();setTimeout(function(){var t=e.getInputElement();t&&(t.$.focus(),t.$.select())},0)},accessKeyUp:function(){this.select()},setValue:function(e){if(this.bidi){var t=e&&e.charAt(0);(t="‪"==t?"ltr":"‫"==t?"rtl":null)&&(e=e.slice(1)),this.setDirectionMarker(t)}return e||(e=""),CKEDITOR.ui.dialog.uiElement.prototype.setValue.apply(this,arguments)},getValue:function(){var e=CKEDITOR.ui.dialog.uiElement.prototype.getValue.call(this);if(this.bidi&&e){var t=this.getDirectionMarker();t&&(e=("ltr"==t?"‪":"‫")+e)}return e},setDirectionMarker:function(e){var t=this.getInputElement();e?t.setAttributes({dir:e,"data-cke-dir-marker":e}):this.getDirectionMarker()&&t.removeAttributes(["dir","data-cke-dir-marker"])},getDirectionMarker:function(){return this.getInputElement().data("cke-dir-marker")},keyboardFocusable:!0},r,!0),CKEDITOR.ui.dialog.textarea.prototype=new CKEDITOR.ui.dialog.textInput,CKEDITOR.ui.dialog.select.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return this._.select.getElement()},add:function(e,t,n){var r=new CKEDITOR.dom.element("option",this.getDialog().getParentEditor().document),i=this.getInputElement().$;return r.$.text=e,r.$.value=void 0===t||null===t?e:t,void 0===n||null===n?CKEDITOR.env.ie?i.add(r.$):i.add(r.$,null):i.add(r.$,n),this},remove:function(e){return this.getInputElement().$.remove(e),this},clear:function(){for(var e=this.getInputElement().$;0<e.length;)e.remove(0);return this},keyboardFocusable:!0},r,!0),CKEDITOR.ui.dialog.checkbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getInputElement:function(){return this._.checkbox.getElement()},setValue:function(e,t){this.getInputElement().$.checked=e,!t&&this.fire("change",{value:e})},getValue:function(){return this.getInputElement().$.checked},accessKeyUp:function(){this.setValue(!this.getValue())},eventProcessors:{onChange:function(e,t){return!CKEDITOR.env.ie||8<CKEDITOR.env.version?i.onChange.apply(this,arguments):(e.on("load",function(){var e=this._.checkbox.getElement();e.on("propertychange",function(t){t=t.data.$,"checked"==t.propertyName&&this.fire("change",{value:e.$.checked})},this)},this),this.on("change",t),null)}},keyboardFocusable:!0},r,!0),CKEDITOR.ui.dialog.radio.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setValue:function(e,t){for(var n=this._.children,r,i=0;i<n.length&&(r=n[i]);i++)r.getElement().$.checked=r.getValue()==e;!t&&this.fire("change",{value:e})},getValue:function(){for(var e=this._.children,t=0;t<e.length;t++)if(e[t].getElement().$.checked)return e[t].getValue();return null},accessKeyUp:function(){var e=this._.children,t;for(t=0;t<e.length;t++)if(e[t].getElement().$.checked){e[t].getElement().focus();return}e[0].getElement().focus()},eventProcessors:{onChange:function(e,t){return CKEDITOR.env.ie?(e.on("load",function(){for(var e=this._.children,t=this,n=0;n<e.length;n++)e[n].getElement().on("propertychange",function(e){e=e.data.$,"checked"==e.propertyName&&this.$.checked&&t.fire("change",{value:this.getAttribute("value")})})},this),this.on("change",t),null):i.onChange.apply(this,arguments)}}},r,!0),CKEDITOR.ui.dialog.file.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,r,{getInputElement:function(){var e=CKEDITOR.document.getById(this._.frameId).getFrameDocument();return 0<e.$.forms.length?new CKEDITOR.dom.element(e.$.forms[0].elements[0]):this.getElement()},submit:function(){return this.getInputElement().getParent().$.submit(),this},getAction:function(){return this.getInputElement().getParent().$.action},registerEvents:function(e){var t=/^on([A-Z]\w+)/,n,r=function(e,t,n,r){e.on("formLoaded",function(){e.getInputElement().on(n,r,e)})},i;for(i in e)if(n=i.match(t))this.eventProcessors[i]?this.eventProcessors[i].call(this,this._.dialog,e[i]):r(this,this._.dialog,n[1].toLowerCase(),e[i]);return this},reset:function(){function e(){n.$.open();var e="";r.size&&(e=r.size-(CKEDITOR.env.ie?7:0));var l=t.frameId+"_input";n.$.write(['<html dir="'+u+'" lang="'+a+'"><head><title></title></head><body style="margin: 0; overflow: hidden; background: transparent;">','<form enctype="multipart/form-data" method="POST" dir="'+u+'" lang="'+a+'" action="',CKEDITOR.tools.htmlEncode(r.action),'"><label id="',t.labelId,'" for="',l,'" style="display:none">',CKEDITOR.tools.htmlEncode(r.label),'</label><input style="width:100%" id="',l,'" aria-labelledby="',t.labelId,'" type="file" name="',CKEDITOR.tools.htmlEncode(r.id||"cke_upload"),'" size="',CKEDITOR.tools.htmlEncode(0<e?e:""),'" /></form></body></html><script>',CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"","window.parent.CKEDITOR.tools.callFunction("+s+");","window.onbeforeunload = function() {window.parent.CKEDITOR.tools.callFunction("+o+")}","</script>"].join("")),n.$.close();for(e=0;e<i.length;e++)i[e].enable()}var t=this._,n=CKEDITOR.document.getById(t.frameId).getFrameDocument(),r=t.definition,i=t.buttons,s=this.formLoadedNumber,o=this.formUnloadNumber,u=t.dialog._.editor.lang.dir,a=t.dialog._.editor.langCode;s||(s=this.formLoadedNumber=CKEDITOR.tools.addFunction(function(){this.fire("formLoaded")},this),o=this.formUnloadNumber=CKEDITOR.tools.addFunction(function(){this.getInputElement().clearCustomData()},this),this.getDialog()._.editor.on("destroy",function(){CKEDITOR.tools.removeFunction(s),CKEDITOR.tools.removeFunction(o)})),CKEDITOR.env.gecko?setTimeout(e,500):e()},getValue:function(){return this.getInputElement().$.value||""},setInitValue:function(){this._.initValue=""},eventProcessors:{onChange:function(e,t){this._.domOnChangeRegistered||(this.on("formLoaded",function(){this.getInputElement().on("change",function(){this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0),this.on("change",t)}},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.fileButton.prototype=new CKEDITOR.ui.dialog.button,CKEDITOR.ui.dialog.fieldset.prototype=CKEDITOR.tools.clone(CKEDITOR.ui.dialog.hbox.prototype),CKEDITOR.dialog.addUIElement("text",t),CKEDITOR.dialog.addUIElement("password",t),CKEDITOR.dialog.addUIElement("textarea",n),CKEDITOR.dialog.addUIElement("checkbox",n),CKEDITOR.dialog.addUIElement("radio",n),CKEDITOR.dialog.addUIElement("button",n),CKEDITOR.dialog.addUIElement("select",n),CKEDITOR.dialog.addUIElement("file",n),CKEDITOR.dialog.addUIElement("fileButton",n),CKEDITOR.dialog.addUIElement("html",n),CKEDITOR.dialog.addUIElement("fieldset",{build:function(e,t,n){for(var r=t.children,i,s=[],o=[],u=0;u<r.length&&(i=r[u]);u++){var a=[];s.push(a),o.push(CKEDITOR.dialog._.uiElementBuilders[i.type].build(e,i,a))}return new CKEDITOR.ui.dialog[t.type](e,o,s,n,t)}})}}),CKEDITOR.DIALOG_RESIZE_NONE=0,CKEDITOR.DIALOG_RESIZE_WIDTH=1,CKEDITOR.DIALOG_RESIZE_HEIGHT=2,CKEDITOR.DIALOG_RESIZE_BOTH=3,CKEDITOR.DIALOG_STATE_IDLE=1,CKEDITOR.DIALOG_STATE_BUSY=2,function(){function e(){for(var e=this._.tabIdList.length,t=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId)+e,n=t-1;n>t-e;n--)if(this._.tabs[this._.tabIdList[n%e]][0].$.offsetHeight)return this._.tabIdList[n%e];return null}function t(){for(var e=this._.tabIdList.length,t=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId),n=t+1;n<t+e;n++)if(this._.tabs[this._.tabIdList[n%e]][0].$.offsetHeight)return this._.tabIdList[n%e];return null}function n(e,t){for(var n=e.$.getElementsByTagName("input"),r=0,i=n.length;r<i;r++){var s=new CKEDITOR.dom.element(n[r]);"text"==s.getAttribute("type").toLowerCase()&&(t?(s.setAttribute("value",s.getCustomData("fake_value")||""),s.removeCustomData("fake_value")):(s.setCustomData("fake_value",s.getAttribute("value")),s.setAttribute("value","")))}}function r(e,t){var n=this.getInputElement();n&&(e?n.removeAttribute("aria-invalid"):n.setAttribute("aria-invalid",!0)),e||(this.select?this.select():this.focus()),t&&alert(t),this.fire("validated",{valid:e,msg:t})}function i(){var e=this.getInputElement();e&&e.removeAttribute("aria-invalid")}function s(e){var t=CKEDITOR.dom.element.createFromHtml(CKEDITOR.addTemplate("dialog",v).output({id:CKEDITOR.tools.getNextNumber(),editorId:e.id,langDir:e.lang.dir,langCode:e.langCode,editorDialogClass:"cke_editor_"+e.name.replace(/\./g,"\\.")+"_dialog",closeTitle:e.lang.common.close,hidpi:CKEDITOR.env.hidpi?"cke_hidpi":""})),n=t.getChild([0,0,0,0,0]),r=n.getChild(0),i=n.getChild(1);return e.plugins.clipboard&&CKEDITOR.plugins.clipboard.preventDefaultDropOnElement(n),CKEDITOR.env.ie&&!CKEDITOR.env.quirks&&!CKEDITOR.env.edge&&(e="javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())",CKEDITOR.dom.element.createFromHtml('<iframe frameBorder="0" class="cke_iframe_shim" src="'+e+'" tabIndex="-1"></iframe>').appendTo(n.getParent())),r.unselectable(),i.unselectable(),{element:t,parts:{dialog:t.getChild(0),title:r,close:i,tabs:n.getChild(2),contents:n.getChild([3,0,0,0]),footer:n.getChild([3,0,1,0])}}}function o(e,t,n){this.element=t,this.focusIndex=n,this.tabIndex=0,this.isFocusable=function(){return!t.getAttribute("disabled")&&t.isVisible()},this.focus=function(){e._.currentFocusIndex=this.focusIndex,this.element.focus()},t.on("keydown",function(e){e.data.getKeystroke()in{32:1,13:1}&&this.fire("click")}),t.on("focus",function(){this.fire("mouseover")}),t.on("blur",function(){this.fire("mouseout")})}function u(e){function t(){e.layout()}var n=CKEDITOR.document.getWindow();n.on("resize",t),e.on("hide",function(){n.removeListener("resize",t)})}function a(e,t){this._={dialog:e},CKEDITOR.tools.extend(this,t)}function f(e){function t(t){var n=e.getSize(),a=CKEDITOR.document.getWindow().getViewPaneSize(),f=t.data.$.screenX,l=t.data.$.screenY,c=f-r.x,h=l-r.y;r={x:f,y:l},i.x+=c,i.y+=h,e.move(i.x+u[3]<o?-u[3]:i.x-u[1]>a.width-n.width-o?a.width-n.width+("rtl"==s.lang.dir?0:u[1]):i.x,i.y+u[0]<o?-u[0]:i.y-u[2]>a.height-n.height-o?a.height-n.height+u[2]:i.y,1),t.data.preventDefault()}function n(){CKEDITOR.document.removeListener("mousemove",t),CKEDITOR.document.removeListener("mouseup",n);if(CKEDITOR.env.ie6Compat){var e=x.getChild(0).getFrameDocument();e.removeListener("mousemove",t),e.removeListener("mouseup",n)}}var r=null,i=null,s=e.getParentEditor(),o=s.config.dialog_magnetDistance,u=CKEDITOR.skin.margins||[0,0,0,0];"undefined"==typeof o&&(o=20),e.parts.title.on("mousedown",function(s){r={x:s.data.$.screenX,y:s.data.$.screenY},CKEDITOR.document.on("mousemove",t),CKEDITOR.document.on("mouseup",n),i=e.getPosition();if(CKEDITOR.env.ie6Compat){var o=x.getChild(0).getFrameDocument();o.on("mousemove",t),o.on("mouseup",n)}s.data.preventDefault()},e)}function l(e){function r(r){var i="rtl"==u.lang.dir,h=c.width,p=c.height,d=h+(r.data.$.screenX-t)*(i?-1:1)*(e._.moved?1:2),v=p+(r.data.$.screenY-n)*(e._.moved?1:2),m=e._.element.getFirst(),m=i&&m.getComputedStyle("right"),g=e.getPosition();g.y+v>l.height&&(v=l.height-g.y),(i?m:g.x)+d>l.width&&(d=l.width-(i?m:g.x));if(o==CKEDITOR.DIALOG_RESIZE_WIDTH||o==CKEDITOR.DIALOG_RESIZE_BOTH)h=Math.max(s.minWidth||0,d-a);if(o==CKEDITOR.DIALOG_RESIZE_HEIGHT||o==CKEDITOR.DIALOG_RESIZE_BOTH)p=Math.max(s.minHeight||0,v-f);e.resize(h,p),e._.moved||e.layout(),r.data.preventDefault()}function i(){CKEDITOR.document.removeListener("mouseup",i),CKEDITOR.document.removeListener("mousemove",r),h&&(h.remove(),h=null);if(CKEDITOR.env.ie6Compat){var e=x.getChild(0).getFrameDocument();e.removeListener("mouseup",i),e.removeListener("mousemove",r)}}var t,n,s=e.definition,o=s.resizable;if(o!=CKEDITOR.DIALOG_RESIZE_NONE){var u=e.getParentEditor(),a,f,l,c,h,p=CKEDITOR.tools.addFunction(function(s){c=e.getSize();var o=e.parts.contents;o.$.getElementsByTagName("iframe").length&&(h=CKEDITOR.dom.element.createFromHtml('<div class="cke_dialog_resize_cover" style="height: 100%; position: absolute; width: 100%;"></div>'),o.append(h)),f=c.height-e.parts.contents.getSize("height",!(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.quirks)),a=c.width-e.parts.contents.getSize("width",1),t=s.screenX,n=s.screenY,l=CKEDITOR.document.getWindow().getViewPaneSize(),CKEDITOR.document.on("mousemove",r),CKEDITOR.document.on("mouseup",i),CKEDITOR.env.ie6Compat&&(o=x.getChild(0).getFrameDocument(),o.on("mousemove",r),o.on("mouseup",i)),s.preventDefault&&s.preventDefault()});e.on("load",function(){var t="";o==CKEDITOR.DIALOG_RESIZE_WIDTH?t=" cke_resizer_horizontal":o==CKEDITOR.DIALOG_RESIZE_HEIGHT&&(t=" cke_resizer_vertical"),t=CKEDITOR.dom.element.createFromHtml('<div class="cke_resizer'+t+" cke_resizer_"+u.lang.dir+'" title="'+CKEDITOR.tools.htmlEncode(u.lang.common.resize)+'" onmousedown="CKEDITOR.tools.callFunction('+p+', event )">'+("ltr"==u.lang.dir?"◢":"◣")+"</div>"),e.parts.footer.append(t,1)}),u.on("destroy",function(){CKEDITOR.tools.removeFunction(p)})}}function c(e){e.data.preventDefault(1)}function h(e){var t=CKEDITOR.document.getWindow(),n=e.config,r=n.dialog_backgroundCoverColor||"white",i=n.dialog_backgroundCoverOpacity,s=n.baseFloatZIndex,n=CKEDITOR.tools.genKey(r,i,s),o=S[n];o?o.show():(s=['<div tabIndex="-1" style="position: ',CKEDITOR.env.ie6Compat?"absolute":"fixed","; z-index: ",s,"; top: 0px; left: 0px; ",CKEDITOR.env.ie6Compat?"":"background-color: "+r,'" class="cke_dialog_background_cover">'],CKEDITOR.env.ie6Compat&&(r="<html><body style=\\'background-color:"+r+";\\'></body></html>",s.push('<iframe hidefocus="true" frameborder="0" id="cke_dialog_background_iframe" src="javascript:'),s.push("void((function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.write( '"+r+"' );document.close();")+"})())"),s.push('" style="position:absolute;left:0;top:0;width:100%;height: 100%;filter: progid:DXImageTransform.Microsoft.Alpha(opacity=0)"></iframe>')),s.push("</div>"),o=CKEDITOR.dom.element.createFromHtml(s.join("")),o.setOpacity(void 0!==i?i:.5),o.on("keydown",c),o.on("keypress",c),o.on("keyup",c),o.appendTo(CKEDITOR.document.getBody()),S[n]=o),e.focusManager.add(o),x=o;var e=function(){var e=t.getViewPaneSize();o.setStyles({width:e.width+"px",height:e.height+"px"})},u=function(){var e=t.getScrollPosition(),n=CKEDITOR.dialog._.currentTop;o.setStyles({left:e.x+"px",top:e.y+"px"});if(n)do e=n.getPosition(),n.move(e.x,e.y);while(n=n._.parentDialog)};E=e,t.on("resize",e),e(),(!CKEDITOR.env.mac||!CKEDITOR.env.webkit)&&o.focus();if(CKEDITOR.env.ie6Compat){var a=function(){u(),arguments.callee.prevScrollHandler.apply(this,arguments)};t.$.setTimeout(function(){a.prevScrollHandler=window.onscroll||function(){},window.onscroll=a},0),u()}}function p(e){x&&(e.focusManager.remove(x),e=CKEDITOR.document.getWindow(),x.hide(),e.removeListener("resize",E),CKEDITOR.env.ie6Compat&&e.$.setTimeout(function(){window.onscroll=window.onscroll&&window.onscroll.prevScrollHandler||null},0),E=null)}var d=CKEDITOR.tools.cssLength,v='<div class="cke_reset_all {editorId} {editorDialogClass} {hidpi}" dir="{langDir}" lang="{langCode}" role="dialog" aria-labelledby="cke_dialog_title_{id}"><table class="cke_dialog '+CKEDITOR.env.cssClass+' cke_{langDir}" style="position:absolute" role="presentation"><tr><td role="presentation"><div class="cke_dialog_body" role="presentation"><div id="cke_dialog_title_{id}" class="cke_dialog_title" role="presentation"></div><a id="cke_dialog_close_button_{id}" class="cke_dialog_close_button" href="javascript:void(0)" title="{closeTitle}" role="button"><span class="cke_label">X</span></a><div id="cke_dialog_tabs_{id}" class="cke_dialog_tabs" role="tablist"></div><table class="cke_dialog_contents" role="presentation"><tr><td id="cke_dialog_contents_{id}" class="cke_dialog_contents_body" role="presentation"></td></tr><tr><td id="cke_dialog_footer_{id}" class="cke_dialog_footer" role="presentation"></td></tr></table></div></td></tr></table></div>';CKEDITOR.dialog=function(n,o){function u(){var e=x._.focusList;e.sort(function(e,t){return e.tabIndex!=t.tabIndex?t.tabIndex-e.tabIndex:e.focusIndex-t.focusIndex});for(var t=e.length,n=0;n<t;n++)e[n].focusIndex=n}function a(e){var t=x._.focusList,e=e||0;if(!(1>t.length)){var n=x._.currentFocusIndex;x._.tabBarMode&&0>e&&(n=0);try{t[n].getInputElement().$.blur()}catch(r){}var i=n,s=1<x._.pageCount;do{i+=e;if(s&&!x._.tabBarMode&&(i==t.length||-1==i)){x._.tabBarMode=!0,x._.tabs[x._.currentTabId][0].focus(),x._.currentFocusIndex=-1;return}i=(i+t.length)%t.length;if(i==n)break}while(e&&!t[i].isFocusable());t[i].focus(),"text"==t[i].type&&t[i].select()}}function c(r){if(x==CKEDITOR.dialog._.currentTop){var i=r.data.getKeystroke(),s="rtl"==n.lang.dir,o=[37,38,39,40];b=E=0;if(9==i||i==CKEDITOR.SHIFT+9)a(i==CKEDITOR.SHIFT+9?-1:1),b=1;else if(i==CKEDITOR.ALT+121&&!x._.tabBarMode&&1<x.getPageCount())x._.tabBarMode=!0,x._.tabs[x._.currentTabId][0].focus(),x._.currentFocusIndex=-1,b=1;else if(-1!=CKEDITOR.tools.indexOf(o,i)&&x._.tabBarMode)i=-1!=CKEDITOR.tools.indexOf([s?39:37,38],i)?e.call(x):t.call(x),x.selectPage(i),x._.tabs[i][0].focus(),b=1;else if(13!=i&&32!=i||!x._.tabBarMode)if(13==i)i=r.data.getTarget(),!i.is("a","button","select","textarea")&&(!i.is("input")||"button"!=i.$.type)&&((i=this.getButton("ok"))&&CKEDITOR.tools.setTimeout(i.click,0,i),b=1),E=1;else{if(27!=i)return;(i=this.getButton("cancel"))?CKEDITOR.tools.setTimeout(i.click,0,i):!1!==this.fire("cancel",{hide:!0}).hide&&this.hide(),E=1}else this.selectPage(this._.currentTabId),this._.tabBarMode=!1,this._.currentFocusIndex=-1,a(1),b=1;h(r)}}function h(e){b?e.data.preventDefault(1):E&&e.data.stopPropagation()}var p=CKEDITOR.dialog._.dialogDefinitions[o],d=CKEDITOR.tools.clone(m),v=n.config.dialog_buttonsOrder||"OS",g=n.lang.dir,y={},b,E;("OS"==v&&CKEDITOR.env.mac||"rtl"==v&&"ltr"==g||"ltr"==v&&"rtl"==g)&&d.buttons.reverse(),p=CKEDITOR.tools.extend(p(n),d),p=CKEDITOR.tools.clone(p),p=new w(this,p),d=s(n),this._={editor:n,element:d.element,name:o,contentSize:{width:0,height:0},size:{width:0,height:0},contents:{},buttons:{},accessKeyMap:{},tabs:{},tabIdList:[],currentTabId:null,currentTabIndex:null,pageCount:0,lastTab:null,tabBarMode:!1,focusList:[],currentFocusIndex:0,hasFocus:!1},this.parts=d.parts,CKEDITOR.tools.setTimeout(function(){n.fire("ariaWidget",this.parts.contents)},0,this),d={position:CKEDITOR.env.ie6Compat?"absolute":"fixed",top:0,visibility:"hidden"},d["rtl"==g?"right":"left"]=0,this.parts.dialog.setStyles(d),CKEDITOR.event.call(this),this.definition=p=CKEDITOR.fire("dialogDefinition",{name:o,definition:p},n).definition;if(!("removeDialogTabs"in n._)&&n.config.removeDialogTabs){d=n.config.removeDialogTabs.split(";");for(g=0;g<d.length;g++)if(v=d[g].split(":"),2==v.length){var S=v[0];y[S]||(y[S]=[]),y[S].push(v[1])}n._.removeDialogTabs=y}if(n._.removeDialogTabs&&(y=n._.removeDialogTabs[o]))for(g=0;g<y.length;g++)p.removeContents(y[g]);p.onLoad&&this.on("load",p.onLoad),p.onShow&&this.on("show",p.onShow),p.onHide&&this.on("hide",p.onHide),p.onOk&&this.on("ok",function(e){n.fire("saveSnapshot"),setTimeout(function(){n.fire("saveSnapshot")},0),!1===p.onOk.call(this,e)&&(e.data.hide=!1)}),this.state=CKEDITOR.DIALOG_STATE_IDLE,p.onCancel&&this.on("cancel",function(e){!1===p.onCancel.call(this,e)&&(e.data.hide=!1)});var x=this,T=function(e){var t=x._.contents,n=!1,r;for(r in t)for(var i in t[r])if(n=e.call(this,t[r][i]))return};this.on("ok",function(e){T(function(t){if(t.validate){var n=t.validate(this),i="string"==typeof n||!1===n;return i&&(e.data.hide=!1,e.stop()),r.call(t,!i,"string"==typeof n?n:void 0),i}})},this,null,0),this.on("cancel",function(e){T(function(t){if(t.isChanged())return!n.config.dialog_noConfirmCancel&&!confirm(n.lang.common.confirmCancel)&&(e.data.hide=!1),!0})},this,null,0),this.parts.close.on("click",function(e){!1!==this.fire("cancel",{hide:!0}).hide&&this.hide(),e.data.preventDefault()},this),this.changeFocus=a;var N=this._.element;n.focusManager.add(N,1),this.on("show",function(){N.on("keydown",c,this),CKEDITOR.env.gecko&&N.on("keypress",h,this)}),this.on("hide",function(){N.removeListener("keydown",c),CKEDITOR.env.gecko&&N.removeListener("keypress",h),T(function(e){i.apply(e)})}),this.on("iframeAdded",function(e){(new CKEDITOR.dom.document(e.data.iframe.$.contentWindow.document)).on("keydown",c,this,null,0)}),this.on("show",function(){u();var e=1<x._.pageCount;n.config.dialog_startupFocusTab&&e?(x._.tabBarMode=!0,x._.tabs[x._.currentTabId][0].focus(),x._.currentFocusIndex=-1):this._.hasFocus||(this._.currentFocusIndex=e?-1:this._.focusList.length-1,p.onFocus?(e=p.onFocus.call(this))&&e.focus():a(1))},this,null,4294967295),CKEDITOR.env.ie6Compat&&this.on("load",function(){var e=this.getElement(),t=e.getFirst();t.remove(),t.appendTo(e)},this),f(this),l(this),(new CKEDITOR.dom.text(p.title,CKEDITOR.document)).appendTo(this.parts.title);for(g=0;g<p.contents.length;g++)(y=p.contents[g])&&this.addPage(y);this.parts.tabs.on("click",function(e){var t=e.data.getTarget();t.hasClass("cke_dialog_tab")&&(t=t.$.id,this.selectPage(t.substring(4,t.lastIndexOf("_"))),this._.tabBarMode&&(this._.tabBarMode=!1,this._.currentFocusIndex=-1,a(1)),e.data.preventDefault())},this),g=[],y=CKEDITOR.dialog._.uiElementBuilders.hbox.build(this,{type:"hbox",className:"cke_dialog_footer_buttons",widths:[],children:p.buttons},g).getChild(),this.parts.footer.setHtml(g.join(""));for(g=0;g<y.length;g++)this._.buttons[y[g].id]=y[g]},CKEDITOR.dialog.prototype={destroy:function(){this.hide(),this._.element.remove()},resize:function(){return function(e,t){if(!this._.contentSize||this._.contentSize.width!=e||this._.contentSize.height!=t)CKEDITOR.dialog.fire("resize",{dialog:this,width:e,height:t},this._.editor),this.fire("resize",{width:e,height:t},this._.editor),this.parts.contents.setStyles({width:e+"px",height:t+"px"}),"rtl"==this._.editor.lang.dir&&this._.position&&(this._.position.x=CKEDITOR.document.getWindow().getViewPaneSize().width-this._.contentSize.width-parseInt(this._.element.getFirst().getStyle("right"),10)),this._.contentSize={width:e,height:t}}}(),getSize:function(){var e=this._.element.getFirst();return{width:e.$.offsetWidth||0,height:e.$.offsetHeight||0}},move:function(e,t,n){var r=this._.element.getFirst(),i="rtl"==this._.editor.lang.dir,s="fixed"==r.getComputedStyle("position");CKEDITOR.env.ie&&r.setStyle("zoom","100%");if(!s||!this._.position||this._.position.x!=e||this._.position.y!=t)this._.position={x:e,y:t},s||(s=CKEDITOR.document.getWindow().getScrollPosition(),e+=s.x,t+=s.y),i&&(s=this.getSize(),e=CKEDITOR.document.getWindow().getViewPaneSize().width-s.width-e),t={top:(0<t?t:0)+"px"},t[i?"right":"left"]=(0<e?e:0)+"px",r.setStyles(t),n&&(this._.moved=1)},getPosition:function(){return CKEDITOR.tools.extend({},this._.position)},show:function(){var e=this._.element,t=this.definition;!e.getParent()||!e.getParent().equals(CKEDITOR.document.getBody())?e.appendTo(CKEDITOR.document.getBody()):e.setStyle("display","block"),this.resize(this._.contentSize&&this._.contentSize.width||t.width||t.minWidth,this._.contentSize&&this._.contentSize.height||t.height||t.minHeight),this.reset(),this.selectPage(this.definition.contents[0].id),null===CKEDITOR.dialog._.currentZIndex&&(CKEDITOR.dialog._.currentZIndex=this._.editor.config.baseFloatZIndex),this._.element.getFirst().setStyle("z-index",CKEDITOR.dialog._.currentZIndex+=10),null===CKEDITOR.dialog._.currentTop?(CKEDITOR.dialog._.currentTop=this,this._.parentDialog=null,h(this._.editor)):(this._.parentDialog=CKEDITOR.dialog._.currentTop,this._.parentDialog.getElement().getFirst().$.style.zIndex-=Math.floor(this._.editor.config.baseFloatZIndex/2),CKEDITOR.dialog._.currentTop=this),e.on("keydown",N),e.on("keyup",C),this._.hasFocus=!1;for(var n in t.contents)if(t.contents[n]){var e=t.contents[n],r=this._.tabs[e.id],i=e.requiredContent,s=0;if(r){for(var o in this._.contents[e.id]){var a=this._.contents[e.id][o];"hbox"==a.type||"vbox"==a.type||!a.getInputElement()||(a.requiredContent&&!this._.editor.activeFilter.check(a.requiredContent)?a.disable():(a.enable(),s++))}!s||i&&!this._.editor.activeFilter.check(i)?r[0].addClass("cke_dialog_tab_disabled"):r[0].removeClass("cke_dialog_tab_disabled")}}CKEDITOR.tools.setTimeout(function(){this.layout(),u(this),this.parts.dialog.setStyle("visibility",""),this.fireOnce("load",{}),CKEDITOR.ui.fire("ready",this),this.fire("show",{}),this._.editor.fire("dialogShow",this),this._.parentDialog||this._.editor.focusManager.lock(),this.foreach(function(e){e.setInitValue&&e.setInitValue()})},100,this)},layout:function(){var e=this.parts.dialog,t=this.getSize(),n=CKEDITOR.document.getWindow().getViewPaneSize(),r=(n.width-t.width)/2,i=(n.height-t.height)/2;CKEDITOR.env.ie6Compat||(t.height+(0<i?i:0)>n.height||t.width+(0<r?r:0)>n.width?e.setStyle("position","absolute"):e.setStyle("position","fixed")),this.move(this._.moved?this._.position.x:r,this._.moved?this._.position.y:i)},foreach:function(e){for(var t in this._.contents)for(var n in this._.contents[t])e.call(this,this._.contents[t][n]);return this},reset:function(){var e=function(e){e.reset&&e.reset(1)};return function(){return this.foreach(e),this}}(),setupContent:function(){var e=arguments;this.foreach(function(t){t.setup&&t.setup.apply(t,e)})},commitContent:function(){var e=arguments;this.foreach(function(t){CKEDITOR.env.ie&&this._.currentFocusIndex==t.focusIndex&&t.getInputElement().$.blur(),t.commit&&t.commit.apply(t,e)})},hide:function(){if(this.parts.dialog.isVisible()){this.fire("hide",{}),this._.editor.fire("dialogHide",this),this.selectPage(this._.tabIdList[0]);var e=this._.element;e.setStyle("display","none"),this.parts.dialog.setStyle("visibility","hidden");for(L(this);CKEDITOR.dialog._.currentTop!=this;)CKEDITOR.dialog._.currentTop.hide();if(this._.parentDialog){var t=this._.parentDialog.getElement().getFirst();t.setStyle("z-index",parseInt(t.$.style.zIndex,10)+Math.floor(this._.editor.config.baseFloatZIndex/2))}else p(this._.editor);if(CKEDITOR.dialog._.currentTop=this._.parentDialog)CKEDITOR.dialog._.currentZIndex-=10;else{CKEDITOR.dialog._.currentZIndex=null,e.removeListener("keydown",N),e.removeListener("keyup",C);var n=this._.editor;n.focus(),setTimeout(function(){n.focusManager.unlock(),CKEDITOR.env.iOS&&n.window.focus()},0)}delete this._.parentDialog,this.foreach(function(e){e.resetInitValue&&e.resetInitValue()}),this.setState(CKEDITOR.DIALOG_STATE_IDLE)}},addPage:function(e){if(!e.requiredContent||this._.editor.filter.check(e.requiredContent)){for(var t=[],n=e.label?' title="'+CKEDITOR.tools.htmlEncode(e.label)+'"':"",r=CKEDITOR.dialog._.uiElementBuilders.vbox.build(this,{type:"vbox",className:"cke_dialog_page_contents",children:e.elements,expand:!!e.expand,padding:e.padding,style:e.style||"width: 100%;"},t),i=this._.contents[e.id]={},s=r.getChild(),o=0;r=s.shift();)!r.notAllowed&&"hbox"!=r.type&&"vbox"!=r.type&&o++,i[r.id]=r,"function"==typeof r.getChild&&s.push.apply(s,r.getChild());o||(e.hidden=!0),t=CKEDITOR.dom.element.createFromHtml(t.join("")),t.setAttribute("role","tabpanel"),r=CKEDITOR.env,i="cke_"+e.id+"_"+CKEDITOR.tools.getNextNumber(),n=CKEDITOR.dom.element.createFromHtml(['<a class="cke_dialog_tab"',0<this._.pageCount?" cke_last":"cke_first",n,e.hidden?' style="display:none"':"",' id="',i,'"',r.gecko&&!r.hc?"":' href="javascript:void(0)"',' tabIndex="-1" hidefocus="true" role="tab">',e.label,"</a>"].join("")),t.setAttribute("aria-labelledby",i),this._.tabs[e.id]=[n,t],this._.tabIdList.push(e.id),!e.hidden&&this._.pageCount++,this._.lastTab=n,this.updateStyle(),t.setAttribute("name",e.id),t.appendTo(this.parts.contents),n.unselectable(),this.parts.tabs.append(n),e.accessKey&&(k(this,this,"CTRL+"+e.accessKey,O,A),this._.accessKeyMap["CTRL+"+e.accessKey]=e.id)}},selectPage:function(e){if(this._.currentTabId!=e&&!this._.tabs[e][0].hasClass("cke_dialog_tab_disabled")&&!1!==this.fire("selectPage",{page:e,currentPage:this._.currentTabId})){for(var t in this._.tabs){var r=this._.tabs[t][0],i=this._.tabs[t][1];t!=e&&(r.removeClass("cke_dialog_tab_selected"),i.hide()),i.setAttribute("aria-hidden",t!=e)}var s=this._.tabs[e];s[0].addClass("cke_dialog_tab_selected"),CKEDITOR.env.ie6Compat||CKEDITOR.env.ie7Compat?(n(s[1]),s[1].show(),setTimeout(function(){n(s[1],1)},0)):s[1].show(),this._.currentTabId=e,this._.currentTabIndex=CKEDITOR.tools.indexOf(this._.tabIdList,e)}},updateStyle:function(){this.parts.dialog[(1===this._.pageCount?"add":"remove")+"Class"]("cke_single_page")},hidePage:function(t){var n=this._.tabs[t]&&this._.tabs[t][0];n&&1!=this._.pageCount&&n.isVisible()&&(t==this._.currentTabId&&this.selectPage(e.call(this)),n.hide(),this._.pageCount--,this.updateStyle())},showPage:function(e){if(e=this._.tabs[e]&&this._.tabs[e][0])e.show(),this._.pageCount++,this.updateStyle()},getElement:function(){return this._.element},getName:function(){return this._.name},getContentElement:function(e,t){var n=this._.contents[e];return n&&n[t]},getValueOf:function(e,t){return this.getContentElement(e,t).getValue()},setValueOf:function(e,t,n){return this.getContentElement(e,t).setValue(n)},getButton:function(e){return this._.buttons[e]},click:function(e){return this._.buttons[e].click()},disableButton:function(e){return this._.buttons[e].disable()},enableButton:function(e){return this._.buttons[e].enable()},getPageCount:function(){return this._.pageCount},getParentEditor:function(){return this._.editor},getSelectedElement:function(){return this.getParentEditor().getSelection().getSelectedElement()},addFocusable:function(e,t){if("undefined"==typeof t)t=this._.focusList.length,this._.focusList.push(new o(this,e,t));else{this._.focusList.splice(t,0,new o(this,e,t));for(var n=t+1;n<this._.focusList.length;n++)this._.focusList[n].focusIndex++}},setState:function(e){if(this.state!=e){this.state=e;if(e==CKEDITOR.DIALOG_STATE_BUSY){if(!this.parts.spinner){var t=this.getParentEditor().lang.dir,n={attributes:{"class":"cke_dialog_spinner"},styles:{"float":"rtl"==t?"right":"left"}};n.styles["margin-"+("rtl"==t?"left":"right")]="8px",this.parts.spinner=CKEDITOR.document.createElement("div",n),this.parts.spinner.setHtml("&#8987;"),this.parts.spinner.appendTo(this.parts.title,1)}this.parts.spinner.show(),this.getButton("ok").disable()}else e==CKEDITOR.DIALOG_STATE_IDLE&&(this.parts.spinner&&this.parts.spinner.hide(),this.getButton("ok").enable());this.fire("state",e)}}},CKEDITOR.tools.extend(CKEDITOR.dialog,{add:function(e,t){if(!this._.dialogDefinitions[e]||"function"==typeof t)this._.dialogDefinitions[e]=t},exists:function(e){return!!this._.dialogDefinitions[e]},getCurrent:function(){return CKEDITOR.dialog._.currentTop},isTabEnabled:function(e,t,n){return e=e.config.removeDialogTabs,!e||!e.match(RegExp("(?:^|;)"+t+":"+n+"(?:$|;)","i"))},okButton:function(){var e=function(e,t){return t=t||{},CKEDITOR.tools.extend({id:"ok",type:"button",label:e.lang.common.ok,"class":"cke_dialog_ui_button_ok",onClick:function(e){e=e.data.dialog,!1!==e.fire("ok",{hide:!0}).hide&&e.hide()}},t,!0)};return e.type="button",e.override=function(t){return CKEDITOR.tools.extend(function(n){return e(n,t)},{type:"button"},!0)},e}(),cancelButton:function(){var e=function(e,t){return t=t||{},CKEDITOR.tools.extend({id:"cancel",type:"button",label:e.lang.common.cancel,"class":"cke_dialog_ui_button_cancel",onClick:function(e){e=e.data.dialog,!1!==e.fire("cancel",{hide:!0}).hide&&e.hide()}},t,!0)};return e.type="button",e.override=function(t){return CKEDITOR.tools.extend(function(n){return e(n,t)},{type:"button"},!0)},e}(),addUIElement:function(e,t){this._.uiElementBuilders[e]=t}}),CKEDITOR.dialog._={uiElementBuilders:{},dialogDefinitions:{},currentTop:null,currentZIndex:null},CKEDITOR.event.implementOn(CKEDITOR.dialog),CKEDITOR.event.implementOn(CKEDITOR.dialog.prototype);var m={resizable:CKEDITOR.DIALOG_RESIZE_BOTH,minWidth:600,minHeight:400,buttons:[CKEDITOR.dialog.okButton,CKEDITOR.dialog.cancelButton]},g=function(e,t,n){for(var r=0,i;i=e[r];r++)if(i.id==t||n&&i[n]&&(i=g(i[n],t,n)))return i;return null},y=function(e,t,n,r,i){if(n){for(var s=0,o;o=e[s];s++){if(o.id==n)return e.splice(s,0,t),t;if(r&&o[r]&&(o=y(o[r],t,n,r,!0)))return o}if(i)return null}return e.push(t),t},b=function(e,t,n){for(var r=0,i;i=e[r];r++){if(i.id==t)return e.splice(r,1);if(n&&i[n]&&(i=b(i[n],t,n)))return i}return null},w=function(e,t){this.dialog=e;for(var n=t.contents,r=0,i;i=n[r];r++)n[r]=i&&new a(e,i);CKEDITOR.tools.extend(this,t)};w.prototype={getContents:function(e){return g(this.contents,e)},getButton:function(e){return g(this.buttons,e)},addContents:function(e,t){return y(this.contents,e,t)},addButton:function(e,t){return y(this.buttons,e,t)},removeContents:function(e){b(this.contents,e)},removeButton:function(e){b(this.buttons,e)}},a.prototype={get:function(e){return g(this.elements,e,"children")},add:function(e,t){return y(this.elements,e,t,"children")},remove:function(e){b(this.elements,e,"children")}};var E,S={},x,T={},N=function(e){var t=e.data.$.ctrlKey||e.data.$.metaKey,n=e.data.$.altKey,r=e.data.$.shiftKey,i=String.fromCharCode(e.data.$.keyCode);(t=T[(t?"CTRL+":"")+(n?"ALT+":"")+(r?"SHIFT+":"")+i])&&t.length&&(t=t[t.length-1],t.keydown&&t.keydown.call(t.uiElement,t.dialog,t.key),e.data.preventDefault())},C=function(e){var t=e.data.$.ctrlKey||e.data.$.metaKey,n=e.data.$.altKey,r=e.data.$.shiftKey,i=String.fromCharCode(e.data.$.keyCode);(t=T[(t?"CTRL+":"")+(n?"ALT+":"")+(r?"SHIFT+":"")+i])&&t.length&&(t=t[t.length-1],t.keyup&&(t.keyup.call(t.uiElement,t.dialog,t.key),e.data.preventDefault()))},k=function(e,t,n,r,i){(T[n]||(T[n]=[])).push({uiElement:e,dialog:t,key:n,keyup:i||e.accessKeyUp,keydown:r||e.accessKeyDown})},L=function(e){for(var t in T){for(var n=T[t],r=n.length-1;0<=r;r--)(n[r].dialog==e||n[r].uiElement==e)&&n.splice(r,1);0===n.length&&delete T[t]}},A=function(e,t){e._.accessKeyMap[t]&&e.selectPage(e._.accessKeyMap[t])},O=function(){};(function(){CKEDITOR.ui.dialog={uiElement:function(e,t,n,r,i,s,o){if(!(4>arguments.length)){var u=(r.call?r(t):r)||"div",a=["<",u," "],f=(i&&i.call?i(t):i)||{},l=(s&&s.call?s(t):s)||{},c=(o&&o.call?o.call(this,e,t):o)||"",h=this.domId=l.id||CKEDITOR.tools.getNextId()+"_uiElement";t.requiredContent&&!e.getParentEditor().filter.check(t.requiredContent)&&(f.display="none",this.notAllowed=!0),l.id=h;var p={};t.type&&(p["cke_dialog_ui_"+t.type]=1),t.className&&(p[t.className]=1),t.disabled&&(p.cke_disabled=1);for(var d=l["class"]&&l["class"].split?l["class"].split(" "):[],h=0;h<d.length;h++)d[h]&&(p[d[h]]=1);d=[];for(h in p)d.push(h);l["class"]=d.join(" "),t.title&&(l.title=t.title),p=(t.style||"").split(";"),t.align&&(d=t.align,f["margin-left"]="left"==d?0:"auto",f["margin-right"]="right"==d?0:"auto");for(h in f)p.push(h+":"+f[h]);t.hidden&&p.push("display:none");for(h=p.length-1;0<=h;h--)""===p[h]&&p.splice(h,1);0<p.length&&(l.style=(l.style?l.style+"; ":"")+p.join("; "));for(h in l)a.push(h+'="'+CKEDITOR.tools.htmlEncode(l[h])+'" ');a.push(">",c,"</",u,">"),n.push(a.join("")),(this._||(this._={})).dialog=e,"boolean"==typeof t.isChanged&&(this.isChanged=function(){return t.isChanged}),"function"==typeof t.isChanged&&(this.isChanged=t.isChanged),"function"==typeof t.setValue&&(this.setValue=CKEDITOR.tools.override(this.setValue,function(e){return function(n){e.call(this,t.setValue.call(this,n))}})),"function"==typeof t.getValue&&(this.getValue=CKEDITOR.tools.override(this.getValue,function(e){return function(){return t.getValue.call(this,e.call(this))}})),CKEDITOR.event.implementOn(this),this.registerEvents(t),this.accessKeyUp&&this.accessKeyDown&&t.accessKey&&k(this,e,"CTRL+"+t.accessKey);var v=this;e.on("load",function(){var t=v.getInputElement();if(t){var n=v.type in{checkbox:1,ratio:1}&&CKEDITOR.env.ie&&CKEDITOR.env.version<8?"cke_dialog_ui_focused":"";t.on("focus",function(){e._.tabBarMode=!1,e._.hasFocus=!0,v.fire("focus"),n&&this.addClass(n)}),t.on("blur",function(){v.fire("blur"),n&&this.removeClass(n)})}}),CKEDITOR.tools.extend(this,t),this.keyboardFocusable&&(this.tabIndex=t.tabIndex||0,this.focusIndex=e._.focusList.push(this)-1,this.on("focus",function(){e._.currentFocusIndex=v.focusIndex}))}},hbox:function(e,t,n,r,i){if(!(4>arguments.length)){this._||(this._={});var s=this._.children=t,o=i&&i.widths||null,u=i&&i.height||null,a,f={role:"presentation"};i&&i.align&&(f.align=i.align),CKEDITOR.ui.dialog.uiElement.call(this,e,i||{type:"hbox"},r,"table",{},f,function(){var e=['<tbody><tr class="cke_dialog_ui_hbox">'];for(a=0;a<n.length;a++){var t="cke_dialog_ui_hbox_child",r=[];0===a&&(t="cke_dialog_ui_hbox_first"),a==n.length-1&&(t="cke_dialog_ui_hbox_last"),e.push('<td class="',t,'" role="presentation" '),o?o[a]&&r.push("width:"+d(o[a])):r.push("width:"+Math.floor(100/n.length)+"%"),u&&r.push("height:"+d(u)),i&&void 0!==i.padding&&r.push("padding:"+d(i.padding)),CKEDITOR.env.ie&&CKEDITOR.env.quirks&&s[a].align&&r.push("text-align:"+s[a].align),0<r.length&&e.push('style="'+r.join("; ")+'" '),e.push(">",n[a],"</td>")}return e.push("</tr></tbody>"),e.join("")})}},vbox:function(e,t,n,r,i){if(!(3>arguments.length)){this._||(this._={});var s=this._.children=t,o=i&&i.width||null,u=i&&i.heights||null;CKEDITOR.ui.dialog.uiElement.call(this,e,i||{type:"vbox"},r,"div",null,{role:"presentation"},function(){var t=['<table role="presentation" cellspacing="0" border="0" '];t.push('style="'),i&&i.expand&&t.push("height:100%;"),t.push("width:"+d(o||"100%"),";"),CKEDITOR.env.webkit&&t.push("float:none;"),t.push('"'),t.push('align="',CKEDITOR.tools.htmlEncode(i&&i.align||("ltr"==e.getParentEditor().lang.dir?"left":"right")),'" '),t.push("><tbody>");for(var r=0;r<n.length;r++){var a=[];t.push('<tr><td role="presentation" '),o&&a.push("width:"+d(o||"100%")),u?a.push("height:"+d(u[r])):i&&i.expand&&a.push("height:"+Math.floor(100/n.length)+"%"),i&&void 0!==i.padding&&a.push("padding:"+d(i.padding)),CKEDITOR.env.ie&&CKEDITOR.env.quirks&&s[r].align&&a.push("text-align:"+s[r].align),0<a.length&&t.push('style="',a.join("; "),'" '),t.push(' class="cke_dialog_ui_vbox_child">',n[r],"</td></tr>")}return t.push("</tbody></table>"),t.join("")})}}}})(),CKEDITOR.ui.dialog.uiElement.prototype={getElement:function(){return CKEDITOR.document.getById(this.domId)},getInputElement:function(){return this.getElement()},getDialog:function(){return this._.dialog},setValue:function(e,t){return this.getInputElement().setValue(e),!t&&this.fire("change",{value:e}),this},getValue:function(){return this.getInputElement().getValue()},isChanged:function(){return!1},selectParentTab:function(){for(var e=this.getInputElement();(e=e.getParent())&&-1==e.$.className.search("cke_dialog_page_contents"););return e?(e=e.getAttribute("name"),this._.dialog._.currentTabId!=e&&this._.dialog.selectPage(e),this):this},focus:function(){return this.selectParentTab().getInputElement().focus(),this},registerEvents:function(e){var t=/^on([A-Z]\w+)/,n,r=function(e,t,n,r){t.on("load",function(){e.getInputElement().on(n,r,e)})},i;for(i in e)if(n=i.match(t))this.eventProcessors[i]?this.eventProcessors[i].call(this,this._.dialog,e[i]):r(this,this._.dialog,n[1].toLowerCase(),e[i]);return this},eventProcessors:{onLoad:function(e,t){e.on("load",t,this)},onShow:function(e,t){e.on("show",t,this)},onHide:function(e,t){e.on("hide",t,this)}},accessKeyDown:function(){this.focus()},accessKeyUp:function(){},disable:function(){var e=this.getElement();this.getInputElement().setAttribute("disabled","true"),e.addClass("cke_disabled")},enable:function(){var e=this.getElement();this.getInputElement().removeAttribute("disabled"),e.removeClass("cke_disabled")},isEnabled:function(){return!this.getElement().hasClass("cke_disabled")},isVisible:function(){return this.getInputElement().isVisible()},isFocusable:function(){return!this.isEnabled()||!this.isVisible()?!1:!0}},CKEDITOR.ui.dialog.hbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getChild:function(e){return 1>arguments.length?this._.children.concat():(e.splice||(e=[e]),2>e.length?this._.children[e[0]]:this._.children[e[0]]&&this._.children[e[0]].getChild?this._.children[e[0]].getChild(e.slice(1,e.length)):null)}},!0),CKEDITOR.ui.dialog.vbox.prototype=new CKEDITOR.ui.dialog.hbox,function(){var e={build:function(e,t,n){for(var r=t.children,i,s=[],o=[],u=0;u<r.length&&(i=r[u]);u++){var a=[];s.push(a),o.push(CKEDITOR.dialog._.uiElementBuilders[i.type].build(e,i,a))}return new CKEDITOR.ui.dialog[t.type](e,o,s,n,t)}};CKEDITOR.dialog.addUIElement("hbox",e),CKEDITOR.dialog.addUIElement("vbox",e)}(),CKEDITOR.dialogCommand=function(e,t){this.dialogName=e,CKEDITOR.tools.extend(this,t,!0)},CKEDITOR.dialogCommand.prototype={exec:function(e){e.openDialog(this.dialogName)},canUndo:!1,editorFocus:1},function(){var e=/^([a]|[^a])+$/,t=/^\d*$/,n=/^\d*(?:\.\d+)?$/,r=/^(((\d*(\.\d+))|(\d*))(px|\%)?)?$/,i=/^(((\d*(\.\d+))|(\d*))(px|em|ex|in|cm|mm|pt|pc|\%)?)?$/i,s=/^(\s*[\w-]+\s*:\s*[^:;]+(?:;|$))*$/;CKEDITOR.VALIDATE_OR=1,CKEDITOR.VALIDATE_AND=2,CKEDITOR.dialog.validate={functions:function(){var e=arguments;return function(){var t=this&&this.getValue?this.getValue():e[0],n,r=CKEDITOR.VALIDATE_AND,i=[],s;for(s=0;s<e.length;s++){if("function"!=typeof e[s])break;i.push(e[s])}s<e.length&&"string"==typeof e[s]&&(n=e[s],s++),s<e.length&&"number"==typeof e[s]&&(r=e[s]);var o=r==CKEDITOR.VALIDATE_AND?!0:!1;for(s=0;s<i.length;s++)o=r==CKEDITOR.VALIDATE_AND?o&&i[s](t):o||i[s](t);return o?!0:n}},regex:function(e,t){return function(n){return n=this&&this.getValue?this.getValue():n,e.test(n)?!0:t}},notEmpty:function(t){return this.regex(e,t)},integer:function(e){return this.regex(t,e)},number:function(e){return this.regex(n,e)},cssLength:function(e){return this.functions(function(e){return i.test(CKEDITOR.tools.trim(e))},e)},htmlLength:function(e){return this.functions(function(e){return r.test(CKEDITOR.tools.trim(e))},e)},inlineStyle:function(e){return this.functions(function(e){return s.test(CKEDITOR.tools.trim(e))},e)},equals:function(e,t){return this.functions(function(t){return t==e},t)},notEqual:function(e,t){return this.functions(function(t){return t!=e},t)}},CKEDITOR.on("instanceDestroyed",function(e){if(CKEDITOR.tools.isEmpty(CKEDITOR.instances)){for(var t;t=CKEDITOR.dialog._.currentTop;)t.hide();for(var n in S)S[n].remove();S={}}var e=e.editor._.storedDialogs,r;for(r in e)e[r].destroy()})}(),CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{openDialog:function(e,t){var n=null,r=CKEDITOR.dialog._.dialogDefinitions[e];null===CKEDITOR.dialog._.currentTop&&h(this);if("function"==typeof r)n=this._.storedDialogs||(this._.storedDialogs={}),n=n[e]||(n[e]=new CKEDITOR.dialog(this,e)),t&&t.call(n,n),n.show();else{if("failed"==r)throw p(this),Error('[CKEDITOR.dialog.openDialog] Dialog "'+e+'" failed when loading definition.');"string"==typeof r&&CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(r),function(){"function"!=typeof CKEDITOR.dialog._.dialogDefinitions[e]&&(CKEDITOR.dialog._.dialogDefinitions[e]="failed"),this.openDialog(e,t)},this,0,1)}return CKEDITOR.skin.loadPart("dialog"),n}})}(),CKEDITOR.plugins.add("dialog",{requires:"dialogui",init:function(e){e.on("doubleclick",function(n){n.data.dialog&&e.openDialog(n.data.dialog)},null,null,999)}}),function(){function e(e,t,n){return t.type||(t.type="auto"),n&&!1===e.fire("beforePaste",t)||!t.dataValue&&t.dataTransfer.isEmpty()?!1:(t.dataValue||(t.dataValue=""),CKEDITOR.env.gecko&&"drop"==t.method&&e.toolbox&&e.once("afterPaste",function(){e.toolbox.focus()}),e.fire("paste",t))}function t(t){function n(){var e=t.editable();if(CKEDITOR.plugins.clipboard.isCustomCopyCutSupported){var n=function(e){v.initPasteDataTransfer(e,t),e.data.preventDefault()};e.on("copy",n),e.on("cut",n),e.on("cut",function(){t.extractSelectedHtml()},null,null,999)}e.on(v.mainPasteEvent,function(e){"beforepaste"==v.mainPasteEvent&&m||h(e)}),"beforepaste"==v.mainPasteEvent&&(e.on("paste",function(e){g||(s(),e.data.preventDefault(),h(e),u("paste")||t.openDialog("paste"))}),e.on("contextmenu",o,null,null,0),e.on("beforepaste",function(e){e.data&&!e.data.$.ctrlKey&&!e.data.$.shiftKey&&o()},null,null,0)),e.on("beforecut",function(){!m&&a(t)});var r;e.attachListener(CKEDITOR.env.ie?e:t.document.getDocumentElement(),"mouseup",function(){r=setTimeout(function(){p()},0)}),t.on("destroy",function(){clearTimeout(r)}),e.on("keyup",p)}function r(e){return{type:e,canUndo:"cut"==e,startDisabled:!0,exec:function(){"cut"==this.type&&a();var e,n=this.type;if(CKEDITOR.env.ie)e=u(n);else try{e=t.document.$.execCommand(n,!1,null)}catch(r){e=!1}return e||t.showNotification(t.lang.clipboard[this.type+"Error"]),e}}}function i(){return{canUndo:!1,async:!0,exec:function(t,n){var r=function(n,r){n&&e(t,n,!!r),t.fire("afterCommandExec",{name:"paste",command:i,returnValue:!!n})},i=this;"string"==typeof n?r({dataValue:n,method:"paste",dataTransfer:v.initPasteDataTransfer()},1):t.getClipboardData(r)}}}function s(){g=1,setTimeout(function(){g=0},100)}function o(){m=1,setTimeout(function(){m=0},10)}function u(e){var n=t.document,r=n.getBody(),i=!1,s=function(){i=!0};return r.on(e,s),7<CKEDITOR.env.version?n.$.execCommand(e):n.$.selection.createRange().execCommand(e),r.removeListener(e,s),i}function a(){if(CKEDITOR.env.ie&&!CKEDITOR.env.quirks){var e=t.getSelection(),n,r,i;e.getType()==CKEDITOR.SELECTION_ELEMENT&&(n=e.getSelectedElement())&&(r=e.getRanges()[0],i=t.document.createText(""),i.insertBefore(n),r.setStartBefore(i),r.setEndAfter(n),e.selectRanges([r]),setTimeout(function(){n.getParent()&&(i.remove(),e.selectElement(n))},0))}}function f(e,n){var r=t.document,i=t.editable(),s=function(e){e.cancel()},o;if(!r.getById("cke_pastebin")){var u=t.getSelection(),a=u.createBookmarks();CKEDITOR.env.ie&&u.root.fire("selectionchange");var f=new CKEDITOR.dom.element((CKEDITOR.env.webkit||i.is("body"))&&!CKEDITOR.env.ie?"body":"div",r);f.setAttributes({id:"cke_pastebin","data-cke-temp":"1"});var l=0,r=r.getWindow();CKEDITOR.env.webkit?(i.append(f),f.addClass("cke_editable"),i.is("body")||(l="static"!=i.getComputedStyle("position")?i:CKEDITOR.dom.element.get(i.$.offsetParent),l=l.getDocumentPosition().y)):i.getAscendant(CKEDITOR.env.ie?"body":"html",1).append(f),f.setStyles({position:"absolute",top:r.getScrollPosition().y-l+10+"px",width:"1px",height:Math.max(1,r.getViewPaneSize().height-20)+"px",overflow:"hidden",margin:0,padding:0}),CKEDITOR.env.safari&&f.setStyles(CKEDITOR.tools.cssVendorPrefix("user-select","text")),(l=f.getParent().isReadOnly())?(f.setOpacity(0),f.setAttribute("contenteditable",!0)):f.setStyle("ltr"==t.config.contentsLangDirection?"left":"right","-1000px"),t.on("selectionChange",s,null,null,0);if(CKEDITOR.env.webkit||CKEDITOR.env.gecko)o=i.once("blur",s,null,null,-100);l&&f.focus(),l=new CKEDITOR.dom.range(f),l.selectNodeContents(f);var c=l.select();CKEDITOR.env.ie&&(o=i.once("blur",function(){t.lockSelection(c)}));var h=CKEDITOR.document.getWindow().getScrollPosition().y;setTimeout(function(){CKEDITOR.env.webkit&&(CKEDITOR.document.getBody().$.scrollTop=h),o&&o.removeListener(),CKEDITOR.env.ie&&i.focus(),u.selectBookmarks(a),f.remove();var e;CKEDITOR.env.webkit&&(e=f.getFirst())&&e.is&&e.hasClass("Apple-style-span")&&(f=e),t.removeListener("selectionChange",s),n(f.getHtml())},0)}}function l(){if("paste"==v.mainPasteEvent)return t.fire("beforePaste",{type:"auto",method:"paste"}),!1;t.focus(),s();var e=t.focusManager;return e.lock(),t.editable().fire(v.mainPasteEvent)&&!u("paste")?(e.unlock(),!1):(e.unlock(),!0)}function c(e){if("wysiwyg"==t.mode)switch(e.data.keyCode){case CKEDITOR.CTRL+86:case CKEDITOR.SHIFT+45:e=t.editable(),s(),"paste"==v.mainPasteEvent&&e.fire("beforepaste");break;case CKEDITOR.CTRL+88:case CKEDITOR.SHIFT+46:t.fire("saveSnapshot"),setTimeout(function(){t.fire("saveSnapshot")},50)}}function h(n){var r={type:"auto",method:"paste",dataTransfer:v.initPasteDataTransfer(n)};r.dataTransfer.cacheData();var i=!1!==t.fire("beforePaste",r);i&&v.canClipboardApiBeTrusted(r.dataTransfer,t)?(n.data.preventDefault(),setTimeout(function(){e(t,r)},0)):f(n,function(n){r.dataValue=n.replace(/<span[^>]+data-cke-bookmark[^<]*?<\/span>/ig,""),i&&e(t,r)})}function p(){if("wysiwyg"==t.mode){var e=d("paste");t.getCommand("cut").setState(d("cut")),t.getCommand("copy").setState(d("copy")),t.getCommand("paste").setState(e),t.fire("pasteState",e)}}function d(e){if(y&&e in{paste:1,cut:1})return CKEDITOR.TRISTATE_DISABLED;if("paste"==e)return CKEDITOR.TRISTATE_OFF;var e=t.getSelection(),n=e.getRanges();return e.getType()==CKEDITOR.SELECTION_NONE||1==n.length&&n[0].collapsed?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_OFF}var v=CKEDITOR.plugins.clipboard,m=0,g=0,y=0;(function(){t.on("key",c),t.on("contentDom",n),t.on("selectionChange",function(e){y=e.data.selection.getRanges()[0].checkReadOnly(),p()}),t.contextMenu&&t.contextMenu.addListener(function(e,t){return y=t.getRanges()[0].checkReadOnly(),{cut:d("cut"),copy:d("copy"),paste:d("paste")}})})(),function(){function e(e,n,r,i,s){var o=t.lang.clipboard[n];t.addCommand(n,r),t.ui.addButton&&t.ui.addButton(e,{label:o,command:n,toolbar:"clipboard,"+i}),t.addMenuItems&&t.addMenuItem(n,{label:o,command:n,group:"clipboard",order:s})}e("Cut","cut",r("cut"),10,1),e("Copy","copy",r("copy"),20,4),e("Paste","paste",i(),30,8)}(),t.getClipboardData=function(e,n){function r(e){e.removeListener(),e.cancel(),n(e.data)}function i(e){e.removeListener(),e.cancel(),a=!0,n({type:u,dataValue:e.data,method:"paste"})}function s(){this.customTitle=e&&e.title}var o=!1,u="auto",a=!1;n||(n=e,e=null),t.on("paste",r,null,null,0),t.on("beforePaste",function(e){e.removeListener(),o=!0,u=e.data.type},null,null,1e3),!1===l()&&(t.removeListener("paste",r),o&&t.fire("pasteDialog",s)?(t.on("pasteDialogCommit",i),t.on("dialogHide",function(e){e.removeListener(),e.data.removeListener("pasteDialogCommit",i),setTimeout(function(){a||n(null)},10)})):n(null))}}function n(e){if(CKEDITOR.env.webkit){if(!e.match(/^[^<]*$/g)&&!e.match(/^(<div><br( ?\/)?><\/div>|<div>[^<]*<\/div>)*$/gi))return"html"}else if(CKEDITOR.env.ie){if(!e.match(/^([^<]|<br( ?\/)?>)*$/gi)&&!e.match(/^(<p>([^<]|<br( ?\/)?>)*<\/p>|(\r\n))*$/gi))return"html"}else{if(!CKEDITOR.env.gecko)return"html";if(!e.match(/^([^<]|<br( ?\/)?>)*$/gi))return"html"}return"htmlifiedtext"}function r(e,t){function n(e){return CKEDITOR.tools.repeat("</p><p>",~~(e/2))+(1==e%2?"<br>":"")}return t=t.replace(/\s+/g," ").replace(/> +</g,"><").replace(/<br ?\/>/gi,"<br>"),t=t.replace(/<\/?[A-Z]+>/g,function(e){return e.toLowerCase()}),t.match(/^[^<]$/)?t:(CKEDITOR.env.webkit&&-1<t.indexOf("<div>")&&(t=t.replace(/^(<div>(<br>|)<\/div>)(?!$|(<div>(<br>|)<\/div>))/g,"<br>").replace(/^(<div>(<br>|)<\/div>){2}(?!$)/g,"<div></div>"),t.match(/<div>(<br>|)<\/div>/)&&(t="<p>"+t.replace(/(<div>(<br>|)<\/div>)+/g,function(e){return n(e.split("</div><div>").length+1)})+"</p>"),t=t.replace(/<\/div><div>/g,"<br>"),t=t.replace(/<\/?div>/g,"")),CKEDITOR.env.gecko&&e.enterMode!=CKEDITOR.ENTER_BR&&(CKEDITOR.env.gecko&&(t=t.replace(/^<br><br>$/,"<br>")),-1<t.indexOf("<br><br>")&&(t="<p>"+t.replace(/(<br>){2,}/g,function(e){return n(e.length/4)})+"</p>")),o(e,t))}function i(){function e(){var e={},t;for(t in CKEDITOR.dtd)"$"!=t.charAt(0)&&"div"!=t&&"span"!=t&&(e[t]=1);return e}var t,n;return{get:function(r){return"plain-text"==r?t||(t=new CKEDITOR.filter("br")):"semantic-content"==r?((r=n)||(r=new CKEDITOR.filter,r.allow({$1:{elements:e(),attributes:!0,styles:!1,classes:!1}}),r=n=r),r):r?new CKEDITOR.filter(r):null}}}function s(e,t,n){var t=CKEDITOR.htmlParser.fragment.fromHtml(t),r=new CKEDITOR.htmlParser.basicWriter;return n.applyTo(t,!0,!1,e.activeEnterMode),t.writeHtml(r),r.getHtml()}function o(e,t){return e.enterMode==CKEDITOR.ENTER_BR?t=t.replace(/(<\/p><p>)+/g,function(e){return CKEDITOR.tools.repeat("<br>",2*(e.length/7))}).replace(/<\/?p>/g,""):e.enterMode==CKEDITOR.ENTER_DIV&&(t=t.replace(/<(\/)?p>/g,"<$1div>")),t}function u(e){e.data.preventDefault(),e.data.$.dataTransfer.dropEffect="none"}function a(t){var n=CKEDITOR.plugins.clipboard;t.on("contentDom",function(){function r(n,r,i){r.select(),e(t,{dataTransfer:i,method:"drop"},1),i.sourceEditor.fire("saveSnapshot"),i.sourceEditor.editable().extractHtmlFromRange(n),i.sourceEditor.getSelection().selectRanges([n]),i.sourceEditor.fire("saveSnapshot")}function i(r,i){r.select(),e(t,{dataTransfer:i,method:"drop"},1),n.resetDragDataTransfer()}function s(e,n,r){var i={$:e.data.$,target:e.data.getTarget()};n&&(i.dragRange=n),r&&(i.dropRange=r),!1===t.fire(e.name,i)&&e.data.preventDefault()}function o(e){return e.type!=CKEDITOR.NODE_ELEMENT&&(e=e.getParent()),e.getChildCount()}var u=t.editable(),a=CKEDITOR.plugins.clipboard.getDropTarget(t),f=t.ui.space("top"),l=t.ui.space("bottom");n.preventDefaultDropOnElement(f),n.preventDefaultDropOnElement(l),u.attachListener(a,"dragstart",s),u.attachListener(t,"dragstart",n.resetDragDataTransfer,n,null,1),u.attachListener(t,"dragstart",function(e){n.initDragDataTransfer(e,t),e=n.dragRange=t.getSelection().getRanges()[0],CKEDITOR.env.ie&&10>CKEDITOR.env.version&&(n.dragStartContainerChildCount=e?o(e.startContainer):null,n.dragEndContainerChildCount=e?o(e.endContainer):null)},null,null,2),u.attachListener(a,"dragend",s),u.attachListener(t,"dragend",n.initDragDataTransfer,n,null,1),u.attachListener(t,"dragend",n.resetDragDataTransfer,n,null,100),u.attachListener(a,"dragover",function(e){var t=e.data.getTarget();t&&t.is&&t.is("html")?e.data.preventDefault():CKEDITOR.env.ie&&CKEDITOR.plugins.clipboard.isFileApiSupported&&e.data.$.dataTransfer.types.contains("Files")&&e.data.preventDefault()}),u.attachListener(a,"drop",function(e){e.data.preventDefault();var r=e.data.getTarget();if(!r.isReadOnly()||r.type==CKEDITOR.NODE_ELEMENT&&r.is("html")){var r=n.getRangeAtDropPosition(e,t),i=n.dragRange;r&&s(e,i,r)}}),u.attachListener(t,"drop",n.initDragDataTransfer,n,null,1),u.attachListener(t,"drop",function(e){if(e=e.data){var s=e.dropRange,o=e.dragRange,u=e.dataTransfer;u.getTransferType(t)==CKEDITOR.DATA_TRANSFER_INTERNAL?setTimeout(function(){n.internalDrop(o,s,u,t)},0):u.getTransferType(t)==CKEDITOR.DATA_TRANSFER_CROSS_EDITORS?r(o,s,u):i(s,u)}},null,null,9999)})}CKEDITOR.plugins.add("clipboard",{requires:"dialog",init:function(e){var o,u=i();e.config.forcePasteAsPlainText?o="plain-text":e.config.pasteFilter?o=e.config.pasteFilter:CKEDITOR.env.webkit&&!("pasteFilter"in e.config)&&(o="semantic-content"),e.pasteFilter=u.get(o),t(e),a(e),CKEDITOR.dialog.add("paste",CKEDITOR.getUrl(this.path+"dialogs/paste.js")),e.on("paste",function(t){t.data.dataTransfer||(t.data.dataTransfer=new CKEDITOR.plugins.clipboard.dataTransfer);if(!t.data.dataValue){var n=t.data.dataTransfer,r=n.getData("text/html");if(r)t.data.dataValue=r,t.data.type="html";else if(r=n.getData("text/plain"))t.data.dataValue=e.editable().transformPlainTextToHtml(r),t.data.type="text"}},null,null,1),e.on("paste",function(e){var t=e.data.dataValue,n=CKEDITOR.dtd.$block;-1<t.indexOf("Apple-")&&(t=t.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),"html"!=e.data.type&&(t=t.replace(/<span class="Apple-tab-span"[^>]*>([^<]*)<\/span>/gi,function(e,t){return t.replace(/\t/g,"&nbsp;&nbsp; &nbsp;")})),-1<t.indexOf('<br class="Apple-interchange-newline">')&&(e.data.startsWithEOL=1,e.data.preSniffing="html",t=t.replace(/<br class="Apple-interchange-newline">/,"")),t=t.replace(/(<[^>]+) class="Apple-[^"]*"/gi,"$1"));if(t.match(/^<[^<]+cke_(editable|contents)/i)){var r,i,s=new CKEDITOR.dom.element("div");for(s.setHtml(t);1==s.getChildCount()&&(r=s.getFirst())&&r.type==CKEDITOR.NODE_ELEMENT&&(r.hasClass("cke_editable")||r.hasClass("cke_contents"));)s=i=r;i&&(t=i.getHtml().replace(/<br>$/i,""))}CKEDITOR.env.ie?t=t.replace(/^&nbsp;(?: |\r\n)?<(\w+)/g,function(t,r){return r.toLowerCase()in n?(e.data.preSniffing="html","<"+r):t}):CKEDITOR.env.webkit?t=t.replace(/<\/(\w+)><div><br><\/div>$/,function(t,r){return r in n?(e.data.endsWithEOL=1,"</"+r+">"):t}):CKEDITOR.env.gecko&&(t=t.replace(/(\s)<br>$/,"$1")),e.data.dataValue=t},null,null,3),e.on("paste",function(t){var t=t.data,i=t.type,o=t.dataValue,a,f=e.config.clipboard_defaultContentType||"html",l=t.dataTransfer.getTransferType(e);a="html"==i||"html"==t.preSniffing?"html":n(o),"htmlifiedtext"==a&&(o=r(e.config,o)),"text"==i&&"html"==a?o=s(e,o,u.get("plain-text")):l==CKEDITOR.DATA_TRANSFER_EXTERNAL&&e.pasteFilter&&!t.dontFilter&&(o=s(e,o,e.pasteFilter)),t.startsWithEOL&&(o='<br data-cke-eol="1">'+o),t.endsWithEOL&&(o+='<br data-cke-eol="1">'),"auto"==i&&(i="html"==a||"html"==f?"html":"text"),t.type=i,t.dataValue=o,delete t.preSniffing,delete t.startsWithEOL,delete t.endsWithEOL},null,null,6),e.on("paste",function(t){t=t.data,t.dataValue&&(e.insertHtml(t.dataValue,t.type,t.range),setTimeout(function(){e.fire("afterPaste")},0))},null,null,1e3),e.on("pasteDialog",function(t){setTimeout(function(){e.openDialog("paste",t.data)},0)})}}),CKEDITOR.plugins.clipboard={isCustomCopyCutSupported:!CKEDITOR.env.ie&&!CKEDITOR.env.iOS,isCustomDataTypesSupported:!CKEDITOR.env.ie,isFileApiSupported:!CKEDITOR.env.ie||9<CKEDITOR.env.version,mainPasteEvent:CKEDITOR.env.ie&&!CKEDITOR.env.edge?"beforepaste":"paste",canClipboardApiBeTrusted:function(e,t){return e.getTransferType(t)!=CKEDITOR.DATA_TRANSFER_EXTERNAL||CKEDITOR.env.chrome&&!e.isEmpty()||CKEDITOR.env.gecko&&(e.getData("text/html")||e.getFilesCount())?!0:!1},getDropTarget:function(e){var t=e.editable();return CKEDITOR.env.ie&&9>CKEDITOR.env.version||t.isInline()?t:e.document},fixSplitNodesAfterDrop:function(e,t,n,r){function i(e,n,r){var i=e;i.type==CKEDITOR.NODE_TEXT&&(i=e.getParent());if(i.equals(n)&&r!=n.getChildCount())return e=t,n=e.startContainer.getChild(e.startOffset-1),r=e.startContainer.getChild(e.startOffset),n&&n.type==CKEDITOR.NODE_TEXT&&r&&r.type==CKEDITOR.NODE_TEXT&&(i=n.getLength(),n.setText(n.getText()+r.getText()),r.remove(),e.setStart(n,i),e.collapse(!0)),!0}var s=t.startContainer;"number"==typeof r&&"number"==typeof n&&s.type==CKEDITOR.NODE_ELEMENT&&!i(e.startContainer,s,n)&&i(e.endContainer,s,r)},isDropRangeAffectedByDragRange:function(e,t){var n=t.startContainer,r=t.endOffset;return e.endContainer.equals(n)&&e.endOffset<=r||e.startContainer.getParent().equals(n)&&e.startContainer.getIndex()<r||e.endContainer.getParent().equals(n)&&e.endContainer.getIndex()<r?!0:!1},internalDrop:function(t,n,r,i){var s=CKEDITOR.plugins.clipboard,o=i.editable(),u,a;i.fire("saveSnapshot"),i.fire("lockSnapshot",{dontUpdate:1}),CKEDITOR.env.ie&&10>CKEDITOR.env.version&&this.fixSplitNodesAfterDrop(t,n,s.dragStartContainerChildCount,s.dragEndContainerChildCount),(a=this.isDropRangeAffectedByDragRange(t,n))||(u=t.createBookmark(!1)),s=n.clone().createBookmark(!1),a&&(u=t.createBookmark(!1)),t=u.startNode,a=u.endNode;var f=s.startNode;a&&t.getPosition(f)==CKEDITOR.POSITION_PRECEDING&&a.getPosition(f)==CKEDITOR.POSITION_FOLLOWING?(i.getSelection().selectRanges([n]),t.remove(),a.remove(),f.remove()):(t=i.createRange(),t.moveToBookmark(u),o.extractHtmlFromRange(t,1),n=i.createRange(),n.moveToBookmark(s),e(i,{dataTransfer:r,method:"drop",range:n},1)),i.fire("unlockSnapshot")},getRangeAtDropPosition:function(e,t){var n=e.data.$,r=n.clientX,i=n.clientY,s=t.getSelection(!0).getRanges()[0],o=t.createRange();if(e.data.testRange)return e.data.testRange;if(document.caretRangeFromPoint)n=t.document.$.caretRangeFromPoint(r,i),o.setStart(CKEDITOR.dom.node(n.startContainer),n.startOffset),o.collapse(!0);else if(n.rangeParent)o.setStart(CKEDITOR.dom.node(n.rangeParent),n.rangeOffset),o.collapse(!0);else{if(CKEDITOR.env.ie&&8<CKEDITOR.env.version&&s&&t.editable().hasFocus)return s;if(!document.body.createTextRange)return null;t.focus(),n=t.document.getBody().$.createTextRange();try{for(var u=!1,a=0;20>a&&!u;a++){if(!u)try{n.moveToPoint(r,i-a),u=!0}catch(f){}if(!u)try{n.moveToPoint(r,i+a),u=!0}catch(l){}}if(u){var c="cke-temp-"+(new Date).getTime();n.pasteHTML('<span id="'+c+'">​</span>');var h=t.document.getById(c);o.moveToPosition(h,CKEDITOR.POSITION_BEFORE_START),h.remove()}else{var p=t.document.$.elementFromPoint(r,i),d=new CKEDITOR.dom.element(p),v;if(!!d.equals(t.editable())||"html"==d.getName())return s&&s.startContainer&&!s.startContainer.equals(t.editable())?s:null;v=d.getClientRect(),r<v.left?o.setStartAt(d,CKEDITOR.POSITION_AFTER_START):o.setStartAt(d,CKEDITOR.POSITION_BEFORE_END),o.collapse(!0)}}catch(m){return null}}return o},initDragDataTransfer:function(e,t){var n=e.data.$?e.data.$.dataTransfer:null,r=new this.dataTransfer(n,t);n?this.dragData&&r.id==this.dragData.id?r=this.dragData:this.dragData=r:this.dragData?r=this.dragData:this.dragData=r,e.data.dataTransfer=r},resetDragDataTransfer:function(){this.dragData=null},initPasteDataTransfer:function(e,t){if(this.isCustomCopyCutSupported&&e&&e.data&&e.data.$){var n=new this.dataTransfer(e.data.$.clipboardData,t);return this.copyCutData&&n.id==this.copyCutData.id?(n=this.copyCutData,n.$=e.data.$.clipboardData):this.copyCutData=n,n}return new this.dataTransfer(null,t)},preventDefaultDropOnElement:function(e){e&&e.on("dragover",u)}};var f=CKEDITOR.plugins.clipboard.isCustomDataTypesSupported?"cke/id":"Text";CKEDITOR.plugins.clipboard.dataTransfer=function(e,t){e&&(this.$=e),this._={metaRegExp:/^<meta.*?>/,bodyRegExp:/<body(?:[\s\S]*?)>([\s\S]*)<\/body>/,fragmentRegExp:/<\!--(?:Start|End)Fragment--\>/g,data:{},files:[],normalizeType:function(e){return e=e.toLowerCase(),e=="text"||e=="text/plain"?"Text":e=="url"?"URL":e}},this.id=this.getData(f),this.id||(this.id="Text"==f?"":"cke-"+CKEDITOR.tools.getUniqueId());if("Text"!=f)try{this.$.setData(f,this.id)}catch(n){}t&&(this.sourceEditor=t,this.setData("text/html",t.getSelectedHtml(1)),"Text"!=f&&!this.getData("text/plain")&&this.setData("text/plain",t.getSelection().getSelectedText()))},CKEDITOR.DATA_TRANSFER_INTERNAL=1,CKEDITOR.DATA_TRANSFER_CROSS_EDITORS=2,CKEDITOR.DATA_TRANSFER_EXTERNAL=3,CKEDITOR.plugins.clipboard.dataTransfer.prototype={getData:function(e){var e=this._.normalizeType(e),t=this._.data[e];if(void 0===t||null===t||""===t)try{t=this.$.getData(e)}catch(n){}if(void 0===t||null===t||""===t)t="";if("text/html"==e){if(t=t.replace(this._.metaRegExp,""),(e=this._.bodyRegExp.exec(t))&&e.length)t=e[1],t=t.replace(this._.fragmentRegExp,"")}else"Text"==e&&CKEDITOR.env.gecko&&this.getFilesCount()&&"file://"==t.substring(0,7)&&(t="");return t},setData:function(e,t){e=this._.normalizeType(e),this._.data[e]=t;if(CKEDITOR.plugins.clipboard.isCustomDataTypesSupported||"URL"==e||"Text"==e){"Text"==f&&"Text"==e&&(this.id=t);try{this.$.setData(e,t)}catch(n){}}},getTransferType:function(e){return this.sourceEditor?this.sourceEditor==e?CKEDITOR.DATA_TRANSFER_INTERNAL:CKEDITOR.DATA_TRANSFER_CROSS_EDITORS:CKEDITOR.DATA_TRANSFER_EXTERNAL},cacheData:function(){function e(e){var e=t._.normalizeType(e),n=t.getData(e);n&&(t._.data[e]=n)}if(this.$){var t=this,n,r;if(CKEDITOR.plugins.clipboard.isCustomDataTypesSupported){if(this.$.types)for(n=0;n<this.$.types.length;n++)e(this.$.types[n])}else e("Text"),e("URL");r=this._getImageFromClipboard();if(this.$&&this.$.files||r){this._.files=[];for(n=0;n<this.$.files.length;n++)this._.files.push(this.$.files[n]);0===this._.files.length&&r&&this._.files.push(r)}}},getFilesCount:function(){return this._.files.length?this._.files.length:this.$&&this.$.files&&this.$.files.length?this.$.files.length:this._getImageFromClipboard()?1:0},getFile:function(e){return this._.files.length?this._.files[e]:this.$&&this.$.files&&this.$.files.length?this.$.files[e]:0===e?this._getImageFromClipboard():void 0},isEmpty:function(){var e={},t;if(this.getFilesCount())return!1;for(t in this._.data)e[t]=1;if(this.$)if(CKEDITOR.plugins.clipboard.isCustomDataTypesSupported){if(this.$.types)for(var n=0;n<this.$.types.length;n++)e[this.$.types[n]]=1}else e.Text=1,e.URL=1;"Text"!=f&&(e[f]=0);for(t in e)if(e[t]&&""!==this.getData(t))return!1;return!0},_getImageFromClipboard:function(){var e;if(this.$&&this.$.items&&this.$.items[0])try{if((e=this.$.items[0].getAsFile())&&e.type)return e}catch(t){}}}}(),function(){var e='<a id="{id}" class="cke_button cke_button__{name} cke_button_{state} {cls}"'+(CKEDITOR.env.gecko&&!CKEDITOR.env.hc?"":" href=\"javascript:void('{titleJs}')\"")+' title="{title}" tabindex="-1" hidefocus="true" role="button" aria-labelledby="{id}_label" aria-haspopup="{hasArrow}" aria-disabled="{ariaDisabled}"';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(e+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(e+=' onblur="this.style.cssText = this.style.cssText;"');var e=e+(' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event);" onfocus="return CKEDITOR.tools.callFunction({focusFn},event);" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},this);return false;"><span class="cke_button_icon cke_button__{iconName}_icon" style="{style}"'),e=e+'>&nbsp;</span><span id="{id}_label" class="cke_button_label cke_button__{name}_label" aria-hidden="false">{label}</span>{arrowHtml}</a>',t=CKEDITOR.addTemplate("buttonArrow",'<span class="cke_button_arrow">'+(CKEDITOR.env.hc?"&#9660;":"")+"</span>"),n=CKEDITOR.addTemplate("button",e);CKEDITOR.plugins.add("button",{beforeInit:function(e){e.ui.addHandler(CKEDITOR.UI_BUTTON,CKEDITOR.ui.button.handler)}}),CKEDITOR.UI_BUTTON="button",CKEDITOR.ui.button=function(e){CKEDITOR.tools.extend(this,e,{title:e.label,click:e.click||function(t){t.execCommand(e.command)}}),this._={}},CKEDITOR.ui.button.handler={create:function(e){return new CKEDITOR.ui.button(e)}},CKEDITOR.ui.button.prototype={render:function(e,r){function i(){var t=e.mode;t&&(t=this.modes[t]?void 0!==m[t]?m[t]:CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,t=e.readOnly&&!this.readOnly?CKEDITOR.TRISTATE_DISABLED:t,this.setState(t),this.refresh&&this.refresh())}var s=CKEDITOR.env,u=this._.id=CKEDITOR.tools.getNextId(),a="",f=this.command,l;this._.editor=e;var c={id:u,button:this,editor:e,focus:function(){CKEDITOR.document.getById(u).focus()},execute:function(){this.button.click(e)},attach:function(e){this.button.attach(e)}},h=CKEDITOR.tools.addFunction(function(e){if(c.onkey)return e=new CKEDITOR.dom.event(e),!1!==c.onkey(c,e.getKeystroke())}),d=CKEDITOR.tools.addFunction(function(e){var t;return c.onfocus&&(t=!1!==c.onfocus(c,new CKEDITOR.dom.event(e))),t}),v=0;c.clickFn=l=CKEDITOR.tools.addFunction(function(){v&&(e.unlockSelection(1),v=0),c.execute(),s.iOS&&e.focus()});if(this.modes){var m={};e.on("beforeModeUnload",function(){e.mode&&this._.state!=CKEDITOR.TRISTATE_DISABLED&&(m[e.mode]=this._.state)},this),e.on("activeFilterChange",i,this),e.on("mode",i,this),!this.readOnly&&e.on("readOnly",i,this)}else f&&(f=e.getCommand(f))&&(f.on("state",function(){this.setState(f.state)},this),a+=f.state==CKEDITOR.TRISTATE_ON?"on":f.state==CKEDITOR.TRISTATE_DISABLED?"disabled":"off");this.directional&&e.on("contentDirChanged",function(t){var n=CKEDITOR.document.getById(this._.id),r=n.getFirst(),t=t.data;t!=e.lang.dir?n.addClass("cke_"+t):n.removeClass("cke_ltr").removeClass("cke_rtl"),r.setAttribute("style",CKEDITOR.skin.getIconStyle(y,"rtl"==t,this.icon,this.iconOffset))},this),f||(a+="off");var g=this.name||this.command,y=g;return this.icon&&!/\./.test(this.icon)&&(y=this.icon,this.icon=null),a={id:u,name:g,iconName:y,label:this.label,cls:this.className||"",state:a,ariaDisabled:"disabled"==a?"true":"false",title:this.title,titleJs:s.gecko&&!s.hc?"":(this.title||"").replace("'",""),hasArrow:this.hasArrow?"true":"false",keydownFn:h,focusFn:d,clickFn:l,style:CKEDITOR.skin.getIconStyle(y,"rtl"==e.lang.dir,this.icon,this.iconOffset),arrowHtml:this.hasArrow?t.output():""},n.output(a,r),this.onRender&&this.onRender(),c},setState:function(e){if(this._.state==e)return!1;this._.state=e;var t=CKEDITOR.document.getById(this._.id);return t?(t.setState(e,"cke_button"),e==CKEDITOR.TRISTATE_DISABLED?t.setAttribute("aria-disabled",!0):t.removeAttribute("aria-disabled"),this.hasArrow?(e=e==CKEDITOR.TRISTATE_ON?this._.editor.lang.button.selectedLabel.replace(/%1/g,this.label):this.label,CKEDITOR.document.getById(this._.id+"_label").setText(e)):e==CKEDITOR.TRISTATE_ON?t.setAttribute("aria-pressed",!0):t.removeAttribute("aria-pressed"),!0):!1},getState:function(){return this._.state},toFeature:function(e){if(this._.feature)return this._.feature;var t=this;return!this.allowedContent&&!this.requiredContent&&this.command&&(t=e.getCommand(this.command)||t),this._.feature=t}},CKEDITOR.ui.prototype.addButton=function(e,t){this.add(e,CKEDITOR.UI_BUTTON,t)}}(),CKEDITOR.plugins.add("panelbutton",{requires:"button",onLoad:function(){function e(e){var t=this._;t.state!=CKEDITOR.TRISTATE_DISABLED&&(this.createPanel(e),t.on?t.panel.hide():t.panel.showBlock(this._.id,this.document.getById(this._.id),4))}CKEDITOR.ui.panelButton=CKEDITOR.tools.createClass({base:CKEDITOR.ui.button,$:function(t){var n=t.panel||{};delete t.panel,this.base(t),this.document=n.parent&&n.parent.getDocument()||CKEDITOR.document,n.block={attributes:n.attributes},this.hasArrow=n.toolbarRelated=!0,this.click=e,this._={panelDefinition:n}},statics:{handler:{create:function(e){return new CKEDITOR.ui.panelButton(e)}}},proto:{createPanel:function(e){var t=this._;if(!t.panel){var n=this._.panelDefinition,r=this._.panelDefinition.block,i=n.parent||CKEDITOR.document.getBody(),s=this._.panel=new CKEDITOR.ui.floatPanel(e,i,n),n=s.addBlock(t.id,r),o=this;s.onShow=function(){o.className&&this.element.addClass(o.className+"_panel"),o.setState(CKEDITOR.TRISTATE_ON),t.on=1,o.editorFocus&&e.focus(),o.onOpen&&o.onOpen()},s.onHide=function(n){o.className&&this.element.getFirst().removeClass(o.className+"_panel"),o.setState(o.modes&&o.modes[e.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),t.on=0,!n&&o.onClose&&o.onClose()},s.onEscape=function(){s.hide(1),o.document.getById(t.id).focus()},this.onBlock&&this.onBlock(s,n),n.onHide=function(){t.on=0,o.setState(CKEDITOR.TRISTATE_OFF)}}}}})},beforeInit:function(e){e.ui.addHandler(CKEDITOR.UI_PANELBUTTON,CKEDITOR.ui.panelButton.handler)}}),CKEDITOR.UI_PANELBUTTON="panelbutton",function(){CKEDITOR.plugins.add("panel",{beforeInit:function(e){e.ui.addHandler(CKEDITOR.UI_PANEL,CKEDITOR.ui.panel.handler)}}),CKEDITOR.UI_PANEL="panel",CKEDITOR.ui.panel=function(e,t){t&&CKEDITOR.tools.extend(this,t),CKEDITOR.tools.extend(this,{className:"",css:[]}),this.id=CKEDITOR.tools.getNextId(),this.document=e,this.isFramed=this.forceIFrame||this.css.length,this._={blocks:{}}},CKEDITOR.ui.panel.handler={create:function(e){return new CKEDITOR.ui.panel(e)}};var e=CKEDITOR.addTemplate("panel",'<div lang="{langCode}" id="{id}" dir={dir} class="cke cke_reset_all {editorId} cke_panel cke_panel {cls} cke_{dir}" style="z-index:{z-index}" role="presentation">{frame}</div>'),t=CKEDITOR.addTemplate("panel-frame",'<iframe id="{id}" class="cke_panel_frame" role="presentation" frameborder="0" src="{src}"></iframe>'),n=CKEDITOR.addTemplate("panel-frame-inner",'<!DOCTYPE html><html class="cke_panel_container {env}" dir="{dir}" lang="{langCode}"><head>{css}</head><body class="cke_{dir}" style="margin:0;padding:0" onload="{onload}"></body></html>');CKEDITOR.ui.panel.prototype={render:function(r,i){this.getHolderElement=function(){var e=this._.holder;if(!e){if(this.isFramed){var e=this.document.getById(this.id+"_frame"),t=e.getParent(),e=e.getFrameDocument();CKEDITOR.env.iOS&&t.setStyles({overflow:"scroll","-webkit-overflow-scrolling":"touch"}),t=CKEDITOR.tools.addFunction(CKEDITOR.tools.bind(function(){this.isLoaded=!0,this.onLoad&&this.onLoad()},this)),e.write(n.output(CKEDITOR.tools.extend({css:CKEDITOR.tools.buildStyleHtml(this.css),onload:"window.parent.CKEDITOR.tools.callFunction("+t+");"},s))),e.getWindow().$.CKEDITOR=CKEDITOR,e.on("keydown",function(e){var t=e.data.getKeystroke(),n=this.document.getById(this.id).getAttribute("dir");this._.onKeyDown&&!1===this._.onKeyDown(t)?e.data.preventDefault():(27==t||t==("rtl"==n?39:37))&&this.onEscape&&!1===this.onEscape(t)&&e.data.preventDefault()},this),e=e.getBody(),e.unselectable(),CKEDITOR.env.air&&CKEDITOR.tools.callFunction(t)}else e=this.document.getById(this.id);this._.holder=e}return e};var s={editorId:r.id,id:this.id,langCode:r.langCode,dir:r.lang.dir,cls:this.className,frame:"",env:CKEDITOR.env.cssClass,"z-index":r.config.baseFloatZIndex+1};if(this.isFramed){var o=CKEDITOR.env.air?"javascript:void(0)":CKEDITOR.env.ie?"javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())":"";s.frame=t.output({id:this.id+"_frame",src:o})}return o=e.output(s),i&&i.push(o),o},addBlock:function(e,t){return t=this._.blocks[e]=t instanceof CKEDITOR.ui.panel.block?t:new CKEDITOR.ui.panel.block(this.getHolderElement(),t),this._.currentBlock||this.showBlock(e),t},getBlock:function(e){return this._.blocks[e]},showBlock:function(e){var e=this._.blocks[e],t=this._.currentBlock,n=!this.forceIFrame||CKEDITOR.env.ie?this._.holder:this.document.getById(this.id+"_frame");return t&&t.hide(),this._.currentBlock=e,CKEDITOR.fire("ariaWidget",n),e._.focusIndex=-1,this._.onKeyDown=e.onKeyDown&&CKEDITOR.tools.bind(e.onKeyDown,e),e.show(),e},destroy:function(){this.element&&this.element.remove()}},CKEDITOR.ui.panel.block=CKEDITOR.tools.createClass({$:function(e,t){this.element=e.append(e.getDocument().createElement("div",{attributes:{tabindex:-1,"class":"cke_panel_block"},styles:{display:"none"}})),t&&CKEDITOR.tools.extend(this,t),this.element.setAttributes({role:this.attributes.role||"presentation","aria-label":this.attributes["aria-label"],title:this.attributes.title||this.attributes["aria-label"]}),this.keys={},this._.focusIndex=-1,this.element.disableContextMenu()},_:{markItem:function(e){-1!=e&&(e=this.element.getElementsByTag("a").getItem(this._.focusIndex=e),CKEDITOR.env.webkit&&e.getDocument().getWindow().focus(),e.focus(),this.onMark&&this.onMark(e))}},proto:{show:function(){this.element.setStyle("display","")},hide:function(){(!this.onHide||!0!==this.onHide.call(this))&&this.element.setStyle("display","none")},onKeyDown:function(e,t){var n=this.keys[e];switch(n){case"next":for(var r=this._.focusIndex,n=this.element.getElementsByTag("a"),i;i=n.getItem(++r);)if(i.getAttribute("_cke_focus")&&i.$.offsetWidth){this._.focusIndex=r,i.focus();break}return!i&&!t?(this._.focusIndex=-1,this.onKeyDown(e,1)):!1;case"prev":r=this._.focusIndex;for(n=this.element.getElementsByTag("a");0<r&&(i=n.getItem(--r));){if(i.getAttribute("_cke_focus")&&i.$.offsetWidth){this._.focusIndex=r,i.focus();break}i=null}return!i&&!t?(this._.focusIndex=n.count(),this.onKeyDown(e,1)):!1;case"click":case"mouseup":return r=this._.focusIndex,(i=0<=r&&this.element.getElementsByTag("a").getItem(r))&&(i.$[n]?i.$[n]():i.$["on"+n]()),!1}return!0}}})}(),CKEDITOR.plugins.add("floatpanel",{requires:"panel"}),function(){function e(e,n,r,i,s){var s=CKEDITOR.tools.genKey(n.getUniqueId(),r.getUniqueId(),e.lang.dir,e.uiColor||"",i.css||"",s||""),o=t[s];return o||(o=t[s]=new CKEDITOR.ui.panel(n,i),o.element=r.append(CKEDITOR.dom.element.createFromHtml(o.render(e),n)),o.element.setStyles({display:"none",position:"absolute"})),o}var t={};CKEDITOR.ui.floatPanel=CKEDITOR.tools.createClass({$:function(t,n,i,s){function o(){l.hide()}i.forceIFrame=1,i.toolbarRelated&&t.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&(n=CKEDITOR.document.getById("cke_"+t.name));var u=n.getDocument(),s=e(t,u,n,i,s||0),a=s.element,f=a.getFirst(),l=this;a.disableContextMenu(),this.element=a,this._={editor:t,panel:s,parentElement:n,definition:i,document:u,iframe:f,children:[],dir:t.lang.dir},t.on("mode",o),t.on("resize",o),CKEDITOR.env.iOS||u.getWindow().on("resize",o)},proto:{addBlock:function(e,t){return this._.panel.addBlock(e,t)},addListBlock:function(e,t){return this._.panel.addListBlock(e,t)},getBlock:function(e){return this._.panel.getBlock(e)},showBlock:function(e,t,n,r,i,s){var o=this._.panel,u=o.showBlock(e);this.allowBlur(!1),e=this._.editor.editable(),this._.returnFocus=e.hasFocus?e:new CKEDITOR.dom.element(CKEDITOR.document.$.activeElement),this._.hideTimeout=0;var a=this.element,e=this._.iframe,e=CKEDITOR.env.ie&&!CKEDITOR.env.edge?e:new CKEDITOR.dom.window(e.$.contentWindow),f=a.getDocument(),l=this._.parentElement.getPositionedAncestor(),c=t.getDocumentPosition(f),f=l?l.getDocumentPosition(f):{x:0,y:0},h="rtl"==this._.dir,p=c.x+(r||0)-f.x,d=c.y+(i||0)-f.y;!h||1!=n&&4!=n?!h&&(2==n||3==n)&&(p+=t.$.offsetWidth-1):p+=t.$.offsetWidth;if(3==n||4==n)d+=t.$.offsetHeight-1;this._.panel._.offsetParentId=t.getId(),a.setStyles({top:d+"px",left:0,display:""}),a.setOpacity(0),a.getFirst().removeStyle("width"),this._.editor.focusManager.add(e),this._.blurSet||(CKEDITOR.event.useCapture=!0,e.on("blur",function(e){function t(){delete this._.returnFocus,this.hide()}this.allowBlur()&&e.data.getPhase()==CKEDITOR.EVENT_PHASE_AT_TARGET&&this.visible&&!this._.activeChild&&(CKEDITOR.env.iOS?this._.hideTimeout||(this._.hideTimeout=CKEDITOR.tools.setTimeout(t,0,this)):t.call(this))},this),e.on("focus",function(){this._.focused=!0,this.hideChild(),this.allowBlur(!0)},this),CKEDITOR.env.iOS&&(e.on("touchstart",function(){clearTimeout(this._.hideTimeout)},this),e.on("touchend",function(){this._.hideTimeout=0,this.focus()},this)),CKEDITOR.event.useCapture=!1,this._.blurSet=1),o.onEscape=CKEDITOR.tools.bind(function(e){if(this.onEscape&&this.onEscape(e)===!1)return!1},this),CKEDITOR.tools.setTimeout(function(){var e=CKEDITOR.tools.bind(function(){a.removeStyle("width");if(u.autoSize){var e=u.element.getDocument(),e=(CKEDITOR.env.webkit?u.element:e.getBody()).$.scrollWidth;CKEDITOR.env.ie&&CKEDITOR.env.quirks&&e>0&&(e+=(a.$.offsetWidth||0)-(a.$.clientWidth||0)+3),a.setStyle("width",e+10+"px"),e=u.element.$.scrollHeight,CKEDITOR.env.ie&&CKEDITOR.env.quirks&&e>0&&(e+=(a.$.offsetHeight||0)-(a.$.clientHeight||0)+3),a.setStyle("height",e+"px"),o._.currentBlock.element.setStyle("display","none").removeStyle("display")}else a.removeStyle("height");h&&(p-=a.$.offsetWidth),a.setStyle("left",p+"px");var t=o.element.getWindow(),e=a.$.getBoundingClientRect(),t=t.getViewPaneSize(),n=e.width||e.right-e.left,r=e.height||e.bottom-e.top,i=h?e.right:t.width-e.left,f=h?t.width-e.right:e.left;h?i<n&&(p=f>n?p+n:t.width>n?p-e.left:p-e.right+t.width):i<n&&(p=f>n?p-n:t.width>n?p-e.right+t.width:p-e.left),n=e.top,t.height-e.top<r&&(d=n>r?d-r:t.height>r?d-e.bottom+t.height:d-e.top),CKEDITOR.env.ie&&(t=e=new CKEDITOR.dom.element(a.$.offsetParent),t.getName()=="html"&&(t=t.getDocument().getBody()),t.getComputedStyle("direction")=="rtl"&&(p=CKEDITOR.env.ie8Compat?p-a.getDocument().getDocumentElement().$.scrollLeft*2:p-(e.$.scrollWidth-e.$.clientWidth)));var e=a.getFirst(),l;(l=e.getCustomData("activePanel"))&&l.onHide&&l.onHide.call(this,1),e.setCustomData("activePanel",this),a.setStyles({top:d+"px",left:p+"px"}),a.setOpacity(1),s&&s()},this);o.isLoaded?e():o.onLoad=e,CKEDITOR.tools.setTimeout(function(){var e=CKEDITOR.env.webkit&&CKEDITOR.document.getWindow().getScrollPosition().y;this.focus(),u.element.focus(),CKEDITOR.env.webkit&&(CKEDITOR.document.getBody().$.scrollTop=e),this.allowBlur(!0),this._.editor.fire("panelShow",this)},0,this)},CKEDITOR.env.air?200:0,this),this.visible=1,this.onShow&&this.onShow.call(this)},focus:function(){if(CKEDITOR.env.webkit){var e=CKEDITOR.document.getActive();e&&!e.equals(this._.iframe)&&e.$.blur()}(this._.lastFocused||this._.iframe.getFrameDocument().getWindow()).focus()},blur:function(){var e=this._.iframe.getFrameDocument().getActive();e&&e.is("a")&&(this._.lastFocused=e)},hide:function(e){if(this.visible&&(!this.onHide||!0!==this.onHide.call(this))){this.hideChild(),CKEDITOR.env.gecko&&this._.iframe.getFrameDocument().$.activeElement.blur(),this.element.setStyle("display","none"),this.visible=0,this.element.getFirst().removeCustomData("activePanel");if(e=e&&this._.returnFocus)CKEDITOR.env.webkit&&e.type&&e.getWindow().$.focus(),e.focus();delete this._.lastFocused,this._.editor.fire("panelHide",this)}},allowBlur:function(e){var t=this._.panel;return void 0!==e&&(t.allowBlur=e),t.allowBlur},showAsChild:function(e,t,n,r,i,s){this._.activeChild==e&&e._.panel._.offsetParentId==n.getId()||(this.hideChild(),e.onHide=CKEDITOR.tools.bind(function(){CKEDITOR.tools.setTimeout(function(){this._.focused||this.hide()},0,this)},this),this._.activeChild=e,this._.focused=!1,e.showBlock(t,n,r,i,s),this.blur(),(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&setTimeout(function(){e.element.getChild(0).$.style.cssText+=""},100))},hideChild:function(e){var t=this._.activeChild;t&&(delete t.onHide,delete this._.activeChild,t.hide(),e&&this.focus())}}}),CKEDITOR.on("instanceDestroyed",function(){var e=CKEDITOR.tools.isEmpty(CKEDITOR.instances),n;for(n in t){var r=t[n];e?r.destroy():r.element.hide()}e&&(t={})})}(),CKEDITOR.plugins.add("colorbutton",{requires:"panelbutton,floatpanel",init:function(e){function t(t,r,o,u){var a=new CKEDITOR.style(i["colorButton_"+r+"Style"]),l=CKEDITOR.tools.getNextId()+"_colorBox";e.ui.add(t,CKEDITOR.UI_PANELBUTTON,{label:o,title:o,modes:{wysiwyg:1},editorFocus:0,toolbar:"colors,"+u,allowedContent:a,requiredContent:a,panel:{css:CKEDITOR.skin.getPath("editor"),attributes:{role:"listbox","aria-label":s.panelTitle}},onBlock:function(t,i){i.autoSize=!0,i.element.addClass("cke_colorblock"),i.element.setHtml(n(t,r,l)),i.element.getDocument().getBody().setStyle("overflow","hidden"),CKEDITOR.ui.fire("ready",this);var s=i.keys,o="rtl"==e.lang.dir;s[o?37:39]="next",s[40]="next",s[9]="next",s[o?39:37]="prev",s[38]="prev",s[CKEDITOR.SHIFT+9]="prev",s[32]="click"},refresh:function(){e.activeFilter.check(a)||this.setState(CKEDITOR.TRISTATE_DISABLED)},onOpen:function(){var t=e.getSelection(),t=t&&t.getStartElement(),t=e.elementPath(t),n;if(t){t=t.block||t.blockLimit||e.document.getBody();do n=t&&t.getComputedStyle("back"==r?"background-color":"color")||"transparent";while("back"==r&&"transparent"==n&&t&&(t=t.getParent()));if(!n||"transparent"==n)n="#ffffff";return this._.panel._.iframe.getFrameDocument().getById(l).setStyle("background-color",n),n}}})}function n(t,n,o){var u=[],a=i.colorButton_colors.split(","),l=e.plugins.colordialog&&!1!==i.colorButton_enableMore,h=a.length+(l?2:1),d=CKEDITOR.tools.addFunction(function(n,s){function o(e){this.removeListener("ok",o),this.removeListener("cancel",o),"ok"==e.name&&u(this.getContentElement("picker","selectedColor").getValue(),s)}var u=arguments.callee;if("?"==n)e.openDialog("colordialog",function(){this.on("ok",o),this.on("cancel",o)});else{e.focus(),t.hide(),e.fire("saveSnapshot"),e.removeStyle(new CKEDITOR.style(i["colorButton_"+s+"Style"],{color:"inherit"}));if(n){var a=i["colorButton_"+s+"Style"];a.childRule="back"==s?function(e){return r(e)}:function(e){return!e.is("a")&&!e.getElementsByTag("a").count()||r(e)},e.applyStyle(new CKEDITOR.style(a,{color:n}))}e.fire("saveSnapshot")}});u.push('<a class="cke_colorauto" _cke_focus=1 hidefocus=true title="',s.auto,'" onclick="CKEDITOR.tools.callFunction(',d,",null,'",n,"');return false;\" href=\"javascript:void('",s.auto,'\')" role="option" aria-posinset="1" aria-setsize="',h,'"><table role="presentation" cellspacing=0 cellpadding=0 width="100%"><tr><td><span class="cke_colorbox" id="',o,'"></span></td><td colspan=7 align=center>',s.auto,'</td></tr></table></a><table role="presentation" cellspacing=0 cellpadding=0 width="100%">');for(o=0;o<a.length;o++){0===o%8&&u.push("</tr><tr>");var v=a[o].split("/"),m=v[0],g=v[1]||m;v[1]||(m="#"+m.replace(/^(.)(.)(.)$/,"$1$1$2$2$3$3")),v=e.lang.colorbutton.colors[g]||g,u.push('<td><a class="cke_colorbox" _cke_focus=1 hidefocus=true title="',v,'" onclick="CKEDITOR.tools.callFunction(',d,",'",m,"','",n,"'); return false;\" href=\"javascript:void('",v,'\')" role="option" aria-posinset="',o+2,'" aria-setsize="',h,'"><span class="cke_colorbox" style="background-color:#',g,'"></span></a></td>')}return l&&u.push('</tr><tr><td colspan=8 align=center><a class="cke_colormore" _cke_focus=1 hidefocus=true title="',s.more,'" onclick="CKEDITOR.tools.callFunction(',d,",'?','",n,"');return false;\" href=\"javascript:void('",s.more,"')\"",' role="option" aria-posinset="',h,'" aria-setsize="',h,'">',s.more,"</a></td>"),u.push("</tr></table>"),u.join("")}function r(e){return"false"==e.getAttribute("contentEditable")||e.getAttribute("data-nostyle")}var i=e.config,s=e.lang.colorbutton;CKEDITOR.env.hc||(t("TextColor","fore",s.textColorTitle,10),t("BGColor","back",s.bgColorTitle,20))}}),CKEDITOR.config.colorButton_colors="000,800000,8B4513,2F4F4F,008080,000080,4B0082,696969,B22222,A52A2A,DAA520,006400,40E0D0,0000CD,800080,808080,F00,FF8C00,FFD700,008000,0FF,00F,EE82EE,A9A9A9,FFA07A,FFA500,FFFF00,00FF00,AFEEEE,ADD8E6,DDA0DD,D3D3D3,FFF0F5,FAEBD7,FFFFE0,F0FFF0,F0FFFF,F0F8FF,E6E6FA,FFF",CKEDITOR.config.colorButton_foreStyle={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]},CKEDITOR.config.colorButton_backStyle={element:"span",styles:{"background-color":"#(color)"}},CKEDITOR.plugins.colordialog={requires:"dialog",init:function(e){var t=new CKEDITOR.dialogCommand("colordialog");t.editorFocus=!1,e.addCommand("colordialog",t),CKEDITOR.dialog.add("colordialog",this.path+"dialogs/colordialog.js"),e.getColorFromDialog=function(t,n){var r=function(e){this.removeListener("ok",r),this.removeListener("cancel",r),e="ok"==e.name?this.getValueOf("picker","selectedColor"):null,t.call(n,e)},i=function(e){e.on("ok",r),e.on("cancel",r)};e.execCommand("colordialog"),e._.storedDialogs&&e._.storedDialogs.colordialog?i(e._.storedDialogs.colordialog):CKEDITOR.on("dialogDefinition",function(e){if("colordialog"==e.data.name){var t=e.data.definition;e.removeListener(),t.onLoad=CKEDITOR.tools.override(t.onLoad,function(e){return function(){i(this),t.onLoad=e,"function"==typeof e&&e.call(this)}})}})}}},CKEDITOR.plugins.add("colordialog",CKEDITOR.plugins.colordialog),function(){function e(e){return e?20<e.length?!1:(e=e.replace(/[\n|\t]*/g,"").toLowerCase(),!e||"<br>"==e||"<p>&nbsp;<br></p>"==e||"<p><br></p>"==e||"<p>&nbsp;</p>"==e||"&nbsp;"==e||" "==e||"&nbsp;<br>"==e||" <br>"==e?!0:!1):!0}function t(t){var n=t.editor,r=n.editable?n.editable():"wysiwyg"==n.mode?n.document&&n.document.getBody():n.textarea,s=t.listenerData;if(r){if("wysiwyg"==n.mode){if(CKEDITOR.dialog._.currentTop||!r)return;e(r.getHtml())&&(r.setHtml(s),r.addClass("placeholder"))}"source"==n.mode&&(i?"mode"==t.name&&r.setAttribute("placeholder",s):e(r.getValue())&&(r.setValue(s),r.addClass("placeholder")))}}function n(e){var e=e.editor,t=e.editable?e.editable():"wysiwyg"==e.mode?e.document&&e.document.getBody():e.textarea;if(t){if("wysiwyg"==e.mode){if(!t.hasClass("placeholder"))return;t.removeClass("placeholder");if(CKEDITOR.dtd[t.getName()].p){t.setHtml("<p><br/></p>");var n=new CKEDITOR.dom.range(e.document);n.moveToElementEditablePosition(t.getFirst(),!0),e.getSelection().selectRanges([n])}else t.setHtml(" ")}"source"==e.mode&&t.hasClass("placeholder")&&(t.removeClass("placeholder"),t.setValue(""))}}function r(e){return e?e.getAttribute("lang")||r(e.getParent()):null}var i="placeholder"in document.createElement("textarea");CKEDITOR.plugins.add("confighelper",{getPlaceholderCss:function(){return".placeholder{ color: #999; }"},onLoad:function(){CKEDITOR.addCss&&CKEDITOR.addCss(this.getPlaceholderCss())},init:function(s){s.on("mode",function(e){e.editor.focusManager.hasFocus=!1});var u=s.element.getAttribute("placeholder")||s.config.placeholder;if(u){s.addCss&&s.addCss(this.getPlaceholderCss());var a=CKEDITOR.document.getHead().append("style");a.setAttribute("type","text/css"),CKEDITOR.env.ie&&11>CKEDITOR.env.version?a.$.styleSheet.cssText="textarea.placeholder { color: #999; font-style: italic; }":a.$.innerHTML="textarea.placeholder { color: #999; font-style: italic; }",s.on("getData",function(e){var t=s.editable?s.editable():"wysiwyg"==s.mode?s.document&&s.document.getBody():s.textarea;t&&t.hasClass("placeholder")&&(e.data.dataValue="")}),s.on("setData",function(n){if(!CKEDITOR.dialog._.currentTop&&("source"!=s.mode||!i)){var r=s.editable?s.editable():"wysiwyg"==s.mode?s.document&&s.document.getBody():s.textarea;r&&(e(n.data.dataValue)?t(n):r.hasClass("placeholder")&&r.removeClass("placeholder"))}}),s.on("blur",t,null,u),s.on("mode",t,null,u),s.on("contentDom",t,null,u),s.on("focus",n),s.on("beforeModeUnload",n)}(u=s.config.contentsLanguage||r(s.element))&&!s.config.scayt_sLang&&(localStorage&&localStorage.removeItem("scayt_0_lang"),s.config.scayt_sLang={en:"en_US","en-us":"en_US","en-gb":"en_GB","pt-br":"pt_BR",da:"da_DK","da-dk":"da_DK","nl-nl":"nl_NL","en-ca":"en_CA","fi-fi":"fi_FI",fr:"fr_FR","fr-fr":"fr_FR","fr-ca":"fr_CA",de:"de_DE","de-de":"de_DE","el-gr":"el_GR",it:"it_IT","it-it":"it_IT","nb-no":"nb_NO",pt:"pt_PT","pt-pt":"pt_PT",es:"es_ES","es-es":"es_ES","sv-se":"sv_SE"}[u.toLowerCase()]);var f=function(e){if("object"==typeof e)return e;var e=e.split(";"),t={},n;for(n=0;n<e.length;n++){var r=e[n].split(":");if(3==r.length){var i=r[0],s=r[1],r=r[2];t[i]||(t[i]={}),t[i][s]||(t[i][s]=[]),t[i][s].push(r)}}return t};CKEDITOR.on("dialogDefinition",function(e){if(s==e.editor){var t=e.data.name,e=e.data.definition,n,r,i,o,u;"tableProperties"==t&&"table"==t,!("removeDialogFields"in s._)&&s.config.removeDialogFields&&(s._.removeDialogFields=f(s.config.removeDialogFields));if(s._.removeDialogFields&&(n=s._.removeDialogFields[t]))for(i in n){o=n[i],u=e.getContents(i);for(r=0;r<o.length;r++)u.remove(o[r])}!("hideDialogFields"in s._)&&s.config.hideDialogFields&&(s._.hideDialogFields=f(s.config.hideDialogFields));if(s._.hideDialogFields&&(n=s._.hideDialogFields[t]))for(i in n){o=n[i],u=e.getContents(i);for(r=0;r<o.length;r++)u.get(o[r]).hidden=!0}if(s.config.dialogFieldsDefaultValues&&(n=s.config.dialogFieldsDefaultValues[t]))for(i in n){o=n[i],u=e.getContents(i);for(var a in o)(t=u.get(a))&&(t["default"]=o[a])}}})}})}(),CKEDITOR.plugins.add("menu",{requires:"floatpanel",beforeInit:function(e){for(var t=e.config.menu_groups.split(","),n=e._.menuGroups={},r=e._.menuItems={},i=0;i<t.length;i++)n[t[i]]=i+1;e.addMenuGroup=function(e,t){n[e]=t||100},e.addMenuItem=function(e,t){n[t.group]&&(r[e]=new CKEDITOR.menuItem(this,e,t))},e.addMenuItems=function(e){for(var t in e)this.addMenuItem(t,e[t])},e.getMenuItem=function(e){return r[e]},e.removeMenuItem=function(e){delete r[e]}}}),function(){function e(e){e.sort(function(e,t){return e.group<t.group?-1:e.group>t.group?1:e.order<t.order?-1:e.order>t.order?1:0})}var t='<span class="cke_menuitem"><a id="{id}" class="cke_menubutton cke_menubutton__{name} cke_menubutton_{state} {cls}" href="{href}" title="{title}" tabindex="-1"_cke_focus=1 hidefocus="true" role="{role}" aria-haspopup="{hasPopup}" aria-disabled="{disabled}" {ariaChecked}';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(t+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(t+=' onblur="this.style.cssText = this.style.cssText;"');var t=t+(' onmouseover="CKEDITOR.tools.callFunction({hoverFn},{index});" onmouseout="CKEDITOR.tools.callFunction({moveOutFn},{index});" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},{index}); return false;">'),n=CKEDITOR.addTemplate("menuItem",t+'<span class="cke_menubutton_inner"><span class="cke_menubutton_icon"><span class="cke_button_icon cke_button__{iconName}_icon" style="{iconStyle}"></span></span><span class="cke_menubutton_label">{label}</span>{arrowHtml}</span></a></span>'),r=CKEDITOR.addTemplate("menuArrow",'<span class="cke_menuarrow"><span>{label}</span></span>');CKEDITOR.menu=CKEDITOR.tools.createClass({$:function(e,t){t=this._.definition=t||{},this.id=CKEDITOR.tools.getNextId(),this.editor=e,this.items=[],this._.listeners=[],this._.level=t.level||1;var n=CKEDITOR.tools.extend({},t.panel,{css:[CKEDITOR.skin.getPath("editor")],level:this._.level-1,block:{}}),r=n.block.attributes=n.attributes||{};!r.role&&(r.role="menu"),this._.panelDefinition=n},_:{onShow:function(){var e=this.editor.getSelection(),t=e&&e.getStartElement(),n=this.editor.elementPath(),r=this._.listeners;this.removeAll();for(var i=0;i<r.length;i++){var s=r[i](t,e,n);if(s)for(var o in s){var u=this.editor.getMenuItem(o);u&&(!u.command||this.editor.getCommand(u.command).state)&&(u.state=s[o],this.add(u))}}},onClick:function(e){this.hide(),e.onClick?e.onClick():e.command&&this.editor.execCommand(e.command)},onEscape:function(e){var t=this.parent;return t?t._.panel.hideChild(1):27==e&&this.hide(1),!1},onHide:function(){this.onHide&&this.onHide()},showSubMenu:function(e){var t=this._.subMenu,n=this.items[e];if(n=n.getItems&&n.getItems()){t?t.removeAll():(t=this._.subMenu=new CKEDITOR.menu(this.editor,CKEDITOR.tools.extend({},this._.definition,{level:this._.level+1},!0)),t.parent=this,t._.onClick=CKEDITOR.tools.bind(this._.onClick,this));for(var r in n){var i=this.editor.getMenuItem(r);i&&(i.state=n[r],t.add(i))}var s=this._.panel.getBlock(this.id).element.getDocument().getById(this.id+(""+e));setTimeout(function(){t.show(s,2)},0)}else this._.panel.hideChild(1)}},proto:{add:function(e){e.order||(e.order=this.items.length),this.items.push(e)},removeAll:function(){this.items=[]},show:function(t,n,r,i){if(!this.parent&&(this._.onShow(),!this.items.length))return;var n=n||("rtl"==this.editor.lang.dir?2:1),s=this.items,o=this.editor,u=this._.panel,a=this._.element;if(!u){u=this._.panel=new CKEDITOR.ui.floatPanel(this.editor,CKEDITOR.document.getBody(),this._.panelDefinition,this._.level),u.onEscape=CKEDITOR.tools.bind(function(e){if(!1===this._.onEscape(e))return!1},this),u.onShow=function(){u._.panel.getHolderElement().getParent().addClass("cke").addClass("cke_reset_all")},u.onHide=CKEDITOR.tools.bind(function(){this._.onHide&&this._.onHide()},this),a=u.addBlock(this.id,this._.panelDefinition.block),a.autoSize=!0;var f=a.keys;f[40]="next",f[9]="next",f[38]="prev",f[CKEDITOR.SHIFT+9]="prev",f["rtl"==o.lang.dir?37:39]=CKEDITOR.env.ie?"mouseup":"click",f[32]=CKEDITOR.env.ie?"mouseup":"click",CKEDITOR.env.ie&&(f[13]="mouseup"),a=this._.element=a.element,f=a.getDocument(),f.getBody().setStyle("overflow","hidden"),f.getElementsByTag("html").getItem(0).setStyle("overflow","hidden"),this._.itemOverFn=CKEDITOR.tools.addFunction(function(e){clearTimeout(this._.showSubTimeout),this._.showSubTimeout=CKEDITOR.tools.setTimeout(this._.showSubMenu,o.config.menu_subMenuDelay||400,this,[e])},this),this._.itemOutFn=CKEDITOR.tools.addFunction(function(){clearTimeout(this._.showSubTimeout)},this),this._.itemClickFn=CKEDITOR.tools.addFunction(function(e){var t=this.items[e];t.state==CKEDITOR.TRISTATE_DISABLED?this.hide(1):t.getItems?this._.showSubMenu(e):this._.onClick(t)},this)}e(s);for(var f=o.elementPath(),f=['<div class="cke_menu'+(f&&f.direction()!=o.lang.dir?" cke_mixed_dir_content":"")+'" role="presentation">'],l=s.length,c=l&&s[0].group,h=0;h<l;h++){var p=s[h];c!=p.group&&(f.push('<div class="cke_menuseparator" role="separator"></div>'),c=p.group),p.render(this,h,f)}f.push("</div>"),a.setHtml(f.join("")),CKEDITOR.ui.fire("ready",this),this.parent?this.parent._.panel.showAsChild(u,this.id,t,n,r,i):u.showBlock(this.id,t,n,r,i),o.fire("menuShow",[u])},addListener:function(e){this._.listeners.push(e)},hide:function(e){this._.onHide&&this._.onHide(),this._.panel&&this._.panel.hide(e)}}}),CKEDITOR.menuItem=CKEDITOR.tools.createClass({$:function(e,t,n){CKEDITOR.tools.extend(this,n,{order:0,className:"cke_menubutton__"+t}),this.group=e._.menuGroups[this.group],this.editor=e,this.name=t},proto:{render:function(e,t,i){var s=e.id+(""+t),o="undefined"==typeof this.state?CKEDITOR.TRISTATE_OFF:this.state,u="",a=o==CKEDITOR.TRISTATE_ON?"on":o==CKEDITOR.TRISTATE_DISABLED?"disabled":"off";this.role in{menuitemcheckbox:1,menuitemradio:1}&&(u=' aria-checked="'+(o==CKEDITOR.TRISTATE_ON?"true":"false")+'"');var f=this.getItems,c="&#"+("rtl"==this.editor.lang.dir?"9668":"9658")+";",h=this.name;this.icon&&!/\./.test(this.icon)&&(h=this.icon),e={id:s,name:this.name,iconName:h,label:this.label,cls:this.className||"",state:a,hasPopup:f?"true":"false",disabled:o==CKEDITOR.TRISTATE_DISABLED,title:this.label,href:"javascript:void('"+(this.label||"").replace("'")+"')",hoverFn:e._.itemOverFn,moveOutFn:e._.itemOutFn,clickFn:e._.itemClickFn,index:t,iconStyle:CKEDITOR.skin.getIconStyle(h,"rtl"==this.editor.lang.dir,h==this.icon?null:this.icon,this.iconOffset),arrowHtml:f?r.output({label:c}):"",role:this.role?this.role:"menuitem",ariaChecked:u},n.output(e,i)}}})}(),CKEDITOR.config.menu_groups="clipboard,form,tablecell,tablecellproperties,tablerow,tablecolumn,table,anchor,link,image,flash,checkbox,radio,textfield,hiddenfield,imagebutton,button,select,textarea,div",CKEDITOR.plugins.add("contextmenu",{requires:"menu",onLoad:function(){CKEDITOR.plugins.contextMenu=CKEDITOR.tools.createClass({base:CKEDITOR.menu,$:function(e){this.base.call(this,e,{panel:{className:"cke_menu_panel",attributes:{"aria-label":e.lang.contextmenu.options}}})},proto:{addTarget:function(e,t){e.on("contextmenu",function(e){var e=e.data,r=CKEDITOR.env.webkit?n:CKEDITOR.env.mac?e.$.metaKey:e.$.ctrlKey;if(!t||!r){e.preventDefault();if(CKEDITOR.env.mac&&CKEDITOR.env.webkit){var r=this.editor,i=(new CKEDITOR.dom.elementPath(e.getTarget(),r.editable())).contains(function(e){return e.hasAttribute("contenteditable")},!0);i&&"false"==i.getAttribute("contenteditable")&&r.getSelection().fake(i)}var i=e.getTarget().getDocument(),s=e.getTarget().getDocument().getDocumentElement(),r=!i.equals(CKEDITOR.document),i=i.getWindow().getScrollPosition(),o=r?e.$.clientX:e.$.pageX||i.x+e.$.clientX,u=r?e.$.clientY:e.$.pageY||i.y+e.$.clientY;CKEDITOR.tools.setTimeout(function(){this.open(s,null,o,u)},CKEDITOR.env.ie?200:0,this)}},this);if(CKEDITOR.env.webkit){var n,r=function(){n=0};e.on("keydown",function(e){n=CKEDITOR.env.mac?e.data.$.metaKey:e.data.$.ctrlKey}),e.on("keyup",r),e.on("contextmenu",r)}},open:function(e,t,n,r){this.editor.focus(),e=e||CKEDITOR.document.getDocumentElement(),this.editor.selectionChange(1),this.show(e,t,n,r)}}})},beforeInit:function(e){var t=e.contextMenu=new CKEDITOR.plugins.contextMenu(e);e.on("contentDom",function(){t.addTarget(e.editable(),!1!==e.config.browserContextMenuOnCtrl)}),e.addCommand("contextMenu",{exec:function(){e.contextMenu.open(e.document.getBody())}}),e.setKeystroke(CKEDITOR.SHIFT+121,"contextMenu"),e.setKeystroke(CKEDITOR.CTRL+CKEDITOR.SHIFT+121,"contextMenu")}}),function(){function e(e,t,n){n=e.config.forceEnterMode||n,"wysiwyg"==e.mode&&(t||(t=e.activeEnterMode),e.elementPath().isContextFor("p")||(t=CKEDITOR.ENTER_BR,n=1),e.fire("saveSnapshot"),t==CKEDITOR.ENTER_BR?o(e,t,null,n):u(e,t,null,n),e.fire("saveSnapshot"))}function t(e){for(var e=e.getSelection().getRanges(!0),t=e.length-1;0<t;t--)e[t].deleteContents();return e[0]}function n(e){var t=e.startContainer.getAscendant(function(e){return e.type==CKEDITOR.NODE_ELEMENT&&"true"==e.getAttribute("contenteditable")},!0);return e.root.equals(t)?e:(t=new CKEDITOR.dom.range(t),t.moveToRange(e),t)}CKEDITOR.plugins.add("enterkey",{init:function(t){t.addCommand("enter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(t){e(t)}}),t.addCommand("shiftEnter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(t){e(t,t.activeShiftEnterMode,1)}}),t.setKeystroke([[13,"enter"],[CKEDITOR.SHIFT+13,"shiftEnter"]])}});var r=CKEDITOR.dom.walker.whitespaces(),i=CKEDITOR.dom.walker.bookmark();CKEDITOR.plugins.enterkey={enterBlock:function(e,s,u,f){if(u=u||t(e)){var u=n(u),l=u.document,c=u.checkStartOfBlock(),h=u.checkEndOfBlock(),d=e.elementPath(u.startContainer),m=d.block,g=s==CKEDITOR.ENTER_DIV?"div":"p",y;if(c&&h){if(m&&(m.is("li")||m.getParent().is("li"))){m.is("li")||(m=m.getParent()),u=m.getParent(),y=u.getParent();var f=!m.hasPrevious(),b=!m.hasNext(),g=e.getSelection(),E=g.createBookmarks(),c=m.getDirection(1),h=m.getAttribute("class"),S=m.getAttribute("style"),x=y.getDirection(1)!=c,e=e.enterMode!=CKEDITOR.ENTER_BR||x||S||h;if(y.is("li"))f||b?(f&&b&&u.remove(),m[b?"insertAfter":"insertBefore"](y)):m.breakParent(y);else{if(e)(d.block.is("li")?(y=l.createElement(s==CKEDITOR.ENTER_P?"p":"div"),x&&y.setAttribute("dir",c),S&&y.setAttribute("style",S),h&&y.setAttribute("class",h),m.moveChildren(y)):y=d.block,f||b)?y[f?"insertBefore":"insertAfter"](u):(m.breakParent(u),y.insertAfter(u));else if(m.appendBogus(!0),f||b)for(;l=m[f?"getFirst":"getLast"]();)l[f?"insertBefore":"insertAfter"](u);else for(m.breakParent(u);l=m.getLast();)l.insertAfter(u);m.remove()}g.selectBookmarks(E);return}if(m&&m.getParent().is("blockquote")){m.breakParent(m.getParent()),m.getPrevious().getFirst(CKEDITOR.dom.walker.invisible(1))||m.getPrevious().remove(),m.getNext().getFirst(CKEDITOR.dom.walker.invisible(1))||m.getNext().remove(),u.moveToElementEditStart(m),u.select();return}}else if(m&&m.is("pre")&&!h){o(e,s,u,f);return}if(c=u.splitBlock(g)){s=c.previousBlock,m=c.nextBlock,d=c.wasStartOfBlock,e=c.wasEndOfBlock,m?(E=m.getParent(),E.is("li")&&(m.breakParent(E),m.move(m.getNext(),1))):s&&(E=s.getParent())&&E.is("li")&&(s.breakParent(E),E=s.getNext(),u.moveToElementEditStart(E),s.move(s.getPrevious()));if(!d&&!e)m.is("li")&&(y=u.clone(),y.selectNodeContents(m),y=new CKEDITOR.dom.walker(y),y.evaluator=function(e){return!(i(e)||r(e)||e.type==CKEDITOR.NODE_ELEMENT&&e.getName()in CKEDITOR.dtd.$inline&&!(e.getName()in CKEDITOR.dtd.$empty))},(E=y.next())&&E.type==CKEDITOR.NODE_ELEMENT&&E.is("ul","ol")&&(CKEDITOR.env.needsBrFiller?l.createElement("br"):l.createText(" ")).insertBefore(E)),m&&u.moveToElementEditStart(m);else{if(s){if(s.is("li")||!a.test(s.getName())&&!s.is("pre"))y=s.clone()}else m&&(y=m.clone());y?f&&!y.is("li")&&y.renameNode(g):E&&E.is("li")?y=E:(y=l.createElement(g),s&&(b=s.getDirection())&&y.setAttribute("dir",b));if(l=c.elementPath){f=0;for(g=l.elements.length;f<g;f++){E=l.elements[f];if(E.equals(l.block)||E.equals(l.blockLimit))break;CKEDITOR.dtd.$removeEmpty[E.getName()]&&(E=E.clone(),y.moveChildren(E),y.append(E))}}y.appendBogus(),y.getParent()||u.insertNode(y),y.is("li")&&y.removeAttribute("value"),CKEDITOR.env.ie&&d&&(!e||!s.getChildCount())&&(u.moveToElementEditStart(e?s:y),u.select()),u.moveToElementEditStart(d&&!e?m:y)}u.select(),u.scrollIntoView()}}},enterBr:function(e,n,r,i){if(r=r||t(e)){var s=r.document,o=r.checkEndOfBlock(),f=new CKEDITOR.dom.elementPath(e.getSelection().getStartElement()),l=f.block,c=l&&f.block.getName();!i&&"li"==c?u(e,n,r,i):(!i&&o&&a.test(c)?(o=l.getDirection())?(s=s.createElement("div"),s.setAttribute("dir",o),s.insertAfter(l),r.setStart(s,0)):(s.createElement("br").insertAfter(l),CKEDITOR.env.gecko&&s.createText("").insertAfter(l),r.setStartAt(l.getNext(),CKEDITOR.env.ie?CKEDITOR.POSITION_BEFORE_START:CKEDITOR.POSITION_AFTER_START)):(e="pre"==c&&CKEDITOR.env.ie&&8>CKEDITOR.env.version?s.createText("\r"):s.createElement("br"),r.deleteContents(),r.insertNode(e),CKEDITOR.env.needsBrFiller?(s.createText("﻿").insertAfter(e),o&&(l||f.blockLimit).appendBogus(),e.getNext().$.nodeValue="",r.setStartAt(e.getNext(),CKEDITOR.POSITION_AFTER_START)):r.setStartAt(e,CKEDITOR.POSITION_AFTER_END)),r.collapse(!0),r.select(),r.scrollIntoView())}}};var s=CKEDITOR.plugins.enterkey,o=s.enterBr,u=s.enterBlock,a=/^h[1-6]$/}(),function(){function e(e,t){var n={},r=[],i={nbsp:" ",shy:"­",gt:">",lt:"<",amp:"&",apos:"'",quot:'"'},e=e.replace(/\b(nbsp|shy|gt|lt|amp|apos|quot)(?:,|$)/g,function(e,s){var o=t?"&"+s+";":i[s];return n[o]=t?i[s]:"&"+s+";",r.push(o),""});if(!t&&e){var e=e.split(","),s=document.createElement("div"),o;s.innerHTML="&"+e.join(";&")+";",o=s.innerHTML,s=null;for(s=0;s<o.length;s++){var u=o.charAt(s);n[u]="&"+e[s]+";",r.push(u)}}return n.regex=r.join(t?"|":""),n}CKEDITOR.plugins.add("entities",{afterInit:function(t){function n(e){return f[e]}function r(e){return"force"==s.entities_processNumerical||!u[e]?"&#"+e.charCodeAt(0)+";":u[e]}var s=t.config;if(t=(t=t.dataProcessor)&&t.htmlFilter){var o=[];!1!==s.basicEntities&&o.push("nbsp,gt,lt,amp"),s.entities&&(o.length&&o.push("quot,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,times,divide,fnof,bull,hellip,prime,Prime,oline,frasl,weierp,image,real,trade,alefsym,larr,uarr,rarr,darr,harr,crarr,lArr,uArr,rArr,dArr,hArr,forall,part,exist,empty,nabla,isin,notin,ni,prod,sum,minus,lowast,radic,prop,infin,ang,and,or,cap,cup,int,there4,sim,cong,asymp,ne,equiv,le,ge,sub,sup,nsub,sube,supe,oplus,otimes,perp,sdot,lceil,rceil,lfloor,rfloor,lang,rang,loz,spades,clubs,hearts,diams,circ,tilde,ensp,emsp,thinsp,zwnj,zwj,lrm,rlm,ndash,mdash,lsquo,rsquo,sbquo,ldquo,rdquo,bdquo,dagger,Dagger,permil,lsaquo,rsaquo,euro"),s.entities_latin&&o.push("Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml,OElig,oelig,Scaron,scaron,Yuml"),s.entities_greek&&o.push("Alpha,Beta,Gamma,Delta,Epsilon,Zeta,Eta,Theta,Iota,Kappa,Lambda,Mu,Nu,Xi,Omicron,Pi,Rho,Sigma,Tau,Upsilon,Phi,Chi,Psi,Omega,alpha,beta,gamma,delta,epsilon,zeta,eta,theta,iota,kappa,lambda,mu,nu,xi,omicron,pi,rho,sigmaf,sigma,tau,upsilon,phi,chi,psi,omega,thetasym,upsih,piv"),s.entities_additional&&o.push(s.entities_additional));var u=e(o.join(",")),a=u.regex?"["+u.regex+"]":"a^";delete u.regex,s.entities&&s.entities_processNumerical&&(a="[^ -~]|"+a);var a=RegExp(a,"g"),f=e("nbsp,gt,lt,amp,shy",!0),l=RegExp(f.regex,"g");t.addRules({text:function(e){return e.replace(l,n).replace(a,r)}},{applyToAll:!0,excludeNestedEditable:!0})}}})}(),CKEDITOR.config.basicEntities=!0,CKEDITOR.config.entities=!0,CKEDITOR.config.entities_latin=!0,CKEDITOR.config.entities_greek=!0,CKEDITOR.config.entities_additional="#39",function(){function e(e){var r=e.config,i=e.fire("uiSpace",{space:"top",html:""}).html,o=function(){function i(e,t,r){a.setStyle(t,n(r)),a.setStyle("position",e)}function u(e){var t=l.getDocumentPosition();switch(e){case"top":i("absolute","top",t.y-v-w);break;case"pin":i("fixed","top",S);break;case"bottom":i("absolute","top",t.y+(h.height||h.bottom-h.top)+w)}f=e}var f,l,c,h,d,v,m,y=r.floatSpaceDockedOffsetX||0,w=r.floatSpaceDockedOffsetY||0,E=r.floatSpacePinnedOffsetX||0,S=r.floatSpacePinnedOffsetY||0;return function(i){if(l=e.editable()){var S=i&&"focus"==i.name;S&&a.show(),e.fire("floatingSpaceLayout",{show:S}),a.removeStyle("left"),a.removeStyle("right"),c=a.getClientRect(),h=l.getClientRect(),d=t.getViewPaneSize(),v=c.height,m="pageXOffset"in t.$?t.$.pageXOffset:CKEDITOR.document.$.documentElement.scrollLeft,f?(v+w<=h.top?u("top"):v+w>d.height-h.bottom?u("pin"):u("bottom"),i=d.width/2,i=r.floatSpacePreferRight?"right":0<h.left&&h.right<d.width&&h.width>c.width?"rtl"==r.contentsLangDirection?"right":"left":i-h.left>h.right-i?"left":"right",c.width>d.width?(i="left",S=0):(S="left"==i?0<h.left?h.left:0:h.right<d.width?d.width-h.right:0,S+c.width>d.width&&(i="left"==i?"right":"left",S=0)),a.setStyle(i,n(("pin"==f?E:y)+S+("pin"==f?0:"left"==i?m:-m)))):(f="pin",u("pin"),o(i))}}}();if(i){var u=new CKEDITOR.template('<div id="cke_{name}" class="cke {id} cke_reset_all cke_chrome cke_editor_{name} cke_float cke_{langDir} '+CKEDITOR.env.cssClass+'" dir="{langDir}" title="'+(CKEDITOR.env.gecko?" ":"")+'" lang="{langCode}" role="application" style="{style}"'+(e.title?' aria-labelledby="cke_{name}_arialbl"':" ")+">"+(e.title?'<span id="cke_{name}_arialbl" class="cke_voice_label">{voiceLabel}</span>':" ")+'<div class="cke_inner"><div id="{topId}" class="cke_top" role="presentation">{content}</div></div></div>'),a=CKEDITOR.document.getBody().append(CKEDITOR.dom.element.createFromHtml(u.output({content:i,id:e.id,langDir:e.lang.dir,langCode:e.langCode,name:e.name,style:"display:none;z-index:"+(r.baseFloatZIndex-1),topId:e.ui.spaceId("top"),voiceLabel:e.title}))),f=CKEDITOR.tools.eventsBuffer(500,o),l=CKEDITOR.tools.eventsBuffer(100,o);a.unselectable(),a.on("mousedown",function(e){e=e.data,e.getTarget().hasAscendant("a",1)||e.preventDefault()}),e.on("focus",function(n){o(n),e.on("change",f.input),t.on("scroll",l.input),t.on("resize",l.input)}),e.on("blur",function(){a.hide(),e.removeListener("change",f.input),t.removeListener("scroll",l.input),t.removeListener("resize",l.input)}),e.on("destroy",function(){t.removeListener("scroll",l.input),t.removeListener("resize",l.input),a.clearCustomData(),a.remove()}),e.focusManager.hasFocus&&a.show(),e.focusManager.add(a,1)}}var t=CKEDITOR.document.getWindow(),n=CKEDITOR.tools.cssLength;CKEDITOR.plugins.add("floatingspace",{init:function(t){t.on("loaded",function(){e(this)},null,null,20)}})}(),CKEDITOR.plugins.add("listblock",{requires:"panel",onLoad:function(){var e=CKEDITOR.addTemplate("panel-list",'<ul role="presentation" class="cke_panel_list">{items}</ul>'),t=CKEDITOR.addTemplate("panel-list-item",'<li id="{id}" class="cke_panel_listItem" role=presentation><a id="{id}_option" _cke_focus=1 hidefocus=true title="{title}" href="javascript:void(\'{val}\')"  {onclick}="CKEDITOR.tools.callFunction({clickFn},\'{val}\'); return false;" role="option">{text}</a></li>'),n=CKEDITOR.addTemplate("panel-list-group",'<h1 id="{id}" class="cke_panel_grouptitle" role="presentation" >{label}</h1>'),r=/\'/g;CKEDITOR.ui.panel.prototype.addListBlock=function(e,t){return this.addBlock(e,new CKEDITOR.ui.listBlock(this.getHolderElement(),t))},CKEDITOR.ui.listBlock=CKEDITOR.tools.createClass({base:CKEDITOR.ui.panel.block,$:function(e,t){var t=t||{},n=t.attributes||(t.attributes={});(this.multiSelect=!!t.multiSelect)&&(n["aria-multiselectable"]=!0),!n.role&&(n.role="listbox"),this.base.apply(this,arguments),this.element.setAttribute("role",n.role),n=this.keys,n[40]="next",n[9]="next",n[38]="prev",n[CKEDITOR.SHIFT+9]="prev",n[32]=CKEDITOR.env.ie?"mouseup":"click",CKEDITOR.env.ie&&(n[13]="mouseup"),this._.pendingHtml=[],this._.pendingList=[],this._.items={},this._.groups={}},_:{close:function(){if(this._.started){var t=e.output({items:this._.pendingList.join("")});this._.pendingList=[],this._.pendingHtml.push(t),delete this._.started}},getClick:function(){return this._.click||(this._.click=CKEDITOR.tools.addFunction(function(e){var t=this.toggle(e);this.onClick&&this.onClick(e,t)},this)),this._.click}},proto:{add:function(e,n,s){var o=CKEDITOR.tools.getNextId();this._.started||(this._.started=1,this._.size=this._.size||0),this._.items[e]=o;var u;u=CKEDITOR.tools.htmlEncodeAttr(e).replace(r,"\\'"),e={id:o,val:u,onclick:CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick",clickFn:this._.getClick(),title:CKEDITOR.tools.htmlEncodeAttr(s||e),text:n||e},this._.pendingList.push(t.output(e))},startGroup:function(e){this._.close();var t=CKEDITOR.tools.getNextId();this._.groups[e]=t,this._.pendingHtml.push(n.output({id:t,label:e}))},commit:function(){this._.close(),this.element.appendHtml(this._.pendingHtml.join("")),delete this._.size,this._.pendingHtml=[]},toggle:function(e){var t=this.isMarked(e);return t?this.unmark(e):this.mark(e),!t},hideGroup:function(e){var t=(e=this.element.getDocument().getById(this._.groups[e]))&&e.getNext();e&&(e.setStyle("display","none"),t&&"ul"==t.getName()&&t.setStyle("display","none"))},hideItem:function(e){this.element.getDocument().getById(this._.items[e]).setStyle("display","none")},showAll:function(){var e=this._.items,t=this._.groups,n=this.element.getDocument(),r;for(r in e)n.getById(e[r]).setStyle("display","");for(var i in t)e=n.getById(t[i]),r=e.getNext(),e.setStyle("display",""),r&&"ul"==r.getName()&&r.setStyle("display","")},mark:function(e){this.multiSelect||this.unmarkAll();var e=this._.items[e],t=this.element.getDocument().getById(e);t.addClass("cke_selected"),this.element.getDocument().getById(e+"_option").setAttribute("aria-selected",!0),this.onMark&&this.onMark(t)},unmark:function(e){var t=this.element.getDocument(),e=this._.items[e],n=t.getById(e);n.removeClass("cke_selected"),t.getById(e+"_option").removeAttribute("aria-selected"),this.onUnmark&&this.onUnmark(n)},unmarkAll:function(){var e=this._.items,t=this.element.getDocument(),n;for(n in e){var r=e[n];t.getById(r).removeClass("cke_selected"),t.getById(r+"_option").removeAttribute("aria-selected")}this.onUnmark&&this.onUnmark()},isMarked:function(e){return this.element.getDocument().getById(this._.items[e]).hasClass("cke_selected")},focus:function(e){this._.focusIndex=-1;var t=this.element.getElementsByTag("a"),n,r=-1;if(e){for(n=this.element.getDocument().getById(this._.items[e]).getFirst();e=t.getItem(++r);)if(e.equals(n)){this._.focusIndex=r;break}}else this.element.focus();n&&setTimeout(function(){n.focus()},0)}}})}}),CKEDITOR.plugins.add("richcombo",{requires:"floatpanel,listblock,button",beforeInit:function(e){e.ui.addHandler(CKEDITOR.UI_RICHCOMBO,CKEDITOR.ui.richCombo.handler)}}),function(){var e='<span id="{id}" class="cke_combo cke_combo__{name} {cls}" role="presentation"><span id="{id}_label" class="cke_combo_label">{label}</span><a class="cke_combo_button" title="{title}" tabindex="-1"'+(CKEDITOR.env.gecko&&!CKEDITOR.env.hc?"":" href=\"javascript:void('{titleJs}')\"")+' hidefocus="true" role="button" aria-labelledby="{id}_label" aria-haspopup="true"';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(e+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(e+=' onblur="this.style.cssText = this.style.cssText;"');var e=e+(' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event,this);" onfocus="return CKEDITOR.tools.callFunction({focusFn},event);" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},this);return false;"><span id="{id}_text" class="cke_combo_text cke_combo_inlinelabel">{label}</span><span class="cke_combo_open"><span class="cke_combo_arrow">'+(CKEDITOR.env.hc?"&#9660;":CKEDITOR.env.air?"&nbsp;":"")+"</span></span></a></span>"),t=CKEDITOR.addTemplate("combo",e);CKEDITOR.UI_RICHCOMBO="richcombo",CKEDITOR.ui.richCombo=CKEDITOR.tools.createClass({$:function(e){CKEDITOR.tools.extend(this,e,{canGroup:!1,title:e.label,modes:{wysiwyg:1},editorFocus:1}),e=this.panel||{},delete this.panel,this.id=CKEDITOR.tools.getNextNumber(),this.document=e.parent&&e.parent.getDocument()||CKEDITOR.document,e.className="cke_combopanel",e.block={multiSelect:e.multiSelect,attributes:e.attributes},e.toolbarRelated=!0,this._={panelDefinition:e,items:{}}},proto:{renderHtml:function(e){var t=[];return this.render(e,t),t.join("")},render:function(e,n){function r(){if(this.getState()!=CKEDITOR.TRISTATE_ON){var t=this.modes[e.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED;e.readOnly&&!this.readOnly&&(t=CKEDITOR.TRISTATE_DISABLED),this.setState(t),this.setValue(""),t!=CKEDITOR.TRISTATE_DISABLED&&this.refresh&&this.refresh()}}var s=CKEDITOR.env,o="cke_"+this.id,u=CKEDITOR.tools.addFunction(function(t){h&&(e.unlockSelection(1),h=0),f.execute(t)},this),a=this,f={id:o,combo:this,focus:function(){CKEDITOR.document.getById(o).getChild(1).focus()},execute:function(t){var n=a._;if(n.state!=CKEDITOR.TRISTATE_DISABLED)if(a.createPanel(e),n.on)n.panel.hide();else{a.commit();var r=a.getValue();r?n.list.mark(r):n.list.unmarkAll(),n.panel.showBlock(a.id,new CKEDITOR.dom.element(t),4)}},clickFn:u};e.on("activeFilterChange",r,this),e.on("mode",r,this),e.on("selectionChange",r,this),!this.readOnly&&e.on("readOnly",r,this);var l=CKEDITOR.tools.addFunction(function(t,n){var t=new CKEDITOR.dom.event(t),r=t.getKeystroke();40==r&&e.once("panelShow",function(e){e.data._.panel._.currentBlock.onKeyDown(40)});switch(r){case 13:case 32:case 40:CKEDITOR.tools.callFunction(u,n);break;default:f.onkey(f,r)}t.preventDefault()}),c=CKEDITOR.tools.addFunction(function(){f.onfocus&&f.onfocus()}),h=0;return f.keyDownFn=l,s={id:o,name:this.name||this.command,label:this.label,title:this.title,cls:this.className||"",titleJs:s.gecko&&!s.hc?"":(this.title||"").replace("'",""),keydownFn:l,focusFn:c,clickFn:u},t.output(s,n),this.onRender&&this.onRender(),f},createPanel:function(e){if(!this._.panel){var t=this._.panelDefinition,n=this._.panelDefinition.block,r=t.parent||CKEDITOR.document.getBody(),i="cke_combopanel__"+this.name,s=new CKEDITOR.ui.floatPanel(e,r,t),o=s.addListBlock(this.id,n),u=this;s.onShow=function(){this.element.addClass(i),u.setState(CKEDITOR.TRISTATE_ON),u._.on=1,u.editorFocus&&!e.focusManager.hasFocus&&e.focus(),u.onOpen&&u.onOpen(),e.once("panelShow",function(){o.focus(!o.multiSelect&&u.getValue())})},s.onHide=function(t){this.element.removeClass(i),u.setState(u.modes&&u.modes[e.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),u._.on=0,!t&&u.onClose&&u.onClose()},s.onEscape=function(){s.hide(1)},o.onClick=function(e,t){u.onClick&&u.onClick.call(u,e,t),s.hide()},this._.panel=s,this._.list=o,s.getBlock(this.id).onHide=function(){u._.on=0,u.setState(CKEDITOR.TRISTATE_OFF)},this.init&&this.init()}},setValue:function(e,t){this._.value=e;var n=this.document.getById("cke_"+this.id+"_text");n&&(!e&&!t?(t=this.label,n.addClass("cke_combo_inlinelabel")):n.removeClass("cke_combo_inlinelabel"),n.setText("undefined"!=typeof t?t:e))},getValue:function(){return this._.value||""},unmarkAll:function(){this._.list.unmarkAll()},mark:function(e){this._.list.mark(e)},hideItem:function(e){this._.list.hideItem(e)},hideGroup:function(e){this._.list.hideGroup(e)},showAll:function(){this._.list.showAll()},add:function(e,t,n){this._.items[e]=n||e,this._.list.add(e,t,n)},startGroup:function(e){this._.list.startGroup(e)},commit:function(){this._.committed||(this._.list.commit(),this._.committed=1,CKEDITOR.ui.fire("ready",this)),this._.committed=1},setState:function(e){if(this._.state!=e){var t=this.document.getById("cke_"+this.id);t.setState(e,"cke_combo"),e==CKEDITOR.TRISTATE_DISABLED?t.setAttribute("aria-disabled",!0):t.removeAttribute("aria-disabled"),this._.state=e}},getState:function(){return this._.state},enable:function(){this._.state==CKEDITOR.TRISTATE_DISABLED&&this.setState(this._.lastState)},disable:function(){this._.state!=CKEDITOR.TRISTATE_DISABLED&&(this._.lastState=this._.state,this.setState(CKEDITOR.TRISTATE_DISABLED))}},statics:{handler:{create:function(e){return new CKEDITOR.ui.richCombo(e)}}}}),CKEDITOR.ui.prototype.addRichCombo=function(e,t){this.add(e,CKEDITOR.UI_RICHCOMBO,t)}}(),function(){function e(e,n,r,i,s,u,a,f){for(var l=e.config,c=new CKEDITOR.style(a),h=s.split(";"),s=[],p={},d=0;d<h.length;d++){var v=h[d];if(v){var v=v.split("/"),m={},g=h[d]=v[0];m[r]=s[d]=v[1]||g,p[g]=new CKEDITOR.style(a,m),p[g]._.definition.name=g}else h.splice(d--,1)}e.ui.addRichCombo(n,{label:i.label,title:i.panelTitle,toolbar:"styles,"+f,allowedContent:c,requiredContent:c,panel:{css:[CKEDITOR.skin.getPath("editor")].concat(l.contentsCss),multiSelect:!1,attributes:{"aria-label":i.panelTitle}},init:function(){this.startGroup(i.panelTitle);for(var e=0;e<h.length;e++){var t=h[e];this.add(t,p[t].buildPreview(),t)}},onClick:function(n){e.focus(),e.fire("saveSnapshot");var r=this.getValue(),i=p[n];if(r&&n!=r){var s=p[r],u=e.getSelection().getRanges()[0];if(u.collapsed){var a=e.elementPath(),f=a.contains(function(e){return s.checkElementRemovable(e)});if(f){var l=u.checkBoundaryOfElement(f,CKEDITOR.START),c=u.checkBoundaryOfElement(f,CKEDITOR.END);if(l&&c){for(l=u.createBookmark();a=f.getFirst();)a.insertBefore(f);f.remove(),u.moveToBookmark(l)}else l?u.moveToPosition(f,CKEDITOR.POSITION_BEFORE_START):c?u.moveToPosition(f,CKEDITOR.POSITION_AFTER_END):(u.splitElement(f),u.moveToPosition(f,CKEDITOR.POSITION_AFTER_END),t(u,a.elements.slice(),f));e.getSelection().selectRanges([u])}}else e.removeStyle(s)}e[r==n?"removeStyle":"applyStyle"](i),e.fire("saveSnapshot")},onRender:function(){e.on("selectionChange",function(t){for(var n=this.getValue(),t=t.data.path.elements,r=0,i;r<t.length;r++){i=t[r];for(var s in p)if(p[s].checkElementMatch(i,!0,e)){s!=n&&this.setValue(s);return}}this.setValue("",u)},this)},refresh:function(){e.activeFilter.check(c)||this.setState(CKEDITOR.TRISTATE_DISABLED)}})}function t(e,n,r){var i=n.pop();if(i){if(r)return t(e,n,i.equals(r)?null:r);r=i.clone(),e.insertNode(r),e.moveToPosition(r,CKEDITOR.POSITION_AFTER_START),t(e,n)}}CKEDITOR.plugins.add("font",{requires:"richcombo",init:function(t){var n=t.config;e(t,"Font","family",t.lang.font,n.font_names,n.font_defaultLabel,n.font_style,30),e(t,"FontSize","size",t.lang.font.fontSize,n.fontSize_sizes,n.fontSize_defaultLabel,n.fontSize_style,40)}})}(),CKEDITOR.config.font_names="Arial/Arial, Helvetica, sans-serif;Comic Sans MS/Comic Sans MS, cursive;Courier New/Courier New, Courier, monospace;Georgia/Georgia, serif;Lucida Sans Unicode/Lucida Sans Unicode, Lucida Grande, sans-serif;Tahoma/Tahoma, Geneva, sans-serif;Times New Roman/Times New Roman, Times, serif;Trebuchet MS/Trebuchet MS, Helvetica, sans-serif;Verdana/Verdana, Geneva, sans-serif",CKEDITOR.config.font_defaultLabel="",CKEDITOR.config.font_style={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]},CKEDITOR.config.fontSize_sizes="8/8px;9/9px;10/10px;11/11px;12/12px;14/14px;16/16px;18/18px;20/20px;22/22px;24/24px;26/26px;28/28px;36/36px;48/48px;72/72px",CKEDITOR.config.fontSize_defaultLabel="",CKEDITOR.config.fontSize_style={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]},CKEDITOR.plugins.add("format",{requires:"richcombo",init:function(e){if(!e.blockless){for(var t=e.config,n=e.lang.format,r=t.format_tags.split(";"),i={},s=0,o=[],u=0;u<r.length;u++){var a=r[u],f=new CKEDITOR.style(t["format_"+a]);if(!e.filter.customConfig||e.filter.check(f))s++,i[a]=f,i[a]._.enterMode=e.config.enterMode,o.push(f)}0!==s&&e.ui.addRichCombo("Format",{label:n.label,title:n.panelTitle,toolbar:"styles,20",allowedContent:o,panel:{css:[CKEDITOR.skin.getPath("editor")].concat(t.contentsCss),multiSelect:!1,attributes:{"aria-label":n.panelTitle}},init:function(){this.startGroup(n.panelTitle);for(var e in i){var t=n["tag_"+e];this.add(e,i[e].buildPreview(t),t)}},onClick:function(t){e.focus(),e.fire("saveSnapshot");var t=i[t],n=e.elementPath();e[t.checkActive(n,e)?"removeStyle":"applyStyle"](t),setTimeout(function(){e.fire("saveSnapshot")},0)},onRender:function(){e.on("selectionChange",function(t){var n=this.getValue(),t=t.data.path;this.refresh();for(var r in i)if(i[r].checkActive(t,e)){r!=n&&this.setValue(r,e.lang.format["tag_"+r]);return}this.setValue("")},this)},onOpen:function(){this.showAll();for(var t in i)e.activeFilter.check(i[t])||this.hideItem(t)},refresh:function(){var t=e.elementPath();if(t){if(t.isContextFor("p"))for(var n in i)if(e.activeFilter.check(i[n]))return;this.setState(CKEDITOR.TRISTATE_DISABLED)}}})}}}),CKEDITOR.config.format_tags="p;h1;h2;h3;h4;h5;h6;pre;address;div",CKEDITOR.config.format_p={element:"p"},CKEDITOR.config.format_div={element:"div"},CKEDITOR.config.format_pre={element:"pre"},CKEDITOR.config.format_address={element:"address"},CKEDITOR.config.format_h1={element:"h1"},CKEDITOR.config.format_h2={element:"h2"},CKEDITOR.config.format_h3={element:"h3"},CKEDITOR.config.format_h4={element:"h4"},CKEDITOR.config.format_h5={element:"h5"},CKEDITOR.config.format_h6={element:"h6"},CKEDITOR.plugins.add("htmlwriter",{init:function(e){var t=new CKEDITOR.htmlWriter;t.forceSimpleAmpersand=e.config.forceSimpleAmpersand,t.indentationChars=e.config.dataIndentationChars||"	",e.dataProcessor.writer=t}}),CKEDITOR.htmlWriter=CKEDITOR.tools.createClass({base:CKEDITOR.htmlParser.basicWriter,$:function(){this.base(),this.indentationChars="	",this.selfClosingEnd=" />",this.lineBreakChars="\n",this.sortAttributes=1,this._.indent=0,this._.indentation="",this._.inPre=0,this._.rules={};var e=CKEDITOR.dtd,t;for(t in CKEDITOR.tools.extend({},e.$nonBodyContent,e.$block,e.$listItem,e.$tableContent))this.setRules(t,{indent:!e[t]["#"],breakBeforeOpen:1,breakBeforeClose:!e[t]["#"],breakAfterClose:1,needsSpace:t in e.$block&&!(t in{li:1,dt:1,dd:1})});this.setRules("br",{breakAfterOpen:1}),this.setRules("title",{indent:0,breakAfterOpen:0}),this.setRules("style",{indent:0,breakBeforeClose:1}),this.setRules("pre",{breakAfterOpen:1,indent:0})},proto:{openTag:function(e){var t=this._.rules[e];this._.afterCloser&&t&&t.needsSpace&&this._.needsSpace&&this._.output.push("\n"),this._.indent?this.indentation():t&&t.breakBeforeOpen&&(this.lineBreak(),this.indentation()),this._.output.push("<",e),this._.afterCloser=0},openTagClose:function(e,t){var n=this._.rules[e];t?(this._.output.push(this.selfClosingEnd),n&&n.breakAfterClose&&(this._.needsSpace=n.needsSpace)):(this._.output.push(">"),n&&n.indent&&(this._.indentation+=this.indentationChars)),n&&n.breakAfterOpen&&this.lineBreak(),"pre"==e&&(this._.inPre=1)},attribute:function(e,t){"string"==typeof t&&(this.forceSimpleAmpersand&&(t=t.replace(/&amp;/g,"&")),t=CKEDITOR.tools.htmlEncodeAttr(t)),this._.output.push(" ",e,'="',t,'"')},closeTag:function(e){var t=this._.rules[e];t&&t.indent&&(this._.indentation=this._.indentation.substr(this.indentationChars.length)),this._.indent?this.indentation():t&&t.breakBeforeClose&&(this.lineBreak(),this.indentation()),this._.output.push("</",e,">"),"pre"==e&&(this._.inPre=0),t&&t.breakAfterClose&&(this.lineBreak(),this._.needsSpace=t.needsSpace),this._.afterCloser=1},text:function(e){this._.indent&&(this.indentation(),!this._.inPre&&(e=CKEDITOR.tools.ltrim(e))),this._.output.push(e)},comment:function(e){this._.indent&&this.indentation(),this._.output.push("<!--",e,"-->")},lineBreak:function(){!this._.inPre&&0<this._.output.length&&this._.output.push(this.lineBreakChars),this._.indent=1},indentation:function(){!this._.inPre&&this._.indentation&&this._.output.push(this._.indentation),this._.indent=0},reset:function(){this._.output=[],this._.indent=0,this._.indentation="",this._.afterCloser=0,this._.inPre=0},setRules:function(e,t){var n=this._.rules[e];n?CKEDITOR.tools.extend(n,t,!0):this._.rules[e]=t}}}),function(){function e(e,t){CKEDITOR.tools.extend(this,{editor:e,editable:e.editable(),doc:e.document,win:e.window},t,!0),this.inline=this.editable.isInline(),this.inline||(this.frame=this.win.getFrame()),this.target=this[this.inline?"editable":"doc"]}function t(e,t){CKEDITOR.tools.extend(this,t,{editor:e},!0)}function n(e,t){var n=e.editable();CKEDITOR.tools.extend(this,{editor:e,editable:n,inline:n.isInline(),doc:e.document,win:e.window,container:CKEDITOR.document.getBody(),winTop:CKEDITOR.document.getWindow()},t,!0),this.hidden={},this.visible={},this.inline||(this.frame=this.win.getFrame()),this.queryViewport();var r=CKEDITOR.tools.bind(this.queryViewport,this),u=CKEDITOR.tools.bind(this.hideVisible,this),a=CKEDITOR.tools.bind(this.removeAll,this);n.attachListener(this.winTop,"resize",r),n.attachListener(this.winTop,"scroll",r),n.attachListener(this.winTop,"resize",u),n.attachListener(this.win,"scroll",u),n.attachListener(this.inline?n:this.frame,"mouseout",function(e){var t=e.data.$.clientX,e=e.data.$.clientY;this.queryViewport(),(t<=this.rect.left||t>=this.rect.right||e<=this.rect.top||e>=this.rect.bottom)&&this.hideVisible(),(t<=0||t>=this.winTopPane.width||e<=0||e>=this.winTopPane.height)&&this.hideVisible()},this),n.attachListener(e,"resize",r),n.attachListener(e,"mode",a),e.on("destroy",a),this.lineTpl=(new CKEDITOR.template(o)).output({lineStyle:CKEDITOR.tools.writeCssText(CKEDITOR.tools.extend({},s,this.lineStyle,!0)),tipLeftStyle:CKEDITOR.tools.writeCssText(CKEDITOR.tools.extend({},i,{left:"0px","border-left-color":"red","border-width":"6px 0 6px 6px"},this.tipCss,this.tipLeftStyle,!0)),tipRightStyle:CKEDITOR.tools.writeCssText(CKEDITOR.tools.extend({},i,{right:"0px","border-right-color":"red","border-width":"6px 6px 6px 0"},this.tipCss,this.tipRightStyle,!0))})}function r(e){return e&&e.type==CKEDITOR.NODE_ELEMENT&&!u[e.getComputedStyle("float")]&&!u[e.getAttribute("align")]&&!a[e.getComputedStyle("position")]}CKEDITOR.plugins.add("lineutils"),CKEDITOR.LINEUTILS_BEFORE=1,CKEDITOR.LINEUTILS_AFTER=2,CKEDITOR.LINEUTILS_INSIDE=4,e.prototype={start:function(e){var t=this,n=this.editor,r=this.doc,i,s,o,u,a=CKEDITOR.tools.eventsBuffer(50,function(){!n.readOnly&&"wysiwyg"==n.mode&&(t.relations={},(s=r.$.elementFromPoint(o,u))&&s.nodeType)&&(i=new CKEDITOR.dom.element(s),t.traverseSearch(i),isNaN(o+u)||t.pixelSearch(i,o,u),e&&e(t.relations,o,u))});this.listener=this.editable.attachListener(this.target,"mousemove",function(e){o=e.data.$.clientX,u=e.data.$.clientY,a.input()}),this.editable.attachListener(this.inline?this.editable:this.frame,"mouseout",function(){a.reset()})},stop:function(){this.listener&&this.listener.removeListener()},getRange:function(){var e={};return e[CKEDITOR.LINEUTILS_BEFORE]=CKEDITOR.POSITION_BEFORE_START,e[CKEDITOR.LINEUTILS_AFTER]=CKEDITOR.POSITION_AFTER_END,e[CKEDITOR.LINEUTILS_INSIDE]=CKEDITOR.POSITION_AFTER_START,function(t){var n=this.editor.createRange();return n.moveToPosition(this.relations[t.uid].element,e[t.type]),n}}(),store:function(){function e(e,t,n){var r=e.getUniqueId();r in n?n[r].type|=t:n[r]={element:e,type:t}}return function(t,n){var i;n&CKEDITOR.LINEUTILS_AFTER&&r(i=t.getNext())&&i.isVisible()&&(e(i,CKEDITOR.LINEUTILS_BEFORE,this.relations),n^=CKEDITOR.LINEUTILS_AFTER),n&CKEDITOR.LINEUTILS_INSIDE&&r(i=t.getFirst())&&i.isVisible()&&(e(i,CKEDITOR.LINEUTILS_BEFORE,this.relations),n^=CKEDITOR.LINEUTILS_INSIDE),e(t,n,this.relations)}}(),traverseSearch:function(e){var t,n,i;do if(i=e.$["data-cke-expando"],!(i&&i in this.relations)){if(e.equals(this.editable))break;if(r(e))for(t in this.lookups)(n=this.lookups[t](e))&&this.store(e,n)}while((!e||e.type!=CKEDITOR.NODE_ELEMENT||"true"!=e.getAttribute("contenteditable"))&&(e=e.getParent()))},pixelSearch:function(){function e(e,n,i,s,o){for(var u=0,a;o(i);){i+=s;if(25==++u)break;if(a=this.doc.$.elementFromPoint(n,i))if(a==e)u=0;else if(t(e,a)&&(u=0,r(a=new CKEDITOR.dom.element(a))))return a}}var t=CKEDITOR.env.ie||CKEDITOR.env.webkit?function(e,t){return e.contains(t)}:function(e,t){return!!(e.compareDocumentPosition(t)&16)};return function(t,n,i){var s=this.win.getViewPaneSize().height,o=e.call(this,t.$,n,i,-1,function(e){return 0<e}),n=e.call(this,t.$,n,i,1,function(e){return e<s});if(o)for(this.traverseSearch(o);!o.getParent().equals(t);)o=o.getParent();if(n)for(this.traverseSearch(n);!n.getParent().equals(t);)n=n.getParent();for(;o||n;){o&&(o=o.getNext(r));if(!o||o.equals(n))break;this.traverseSearch(o),n&&(n=n.getPrevious(r));if(!n||n.equals(o))break;this.traverseSearch(n)}}}(),greedySearch:function(){this.relations={};for(var e=this.editable.getElementsByTag("*"),t=0,n,i,s;n=e.getItem(t++);)if(!n.equals(this.editable)&&n.type==CKEDITOR.NODE_ELEMENT&&(n.hasAttribute("contenteditable")||!n.isReadOnly())&&r(n)&&n.isVisible())for(s in this.lookups)(i=this.lookups[s](n))&&this.store(n,i);return this.relations}},t.prototype={locate:function(){function e(e,t){var n=e.element[t===CKEDITOR.LINEUTILS_BEFORE?"getPrevious":"getNext"]();return n&&r(n)?(e.siblingRect=n.getClientRect(),t==CKEDITOR.LINEUTILS_BEFORE?(e.siblingRect.bottom+e.elementRect.top)/2:(e.elementRect.bottom+e.siblingRect.top)/2):t==CKEDITOR.LINEUTILS_BEFORE?e.elementRect.top:e.elementRect.bottom}return function(t){var n;this.locations={};for(var r in t)n=t[r],n.elementRect=n.element.getClientRect(),n.type&CKEDITOR.LINEUTILS_BEFORE&&this.store(r,CKEDITOR.LINEUTILS_BEFORE,e(n,CKEDITOR.LINEUTILS_BEFORE)),n.type&CKEDITOR.LINEUTILS_AFTER&&this.store(r,CKEDITOR.LINEUTILS_AFTER,e(n,CKEDITOR.LINEUTILS_AFTER)),n.type&CKEDITOR.LINEUTILS_INSIDE&&this.store(r,CKEDITOR.LINEUTILS_INSIDE,(n.elementRect.top+n.elementRect.bottom)/2);return this.locations}}(),sort:function(){var e,t,n,r;return function(i,s){e=this.locations,t=[];for(var o in e)for(var u in e[o])if(n=Math.abs(i-e[o][u]),t.length){for(r=0;r<t.length;r++)if(n<t[r].dist){t.splice(r,0,{uid:+o,type:u,dist:n});break}r==t.length&&t.push({uid:+o,type:u,dist:n})}else t.push({uid:+o,type:u,dist:n});return"undefined"!=typeof s?t.slice(0,s):t}}(),store:function(e,t,n){this.locations[e]||(this.locations[e]={}),this.locations[e][t]=n}};var i={display:"block",width:"0px",height:"0px","border-color":"transparent","border-style":"solid",position:"absolute",top:"-6px"},s={height:"0px","border-top":"1px dashed red",position:"absolute","z-index":9999},o='<div data-cke-lineutils-line="1" class="cke_reset_all" style="{lineStyle}"><span style="{tipLeftStyle}">&nbsp;</span><span style="{tipRightStyle}">&nbsp;</span></div>';n.prototype={removeAll:function(){for(var e in this.hidden)this.hidden[e].remove(),delete this.hidden[e];for(e in this.visible)this.visible[e].remove(),delete this.visible[e]},hideLine:function(e){var t=e.getUniqueId();e.hide(),this.hidden[t]=e,delete this.visible[t]},showLine:function(e){var t=e.getUniqueId();e.show(),this.visible[t]=e,delete this.hidden[t]},hideVisible:function(){for(var e in this.visible)this.hideLine(this.visible[e])},placeLine:function(e,t){var n,r,i;if(n=this.getStyle(e.uid,e.type)){for(i in this.visible)if(this.visible[i].getCustomData("hash")!==this.hash){r=this.visible[i];break}if(!r)for(i in this.hidden)if(this.hidden[i].getCustomData("hash")!==this.hash){this.showLine(r=this.hidden[i]);break}r||this.showLine(r=this.addLine()),r.setCustomData("hash",this.hash),this.visible[r.getUniqueId()]=r,r.setStyles(n),t&&t(r)}},getStyle:function(e,t){var n=this.relations[e],r=this.locations[e][t],i={};i.width=n.siblingRect?Math.max(n.siblingRect.width,n.elementRect.width):n.elementRect.width,i.top=this.inline?r+this.winTopScroll.y-this.rect.relativeY:this.rect.top+this.winTopScroll.y+r;if(i.top-this.winTopScroll.y<this.rect.top||i.top-this.winTopScroll.y>this.rect.bottom)return!1;if(this.inline)i.left=n.elementRect.left-this.rect.relativeX;else if(0<n.elementRect.left?i.left=this.rect.left+n.elementRect.left:(i.width+=n.elementRect.left,i.left=this.rect.left),0<(n=i.left+i.width-(this.rect.left+this.winPane.width)))i.width-=n;i.left+=this.winTopScroll.x;for(var s in i)i[s]=CKEDITOR.tools.cssLength(i[s]);return i},addLine:function(){var e=CKEDITOR.dom.element.createFromHtml(this.lineTpl);return e.appendTo(this.container),e},prepare:function(e,t){this.relations=e,this.locations=t,this.hash=Math.random()},cleanup:function(){var e,t;for(t in this.visible)e=this.visible[t],e.getCustomData("hash")!==this.hash&&this.hideLine(e)},queryViewport:function(){this.winPane=this.win.getViewPaneSize(),this.winTopScroll=this.winTop.getScrollPosition(),this.winTopPane=this.winTop.getViewPaneSize(),this.rect=this.getClientRect(this.inline?this.editable:this.frame)},getClientRect:function(e){var e=e.getClientRect(),t=this.container.getDocumentPosition(),n=this.container.getComputedStyle("position");return e.relativeX=e.relativeY=0,"static"!=n&&(e.relativeY=t.y,e.relativeX=t.x,e.top-=e.relativeY,e.bottom-=e.relativeY,e.left-=e.relativeX,e.right-=e.relativeX),e}};var u={left:1,right:1,center:1},a={absolute:1,fixed:1};CKEDITOR.plugins.lineutils={finder:e,locator:t,liner:n}}(),function(){function e(e){this.editor=e,this.registered={},this.instances={},this.selected=[],this.widgetHoldingFocusedEditable=this.focused=null,this._={nextId:0,upcasts:[],upcastCallbacks:[],filters:{}},S(this),E(this),this.on("checkWidgets",o),this.editor.on("contentDomInvalidated",this.checkWidgets,this),w(this),g(this),y(this),m(this),b(this)}function t(e,n,r,i,s){var o=e.editor;CKEDITOR.tools.extend(this,i,{editor:o,id:n,inline:"span"==r.getParent().getName(),element:r,data:CKEDITOR.tools.extend({},"function"==typeof i.defaults?i.defaults():i.defaults),dataReady:!1,inited:!1,ready:!1,edit:t.prototype.edit,focusedEditable:null,definition:i,repository:e,draggable:!1!==i.draggable,_:{downcastFn:i.downcast&&"string"==typeof i.downcast?i.downcasts[i.downcast]:i.downcast}},!0),e.fire("instanceCreated",this),B(this,i),this.init&&this.init(),this.inited=!0,(e=this.element.data("cke-widget-data"))&&this.setData(JSON.parse(decodeURIComponent(e))),s&&this.setData(s),this.data.classes||this.setData("classes",this.getClasses()),this.dataReady=!0,F(this),this.fire("data",this.data),this.isInited()&&o.editable().contains(this.wrapper)&&(this.ready=!0,this.fire("ready"))}function n(e,t,n){CKEDITOR.dom.element.call(this,t.$),this.editor=e,this._={},t=this.filter=n.filter,CKEDITOR.dtd[this.getName()].p?(this.enterMode=t?t.getAllowedEnterMode(e.enterMode):e.enterMode,this.shiftEnterMode=t?t.getAllowedEnterMode(e.shiftEnterMode,!0):e.shiftEnterMode):this.enterMode=this.shiftEnterMode=CKEDITOR.ENTER_BR}function r(e,t){e.addCommand(t.name,{exec:function(e,n){function r(){e.widgets.finalizeCreation(u)}var i=e.widgets.focused;if(i&&i.name==t.name)i.edit();else if(t.insert)t.insert();else if(t.template){var i="function"==typeof t.defaults?t.defaults():t.defaults,i=CKEDITOR.dom.element.createFromHtml(t.template.output(i)),s,o=e.widgets.wrapElement(i,t.name),u=new CKEDITOR.dom.documentFragment(o.getDocument());u.append(o),(s=e.widgets.initOn(i,t,n&&n.startupData))?(i=s.once("edit",function(t){t.data.dialog?s.once("dialog",function(t){var t=t.data,n,i;n=t.once("ok",r,null,null,20),i=t.once("cancel",function(t){t.data&&!1===t.data.hide||e.widgets.destroy(s,!0)}),t.once("hide",function(){n.removeListener(),i.removeListener()})}):r()},null,null,999),s.edit(),i.removeListener()):r()}},allowedContent:t.allowedContent,requiredContent:t.requiredContent,contentForms:t.contentForms,contentTransformations:t.contentTransformations})}function i(e,t){function n(t,n,r){var i=CKEDITOR.tools.getIndex(e._.upcasts,function(e){return e[2]>r});0>i&&(i=e._.upcasts.length),e._.upcasts.splice(i,0,[t,n,r])}var r=t.upcast,i=t.upcastPriority||10;if(r)if("string"==typeof r)for(r=r.split(",");r.length;)n(t.upcasts[r.pop()],t.name,i);else n(r,t.name,i)}function s(e,t){e.focused=null;if(t.isInited()){var n=t.editor.checkDirty();e.fire("widgetBlurred",{widget:t}),t.setFocused(!1),!n&&t.editor.resetDirty()}}function o(e){e=e.data;if("wysiwyg"==this.editor.mode){var n=this.editor.editable(),r=this.instances,i,s,o,u;if(n){for(i in r)r[i].isReady()&&!n.contains(r[i].wrapper)&&this.destroy(r[i],!0);if(e&&e.initOnlyNew)r=this.initOnAll();else{var a=n.find(".cke_widget_wrapper"),r=[];i=0;for(s=a.count();i<s;i++){o=a.getItem(i);if(u=!this.getByElement(o,!0)){e:{u=h;for(var f=o;f=f.getParent();)if(u(f)){u=!0;break e}u=!1}u=!u&&n.contains(o)}u&&(o.addClass("cke_widget_new"),r.push(this.initOn(o.getFirst(t.isDomWidgetElement))))}}e&&e.focusInited&&1==r.length&&r[0].focus()}}}function u(e,t,n){if(!n.allowedContent)return null;var r=this._.filters[e];return r||(this._.filters[e]=r={}),(e=r[t])||(r[t]=e=new CKEDITOR.filter(n.allowedContent)),e}function a(e){var n=[],r=e._.upcasts,i=e._.upcastCallbacks;return{toBeWrapped:n,iterator:function(e){var s,o,u,a,f;if("data-cke-widget-wrapper"in e.attributes)return(e=e.getFirst(t.isParserWidgetElement))&&n.push([e]),!1;if("data-widget"in e.attributes)return n.push([e]),!1;if(f=r.length){if(e.attributes["data-cke-widget-upcasted"])return!1;a=0;for(s=i.length;a<s;++a)if(!1===i[a](e))return;for(a=0;a<f;++a)if(s=r[a],u={},o=s[0](e,u))return o instanceof CKEDITOR.htmlParser.element&&(e=o),e.attributes["data-cke-widget-data"]=encodeURIComponent(JSON.stringify(u)),e.attributes["data-cke-widget-upcasted"]=1,n.push([e,s[1]]),!1}}}}function f(e){return{tabindex:-1,contenteditable:"false","data-cke-widget-wrapper":1,"data-cke-filter":"off","class":"cke_widget_wrapper cke_widget_new cke_widget_"+(e?"inline":"block")}}function l(e,t,n){if(e.type==CKEDITOR.NODE_ELEMENT){var r=CKEDITOR.dtd[e.name];if(r&&!r[n.name]){var r=e.split(t),i=e.parent,t=r.getIndex();return e.children.length||(t-=1,e.remove()),r.children.length||r.remove(),l(i,t,n)}}e.add(n,t)}function c(e,t){return"boolean"==typeof e.inline?e.inline:!!CKEDITOR.dtd.$inline[t]}function h(e){return e.hasAttribute("data-cke-temp")}function p(e,t,n,r){var i=e.editor;i.fire("lockSnapshot"),n?(r=n.data("cke-widget-editable"),r=t.editables[r],e.widgetHoldingFocusedEditable=t,t.focusedEditable=r,n.addClass("cke_widget_editable_focused"),r.filter&&i.setActiveFilter(r.filter),i.setActiveEnterMode(r.enterMode,r.shiftEnterMode)):(r||t.focusedEditable.removeClass("cke_widget_editable_focused"),t.focusedEditable=null,e.widgetHoldingFocusedEditable=null,i.setActiveFilter(null),i.setActiveEnterMode(null,null)),i.fire("unlockSnapshot")}function d(e){e.contextMenu&&e.contextMenu.addListener(function(t){if(t=e.widgets.getByElement(t,!0))return t.fire("contextMenu",{})})}function v(e,t){return CKEDITOR.tools.trim(t)}function m(e){var n=e.editor,r=CKEDITOR.plugins.lineutils;n.on("dragstart",function(r){var i=r.data.target;t.isDomDragHandler(i)&&(i=e.getByElement(i),r.data.dataTransfer.setData("cke/widget-id",i.id),n.focus(),i.focus())}),n.on("drop",function(t){var r=t.data.dataTransfer,i=r.getData("cke/widget-id"),s=n.createRange();""!==i&&r.getTransferType(n)==CKEDITOR.DATA_TRANSFER_INTERNAL&&(r=e.instances[i])&&(s.setStartBefore(r.wrapper),s.setEndAfter(r.wrapper),t.data.dragRange=s,delete CKEDITOR.plugins.clipboard.dragStartContainerChildCount,delete CKEDITOR.plugins.clipboard.dragEndContainerChildCount,t.data.dataTransfer.setData("text/html",n.editable().getHtmlFromRange(s).getHtml()),n.widgets.destroy(r,!0))}),n.on("contentDom",function(){var i=n.editable();CKEDITOR.tools.extend(e,{finder:new r.finder(n,{lookups:{"default":function(n){if(!n.is(CKEDITOR.dtd.$listItem)&&n.is(CKEDITOR.dtd.$block)&&!t.isDomNestedEditable(n)&&!e._.draggedWidget.wrapper.contains(n)){var r=t.getNestedEditable(i,n);if(r){n=e._.draggedWidget;if(e.getByElement(r)==n)return;r=CKEDITOR.filter.instances[r.data("cke-filter")],n=n.requiredContent;if(r&&n&&!r.check(n))return}return CKEDITOR.LINEUTILS_BEFORE|CKEDITOR.LINEUTILS_AFTER}}}}),locator:new r.locator(n),liner:new r.liner(n,{lineStyle:{cursor:"move !important","border-top-color":"#666"},tipLeftStyle:{"border-left-color":"#666"},tipRightStyle:{"border-right-color":"#666"}})},!0)})}function g(e){var n=e.editor;n.on("contentDom",function(){var r=n.editable(),i=r.isInline()?r:n.document,s,o;r.attachListener(i,"mousedown",function(n){var r=n.data.getTarget();if(!r.type)return!1;s=e.getByElement(r),o=0,s&&(s.inline&&r.type==CKEDITOR.NODE_ELEMENT&&r.hasAttribute("data-cke-widget-drag-handler")?o=1:t.getNestedEditable(s.wrapper,r)?s=null:(n.data.preventDefault(),CKEDITOR.env.ie||s.focus()))}),r.attachListener(i,"mouseup",function(){o&&s&&s.wrapper&&(o=0,s.focus())}),CKEDITOR.env.ie&&r.attachListener(i,"mouseup",function(){setTimeout(function(){s&&s.wrapper&&r.contains(s.wrapper)&&(s.focus(),s=null)})})}),n.on("doubleclick",function(n){var r=e.getByElement(n.data.element);if(r&&!t.getNestedEditable(r.wrapper,n.data.element))return r.fire("doubleclick",{element:n.data.element})},null,null,1)}function y(e){e.editor.on("key",function(t){var n=e.focused,r=e.widgetHoldingFocusedEditable,i;return n?i=n.fire("key",{keyCode:t.data.keyCode}):r&&(n=t.data.keyCode,t=r.focusedEditable,n==CKEDITOR.CTRL+65?(n=t.getBogus(),r=r.editor.createRange(),r.selectNodeContents(t),n&&r.setEndAt(n,CKEDITOR.POSITION_BEFORE_START),r.select(),i=!1):8==n||46==n?(i=r.editor.getSelection().getRanges(),r=i[0],i=1!=i.length||!r.collapsed||!r.checkBoundaryOfElement(t,CKEDITOR[8==n?"START":"END"])):i=void 0),i},null,null,1)}function b(e){function t(t){e.focused&&C(e.focused,"cut"==t.name)}var n=e.editor;n.on("contentDom",function(){var e=n.editable();e.attachListener(e,"copy",t),e.attachListener(e,"cut",t)})}function w(e){var n=e.editor;n.on("selectionCheck",function(){e.fire("checkSelection")}),e.on("checkSelection",e.checkSelection,e),n.on("selectionChange",function(r){var i=(r=t.getNestedEditable(n.editable(),r.data.selection.getStartElement()))&&e.getByElement(r),s=e.widgetHoldingFocusedEditable;if(s){if(s!==i||!s.focusedEditable.equals(r))p(e,s,null),i&&r&&p(e,i,r)}else i&&r&&p(e,i,r)}),n.on("dataReady",function(){x(e).commit()}),n.on("blur",function(){var t;(t=e.focused)&&s(e,t),(t=e.widgetHoldingFocusedEditable)&&p(e,t,null)})}function E(e){var n=e.editor,r={};n.on("toDataFormat",function(n){var i=CKEDITOR.tools.getNextNumber(),s=[];n.data.downcastingSessionId=i,r[i]=s,n.data.dataValue.forEach(function(n){var r=n.attributes,i;if("data-cke-widget-id"in r){if(r=e.instances[r["data-cke-widget-id"]])i=n.getFirst(t.isParserWidgetElement),s.push({wrapper:n,element:i,widget:r,editables:{}}),"1"!=i.attributes["data-cke-widget-keep-attr"]&&delete i.attributes["data-widget"]}else if("data-cke-widget-editable"in r)return s[s.length-1].editables[r["data-cke-widget-editable"]]=n,!1},CKEDITOR.NODE_ELEMENT,!0)},null,null,8),n.on("toDataFormat",function(e){if(e.data.downcastingSessionId)for(var e=r[e.data.downcastingSessionId],t,n,i,s,o,u;t=e.shift();){n=t.widget,i=t.element,s=n._.downcastFn&&n._.downcastFn.call(n,i);for(u in t.editables)o=t.editables[u],delete o.attributes.contenteditable,o.setHtml(n.editables[u].getData());s||(s=i),t.wrapper.replaceWith(s)}},null,null,13),n.on("contentDomUnload",function(){e.destroyAll(!0)})}function S(e){var n=e.editor,r,i;n.on("toHtml",function(n){var i=a(e),s;for(n.data.dataValue.forEach(i.iterator,CKEDITOR.NODE_ELEMENT,!0);s=i.toBeWrapped.pop();){var o=s[0],u=o.parent;u.type==CKEDITOR.NODE_ELEMENT&&u.attributes["data-cke-widget-wrapper"]&&u.replaceWith(o),e.wrapElement(s[0],s[1])}r=n.data.protectedWhitespaces?3==n.data.dataValue.children.length&&t.isParserWidgetWrapper(n.data.dataValue.children[1]):1==n.data.dataValue.children.length&&t.isParserWidgetWrapper(n.data.dataValue.children[0])},null,null,8),n.on("dataReady",function(){if(i)for(var r=n.editable().find(".cke_widget_wrapper"),s,o,u=0,a=r.count();u<a;++u)s=r.getItem(u),o=s.getFirst(t.isDomWidgetElement),o.type==CKEDITOR.NODE_ELEMENT&&o.data("widget")?(o.replace(s),e.wrapElement(o)):s.remove();i=0,e.destroyAll(!0),e.initOnAll()}),n.on("loadSnapshot",function(t){/data-cke-widget/.test(t.data)&&(i=1),e.destroyAll(!0)},null,null,9),n.on("paste",function(e){e=e.data,e.dataValue=e.dataValue.replace(q,v),e.range&&(e=t.getNestedEditable(n.editable(),e.range.startContainer))&&(e=CKEDITOR.filter.instances[e.data("cke-filter")])&&n.setActiveFilter(e)}),n.on("afterInsertHtml",function(t){t.data.intoRange?e.checkWidgets({initOnlyNew:!0}):(n.fire("lockSnapshot"),e.checkWidgets({initOnlyNew:!0,focusInited:r}),n.fire("unlockSnapshot"))})}function x(e){var t=e.selected,n=[],r=t.slice(0),i=null;return{select:function(e){return 0>CKEDITOR.tools.indexOf(t,e)&&n.push(e),e=CKEDITOR.tools.indexOf(r,e),0<=e&&r.splice(e,1),this},focus:function(e){return i=e,this},commit:function(){var o=e.focused!==i,u,a;e.editor.fire("lockSnapshot");for(o&&(u=e.focused)&&s(e,u);u=r.pop();)t.splice(CKEDITOR.tools.indexOf(t,u),1),u.isInited()&&(a=u.editor.checkDirty(),u.setSelected(!1),!a&&u.editor.resetDirty());o&&i&&(a=e.editor.checkDirty(),e.focused=i,e.fire("widgetFocused",{widget:i}),i.setFocused(!0),!a&&e.editor.resetDirty());for(;u=n.pop();)t.push(u),u.setSelected(!0);e.editor.fire("unlockSnapshot")}}}function T(e,t,n){var r=0,t=k(t),i=e.data.classes||{},s;if(t){for(i=CKEDITOR.tools.clone(i);s=t.pop();)n?i[s]||(r=i[s]=1):i[s]&&(delete i[s],r=1);r&&e.setData("classes",i)}}function N(e){e.cancel()}function C(e,t){var n=e.editor,r=n.document;if(!r.getById("cke_copybin")){var i=n.blockless||CKEDITOR.env.ie?"span":"div",s=r.createElement(i),o=r.createElement(i),i=CKEDITOR.env.ie&&9>CKEDITOR.env.version;o.setAttributes({id:"cke_copybin","data-cke-temp":"1"}),s.setStyles({position:"absolute",width:"1px",height:"1px",overflow:"hidden"}),s.setStyle("ltr"==n.config.contentsLangDirection?"left":"right","-5000px");var u=n.createRange();u.setStartBefore(e.wrapper),u.setEndAfter(e.wrapper),s.setHtml('<span data-cke-copybin-start="1">​</span>'+n.editable().getHtmlFromRange(u).getHtml()+'<span data-cke-copybin-end="1">​</span>'),n.fire("saveSnapshot"),n.fire("lockSnapshot"),o.append(s),n.editable().append(o);var a=n.on("selectionChange",N,null,null,0),f=e.repository.on("checkSelection",N,null,null,0);if(i)var l=r.getDocumentElement().$,c=l.scrollTop;u=n.createRange(),u.selectNodeContents(s),u.select(),i&&(l.scrollTop=c),setTimeout(function(){t||e.focus(),o.remove(),a.removeListener(),f.removeListener(),n.fire("unlockSnapshot"),t&&(e.repository.del(e),n.fire("saveSnapshot"))},100)}}function k(e){return(e=(e=e.getDefinition().attributes)&&e["class"])?e.split(/\s+/):null}function L(){var e=CKEDITOR.document.getActive(),t=this.editor,n=t.editable();(n.isInline()?n:t.document.getWindow().getFrame()).equals(e)&&t.focusManager.focus(n)}function A(){CKEDITOR.env.gecko&&this.editor.unlockSelection(),CKEDITOR.env.webkit||(this.editor.forceNextSelectionCheck(),this.editor.selectionChange(1))}function O(e){var t=null;e.on("data",function(){var e=this.data.classes,n;if(t!=e){for(n in t)(!e||!e[n])&&this.removeClass(n);for(n in e)this.addClass(n);t=e}})}function M(e){if(e.draggable){var n=e.editor,r=e.wrapper.getLast(t.isDomDragHandlerContainer),i;r?i=r.findOne("img"):(r=new CKEDITOR.dom.element("span",n.document),r.setAttributes({"class":"cke_reset cke_widget_drag_handler_container",style:"background:rgba(220,220,220,0.5);background-image:url("+n.plugins.widget.path+"images/handle.png)"}),i=new CKEDITOR.dom.element("img",n.document),i.setAttributes({"class":"cke_reset cke_widget_drag_handler","data-cke-widget-drag-handler":"1",src:CKEDITOR.tools.transparentImageData,width:I,title:n.lang.widget.move,height:I}),e.inline&&i.setAttribute("draggable","true"),r.append(i),e.wrapper.append(r)),e.wrapper.on("dragover",function(e){e.data.preventDefault()}),e.wrapper.on("mouseenter",e.updateDragHandlerPosition,e),setTimeout(function(){e.on("data",e.updateDragHandlerPosition,e)},50),!e.inline&&(i.on("mousedown",_,e),CKEDITOR.env.ie&&9>CKEDITOR.env.version)&&i.on("dragstart",function(e){e.data.preventDefault(!0)}),e.dragHandlerContainer=r}}function _(e){function t(){var t;for(l.reset();t=u.pop();)t.removeListener();var n=a;t=e.sender;var r=this.repository.finder,i=this.repository.liner,s=this.editor,o=this.editor.editable();CKEDITOR.tools.isEmpty(i.visible)||(n=r.getRange(n[0]),this.focus(),s.fire("drop",{dropRange:n,target:n.startContainer})),o.removeClass("cke_widget_dragging"),i.hideVisible(),s.fire("dragend",{target:t})}var n=this.repository.finder,r=this.repository.locator,i=this.repository.liner,s=this.editor,o=s.editable(),u=[],a=[];this.repository._.draggedWidget=this;var f=n.greedySearch(),l=CKEDITOR.tools.eventsBuffer(50,function(){c=r.locate(f),a=r.sort(h,1),a.length&&(i.prepare(f,c),i.placeLine(a[0]),i.cleanup())}),c,h;o.addClass("cke_widget_dragging"),u.push(o.on("mousemove",function(e){h=e.data.$.clientY,l.input()})),s.fire("dragstart",{target:e.sender}),u.push(s.document.once("mouseup",t,this)),o.isInline()||u.push(CKEDITOR.document.once("mouseup",t,this))}function D(e){var t,n,r=e.editables;e.editables={};if(e.editables)for(t in r)n=r[t],e.initEditable(t,"string"==typeof n?{selector:n}:n)}function P(e){if(e.mask){var t=e.wrapper.findOne(".cke_widget_mask");t||(t=new CKEDITOR.dom.element("img",e.editor.document),t.setAttributes({src:CKEDITOR.tools.transparentImageData,"class":"cke_reset cke_widget_mask"}),e.wrapper.append(t)),e.mask=t}}function H(e){if(e.parts){var t={},n,r;for(r in e.parts)n=e.wrapper.findOne(e.parts[r]),t[r]=n;e.parts=t}}function B(e,n){j(e),H(e),D(e),P(e),M(e),O(e),CKEDITOR.env.ie&&9>CKEDITOR.env.version&&e.wrapper.on("dragstart",function(n){var r=n.data.getTarget();!t.getNestedEditable(e,r)&&(!e.inline||!t.isDomDragHandler(r))&&n.data.preventDefault()}),e.wrapper.removeClass("cke_widget_new"),e.element.addClass("cke_widget_element"),e.on("key",function(t){t=t.data.keyCode;if(13==t)e.edit();else{if(t==CKEDITOR.CTRL+67||t==CKEDITOR.CTRL+88){C(e,t==CKEDITOR.CTRL+88);return}if(t in R||CKEDITOR.CTRL&t||CKEDITOR.ALT&t)return}return!1},null,null,999),e.on("doubleclick",function(t){e.edit()&&t.cancel()}),n.data&&e.on("data",n.data),n.edit&&e.on("edit",n.edit)}function j(e){(e.wrapper=e.element.getParent()).setAttribute("data-cke-widget-id",e.id)}function F(e){e.element.data("cke-widget-data",encodeURIComponent(JSON.stringify(e.data)))}var I=15;CKEDITOR.plugins.add("widget",{requires:"lineutils,clipboard",onLoad:function(){CKEDITOR.addCss(".cke_widget_wrapper{position:relative;outline:none}.cke_widget_inline{display:inline-block}.cke_widget_wrapper:hover>.cke_widget_element{outline:2px solid yellow;cursor:default}.cke_widget_wrapper:hover .cke_widget_editable{outline:2px solid yellow}.cke_widget_wrapper.cke_widget_focused>.cke_widget_element,.cke_widget_wrapper .cke_widget_editable.cke_widget_editable_focused{outline:2px solid #ace}.cke_widget_editable{cursor:text}.cke_widget_drag_handler_container{position:absolute;width:"+I+"px;height:0;display:none;opacity:0.75;transition:height 0s 0.2s;line-height:0}.cke_widget_wrapper:hover>.cke_widget_drag_handler_container{height:"+I+"px;transition:none}.cke_widget_drag_handler_container:hover{opacity:1}img.cke_widget_drag_handler{cursor:move;width:"+I+"px;height:"+I+"px;display:inline-block}.cke_widget_mask{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.cke_editable.cke_widget_dragging, .cke_editable.cke_widget_dragging *{cursor:move !important}")},beforeInit:function(t){t.widgets=new e(t)},afterInit:function(e){var t=e.widgets.registered,n,r,i;for(r in t)n=t[r],(i=n.button)&&e.ui.addButton&&e.ui.addButton(CKEDITOR.tools.capitalize(n.name,!0),{label:i,command:n.name,toolbar:"insert,10"});d(e)}}),e.prototype={MIN_SELECTION_CHECK_INTERVAL:500,add:function(e,t){return t=CKEDITOR.tools.prototypedCopy(t),t.name=e,t._=t._||{},this.editor.fire("widgetDefinition",t),t.template&&(t.template=new CKEDITOR.template(t.template)),r(this.editor,t),i(this,t),this.registered[e]=t},addUpcastCallback:function(e){this._.upcastCallbacks.push(e)},checkSelection:function(){var e=this.editor.getSelection(),n=e.getSelectedElement(),r=x(this),i;if(n&&(i=this.getByElement(n,!0)))return r.focus(i).select(i).commit();e=e.getRanges()[0];if(!e||e.collapsed)return r.commit();e=new CKEDITOR.dom.walker(e);for(e.evaluator=t.isDomWidgetWrapper;n=e.next();)r.select(this.getByElement(n));r.commit()},checkWidgets:function(e){this.fire("checkWidgets",CKEDITOR.tools.copy(e||{}))},del:function(e){if(this.focused===e){var t=e.editor,n=t.createRange(),r;(r=n.moveToClosestEditablePosition(e.wrapper,!0))||(r=n.moveToClosestEditablePosition(e.wrapper,!1)),r&&t.getSelection().selectRanges([n])}e.wrapper.remove(),this.destroy(e,!0)},destroy:function(e,t){this.widgetHoldingFocusedEditable===e&&p(this,e,null,t),e.destroy(t),delete this.instances[e.id],this.fire("instanceDestroyed",e)},destroyAll:function(e,t){var n,r,i=this.instances;if(t&&!e){r=t.find(".cke_widget_wrapper");for(var i=r.count(),s=0;s<i;++s)(n=this.getByElement(r.getItem(s),!0))&&this.destroy(n)}else for(r in i)n=i[r],this.destroy(n,e)},finalizeCreation:function(e){(e=e.getFirst())&&t.isDomWidgetWrapper(e)&&(this.editor.insertElement(e),e=this.getByElement(e),e.ready=!0,e.fire("ready"),e.focus())},getByElement:function(){var e={div:1,span:1};return function(t,n){if(!t)return null;var r=t.is(e)&&t.data("cke-widget-id");if(!n&&!r){var i=this.editor.editable();do t=t.getParent();while(t&&!t.equals(i)&&!(r=t.is(e)&&t.data("cke-widget-id")))}return this.instances[r]||null}}(),initOn:function(e,n,r){n?"string"==typeof n&&(n=this.registered[n]):n=this.registered[e.data("widget")];if(!n)return null;var i=this.wrapElement(e,n.name);return i?i.hasClass("cke_widget_new")?(e=new t(this,this._.nextId++,e,n,r),e.isInited()?this.instances[e.id]=e:null):this.getByElement(e):null},initOnAll:function(e){for(var e=(e||this.editor.editable()).find(".cke_widget_new"),n=[],r,i=e.count();i--;)(r=this.initOn(e.getItem(i).getFirst(t.isDomWidgetElement)))&&n.push(r);return n},onWidget:function(e){var t=Array.prototype.slice.call(arguments);t.shift();for(var n in this.instances){var r=this.instances[n];r.name==e&&r.on.apply(r,t)}this.on("instanceCreated",function(n){n=n.data,n.name==e&&n.on.apply(n,t)})},parseElementClasses:function(e){if(!e)return null;for(var e=CKEDITOR.tools.trim(e).split(/\s+/),t,n={},r=0;t=e.pop();)-1==t.indexOf("cke_")&&(n[t]=r=1);return r?n:null},wrapElement:function(e,t){var n=null,r,i;if(e instanceof CKEDITOR.dom.element){r=this.registered[t||e.data("widget")];if(!r)return null;if((n=e.getParent())&&n.type==CKEDITOR.NODE_ELEMENT&&n.data("cke-widget-wrapper"))return n;e.hasAttribute("data-cke-widget-keep-attr")||e.data("cke-widget-keep-attr",e.data("widget")?1:0),t&&e.data("widget",t),i=c(r,e.getName()),n=new CKEDITOR.dom.element(i?"span":"div"),n.setAttributes(f(i)),n.data("cke-display-name",r.pathName?r.pathName:e.getName()),e.getParent(!0)&&n.replace(e),e.appendTo(n)}else if(e instanceof CKEDITOR.htmlParser.element){r=this.registered[t||e.attributes["data-widget"]];if(!r)return null;if((n=e.parent)&&n.type==CKEDITOR.NODE_ELEMENT&&n.attributes["data-cke-widget-wrapper"])return n;"data-cke-widget-keep-attr"in e.attributes||(e.attributes["data-cke-widget-keep-attr"]=e.attributes["data-widget"]?1:0),t&&(e.attributes["data-widget"]=t),i=c(r,e.name),n=new CKEDITOR.htmlParser.element(i?"span":"div",f(i)),n.attributes["data-cke-display-name"]=r.pathName?r.pathName:e.name,r=e.parent;var s;r&&(s=e.getIndex(),e.remove()),n.add(e),r&&l(r,s,n)}return n},_tests_createEditableFilter:u},CKEDITOR.event.implementOn(e.prototype),t.prototype={addClass:function(e){this.element.addClass(e)},applyStyle:function(e){T(this,e,1)},checkStyleActive:function(e){var e=k(e),t;if(!e)return!1;for(;t=e.pop();)if(!this.hasClass(t))return!1;return!0},destroy:function(e){this.fire("destroy");if(this.editables)for(var t in this.editables)this.destroyEditable(t,e);e||("0"==this.element.data("cke-widget-keep-attr")&&this.element.removeAttribute("data-widget"),this.element.removeAttributes(["data-cke-widget-data","data-cke-widget-keep-attr"]),this.element.removeClass("cke_widget_element"),this.element.replace(this.wrapper)),this.wrapper=null},destroyEditable:function(e,t){var n=this.editables[e];n.removeListener("focus",A),n.removeListener("blur",L),this.editor.focusManager.remove(n),t||(this.repository.destroyAll(!1,n),n.removeClass("cke_widget_editable"),n.removeClass("cke_widget_editable_focused"),n.removeAttributes(["contenteditable","data-cke-widget-editable","data-cke-enter-mode"])),delete this.editables[e]},edit:function(){var e={dialog:this.dialog},t=this;return!1===this.fire("edit",e)||!e.dialog?!1:(this.editor.openDialog(e.dialog,function(e){var n,r;!1!==t.fire("dialog",e)&&(n=e.on("show",function(){e.setupContent(t)}),r=e.on("ok",function(){var n,r=t.on("data",function(e){n=1,e.cancel()},null,null,0);t.editor.fire("saveSnapshot"),e.commitContent(t),r.removeListener(),n&&(t.fire("data",t.data),t.editor.fire("saveSnapshot"))}),e.once("hide",function(){n.removeListener(),r.removeListener()}))}),!0)},getClasses:function(){return this.repository.parseElementClasses(this.element.getAttribute("class"))},hasClass:function(e){return this.element.hasClass(e)},initEditable:function(e,t){var r=this._findOneNotNested(t.selector);return r&&r.is(CKEDITOR.dtd.$editable)?(r=new n(this.editor,r,{filter:u.call(this.repository,this.name,e,t)}),this.editables[e]=r,r.setAttributes({contenteditable:"true","data-cke-widget-editable":e,"data-cke-enter-mode":r.enterMode}),r.filter&&r.data("cke-filter",r.filter.id),r.addClass("cke_widget_editable"),r.removeClass("cke_widget_editable_focused"),t.pathName&&r.data("cke-display-name",t.pathName),this.editor.focusManager.add(r),r.on("focus",A,this),CKEDITOR.env.ie&&r.on("blur",L,this),r._.initialSetData=!0,r.setData(r.getHtml()),!0):!1},_findOneNotNested:function(e){for(var e=this.wrapper.find(e),n,r,i=0;i<e.count();i++)if(n=e.getItem(i),r=n.getAscendant(t.isDomWidgetWrapper),this.wrapper.equals(r))return n;return null},isInited:function(){return!!this.wrapper&&!!this.inited},isReady:function(){return this.isInited()&&this.ready},focus:function(){var e=this.editor.getSelection();if(e){var t=this.editor.checkDirty();e.fake(this.wrapper),!t&&this.editor.resetDirty()}this.editor.focus()},removeClass:function(e){this.element.removeClass(e)},removeStyle:function(e){T(this,e,0)},setData:function(e,t){var n=this.data,r=0;if("string"==typeof e)n[e]!==t&&(n[e]=t,r=1);else{var i=e;for(e in i)n[e]!==i[e]&&(r=1,n[e]=i[e])}return r&&this.dataReady&&(F(this),this.fire("data",n)),this},setFocused:function(e){return this.wrapper[e?"addClass":"removeClass"]("cke_widget_focused"),this.fire(e?"focus":"blur"),this},setSelected:function(e){return this.wrapper[e?"addClass":"removeClass"]("cke_widget_selected"),this.fire(e?"select":"deselect"),this},updateDragHandlerPosition:function(){var e=this.editor,t=this.element.$,n=this._.dragHandlerOffset,t={x:t.offsetLeft,y:t.offsetTop-I};if(!n||t.x!=n.x||t.y!=n.y)n=e.checkDirty(),e.fire("lockSnapshot"),this.dragHandlerContainer.setStyles({top:t.y+"px",left:t.x+"px",display:"block"}),e.fire("unlockSnapshot"),!n&&e.resetDirty(),this._.dragHandlerOffset=t}},CKEDITOR.event.implementOn(t.prototype),t.getNestedEditable=function(e,n){return!n||n.equals(e)?null:t.isDomNestedEditable(n)?n:t.getNestedEditable(e,n.getParent())},t.isDomDragHandler=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("data-cke-widget-drag-handler")},t.isDomDragHandlerContainer=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasClass("cke_widget_drag_handler_container")},t.isDomNestedEditable=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("data-cke-widget-editable")},t.isDomWidgetElement=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("data-widget")},t.isDomWidgetWrapper=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("data-cke-widget-wrapper")},t.isParserWidgetElement=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&!!e.attributes["data-widget"]},t.isParserWidgetWrapper=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&!!e.attributes["data-cke-widget-wrapper"]},n.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.dom.element.prototype),{setData:function(e){this._.initialSetData||this.editor.widgets.destroyAll(!1,this),this._.initialSetData=!1,e=this.editor.dataProcessor.toHtml(e,{context:this.getName(),filter:this.filter,enterMode:this.enterMode}),this.setHtml(e),this.editor.widgets.initOnAll(this)},getData:function(){return this.editor.dataProcessor.toDataFormat(this.getHtml(),{context:this.getName(),filter:this.filter,enterMode:this.enterMode})}});var q=RegExp('^(?:<(?:div|span)(?: data-cke-temp="1")?(?: id="cke_copybin")?(?: data-cke-temp="1")?>)?(?:<(?:div|span)(?: style="[^"]+")?>)?<span [^>]*data-cke-copybin-start="1"[^>]*>.?</span>([\\s\\S]+)<span [^>]*data-cke-copybin-end="1"[^>]*>.?</span>(?:</(?:div|span)>)?(?:</(?:div|span)>)?$',"i"),R={37:1,38:1,39:1,40:1,8:1,46:1};(function(){function e(){}function n(e,t,n){return!n||!this.checkElement(e)?!1:(e=n.widgets.getByElement(e,!0))&&e.checkStyleActive(this)}CKEDITOR.style.addCustomHandler({type:"widget",setup:function(e){this.widget=e.widget},apply:function(e){e instanceof CKEDITOR.editor&&this.checkApplicable(e.elementPath(),e)&&e.widgets.focused.applyStyle(this)},remove:function(e){e instanceof CKEDITOR.editor&&this.checkApplicable(e.elementPath(),e)&&e.widgets.focused.removeStyle(this)},checkActive:function(e,t){return this.checkElementMatch(e.lastElement,0,t)},checkApplicable:function(e,t){return t instanceof CKEDITOR.editor?this.checkElement(e.lastElement):!1},checkElementMatch:n,checkElementRemovable:n,checkElement:function(e){return t.isDomWidgetWrapper(e)?(e=e.getFirst(t.isDomWidgetElement))&&e.data("widget")==this.widget:!1},buildPreview:function(e){return e||this._.definition.name},toAllowedContentRules:function(e){if(!e)return null;var e=e.widgets.registered[this.widget],t,n={};return e?e.styleableElements?(t=this.getClassesArray(),t?(n[e.styleableElements]={classes:t,propertiesOnly:!0},n):null):e.styleToAllowedContentRules?e.styleToAllowedContentRules(this):null:null},getClassesArray:function(){var e=this._.definition.attributes&&this._.definition.attributes["class"];return e?CKEDITOR.tools.trim(e).split(/\s+/):null},applyToRange:e,removeFromRange:e,applyToObject:e})})(),CKEDITOR.plugins.widget=t,t.repository=e,t.nestedEditable=n}(),function(){function e(e){function r(){this.deflated||(e.widgets.focused==this.widget&&(this.focused=!0),e.widgets.destroy(this.widget),this.deflated=!0)}function i(){var t=e.editable(),n=e.document;if(this.deflated)this.widget=e.widgets.initOn(this.element,"image",this.widget.data),this.widget.inline&&!(new CKEDITOR.dom.elementPath(this.widget.wrapper,t)).block&&(t=n.createElement(e.activeEnterMode==CKEDITOR.ENTER_P?"p":"div"),t.replace(this.widget.wrapper),this.widget.wrapper.move(t)),this.focused&&(this.widget.focus(),delete this.focused),delete this.deflated;else{var r=this.widget,t=o,n=r.wrapper,i=r.data.align,r=r.data.hasCaption;if(t){for(var s=3;s--;)n.removeClass(t[s]);"center"==i?r&&n.addClass(t[1]):"none"!=i&&n.addClass(t[d[i]])}else"center"==i?(r?n.setStyle("text-align","center"):n.removeStyle("text-align"),n.removeStyle("float")):("none"==i?n.removeStyle("float"):n.setStyle("float",i),n.removeStyle("text-align"))}}var o=e.config.image2_alignClasses,u=e.config.image2_captionedClass;return{allowedContent:f(e),requiredContent:"img[src,alt]",features:l(e),styleableElements:"img figure",contentTransformations:[["img[width]: sizeToAttribute"]],editables:{caption:{selector:"figcaption",allowedContent:"br em strong sub sup u s; a[!href]"}},parts:{image:"img",caption:"figcaption"},dialog:"image2",template:h,data:function(){var t=this.features;this.data.hasCaption&&!e.filter.checkFeature(t.caption)&&(this.data.hasCaption=!1),"none"!=this.data.align&&!e.filter.checkFeature(t.align)&&(this.data.align="none"),this.shiftState({widget:this,element:this.element,oldData:this.oldData,newData:this.data,deflate:r,inflate:i}),this.data.link?this.parts.link||(this.parts.link=this.parts.image.getParent()):this.parts.link&&delete this.parts.link,this.parts.image.setAttributes({src:this.data.src,"data-cke-saved-src":this.data.src,alt:this.data.alt});if(this.oldData&&!this.oldData.hasCaption&&this.data.hasCaption)for(var n in this.data.classes)this.parts.image.removeClass(n);if(e.filter.checkFeature(t.dimension)){t=this.data,t={width:t.width,height:t.height},n=this.parts.image;for(var s in t)t[s]?n.setAttribute(s,t[s]):n.removeAttribute(s)}this.oldData=CKEDITOR.tools.extend({},this.data)},init:function(){var t=CKEDITOR.plugins.image2,n=this.parts.image,r={hasCaption:!!this.parts.caption,src:n.getAttribute("src"),alt:n.getAttribute("alt")||"",width:n.getAttribute("width")||"",height:n.getAttribute("height")||"",lock:this.ready?t.checkHasNaturalRatio(n):!0},i=n.getAscendant("a");i&&this.wrapper.contains(i)&&(this.parts.link=i),r.align||(n=r.hasCaption?this.element:n,o?(n.hasClass(o[0])?r.align="left":n.hasClass(o[2])&&(r.align="right"),r.align?n.removeClass(o[d[r.align]]):r.align="none"):(r.align=n.getStyle("float")||"none",n.removeStyle("float"))),e.plugins.link&&this.parts.link&&(r.link=CKEDITOR.plugins.link.parseLinkAttributes(e,this.parts.link),(n=r.link.advanced)&&n.advCSSClasses)&&(n.advCSSClasses=CKEDITOR.tools.trim(n.advCSSClasses.replace(/cke_\S+/,""))),this.wrapper[(r.hasCaption?"remove":"add")+"Class"]("cke_image_nocaption"),this.setData(r),e.filter.checkFeature(this.features.dimension)&&!0!==e.config.image2_disableResizer&&s(this),this.shiftState=t.stateShifter(this.editor),this.on("contextMenu",function(e){e.data.image=CKEDITOR.TRISTATE_OFF;if(this.parts.link||this.wrapper.getAscendant("a"))e.data.link=e.data.unlink=CKEDITOR.TRISTATE_OFF}),this.on("dialog",function(e){e.data.widget=this},this)},addClass:function(e){c(this).addClass(e)},hasClass:function(e){return c(this).hasClass(e)},removeClass:function(e){c(this).removeClass(e)},getClasses:function(){var e=RegExp("^("+[].concat(u,o).join("|")+")$");return function(){var t=this.repository.parseElementClasses(c(this).getAttribute("class")),n;for(n in t)e.test(n)&&delete t[n];return t}}(),upcast:t(e),downcast:n(e)}}function t(e){var t=r(e),n=e.config.image2_captionedClass;return function(e,r){var s={width:1,height:1},o=e.name,u;if(!e.attributes["data-cke-realelement"]){t(e)?("div"==o&&(u=e.getFirst("figure"))&&(e.replaceWith(u),e=u),r.align="center",u=e.getFirst("img")||e.getFirst("a").getFirst("img")):"figure"==o&&e.hasClass(n)?u=e.getFirst("img")||e.getFirst("a").getFirst("img"):i(e)&&(u="a"==e.name?e.children[0]:e);if(u){for(var a in s)(o=u.attributes[a])&&o.match(v)&&delete u.attributes[a];return e}}}}function n(e){var t=e.config.image2_alignClasses;return function(e){var n="a"==e.name?e.getFirst():e,r=n.attributes,i=this.data.align;if(!this.inline){var s=e.getFirst("span");s&&s.replaceWith(s.getFirst({img:1,a:1}))}return i&&"none"!=i&&(s=CKEDITOR.tools.parseCssText(r.style||""),"center"==i&&"figure"==e.name?e=e.wrapWith(new CKEDITOR.htmlParser.element("div",t?{"class":t[1]}:{style:"text-align:center"})):i in{left:1,right:1}&&(t?n.addClass(t[d[i]]):s["float"]=i),!t&&!CKEDITOR.tools.isEmpty(s)&&(r.style=CKEDITOR.tools.writeCssText(s))),e}}function r(e){var t=e.config.image2_captionedClass,n=e.config.image2_alignClasses,r={figure:1,a:1,img:1};return function(s){if(s.name in{div:1,p:1}){var o=s.children;if(1!==o.length)return!1;o=o[0];if(o.name in r){if("p"==s.name){if(!i(o))return!1}else if("figure"==o.name){if(!o.hasClass(t))return!1}else if(e.enterMode==CKEDITOR.ENTER_P||!i(o))return!1;return(n?s.hasClass(n[1]):"center"==CKEDITOR.tools.parseCssText(s.attributes.style||"",!0)["text-align"])?!0:!1}return!1}return!1}}function i(e){return"img"==e.name?!0:"a"==e.name?1==e.children.length&&e.getFirst("img"):!1}function s(e){var t=e.editor,n=t.editable(),r=t.document,i=e.resizer=r.createElement("span");i.addClass("cke_image_resizer"),i.setAttribute("title",t.lang.image2.resizer),i.append(new CKEDITOR.dom.text("​",r));if(e.inline)e.wrapper.append(i);else{var s=e.parts.link||e.parts.image,o=s.getParent(),u=r.createElement("span");u.addClass("cke_image_resizer_wrapper"),u.append(s),u.append(i),e.element.append(u,!0),o.is("span")&&o.remove()}i.on("mousedown",function(s){function o(e,t,n){var i=CKEDITOR.document,s=[];r.equals(i)||s.push(i.on(e,t)),s.push(r.on(e,t));if(n)for(e=s.length;e--;)n.push(s.pop())}function u(){E=p+l*T,S=Math.round(E/v)}function a(){S=d-N,E=Math.round(S*v)}var f=e.parts.image,l="right"==e.data.align?-1:1,c=s.data.$.screenX,h=s.data.$.screenY,p=f.$.clientWidth,d=f.$.clientHeight,v=p/d,m=[],y="cke_image_s"+(~l?"e":"w"),w,E,S,x,T,N,C;t.fire("saveSnapshot"),o("mousemove",function(e){w=e.data.$,T=w.screenX-c,N=h-w.screenY,C=Math.abs(T/N),1==l?0>=T?0>=N?u():C>=v?u():a():0>=N?C>=v?a():u():a():0>=T?0>=N?C>=v?a():u():a():0>=N?u():C>=v?u():a(),15<=E&&15<=S?(f.setAttributes({width:E,height:S}),x=!0):x=!1},m),o("mouseup",function(){for(var r;r=m.pop();)r.removeListener();n.removeClass(y),i.removeClass("cke_image_resizing"),x&&(e.setData({width:E,height:S}),t.fire("saveSnapshot")),x=!1},m),n.addClass(y),i.addClass("cke_image_resizing")}),e.on("data",function(){i["right"==e.data.align?"addClass":"removeClass"]("cke_image_resizer_left")})}function o(e){var t=[],n;return function(r){var i=e.getCommand("justify"+r);i&&(t.push(function(){i.refresh(e,e.elementPath())}),r in{right:1,left:1,center:1}&&i.on("exec",function(n){var i=a(e);if(i){i.setData("align",r);for(i=t.length;i--;)t[i]();n.cancel()}}),i.on("refresh",function(t){var i=a(e),s={right:1,left:1,center:1};i&&(void 0===n&&(n=e.filter.checkFeature(e.widgets.registered.image.features.align)),n?this.setState(i.data.align==r?CKEDITOR.TRISTATE_ON:r in s?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED):this.setState(CKEDITOR.TRISTATE_DISABLED),t.cancel())}))}}function u(e){e.plugins.link&&(CKEDITOR.on("dialogDefinition",function(t){t=t.data;if("link"==t.name){var t=t.definition,n=t.onShow,r=t.onOk;t.onShow=function(){var t=a(e);t&&(t.inline?!t.wrapper.getAscendant("a"):1)?this.setupContent(t.data.link||{}):n.apply(this,arguments)},t.onOk=function(){var t=a(e);if(t&&(t.inline?!t.wrapper.getAscendant("a"):1)){var n={};this.commitContent(n),t.setData("link",n)}else r.apply(this,arguments)}}}),e.getCommand("unlink").on("exec",function(t){var n=a(e);n&&n.parts.link&&(n.setData("link",null),this.refresh(e,e.elementPath()),t.cancel())}),e.getCommand("unlink").on("refresh",function(t){var n=a(e);n&&(this.setState(n.data.link||n.wrapper.getAscendant("a")?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),t.cancel())}))}function a(e){return(e=e.widgets.focused)&&"image"==e.name?e:null}function f(e){var t=e.config.image2_alignClasses,e={div:{match:r(e)},p:{match:r(e)},img:{attributes:"!src,alt,width,height"},figure:{classes:"!"+e.config.image2_captionedClass},figcaption:!0};return t?(e.div.classes=t[1],e.p.classes=e.div.classes,e.img.classes=t[0]+","+t[2],e.figure.classes+=","+e.img.classes):(e.div.styles="text-align",e.p.styles="text-align",e.img.styles="float",e.figure.styles="float,display"),e}function l(e){return e=e.config.image2_alignClasses,{dimension:{requiredContent:"img[width,height]"},align:{requiredContent:"img"+(e?"("+e[0]+")":"{float}")},caption:{requiredContent:"figcaption"}}}function c(e){return e.data.hasCaption?e.element:e.parts.image}var h='<img alt="" src="" />',p=new CKEDITOR.template('<figure class="{captionedClass}">'+h+"<figcaption>{captionPlaceholder}</figcaption></figure>"),d={left:0,center:1,right:2},v=/^\s*(\d+\%)\s*$/i;CKEDITOR.plugins.add("image2",{requires:"widget,dialog",icons:"image",hidpi:!0,onLoad:function(){CKEDITOR.addCss(".cke_image_nocaption{line-height:0}.cke_editable.cke_image_sw, .cke_editable.cke_image_sw *{cursor:sw-resize !important}.cke_editable.cke_image_se, .cke_editable.cke_image_se *{cursor:se-resize !important}.cke_image_resizer{display:none;position:absolute;width:10px;height:10px;bottom:-5px;right:-5px;background:#000;outline:1px solid #fff;line-height:0;cursor:se-resize;}.cke_image_resizer_wrapper{position:relative;display:inline-block;line-height:0;}.cke_image_resizer.cke_image_resizer_left{right:auto;left:-5px;cursor:sw-resize;}.cke_widget_wrapper:hover .cke_image_resizer,.cke_image_resizer.cke_image_resizing{display:block}.cke_widget_wrapper>a{display:inline-block}")},init:function(t){var n=t.config,r=t.lang.image2,i=e(t);n.filebrowserImage2BrowseUrl=n.filebrowserImageBrowseUrl,n.filebrowserImage2UploadUrl=n.filebrowserImageUploadUrl,i.pathName=r.pathName,i.editables.caption.pathName=r.pathNameCaption,t.widgets.add("image",i),t.ui.addButton&&t.ui.addButton("Image",{label:t.lang.common.image,command:"image",toolbar:"insert,10"}),t.contextMenu&&(t.addMenuGroup("image",10),t.addMenuItem("image",{label:r.menu,command:"image",group:"image"})),CKEDITOR.dialog.add("image2",this.path+"dialogs/image2.js")},afterInit:function(e){var t={left:1,right:1,center:1,block:1},n=o(e),r;for(r in t)n(r);u(e)}}),CKEDITOR.plugins.image2={stateShifter:function(e){function t(e,t){var s={};return i?s.attributes={"class":i[1]}:s.styles={"text-align":"center"},s=r.createElement(e.activeEnterMode==CKEDITOR.ENTER_P?"p":"div",s),n(s,t),t.move(s),s}function n(t,n){if(n.getParent()){var r=e.createRange();r.moveToPosition(n,CKEDITOR.POSITION_BEFORE_START),n.remove(),o.insertElementIntoRange(t,r)}else t.replace(n)}var r=e.document,i=e.config.image2_alignClasses,s=e.config.image2_captionedClass,o=e.editable(),u=["hasCaption","align","link"],a={align:function(n,r,s){var o=n.element;n.changed.align?!n.newData.hasCaption&&("center"==s&&(n.deflate(),n.element=t(e,o)),!n.changed.hasCaption&&"center"==r&&"center"!=s)&&(n.deflate(),r=o.findOne("a,img"),r.replace(o),n.element=r):"center"==s&&n.changed.hasCaption&&!n.newData.hasCaption&&(n.deflate(),n.element=t(e,o)),!i&&o.is("figure")&&("center"==s?o.setStyle("display","inline-block"):o.removeStyle("display"))},hasCaption:function(t,i,o){t.changed.hasCaption&&(i=t.element.is({img:1,a:1})?t.element:t.element.findOne("a,img"),t.deflate(),o?(o=CKEDITOR.dom.element.createFromHtml(p.output({captionedClass:s,captionPlaceholder:e.lang.image2.captionPlaceholder}),r),n(o,t.element),i.replace(o.findOne("img")),t.element=o):(i.replace(t.element),t.element=i))},link:function(t,n,i){if(t.changed.link){var s=t.element.is("img")?t.element:t.element.findOne("img"),o=t.element.is("a")?t.element:t.element.findOne("a"),u=t.element.is("a")&&!i||t.element.is("img")&&i,a;u&&t.deflate(),i?(n||(a=r.createElement("a",{attributes:{href:t.newData.link.url}}),a.replace(s),s.move(a)),i=CKEDITOR.plugins.link.getLinkAttributes(e,i),CKEDITOR.tools.isEmpty(i.set)||(a||o).setAttributes(i.set),i.removed.length&&(a||o).removeAttributes(i.removed)):(i=o.findOne("img"),i.replace(o),a=i),u&&(t.element=a)}}};return function(e){var t,n;e.changed={};for(n=0;n<u.length;n++)t=u[n],e.changed[t]=e.oldData?e.oldData[t]!==e.newData[t]:!1;for(n=0;n<u.length;n++)t=u[n],a[t](e,e.oldData?e.oldData[t]:null,e.newData[t]);e.inflate()}},checkHasNaturalRatio:function(e){var t=e.$,e=this.getNatural(e);return Math.round(t.clientWidth/e.width*e.height)==t.clientHeight||Math.round(t.clientHeight/e.height*e.width)==t.clientWidth},getNatural:function(e){if(e.$.naturalWidth)e={width:e.$.naturalWidth,height:e.$.naturalHeight};else{var t=new Image;t.src=e.getAttribute("src"),e={width:t.width,height:t.height}}return e}}}(),CKEDITOR.config.image2_captionedClass="image",function(){function e(e,r){var s,o;r.on("refresh",function(e){var r=[t],s;for(s in e.data.states)r.push(e.data.states[s]);this.setState(CKEDITOR.tools.search(r,n)?n:t)},r,null,100),r.on("exec",function(t){s=e.getSelection(),o=s.createBookmarks(1),t.data||(t.data={}),t.data.done=!1},r,null,0),r.on("exec",function(){e.forceNextSelectionCheck(),s.selectBookmarks(o)},r,null,100)}var t=CKEDITOR.TRISTATE_DISABLED,n=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indent",{init:function(t){var n=CKEDITOR.plugins.indent.genericDefinition;e(t,t.addCommand("indent",new n(!0))),e(t,t.addCommand("outdent",new n)),t.ui.addButton&&(t.ui.addButton("Indent",{label:t.lang.indent.indent,command:"indent",directional:!0,toolbar:"indent,20"}),t.ui.addButton("Outdent",{label:t.lang.indent.outdent,command:"outdent",directional:!0,toolbar:"indent,10"})),t.on("dirChanged",function(e){var n=t.createRange(),r=e.data.node;n.setStartBefore(r),n.setEndAfter(r);for(var i=new CKEDITOR.dom.walker(n),s;s=i.next();)if(s.type==CKEDITOR.NODE_ELEMENT)if(!s.equals(r)&&s.getDirection())n.setStartAfter(s),i=new CKEDITOR.dom.walker(n);else{var o=t.config.indentClasses;if(o)for(var u=e.data.dir=="ltr"?["_rtl",""]:["","_rtl"],f=0;f<o.length;f++)s.hasClass(o[f]+u[0])&&(s.removeClass(o[f]+u[0]),s.addClass(o[f]+u[1]));o=s.getStyle("margin-right"),u=s.getStyle("margin-left"),o?s.setStyle("margin-left",o):s.removeStyle("margin-left"),u?s.setStyle("margin-right",u):s.removeStyle("margin-right")}})}}),CKEDITOR.plugins.indent={genericDefinition:function(e){this.isIndent=!!e,this.startDisabled=!this.isIndent},specificDefinition:function(e,t,n){this.name=t,this.editor=e,this.jobs={},this.enterBr=e.config.enterMode==CKEDITOR.ENTER_BR,this.isIndent=!!n,this.relatedGlobal=n?"indent":"outdent",this.indentKey=n?9:CKEDITOR.SHIFT+9,this.database={}},registerCommands:function(e,t){e.on("pluginsLoaded",function(){for(var e in t)(function(e,t){var n=e.getCommand(t.relatedGlobal),r;for(r in t.jobs)n.on("exec",function(n){n.data.done||(e.fire("lockSnapshot"),t.execJob(e,r)&&(n.data.done=!0),e.fire("unlockSnapshot"),CKEDITOR.dom.element.clearAllMarkers(t.database))},this,null,r),n.on("refresh",function(n){n.data.states||(n.data.states={}),n.data.states[t.name+"@"+r]=t.refreshJob(e,r,n.data.path)},this,null,r);e.addFeature(t)})(this,t[e])})}},CKEDITOR.plugins.indent.genericDefinition.prototype={context:"p",exec:function(){}},CKEDITOR.plugins.indent.specificDefinition.prototype={execJob:function(e,n){var r=this.jobs[n];if(r.state!=t)return r.exec.call(this,e)},refreshJob:function(e,n,r){return n=this.jobs[n],n.state=e.activeFilter.checkFeature(this)?n.refresh.call(this,e,r):t,n.state},getContext:function(e){return e.contains(this.context)}}}(),function(){function e(e){function r(t){for(var r=a.startContainer,u=a.endContainer;r&&!r.getParent().equals(t);)r=r.getParent();for(;u&&!u.getParent().equals(t);)u=u.getParent();if(!r||!u)return!1;for(var f=r,r=[],l=!1;!l;)f.equals(u)&&(l=!0),r.push(f),f=f.getNext();if(1>r.length)return!1;f=t.getParents(!0);for(u=0;u<f.length;u++)if(f[u].getName&&o[f[u].getName()]){t=f[u];break}for(var f=i.isIndent?1:-1,u=r[0],r=r[r.length-1],l=CKEDITOR.plugins.list.listToArray(t,s),h=l[r.getCustomData("listarray_index")].indent,u=u.getCustomData("listarray_index");u<=r.getCustomData("listarray_index");u++)if(l[u].indent+=f,0<f){var p=l[u].parent;l[u].parent=new CKEDITOR.dom.element(p.getName(),p.getDocument())}for(u=r.getCustomData("listarray_index")+1;u<l.length&&l[u].indent>h;u++)l[u].indent+=f;r=CKEDITOR.plugins.list.arrayToList(l,s,null,e.config.enterMode,t.getDirection());if(!i.isIndent){var v;if((v=t.getParent())&&v.is("li"))for(var f=r.listNode.getChildren(),g=[],y,u=f.count()-1;0<=u;u--)(y=f.getItem(u))&&y.is&&y.is("li")&&g.push(y)}r&&r.listNode.replace(t);if(g&&g.length)for(u=0;u<g.length;u++){for(y=t=g[u];(y=y.getNext())&&y.is&&y.getName()in o;)CKEDITOR.env.needsNbspFiller&&!t.getFirst(n)&&t.append(a.document.createText(" ")),t.append(y);t.insertAfter(v)}return r&&e.fire("contentDomInvalidated"),!0}for(var i=this,s=this.database,o=this.context,u=e.getSelection(),u=(u&&u.getRanges()).createIterator(),a;a=u.getNextRange();){for(var f=a.getCommonAncestor();f&&(f.type!=CKEDITOR.NODE_ELEMENT||!o[f.getName()]);){if(e.editable().equals(f)){f=!1;break}f=f.getParent()}f||(f=a.startPath().contains(o))&&a.setEndAt(f,CKEDITOR.POSITION_BEFORE_END);if(!f){var l=a.getEnclosedNode();l&&l.type==CKEDITOR.NODE_ELEMENT&&l.getName()in o&&(a.setStartAt(l,CKEDITOR.POSITION_AFTER_START),a.setEndAt(l,CKEDITOR.POSITION_BEFORE_END),f=l)}f&&a.startContainer.type==CKEDITOR.NODE_ELEMENT&&a.startContainer.getName()in o&&(l=new CKEDITOR.dom.walker(a),l.evaluator=t,a.startContainer=l.next()),f&&a.endContainer.type==CKEDITOR.NODE_ELEMENT&&a.endContainer.getName()in o&&(l=new CKEDITOR.dom.walker(a),l.evaluator=t,a.endContainer=l.previous());if(f)return r(f)}return 0}function t(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.is("li")}function n(e){return r(e)&&i(e)}var r=CKEDITOR.dom.walker.whitespaces(!0),i=CKEDITOR.dom.walker.bookmark(!1,!0),s=CKEDITOR.TRISTATE_DISABLED,o=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indentlist",{requires:"indent",init:function(t){function n(t){r.specificDefinition.apply(this,arguments),this.requiredContent=["ul","ol"],t.on("key",function(e){if("wysiwyg"==t.mode&&e.data.keyCode==this.indentKey){var n=this.getContext(t.elementPath());n&&(!this.isIndent||!CKEDITOR.plugins.indentList.firstItemInPath(this.context,t.elementPath(),n))&&(t.execCommand(this.relatedGlobal),e.cancel())}},this),this.jobs[this.isIndent?10:30]={refresh:this.isIndent?function(e,t){var n=this.getContext(t),r=CKEDITOR.plugins.indentList.firstItemInPath(this.context,t,n);return!n||!this.isIndent||r?s:o}:function(e,t){return!this.getContext(t)||this.isIndent?s:o},exec:CKEDITOR.tools.bind(e,this)}}var r=CKEDITOR.plugins.indent;r.registerCommands(t,{indentlist:new n(t,"indentlist",!0),outdentlist:new n(t,"outdentlist")}),CKEDITOR.tools.extend(n.prototype,r.specificDefinition.prototype,{context:{ol:1,ul:1}})}}),CKEDITOR.plugins.indentList={},CKEDITOR.plugins.indentList.firstItemInPath=function(e,n,r){var i=n.contains(t);return r||(r=n.contains(e)),r&&i&&i.equals(r.getFirst(t))}}(),function(){function e(e,t){var t=void 0===t||t,n;if(t)n=e.getComputedStyle("text-align");else{for(;!e.hasAttribute||!e.hasAttribute("align")&&!e.getStyle("text-align");){n=e.getParent();if(!n)break;e=n}n=e.getStyle("text-align")||e.getAttribute("align")||""}return n&&(n=n.replace(/(?:-(?:moz|webkit)-)?(?:start|auto)/i,"")),!n&&t&&(n="rtl"==e.getComputedStyle("direction")?"right":"left"),n}function t(e,t,n){this.editor=e,this.name=t,this.value=n,this.context="p";var t=e.config.justifyClasses,r=e.config.enterMode==CKEDITOR.ENTER_P?"p":"div";if(t){switch(n){case"left":this.cssClassName=t[0];break;case"center":this.cssClassName=t[1];break;case"right":this.cssClassName=t[2];break;case"justify":this.cssClassName=t[3]}this.cssClassRegex=RegExp("(?:^|\\s+)(?:"+t.join("|")+")(?=$|\\s)"),this.requiredContent=r+"("+this.cssClassName+")"}else this.requiredContent=r+"{text-align}";this.allowedContent={"caption div h1 h2 h3 h4 h5 h6 p pre td th li":{propertiesOnly:!0,styles:this.cssClassName?null:"text-align",classes:this.cssClassName||null}},e.config.enterMode==CKEDITOR.ENTER_BR&&(this.allowedContent.div=!0)}function n(e){var t=e.editor,n=t.createRange();n.setStartBefore(e.data.node),n.setEndAfter(e.data.node);for(var r=new CKEDITOR.dom.walker(n),i;i=r.next();)if(i.type==CKEDITOR.NODE_ELEMENT)if(!i.equals(e.data.node)&&i.getDirection())n.setStartAfter(i),r=new CKEDITOR.dom.walker(n);else{var s=t.config.justifyClasses;s&&(i.hasClass(s[0])?(i.removeClass(s[0]),i.addClass(s[2])):i.hasClass(s[2])&&(i.removeClass(s[2]),i.addClass(s[0]))),s=i.getStyle("text-align"),"left"==s?i.setStyle("text-align","right"):"right"==s&&i.setStyle("text-align","left")}}t.prototype={exec:function(t){var n=t.getSelection(),r=t.config.enterMode;if(n){for(var i=n.createBookmarks(),s=n.getRanges(),o=this.cssClassName,u,a,f=t.config.useComputedState,f=void 0===f||f,c=s.length-1;0<=c;c--){u=s[c].createIterator();for(u.enlargeBr=r!=CKEDITOR.ENTER_BR;a=u.getNextParagraph(r==CKEDITOR.ENTER_P?"p":"div");)if(!a.isReadOnly()){a.removeAttribute("align"),a.removeStyle("text-align");var h=o&&(a.$.className=CKEDITOR.tools.ltrim(a.$.className.replace(this.cssClassRegex,""))),p=this.state==CKEDITOR.TRISTATE_OFF&&(!f||e(a,!0)!=this.value);o?p?a.addClass(o):h||a.removeAttribute("class"):p&&a.setStyle("text-align",this.value)}}t.focus(),t.forceNextSelectionCheck(),n.selectBookmarks(i)}},refresh:function(t,n){var r=n.block||n.blockLimit;this.setState("body"!=r.getName()&&e(r,this.editor.config.useComputedState)==this.value?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)}},CKEDITOR.plugins.add("justify",{init:function(e){if(!e.blockless){var r=new t(e,"justifyleft","left"),i=new t(e,"justifycenter","center"),s=new t(e,"justifyright","right"),o=new t(e,"justifyblock","justify");e.addCommand("justifyleft",r),e.addCommand("justifycenter",i),e.addCommand("justifyright",s),e.addCommand("justifyblock",o),e.ui.addButton&&(e.ui.addButton("JustifyLeft",{label:e.lang.justify.left,command:"justifyleft",toolbar:"align,10"}),e.ui.addButton("JustifyCenter",{label:e.lang.justify.center,command:"justifycenter",toolbar:"align,20"}),e.ui.addButton("JustifyRight",{label:e.lang.justify.right,command:"justifyright",toolbar:"align,30"}),e.ui.addButton("JustifyBlock",{label:e.lang.justify.block,command:"justifyblock",toolbar:"align,40"})),e.on("dirChanged",n)}}})}(),function(){function e(e,t){var n=r.exec(e),i=r.exec(t);if(n){if(!n[2]&&"px"==i[2])return i[1];if("px"==n[2]&&!i[2])return i[1]+"px"}return t}var t=CKEDITOR.htmlParser.cssStyle,n=CKEDITOR.tools.cssLength,r=/^((?:\d*(?:\.\d+))|(?:\d+))(.*)?$/i,i={elements:{$:function(n){var r=n.attributes;if((r=(r=(r=r&&r["data-cke-realelement"])&&new CKEDITOR.htmlParser.fragment.fromHtml(decodeURIComponent(r)))&&r.children[0])&&n.attributes["data-cke-resizable"]){var i=(new t(n)).rules,n=r.attributes,s=i.width,i=i.height;s&&(n.width=e(n.width,s)),i&&(n.height=e(n.height,i))}return r}}};CKEDITOR.plugins.add("fakeobjects",{init:function(e){e.filter.allow("img[!data-cke-realelement,src,alt,title](*){*}","fakeobjects")},afterInit:function(e){(e=(e=e.dataProcessor)&&e.htmlFilter)&&e.addRules(i,{applyToAll:!0})}}),CKEDITOR.editor.prototype.createFakeElement=function(e,r,i,s){var o=this.lang.fakeobjects,o=o[i]||o.unknown,r={"class":r,"data-cke-realelement":encodeURIComponent(e.getOuterHtml()),"data-cke-real-node-type":e.type,alt:o,title:o,align:e.getAttribute("align")||""};return CKEDITOR.env.hc||(r.src=CKEDITOR.tools.transparentImageData),i&&(r["data-cke-real-element-type"]=i),s&&(r["data-cke-resizable"]=s,i=new t,s=e.getAttribute("width"),e=e.getAttribute("height"),s&&(i.rules.width=n(s)),e&&(i.rules.height=n(e)),i.populate(r)),this.document.createElement("img",{attributes:r})},CKEDITOR.editor.prototype.createFakeParserElement=function(e,r,i,s){var o=this.lang.fakeobjects,o=o[i]||o.unknown,u;return u=new CKEDITOR.htmlParser.basicWriter,e.writeHtml(u),u=u.getHtml(),r={"class":r,"data-cke-realelement":encodeURIComponent(u),"data-cke-real-node-type":e.type,alt:o,title:o,align:e.attributes.align||""},CKEDITOR.env.hc||(r.src=CKEDITOR.tools.transparentImageData),i&&(r["data-cke-real-element-type"]=i),s&&(r["data-cke-resizable"]=s,s=e.attributes,e=new t,i=s.width,s=s.height,void 0!==i&&(e.rules.width=n(i)),void 0!==s&&(e.rules.height=n(s)),e.populate(r)),new CKEDITOR.htmlParser.element("img",r)},CKEDITOR.editor.prototype.restoreRealElement=function(t){if(t.data("cke-real-node-type")!=CKEDITOR.NODE_ELEMENT)return null;var n=CKEDITOR.dom.element.createFromHtml(decodeURIComponent(t.data("cke-realelement")),this.document);if(t.data("cke-resizable")){var r=t.getStyle("width"),t=t.getStyle("height");r&&n.setAttribute("width",e(n.getAttribute("width"),r)),t&&n.setAttribute("height",e(n.getAttribute("height"),t))}return n}}(),function(){function e(e){return e.replace(/'/g,"\\$&")}function t(e){for(var t,n=e.length,r=[],i=0;i<n;i++)t=e.charCodeAt(i),r.push(t);return"String.fromCharCode("+r.join(",")+")"}function n(t,n){var r=t.plugins.link,i=r.compiledProtectionFunction.params,s,o;o=[r.compiledProtectionFunction.name,"("];for(var u=0;u<i.length;u++)r=i[u].toLowerCase(),s=n[r],0<u&&o.push(","),o.push("'",s?e(encodeURIComponent(n[r])):"","'");return o.push(")"),o.join("")}function r(e){var e=e.config.emailProtection||"",t;return e&&"encode"!=e&&(t={},e.replace(/^([^(]+)\(([^)]+)\)$/,function(e,n,r){t.name=n,t.params=[],r.replace(/[^,\s]+/g,function(e){t.params.push(e)})})),t}CKEDITOR.plugins.add("link",{requires:"dialog,fakeobjects",onLoad:function(){function e(e){return n.replace(/%1/g,"rtl"==e?"right":"left").replace(/%2/g,"cke_contents_"+e)}var t="background:url("+CKEDITOR.getUrl(this.path+"images"+(CKEDITOR.env.hidpi?"/hidpi":"")+"/anchor.png")+") no-repeat %1 center;border:1px dotted #00f;background-size:16px;",n=".%2 a.cke_anchor,.%2 a.cke_anchor_empty,.cke_editable.%2 a[name],.cke_editable.%2 a[data-cke-saved-name]{"+t+"padding-%1:18px;cursor:auto;}.%2 img.cke_anchor{"+t+"width:16px;min-height:15px;height:1.15em;vertical-align:text-bottom;}";CKEDITOR.addCss(e("ltr")+e("rtl"))},init:function(e){var t="a[!href]";CKEDITOR.dialog.isTabEnabled(e,"link","advanced")&&(t=t.replace("]",",accesskey,charset,dir,id,lang,name,rel,tabindex,title,type]{*}(*)")),CKEDITOR.dialog.isTabEnabled(e,"link","target")&&(t=t.replace("]",",target,onclick]")),e.addCommand("link",new CKEDITOR.dialogCommand("link",{allowedContent:t,requiredContent:"a[href]"})),e.addCommand("anchor",new CKEDITOR.dialogCommand("anchor",{allowedContent:"a[!name,id]",requiredContent:"a[name]"})),e.addCommand("unlink",new CKEDITOR.unlinkCommand),e.addCommand("removeAnchor",new CKEDITOR.removeAnchorCommand),e.setKeystroke(CKEDITOR.CTRL+76,"link"),e.ui.addButton&&(e.ui.addButton("Link",{label:e.lang.link.toolbar,command:"link",toolbar:"links,10"}),e.ui.addButton("Unlink",{label:e.lang.link.unlink,command:"unlink",toolbar:"links,20"}),e.ui.addButton("Anchor",{label:e.lang.link.anchor.toolbar,command:"anchor",toolbar:"links,30"})),CKEDITOR.dialog.add("link",this.path+"dialogs/link.js"),CKEDITOR.dialog.add("anchor",this.path+"dialogs/anchor.js"),e.on("doubleclick",function(t){var n=CKEDITOR.plugins.link.getSelectedLink(e)||t.data.element;n.isReadOnly()||(n.is("a")?(t.data.dialog=n.getAttribute("name")&&(!n.getAttribute("href")||!n.getChildCount())?"anchor":"link",t.data.link=n):CKEDITOR.plugins.link.tryRestoreFakeAnchor(e,n)&&(t.data.dialog="anchor"))},null,null,0),e.on("doubleclick",function(t){t.data.dialog in{link:1,anchor:1}&&t.data.link&&e.getSelection().selectElement(t.data.link)},null,null,20),e.addMenuItems&&e.addMenuItems({anchor:{label:e.lang.link.anchor.menu,command:"anchor",group:"anchor",order:1},removeAnchor:{label:e.lang.link.anchor.remove,command:"removeAnchor",group:"anchor",order:5},link:{label:e.lang.link.menu,command:"link",group:"link",order:1},unlink:{label:e.lang.link.unlink,command:"unlink",group:"link",order:5}}),e.contextMenu&&e.contextMenu.addListener(function(t){if(!t||t.isReadOnly())return null;t=CKEDITOR.plugins.link.tryRestoreFakeAnchor(e,t);if(!t&&!(t=CKEDITOR.plugins.link.getSelectedLink(e)))return null;var n={};return t.getAttribute("href")&&t.getChildCount()&&(n={link:CKEDITOR.TRISTATE_OFF,unlink:CKEDITOR.TRISTATE_OFF}),t&&t.hasAttribute("name")&&(n.anchor=n.removeAnchor=CKEDITOR.TRISTATE_OFF),n}),this.compiledProtectionFunction=r(e)},afterInit:function(e){e.dataProcessor.dataFilter.addRules({elements:{a:function(t){return t.attributes.name?t.children.length?null:e.createFakeParserElement(t,"cke_anchor","anchor"):null}}});var t=e._.elementsPath&&e._.elementsPath.filters;t&&t.push(function(t,n){if("a"==n&&(CKEDITOR.plugins.link.tryRestoreFakeAnchor(e,t)||t.getAttribute("name")&&(!t.getAttribute("href")||!t.getChildCount())))return"anchor"})}});var i=/^javascript:/,s=/^mailto:([^?]+)(?:\?(.+))?$/,o=/subject=([^;?:@&=$,\/]*)/,u=/body=([^;?:@&=$,\/]*)/,a=/^#(.*)$/,f=/^((?:http|https|ftp|news):\/\/)?(.*)$/,l=/^(_(?:self|top|parent|blank))$/,c=/^javascript:void\(location\.href='mailto:'\+String\.fromCharCode\(([^)]+)\)(?:\+'(.*)')?\)$/,h=/^javascript:([^(]+)\(([^)]+)\)$/,p=/\s*window.open\(\s*this\.href\s*,\s*(?:'([^']*)'|null)\s*,\s*'([^']*)'\s*\)\s*;\s*return\s*false;*\s*/,d=/(?:^|,)([^=]+)=(\d+|yes|no)/gi,v={id:"advId",dir:"advLangDir",accessKey:"advAccessKey",name:"advName",lang:"advLangCode",tabindex:"advTabIndex",title:"advTitle",type:"advContentType","class":"advCSSClasses",charset:"advCharset",style:"advStyles",rel:"advRel"};CKEDITOR.plugins.link={getSelectedLink:function(e){var t=e.getSelection(),n=t.getSelectedElement();return n&&n.is("a")?n:(t=t.getRanges()[0])?(t.shrink(CKEDITOR.SHRINK_TEXT),e.elementPath(t.getCommonAncestor()).contains("a",1)):null},getEditorAnchors:function(e){for(var t=e.editable(),n=t.isInline()&&!e.plugins.divarea?e.document:t,t=n.getElementsByTag("a"),n=n.getElementsByTag("img"),r=[],i=0,s;s=t.getItem(i++);)(s.data("cke-saved-name")||s.hasAttribute("name"))&&r.push({name:s.data("cke-saved-name")||s.getAttribute("name"),id:s.getAttribute("id")});for(i=0;s=n.getItem(i++);)(s=this.tryRestoreFakeAnchor(e,s))&&r.push({name:s.getAttribute("name"),id:s.getAttribute("id")});return r},fakeAnchor:!0,tryRestoreFakeAnchor:function(e,t){if(t&&t.data("cke-real-element-type")&&"anchor"==t.data("cke-real-element-type")){var n=e.restoreRealElement(t);if(n.data("cke-saved-name"))return n}},parseLinkAttributes:function(e,t){var n=t&&(t.data("cke-saved-href")||t.getAttribute("href"))||"",r=e.plugins.link.compiledProtectionFunction,m=e.config.emailProtection,g,b={};n.match(i)&&("encode"==m?n=n.replace(c,function(e,t,n){return"mailto:"+String.fromCharCode.apply(String,t.split(","))+(n&&n.replace(/\\'/g,"'"))}):m&&n.replace(h,function(e,t,n){if(t==r.name){b.type="email";for(var e=b.email={},t=/(^')|('$)/g,n=n.match(/[^,\s]+/g),i=n.length,s,o,u=0;u<i;u++)s=decodeURIComponent,o=n[u].replace(t,"").replace(/\\'/g,"'"),o=s(o),s=r.params[u].toLowerCase(),e[s]=o;e.address=[e.name,e.domain].join("@")}}));if(!b.type)if(m=n.match(a))b.type="anchor",b.anchor={},b.anchor.name=b.anchor.id=m[1];else if(m=n.match(s)){g=n.match(o),n=n.match(u),b.type="email";var E=b.email={};E.address=m[1],g&&(E.subject=decodeURIComponent(g[1])),n&&(E.body=decodeURIComponent(n[1]))}else n&&(g=n.match(f))&&(b.type="url",b.url={},b.url.protocol=g[1],b.url.url=g[2]);if(t){if(n=t.getAttribute("target"))b.target={type:n.match(l)?n:"frame",name:n};else if(n=(n=t.data("cke-pa-onclick")||t.getAttribute("onclick"))&&n.match(p))for(b.target={type:"popup",name:n[1]};m=d.exec(n[2]);)"yes"!=m[2]&&"1"!=m[2]||m[1]in{height:1,width:1,top:1,left:1}?isFinite(m[2])&&(b.target[m[1]]=m[2]):b.target[m[1]]=!0;var n={},S;for(S in v)(m=t.getAttribute(S))&&(n[v[S]]=m);if(S=t.data("cke-saved-name")||n.advName)n.advName=S;CKEDITOR.tools.isEmpty(n)||(b.advanced=n)}return b},getLinkAttributes:function(r,i){var s=r.config.emailProtection||"",o={};switch(i.type){case"url":var s=i.url&&void 0!==i.url.protocol?i.url.protocol:"http://",u=i.url&&CKEDITOR.tools.trim(i.url.url)||"";o["data-cke-saved-href"]=0===u.indexOf("/")?u:s+u;break;case"anchor":s=i.anchor&&i.anchor.id,o["data-cke-saved-href"]="#"+(i.anchor&&i.anchor.name||s||"");break;case"email":var a=i.email,u=a.address;switch(s){case"":case"encode":var f=encodeURIComponent(a.subject||""),l=encodeURIComponent(a.body||""),a=[];f&&a.push("subject="+f),l&&a.push("body="+l),a=a.length?"?"+a.join("&"):"","encode"==s?(s=["javascript:void(location.href='mailto:'+",t(u)],a&&s.push("+'",e(a),"'"),s.push(")")):s=["mailto:",u,a];break;default:s=u.split("@",2),a.name=s[0],a.domain=s[1],s=["javascript:",n(r,a)]}o["data-cke-saved-href"]=s.join("")}if(i.target)if("popup"==i.target.type){for(var s=["window.open(this.href, '",i.target.name||"","', '"],c="resizable status location toolbar menubar fullscreen scrollbars dependent".split(" "),u=c.length,f=function(e){i.target[e]&&c.push(e+"="+i.target[e])},a=0;a<u;a++)c[a]+=i.target[c[a]]?"=yes":"=no";f("width"),f("left"),f("height"),f("top"),s.push(c.join(","),"'); return false;"),o["data-cke-pa-onclick"]=s.join("")}else"notSet"!=i.target.type&&i.target.name&&(o.target=i.target.name);if(i.advanced){for(var h in v)(s=i.advanced[v[h]])&&(o[h]=s);o.name&&(o["data-cke-saved-name"]=o.name)}o["data-cke-saved-href"]&&(o.href=o["data-cke-saved-href"]),h={target:1,onclick:1,"data-cke-pa-onclick":1,"data-cke-saved-name":1},i.advanced&&CKEDITOR.tools.extend(h,v);for(var p in o)delete h[p];return{set:o,removed:CKEDITOR.tools.objectKeys(h)}}},CKEDITOR.unlinkCommand=function(){},CKEDITOR.unlinkCommand.prototype={exec:function(e){var t=new CKEDITOR.style({element:"a",type:CKEDITOR.STYLE_INLINE,alwaysRemoveElement:1});e.removeStyle(t)},refresh:function(e,t){var n=t.lastElement&&t.lastElement.getAscendant("a",!0);n&&"a"==n.getName()&&n.getAttribute("href")&&n.getChildCount()?this.setState(CKEDITOR.TRISTATE_OFF):this.setState(CKEDITOR.TRISTATE_DISABLED)},contextSensitive:1,startDisabled:1,requiredContent:"a[href]"},CKEDITOR.removeAnchorCommand=function(){},CKEDITOR.removeAnchorCommand.prototype={exec:function(e){var t=e.getSelection(),n=t.createBookmarks(),r;if(t&&(r=t.getSelectedElement())&&(r.getChildCount()?r.is("a"):CKEDITOR.plugins.link.tryRestoreFakeAnchor(e,r)))r.remove(1);else if(r=CKEDITOR.plugins.link.getSelectedLink(e))r.hasAttribute("href")?(r.removeAttributes({name:1,"data-cke-saved-name":1}),r.removeClass("cke_anchor")):r.remove(1);t.selectBookmarks(n)},requiredContent:"a[name]"},CKEDITOR.tools.extend(CKEDITOR.config,{linkShowAdvancedTab:!0,linkShowTargetTab:!0})}(),function(){function e(e,t,n){function r(n){(f=a[n?"getFirst":"getLast"]())&&(!f.is||!f.isBlockBoundary())&&(l=t.root[n?"getPrevious":"getNext"](CKEDITOR.dom.walker.invisible(!0)))&&(!l.is||!l.isBlockBoundary({br:1}))&&e.document.createElement("br")[n?"insertBefore":"insertAfter"](f)}for(var i=CKEDITOR.plugins.list.listToArray(t.root,n),s=[],o=0;o<t.contents.length;o++){var u=t.contents[o];(u=u.getAscendant("li",!0))&&!u.getCustomData("list_item_processed")&&(s.push(u),CKEDITOR.dom.element.setMarker(n,u,"list_item_processed",!0))}u=null;for(o=0;o<s.length;o++)u=s[o].getCustomData("listarray_index"),i[u].indent=-1;for(o=u+1;o<i.length;o++)if(i[o].indent>i[o-1].indent+1){s=i[o-1].indent+1-i[o].indent;for(u=i[o].indent;i[o]&&i[o].indent>=u;)i[o].indent+=s,o++;o--}var a=CKEDITOR.plugins.list.arrayToList(i,n,null,e.config.enterMode,t.root.getAttribute("dir")).listNode,f,l;r(!0),r(),a.replace(t.root),e.fire("contentDomInvalidated")}function t(e,t){this.name=e,this.context=this.type=t,this.allowedContent=t+" li",this.requiredContent=t}function n(e,t,n,r){for(var i,s;i=e[r?"getLast":"getFirst"](p);)(s=i.getDirection(1))!==t.getDirection(1)&&i.setAttribute("dir",s),i.remove(),n?i[r?"insertBefore":"insertAfter"](n):t.append(i,r)}function r(e){function t(t){var r=e[t?"getPrevious":"getNext"](l);r&&r.type==CKEDITOR.NODE_ELEMENT&&r.is(e.getName())&&(n(e,r,null,!t),e.remove(),e=r)}t(),t(1)}function i(e){return e.type==CKEDITOR.NODE_ELEMENT&&(e.getName()in CKEDITOR.dtd.$block||e.getName()in CKEDITOR.dtd.$listItem)&&CKEDITOR.dtd[e.getName()]["#"]}function s(e,t,i){e.fire("saveSnapshot"),i.enlarge(CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS);var s=i.extractContents();t.trim(!1,!0);var u=t.createBookmark(),a=new CKEDITOR.dom.elementPath(t.startContainer),f=a.block,a=a.lastElement.getAscendant("li",1)||f,h=new CKEDITOR.dom.elementPath(i.startContainer),p=h.contains(CKEDITOR.dtd.$listItem),h=h.contains(CKEDITOR.dtd.$list);f?(f=f.getBogus())&&f.remove():h&&(f=h.getPrevious(l))&&c(f)&&f.remove(),(f=s.getLast())&&f.type==CKEDITOR.NODE_ELEMENT&&f.is("br")&&f.remove(),(f=t.startContainer.getChild(t.startOffset))?s.insertBefore(f):t.startContainer.append(s),p&&(s=o(p))&&(a.contains(p)?(n(s,p.getParent(),p),s.remove()):a.append(s));for(;i.checkStartOfBlock()&&i.checkEndOfBlock();){h=i.startPath(),s=h.block;if(!s)break;s.is("li")&&(a=s.getParent(),s.equals(a.getLast(l))&&s.equals(a.getFirst(l))&&(s=a)),i.moveToPosition(s,CKEDITOR.POSITION_BEFORE_START),s.remove()}i=i.clone(),s=e.editable(),i.setEndAt(s,CKEDITOR.POSITION_BEFORE_END),i=new CKEDITOR.dom.walker(i),i.evaluator=function(e){return l(e)&&!c(e)},(i=i.next())&&i.type==CKEDITOR.NODE_ELEMENT&&i.getName()in CKEDITOR.dtd.$list&&r(i),t.moveToBookmark(u),t.select(),e.fire("saveSnapshot")}function o(e){return(e=e.getLast(l))&&e.type==CKEDITOR.NODE_ELEMENT&&e.getName()in u?e:null}var u={ol:1,ul:1},a=CKEDITOR.dom.walker.whitespaces(),f=CKEDITOR.dom.walker.bookmark(),l=function(e){return!a(e)&&!f(e)},c=CKEDITOR.dom.walker.bogus();CKEDITOR.plugins.list={listToArray:function(e,t,n,r,i){if(!u[e.getName()])return[];r||(r=0),n||(n=[]);for(var s=0,o=e.getChildCount();s<o;s++){var a=e.getChild(s);a.type==CKEDITOR.NODE_ELEMENT&&a.getName()in CKEDITOR.dtd.$list&&CKEDITOR.plugins.list.listToArray(a,t,n,r+1);if("li"==a.$.nodeName.toLowerCase()){var f={parent:e,indent:r,element:a,contents:[]};i?f.grandparent=i:(f.grandparent=e.getParent(),f.grandparent&&"li"==f.grandparent.$.nodeName.toLowerCase()&&(f.grandparent=f.grandparent.getParent())),t&&CKEDITOR.dom.element.setMarker(t,a,"listarray_index",n.length),n.push(f);for(var l=0,c=a.getChildCount(),h;l<c;l++)h=a.getChild(l),h.type==CKEDITOR.NODE_ELEMENT&&u[h.getName()]?CKEDITOR.plugins.list.listToArray(h,t,n,r+1,f.grandparent):f.contents.push(h)}}return n},arrayToList:function(e,t,n,r,i){n||(n=0);if(!e||e.length<n+1)return null;for(var s,o=e[n].parent.getDocument(),a=new CKEDITOR.dom.documentFragment(o),c=null,h=n,p=Math.max(e[n].indent,0),d=null,v,m,g=r==CKEDITOR.ENTER_P?"p":"div";;){var y=e[h];s=y.grandparent,v=y.element.getDirection(1);if(y.indent==p){if(!c||e[h].parent.getName()!=c.getName())c=e[h].parent.clone(!1,1),i&&c.setAttribute("dir",i),a.append(c);d=c.append(y.element.clone(0,1)),v!=c.getDirection(1)&&d.setAttribute("dir",v);for(s=0;s<y.contents.length;s++)d.append(y.contents[s].clone(1,1));h++}else if(y.indent==Math.max(p,0)+1)y=e[h-1].element.getDirection(1),h=CKEDITOR.plugins.list.arrayToList(e,null,h,r,y!=v?v:null),!d.getChildCount()&&CKEDITOR.env.needsNbspFiller&&7>=o.$.documentMode&&d.append(o.createText(" ")),d.append(h.listNode),h=h.nextIndex;else{if(-1!=y.indent||!!n||!s)return null;u[s.getName()]?(d=y.element.clone(!1,!0),v!=s.getDirection(1)&&d.setAttribute("dir",v)):d=new CKEDITOR.dom.documentFragment(o);var c=s.getDirection(1)!=v,b=y.element,w=b.getAttribute("class"),E=b.getAttribute("style"),S=d.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&(r!=CKEDITOR.ENTER_BR||c||E||w),x,T=y.contents.length,N;for(s=0;s<T;s++)if(x=y.contents[s],f(x)&&1<T)S?N=x.clone(1,1):d.append(x.clone(1,1));else if(x.type==CKEDITOR.NODE_ELEMENT&&x.isBlockBoundary()){c&&!x.getDirection()&&x.setAttribute("dir",v),m=x;var C=b.getAttribute("style");C&&m.setAttribute("style",C.replace(/([^;])$/,"$1;")+(m.getAttribute("style")||"")),w&&x.addClass(w),m=null,N&&(d.append(N),N=null),d.append(x.clone(1,1))}else S?(m||(m=o.createElement(g),d.append(m),c&&m.setAttribute("dir",v)),E&&m.setAttribute("style",E),w&&m.setAttribute("class",w),N&&(m.append(N),N=null),m.append(x.clone(1,1))):d.append(x.clone(1,1));N&&((m||d).append(N),N=null),d.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&h!=e.length-1&&(CKEDITOR.env.needsBrFiller&&(v=d.getLast())&&v.type==CKEDITOR.NODE_ELEMENT&&v.is("br")&&v.remove(),v=d.getLast(l),(!v||v.type!=CKEDITOR.NODE_ELEMENT||!v.is(CKEDITOR.dtd.$block))&&d.append(o.createElement("br"))),v=d.$.nodeName.toLowerCase(),("div"==v||"p"==v)&&d.appendBogus(),a.append(d),c=null,h++}m=null;if(e.length<=h||Math.max(e[h].indent,0)<p)break}if(t)for(e=a.getFirst();e;){if(e.type==CKEDITOR.NODE_ELEMENT&&(CKEDITOR.dom.element.clearMarkers(t,e),e.getName()in CKEDITOR.dtd.$listItem&&(n=e,o=i=r=void 0,r=n.getDirection()))){for(i=n.getParent();i&&!(o=i.getDirection());)i=i.getParent();r==o&&n.removeAttribute("dir")}e=e.getNextSourceNode()}return{listNode:a,nextIndex:h}}};var h=/^h[1-6]$/,p=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT);t.prototype={exec:function(t){this.refresh(t,t.elementPath());var n=t.config,i=t.getSelection(),s=i&&i.getRanges();if(this.state==CKEDITOR.TRISTATE_OFF){var o=t.editable();if(o.getFirst(l)){var a=1==s.length&&s[0];(n=a&&a.getEnclosedNode())&&n.is&&this.type==n.getName()&&this.setState(CKEDITOR.TRISTATE_ON)}else n.enterMode==CKEDITOR.ENTER_BR?o.appendBogus():s[0].fixBlock(1,n.enterMode==CKEDITOR.ENTER_P?"p":"div"),i.selectRanges(s)}for(var n=i.createBookmarks(!0),o=[],f={},s=s.createIterator(),c=0;(a=s.getNextRange())&&++c;){var p=a.getBoundaryNodes(),d=p.startNode,v=p.endNode;d.type==CKEDITOR.NODE_ELEMENT&&"td"==d.getName()&&a.setStartAt(p.startNode,CKEDITOR.POSITION_AFTER_START),v.type==CKEDITOR.NODE_ELEMENT&&"td"==v.getName()&&a.setEndAt(p.endNode,CKEDITOR.POSITION_BEFORE_END),a=a.createIterator();for(a.forceBrBreak=this.state==CKEDITOR.TRISTATE_OFF;p=a.getNextParagraph();)if(!p.getCustomData("list_block")){CKEDITOR.dom.element.setMarker(f,p,"list_block",1);for(var m=t.elementPath(p),d=m.elements,v=0,m=m.blockLimit,g,y=d.length-1;0<=y&&(g=d[y]);y--)if(u[g.getName()]&&m.contains(g)){m.removeCustomData("list_group_object_"+c),(d=g.getCustomData("list_group_object"))?d.contents.push(p):(d={root:g,contents:[p]},o.push(d),CKEDITOR.dom.element.setMarker(f,g,"list_group_object",d)),v=1;break}v||(v=m,v.getCustomData("list_group_object_"+c)?v.getCustomData("list_group_object_"+c).contents.push(p):(d={root:v,contents:[p]},CKEDITOR.dom.element.setMarker(f,v,"list_group_object_"+c,d),o.push(d)))}}for(g=[];0<o.length;)if(d=o.shift(),this.state==CKEDITOR.TRISTATE_OFF)if(u[d.root.getName()]){s=t,c=d,d=f,a=g,v=CKEDITOR.plugins.list.listToArray(c.root,d),m=[];for(p=0;p<c.contents.length;p++)if(y=c.contents[p],(y=y.getAscendant("li",!0))&&!y.getCustomData("list_item_processed"))m.push(y),CKEDITOR.dom.element.setMarker(d,y,"list_item_processed",!0);for(var y=c.root.getDocument(),b=void 0,w=void 0,p=0;p<m.length;p++){var S=m[p].getCustomData("listarray_index"),b=v[S].parent;b.is(this.type)||(w=y.createElement(this.type),b.copyAttributes(w,{start:1,type:1}),w.removeStyle("list-style-type"),v[S].parent=w)}d=CKEDITOR.plugins.list.arrayToList(v,d,null,s.config.enterMode),v=void 0,m=d.listNode.getChildCount();for(p=0;p<m&&(v=d.listNode.getChild(p));p++)v.getName()==this.type&&a.push(v);d.listNode.replace(c.root),s.fire("contentDomInvalidated")}else{v=t,p=d,a=g,m=p.contents,s=p.root.getDocument(),c=[],1==m.length&&m[0].equals(p.root)&&(d=s.createElement("div"),m[0].moveChildren&&m[0].moveChildren(d),m[0].append(d),m[0]=d),p=p.contents[0].getParent();for(y=0;y<m.length;y++)p=p.getCommonAncestor(m[y].getParent());b=v.config.useComputedState,v=d=void 0,b=void 0===b||b;for(y=0;y<m.length;y++)for(w=m[y];S=w.getParent();){if(S.equals(p)){c.push(w),!v&&w.getDirection()&&(v=1),w=w.getDirection(b),null!==d&&(d=d&&d!=w?null:w);break}w=S}if(!(1>c.length)){m=c[c.length-1].getNext(),y=s.createElement(this.type),a.push(y);for(b=a=void 0;c.length;)a=c.shift(),b=s.createElement("li"),a.is("pre")||h.test(a.getName())||"false"==a.getAttribute("contenteditable")?a.appendTo(b):(a.copyAttributes(b),d&&a.getDirection()&&(b.removeStyle("direction"),b.removeAttribute("dir")),a.moveChildren(b),a.remove()),b.appendTo(y);d&&v&&y.setAttribute("dir",d),m?y.insertBefore(m):y.appendTo(p)}}else this.state==CKEDITOR.TRISTATE_ON&&u[d.root.getName()]&&e.call(this,t,d,f);for(y=0;y<g.length;y++)r(g[y]);CKEDITOR.dom.element.clearAllMarkers(f),i.selectBookmarks(n),t.focus()},refresh:function(e,t){var n=t.contains(u,1),r=t.blockLimit||t.root;n&&r.contains(n)?this.setState(n.is(this.type)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF):this.setState(CKEDITOR.TRISTATE_OFF)}},CKEDITOR.plugins.add("list",{requires:"indentlist",init:function(e){e.blockless||(e.addCommand("numberedlist",new t("numberedlist","ol")),e.addCommand("bulletedlist",new t("bulletedlist","ul")),e.ui.addButton&&(e.ui.addButton("NumberedList",{label:e.lang.list.numberedlist,command:"numberedlist",directional:!0,toolbar:"list,10"}),e.ui.addButton("BulletedList",{label:e.lang.list.bulletedlist,command:"bulletedlist",directional:!0,toolbar:"list,20"})),e.on("key",function(t){var n=t.data.domEvent.getKey(),r;if(e.mode=="wysiwyg"&&n in{8:1,46:1}){var a=e.getSelection().getRanges()[0],f=a&&a.startPath();if(a&&a.collapsed){var h=n==8,p=e.editable(),d=new CKEDITOR.dom.walker(a.clone());d.evaluator=function(e){return l(e)&&!c(e)},d.guard=function(e,t){return!t||e.type!=CKEDITOR.NODE_ELEMENT||!e.is("table")},n=a.clone();if(h){var m;(m=f.contains(u))&&a.checkBoundaryOfElement(m,CKEDITOR.START)&&(m=m.getParent())&&m.is("li")&&(m=o(m))?(r=m,m=m.getPrevious(l),n.moveToPosition(m&&c(m)?m:r,CKEDITOR.POSITION_BEFORE_START)):(d.range.setStartAt(p,CKEDITOR.POSITION_AFTER_START),d.range.setEnd(a.startContainer,a.startOffset),(m=d.previous())&&m.type==CKEDITOR.NODE_ELEMENT&&(m.getName()in u||m.is("li"))&&(m.is("li")||(d.range.selectNodeContents(m),d.reset(),d.evaluator=i,m=d.previous()),r=m,n.moveToElementEditEnd(r),n.moveToPosition(n.endPath().block,CKEDITOR.POSITION_BEFORE_END)));if(r)s(e,n,a),t.cancel();else{var g=f.contains(u);g&&a.checkBoundaryOfElement(g,CKEDITOR.START)&&(r=g.getFirst(l),a.checkBoundaryOfElement(r,CKEDITOR.START)&&(m=g.getPrevious(l),o(r)?m&&(a.moveToElementEditEnd(m),a.select()):e.execCommand("outdent"),t.cancel()))}}else if(r=f.contains("li")){d.range.setEndAt(p,CKEDITOR.POSITION_BEFORE_END),h=(p=r.getLast(l))&&i(p)?p:r,f=0,(m=d.next())&&m.type==CKEDITOR.NODE_ELEMENT&&m.getName()in u&&m.equals(p)?(f=1,m=d.next()):a.checkBoundaryOfElement(h,CKEDITOR.END)&&(f=2);if(f&&m){a=a.clone(),a.moveToElementEditStart(m);if(f==1){n.optimize();if(!n.startContainer.equals(r)){for(r=n.startContainer;r.is(CKEDITOR.dtd.$inline);)g=r,r=r.getParent();g&&n.moveToPosition(g,CKEDITOR.POSITION_AFTER_END)}}f==2&&(n.moveToPosition(n.endPath().block,CKEDITOR.POSITION_BEFORE_END),a.endPath().block&&a.moveToPosition(a.endPath().block,CKEDITOR.POSITION_AFTER_START)),s(e,n,a),t.cancel()}}else d.range.setEndAt(p,CKEDITOR.POSITION_BEFORE_END),(m=d.next())&&m.type==CKEDITOR.NODE_ELEMENT&&m.is(u)&&(m=m.getFirst(l),f.block&&a.checkStartOfBlock()&&a.checkEndOfBlock()?(f.block.remove(),a.moveToElementEditStart(m),a.select()):o(m)?(a.moveToElementEditStart(m),a.select()):(a=a.clone(),a.moveToElementEditStart(m),s(e,n,a)),t.cancel());setTimeout(function(){e.selectionChange(1)})}}}))}})}(),function(){CKEDITOR.plugins.liststyle={requires:"dialog,contextmenu",init:function(e){if(!e.blockless){var t;t=new CKEDITOR.dialogCommand("numberedListStyle",{requiredContent:"ol",allowedContent:"ol{list-style-type}[start]"}),t=e.addCommand("numberedListStyle",t),e.addFeature(t),CKEDITOR.dialog.add("numberedListStyle",this.path+"dialogs/liststyle.js"),t=new CKEDITOR.dialogCommand("bulletedListStyle",{requiredContent:"ul",allowedContent:"ul{list-style-type}"}),t=e.addCommand("bulletedListStyle",t),e.addFeature(t),CKEDITOR.dialog.add("bulletedListStyle",this.path+"dialogs/liststyle.js"),e.addMenuGroup("list",108),e.addMenuItems({numberedlist:{label:e.lang.liststyle.numberedTitle,group:"list",command:"numberedListStyle"},bulletedlist:{label:e.lang.liststyle.bulletedTitle,group:"list",command:"bulletedListStyle"}}),e.contextMenu.addListener(function(e){if(!e||e.isReadOnly())return null;for(;e;){var t=e.getName();if("ol"==t)return{numberedlist:CKEDITOR.TRISTATE_OFF};if("ul"==t)return{bulletedlist:CKEDITOR.TRISTATE_OFF};e=e.getParent()}return null})}}},CKEDITOR.plugins.add("liststyle",CKEDITOR.plugins.liststyle)}(),function(){function e(e){if(!e||e.type!=CKEDITOR.NODE_ELEMENT||"form"!=e.getName())return[];for(var t=[],n=["style","className"],r=0;r<n.length;r++){var i=e.$.elements.namedItem(n[r]);i&&(i=new CKEDITOR.dom.element(i),t.push([i,i.nextSibling]),i.remove())}return t}function t(e,t){if(e&&e.type==CKEDITOR.NODE_ELEMENT&&"form"==e.getName()&&0<t.length)for(var n=t.length-1;0<=n;n--){var r=t[n][0],i=t[n][1];i?r.insertBefore(i):r.appendTo(e)}}function n(n,r){var i=e(n),s={},o=n.$;return r||(s["class"]=o.className||"",o.className=""),s.inline=o.style.cssText||"",r||(o.style.cssText="position: static; overflow: visible"),t(i),s}function r(n,r){var i=e(n),s=n.$;"class"in r&&(s.className=r["class"]),"inline"in r&&(s.style.cssText=r.inline),t(i)}function i(e){if(!e.editable().isInline()){var t=CKEDITOR.instances,n;for(n in t){var r=t[n];"wysiwyg"==r.mode&&!r.readOnly&&(r=r.document.getBody(),r.setAttribute("contentEditable",!1),r.setAttribute("contentEditable",!0))}e.editable().hasFocus&&(e.toolbox.focus(),e.focus())}}CKEDITOR.plugins.add("maximize",{init:function(e){function t(){var t=a.getViewPaneSize();e.resize(t.width,t.height,null,!0)}if(e.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var s=e.lang,u=CKEDITOR.document,a=u.getWindow(),f,l,c,h=CKEDITOR.TRISTATE_OFF;e.addCommand("maximize",{modes:{wysiwyg:!CKEDITOR.env.iOS,source:!CKEDITOR.env.iOS},readOnly:1,editorFocus:!1,exec:function(){var p=e.container.getFirst(function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasClass("cke_inner")}),d=e.ui.space("contents");if("wysiwyg"==e.mode){var v=e.getSelection();f=v&&v.getRanges(),l=a.getScrollPosition()}else{var g=e.editable().$;f=!CKEDITOR.env.ie&&[g.selectionStart,g.selectionEnd],l=[g.scrollLeft,g.scrollTop]}if(this.state==CKEDITOR.TRISTATE_OFF){a.on("resize",t),c=a.getScrollPosition();for(v=e.container;v=v.getParent();)v.setCustomData("maximize_saved_styles",n(v)),v.setStyle("z-index",e.config.baseFloatZIndex-5);d.setCustomData("maximize_saved_styles",n(d,!0)),p.setCustomData("maximize_saved_styles",n(p,!0)),d={overflow:CKEDITOR.env.webkit?"":"hidden",width:0,height:0},u.getDocumentElement().setStyles(d),!CKEDITOR.env.gecko&&u.getDocumentElement().setStyle("position","fixed"),(!CKEDITOR.env.gecko||!CKEDITOR.env.quirks)&&u.getBody().setStyles(d),CKEDITOR.env.ie?setTimeout(function(){a.$.scrollTo(0,0)},0):a.$.scrollTo(0,0),p.setStyle("position",CKEDITOR.env.gecko&&CKEDITOR.env.quirks?"fixed":"absolute"),p.$.offsetLeft,p.setStyles({"z-index":e.config.baseFloatZIndex-5,left:"0px",top:"0px"}),p.addClass("cke_maximized"),t(),d=p.getDocumentPosition(),p.setStyles({left:-1*d.x+"px",top:-1*d.y+"px"}),CKEDITOR.env.gecko&&i(e)}else if(this.state==CKEDITOR.TRISTATE_ON){a.removeListener("resize",t);for(var v=[d,p],y=0;y<v.length;y++)r(v[y],v[y].getCustomData("maximize_saved_styles")),v[y].removeCustomData("maximize_saved_styles");for(v=e.container;v=v.getParent();)r(v,v.getCustomData("maximize_saved_styles")),v.removeCustomData("maximize_saved_styles");CKEDITOR.env.ie?setTimeout(function(){a.$.scrollTo(c.x,c.y)},0):a.$.scrollTo(c.x,c.y),p.removeClass("cke_maximized"),CKEDITOR.env.webkit&&(p.setStyle("display","inline"),setTimeout(function(){p.setStyle("display","block")},0)),e.fire("resize",{outerHeight:e.container.$.offsetHeight,contentsHeight:d.$.offsetHeight,outerWidth:e.container.$.offsetWidth})}this.toggleState();if(v=this.uiItems[0])d=this.state==CKEDITOR.TRISTATE_OFF?s.maximize.maximize:s.maximize.minimize,v=CKEDITOR.document.getById(v._.id),v.getChild(1).setHtml(d),v.setAttribute("title",d),v.setAttribute("href",'javascript:void("'+d+'");');"wysiwyg"==e.mode?f?(CKEDITOR.env.gecko&&i(e),e.getSelection().selectRanges(f),(g=e.getSelection().getStartElement())&&g.scrollIntoView(!0)):a.$.scrollTo(l.x,l.y):(f&&(g.selectionStart=f[0],g.selectionEnd=f[1]),g.scrollLeft=l[0],g.scrollTop=l[1]),f=l=null,h=this.state,e.fire("maximize",this.state)},canUndo:!1}),e.ui.addButton&&e.ui.addButton("Maximize",{label:s.maximize.maximize,command:"maximize",toolbar:"tools,10"}),e.on("mode",function(){var t=e.getCommand("maximize");t.setState(t.state==CKEDITOR.TRISTATE_DISABLED?CKEDITOR.TRISTATE_DISABLED:h)},null,null,100)}}})}(),CKEDITOR.plugins.add("removeformat",{init:function(e){e.addCommand("removeFormat",CKEDITOR.plugins.removeformat.commands.removeformat),e.ui.addButton&&e.ui.addButton("RemoveFormat",{label:e.lang.removeformat.toolbar,command:"removeFormat",toolbar:"cleanup,10"})}}),CKEDITOR.plugins.removeformat={commands:{removeformat:{exec:function(e){for(var t=e._.removeFormatRegex||(e._.removeFormatRegex=RegExp("^(?:"+e.config.removeFormatTags.replace(/,/g,"|")+")$","i")),n=e._.removeAttributes||(e._.removeAttributes=e.config.removeFormatAttributes.split(",")),r=CKEDITOR.plugins.removeformat.filter,i=e.getSelection().getRanges(),s=i.createIterator(),o=function(e){return e.type==CKEDITOR.NODE_ELEMENT},u;u=s.getNextRange();){u.collapsed||u.enlarge(CKEDITOR.ENLARGE_ELEMENT);var a=u.createBookmark(),f=a.startNode,l=a.endNode,c=function(n){for(var i=e.elementPath(n),s=i.elements,o=1,u;(u=s[o])&&!u.equals(i.block)&&!u.equals(i.blockLimit);o++)t.test(u.getName())&&r(e,u)&&n.breakParent(u)};c(f);if(l){c(l);for(f=f.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT);f&&!f.equals(l);)if(f.isReadOnly()){if(f.getPosition(l)&CKEDITOR.POSITION_CONTAINS)break;f=f.getNext(o)}else c=f.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT),("img"!=f.getName()||!f.data("cke-realelement"))&&r(e,f)&&(t.test(f.getName())?f.remove(1):(f.removeAttributes(n),e.fire("removeFormatCleanup",f))),f=c}u.moveToBookmark(a)}e.forceNextSelectionCheck(),e.getSelection().selectRanges(i)}}},filter:function(e,t){for(var n=e._.removeFormatFilters||[],r=0;r<n.length;r++)if(!1===n[r](t))return!1;return!0}},CKEDITOR.editor.prototype.addRemoveFormatFilter=function(e){this._.removeFormatFilters||(this._.removeFormatFilters=[]),this._.removeFormatFilters.push(e)},CKEDITOR.config.removeFormatTags="b,big,cite,code,del,dfn,em,font,i,ins,kbd,q,s,samp,small,span,strike,strong,sub,sup,tt,u,var",CKEDITOR.config.removeFormatAttributes="class,style,lang,width,height,align,hspace,valign",CKEDITOR.plugins.add("resize",{init:function(e){function s(s){var o=t,a=n,l=o+(s.data.$.screenX-r)*("rtl"==f?-1:1),s=a+(s.data.$.screenY-i);c&&(o=Math.max(u.resize_minWidth,Math.min(l,u.resize_maxWidth))),h&&(a=Math.max(u.resize_minHeight,Math.min(s,u.resize_maxHeight))),e.resize(c?o:null,a)}function o(){CKEDITOR.document.removeListener("mousemove",s),CKEDITOR.document.removeListener("mouseup",o),e.document&&(e.document.removeListener("mousemove",s),e.document.removeListener("mouseup",o))}var t,n,r,i,u=e.config,a=e.ui.spaceId("resizer"),f=e.element?e.element.getDirection(1):"ltr";!u.resize_dir&&(u.resize_dir="vertical"),void 0===u.resize_maxWidth&&(u.resize_maxWidth=3e3),void 0===u.resize_maxHeight&&(u.resize_maxHeight=3e3),void 0===u.resize_minWidth&&(u.resize_minWidth=750),void 0===u.resize_minHeight&&(u.resize_minHeight=250);if(!1!==u.resize_enabled){var l=null,c=("both"==u.resize_dir||"horizontal"==u.resize_dir)&&u.resize_minWidth!=u.resize_maxWidth,h=("both"==u.resize_dir||"vertical"==u.resize_dir)&&u.resize_minHeight!=u.resize_maxHeight,p=CKEDITOR.tools.addFunction(function(a){l||(l=e.getResizable()),t=l.$.offsetWidth||0,n=l.$.offsetHeight||0,r=a.screenX,i=a.screenY,u.resize_minWidth>t&&(u.resize_minWidth=t),u.resize_minHeight>n&&(u.resize_minHeight=n),CKEDITOR.document.on("mousemove",s),CKEDITOR.document.on("mouseup",o),e.document&&(e.document.on("mousemove",s),e.document.on("mouseup",o)),a.preventDefault&&a.preventDefault()});e.on("destroy",function(){CKEDITOR.tools.removeFunction(p)}),e.on("uiSpace",function(t){if("bottom"==t.data.space){var n="";c&&!h&&(n=" cke_resizer_horizontal"),!c&&h&&(n=" cke_resizer_vertical");var r='<span id="'+a+'" class="cke_resizer'+n+" cke_resizer_"+f+'" title="'+CKEDITOR.tools.htmlEncode(e.lang.common.resize)+'" onmousedown="CKEDITOR.tools.callFunction('+p+', event)">'+("ltr"==f?"◢":"◣")+"</span>";"ltr"==f&&"ltr"==n?t.data.html+=r:t.data.html=r+t.data.html}},e,null,100),e.on("maximize",function(t){e.ui.space("resizer")[t.data==CKEDITOR.TRISTATE_ON?"hide":"show"]()})}}}),function(){var e={preserveState:!0,editorFocus:!1,readOnly:1,exec:function(e){this.toggleState(),this.refresh(e)},refresh:function(e){if(e.document){var t=this.state==CKEDITOR.TRISTATE_ON?"attachClass":"removeClass";e.editable()[t]("cke_show_borders")}}};CKEDITOR.plugins.add("showborders",{modes:{wysiwyg:1},onLoad:function(){var e;e=(CKEDITOR.env.ie6Compat?[".%1 table.%2,",".%1 table.%2 td, .%1 table.%2 th","{","border : #d3d3d3 1px dotted","}"]:".%1 table.%2,;.%1 table.%2 > tr > td, .%1 table.%2 > tr > th,;.%1 table.%2 > tbody > tr > td, .%1 table.%2 > tbody > tr > th,;.%1 table.%2 > thead > tr > td, .%1 table.%2 > thead > tr > th,;.%1 table.%2 > tfoot > tr > td, .%1 table.%2 > tfoot > tr > th;{;border : #d3d3d3 1px dotted;}".split(";")).join("").replace(/%2/g,"cke_show_border").replace(/%1/g,"cke_show_borders "),CKEDITOR.addCss(e)},init:function(t){var n=t.addCommand("showborders",e);n.canUndo=!1,!1!==t.config.startupShowBorders&&n.setState(CKEDITOR.TRISTATE_ON),t.on("mode",function(){n.state!=CKEDITOR.TRISTATE_DISABLED&&n.refresh(t)},null,null,100),t.on("contentDom",function(){n.state!=CKEDITOR.TRISTATE_DISABLED&&n.refresh(t)}),t.on("removeFormatCleanup",function(e){e=e.data,t.getCommand("showborders").state==CKEDITOR.TRISTATE_ON&&e.is("table")&&(!e.hasAttribute("border")||0>=parseInt(e.getAttribute("border"),10))&&e.addClass("cke_show_border")})},afterInit:function(e){var t=e.dataProcessor,e=t&&t.dataFilter,t=t&&t.htmlFilter;e&&e.addRules({elements:{table:function(e){var e=e.attributes,t=e["class"],n=parseInt(e.border,10);(!n||0>=n)&&(!t||-1==t.indexOf("cke_show_border"))&&(e["class"]=(t||"")+" cke_show_border")}}}),t&&t.addRules({elements:{table:function(e){var e=e.attributes,t=e["class"];t&&(e["class"]=t.replace("cke_show_border","").replace(/\s{2}/," ").replace(/^\s+|\s+$/,""))}}})}}),CKEDITOR.on("dialogDefinition",function(e){var t=e.data.name;if("table"==t||"tableProperties"==t)if(e=e.data.definition,t=e.getContents("info").get("txtBorder"),t.commit=CKEDITOR.tools.override(t.commit,function(e){return function(t,n){e.apply(this,arguments);var r=parseInt(this.getValue(),10);n[!r||0>=r?"addClass":"removeClass"]("cke_show_border")}}),e=(e=e.getContents("advanced"))&&e.get("advCSSClasses"))e.setup=CKEDITOR.tools.override(e.setup,function(e){return function(){e.apply(this,arguments),this.setValue(this.getValue().replace(/cke_show_border/,""))}}),e.commit=CKEDITOR.tools.override(e.commit,function(e){return function(t,n){e.apply(this,arguments),parseInt(n.getAttribute("border"),10)||n.addClass("cke_show_border")}})})}(),function(){CKEDITOR.plugins.add("sourcearea",{init:function(t){function n(){var e=i&&this.equals(CKEDITOR.document.getActive());this.hide(),this.setStyle("height",this.getParent().$.clientHeight+"px"),this.setStyle("width",this.getParent().$.clientWidth+"px"),this.show(),e&&this.focus()}if(t.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var r=CKEDITOR.plugins.sourcearea;t.addMode("source",function(r){var i=t.ui.space("contents").getDocument().createElement("textarea");i.setStyles(CKEDITOR.tools.extend({width:CKEDITOR.env.ie7Compat?"99%":"100%",height:"100%",resize:"none",outline:"none","text-align":"left"},CKEDITOR.tools.cssVendorPrefix("tab-size",t.config.sourceAreaTabSize||4))),i.setAttribute("dir","ltr"),i.addClass("cke_source").addClass("cke_reset").addClass("cke_enable_context_menu"),t.ui.space("contents").append(i),i=t.editable(new e(t,i)),i.setData(t.getData(1)),CKEDITOR.env.ie&&(i.attachListener(t,"resize",n,i),i.attachListener(CKEDITOR.document.getWindow(),"resize",n,i),CKEDITOR.tools.setTimeout(n,0,i)),t.fire("ariaWidget",this),r()}),t.addCommand("source",r.commands.source),t.ui.addButton&&t.ui.addButton("Source",{label:t.lang.sourcearea.toolbar,command:"source",toolbar:"mode,10"}),t.on("mode",function(){t.getCommand("source").setState("source"==t.mode?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)});var i=CKEDITOR.env.ie&&9==CKEDITOR.env.version}}});var e=CKEDITOR.tools.createClass({base:CKEDITOR.editable,proto:{setData:function(e){this.setValue(e),this.status="ready",this.editor.fire("dataReady")},getData:function(){return this.getValue()},insertHtml:function(){},insertElement:function(){},insertText:function(){},setReadOnly:function(e){this[(e?"set":"remove")+"Attribute"]("readOnly","readonly")},detach:function(){e.baseProto.detach.call(this),this.clearCustomData(),this.remove()}}})}(),CKEDITOR.plugins.sourcearea={commands:{source:{modes:{wysiwyg:1,source:1},editorFocus:!1,readOnly:1,exec:function(e){"wysiwyg"==e.mode&&e.fire("saveSnapshot"),e.getCommand("source").setState(CKEDITOR.TRISTATE_DISABLED),e.setMode("source"==e.mode?"wysiwyg":"source")},canUndo:!1}}},CKEDITOR.plugins.add("table",{requires:"dialog",init:function(e){function t(e){return CKEDITOR.tools.extend(e||{},{contextSensitive:1,refresh:function(e,t){this.setState(t.contains("table",1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}if(!e.blockless){var n=e.lang.table;e.addCommand("table",new CKEDITOR.dialogCommand("table",{context:"table",allowedContent:"table{width,height}[align,border,cellpadding,cellspacing,summary];caption tbody thead tfoot;th td tr[scope];"+(e.plugins.dialogadvtab?"table"+e.plugins.dialogadvtab.allowedContent():""),requiredContent:"table",contentTransformations:[["table{width}: sizeToStyle","table[width]: sizeToAttribute"]]})),e.addCommand("tableProperties",new CKEDITOR.dialogCommand("tableProperties",t())),e.addCommand("tableDelete",t({exec:function(e){var t=e.elementPath().contains("table",1);if(t){var n=t.getParent(),r=e.editable();1==n.getChildCount()&&!n.is("td","th")&&!n.equals(r)&&(t=n),e=e.createRange(),e.moveToPosition(t,CKEDITOR.POSITION_BEFORE_START),t.remove(),e.select()}}})),e.ui.addButton&&e.ui.addButton("Table",{label:n.toolbar,command:"table",toolbar:"insert,30"}),CKEDITOR.dialog.add("table",this.path+"dialogs/table.js"),CKEDITOR.dialog.add("tableProperties",this.path+"dialogs/table.js"),e.addMenuItems&&e.addMenuItems({table:{label:n.menu,command:"tableProperties",group:"table",order:5},tabledelete:{label:n.deleteTable,command:"tableDelete",group:"table",order:1}}),e.on("doubleclick",function(e){e.data.element.is("table")&&(e.data.dialog="tableProperties")}),e.contextMenu&&e.contextMenu.addListener(function(){return{tabledelete:CKEDITOR.TRISTATE_OFF,table:CKEDITOR.TRISTATE_OFF}})}}}),function(){function e(e){function t(e){!(0<n.length)&&e.type==CKEDITOR.NODE_ELEMENT&&h.test(e.getName())&&!e.getCustomData("selected_cell")&&(CKEDITOR.dom.element.setMarker(r,e,"selected_cell",!0),n.push(e))}for(var e=e.getRanges(),n=[],r={},i=0;i<e.length;i++){var s=e[i];if(s.collapsed)s=s.getCommonAncestor(),(s=s.getAscendant("td",!0)||s.getAscendant("th",!0))&&n.push(s);else{var s=new CKEDITOR.dom.walker(s),o;for(s.guard=t;o=s.next();)(o.type!=CKEDITOR.NODE_ELEMENT||!o.is(CKEDITOR.dtd.table))&&(o=o.getAscendant("td",!0)||o.getAscendant("th",!0))&&!o.getCustomData("selected_cell")&&(CKEDITOR.dom.element.setMarker(r,o,"selected_cell",!0),n.push(o))}}return CKEDITOR.dom.element.clearAllMarkers(r),n}function t(t,n){for(var r=e(t),i=r[0],s=i.getAscendant("table"),i=i.getDocument(),o=r[0].getParent(),u=o.$.rowIndex,r=r[r.length-1],a=r.getParent().$.rowIndex+r.$.rowSpan-1,r=new CKEDITOR.dom.element(s.$.rows[a]),u=n?u:a,o=n?o:r,r=CKEDITOR.tools.buildTableMap(s),s=r[u],u=n?r[u-1]:r[u+1],r=r[0].length,i=i.createElement("tr"),a=0;s[a]&&a<r;a++){var f;1<s[a].rowSpan&&u&&s[a]==u[a]?(f=s[a],f.rowSpan+=1):(f=(new CKEDITOR.dom.element(s[a])).clone(),f.removeAttribute("rowSpan"),f.appendBogus(),i.append(f),f=f.$),a+=f.colSpan-1}n?i.insertBefore(o):i.insertAfter(o)}function n(t){if(t instanceof CKEDITOR.dom.selection){for(var r=e(t),i=r[0].getAscendant("table"),s=CKEDITOR.tools.buildTableMap(i),t=r[0].getParent().$.rowIndex,r=r[r.length-1],o=r.getParent().$.rowIndex+r.$.rowSpan-1,r=[],u=t;u<=o;u++){for(var a=s[u],f=new CKEDITOR.dom.element(i.$.rows[u]),l=0;l<a.length;l++){var c=new CKEDITOR.dom.element(a[l]),h=c.getParent().$.rowIndex;1==c.$.rowSpan?c.remove():(c.$.rowSpan-=1,h==u&&(h=s[u+1],h[l-1]?c.insertAfter(new CKEDITOR.dom.element(h[l-1])):(new CKEDITOR.dom.element(i.$.rows[u+1])).append(c,1))),l+=c.$.colSpan-1}r.push(f)}s=i.$.rows,i=new CKEDITOR.dom.element(s[o+1]||(0<t?s[t-1]:null)||i.$.parentNode);for(u=r.length;0<=u;u--)n(r[u]);return i}return t instanceof CKEDITOR.dom.element&&(i=t.getAscendant("table"),1==i.$.rows.length?i.remove():t.remove()),null}function r(e,t){for(var n=t?Infinity:0,r=0;r<e.length;r++){var i;i=e[r];for(var s=t,o=i.getParent().$.cells,u=0,a=0;a<o.length;a++){var f=o[a],u=u+(s?1:f.colSpan);if(f==i.$)break}i=u-1;if(t?i<n:i>n)n=i}return n}function i(t,n){for(var i=e(t),s=i[0].getAscendant("table"),o=r(i,1),i=r(i),o=n?o:i,u=CKEDITOR.tools.buildTableMap(s),s=[],i=[],a=u.length,f=0;f<a;f++)s.push(u[f][o]),i.push(n?u[f][o-1]:u[f][o+1]);for(f=0;f<a;f++)s[f]&&(1<s[f].colSpan&&i[f]==s[f]?(o=s[f],o.colSpan+=1):(o=(new CKEDITOR.dom.element(s[f])).clone(),o.removeAttribute("colSpan"),o.appendBogus(),o[n?"insertBefore":"insertAfter"].call(o,new CKEDITOR.dom.element(s[f])),o=o.$),f+=o.rowSpan-1)}function s(e,t){var n=e.getStartElement();if(n=n.getAscendant("td",1)||n.getAscendant("th",1)){var r=n.clone();r.appendBogus(),t?r.insertBefore(n):r.insertAfter(n)}}function o(t){if(t instanceof CKEDITOR.dom.selection){var t=e(t),n=t[0]&&t[0].getAscendant("table"),r;e:{var i=0;r=t.length-1;for(var s={},a,f;a=t[i++];)CKEDITOR.dom.element.setMarker(s,a,"delete_cell",!0);for(i=0;a=t[i++];)if((f=a.getPrevious())&&!f.getCustomData("delete_cell")||(f=a.getNext())&&!f.getCustomData("delete_cell")){CKEDITOR.dom.element.clearAllMarkers(s),r=f;break e}CKEDITOR.dom.element.clearAllMarkers(s),f=t[0].getParent(),(f=f.getPrevious())?r=f.getLast():(f=t[r].getParent(),r=(f=f.getNext())?f.getChild(0):null)}for(f=t.length-1;0<=f;f--)o(t[f]);r?u(r,!0):n&&n.remove()}else t instanceof CKEDITOR.dom.element&&(n=t.getParent(),1==n.getChildCount()?n.remove():t.remove())}function u(e,t){var n=e.getDocument(),r=CKEDITOR.document;CKEDITOR.env.ie&&10==CKEDITOR.env.version&&(r.focus(),n.focus()),n=new CKEDITOR.dom.range(n),n["moveToElementEdit"+(t?"End":"Start")](e)||(n.selectNodeContents(e),n.collapse(t?!1:!0)),n.select(!0)}function a(e,t,n){e=e[t];if("undefined"==typeof n)return e;for(t=0;e&&t<e.length;t++){if(n.is&&e[t]==n.$)return t;if(t==n)return new CKEDITOR.dom.element(e[t])}return n.is?-1:null}function f(t,n,r){var i=e(t),s;if((n?1!=i.length:2>i.length)||(s=t.getCommonAncestor())&&s.type==CKEDITOR.NODE_ELEMENT&&s.is("table"))return!1;var o,t=i[0];s=t.getAscendant("table");var u=CKEDITOR.tools.buildTableMap(s),f=u.length,l=u[0].length,c=t.getParent().$.rowIndex,h=a(u,c,t);if(n){var d;try{var m=parseInt(t.getAttribute("rowspan"),10)||1;o=parseInt(t.getAttribute("colspan"),10)||1,d=u["up"==n?c-m:"down"==n?c+m:c]["left"==n?h-o:"right"==n?h+o:h]}catch(g){return!1}if(!d||t.$==d)return!1;i["up"==n||"left"==n?"unshift":"push"](new CKEDITOR.dom.element(d))}for(var n=t.getDocument(),y=c,m=d=0,b=!r&&new CKEDITOR.dom.documentFragment(n),w=0,n=0;n<i.length;n++){o=i[n];var E=o.getParent(),S=o.getFirst(),x=o.$.colSpan,T=o.$.rowSpan,E=E.$.rowIndex,N=a(u,E,o),w=w+x*T,m=Math.max(m,N-h+x);d=Math.max(d,E-c+T),r||(x=o,(T=x.getBogus())&&T.remove(),x.trim(),o.getChildren().count()&&(E!=y&&S&&(!S.isBlockBoundary||!S.isBlockBoundary({br:1}))&&(y=b.getLast(CKEDITOR.dom.walker.whitespaces(!0)))&&(!y.is||!y.is("br"))&&b.append("br"),o.moveChildren(b)),n?o.remove():o.setHtml("")),y=E}if(r)return d*m==w;b.moveChildren(t),t.appendBogus(),m>=l?t.removeAttribute("rowSpan"):t.$.rowSpan=d,d>=f?t.removeAttribute("colSpan"):t.$.colSpan=m,r=new CKEDITOR.dom.nodeList(s.$.rows),i=r.count();for(n=i-1;0<=n;n--)s=r.getItem(n),s.$.cells.length||(s.remove(),i++);return t}function l(t,n){var r=e(t);if(1<r.length)return!1;if(n)return!0;var r=r[0],i=r.getParent(),s=i.getAscendant("table"),o=CKEDITOR.tools.buildTableMap(s),u=i.$.rowIndex,f=a(o,u,r),l=r.$.rowSpan,c;if(1<l){c=Math.ceil(l/2);for(var l=Math.floor(l/2),i=u+c,s=new CKEDITOR.dom.element(s.$.rows[i]),o=a(o,i),h,i=r.clone(),u=0;u<o.length;u++){if(h=o[u],h.parentNode==s.$&&u>f){i.insertBefore(new CKEDITOR.dom.element(h));break}h=null}h||s.append(i)}else{l=c=1,s=i.clone(),s.insertAfter(i),s.append(i=r.clone()),h=a(o,u);for(f=0;f<h.length;f++)h[f].rowSpan++}return i.appendBogus(),r.$.rowSpan=c,i.$.rowSpan=l,1==c&&r.removeAttribute("rowSpan"),1==l&&i.removeAttribute("rowSpan"),i}function c(t,n){var r=e(t);if(1<r.length)return!1;if(n)return!0;var r=r[0],i=r.getParent(),s=i.getAscendant("table"),s=CKEDITOR.tools.buildTableMap(s),o=a(s,i.$.rowIndex,r),u=r.$.colSpan;if(1<u)i=Math.ceil(u/2),u=Math.floor(u/2);else{for(var u=i=1,f=[],l=0;l<s.length;l++){var c=s[l];f.push(c[o]),1<c[o].rowSpan&&(l+=c[o].rowSpan-1)}for(s=0;s<f.length;s++)f[s].colSpan++}return s=r.clone(),s.insertAfter(r),s.appendBogus(),r.$.colSpan=i,s.$.colSpan=u,1==i&&r.removeAttribute("colSpan"),1==u&&s.removeAttribute("colSpan"),s}var h=/^(?:td|th)$/;CKEDITOR.plugins.tabletools={requires:"table,dialog,contextmenu",init:function(r){function a(e){return CKEDITOR.tools.extend(e||{},{contextSensitive:1,refresh:function(e,t){this.setState(t.contains({td:1,th:1},1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}function h(e,t){var n=r.addCommand(e,t);r.addFeature(n)}var d=r.lang.table;h("cellProperties",new CKEDITOR.dialogCommand("cellProperties",a({allowedContent:"td th{width,height,border-color,background-color,white-space,vertical-align,text-align}[colspan,rowspan]",requiredContent:"table"}))),CKEDITOR.dialog.add("cellProperties",this.path+"dialogs/tableCell.js"),h("rowDelete",a({requiredContent:"table",exec:function(e){e=e.getSelection(),u(n(e))}})),h("rowInsertBefore",a({requiredContent:"table",exec:function(e){e=e.getSelection(),t(e,!0)}})),h("rowInsertAfter",a({requiredContent:"table",exec:function(e){e=e.getSelection(),t(e)}})),h("columnDelete",a({requiredContent:"table",exec:function(t){for(var t=t.getSelection(),t=e(t),n=t[0],r=t[t.length-1],t=n.getAscendant("table"),i=CKEDITOR.tools.buildTableMap(t),s,o,a=[],f=0,l=i.length;f<l;f++)for(var c=0,h=i[f].length;c<h;c++)i[f][c]==n.$&&(s=c),i[f][c]==r.$&&(o=c);for(f=s;f<=o;f++)for(c=0;c<i.length;c++)r=i[c],n=new CKEDITOR.dom.element(t.$.rows[c]),r=new CKEDITOR.dom.element(r[f]),r.$&&(1==r.$.colSpan?r.remove():r.$.colSpan-=1,c+=r.$.rowSpan-1,n.$.cells.length||a.push(n));o=t.$.rows[0]&&t.$.rows[0].cells,s=new CKEDITOR.dom.element(o[s]||(s?o[s-1]:t.$.parentNode)),a.length==l&&t.remove(),s&&u(s,!0)}})),h("columnInsertBefore",a({requiredContent:"table",exec:function(e){e=e.getSelection(),i(e,!0)}})),h("columnInsertAfter",a({requiredContent:"table",exec:function(e){e=e.getSelection(),i(e)}})),h("cellDelete",a({requiredContent:"table",exec:function(e){e=e.getSelection(),o(e)}})),h("cellMerge",a({allowedContent:"td[colspan,rowspan]",requiredContent:"td[colspan,rowspan]",exec:function(e){u(f(e.getSelection()),!0)}})),h("cellMergeRight",a({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(e){u(f(e.getSelection(),"right"),!0)}})),h("cellMergeDown",a({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(e){u(f(e.getSelection(),"down"),!0)}})),h("cellVerticalSplit",a({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(e){u(c(e.getSelection()))}})),h("cellHorizontalSplit",a({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(e){u(l(e.getSelection()))}})),h("cellInsertBefore",a({requiredContent:"table",exec:function(e){e=e.getSelection(),s(e,!0)}})),h("cellInsertAfter",a({requiredContent:"table",exec:function(e){e=e.getSelection(),s(e)}})),r.addMenuItems&&r.addMenuItems({tablecell:{label:d.cell.menu,group:"tablecell",order:1,getItems:function(){var t=r.getSelection(),n=e(t);return{tablecell_insertBefore:CKEDITOR.TRISTATE_OFF,tablecell_insertAfter:CKEDITOR.TRISTATE_OFF,tablecell_delete:CKEDITOR.TRISTATE_OFF,tablecell_merge:f(t,null,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_right:f(t,"right",!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_down:f(t,"down",!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_vertical:c(t,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_horizontal:l(t,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_properties:0<n.length?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED}}},tablecell_insertBefore:{label:d.cell.insertBefore,group:"tablecell",command:"cellInsertBefore",order:5},tablecell_insertAfter:{label:d.cell.insertAfter,group:"tablecell",command:"cellInsertAfter",order:10},tablecell_delete:{label:d.cell.deleteCell,group:"tablecell",command:"cellDelete",order:15},tablecell_merge:{label:d.cell.merge,group:"tablecell",command:"cellMerge",order:16},tablecell_merge_right:{label:d.cell.mergeRight,group:"tablecell",command:"cellMergeRight",order:17},tablecell_merge_down:{label:d.cell.mergeDown,group:"tablecell",command:"cellMergeDown",order:18},tablecell_split_horizontal:{label:d.cell.splitHorizontal,group:"tablecell",command:"cellHorizontalSplit",order:19},tablecell_split_vertical:{label:d.cell.splitVertical,group:"tablecell",command:"cellVerticalSplit",order:20},tablecell_properties:{label:d.cell.title,group:"tablecellproperties",command:"cellProperties",order:21},tablerow:{label:d.row.menu,group:"tablerow",order:1,getItems:function(){return{tablerow_insertBefore:CKEDITOR.TRISTATE_OFF,tablerow_insertAfter:CKEDITOR.TRISTATE_OFF,tablerow_delete:CKEDITOR.TRISTATE_OFF}}},tablerow_insertBefore:{label:d.row.insertBefore,group:"tablerow",command:"rowInsertBefore",order:5},tablerow_insertAfter:{label:d.row.insertAfter,group:"tablerow",command:"rowInsertAfter",order:10},tablerow_delete:{label:d.row.deleteRow,group:"tablerow",command:"rowDelete",order:15},tablecolumn:{label:d.column.menu,group:"tablecolumn",order:1,getItems:function(){return{tablecolumn_insertBefore:CKEDITOR.TRISTATE_OFF,tablecolumn_insertAfter:CKEDITOR.TRISTATE_OFF,tablecolumn_delete:CKEDITOR.TRISTATE_OFF}}},tablecolumn_insertBefore:{label:d.column.insertBefore,group:"tablecolumn",command:"columnInsertBefore",order:5},tablecolumn_insertAfter:{label:d.column.insertAfter,group:"tablecolumn",command:"columnInsertAfter",order:10},tablecolumn_delete:{label:d.column.deleteColumn,group:"tablecolumn",command:"columnDelete",order:15}}),r.contextMenu&&r.contextMenu.addListener(function(e,t,n){return(e=n.contains({td:1,th:1},1))&&!e.isReadOnly()?{tablecell:CKEDITOR.TRISTATE_OFF,tablerow:CKEDITOR.TRISTATE_OFF,tablecolumn:CKEDITOR.TRISTATE_OFF}:null})},getSelectedCells:e},CKEDITOR.plugins.add("tabletools",CKEDITOR.plugins.tabletools)}(),CKEDITOR.tools.buildTableMap=function(e){for(var e=e.$.rows,t=-1,n=[],r=0;r<e.length;r++){t++,!n[t]&&(n[t]=[]);for(var i=-1,s=0;s<e[r].cells.length;s++){var o=e[r].cells[s];for(i++;n[t][i];)i++;for(var u=isNaN(o.colSpan)?1:o.colSpan,o=isNaN(o.rowSpan)?1:o.rowSpan,a=0;a<o;a++){n[t+a]||(n[t+a]=[]);for(var f=0;f<u;f++)n[t+a][i+f]=e[r].cells[s]}i+=u-1}}return n},function(){function e(e){return CKEDITOR.env.ie?e.$.clientWidth:parseInt(e.getComputedStyle("width"),10)}function t(e,t){var n=e.getComputedStyle("border-"+t+"-width"),r={thin:"0px",medium:"1px",thick:"2px"};return 0>n.indexOf("px")&&(n=n in r&&"none"!=e.getComputedStyle("border-style")?r[n]:0),parseInt(n,10)}function n(e){var n=[],r=-1,i="rtl"==e.getComputedStyle("direction"),s;s=e.$.rows;for(var o=0,u,a,f,l=0,c=s.length;l<c;l++)f=s[l],u=f.cells.length,u>o&&(o=u,a=f);s=a,o=new CKEDITOR.dom.element(e.$.tBodies[0]),u=o.getDocumentPosition(),a=0;for(f=s.cells.length;a<f;a++){var l=new CKEDITOR.dom.element(s.cells[a]),c=s.cells[a+1]&&new CKEDITOR.dom.element(s.cells[a+1]),r=r+(l.$.colSpan||1),h,p,d=l.getDocumentPosition().x;i?p=d+t(l,"left"):h=d+l.$.offsetWidth-t(l,"right"),c?(d=c.getDocumentPosition().x,i?h=d+c.$.offsetWidth-t(c,"right"):p=d+t(c,"left")):(d=e.getDocumentPosition().x,i?h=d:p=d+e.$.offsetWidth),l=Math.max(p-h,3),n.push({table:e,index:r,x:h,y:u.y,width:l,height:o.$.offsetHeight,rtl:i})}return n}function r(e){(e.data||e).preventDefault()}function i(n){function i(){d=0,p.setOpacity(0),g&&s();var e=c.table;setTimeout(function(){e.removeCustomData("_cke_table_pillars")},0),h.removeListener("dragstart",r)}function s(){for(var r=c.rtl,i=r?b.length:y.length,s=0,u=0;u<i;u++){var a=y[u],f=b[u],l=c.table;CKEDITOR.tools.setTimeout(function(e,t,u,a,f,c){e&&e.setStyle("width",o(Math.max(t+c,1))),u&&u.setStyle("width",o(Math.max(a-c,1))),f&&l.setStyle("width",o(f+c*(r?-1:1))),++s==i&&n.fire("saveSnapshot")},0,this,[a,a&&e(a),f,f&&e(f),(!a||!f)&&e(l)+t(l,"left")+t(l,"right"),g])}}function a(t){r(t),n.fire("saveSnapshot");for(var t=c.index,i=CKEDITOR.tools.buildTableMap(c.table),s=[],o=[],u=Number.MAX_VALUE,a=u,S=c.rtl,T=0,N=i.length;T<N;T++){var C=i[T],L=C[t+(S?1:0)],C=C[t+(S?0:1)],L=L&&new CKEDITOR.dom.element(L),C=C&&new CKEDITOR.dom.element(C);if(!L||!C||!L.equals(C))L&&(u=Math.min(u,e(L))),C&&(a=Math.min(a,e(C))),s.push(L),o.push(C)}y=s,b=o,w=c.x-u,E=c.x+a,p.setOpacity(.5),m=parseInt(p.getStyle("left"),10),g=0,d=1,p.on("mousemove",l),h.on("dragstart",r),h.on("mouseup",f,this)}function f(e){e.removeListener(),i()}function l(e){S(e.data.getPageOffset().x)}var c,h,p,d,m,g,y,b,w,E;h=n.document,p=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',h),n.on("destroy",function(){p.remove()}),u||h.getDocumentElement().append(p),this.attachTo=function(e){d||(u&&(h.getBody().append(p),g=0),c=e,p.setStyles({width:o(e.width),height:o(e.height),left:o(e.x),top:o(e.y)}),u&&p.setOpacity(.25),p.on("mousedown",a,this),h.getBody().setStyle("cursor","col-resize"),p.show())};var S=this.move=function(e){if(!c)return 0;if(!d&&(e<c.x||e>c.x+c.width))return c=null,d=g=0,h.removeListener("mouseup",f),p.removeListener("mousedown",a),p.removeListener("mousemove",l),h.getBody().setStyle("cursor","auto"),u?p.remove():p.hide(),0;e-=Math.round(p.$.offsetWidth/2);if(d){if(e==w||e==E)return 1;e=Math.max(e,w),e=Math.min(e,E),g=e-m}return p.setStyle("left",o(e)),1}}function s(e){var t=e.data.getTarget();if("mouseout"==e.name){if(!t.is("table"))return;for(var n=new CKEDITOR.dom.element(e.data.$.relatedTarget||e.data.$.toElement);n&&n.$&&!n.equals(t)&&!n.is("body");)n=n.getParent();if(!n||n.equals(t))return}t.getAscendant("table",1).removeCustomData("_cke_table_pillars"),e.removeListener()}var o=CKEDITOR.tools.cssLength,u=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks);CKEDITOR.plugins.add("tableresize",{requires:"tabletools",init:function(e){e.on("contentDom",function(){var t,o=e.editable();o.attachListener(o.isInline()?o:e.document,"mousemove",function(o){var o=o.data,u=o.getTarget();if(u.type==CKEDITOR.NODE_ELEMENT){var f=o.getPageOffset().x;if(t&&t.move(f))r(o);else if(u.is("table")||u.getAscendant("tbody",1))if(u=u.getAscendant("table",1),e.editable().contains(u)){(o=u.getCustomData("_cke_table_pillars"))||(u.setCustomData("_cke_table_pillars",o=n(u)),u.on("mouseout",s),u.on("mousedown",s));e:{for(var u=0,l=o.length;u<l;u++){var c=o[u];if(f>=c.x&&f<=c.x+c.width){f=c;break e}}f=null}f&&(!t&&(t=new i(e)),t.attachTo(f))}}})})}})}(),function(){function e(e){function n(){for(var n=r(),s=CKEDITOR.tools.clone(e.config.toolbarGroups)||t(e),o=0;o<s.length;o++){var u=s[o];if("/"!=u){"string"==typeof u&&(u=s[o]={name:u});var f,l=u.groups;if(l)for(var h=0;h<l.length;h++)f=l[h],(f=n[f])&&i(u,f);(f=n[u.name])&&i(u,f)}}return s}function r(){var t={},n,r,i;for(n in e.ui.items)r=e.ui.items[n],i=r.toolbar||"others",i=i.split(","),r=i[0],i=parseInt(i[1]||-1,10),t[r]||(t[r]=[]),t[r].push({name:n,order:i});for(r in t)t[r]=t[r].sort(function(e,t){return e.order==t.order?0:0>t.order?-1:0>e.order?1:e.order<t.order?-1:1});return t}function i(t,n){if(n.length){t.items?t.items.push(e.ui.create("-")):t.items=[];for(var r;r=n.shift();)(r="string"==typeof r?r:r.name,!o||-1==CKEDITOR.tools.indexOf(o,r))&&(r=e.ui.create(r))&&e.addFeature(r)&&t.items.push(r)}}function s(e){var t=[],n,r,s;for(n=0;n<e.length;++n)r=e[n],s={},"/"==r?t.push(r):CKEDITOR.tools.isArray(r)?(i(s,CKEDITOR.tools.clone(r)),t.push(s)):r.items&&(i(s,CKEDITOR.tools.clone(r.items)),s.name=r.name,t.push(s));return t}var o=e.config.removeButtons,o=o&&o.split(","),u=e.config.toolbar;return"string"==typeof u&&(u=e.config["toolbar_"+u]),e.toolbar=u?s(u):n()}function t(e){return e._.toolbarGroups||(e._.toolbarGroups=[{name:"document",groups:["mode","document","doctools"]},{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"forms"},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"links"},{name:"insert"},"/",{name:"styles"},{name:"colors"},{name:"tools"},{name:"others"},{name:"about"}])}var n=function(){this.toolbars=[],this.focusCommandExecuted=!1};n.prototype.focus=function(){for(var e=0,t;t=this.toolbars[e++];)for(var n=0,r;r=t.items[n++];)if(r.focus){r.focus();return}};var r={modes:{wysiwyg:1,source:1},readOnly:1,exec:function(e){e.toolbox&&(e.toolbox.focusCommandExecuted=!0,CKEDITOR.env.ie||CKEDITOR.env.air?setTimeout(function(){e.toolbox.focus()},100):e.toolbox.focus())}};CKEDITOR.plugins.add("toolbar",{requires:"button",init:function(t){var i,s=function(e,n){var r,o="rtl"==t.lang.dir,u=t.config.toolbarGroupCycling,f=o?37:39,o=o?39:37,u=void 0===u||u;switch(n){case 9:case CKEDITOR.SHIFT+9:for(;!r||!r.items.length;)if(r=9==n?(r?r.next:e.toolbar.next)||t.toolbox.toolbars[0]:(r?r.previous:e.toolbar.previous)||t.toolbox.toolbars[t.toolbox.toolbars.length-1],r.items.length)for(e=r.items[i?r.items.length-1:0];e&&!e.focus;)(e=i?e.previous:e.next)||(r=0);return e&&e.focus(),!1;case f:r=e;do r=r.next,!r&&u&&(r=e.toolbar.items[0]);while(r&&!r.focus);return r?r.focus():s(e,9),!1;case 40:return e.button&&e.button.hasArrow?(t.once("panelShow",function(e){e.data._.panel._.currentBlock.onKeyDown(40)}),e.execute()):s(e,40==n?f:o),!1;case o:case 38:r=e;do r=r.previous,!r&&u&&(r=e.toolbar.items[e.toolbar.items.length-1]);while(r&&!r.focus);return r?r.focus():(i=1,s(e,CKEDITOR.SHIFT+9),i=0),!1;case 27:return t.focus(),!1;case 13:case 32:return e.execute(),!1}return!0};t.on("uiSpace",function(r){if(r.data.space==t.config.toolbarLocation){r.removeListener(),t.toolbox=new n;var i=CKEDITOR.tools.getNextId(),o=['<span id="',i,'" class="cke_voice_label">',t.lang.toolbar.toolbars,"</span>",'<span id="'+t.ui.spaceId("toolbox")+'" class="cke_toolbox" role="group" aria-labelledby="',i,'" onmousedown="return false;">'],i=!1!==t.config.toolbarStartupExpanded,f,l;t.config.toolbarCanCollapse&&t.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE&&o.push('<span class="cke_toolbox_main"'+(i?">":' style="display:none">'));for(var c=t.toolbox.toolbars,h=e(t),p=0;p<h.length;p++){var d,v=0,m,y=h[p],b;if(y)if(f&&(o.push("</span>"),l=f=0),"/"===y)o.push('<span class="cke_toolbar_break"></span>');else{b=y.items||y;for(var E=0;E<b.length;E++){var S=b[E],x;if(S)if(S.type==CKEDITOR.UI_SEPARATOR)l=f&&S;else{x=!1!==S.canGroup;if(!v){d=CKEDITOR.tools.getNextId(),v={id:d,items:[]},m=y.name&&(t.lang.toolbar.toolbarGroups[y.name]||y.name),o.push('<span id="',d,'" class="cke_toolbar"',m?' aria-labelledby="'+d+'_label"':"",' role="toolbar">'),m&&o.push('<span id="',d,'_label" class="cke_voice_label">',m,"</span>"),o.push('<span class="cke_toolbar_start"></span>');var T=c.push(v)-1;0<T&&(v.previous=c[T-1],v.previous.next=v)}x?f||(o.push('<span class="cke_toolgroup" role="presentation">'),f=1):f&&(o.push("</span>"),f=0),d=function(e){e=e.render(t,o),T=v.items.push(e)-1,T>0&&(e.previous=v.items[T-1],e.previous.next=e),e.toolbar=v,e.onkey=s,e.onfocus=function(){t.toolbox.focusCommandExecuted||t.focus()}},l&&(d(l),l=0),d(S)}}f&&(o.push("</span>"),l=f=0),v&&o.push('<span class="cke_toolbar_end"></span></span>')}}t.config.toolbarCanCollapse&&o.push("</span>");if(t.config.toolbarCanCollapse&&t.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var N=CKEDITOR.tools.addFunction(function(){t.execCommand("toolbarCollapse")});t.on("destroy",function(){CKEDITOR.tools.removeFunction(N)}),t.addCommand("toolbarCollapse",{readOnly:1,exec:function(e){var t=e.ui.space("toolbar_collapser"),n=t.getPrevious(),r=e.ui.space("contents"),i=n.getParent(),s=parseInt(r.$.style.height,10),o=i.$.offsetHeight,u=t.hasClass("cke_toolbox_collapser_min");u?(n.show(),t.removeClass("cke_toolbox_collapser_min"),t.setAttribute("title",e.lang.toolbar.toolbarCollapse)):(n.hide(),t.addClass("cke_toolbox_collapser_min"),t.setAttribute("title",e.lang.toolbar.toolbarExpand)),t.getFirst().setText(u?"▲":"◀"),r.setStyle("height",s-(i.$.offsetHeight-o)+"px"),e.fire("resize",{outerHeight:e.container.$.offsetHeight,contentsHeight:r.$.offsetHeight,outerWidth:e.container.$.offsetWidth})},modes:{wysiwyg:1,source:1}}),t.setKeystroke(CKEDITOR.ALT+(CKEDITOR.env.ie||CKEDITOR.env.webkit?189:109),"toolbarCollapse"),o.push('<a title="'+(i?t.lang.toolbar.toolbarCollapse:t.lang.toolbar.toolbarExpand)+'" id="'+t.ui.spaceId("toolbar_collapser")+'" tabIndex="-1" class="cke_toolbox_collapser'),i||o.push(" cke_toolbox_collapser_min"),o.push('" onclick="CKEDITOR.tools.callFunction('+N+')">','<span class="cke_arrow">&#9650;</span>',"</a>")}o.push("</span>"),r.data.html+=o.join("")}}),t.on("destroy",function(){if(this.toolbox){var e,t=0,n,r,i;for(e=this.toolbox.toolbars;t<e.length;t++){r=e[t].items;for(n=0;n<r.length;n++)i=r[n],i.clickFn&&CKEDITOR.tools.removeFunction(i.clickFn),i.keyDownFn&&CKEDITOR.tools.removeFunction(i.keyDownFn)}}}),t.on("uiReady",function(){var e=t.ui.space("toolbox");e&&t.focusManager.add(e,1)}),t.addCommand("toolbarFocus",r),t.setKeystroke(CKEDITOR.ALT+121,"toolbarFocus"),t.ui.add("-",CKEDITOR.UI_SEPARATOR,{}),t.ui.addHandler(CKEDITOR.UI_SEPARATOR,{create:function(){return{render:function(e,t){return t.push('<span class="cke_toolbar_separator" role="separator"></span>'),{}}}}})}}),CKEDITOR.ui.prototype.addToolbarGroup=function(e,n,r){var i=t(this.editor),s=0===n,o={name:e};if(r){if(r=CKEDITOR.tools.search(i,function(e){return e.name==r})){!r.groups&&(r.groups=[]);if(n&&(n=CKEDITOR.tools.indexOf(r.groups,n),0<=n)){r.groups.splice(n+1,0,e);return}s?r.groups.splice(0,0,e):r.groups.push(e);return}n=null}n&&(n=CKEDITOR.tools.indexOf(i,function(e){return e.name==n})),s?i.splice(0,0,e):"number"==typeof n?i.splice(n+1,0,o):i.push(e)}}(),CKEDITOR.UI_SEPARATOR="separator",CKEDITOR.config.toolbarLocation="top",function(){var e=[CKEDITOR.CTRL+90,CKEDITOR.CTRL+89,CKEDITOR.CTRL+CKEDITOR.SHIFT+90],t={8:1,46:1};CKEDITOR.plugins.add("undo",{init:function(t){function r(e){o.enabled&&!1!==e.data.command.canUndo&&o.save()}function i(){o.enabled=t.readOnly?!1:"wysiwyg"==t.mode,o.onChange()}var o=t.undoManager=new n(t),u=o.editingHandler=new s(o),a=t.addCommand("undo",{exec:function(){o.undo()&&(t.selectionChange(),this.fire("afterUndo"))},startDisabled:!0,canUndo:!1}),f=t.addCommand("redo",{exec:function(){o.redo()&&(t.selectionChange(),this.fire("afterRedo"))},startDisabled:!0,canUndo:!1});t.setKeystroke([[e[0],"undo"],[e[1],"redo"],[e[2],"redo"]]),o.onChange=function(){a.setState(o.undoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),f.setState(o.redoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)},t.on("beforeCommandExec",r),t.on("afterCommandExec",r),t.on("saveSnapshot",function(e){o.save(e.data&&e.data.contentOnly)}),t.on("contentDom",u.attachListeners,u),t.on("instanceReady",function(){t.fire("saveSnapshot")}),t.on("beforeModeUnload",function(){"wysiwyg"==t.mode&&o.save(!0)}),t.on("mode",i),t.on("readOnly",i),t.ui.addButton&&(t.ui.addButton("Undo",{label:t.lang.undo.undo,command:"undo",toolbar:"undo,10"}),t.ui.addButton("Redo",{label:t.lang.undo.redo,command:"redo",toolbar:"undo,20"})),t.resetUndo=function(){o.reset(),t.fire("saveSnapshot")},t.on("updateSnapshot",function(){o.currentImage&&o.update()}),t.on("lockSnapshot",function(e){e=e.data,o.lock(e&&e.dontUpdate,e&&e.forceUpdate)}),t.on("unlockSnapshot",o.unlock,o)}}),CKEDITOR.plugins.undo={};var n=CKEDITOR.plugins.undo.UndoManager=function(e){this.strokesRecorded=[0,0],this.locked=null,this.previousKeyGroup=-1,this.limit=e.config.undoStackSize||20,this.strokesLimit=25,this.editor=e,this.reset()};n.prototype={type:function(e,t){var r=n.getKeyGroup(e),i=this.strokesRecorded[r]+1,t=t||i>=this.strokesLimit;this.typing||(this.hasUndo=this.typing=!0,this.hasRedo=!1,this.onChange()),t?(i=0,this.editor.fire("saveSnapshot")):this.editor.fire("change"),this.strokesRecorded[r]=i,this.previousKeyGroup=r},keyGroupChanged:function(e){return n.getKeyGroup(e)!=this.previousKeyGroup},reset:function(){this.snapshots=[],this.index=-1,this.currentImage=null,this.hasRedo=this.hasUndo=!1,this.locked=null,this.resetType()},resetType:function(){this.strokesRecorded=[0,0],this.typing=!1,this.previousKeyGroup=-1},refreshState:function(){this.hasUndo=!!this.getNextImage(!0),this.hasRedo=!!this.getNextImage(!1),this.resetType(),this.onChange()},save:function(e,t,n){var i=this.editor;if(this.locked||"ready"!=i.status||"wysiwyg"!=i.mode)return!1;var s=i.editable();if(!s||"ready"!=s.status)return!1;s=this.snapshots,t||(t=new r(i));if(!1===t.contents)return!1;if(this.currentImage)if(t.equalsContent(this.currentImage)){if(e||t.equalsSelection(this.currentImage))return!1}else!1!==n&&i.fire("change");return s.splice(this.index+1,s.length-this.index-1),s.length==this.limit&&s.shift(),this.index=s.push(t)-1,this.currentImage=t,!1!==n&&this.refreshState(),!0},restoreImage:function(e){var t=this.editor,n;e.bookmarks&&(t.focus(),n=t.getSelection()),this.locked={level:999},this.editor.loadSnapshot(e.contents),e.bookmarks?n.selectBookmarks(e.bookmarks):CKEDITOR.env.ie&&(n=this.editor.document.getBody().$.createTextRange(),n.collapse(!0),n.select()),this.locked=null,this.index=e.index,this.currentImage=this.snapshots[this.index],this.update(),this.refreshState(),t.fire("change")},getNextImage:function(e){var t=this.snapshots,n=this.currentImage,r;if(n)if(e){for(r=this.index-1;0<=r;r--)if(e=t[r],!n.equalsContent(e))return e.index=r,e}else for(r=this.index+1;r<t.length;r++)if(e=t[r],!n.equalsContent(e))return e.index=r,e;return null},redoable:function(){return this.enabled&&this.hasRedo},undoable:function(){return this.enabled&&this.hasUndo},undo:function(){if(this.undoable()){this.save(!0);var e=this.getNextImage(!0);if(e)return this.restoreImage(e),!0}return!1},redo:function(){if(this.redoable()&&(this.save(!0),this.redoable())){var e=this.getNextImage(!1);if(e)return this.restoreImage(e),!0}return!1},update:function(e){if(!this.locked){e||(e=new r(this.editor));for(var t=this.index,n=this.snapshots;0<t&&this.currentImage.equalsContent(n[t-1]);)t-=1;n.splice(t,this.index-t+1,e),this.index=t,this.currentImage=e}},updateSelection:function(e){if(!this.snapshots.length)return!1;var t=this.snapshots,n=t[t.length-1];return n.equalsContent(e)&&!n.equalsSelection(e)?(this.currentImage=t[t.length-1]=e,!0):!1},lock:function(e,t){if(this.locked)this.locked.level++;else if(e)this.locked={level:1};else{var n=null;if(t)n=!0;else{var i=new r(this.editor,!0);this.currentImage&&this.currentImage.equalsContent(i)&&(n=i)}this.locked={update:n,level:1}}},unlock:function(){if(this.locked&&!--this.locked.level){var e=this.locked.update;this.locked=null;if(!0===e)this.update();else if(e){var t=new r(this.editor,!0);e.equalsContent(t)||this.update()}}}},n.navigationKeyCodes={37:1,38:1,39:1,40:1,36:1,35:1,33:1,34:1},n.keyGroups={PRINTABLE:0,FUNCTIONAL:1},n.isNavigationKey=function(e){return!!n.navigationKeyCodes[e]},n.getKeyGroup=function(e){var r=n.keyGroups;return t[e]?r.FUNCTIONAL:r.PRINTABLE},n.getOppositeKeyGroup=function(e){var t=n.keyGroups;return e==t.FUNCTIONAL?t.PRINTABLE:t.FUNCTIONAL},n.ieFunctionalKeysBug=function(e){return CKEDITOR.env.ie&&n.getKeyGroup(e)==n.keyGroups.FUNCTIONAL};var r=CKEDITOR.plugins.undo.Image=function(e,t){this.editor=e,e.fire("beforeUndoImage");var n=e.getSnapshot();CKEDITOR.env.ie&&n&&(n=n.replace(/\s+data-cke-expando=".*?"/g,"")),this.contents=n,t||(this.bookmarks=(n=n&&e.getSelection())&&n.createBookmarks2(!0)),e.fire("afterUndoImage")},i=/\b(?:href|src|name)="[^"]*?"/gi;r.prototype={equalsContent:function(e){var t=this.contents,e=e.contents;return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)&&(t=t.replace(i,""),e=e.replace(i,"")),t!=e?!1:!0},equalsSelection:function(e){var t=this.bookmarks,e=e.bookmarks;if(t||e){if(!t||!e||t.length!=e.length)return!1;for(var n=0;n<t.length;n++){var r=t[n],i=e[n];if(r.startOffset!=i.startOffset||r.endOffset!=i.endOffset||!CKEDITOR.tools.arrayCompare(r.start,i.start)||!CKEDITOR.tools.arrayCompare(r.end,i.end))return!1}}return!0}};var s=CKEDITOR.plugins.undo.NativeEditingHandler=function(e){this.undoManager=e,this.ignoreInputEvent=!1,this.keyEventsStack=new o,this.lastKeydownImage=null};s.prototype={onKeydown:function(t){var i=t.data.getKey();if(229!==i)if(-1<CKEDITOR.tools.indexOf(e,t.data.getKeystroke()))t.data.preventDefault();else if(this.keyEventsStack.cleanUp(t),t=this.undoManager,this.keyEventsStack.getLast(i)||this.keyEventsStack.push(i),this.lastKeydownImage=new r(t.editor),n.isNavigationKey(i)||this.undoManager.keyGroupChanged(i))if(t.strokesRecorded[0]||t.strokesRecorded[1])t.save(!1,this.lastKeydownImage,!1),t.resetType()},onInput:function(){if(this.ignoreInputEvent)this.ignoreInputEvent=!1;else{var e=this.keyEventsStack.getLast();e||(e=this.keyEventsStack.push(0)),this.keyEventsStack.increment(e.keyCode),this.keyEventsStack.getTotalInputs()>=this.undoManager.strokesLimit&&(this.undoManager.type(e.keyCode,!0),this.keyEventsStack.resetInputs())}},onKeyup:function(e){var t=this.undoManager,e=e.data.getKey(),i=this.keyEventsStack.getTotalInputs();this.keyEventsStack.remove(e);if(!n.ieFunctionalKeysBug(e)||!this.lastKeydownImage||!this.lastKeydownImage.equalsContent(new r(t.editor,!0)))0<i?t.type(e):n.isNavigationKey(e)&&this.onNavigationKey(!0)},onNavigationKey:function(e){var t=this.undoManager;(e||!t.save(!0,null,!1))&&t.updateSelection(new r(t.editor)),t.resetType()},ignoreInputEventListener:function(){this.ignoreInputEvent=!0},attachListeners:function(){var e=this.undoManager.editor,t=e.editable(),r=this;t.attachListener(t,"keydown",function(e){r.onKeydown(e),n.ieFunctionalKeysBug(e.data.getKey())&&r.onInput()},null,null,999),t.attachListener(t,CKEDITOR.env.ie?"keypress":"input",r.onInput,r,null,999),t.attachListener(t,"keyup",r.onKeyup,r,null,999),t.attachListener(t,"paste",r.ignoreInputEventListener,r,null,999),t.attachListener(t,"drop",r.ignoreInputEventListener,r,null,999),t.attachListener(t.isInline()?t:e.document.getDocumentElement(),"click",function(){r.onNavigationKey()},null,null,999),t.attachListener(this.undoManager.editor,"blur",function(){r.keyEventsStack.remove(9)},null,null,999)}};var o=CKEDITOR.plugins.undo.KeyEventsStack=function(){this.stack=[]};o.prototype={push:function(e){return this.stack[this.stack.push({keyCode:e,inputs:0})-1]},getLastIndex:function(e){if("number"!=typeof e)return this.stack.length-1;for(var t=this.stack.length;t--;)if(this.stack[t].keyCode==e)return t;return-1},getLast:function(e){return e=this.getLastIndex(e),-1!=e?this.stack[e]:null},increment:function(e){this.getLast(e).inputs++},remove:function(e){e=this.getLastIndex(e),-1!=e&&this.stack.splice(e,1)},resetInputs:function(e){if("number"==typeof e)this.getLast(e).inputs=0;else for(e=this.stack.length;e--;)this.stack[e].inputs=0},getTotalInputs:function(){for(var e=this.stack.length,t=0;e--;)t+=this.stack[e].inputs;return t},cleanUp:function(e){e=e.data.$,!e.ctrlKey&&!e.metaKey&&this.remove(17),e.shiftKey||this.remove(16),e.altKey||this.remove(18)}}}(),function(){function e(e){var n=this.editor,r=e.document,i=r.body,s=r.getElementById("cke_actscrpt");s&&s.parentNode.removeChild(s),(s=r.getElementById("cke_shimscrpt"))&&s.parentNode.removeChild(s),(s=r.getElementById("cke_basetagscrpt"))&&s.parentNode.removeChild(s),i.contentEditable=!0,CKEDITOR.env.ie&&(i.hideFocus=!0,i.disabled=!0,i.removeAttribute("disabled")),delete this._.isLoadingData,this.$=i,r=new CKEDITOR.dom.document(r),this.setup(),this.fixInitialSelection(),CKEDITOR.env.ie&&(r.getDocumentElement().addClass(r.$.compatMode),n.config.enterMode!=CKEDITOR.ENTER_P&&this.attachListener(r,"selectionchange",function(){var e=r.getBody(),t=n.getSelection(),i=t&&t.getRanges()[0];i&&e.getHtml().match(/^<p>(?:&nbsp;|<br>)<\/p>$/i)&&i.startContainer.equals(e)&&setTimeout(function(){i=n.getSelection().getRanges()[0],i.startContainer.equals("body")||(e.getFirst().remove(1),i.moveToElementEditEnd(e),i.select())},0)})),(CKEDITOR.env.webkit||CKEDITOR.env.ie&&10<CKEDITOR.env.version)&&r.getDocumentElement().on("mousedown",function(e){e.data.getTarget().is("html")&&setTimeout(function(){n.editable().focus()})}),t(n);try{n.document.$.execCommand("2D-position",!1,!0)}catch(o){}(CKEDITOR.env.gecko||CKEDITOR.env.ie&&"CSS1Compat"==n.document.$.compatMode)&&this.attachListener(this,"keydown",function(e){var t=e.data.getKeystroke();if(t==33||t==34)if(CKEDITOR.env.ie)setTimeout(function(){n.getSelection().scrollIntoView()},0);else if(n.window.$.innerHeight>this.$.offsetHeight){var r=n.createRange();r[t==33?"moveToElementEditStart":"moveToElementEditEnd"](this),r.select(),e.data.preventDefault()}}),CKEDITOR.env.ie&&this.attachListener(r,"blur",function(){try{r.$.selection.empty()}catch(e){}}),CKEDITOR.env.iOS&&this.attachListener(r,"touchend",function(){e.focus()}),i=n.document.getElementsByTag("title").getItem(0),i.data("cke-title",i.getText()),CKEDITOR.env.ie&&(n.document.$.title=this._.docTitle),CKEDITOR.tools.setTimeout(function(){this.status=="unloaded"&&(this.status="ready"),n.fire("contentDom"),this._.isPendingFocus&&(n.focus(),this._.isPendingFocus=!1),setTimeout(function(){n.fire("dataReady")},0)},0,this)}function t(e){function t(){var t;e.editable().attachListener(e,"selectionChange",function(){var r=e.getSelection().getSelectedElement();r&&(t&&(t.detachEvent("onresizestart",n),t=null),r.$.attachEvent("onresizestart",n),t=r.$)})}function n(e){e.returnValue=!1}if(CKEDITOR.env.gecko)try{var r=e.document.$;r.execCommand("enableObjectResizing",!1,!e.config.disableObjectResizing),r.execCommand("enableInlineTableEditing",!1,!e.config.disableNativeTableHandles)}catch(i){}else CKEDITOR.env.ie&&11>CKEDITOR.env.version&&e.config.disableObjectResizing&&t(e)}function n(){var e=[];if(8<=CKEDITOR.document.$.documentMode){e.push("html.CSS1Compat [contenteditable=false]{min-height:0 !important}");var t=[],n;for(n in CKEDITOR.dtd.$removeEmpty)t.push("html.CSS1Compat "+n+"[contenteditable=false]");e.push(t.join(",")+"{display:inline-block}")}else CKEDITOR.env.gecko&&(e.push("html{height:100% !important}"),e.push("img:-moz-broken{-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}"));return e.push("html{cursor:text;*cursor:auto}"),e.push("img,input,textarea{cursor:default}"),e.join("\n")}CKEDITOR.plugins.add("wysiwygarea",{init:function(e){e.config.fullPage&&e.addFeature({allowedContent:"html head title; style [media,type]; body (*)[id]; meta link [*]",requiredContent:"body"}),e.addMode("wysiwyg",function(t){function n(n){n&&n.removeListener(),e.editable(new r(e,s.$.contentWindow.document.body)),e.setData(e.getData(1),t)}var i="document.open();"+(CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"")+"document.close();",i=CKEDITOR.env.air?"javascript:void(0)":CKEDITOR.env.ie&&!CKEDITOR.env.edge?"javascript:void(function(){"+encodeURIComponent(i)+"}())":"",s=CKEDITOR.dom.element.createFromHtml('<iframe src="'+i+'" frameBorder="0"></iframe>');s.setStyles({width:"100%",height:"100%"}),s.addClass("cke_wysiwyg_frame").addClass("cke_reset"),i=e.ui.space("contents"),i.append(s);var o=CKEDITOR.env.ie&&!CKEDITOR.env.edge||CKEDITOR.env.gecko;o&&s.on("load",n);var u=e.title,f=e.fire("ariaEditorHelpLabel",{}).label;u&&(CKEDITOR.env.ie&&f&&(u+=", "+f),s.setAttribute("title",u));if(f){var u=CKEDITOR.tools.getNextId(),l=CKEDITOR.dom.element.createFromHtml('<span id="'+u+'" class="cke_voice_label">'+f+"</span>");i.append(l,1),s.setAttribute("aria-describedby",u)}e.on("beforeModeUnload",function(e){e.removeListener(),l&&l.remove()}),s.setAttributes({tabIndex:e.tabIndex,allowTransparency:"true"}),!o&&n(),e.fire("ariaWidget",s)})}}),CKEDITOR.editor.prototype.addContentsCss=function(e){var t=this.config,n=t.contentsCss;CKEDITOR.tools.isArray(n)||(t.contentsCss=n?[n]:[]),t.contentsCss.push(e)};var r=CKEDITOR.tools.createClass({$:function(){this.base.apply(this,arguments),this._.frameLoadedHandler=CKEDITOR.tools.addFunction(function(t){CKEDITOR.tools.setTimeout(e,0,this,t)},this),this._.docTitle=this.getWindow().getFrame().getAttribute("title")},base:CKEDITOR.editable,proto:{setData:function(e,t){var r=this.editor;if(t)this.setHtml(e),this.fixInitialSelection(),r.fire("dataReady");else{this._.isLoadingData=!0,r._.dataStore={id:1};var i=r.config,s=i.fullPage,o=i.docType,u=CKEDITOR.tools.buildStyleHtml(n()).replace(/<style>/,'<style data-cke-temp="1">');s||(u+=CKEDITOR.tools.buildStyleHtml(r.config.contentsCss));var a=i.baseHref?'<base href="'+i.baseHref+'" data-cke-temp="1" />':"";s&&(e=e.replace(/<!DOCTYPE[^>]*>/i,function(e){return r.docType=o=e,""}).replace(/<\?xml\s[^\?]*\?>/i,function(e){return r.xmlDeclaration=e,""})),e=r.dataProcessor.toHtml(e),s?(/<body[\s|>]/.test(e)||(e="<body>"+e),/<html[\s|>]/.test(e)||(e="<html>"+e+"</html>"),/<head[\s|>]/.test(e)?/<title[\s|>]/.test(e)||(e=e.replace(/<head[^>]*>/,"$&<title></title>")):e=e.replace(/<html[^>]*>/,"$&<head><title></title></head>"),a&&(e=e.replace(/<head[^>]*?>/,"$&"+a)),e=e.replace(/<\/head\s*>/,u+"$&"),e=o+e):e=i.docType+'<html dir="'+i.contentsLangDirection+'" lang="'+(i.contentsLanguage||r.langCode)+'"><head><title>'+this._.docTitle+"</title>"+a+u+"</head><body"+(i.bodyId?' id="'+i.bodyId+'"':"")+(i.bodyClass?' class="'+i.bodyClass+'"':"")+">"+e+"</body></html>",CKEDITOR.env.gecko&&(e=e.replace(/<body/,'<body contenteditable="true" '),2e4>CKEDITOR.env.version&&(e=e.replace(/<body[^>]*>/,"$&<!-- cke-content-start -->"))),i='<script id="cke_actscrpt" type="text/javascript"'+(CKEDITOR.env.ie?' defer="defer" ':"")+">var wasLoaded=0;function onload(){if(!wasLoaded)window.parent.CKEDITOR.tools.callFunction("+this._.frameLoadedHandler+",window);wasLoaded=1;}"+(CKEDITOR.env.ie?"onload();":'document.addEventListener("DOMContentLoaded", onload, false );')+"</script>",CKEDITOR.env.ie&&9>CKEDITOR.env.version&&(i+='<script id="cke_shimscrpt">window.parent.CKEDITOR.tools.enableHtml5Elements(document)</script>'),a&&CKEDITOR.env.ie&&10>CKEDITOR.env.version&&(i+='<script id="cke_basetagscrpt">var baseTag = document.querySelector( "base" );baseTag.href = baseTag.href;</script>'),e=e.replace(/(?=\s*<\/(:?head)>)/,i),this.clearCustomData(),this.clearListeners(),r.fire("contentDomUnload");var f=this.getDocument();try{f.write(e)}catch(l){setTimeout(function(){f.write(e)},0)}}},getData:function(e){if(e)return this.getHtml();var e=this.editor,t=e.config,n=t.fullPage,r=n&&e.docType,i=n&&e.xmlDeclaration,s=this.getDocument(),n=n?s.getDocumentElement().getOuterHtml():s.getBody().getHtml();return CKEDITOR.env.gecko&&t.enterMode!=CKEDITOR.ENTER_BR&&(n=n.replace(/<br>(?=\s*(:?$|<\/body>))/,"")),n=e.dataProcessor.toDataFormat(n),i&&(n=i+"\n"+n),r&&(n=r+"\n"+n),n},focus:function(){this._.isLoadingData?this._.isPendingFocus=!0:r.baseProto.focus.call(this)},detach:function(){var e=this.editor,t=e.document,e=e.window.getFrame();r.baseProto.detach.call(this),this.clearCustomData(),t.getDocumentElement().clearCustomData(),e.clearCustomData(),CKEDITOR.tools.removeFunction(this._.frameLoadedHandler),(t=e.removeCustomData("onResize"))&&t.removeListener(),e.remove()}}})}(),CKEDITOR.config.disableObjectResizing=!1,CKEDITOR.config.disableNativeTableHandles=!0,CKEDITOR.config.disableNativeSpellChecker=!0,CKEDITOR.config.contentsCss=CKEDITOR.getUrl("contents.css"),function(){function e(e){function t(){i=e.document,s=i[CKEDITOR.env.ie?"getBody":"getDocumentElement"](),o=CKEDITOR.env.quirks?i.getBody():i.getDocumentElement(),u=CKEDITOR.dom.element.createFromHtml('<span style="margin:0;padding:0;border:0;clear:both;width:1px;height:1px;display:block;">'+(CKEDITOR.env.webkit?"&nbsp;":"")+"</span>",i)}function n(){c&&o.setStyle("overflow-y","hidden");var t=e.window.getViewPaneSize().height,n;s.append(u),n=u.getDocumentPosition(i).y+u.$.offsetHeight,u.remove(),n+=a,n=Math.max(n,f),n=Math.min(n,l),n!=t&&r!=n&&(n=e.fire("autoGrow",{currentHeight:t,newHeight:n}).newHeight,e.resize(e.container.getStyle("width"),n,!0),r=n),c||(n<l&&o.$.scrollHeight>o.$.clientHeight?o.setStyle("overflow-y","hidden"):o.removeStyle("overflow-y"))}var r,i,s,o,u,a=e.config.autoGrow_bottomSpace||0,f=void 0!==e.config.autoGrow_minHeight?e.config.autoGrow_minHeight:200,l=e.config.autoGrow_maxHeight||Infinity,c=!e.config.autoGrow_maxHeight;e.addCommand("autogrow",{exec:n,modes:{wysiwyg:1},readOnly:1,canUndo:!1,editorFocus:!1});var h={contentDom:1,key:1,selectionChange:1,insertElement:1,mode:1},p;for(p in h)e.on(p,function(t){"wysiwyg"==t.editor.mode&&setTimeout(function(){var t=e.getCommand("maximize");!e.window||t&&t.state==CKEDITOR.TRISTATE_ON?r=null:(n(),c||n())},100)});e.on("afterCommandExec",function(e){"maximize"==e.data.name&&"wysiwyg"==e.editor.mode&&(e.data.command.state==CKEDITOR.TRISTATE_ON?o.removeStyle("overflow-y"):n())}),e.on("contentDom",t),t(),e.config.autoGrow_onStartup&&e.execCommand("autogrow")}CKEDITOR.plugins.add("autogrow",{init:function(t){t.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE&&t.on("instanceReady",function(){t.editable().isInline()?t.ui.space("contents").setStyle("height","auto"):e(t)})}})}(),CKEDITOR.config.plugins="basicstyles,blockquote,dialogui,dialog,clipboard,button,panelbutton,panel,floatpanel,colorbutton,colordialog,confighelper,menu,contextmenu,enterkey,entities,floatingspace,listblock,richcombo,font,format,htmlwriter,lineutils,widget,image2,indent,indentlist,justify,fakeobjects,link,list,liststyle,maximize,removeformat,resize,showborders,sourcearea,table,tabletools,tableresize,toolbar,undo,wysiwygarea,autogrow",CKEDITOR.config.skin="moono",function(){var e=function(e,t){var n=CKEDITOR.getUrl("plugins/"+t);e=e.split(",");for(var r=0;r<e.length;r++)CKEDITOR.skin.icons[e[r]]={path:n,offset:-e[++r],bgsize:e[++r]}};CKEDITOR.env.hidpi?e("bold,0,,italic,24,,strike,48,,subscript,72,,superscript,96,,underline,120,,blockquote,144,,copy-rtl,168,,copy,192,,cut-rtl,216,,cut,240,,paste-rtl,264,,paste,288,,bgcolor,312,,textcolor,336,,image,360,,indent-rtl,384,,indent,408,,outdent-rtl,432,,outdent,456,,justifyblock,480,,justifycenter,504,,justifyleft,528,,justifyright,552,,anchor-rtl,576,,anchor,600,,link,624,,unlink,648,,bulletedlist-rtl,672,,bulletedlist,696,,numberedlist-rtl,720,,numberedlist,744,,maximize,768,,removeformat,792,,source-rtl,816,,source,840,,table,864,,redo-rtl,888,,redo,912,,undo-rtl,936,,undo,960,","icons_hidpi.png"):e("bold,0,auto,italic,24,auto,strike,48,auto,subscript,72,auto,superscript,96,auto,underline,120,auto,blockquote,144,auto,copy-rtl,168,auto,copy,192,auto,cut-rtl,216,auto,cut,240,auto,paste-rtl,264,auto,paste,288,auto,bgcolor,312,auto,textcolor,336,auto,image,360,auto,indent-rtl,384,auto,indent,408,auto,outdent-rtl,432,auto,outdent,456,auto,justifyblock,480,auto,justifycenter,504,auto,justifyleft,528,auto,justifyright,552,auto,anchor-rtl,576,auto,anchor,600,auto,link,624,auto,unlink,648,auto,bulletedlist-rtl,672,auto,bulletedlist,696,auto,numberedlist-rtl,720,auto,numberedlist,744,auto,maximize,768,auto,removeformat,792,auto,source-rtl,816,auto,source,840,auto,table,864,auto,redo-rtl,888,auto,redo,912,auto,undo-rtl,936,auto,undo,960,auto","icons.png")}(),CKEDITOR.lang.languages={af:1,sq:1,ar:1,eu:1,bn:1,bs:1,bg:1,ca:1,"zh-cn":1,zh:1,hr:1,cs:1,da:1,nl:1,en:1,"en-au":1,"en-ca":1,"en-gb":1,eo:1,et:1,fo:1,fi:1,fr:1,"fr-ca":1,gl:1,ka:1,de:1,el:1,gu:1,he:1,hi:1,hu:1,is:1,id:1,it:1,ja:1,km:1,ko:1,ku:1,lv:1,lt:1,mk:1,ms:1,mn:1,no:1,nb:1,fa:1,pl:1,"pt-br":1,pt:1,ro:1,ru:1,sr:1,"sr-latn":1,si:1,sk:1,sl:1,es:1,sv:1,tt:1,th:1,tr:1,ug:1,uk:1,vi:1,cy:1}}(),define("lib-app/ckeditor/ckeditor",function(){}),define("lib-build/css!storymaps/tpl/builder/InlineEditor",[],function(){}),define("lib-build/tpl!storymaps/common/builder/ckeditor/plugins/storymapsInlineMedia/dialog/Media",[],function(){return function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="modal-dialog">\n	<div class="modal-content">\n		<div class="modal-header">\n			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n			<h4 class="modal-title">'+((__t=lblTitle)==null?"":__t)+'</h4>\n		</div>\n\n		<div class="modal-body">\n			<div class="viewMediaSelectorContainer"></div>\n		</div>\n\n		<div class="modal-footer">\n			<span class="modal-footer-left"><button class="btn btn-back btn-naked">< '+((__t=btnBack)==null?"":__t)+'</button></span>\n			<button class="btnSubmit btn btn-primary">'+((__t=btnOk)==null?"":__t)+'</button>\n			<button class="btnCancel btn btn-naked btn-close" data-dismiss="modal">'+((__t=btnCancel)==null?"":__t)+"</button>\n		</div>\n	</div>\n</div>\n";return __p}}),define("lib-build/css!storymaps/common/builder/ckeditor/plugins/storymapsInlineMedia/dialog/Media",[],function(){}),define("lib-build/css!storymaps/common/builder/ckeditor/plugins/Common",[],function(){}),define("storymaps/common/builder/ckeditor/plugins/storymapsInlineMedia/dialog/Media",["lib-build/tpl!./Media","lib-build/css!./Media","lib-build/css!../../Common","storymaps/common/builder/media/MediaSelector","dojo/Deferred"],function(e,t,n,r,i){return function(n){function a(){var e=u.getData();n.find(".btnSubmit").attr("disabled",!(e.media&&e.media.type&&e.media[e.media.type]))}function f(){var e=u.checkError(n.find(".btnSubmit")),t=function(){var e=u.getData().media;o.resolve(e[e.type]),n.modal("toggle")};e instanceof i?e.then(function(e){e||t()}):e||t()}function l(){n.find(".btnSubmit").click(f)}n.append(e({lblTitle:i18n.commonMedia.editorInlineMedia.lblTitle,btnOk:i18n.commonCore.common.apply,btnCancel:i18n.commonCore.common.cancel,btnBack:i18n.commonCore.common.back}));var s=null,o=null,u=new r(n.find(".viewMediaSelectorContainer"),null,!0,a,n.find(".btn-back"));l(),this.present=function(e,t){return s=e,o=new i,u.present({mode:e.mode,webmaps:null,media:e.mode=="edit"?e.edit.media:null,keepLastDataSource:!0},function(){}),n.find(".modal-content").css("min-height",t),n.modal({keyboard:!0}),o},this.initLocalization=function(){}}}),define("storymaps/tpl/builder/InlineEditor",["lib-build/css!./InlineEditor","storymaps/common/builder/ckeditor/plugins/storymapsInlineMedia/dialog/Media","dojo/topic"],function(e,t,n){var r=null,i=!1;return function(){function s(e){var t=app.data.getWebAppData().getTheme().colors,n=e.editable();n.setStyle("background-color","transparent"),t&&t.text&&n.setStyle("color",t.text);var r=$(n.$).siblings("head");r.find("#link-style, #caption-style").remove(),t&&t.textLink&&r.append('<style id="link-style"> a { color: '+t.textLink+"; } </style>")}function o(){if(i)return;app.isProduction||CKEDITOR.plugins.addExternal("storymapsInlineMedia","../../app/storymaps/common/builder/ckeditor/plugins/storymapsInlineMedia/"),n.subscribe("EDITOR-OPEN-INLINE-MEDIA",function(e){r.present({mode:e.selectedMedia?"edit":"add",edit:{media:e.selectedMedia}},290).then(function(t){e.editorCallback(t),setTimeout(function(){s(e.editor)},500)})}),i=!0}r||(r=new t($("#editorDialogInlineMedia"))),this.init=function(e,t){t=t||{extraPlugins:"storymapsInlineMedia,autogrow",resize_enabled:!1,toolbar:[{name:"basicstyles",groups:["basicstyles","cleanup"],items:["Bold","Italic","Underline","RemoveFormat"]},{name:"colors",items:["TextColor"]},{name:"styles",items:["FontSize"]},{name:"insert",groups:["storymapsInlineMedia"],items:["InlineMedia"]},{name:"links",items:["Link","Unlink"]},{name:"paragraph",groups:["list","align"],items:["NumberedList","BulletedList","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]}],uiColor:"#FCFCFC",contentsCss:app.isProduction?"resources/lib/ckeditor/editor.css":"app/storymaps/common/builder/ckeditor/editor.css",autoGrow_onStartup:!0,linkShowAdvancedTab:!1,linkShowTargetTab:!1,extraAllowedContent:"h1 h2 h3 h4 h5 h6 sub sup table tr th td caption div span img figure figcaption iframe; *(*); *[*]; a[data-*]",removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,s,samp,small,span,strike,strong,sub,sup,tt,u,var,h1,h2,h3,h4,h5,h6",pasteFromWordRemoveFontStyles:!1,pasteFromWordRemoveStyles:!1,removePlugins:"liststyle,tableresize,tabletools,contextmenu",disableNativeSpellChecker:!1},CKEDITOR.on("instanceCreated",function(t){var r=t.editor,i=function(){var e=$(r.container.$).parents(".entry"),t=r.getData();t=t.replace(new RegExp(String.fromCharCode(8232),"g")," "),n.publish("BUILDER-UPDATE-ENTRY-DESCRIPTION",{index:e.index(),value:t})};r.on("blur",i),r.on("change",i),r.on("doubleclick",function(e){var t=CKEDITOR.plugins.link.getSelectedLink(r)||e.data.element;if(t.is("a"))return e.data.dialog=t.getAttribute("name")&&(!t.getAttribute("href")||!t.getChildCount())?"anchor":"link",r.getSelection().selectElement(t),!1}),r.on("contentDom",function(){setTimeout(function(){var t=e.find(".cke_wysiwyg_frame"),r=null;if(!t.length)return;try{r=t.contents().find("body")}catch(i){return}if(!r.length)return;r.find(".iframe-container.fit img").css("height",e.find(".cke_wysiwyg_frame").width()*9/16),r.find(".iframe-container").off("click").click(function(){var e=$(this);n.publish("EDITOR-EDIT-INLINE-MEDIA",e[0])}),r.find(".image-container > span.cke_widget_wrapper, .cke_widget_element > span.cke_image_resizer_wrapper").off("click").click(function(e){var t=$(this),r=e.offsetX===undefined?e.pageX-t.offset().left:e.offsetX,i=e.offsetY===undefined?e.pageY-t.offset().top:e.offsetY;r>$(this).width()-20&&i<20&&n.publish("EDITOR-EDIT-INLINE-MEDIA",t[0])})},500)}),r.on("selectionChange",function(e){if(r.readOnly)return;var t=r.getCommand("link"),n=e.data.path.lastElement&&e.data.path.lastElement.getAscendant("a",!0),i=n&&n.getName()=="a"&&n.getAttribute("data-storymaps")&&n.getChildCount();t.setState(i?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_OFF)})}),CKEDITOR.on("instanceReady",function(t){var n=t.editor;e.find(".cke_button__inlinemedia, .cke_button__inlinemedia .cke_button_icon").css("width",27),e.find(".cke_button__inlinemedia .cke_button_icon").css("background-size",27),t.editor.getCommand("link").setState(CKEDITOR.TRISTATE_DISABLED),n.filter.addTransformations([[{element:"a",left:function(e){return e.attributes.target!="_blank"},right:function(e){e.attributes["data-storymaps"]||(e.attributes.target="_blank")}}]]),s(n)}),CKEDITOR.on("dialogDefinition",function(e){var t=e.data.name,r=e.data.definition;if(t=="link"){var i=r.getContents("info"),s=r.getContents("target"),o=s.get("linkTargetType");o["default"]="_blank",i.get("linkType").style="display: none",i.get("urlOptions").children[0].children[0].style="display: none",i.get("urlOptions").children[0].widths=["0%","100%"];var u=i.get("url");u.onKeyUp=function(){},u.setup=function(e){this.allowOnChange=!1;if(e.url){var t="";e.url.protocol&&(t+=e.url.protocol),e.url.url&&(t+=e.url.url),this.setValue(t)}this.allowOnChange=!0},u.commit=function(e){var t=this.getValue();t.match(/^http:\/\/|https:\/\/|ftp:|mailto:|\/\//)||(t="http://"+t),e.url={protocol:"",url:t}}}t=="image2"&&(r.dialog.show=function(){n.publish("EDITOR-EDIT-INLINE-MEDIA",{})})}),CKEDITOR.replaceAll(function(n,r){var i=!1;$(n).parents().each(function(){if($.inArray(this,e)!=-1)return i=!0,!1});if(!i)return!1;$.each(Object.keys(t),function(e,n){r[n]=t[n]})})},o()}}),define("storymaps/tpl/builder/BuilderView",["lib-build/tpl!./BuilderView","lib-build/css!./BuilderView","lib-build/css!./Common","../core/WebApplicationData","storymaps/common/builder/settings/SettingsPopup","storymaps/common/builder/Landing","./Help","./InitPopup","storymaps/common/builder/SharePopup","storymaps/common/utils/CommonHelper","storymaps/common/builder/settings/ViewLayoutVertical","./settings/ViewLayoutOptions","./settings/ViewMapOptions","storymaps/common/builder/settings/ViewTheme","storymaps/common/builder/settings/ViewHeader","./addedit/Popup","./OrganizePopup","storymaps/common/builder/media/map/EditDialog","dojo/Deferred","dojo/topic","dojo/has","lib-app/ckeditor/ckeditor","storymaps/tpl/builder/InlineEditor"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w){return function(n){function O(e){i.updateUI(!0),$(".builder-add").addClass("active"),r.setTitle(e),b.publish("CORE_UPDATE_UI"),M(),S||(S=b.subscribe("BUILDER-MY-STORIES-CHECK",function(){setTimeout(window.myStoriesInit,300),S.remove()}))}function M(){i.updateUI(!0),$(".builder-add").addClass("active"),k.present({mode:"add",webmaps:app.data.getWebmapsInfo(),entry:app.data.getCurrentSection(),layout:r.getLayoutId()}).then(function(e){console.log("builder.BuilderView.clickAdd:",e),$("body").removeClass("isBuilderLanding"),app.isInitializing=!1,app.data.addStorySection(e),D(e),b.publish("story-update-entries"),b.publish("BUILDER_INCREMENT_COUNTER",1),b.publish("CORE_RESIZE"),b.publish("BUILDER-MY-STORIES-CHECK")},function(){D(),i.updateUI()})}function _(){var e=app.data.getStoryLength()>=app.cfg.MAX_NB_ENTRIES;$(".builder-add").toggleClass("disabled",e).tooltip("destroy"),e&&$(".builder-add").tooltip({trigger:"hover",placement:"top",html:!0,title:i18n.builder.addEditPopup.disabled.replace("%LBL_LAYOUT%",app.data.getWebAppData().getLayoutProperties().itemsLbl.toLowerCase())})}function D(e){var t=e&&e.media&&e.media.webmap;t&&$('.mapContainer[data-webmapid="'+e.media.webmap.id+'"]').data("temporary",!1),$(".mapContainer").filter(function(){return $(this).data("temporary")}).each(function(e,t){var n=$(t).data("webmapid");app.maps[n].response.map.destroy(),delete app.maps[n],$(t).parent().hasClass("active")&&(app.map=null),$(t).parent().remove()})}function P(e){var t=new y;return k.present({mode:"edit",displayTab:e.displayTab,webmaps:app.data.getWebmapsInfo(),entry:app.data.getStoryByIndex(e.entryIndex),entryIndex:e.entryIndex,layout:r.getLayoutId()}).then(function(n){app.data.editSection(e.entryIndex,n),D(n),b.publish("story-update-entry",{index:e.entryIndex,section:n}),b.publish("BUILDER_INCREMENT_COUNTER",1),t.resolve(),b.publish("BUILDER-MY-STORIES-CHECK")},function(){D(),t.reject()}),t}function H(){return k.getAddEditEntryTitle()}function B(e){var t=app.data.getStoryByIndex(e.index);e.value!=t.description&&(t.description=e.value,app.data.editSection(t),b.publish("BUILDER_INCREMENT_COUNTER",1))}function j(){$(".builder-organize").addClass("active"),L.present({story:app.data.getStory(),sectionIndex:app.data.getCurrentSectionIndex(),appLayout:r.getLayoutId(),layoutOpt:r.getLayoutOptions()}).then(function(e){console.log("builder.BuilderView.openOrganizePopup:",e),L.close(),app.data.organizeStory(e.entries,e.sectionIndex),b.publish("story-update-entries"),b.publish("BUILDER_INCREMENT_COUNTER",1),b.publish("BUILDER-MY-STORIES-CHECK")},function(){i.updateUI()})}function F(e){var t=1;t&&$("body").addClass("switchLayout"),r.setLayout(e.settings[0]),r.setLayoutOptions(e.settings[1]),r.setMapOptions(e.settings[2]),r.setTheme({colors:e.settings[3].colors}),r.setHeader(e.settings[4]),t&&(b.publish("BUILDER_INCREMENT_COUNTER",t),b.publish("CORE_UPDATE_UI"),b.publish("CORE_RESIZE"),setTimeout(function(){b.publish("story-entry-reset-map-extent")},100)),_()}function I(){T.show()}function q(e,t){T.show(e,t)}function R(e){C.present(e,n.getHeaderUserCfg())}function U(e){app.data.setStoryStorage("WEBAPP"),n.displayApp(),n.initPopupComplete(),app.data.getWebAppData().setLayout(e),app.data.getWebAppData().setDefaultLayoutOptions(),b.publish("CORE_UPDATE_UI"),$("body").addClass("isBuilderLanding"),$("body").addClass("switchLayout"),n.appInitComplete(),setTimeout(function(){w("touch")||x.focus()},50)}function z(e){e=e||{};var t=parseInt(e.index,10);if(t<0||t>app.data.getStoryLength()-1)return;$(".builderShare").modal("hide"),b.publish("story-navigate-entry",e.index),e.type=="main-stage"&&app.builder.openEditPopup({entryIndex:e.index}).then(function(){app.builder.openSharePopup()},function(){app.builder.openSharePopup()})}function W(e){e=e||{};if($.inArray(e.id,app.data.getWebmaps())<0)return;$(".builderShare").modal("hide"),X({id:e.id}).then(function(){app.builder.openSharePopup()},function(){app.builder.openSharePopup()})}function X(e){return A.present(e)}$("#builder-views").append(e({}));var i=this,E=null,S=null,x=new s($("#builderLanding"),O,I),T=new o($("#builderHelp")),N=new u($("#initPopup")),C=new a($("#sharePopup")),k=new v($("#addEditPopup")),L=new m($("#organizePopup")),A=new g($("#mapEditPopup"));this.init=function(e){E=e,b.subscribe("SETTINGS_POPUP_SAVE",F),b.subscribe("OPEN_HELP",function(){T.show()}),b.subscribe("story-update-entries",_),b.subscribe("BUILDER-UPDATE-ENTRY-DESCRIPTION",B),app.builder.openSharePopup=R,app.builder.openEditPopup=P,app.builder.openHelpPopup=q,app.builder.getAddEditEntryTitle=H,app.builder.openMapViewer=X,CKEDITOR.disableAutoInline=!0,$(".builder-add").click(function(){$(this).hasClass("disabled")||M()}).find(".builder-lbl").html(i18n.builder.addEditPopup.lblAdd),$(".builder-organize").click(j).find(".builder-lbl").html(i18n.builder.organizePopup.title),app.builderCfg={STATUS:{PUBLISHED:i18n.builder.common.lblStatus1,HIDDEN:i18n.builder.common.lblStatus3}},app.cfg.LAYOUTS[0].title=i18n.builder.layouts.tabTitle,app.cfg.LAYOUTS[0].description=i18n.builder.layouts.tabDescr,app.cfg.LAYOUTS[0].itemLbl=i18n.builder.layouts.tabItem,app.cfg.LAYOUTS[0].itemsLbl=i18n.builder.layouts.tabItems,app.cfg.LAYOUTS[1].title=i18n.builder.layouts.sideTitle,app.cfg.LAYOUTS[1].description=i18n.builder.layouts.sideDescr,app.cfg.LAYOUTS[1].itemLbl=i18n.builder.layouts.sideItem,app.cfg.LAYOUTS[1].itemsLbl=i18n.builder.layouts.sideItems,app.cfg.LAYOUTS[2].title=i18n.builder.layouts.bulletTitle,app.cfg.LAYOUTS[2].description=i18n.builder.layouts.bulletDescr,app.cfg.LAYOUTS[2].itemLbl=i18n.builder.layouts.bulletItem,app.cfg.LAYOUTS[2].itemsLbl=i18n.builder.layouts.bulletItems,$("body").on("shown.bs.modal",".modal",function(e){r.getLayoutId()=="float"&&app.ui.floatingPanel.disableSwiperKeybordEvent()}),$("body").on("hide.bs.modal",".modal",function(e){if(r.getLayoutId()=="float"){if($(e.currentTarget).hasClass("addEditPopup")&&$(e.currentTarget).hasClass("temporaryHide"))return;app.ui.floatingPanel.enableSwiperKeybordEvent()}}),b.subscribe("MY-STORIES-EDIT-MEDIA",z),b.subscribe("MY-STORIES-EDIT-MAP",W)},this.appInitComplete=function(){!app.isProduction&&f.getUrlParams().debug=="add"&&M(),!app.isProduction&&f.getUrlParams().debug=="organize"&&j(),!app.isProduction&&f.getUrlParams().debug=="settings"&&this.openSettingPopup(),!app.isProduction&&f.getUrlParams().debug=="edit"&&P({displayTab:f.getUrlParams().debugView||"content",sectionIndex:f.getUrlParams().debugIndex||0}),!app.isProduction&&f.getUrlParams().debug=="share"&&setTimeout(R,1e3),_()},this.updateUI=function(e){var t=e||app.data.getStoryLength();$(".builder-add, .builder-organize").removeClass("active"),x.toggle(!t),$(".builder-content-panel").toggle(!!t),$("#sidePanel .builder, #floatingPanel .builder").toggleClass("large",!app.data.getStoryLength())},this.getSettingsTab=function(){return[new l,new c,new h,new p,new d({smallSizeOpt:app.appCfg.headerCompactOpt})]},this.openSettingPopup=function(e){E.present([r.getLayout(),r.getLayoutOptions(),r.getMapOptions(),{layout:r.getLayoutId(),layoutCfg:r.getLayoutOptions().layoutCfg,theme:r.getTheme()},r.getHeader()],null)},this.showInitPopup=function(){var e=f.getUrlParams().layout;n.initPopupPrepare(),N.init(),N.initLocalization();if(e){var t=$.grep(app.cfg.LAYOUTS,function(t){return e==t.id});e=t.length?t[0].id:app.cfg.LAYOUTS[0].id,U({id:e});return}N.present().then(U,function(){n.initPopupFail()})},this.resize=function(e){w("ff")&&$("#sharePopup").hasClass("in")&&C.updateMyStoriesPosition()},this.initLocalization=function(){E.initLocalization()}}}),require(["storymaps/common/Core","storymaps/common/ui/header/Desktop","storymaps/tpl/core/MainView","storymaps/common/builder/Builder","storymaps/tpl/builder/BuilderView"],function(){}),define("storymaps/tpl/BuildConfigBuilder",function(){});