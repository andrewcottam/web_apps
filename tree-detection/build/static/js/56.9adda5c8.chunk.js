(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[56,105],{660:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n=r(2),a=r(5),i=r(6),s=r(0),u=r(42),o=r(26),c=r(1),l=(r(19),r(14),r(15),r(31)),f=r(10),h=new u.a({inherited:"inherited",codedValue:"coded-value",range:"range"}),p=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).name=null,a.type=null,a}return r}(o.a);Object(s.a)([Object(c.b)({type:String,json:{write:!0}})],p.prototype,"name",void 0),Object(s.a)([Object(l.a)(h)],p.prototype,"type",void 0);var d=p=Object(s.a)([Object(f.a)("esri.layers.support.Domain")],p)},661:function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var n,a=r(2),i=r(4),s=r(5),u=r(6),o=r(0),c=(r(1),r(19),r(14),r(15),r(31)),l=r(10),f=r(660),h=n=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).type="inherited",n}return Object(i.a)(r,[{key:"clone",value:function(){return new n}}]),r}(f.a);Object(o.a)([Object(c.a)({inherited:"inherited"})],h.prototype,"type",void 0);var p=h=n=Object(o.a)([Object(l.a)("esri.layers.support.InheritedDomain")],h)},662:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n,a=r(2),i=r(4),s=r(5),u=r(6),o=r(0),c=r(1),l=(r(19),r(14),r(15),r(31)),f=r(10),h=r(660),p=n=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).maxValue=null,n.minValue=null,n.type="range",n}return Object(i.a)(r,[{key:"clone",value:function(){return new n({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}}]),r}(h.a);Object(o.a)([Object(c.b)({type:Number,json:{type:[Number],read:{source:"range",reader:function(e,t){return t.range&&t.range[1]}},write:{enabled:!1,overridePolicy:function(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer:function(e,t,r){t[r]=[this.minValue||0,e]}}}})],p.prototype,"maxValue",void 0),Object(o.a)([Object(c.b)({type:Number,json:{type:[Number],read:{source:"range",reader:function(e,t){return t.range&&t.range[0]}},write:{target:"range",writer:function(e,t,r){t[r]=[e,this.maxValue||0]}}}})],p.prototype,"minValue",void 0),Object(o.a)([Object(l.a)({range:"range"})],p.prototype,"type",void 0);var d=p=n=Object(o.a)([Object(f.a)("esri.layers.support.RangeDomain")],p)},664:function(e,t,r){"use strict";r.d(t,"a",(function(){return g}));var n,a=r(2),i=r(4),s=r(5),u=r(6),o=r(0),c=r(18),l=r(1),f=(r(14),r(19),r(15),r(31)),h=r(10),p=r(26),d=n=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).name=null,n.code=null,n}return Object(i.a)(r,[{key:"clone",value:function(){return new n({name:this.name,code:this.code})}}]),r}(p.a);Object(o.a)([Object(l.b)({type:String,json:{write:!0}})],d.prototype,"name",void 0),Object(o.a)([Object(l.b)({type:[String,Number],json:{write:!0}})],d.prototype,"code",void 0);var y,b=d=n=Object(o.a)([Object(h.a)("esri.layers.support.CodedValue")],d),v=r(660),m=y=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).codedValues=null,n.type="coded-value",n}return Object(i.a)(r,[{key:"getName",value:function(e){var t=null;if(this.codedValues){var r=String(e);this.codedValues.some((function(e){return String(e.code)===r&&(t=e.name),!!t}))}return t}},{key:"clone",value:function(){return new y({codedValues:Object(c.a)(this.codedValues),name:this.name})}}]),r}(v.a);Object(o.a)([Object(l.b)({type:[b],json:{write:!0}})],m.prototype,"codedValues",void 0),Object(o.a)([Object(f.a)({codedValue:"coded-value"})],m.prototype,"type",void 0);var g=m=y=Object(o.a)([Object(h.a)("esri.layers.support.CodedValueDomain")],m)},666:function(e,t,r){"use strict";r.d(t,"a",(function(){return x}));var n,a=r(2),i=r(4),s=r(5),u=r(6),o=r(0),c=r(42),l=r(26),f=r(1),h=(r(19),r(14)),p=(r(15),r(31)),d=r(57),y=r(10),b=r(679),v=r(690),m=new c.a({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"}),g=n=function(e){Object(s.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).alias=null,n.defaultValue=void 0,n.description=null,n.domain=null,n.editable=!0,n.length=-1,n.name=null,n.nullable=!0,n.type=null,n.valueType=null,n}return Object(i.a)(r,[{key:"readDescription",value:function(e,t){var r,n=t.description;try{r=JSON.parse(n)}catch(a){}return r?r.value:null}},{key:"readValueType",value:function(e,t){var r,n=t.description;try{r=JSON.parse(n)}catch(a){}return r?m.fromJSON(r.fieldValueType):null}},{key:"clone",value:function(){return new n({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}}]),r}(l.a);Object(o.a)([Object(f.b)({type:String,json:{write:!0}})],g.prototype,"alias",void 0),Object(o.a)([Object(f.b)({type:[String,Number],json:{write:{allowNull:!0}}})],g.prototype,"defaultValue",void 0),Object(o.a)([Object(f.b)()],g.prototype,"description",void 0),Object(o.a)([Object(d.a)("description")],g.prototype,"readDescription",null),Object(o.a)([Object(f.b)({types:b.b,json:{read:{reader:b.a},write:!0}})],g.prototype,"domain",void 0),Object(o.a)([Object(f.b)({type:Boolean,json:{write:!0}})],g.prototype,"editable",void 0),Object(o.a)([Object(f.b)({type:h.a,json:{write:!0}})],g.prototype,"length",void 0),Object(o.a)([Object(f.b)({type:String,json:{write:!0}})],g.prototype,"name",void 0),Object(o.a)([Object(f.b)({type:Boolean,json:{write:!0}})],g.prototype,"nullable",void 0),Object(o.a)([Object(p.a)(v.a)],g.prototype,"type",void 0),Object(o.a)([Object(f.b)()],g.prototype,"valueType",void 0),Object(o.a)([Object(d.a)("valueType",["description"])],g.prototype,"readValueType",null);var x=g=n=Object(o.a)([Object(y.a)("esri.layers.support.Field")],g)},672:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var n=r(21),a=r(2),i=r(4);function s(e){return"date"===e.type||"esriFieldTypeDate"===e.type}var u=function(){function e(t){if(Object(a.a)(this,e),this.fields=t,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this.dateFields=[],t){var r,i=[],u=Object(n.a)(t);try{for(u.s();!(r=u.n()).done;){var c=r.value,l=c&&c.name;if(l){var f=o(l);this._fieldsMap.set(l,c),this._fieldsMap.set(f,c),i.push(f),s(c)&&(this.dateFields.push(c),this._dateFieldsSet.add(c))}}}catch(h){u.e(h)}finally{u.f()}i.sort(),this.uid=i.join(",")}}return Object(i.a)(e,[{key:"destroy",value:function(){this._fieldsMap.clear()}},{key:"has",value:function(e){return null!=this.get(e)}},{key:"get",value:function(e){return null!=e?this._fieldsMap.get(e)||this._fieldsMap.get(o(e)):void 0}},{key:"isDateField",value:function(e){return this._dateFieldsSet.has(this.get(e))}},{key:"normalizeFieldName",value:function(e){var t=this.get(e);if(t)return t.name}}]),e}();function o(e){return e.toLowerCase().trim()}},679:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return u}));r(19);var n=r(664),a=r(660),i=r(661),s=r(662),u={key:"type",base:a.a,typeMap:{range:s.a,"coded-value":n.a,inherited:i.a}};function o(e){if(!e||!e.type)return null;switch(e.type){case"range":return s.a.fromJSON(e);case"codedValue":return n.a.fromJSON(e);case"inherited":return i.a.fromJSON(e)}return null}},690:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=new(r(42).a)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})},696:function(e,t,r){"use strict";r.d(t,"a",(function(){return N})),r.d(t,"b",(function(){return E}));var n=r(7),a=r.n(n),i=r(22),s=r(12),u=r(21),o=r(68),c=r(29),l=r(15),f=r(11),h=r(108),p=r(107),d=r(732),y=r(53),b=r(71),v=r(13),m=(r(114),r(82)),g=r(27),x=r(62);function j(e,t,r,n){return O.apply(this,arguments)}function O(){return(O=Object(s.a)(a.a.mark((function e(t,r,n,i){var s,u,o,c,l,f,h,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="string"==typeof t?Object(g.J)(t):t,u=r[0].spatialReference,o=Object(v.a)(Object(v.a)({},i),{},{query:Object(v.a)(Object(v.a)({},s.query),{},{f:"json",sr:JSON.stringify(u),target:JSON.stringify({geometryType:Object(x.c)(r[0]),geometries:r}),cutter:JSON.stringify(n)})}),e.next=5,Object(m.default)(s.path+"/cut",o);case 5:return c=e.sent,l=c.data,f=l.cutIndexes,h=l.geometries,p=void 0===h?[]:h,e.abrupt("return",{cutIndexes:f,geometries:p.map((function(e){var t=Object(x.a)(e);return t.spatialReference=u,t}))});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t,r){return w.apply(this,arguments)}function w(){return(w=Object(s.a)(a.a.mark((function e(t,r,n){var i,s,u,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="string"==typeof t?Object(g.J)(t):t,s=r[0].spatialReference,u=Object(x.c)(r[0]),o=Object(v.a)(Object(v.a)({},n),{},{query:Object(v.a)(Object(v.a)({},i.query),{},{f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(k(r))})}),e.t0=S,e.next=4,Object(m.default)(i.path+"/simplify",o);case 4:return e.t1=e.sent.data,e.t2=u,e.t3=s,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return{geometryType:Object(x.c)(e[0]),geometries:e.map((function(e){return e.toJSON()}))}}function S(e,t,r){var n=Object(x.b)(t);return e.map((function(e){var t=n.fromJSON(e);return t.spatialReference=r,t}))}var I=l.a.getLogger("esri.geometry.support.normalizeUtils");function F(e,t,r){if(t){var n=function(e,t){if(!(e instanceof p.a||e instanceof h.a)){var r="straightLineDensify: the input geometry is neither polyline nor polygon";throw I.error(r),new c.a(r)}var n,a=Object(d.b)(e),i=[],s=Object(u.a)(a);try{for(s.s();!(n=s.n()).done;){var o=n.value,l=[];i.push(l),l.push([o[0][0],o[0][1]]);for(var f=0;f<o.length-1;f++){var y=o[f][0],b=o[f][1],v=o[f+1][0],m=o[f+1][1],g=Math.sqrt((v-y)*(v-y)+(m-b)*(m-b)),x=(m-b)/g,j=(v-y)/g,O=g/t;if(O>1){for(var _=1;_<=O-1;_++){var w=_*t,k=j*w+y,S=x*w+b;l.push([k,S])}var F=(g+Math.floor(O-1)*t)/2,T=j*F+y,R=x*F+b;l.push([T,R])}l.push([v,m])}}}catch(N){s.e(N)}finally{s.f()}return function(e){return"polygon"===e.type}(e)?new h.a({rings:i,spatialReference:e.spatialReference}):new p.a({paths:i,spatialReference:e.spatialReference})}(e,1e6);e=Object(b.e)(n,!0)}return r&&(e=Object(d.e)(e,r)),e}function T(e,t,r){if(Array.isArray(e)){var n=e[0];if(n>t){var a=Object(d.d)(n,t);e[0]=n+a*(-2*t)}else if(n<r){var i=Object(d.d)(n,r);e[0]=n+i*(-2*r)}}else{var s=e.x;if(s>t){var u=Object(d.d)(s,t);e=e.clone().offset(u*(-2*t),0)}else if(s<r){var o=Object(d.d)(s,r);e=e.clone().offset(o*(-2*r),0)}}return e}function R(e,t){for(var r=-1,n=function(n){for(var a=t.cutIndexes[n],i=t.geometries[n],s=Object(d.b)(i),o=function(e){var t=s[e];t.some((function(r){if(r[0]<180)return!0;for(var n=0,a=0;a<t.length;a++){var s=t[a][0];n=s>n?s:n}n=Number(n.toFixed(9));for(var u=-360*Object(d.d)(n,180),o=0;o<t.length;o++){var c=i.getPoint(e,o);i.setPoint(e,o,c.clone().offset(u,0))}return!0}))},c=0;c<s.length;c++)o(c);if(a===r){if(function(e){return"polygon"===e[0].type}(e)){var l,f=Object(u.a)(Object(d.b)(i));try{for(f.s();!(l=f.n()).done;){var h=l.value;e[a]=e[a].addRing(h)}}catch(v){f.e(v)}finally{f.f()}}else if(function(e){return"polyline"===e[0].type}(e)){var p,y=Object(u.a)(Object(d.b)(i));try{for(y.s();!(p=y.n()).done;){var b=p.value;e[a]=e[a].addPath(b)}}catch(v){y.e(v)}finally{y.f()}}}else r=a,e[a]=i},a=0;a<t.cutIndexes.length;a++)n(a);return e}function N(e,t,r){return M.apply(this,arguments)}function M(){return(M=Object(s.a)(a.a.mark((function e(t,r,n){var i,s,c,l,v,m,g,x,O,w,k,S,I,M,E,P,A,C,z,V,G,Q,q,D,B,L,Z,U,Y,J,W,X,H,$,K,ee,te,re,ne,ae;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)){e.next=2;break}return e.abrupt("return",N([t],r));case 2:i=r?r.url:o.a.geometryServiceUrl,w=0,k=[],S=[],I=Object(u.a)(t);try{for(I.s();!(M=I.n()).done;)E=M.value,Object(f.i)(E)?S.push(E):(s||(s=E.spatialReference,c=Object(y.e)(s),l=s.isWebMercator,g=l?102100:4326,v=d.a[g].maxX,m=d.a[g].minX,x=d.a[g].plus180Line,O=d.a[g].minus180Line),c?"mesh"===E.type?S.push(E):"point"===E.type?S.push(T(E.clone(),v,m)):"multipoint"===E.type?((P=E.clone()).points=P.points.map((function(e){return T(e,v,m)})),S.push(P)):"extent"===E.type?(A=E.clone()._normalize(!1,!1,c),S.push(A.rings?new h.a(A):A)):E.extent?(C=E.extent,z=Object(d.d)(C.xmin,m)*(2*v),V=0===z?E.clone():Object(d.e)(E.clone(),z),C.offset(z,0),C.intersects(x)&&C.xmax!==v?(w=C.xmax>w?C.xmax:w,V=F(V,l),k.push(V),S.push("cut")):C.intersects(O)&&C.xmin!==m?(w=C.xmax*(2*v)>w?C.xmax*(2*v):w,V=F(V,l,360),k.push(V),S.push("cut")):S.push(V)):S.push(E.clone()):S.push(E))}catch(a){I.e(a)}finally{I.f()}for(G=Object(d.d)(w,v),Q=-90,q=G,D=new p.a;G>0;)B=360*G-180,D.addPath([[B,Q],[B,-1*Q]]),Q*=-1,G--;if(!(k.length>0&&q>0)){e.next=28;break}return e.t0=R,e.t1=k,e.next=15,j(i,k,D,n);case 15:for(e.t2=e.sent,L=(0,e.t0)(e.t1,e.t2),Z=[],U=[],Y=0;Y<S.length;Y++)"cut"!==(J=S[Y])?U.push(J):(W=L.shift(),X=t[Y],Object(f.j)(X)&&"polygon"===X.type&&X.rings&&X.rings.length>1&&W.rings.length>=X.rings.length?(Z.push(W),U.push("simplify")):U.push(l?Object(b.b)(W):W));if(Z.length){e.next=22;break}return e.abrupt("return",U);case 22:return e.next=24,_(i,Z,n);case 24:for(H=e.sent,$=[],K=0;K<U.length;K++)"simplify"!==(ee=U[K])?$.push(ee):$.push(l?Object(b.b)(H.shift()):H.shift());return e.abrupt("return",$);case 28:for(te=[],re=0;re<S.length;re++)"cut"!==(ne=S[re])?te.push(ne):(ae=k.shift(),te.push(!0===l?Object(b.b)(ae):ae));return e.abrupt("return",Promise.resolve(te));case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t){var r=Object(y.e)(t);if(r){var n=Object(i.a)(r.valid,2),a=n[0],s=n[1],u=s-a;if(e<a)for(;e<a;)e+=u;if(e>s)for(;e>s;)e-=u}return e}},708:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return c}));var n=r(22),a=r(21),i=r(2),s=r(4),u=r(297),o=function(){function e(t,r,n){Object(i.a)(this,e),this._namespace=t,this._storage=r,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",n&&(this._storage.registerRemoveFunc(this._namespace,n),this._removeFunc=!0)}return Object(s.a)(e,[{key:"destroy",value:function(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}},{key:"namespace",get:function(){return this._namespace.slice(0,-1)}},{key:"hitRate",get:function(){return this._hit/(this._hit+this._miss)}},{key:"size",get:function(){return this._storage.size}},{key:"maxSize",get:function(){return this._storage.maxSize}},{key:"resetHitRate",value:function(){this._hit=this._miss=0}},{key:"put",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._storage.put(this._namespace+e,t,r,n)}},{key:"get",value:function(e){var t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}},{key:"pop",value:function(e){var t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}},{key:"updateSize",value:function(e,t,r){this._storage.updateSize(this._namespace+e,t,r)}},{key:"clear",value:function(){this._storage.clear(this._namespace)}},{key:"clearAll",value:function(){this._storage.clearAll()}},{key:"getStats",value:function(){return this._storage.getStats()}},{key:"resetStats",value:function(){this._storage.resetStats()}}]),e}(),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10485760;Object(i.a)(this,e),this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new u.a,this._users=new u.a}return Object(s.a)(e,[{key:"destroy",value:function(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}},{key:"register",value:function(e){this._users.push(e)}},{key:"deregister",value:function(e){this._users.removeUnordered(e)}},{key:"registerRemoveFunc",value:function(e,t){this._removeFuncs.push([e,t])}},{key:"deregisterRemoveFunc",value:function(e){this._removeFuncs.filterInPlace((function(t){return t[0]!==e}))}},{key:"size",get:function(){return this._size}},{key:"maxSize",get:function(){return this._maxSize},set:function(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}},{key:"put",value:function(e,t,r,n){var a=this._db.get(e);if(a&&(this._size-=a.size,this._db.delete(e),a.entry!==t&&this._notifyRemoved(e,a.entry)),r>this._maxSize)this._notifyRemoved(e,t);else if(void 0!==t)if(!r||r<0)console.warn("Refusing to cache entry with invalid size "+r);else{var i=1+Math.max(n,-3)- -3;this._db.set(e,{entry:t,size:r,lifetime:i,lives:i}),this._size+=r,this._checkSizeLimit()}else console.warn("Refusing to cache undefined entry ")}},{key:"updateSize",value:function(e,t,r){var n=this._db.get(e);if(n&&n.entry===t){if(this._size-=n.size,r>this._maxSize)return this._db.delete(e),void this._notifyRemoved(e,t);n.size=r,this._size+=r,this._checkSizeLimit()}}},{key:"pop",value:function(e){var t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss}},{key:"get",value:function(e){var t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss}},{key:"getStats",value:function(){var e=this,t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},n=new Array;this._db.forEach((function(t,a){var i=t.lifetime;n[i]=(n[i]||0)+t.size,e._users.forAll((function(e){var n=e.namespace;if(a.startsWith(n)){var i=r[n]||0;r[n]=i+t.size}}))}));var a={};this._users.forAll((function(e){var t=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){var n=r[t]||0;r[t]=n,a[t]=Math.round(100*e.hitRate)+"%"}else a[t]="0%"}));var i=Object.keys(r);i.forEach((function(t){return r[t]=r[t]/e._size*100})),i.sort((function(e,t){return r[t]-r[e]})),i.forEach((function(e){return t[e]=Math.round(r[e])+"% / "+a[e]}));for(var s=n.length-1;s>=0;--s){var u=n[s];u&&(t["Priority "+(s+-3-1)]=Math.round(u/this.size*100)+"%")}return t}},{key:"resetStats",value:function(){this._hit=this._miss=0,this._users.forAll((function(e){return e.resetHitRate()}))}},{key:"clear",value:function(e){var t=this;this._db.forEach((function(r,n){n.startsWith(e)&&(t._size-=r.size,t._db.delete(n),t._notifyRemoved(n,r.entry))}))}},{key:"clearAll",value:function(){var e=this;this._db.forEach((function(t,r){return e._notifyRemoved(r,t.entry)})),this._size=0,this._db.clear()}},{key:"_getHitRate",value:function(){return this._hit/(this._hit+this._miss)}},{key:"_notifyRemoved",value:function(e,t){this._removeFuncs.forAll((function(r){e.startsWith(r[0])&&r[1](t)}))}},{key:"_checkSizeLimit",value:function(){if(!(this._size<=this._maxSize)){var e,t=Object(a.a)(this._db);try{for(t.s();!(e=t.n()).done;){var r=Object(n.a)(e.value,2),i=r[0],s=r[1];if(this._db.delete(i),s.lives<=1?(this._size-=s.size,this._notifyRemoved(i,s.entry)):(--s.lives,this._db.set(i,s)),this._size<=.9*this.maxSize)return}}catch(u){t.e(u)}finally{t.f()}}}}]),e}()},718:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return _})),r.d(t,"c",(function(){return S}));var n=r(7),a=r.n(n),i=r(2),s=r(4),u=r(12),o=r(21),c=r(22),l=r(11),f=r(750),h=r(770),p=r(53),d=r(71),y=[0,0];function b(e,t){if(!t)return null;if("x"in t){var r,n,a={x:0,y:0};return r=e(t.x,t.y,y),n=Object(c.a)(r,2),a.x=n[0],a.y=n[1],null!=t.z&&(a.z=t.z),null!=t.m&&(a.m=t.m),a}if("xmin"in t){var i,s,u,o,l={xmin:0,ymin:0,xmax:0,ymax:0};return i=e(t.xmin,t.ymin,y),s=Object(c.a)(i,2),l.xmin=s[0],l.ymin=s[1],u=e(t.xmax,t.ymax,y),o=Object(c.a)(u,2),l.xmax=o[0],l.ymax=o[1],t.hasZ&&(l.zmin=t.zmin,l.zmax=t.zmax,l.hasZ=!0),t.hasM&&(l.mmin=t.mmin,l.mmax=t.mmax,l.hasM=!0),l}return"rings"in t?{rings:v(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:v(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:m(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function v(e,t){var r,n=[],a=Object(o.a)(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;n.push(m(i,t))}}catch(s){a.e(s)}finally{a.f()}return n}function m(e,t){var r,n=[],a=Object(o.a)(e);try{for(a.s();!(r=a.n()).done;){var i=r.value,s=t(i[0],i[1],[0,0]);n.push(s),i.length>2&&s.push(i[2]),i.length>3&&s.push(i[3])}}catch(u){a.e(u)}finally{a.f()}return n}function g(e,t){return x.apply(this,arguments)}function x(){return(x=Object(u.a)(a.a.mark((function e(t,r){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:return n=Array.isArray(t)?t.map((function(e){return Object(l.j)(e.geometry)&&e.geometry.spatialReference})):[t],e.next=5,Object(f.d)(n.map((function(e){return{source:e,dest:r}})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var j=b.bind(null,d.c),O=b.bind(null,d.f);function _(e,t,r){return e?(r||(r=t,t=e.spatialReference),Object(p.l)(t)&&Object(p.l)(r)&&!Object(p.d)(t,r)?Object(d.a)(t,r)?Object(p.p)(r)?j(e):O(e):Object(f.j)(h.a,[e],t,r,null)[0]:e):e}var w=function(){function e(){Object(i.a)(this,e),this._jobs=[],this._timer=null,this._process=this._process.bind(this)}return Object(s.a)(e,[{key:"push",value:function(){var e=Object(u.a)(a.a.mark((function e(t,r,n){var i,s=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.length&&r&&n&&!Object(p.d)(r,n)){e.next=2;break}return e.abrupt("return",t);case 2:return i={geometries:t,inSpatialReference:r,outSpatialReference:n,resolve:null},e.abrupt("return",(this._jobs.push(i),new Promise((function(e){i.resolve=e,null===s._timer&&(s._timer=setTimeout(s._process,10))}))));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_process",value:function(){this._timer=null;var e=this._jobs.shift();if(e){var t=e.geometries,r=e.inSpatialReference,n=e.outSpatialReference,a=e.resolve;Object(d.a)(r,n)?Object(p.p)(n)?a(t.map(j)):a(t.map(O)):a(Object(f.j)(h.a,t,r,n,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}}]),e}(),k=new w;function S(e,t,r){return k.push(e,t,r)}},732:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return c}));var n=r(21),a=r(107),i=r(45),s=r(62),u={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new a.a({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:i.a.WebMercator}),minus180Line:new a.a({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:i.a.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new a.a({paths:[[[180,-180],[180,180]]],spatialReference:i.a.WGS84}),minus180Line:new a.a({paths:[[[-180,-180],[-180,180]]],spatialReference:i.a.WGS84})}};function o(e,t){return Math.ceil((e-t)/(2*t))}function c(e,t){var r,a=l(e),i=Object(n.a)(a);try{for(i.s();!(r=i.n()).done;){var s,u=r.value,o=Object(n.a)(u);try{for(o.s();!(s=o.n()).done;){s.value[0]+=t}}catch(c){o.e(c)}finally{o.f()}}}catch(c){i.e(c)}finally{i.f()}return e}function l(e){return Object(s.g)(e)?e.rings:e.paths}function f(e){var t=(null==e?void 0:e.isWebMercator)?102100:4326;return[u[t].minX,u[t].maxX]}},748:function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return M})),r.d(t,"c",(function(){return _})),r.d(t,"d",(function(){return w})),r.d(t,"e",(function(){return S})),r.d(t,"f",(function(){return O}));var n=r(7),a=r.n(n),i=r(12),s=r(42),u=r(11),o=r(135),c=r(245),l=r(62),f=r(696),h=r(53),p=(r(758),r(680)),d=r(681),y=r(718),b=new s.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),v=Object.freeze({}),m=new d.a,g=new d.a,x=new d.a,j={esriGeometryPoint:p.j,esriGeometryPolyline:p.l,esriGeometryPolygon:p.k,esriGeometryMultipoint:p.i};function O(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.hasZ,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.hasM;if(Object(u.i)(t))return null;var i=e.hasZ&&n,s=e.hasM&&a;if(r){var o=Object(p.r)(x,t,e.hasZ,e.hasM,"esriGeometryPoint",r,n,a);return Object(p.j)(o,i,s)}return Object(p.j)(t,i,s)}function _(e,t,r,n,a,i){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:r,c=t&&s,l=r&&o,f=Object(u.j)(n)?"coords"in n?n:n.geometry:null;if(Object(u.i)(f))return null;if(a){var h=Object(p.n)(g,f,t,r,e,a,s,o);return i&&(h=Object(p.r)(x,h,c,l,e,i)),j[e](h,c,l)}if(i){var d=Object(p.r)(x,f,t,r,e,i,s,o);return j[e](d,c,l)}return Object(p.u)(m,f,t,r,s,o),j[e](m,c,l)}function w(e,t,r){return k.apply(this,arguments)}function k(){return(k=Object(i.a)(a.a.mark((function e(t,r,n){var i,s,u,o,c,l,f,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.outFields,s=t.orderByFields,u=t.groupByFieldsForStatistics,o=t.outStatistics,i)for(c=0;c<i.length;c++)i[c]=i[c].trim();if(s)for(l=0;l<s.length;l++)s[l]=s[l].trim();if(u)for(f=0;f<u.length;f++)u[f]=u[f].trim();if(o)for(h=0;h<o.length;h++)o[h].onStatisticField&&(o[h].onStatisticField=o[h].onStatisticField.trim());return e.abrupt("return",(t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),S(t,r,n)));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t,r){return I.apply(this,arguments)}function I(){return(I=Object(i.a)(a.a.mark((function e(t,r,n){var i,s,o,h,p,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(i=t.where,t.where=i=i&&i.trim(),(!i||/^1 *= *1$/.test(i)||r&&r===i)&&(t.where=null),t.geometry){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,F(t);case 7:return s=e.sent,t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel&&(o=t.geometry.spatialReference,(s=Object(c.a)(s)).spatialReference=o),t.geometry=s,e.next=12,Object(y.a)(s.spatialReference,n);case 12:return e.next=14,Object(f.a)(Object(l.a)(s));case 14:if(h=e.sent[0],!Object(u.i)(h)){e.next=17;break}throw v;case 17:return p=h.toJSON(),e.next=20,Object(y.b)(p,p.spatialReference,n);case 20:if(d=e.sent){e.next=23;break}throw v;case 23:return e.abrupt("return",(d.spatialReference=n,t.geometry=d,t));case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return T.apply(this,arguments)}function T(){return(T=Object(i.a)(a.a.mark((function e(t){var r,n,i,s,u,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.geometry,n=t.distance,i=t.units,null!=n&&!("vertexAttributes"in r)){e.next=3;break}return e.abrupt("return",r);case 3:if(s=r.spatialReference,u=i?b.fromJSON(i):Object(o.f)(s),!s||!Object(h.h)(s)&&!Object(h.p)(s)){e.next=9;break}e.t0=r,e.next=12;break;case 9:return e.next=11,Object(y.a)(s,h.b).then((function(){return Object(y.b)(r,h.b)}));case 11:e.t0=e.sent;case 12:return c=e.t0,e.next=15,R();case 15:return e.t1=e.sent,e.abrupt("return",(0,e.t1)(c.spatialReference,c,n,u));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(){return N.apply(this,arguments)}function N(){return(N=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r.e(9),r.e(19)]).then(r.bind(null,828));case 2:return e.abrupt("return",e.sent.geodesicBuffer);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return e&&E in e?JSON.parse(JSON.stringify(e,P)):e}var E="_geVersion",P=function(e,t){return e!==E?t:void 0}},752:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},754:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return a}));var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof e?e:"undefined"!=typeof self?self:{};function a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function i(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}}).call(this,r(216))},758:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(21),a=r(11);function i(e,t){return e?t?4:3:t?3:2}function s(e,t,r,s,c){if(Object(a.i)(t)||!t.lengths.length)return null;var l="upperLeft"===(null==c?void 0:c.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);var f,h=e.coords,p=[],d=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],y=t.lengths,b=t.coords,v=i(r,s),m=0,g=Object(n.a)(y);try{for(g.s();!(f=g.n()).done;){var x=f.value,j=u(d,b,m,x,r,s,l);j&&p.push(j),m+=x*v}}catch(w){g.e(w)}finally{g.f()}if(p.sort((function(e,t){var n=l*e[2]-l*t[2];return 0===n&&r&&(n=e[4]-t[4]),n})),p.length){var O=6*p[0][2];h[0]=p[0][0]/O,h[1]=p[0][1]/O,r&&(O=6*p[0][4],h[2]=0!==O?p[0][3]/O:0),(h[0]<d[0]||h[0]>d[1]||h[1]<d[2]||h[1]>d[3]||r&&(h[2]<d[4]||h[2]>d[5]))&&(h.length=0)}if(!h.length){var _=t.lengths[0]?o(b,0,y[0],r,s):null;if(!_)return null;h[0]=_[0],h[1]=_[1],r&&_.length>2&&(h[2]=_[2])}return e}function u(e,t,r,n,a,s){for(var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,o=i(a,s),c=r,l=r+o,f=0,h=0,p=0,d=0,y=0,b=0,v=n-1;b<v;b++,c+=o,l+=o){var m=t[c],g=t[c+1],x=t[c+2],j=t[l],O=t[l+1],_=t[l+2],w=m*O-j*g;d+=w,f+=(m+j)*w,h+=(g+O)*w,a&&(p+=(x+_)*(w=m*_-j*x),y+=w),m<e[0]&&(e[0]=m),m>e[1]&&(e[1]=m),g<e[2]&&(e[2]=g),g>e[3]&&(e[3]=g),a&&(x<e[4]&&(e[4]=x),x>e[5]&&(e[5]=x))}if(d*u>0&&(d*=-1),y*u>0&&(y*=-1),!d)return null;var k=[f,h,.5*d];return a&&(k[3]=p,k[4]=.5*y),k}function o(e,t,r,n,a){for(var s=i(n,a),u=t,o=t+s,p=0,d=0,y=0,b=0,v=0,m=r-1;v<m;v++,u+=s,o+=s){var g=e[u],x=e[u+1],j=e[u+2],O=e[o],_=e[o+1],w=e[o+2],k=n?l(g,x,j,O,_,w):c(g,x,O,_);if(k)if(p+=k,n){var S=h(g,x,j,O,_,w);d+=k*S[0],y+=k*S[1],b+=k*S[2]}else{var I=f(g,x,O,_);d+=k*I[0],y+=k*I[1]}}return p>0?n?[d/p,y/p,b/p]:[d/p,y/p]:r>0?n?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function c(e,t,r,n){var a=r-e,i=n-t;return Math.sqrt(a*a+i*i)}function l(e,t,r,n,a,i){var s=n-e,u=a-t,o=i-r;return Math.sqrt(s*s+u*u+o*o)}function f(e,t,r,n){return[e+.5*(r-e),t+.5*(n-t)]}function h(e,t,r,n,a,i){return[e+.5*(n-e),t+.5*(a-t),r+.5*(i-r)]}},759:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return i})),r.d(t,"e",(function(){return o}));var n=r(21),a=r(23);r(29),r(11),r(209);function i(e){var t=null!=e.normalizationField||null!=e.normalizationType,r=null!=e.minValue||null!=e.maxValue,n=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!r&&!n}function s(e){var t=e.returnDistinct?Object(a.a)(new Set(e.values)):e.values,r=t.filter((function(e){return null!=e})).length,n={count:r};return e.supportsNullCount&&(n.nullcount=t.length-r),n}function u(e){var t,r=e.values,a=e.useSampleStdDev,i=e.supportsNullCount,s=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,o=null,c=null,l=null,f=null,h=0,p=null==e.minValue?-1/0:e.minValue,d=null==e.maxValue?1/0:e.maxValue,y=Object(n.a)(r);try{for(y.s();!(t=y.n()).done;){var b=t.value;Number.isFinite(b)?b>=p&&b<=d&&(o+=b,s=Math.min(s,b),u=Math.max(u,b),h++):"string"==typeof b&&h++}}catch(O){y.e(O)}finally{y.f()}if(h&&null!=o){c=o/h;var v,m=0,g=Object(n.a)(r);try{for(g.s();!(v=g.n()).done;){var x=v.value;Number.isFinite(x)&&x>=p&&x<=d&&(m+=Math.pow(x-c,2))}}catch(O){g.e(O)}finally{g.f()}f=a?h>1?m/(h-1):0:h>0?m/h:0,l=Math.sqrt(f)}else s=null,u=null;var j={avg:c,count:h,max:u,min:s,stddev:l,sum:o,variance:f};return i&&(j.nullcount=r.length-h),j}function o(e,t){return t?(["avg","stddev","variance"].forEach((function(t){null!=e[t]&&(e[t]=Math.ceil(e[t]))})),e):e}function c(e,t,r,n){var a=null;switch(t){case"log":0!==e&&(a=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(n)&&0!==n&&(a=e/n*100);break;case"field":Number.isFinite(r)&&0!==r&&(a=e/r);break;case"natural-log":e>0&&(a=Math.log(e));break;case"square-root":e>0&&(a=Math.pow(e,.5))}return a}},762:function(e,t,r){"use strict";function n(e,t){if(!e)return null;var r=t.featureAdapter,n=e.startTimeField,a=e.endTimeField,i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;if(n&&a)t.forEach((function(e){var t=r.getAttribute(e,n),u=r.getAttribute(e,a);null==t||isNaN(t)||(i=Math.min(i,t)),null==u||isNaN(u)||(s=Math.max(s,u))}));else{var u=n||a;t.forEach((function(e){var t=r.getAttribute(e,u);null==t||isNaN(t)||(i=Math.min(i,t),s=Math.max(s,t))}))}return{start:i,end:s}}function a(e,t,r){if(!t||!e)return null;var n=e.startTimeField,a=e.endTimeField;if(!n&&!a)return null;var i=t.start,s=t.end;return null===i&&null===s?null:void 0===i&&void 0===s?function(){return!1}:n&&a?function(e,t,r,n,a){return null!=n&&null!=a?function(i){var s=e.getAttribute(i,t),u=e.getAttribute(i,r);return(null==s||s<=a)&&(null==u||u>=n)}:null!=n?function(t){var a=e.getAttribute(t,r);return null==a||a>=n}:null!=a?function(r){var n=e.getAttribute(r,t);return null==n||n<=a}:void 0}(r,n,a,i,s):function(e,t,r,n){return null!=r&&null!=n&&r===n?function(n){return e.getAttribute(n,t)===r}:null!=r&&null!=n?function(a){var i=e.getAttribute(a,t);return i>=r&&i<=n}:null!=r?function(n){return e.getAttribute(n,t)>=r}:null!=n?function(r){return e.getAttribute(r,t)<=n}:void 0}(r,n||a,i,s)}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}))},770:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(2),a={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){var n=new i(e.getPointX(t),e.getPointY(t),r),a=e.hasZ(t),s=e.hasM(t);return a&&(n.z=e.getPointZ(t)),s&&(n.m=e.getPointM(t)),n},exportPolygon:function(e,t,r){return new s(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new u(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new o(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){var n=e.hasZ(t),a=e.hasM(t),i=new c(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(n){var s=e.getZExtent(t);i.zmin=s.vmin,i.zmax=s.vmax}if(a){var u=e.getMExtent(t);i.mmin=u.vmin,i.mmax=u.vmax}return i}};var i=function e(t,r,a){Object(n.a)(this,e),this.x=t,this.y=r,this.spatialReference=a,this.z=void 0,this.m=void 0};var s=function e(t,r,a,i){Object(n.a)(this,e),this.rings=t,this.spatialReference=r,this.hasZ=void 0,this.hasM=void 0,a&&(this.hasZ=a),i&&(this.hasM=i)};var u=function e(t,r,a,i){Object(n.a)(this,e),this.paths=t,this.spatialReference=r,this.hasZ=void 0,this.hasM=void 0,a&&(this.hasZ=a),i&&(this.hasM=i)};var o=function e(t,r,a,i){Object(n.a)(this,e),this.points=t,this.spatialReference=r,this.hasZ=void 0,this.hasM=void 0,a&&(this.hasZ=a),i&&(this.hasM=i)};var c=function e(t,r,a,i,s){Object(n.a)(this,e),this.xmin=t,this.ymin=r,this.xmax=a,this.ymax=i,this.spatialReference=s,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}},771:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(2),a=r(4),i=r(708),s=function(){function e(t,r){Object(n.a)(this,e),this._storage=new i.b,this._storage.maxSize=t,r&&this._storage.registerRemoveFunc("",r)}return Object(a.a)(e,[{key:"put",value:function(e,t){this._storage.put(e,t,1,1)}},{key:"pop",value:function(e){return this._storage.pop(e)}},{key:"get",value:function(e){return this._storage.get(e)}},{key:"clear",value:function(){this._storage.clearAll()}},{key:"destroy",value:function(){this._storage.destroy()}}]),e}()},775:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return y})),r.d(t,"e",(function(){return b}));var n=r(22),a=r(11);r(62);var i=function(e,t,r){return[t,r]},s=function(e,t,r){return[t,r,e[2]]},u=function(e,t,r){return[t,r,e[2],e[3]]};function o(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function c(e,t){var r=e.scale,n=e.translate;return t*r[0]+n[0]}function l(e,t){var r=e.scale;return e.translate[1]-t*r[1]}function f(e,t,r){var a=new Array(r.length);if(!r.length)return a;var i=Object(n.a)(e.scale,2),s=i[0],u=i[1],o=c(e,r[0][0]),f=l(e,r[0][1]);a[0]=t(r[0],o,f);for(var h=1;h<r.length;h++){var p=r[h];o+=p[0]*s,f-=p[1]*u,a[h]=t(p,o,f)}return a}function h(e,t,r){for(var n=new Array(r.length),a=0;a<r.length;a++)n[a]=f(e,t,r[a]);return n}function p(e,t,r,n,o){return Object(a.j)(r)&&(t.points=function(e,t,r,n){return f(e,r?n?u:s:n?s:i,t)}(e,r.points,n,o)),t}function d(e,t,r,n,i){return Object(a.i)(r)||(t.x=c(e,r.x),t.y=l(e,r.y),t!==r&&(n&&(t.z=r.z),i&&(t.m=r.m))),t}function y(e,t,r,n,o){return Object(a.j)(r)&&(t.rings=function(e,t,r,n){return h(e,r?n?u:s:n?s:i,t)}(e,r.rings,n,o)),t}function b(e,t,r,n,o){return Object(a.j)(r)&&(t.paths=function(e,t,r,n){return h(e,r?n?u:s:n?s:i,t)}(e,r.paths,n,o)),t}},794:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return O}));var n=r(7),a=r.n(n),i=r(21),s=r(12),u=r(2),o=r(4),c=r(29),l=r(15),f=r(11),h=r(30),p=r(53),d=r(680),y=r(831),b=r(718),v=r(809),m=r(813),g=r(894),x=r(954),j=r(672),O=function(){function e(){var t=this;Object(u.a)(this,e),this._queryEngine=null,this._customParameters=null,this._snapshotFeatures=function(){var e=Object(s.a)(a.a.mark((function e(r){var n,s,u,o,c,l,y,v,j,O,_;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._queryEngine.objectIdField,e.next=3,Object(x.d)(t._getFeatureUrl,t._featureType.typeName,t._getFeatureOutputFormat,{customParameters:t._customParameters,dateFields:t._queryEngine.fieldsIndex.dateFields.map((function(e){return e.name})),signal:r});case 3:return s=e.sent,e.next=6,Object(m.d)(s);case 6:if(Object(h.v)(r),u=Object(m.a)(s,{geometryType:t._queryEngine.geometryType,hasZ:!1,objectIdField:n}),!Object(p.d)(t._queryEngine.spatialReference,p.b)){o=Object(i.a)(u);try{for(o.s();!(c=o.n()).done;)l=c.value,Object(f.j)(l.geometry)&&(l.geometry=Object(d.d)(Object(b.b)(Object(d.h)(l.geometry,t._queryEngine.geometryType,!1,!1),p.b,t._queryEngine.spatialReference)))}catch(a){o.e(a)}finally{o.f()}}y=1,v=Object(i.a)(u);try{for(v.s();!(j=v.n()).done;)O=j.value,_={},Object(g.d)(t._fieldsIndex,_,O.attributes,null,!0),O.attributes=_,null==O.attributes[n]&&(O.objectId=O.attributes[n]=y++)}catch(a){v.e(a)}finally{v.f()}return e.abrupt("return",u);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}return Object(o.a)(e,[{key:"destroy",value:function(){var e;null==(e=this._queryEngine)||e.destroy(),this._queryEngine=null}},{key:"load",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r){var n,i,s,u,o,c,l,p,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getFeatureUrl,i=t.getFeatureOutputFormat,s=t.spatialReference,u=t.fields,o=t.geometryType,c=t.featureType,l=t.objectIdField,p=t.customParameters,this._featureType=c,this._customParameters=p,this._getFeatureUrl=n,this._getFeatureOutputFormat=i,this._fieldsIndex=new j.a(u),e.next=8,this._checkProjection(s);case 8:return Object(h.v)(r),this._queryEngine=new v.a({fields:u,geometryType:o,hasM:!1,hasZ:!1,objectIdField:l,spatialReference:s,timeInfo:null,featureStore:new y.a({geometryType:o,hasM:!1,hasZ:!1})}),e.next=12,this._snapshotFeatures(Object(f.q)(r.signal));case 12:return d=e.sent,e.abrupt("return",(this._queryEngine.featureStore.addMany(d),{extent:this._queryEngine.fullExtent}));case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"applyEdits",value:function(){var e=Object(s.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new c.a("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,r,n=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1&&void 0!==n[1]?n[1]:{},e.next=4,this._waitSnapshotComplete();case 4:return e.abrupt("return",this._queryEngine.executeQuery(t,r.signal));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,r,n=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1&&void 0!==n[1]?n[1]:{},e.next=4,this._waitSnapshotComplete();case 4:return e.abrupt("return",this._queryEngine.executeQueryForCount(t,r.signal));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"queryObjectIds",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,r,n=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1&&void 0!==n[1]?n[1]:{},e.next=4,this._waitSnapshotComplete();case 4:return e.abrupt("return",this._queryEngine.executeQueryForIds(t,r.signal));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"queryExtent",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,r,n=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1&&void 0!==n[1]?n[1]:{},e.next=4,this._waitSnapshotComplete();case 4:return e.abrupt("return",this._queryEngine.executeQueryForExtent(t,r.signal));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"querySnapping",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:{},e.next=3,this._waitSnapshotComplete();case 3:return e.abrupt("return",this._queryEngine.executeQueryForSnapping(t,r.signal));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setCustomParameters",value:function(e){this._customParameters=e}},{key:"refresh",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,r=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==(t=this._snapshotTask)||t.abort(),this._snapshotTask=Object(h.h)(this._snapshotFeatures),this._snapshotTask.promise.then((function(e){r._queryEngine.featureStore.clear(),e&&r._queryEngine.featureStore.addMany(e)}),(function(e){r._queryEngine.featureStore.clear(),Object(h.m)(e)||l.a.getLogger("esri.layers.WFSLayer").error(new c.a("wfs-layer:getfeature-error","An error occurred during the GetFeature request",{error:e}))})),e.next=5,this._waitSnapshotComplete();case 5:return e.abrupt("return",{extent:this._queryEngine.fullExtent});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_waitSnapshotComplete",value:function(){var e=Object(s.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._snapshotTask||this._snapshotTask.finished){e.next=9;break}return e.prev=1,e.next=4,this._snapshotTask.promise;case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:return e.abrupt("return",this._waitSnapshotComplete());case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"_checkProjection",value:function(){var e=Object(s.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(b.a)(p.b,t);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new c.a("unsupported-projection","Projection not supported",{spatialReference:t});case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()}]),e}()},802:function(e,t,r){"use strict";r.d(t,"a",(function(){return R})),r.d(t,"b",(function(){return F})),r.d(t,"c",(function(){return I}));var n=r(7),a=r.n(n),i=r(21),s=r(12),u=r(29),o=r(101),c=r(235);var l=r(62),f=r(53);function h(e,t){return e?t?4:3:t?3:2}function p(e,t,r,n,a){if(!e)return!1;var s,u=h(t,r),o=e.coords,c=e.lengths,l=!1,f=0,p=Object(i.a)(c);try{for(p.s();!(s=p.n()).done;){var y=s.value;l=d(l,o,u,f,y,n,a),f+=y*u}}catch(b){p.e(b)}finally{p.f()}return l}function d(e,t,r,n,a,i,s){for(var u=e,o=n,c=n,l=n+a*r;c<l;c+=r){(o=c+r)===l&&(o=n);var f=t[c],h=t[c+1],p=t[o],d=t[o+1];(h<s&&d>=s||d<s&&h>=s)&&f+(s-h)/(d-h)*(p-f)<i&&(u=!u)}return u}var y=r(680),b=r(681),v=r(718),m=r(748),g="feature-store:unsupported-query",x={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},j={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},O={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},_={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function w(e){return!0===j[e]}function k(e){return!0===O[Object(l.c)(e)]}function S(e){return!0===_[e]}function I(e,t,n,a,i){if(Object(l.g)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var s=Object(y.e)(new b.a,t,!1,!1);return Promise.resolve((function(e){return function(e,t,r,n){return p(e,t,r,n.coords[0],n.coords[1])}(s,!1,!1,e)}))}if(Object(l.g)(t)&&"esriGeometryMultipoint"===n){var u=Object(y.e)(new b.a,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((function(e){return function(e,t,r,n,a,i){var s=h(a,i),u=n.coords,o=n.lengths;if(!o)return!1;for(var c=0,l=0;c<o.length;c++,l+=s)if(!p(e,t,r,u[l],u[l+1]))return!1;return!0}(u,!1,!1,e,a,i)}))}if(Object(l.d)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((function(e){return Object(o.e)(t,Object(m.c)(n,a,i,e))}));if(Object(l.d)(t)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===e)return Promise.resolve((function(e){return Object(o.d)(t,Object(m.c)(n,a,i,e))}));if(Object(l.d)(t)&&"esriSpatialRelIntersects"===e){var f=function(e){return"mesh"===e?c.a:Object(c.b)(e)}(n);return Promise.resolve((function(e){return f(t,Object(m.c)(n,a,i,e))}))}return Promise.all([r.e(9),r.e(19)]).then(r.bind(null,828)).then((function(r){var s=r[x[e]].bind(null,t.spatialReference,t);return function(e){return s(Object(m.c)(n,a,i,e))}}))}function F(e,t,r){return T.apply(this,arguments)}function T(){return(T=Object(s.a)(a.a.mark((function e(t,r,n){var i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.spatialRel,!(s=t.geometry)){e.next=11;break}if(w(i)){e.next=4;break}throw new u.a(g,"Unsupported query spatial relationship",{query:t});case 4:if(!Object(f.l)(s.spatialReference)||!Object(f.l)(n)){e.next=11;break}if(k(s)){e.next=7;break}throw new u.a(g,"Unsupported query geometry type",{query:t});case 7:if(S(r)){e.next=9;break}throw new u.a(g,"Unsupported layer geometry type",{query:t});case 9:if(!t.outSR){e.next=11;break}return e.abrupt("return",Object(v.a)(t.geometry&&t.geometry.spatialReference,t.outSR));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){if(Object(l.d)(e))return!0;if(Object(l.g)(e)){var t,r=Object(i.a)(e.rings);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(5!==n.length)return!1;if(n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1}}catch(a){r.e(a)}finally{r.f()}return!0}return!1}},809:function(e,t,r){"use strict";r.d(t,"a",(function(){return ae}));var n=r(13),a=r(21),i=r(7),s=r.n(i),u=r(12),o=r(4),c=r(2),l=r(29),f=r(18),h=r(11),p=r(708),d=r(135),y=r(240),b=r(333),v=r(244),m=r(62),g=r(696),x=r(53),j=r(23),O=r(771),_=r(736),w=new(function(){function e(t,r){Object(c.a)(this,e),this._cache=new O.a(t),this._invalidCache=new O.a(r)}return Object(o.a)(e,[{key:"get",value:function(e,t){var r="".concat(t.uid,":").concat(e),n=this._cache.get(r);if(n)return n;if(void 0!==this._invalidCache.get(r))return null;try{var a=_.WhereClause.create(e,t);return this._cache.put(r,a),a}catch(i){return this._invalidCache.put(r,null),null}}}]),e}())(50,500),k="feature-store:unsupported-query",S=" as ",I=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function F(e,t,r){if(!t)return!0;var n=w.get(t,e);if(!n)throw new l.a(k,"invalid SQL expression",{having:t});if(!n.isAggregate)throw new l.a(k,"having does not contain a valid aggregate function",{having:t});var a=n.fieldNames;if(R(e,a,"having contains missing fields"),!n.getExpressions().every((function(t){var n=t.aggregateType,a=t.field,i=e.has(a)&&e.get(a).name;return r.some((function(t){var r=t.onStatisticField,a=t.statisticType;return(e.has(r)&&e.get(r).name)===i&&a.toLowerCase().trim()===n}))})))throw new l.a(k,"expressions in having should also exist in outStatistics",{having:t});return!0}function T(e,t){return e?w.get(e,t):null}function R(e,t,r){var n,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=[],u=Object(a.a)(t);try{for(u.s();!(n=u.n()).done;){var o=n.value;if("*"!==o&&!e.has(o))if(i){var c=N(o);try{var f=T(c,e);if(!f)throw new l.a(k,"invalid SQL expression",{where:c});if(!f.isStandardized)throw new l.a(k,"expression is not standard",{clause:f});R(e,f.fieldNames,"expression contains missing fields")}catch(p){var h=p&&p.details;if(h&&(h.clause||h.where))throw p;h&&h.missingFields?s.push.apply(s,Object(j.a)(h.missingFields)):s.push(o)}}else s.push(o)}}catch(d){u.e(d)}finally{u.f()}if(s.length)throw new l.a(k,r,{missingFields:s})}function N(e){return e.split(S)[0]}function M(e,t){var r=t.get(e);return!!r&&!I.has(r.type)}var E=r(718),P=r(752),A=r(775),C=r(680),z=r(759),V=function(){function e(t,r,n){Object(c.a)(this,e),this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues,this.fieldsIndex=n,this.featureAdapter=r;var i=t.outFields;if(i&&-1===i.indexOf("*")){this.outFields=i;var s,u=0,o=Object(a.a)(i);try{for(o.s();!(s=o.n()).done;){var l=s.value,f=N(l),h=this.fieldsIndex.get(f),p=h?null:T(f,n),d=h?h.name:l.split(S)[1]||"FIELD_EXP_"+u++;this._fieldDataCache.set(l,{alias:d,clause:p})}}catch(y){o.e(y)}finally{o.f()}}}return Object(o.a)(e,[{key:"countDistinctValues",value:function(e){var t=this;return this.returnDistinctValues?(e.forEach((function(e){return t.getAttributes(e)})),this._returnDistinctMap.size):e.length}},{key:"getAttributes",value:function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}},{key:"getFieldValue",value:function(e,t,r){var n=r?r.name:t,a=null;return this._fieldDataCache.has(n)?a=this._fieldDataCache.get(n).clause:r||(a=T(t,this.fieldsIndex),this._fieldDataCache.set(n,{alias:n,clause:a})),r?this.featureAdapter.getAttribute(e,n):a.calculateValue(e,this.featureAdapter)}},{key:"getNormalizedValue",value:function(e,t){var r=t.normalizationType,n=t.normalizationTotal,a=this.getFieldValue(e,t.field,t.fieldInfo);if(r&&Number.isFinite(a)){var i=this.getFieldValue(e,t.normalizationField,t.normalizationFieldInfo);a=Object(z.c)(a,r,i,n)}return a}},{key:"getExpressionValue",value:function(e,t,r){var n={attributes:this.featureAdapter.getAttributes(e)},a=r.createExecContext(n,t.viewInfo);return r.executeFunction(t.compiledFunc,a)}},{key:"validateItem",value:function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:T(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)}},{key:"validateItems",value:function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:T(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)}},{key:"_processAttributesForOutFields",value:function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);var r,n={},i=Object(a.a)(t);try{for(i.s();!(r=i.n()).done;){var s=r.value,u=this._fieldDataCache.get(s),o=u.alias,c=u.clause;n[o]=c?c.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,o)}}catch(l){i.e(l)}finally{i.f()}return n}},{key:"_processAttributesForDistinctValues",value:function(e){if(Object(h.i)(e)||!this.returnDistinctValues)return e;var t=this.outFields,r=[];if(t){var n,i=Object(a.a)(t);try{for(i.s();!(n=i.n()).done;){var s=n.value,u=this._fieldDataCache.get(s).alias;r.push(e[u])}}catch(f){i.e(f)}finally{i.f()}}else for(var o in e)r.push(e[o]);var c="".concat((t||["*"]).join(","),"=").concat(r.join(",")),l=this._returnDistinctMap.get(c)||0;return this._returnDistinctMap.set(c,++l),l>1?null:e}}]),e}(),G=r(762),Q=r(748),q=r(209),D=r(237);function B(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function L(e,t,r){return(r?e>t:e<t)?-1:(r?e<t:e>t)?1:0}function Z(e,t,r){return r?t-e:e-t}function U(e,t,r,n){if(r&&"esriFieldTypeDate"===r.type){var a=new Date(e).getTime(),i=new Date(t).getTime();if(!isNaN(a)&&!isNaN(i))return Z(a,i,n)}if("number"==typeof e&&"number"==typeof t)return Z(e,t,n);if("string"==typeof e&&"string"==typeof t){var s=e.toUpperCase(),u=t.toUpperCase();return!r||"esriFieldTypeGUID"!==r.type&&"esriFieldTypeGlobalID"!==r.type?L(s,u,n):L(B(s),B(u),n)}return n?1:-1}var Y=function(){function e(t,r,n){Object(c.a)(this,e),this.items=t,this.queryGeometry=r,this.definitionExpression=n.definitionExpression,this.geometryType=n.geometryType,this.hasM=n.hasM,this.hasZ=n.hasZ,this.objectIdField=n.objectIdField,this.spatialReference=n.spatialReference,this.fieldsIndex=n.fieldsIndex,this.timeInfo=n.timeInfo,this.featureAdapter=n.featureAdapter,this.aggregateAdapter=n.aggregateAdapter}return Object(o.a)(e,[{key:"size",get:function(){return this.items.length}},{key:"createQueryResponseForCount",value:function(e){var t=new V(e,this.featureAdapter,this.fieldsIndex);if(!e.outStatistics)return t.countDistinctValues(this.items);var r=e.groupByFieldsForStatistics,n=e.having;if(!(null==r?void 0:r.length))return 1;var i,s=new Map,u=new Map,o=new Set,c=e.outStatistics,l=Object(a.a)(c);try{for(l.s();!(i=l.n()).done;){var f=i.value,h="exceedslimit"!==f.statisticType?f.onStatisticField:void 0;if(!u.has(h)){var p,d=[],y=Object(a.a)(r);try{for(y.s();!(p=y.n()).done;){var b=p.value,v=this._getAttributeValues(t,b,s);d.push(v)}}catch(w){y.e(w)}finally{y.f()}u.set(h,this._calculateUniqueValues(d,t.returnDistinctValues))}var m=u.get(h);for(var g in m){var x=m[g],j=x.data,O=x.items,_=j.join(",");n&&!t.validateItems(O,n)||o.add(_)}}}catch(w){l.e(w)}finally{l.f()}return o.size}},{key:"createQueryResponse",value:function(e){var t;return t=e.outStatistics?e.outStatistics.some((function(e){return"exceedslimit"===e.statisticType}))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(Object(x.l)(e.outSR)&&!Object(x.d)(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=Object(Q.b)(Object(n.a)({spatialReference:e.outSR},Object(E.b)(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=Object(Q.b)(Object(n.a)({spatialReference:e.outSR},this.queryGeometry))),t}},{key:"createSnappingResponse",value:function(e,t){var r,n=this.featureAdapter,i=function(e,t){return e?t?4:3:t?3:2}(this.hasZ,this.hasM),s=e.point,u=s.x,o=s.y,c="number"==typeof e.distance?e.distance:e.distance.x,l="number"==typeof e.distance?e.distance:e.distance.y,f={candidates:[]},p="esriGeometryPolygon"===this.geometryType,d=this.getPointCreator(e.point,this.spatialReference,t),y=Object(a.a)(this.items);try{for(y.s();!(r=y.n()).done;){var b=r.value,v=n.getGeometry(b);if(!Object(h.i)(v)){var m=v.coords,g=v.lengths;if(1&e.types)for(var x=0,j=0;j<g.length;j++)for(var O=g[j],_=0;_<O;_++,x+=i){var w=m[x],k=m[x+1];if(_!==O-1){var S=m[x+i],I=m[x+i+1],F=J(u,o,w,k,S,I),T=F.x,R=F.y,N=(u-T)/c,M=(o-R)/l,E=N*N+M*M;E<=1&&f.candidates.push({type:"edge",objectId:n.getObjectId(b),distance:Math.sqrt(E),target:d(T,R),start:d(w,k),end:d(S,I)})}}if(2&e.types)for(var P=p?m.length-i:m.length,A=0;A<P;A+=i){var C=m[A],z=m[A+1],V=(u-C)/c,G=(o-z)/l,Q=V*V+G*G;Q<=1&&f.candidates.push({type:"vertex",objectId:n.getObjectId(b),distance:Math.sqrt(Q),target:d(C,z)})}}}}catch(q){y.e(q)}finally{y.f()}return f.candidates.sort((function(e,t){return e.distance-t.distance})),f}},{key:"getPointCreator",value:function(e,t,r){var n=Object(h.j)(r)&&!Object(x.d)(t,r)?function(e){return Object(E.b)(e,t,r)}:function(e){return e};return null!=e.z&&null!=e.m?function(t,r){return n({x:t,y:r,z:e.z,m:e.m})}:null!=e.z?function(t,r){return n({x:t,y:r,z:e.z})}:null!=e.m?function(t,r){return n({x:t,y:r,m:e.m})}:function(e,t){return n({x:e,y:t})}}},{key:"executeAttributesQuery",value:function(t){var r=T(t.where,this.fieldsIndex);if(!r)return Promise.resolve(this);if(r.isStandardized){var n,i=0,s=[],u=Object(a.a)(this.items);try{for(u.s();!(n=u.n()).done;){var o=n.value;r.testFeature(o,this.featureAdapter)&&(s[i++]=o)}}catch(l){u.e(l)}finally{u.f()}var c=new e(s,this.queryGeometry,this);return c.definitionExpression=t.where,Promise.resolve(c)}return Promise.reject(new TypeError("Where clause is not standardized"))}},{key:"executeAggregateIdsQuery",value:function(t){if(!t.aggregateIds||!t.aggregateIds.length||Object(h.i)(this.aggregateAdapter))return Promise.resolve(this);var r,n=new Set,i=Object(a.a)(t.aggregateIds);try{for(i.s();!(r=i.n()).done;){var s=r.value;this.aggregateAdapter.getFeatureObjectIds(s).forEach((function(e){return n.add(e)}))}}catch(o){i.e(o)}finally{i.f()}var u=this.featureAdapter.getObjectId;return Promise.resolve(new e(this.items.filter((function(e){return n.has(u(e))})),this.queryGeometry,this))}},{key:"executeObjectIdsQuery",value:function(t){if(!t.objectIds||!t.objectIds.length)return Promise.resolve(this);var r=new Set(t.objectIds),n=this.featureAdapter.getObjectId;return Promise.resolve(new e(this.items.filter((function(e){return r.has(n(e))})),this.queryGeometry,this))}},{key:"executeTimeQuery",value:function(t){var r=Object(G.b)(this.timeInfo,t.timeExtent,this.featureAdapter);if(!Object(h.j)(r))return Promise.resolve(this);var n=this.items.filter(r);return Promise.resolve(new e(n,this.queryGeometry,this))}},{key:"filterLatest",value:function(){var t,r=this.timeInfo,n=r.trackIdField,i=r.startTimeField,s=r.endTimeField||i,u=new Map,o=this.featureAdapter.getAttribute,c=Object(a.a)(this.items);try{for(c.s();!(t=c.n()).done;){var l=t.value,f=o(l,n),h=o(l,s),p=u.get(f);(!p||h>o(p,s))&&u.set(f,l)}}catch(y){c.e(y)}finally{c.f()}var d=Array.from(u.values());return Promise.resolve(new e(d,this.queryGeometry,this))}},{key:"project",value:function(){var t=Object(u.a)(s.a.mark((function t(r){var n,a,i=this;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&!Object(x.d)(this.spatialReference,r)){t.next=2;break}return t.abrupt("return",this);case 2:return n=this.featureAdapter,t.next=5,Object(E.c)(this.items.map((function(e){return Object(Q.c)(i.geometryType,i.hasZ,i.hasM,n.getGeometry(e))})),this.spatialReference,r);case 5:return a=t.sent.map((function(e,t){return n.cloneWithGeometry(i.items[t],Object(C.d)(e,i.hasZ,i.hasM))})),t.abrupt("return",new e(a,this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:r,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter}));case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"createSummaryStatisticsResponse",value:function(){var e=Object(u.a)(s.a.mark((function e(t,r){var n,a,i,u,o,c,l,f,h,p,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.field,a=r.normalizationField,i=r.normalizationType,u=r.normalizationTotal,o=r.minValue,c=r.maxValue,l=new V(t,this.featureAdapter,this.fieldsIndex),f=this.fieldsIndex.isDateField(n),!r.valueExpression){e.next=14;break}return e.next=11,this._getAttributeExpressionValues(l,r.valueExpression,r.viewInfoParams);case 11:e.t0=e.sent,e.next=15;break;case 14:e.t0=this._getAttributeNormalizedValues(l,{field:n,normalizationField:a,normalizationType:i,normalizationTotal:u});case 15:return h=e.t0,p=Object(z.d)({normalizationType:i,normalizationField:a,minValue:o,maxValue:c}),d=Object(q.j)(this.fieldsIndex.get(n))?Object(z.b)({values:h,supportsNullCount:p}):Object(z.a)({values:h,minValue:o,maxValue:c,useSampleStdDev:!i,supportsNullCount:p}),e.abrupt("return",Object(z.e)(d,f));case 19:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_sortFeatures",value:function(e,t,r){var n=this;if(e.length>1&&t&&t.length){var i,s=Object(a.a)(t.reverse());try{var u=function(){var t=i.value.split(" "),a=t[0],s=n.fieldsIndex.get(a),u=t[1]&&"desc"===t[1].toLowerCase();e.sort((function(e,t){return U(r(e,a,s),r(t,a,s),s,u)}))};for(s.s();!(i=s.n()).done;)u()}catch(o){s.e(o)}finally{s.f()}}}},{key:"_createFeatureQueryResponse",value:function(e){var t=this,r=this.items,n=this.geometryType,a=this.hasM,i=this.hasZ,s=this.objectIdField,u=this.spatialReference,o=e.outFields,c=e.outSR,l=e.quantizationParameters,f=e.resultRecordCount,h=e.resultOffset,p=e.returnZ,d=e.returnM,y=null!=f&&r.length>(h||0)+f,b=o&&(o.indexOf("*")>-1?Object(j.a)(this.fieldsIndex.fields):o.map((function(e){return t.fieldsIndex.get(e)})));return{exceededTransferLimit:y,features:this._createFeatures(e,r),fields:b,geometryType:n,hasM:a&&d,hasZ:i&&p,objectIdFieldName:s,spatialReference:Object(Q.b)(c||u),transform:l&&Object(A.a)(l)||null}}},{key:"_createFeatures",value:function(e,t){var r=new V(e,this.featureAdapter,this.fieldsIndex),n=this.hasM,i=this.hasZ,s=e.orderByFields,u=e.quantizationParameters,o=e.returnGeometry,c=e.returnCentroid,l=e.maxAllowableOffset,f=e.resultOffset,h=e.resultRecordCount,p=e.returnZ,d=void 0!==p&&p,y=e.returnM,b=i&&d,v=n&&(void 0!==y&&y),m=[],g=0,x=Object(j.a)(t);if(this._sortFeatures(x,s,(function(e,t,n){return r.getFieldValue(e,t,n)})),o||c){var O=Object(A.a)(u);if(o&&!c){var _,w=Object(a.a)(x);try{for(w.s();!(_=w.n()).done;){var k=_.value;m[g++]={attributes:r.getAttributes(k),geometry:Object(Q.c)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(k),l,O,b,v)}}}catch(q){w.e(q)}finally{w.f()}}else if(!o&&c){var S,I=Object(a.a)(x);try{for(I.s();!(S=I.n()).done;){var F=S.value;m[g++]={attributes:r.getAttributes(F),centroid:Object(Q.f)(this,this.featureAdapter.getCentroid(F,this),O)}}}catch(q){I.e(q)}finally{I.f()}}else{var T,R=Object(a.a)(x);try{for(R.s();!(T=R.n()).done;){var N=T.value;m[g++]={attributes:r.getAttributes(N),centroid:Object(Q.f)(this,this.featureAdapter.getCentroid(N,this),O),geometry:Object(Q.c)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(N),l,O,b,v)}}}catch(q){R.e(q)}finally{R.f()}}}else{var M,E=Object(a.a)(x);try{for(E.s();!(M=E.n()).done;){var P=M.value,C=r.getAttributes(P);C&&(m[g++]={attributes:C})}}catch(q){E.e(q)}finally{E.f()}}var z=f||0;if(null!=h){var G=z+h;m=m.slice(z,Math.min(m.length,G))}return m}},{key:"_createExceedsLimitQueryResponse",value:function(e){var t,r=!1,n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,u=Object(a.a)(e.outStatistics);try{for(u.s();!(t=u.n()).done;){var o=t.value;if("exceedslimit"===o.statisticType){n=null!=o.maxPointCount?o.maxPointCount:Number.POSITIVE_INFINITY,i=null!=o.maxRecordCount?o.maxRecordCount:Number.POSITIVE_INFINITY,s=null!=o.maxVertexCount?o.maxVertexCount:Number.POSITIVE_INFINITY;break}}}catch(f){u.e(f)}finally{u.f()}if("esriGeometryPoint"===this.geometryType)r=this.items.length>n;else if(this.items.length>i)r=!0;else{var c=this.hasZ?this.hasM?4:3:this.hasM?3:2,l=this.featureAdapter;r=this.items.reduce((function(e,t){var r=l.getGeometry(t);return e+(Object(h.j)(r)&&r.coords.length||0)}),0)/c>s}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(r)}}]}}},{key:"_createStatisticsQueryResponse",value:function(e){var t,r=this,n={attributes:{}},i=[],s=new Map,u=new Map,o=new Map,c=new Map,l=new V(e,this.featureAdapter,this.fieldsIndex),f=e.outStatistics,h=e.groupByFieldsForStatistics,p=e.having,d=e.orderByFields,y=h&&h.length,b=!!y,v=b&&h[0],m=b&&!this.fieldsIndex.get(v),g=Object(a.a)(f);try{for(g.s();!(t=g.n()).done;){var x=t.value,j=x.outStatisticFieldName,O=x.statisticType,_=x,w="exceedslimit"!==O?x.onStatisticField:void 0,k="percentile_disc"===O||"percentile_cont"===O,S=b&&1===y&&(w===v||m)&&"count"===O;if(b){if(!o.has(w)){var I,F=[],T=Object(a.a)(h);try{for(T.s();!(I=T.n()).done;){var R=I.value,N=this._getAttributeValues(l,R,s);F.push(N)}}catch(z){T.e(z)}finally{T.f()}o.set(w,this._calculateUniqueValues(F,l.returnDistinctValues))}var M=o.get(w),E=function(e){var t=M[e],n=t.count,a=t.data,i=t.items,u=t.itemPositions,o=a.join(",");if(!p||l.validateItems(i,p)){var f=c.get(o)||{attributes:{}},d=null;if(S)d=n;else{var y=r._getAttributeValues(l,w,s),b=u.map((function(e){return y[e]}));d=k&&"statisticParameters"in _?r._getPercentileValue(_,b):r._getStatisticValue(_,b,null,l.returnDistinctValues)}f.attributes[j]=d,h.forEach((function(e,t){return f.attributes[r.fieldsIndex.get(e)?e:"EXPR_".concat(t+1)]=a[t]})),c.set(o,f)}};for(var P in M)E(P)}else{var A=this._getAttributeValues(l,w,s);n.attributes[j]=k&&"statisticParameters"in _?this._getPercentileValue(_,A):this._getStatisticValue(_,A,u,l.returnDistinctValues)}i.push({name:j,alias:j,type:"esriFieldTypeDouble"})}}catch(z){g.e(z)}finally{g.f()}var C=b?Array.from(c.values()):[n];return this._sortFeatures(C,d,(function(e,t){return e.attributes[t]})),{fields:i,features:C}}},{key:"_getStatisticValue",value:function(e,t,r,n){var a,i=e.onStatisticField,s=e.statisticType;return a=null!=r&&r.has(i)?r.get(i):Object(q.j)(this.fieldsIndex.get(i))?Object(z.b)({values:t,returnDistinct:n}):Object(z.a)({values:t,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(i,a),a["var"===s?"variance":s]}},{key:"_getPercentileValue",value:function(e,t){var r=e.onStatisticField,n=e.statisticParameters,a=e.statisticType,i=n.value,s="desc"===n.orderBy,u=this.fieldsIndex.get(r),o=Object(j.a)(t).filter((function(e){return null!=e})).sort((function(e,t){return U(e,t,u,s)}));return this._calculatePercentile(o,i,"percentile_disc"===a)}},{key:"_getAttributeValues",value:function(e,t,r){if(r.has(t))return r.get(t);var n=this.fieldsIndex.get(t),a=this.items.map((function(r){return e.getFieldValue(r,t,n)}));return r.set(t,a),a}},{key:"_getAttributeNormalizedValues",value:function(e,t){var r=this;return this.items.map((function(n){return e.getNormalizedValue(n,{field:t.field,fieldInfo:r.fieldsIndex.get(t.field),normalizationField:t.normalizationField,normalizationFieldInfo:r.fieldsIndex.get(t.normalizationField),normalizationType:t.normalizationType,normalizationTotal:t.normalizationTotal})}))}},{key:"_getAttributeExpressionValues",value:function(){var e=Object(u.a)(s.a.mark((function e(t,r,n){var a,i,u,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(D.e)();case 2:return a=e.sent,i=a.arcadeUtils,u=i.createFunction(r),o=n&&i.getViewInfo(n),e.abrupt("return",this.items.map((function(e){return t.getExpressionValue(e,{compiledFunc:u,viewInfo:o},i)})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_calculateUniqueValues",value:function(e,t){for(var r={},n=this.items,i=n.length,s=0;s<i;s++){var u,o=n[s],c=[],l=Object(a.a)(e);try{for(l.s();!(u=l.n()).done;){var f=u.value;c.push(f[s])}}catch(p){l.e(p)}finally{l.f()}var h=c.join(",");t?null==r[h]&&(r[h]={count:1,data:c,items:[o],itemPositions:[s]}):null==r[h]?r[h]={count:1,data:c,items:[o],itemPositions:[s]}:(r[h].count++,r[h].items.push(o),r[h].itemPositions.push(s))}return r}},{key:"_calculatePercentile",value:function(e,t,r){if(0===e.length)return null;if(t<=0)return e[0];if(t>=1)return e[e.length-1];var n=(e.length-1)*t,a=Math.floor(n),i=a+1,s=n%1,u=e[a],o=e[i];return i>=e.length||r||"string"==typeof u||"string"==typeof o?u:u*(1-s)+o*s}}]),e}();function J(e,t,r,n,a,i){var s=a-r,u=i-n,o=s*s+u*u,c=(e-r)*s+(t-n)*u,l=Math.min(1,Math.max(0,c/o));return{x:r+s*l,y:n+u*l}}var W=r(802),X=r(672),H=r(30),$=function(){function e(){Object(c.a)(this,e),this._tasks=new Array}return Object(o.a)(e,[{key:"length",get:function(){return this._tasks.length}},{key:"push",value:function(e,t,r){var n=this;return new Promise((function(a,i){return n._tasks.push(new K(a,i,e,t,r))}))}},{key:"unshift",value:function(e,t,r){var n=this;return new Promise((function(a,i){return n._tasks.unshift(new K(a,i,e,t,r))}))}},{key:"process",value:function(){if(0===this._tasks.length)return!1;var e=this._tasks.shift();try{var t=Object(H.n)(e.signal);if(t&&!e.abortCallback)e.reject(Object(H.e)());else{var r=t?e.abortCallback(Object(H.e)()):e.callback();Object(H.o)(r)?r.then(e.resolve,e.reject):e.resolve(r)}}catch(n){e.reject(n)}return!0}},{key:"cancelAll",value:function(){var e,t=Object(H.e)(),r=Object(a.a)(this._tasks);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.abortCallback){var i=n.abortCallback(t);n.resolve(i)}else n.reject(t)}}catch(s){r.e(s)}finally{r.f()}this._tasks.length=0}}]),e}(),K=function e(t,r,n,a,i){Object(c.a)(this,e),this.resolve=t,this.reject=r,this.callback=n,this.signal=a,this.abortCallback=i};var ee="feature-store:unsupported-query",te=new Set,re=new p.b(2e6),ne=0,ae=function(){function e(t){var r=this;Object(c.a)(this,e),this.capabilities={query:P.a},this.geometryType=t.geometryType,this.hasM=t.hasM,this.hasZ=t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(function(){return r.clearCache()})),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new p.a(ne+++"$$",re)),this.fieldsIndex=new X.a(t.fields),t.scheduler&&t.priority&&(this._frameQueue=new $,this._frameTask=t.scheduler.registerTask(t.priority,this))}return Object(o.a)(e,[{key:"destroy",value:function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()}},{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"fullExtent",get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:Object(Q.b)(this.spatialReference)}:null}},{key:"timeExtent",get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=Object(G.a)(this.timeInfo,this.featureStore)),this._timeExtent):null}},{key:"clearCache",value:function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null}},{key:"executeQuery",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,r,n,a,i=this,u=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1?u[1]:void 0,a=Object(f.a)(t),e.prev=3,e.next=6,this._schedule((function(){return Object(Q.d)(a,i.definitionExpression,i.spatialReference)}),r);case 6:return a=e.sent,e.next=9,this._reschedule((function(){return i._checkQuerySupport(a)}),r);case 9:return a=e.sent,e.next=12,this._reschedule((function(){return i._executeGeometryQuery(a,r)}),r);case 12:return n=e.sent,e.next=15,this._reschedule((function(){return n.executeAggregateIdsQuery(a)}),r);case 15:return n=e.sent,e.next=18,this._reschedule((function(){return n.executeObjectIdsQuery(a)}),r);case 18:return n=e.sent,e.next=21,this._reschedule((function(){return n.executeTimeQuery(a)}),r);case 21:return n=e.sent,e.next=24,this._reschedule((function(){return n.executeAttributesQuery(a)}),r);case 24:n=e.sent,e.next=32;break;case 27:if(e.prev=27,e.t0=e.catch(3),e.t0===Q.a){e.next=31;break}throw e.t0;case 31:n=new Y([],null,this);case 32:return e.abrupt("return",n.createQueryResponse(a));case 33:case"end":return e.stop()}}),e,this,[[3,27]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForCount",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,r,n,a,i=this,u=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1?u[1]:void 0,(a=Object(f.a)(t)).returnGeometry=!1,a.returnCentroid=!1,a.outSR=null,e.prev=4,e.next=7,this._schedule((function(){return Object(Q.d)(a,i.definitionExpression,i.spatialReference)}),r);case 7:return a=e.sent,e.next=10,this._reschedule((function(){return i._checkQuerySupport(a)}),r);case 10:return a=e.sent,e.next=13,this._reschedule((function(){return i._executeGeometryQuery(a,r)}),r);case 13:return n=e.sent,e.next=16,this._reschedule((function(){return n.executeAggregateIdsQuery(a)}),r);case 16:return n=e.sent,e.next=19,this._reschedule((function(){return n.executeObjectIdsQuery(a)}),r);case 19:return n=e.sent,e.next=22,this._reschedule((function(){return n.executeTimeQuery(a)}),r);case 22:return n=e.sent,e.next=25,this._reschedule((function(){return n.executeAttributesQuery(a)}),r);case 25:n=e.sent,e.next=33;break;case 28:if(e.prev=28,e.t0=e.catch(4),e.t0===Q.a){e.next=32;break}throw e.t0;case 32:return e.abrupt("return",0);case 33:return e.abrupt("return",n.createQueryResponseForCount(a));case 34:case"end":return e.stop()}}),e,this,[[4,28]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForExtent",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,r,n,a,i,u,o,c,l,h,p,b=this,v=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.length>0&&void 0!==v[0]?v[0]:{},r=v.length>1?v[1]:void 0,a=Object(f.a)(t),i=a.outSR,e.prev=4,e.next=7,this._schedule((function(){return Object(Q.d)(a,b.definitionExpression,b.spatialReference)}),r);case 7:return a=e.sent,e.next=10,this._reschedule((function(){return b._checkQuerySupport(a)}),r);case 10:return(a=e.sent).returnGeometry=!0,a.returnCentroid=!1,a.outSR=null,e.next=16,this._reschedule((function(){return b._executeGeometryQuery(a,r)}),r);case 16:return n=e.sent,e.next=19,this._reschedule((function(){return n.executeAggregateIdsQuery(a)}),r);case 19:return n=e.sent,e.next=22,this._reschedule((function(){return n.executeObjectIdsQuery(a)}),r);case 22:return n=e.sent,e.next=25,this._reschedule((function(){return n.executeTimeQuery(a)}),r);case 25:return n=e.sent,e.next=28,this._reschedule((function(){return n.executeAttributesQuery(a)}),r);case 28:if(n=e.sent,u=n.size){e.next=32;break}return e.abrupt("return",{count:u,extent:null});case 32:return Object(y.j)(se,y.a),this.featureStore.forEachBounds(n.items,(function(e){return Object(y.e)(se,e)}),ie),o={xmin:se[0],ymin:se[1],xmax:se[3],ymax:se[4],spatialReference:Object(Q.b)(this.spatialReference)},this.hasZ&&isFinite(se[2])&&isFinite(se[5])&&(o.zmin=se[2],o.zmax=se[5]),(c=Object(E.b)(o,n.spatialReference,i)).spatialReference=Object(Q.b)(i||this.spatialReference),c.xmax-c.xmin==0&&(l=Object(d.d)(c.spatialReference),c.xmin-=l,c.xmax+=l),c.ymax-c.ymin==0&&(h=Object(d.d)(c.spatialReference),c.ymin-=h,c.ymax+=h),this.hasZ&&null!=c.zmin&&null!=c.zmax&&c.zmax-c.zmin==0&&(p=Object(d.d)(c.spatialReference),c.zmin-=p,c.zmax+=p),e.abrupt("return",{count:u,extent:c});case 42:if(e.prev=42,e.t0=e.catch(4),e.t0!==Q.a){e.next=46;break}return e.abrupt("return",{count:0,extent:null});case 46:throw e.t0;case 47:case"end":return e.stop()}}),e,this,[[4,42]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForIds",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,r,n=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1?n[1]:void 0,e.abrupt("return",this.executeQueryForIdSet(t,r).then((function(e){return Array.from(e)})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForIdSet",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,r,n,i,u,o,c=this,l=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:{},r=l.length>1?l[1]:void 0,(i=Object(f.a)(t)).returnGeometry=!1,i.returnCentroid=!1,i.outSR=null,e.prev=4,e.next=7,this._schedule((function(){return Object(Q.d)(i,c.definitionExpression,c.spatialReference)}),r);case 7:return i=e.sent,e.next=10,this._reschedule((function(){return c._checkQuerySupport(i)}),r);case 10:return i=e.sent,e.next=13,this._reschedule((function(){return c._executeGeometryQuery(i,r)}),r);case 13:return n=e.sent,e.next=16,this._reschedule((function(){return n.executeAggregateIdsQuery(i)}),r);case 16:return n=e.sent,e.next=19,this._reschedule((function(){return n.executeObjectIdsQuery(i)}),r);case 19:return n=e.sent,e.next=22,this._reschedule((function(){return n.executeTimeQuery(i)}),r);case 22:return n=e.sent,e.next=25,this._reschedule((function(){return n.executeAttributesQuery(i)}),r);case 25:return n=e.sent,u=n.items,o=new Set,e.next=29,this._reschedule((function(){var e,t=Object(a.a)(u);try{for(t.s();!(e=t.n()).done;){var r=e.value;o.add(n.featureAdapter.getObjectId(r))}}catch(i){t.e(i)}finally{t.f()}}),r);case 29:return e.abrupt("return",o);case 32:if(e.prev=32,e.t0=e.catch(4),e.t0!==Q.a){e.next=36;break}return e.abrupt("return",new Set);case 36:throw e.t0;case 37:case"end":return e.stop()}}),e,this,[[4,32]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForSnapping",value:function(){var e=Object(u.a)(s.a.mark((function e(t,r){var a,i,u,o,c,l,f,p,d,y,b,v,j,O,_=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.point,i=t.distance,0!==t.types){e.next=3;break}return e.abrupt("return",{candidates:[]});case 3:return e.next=5,this._reschedule((function(){return _._checkQuerySupport(t.query)}),r);case 5:if(u=e.sent,o=!Object(x.d)(a.spatialReference,this.spatialReference),e.t0=o,!e.t0){e.next=11;break}return e.next=11,Object(E.a)(a.spatialReference,this.spatialReference);case 11:if(c="number"==typeof i?i:i.x,l="number"==typeof i?i:i.y,f={xmin:a.x-c,xmax:a.x+c,ymin:a.y-l,ymax:a.y+l,spatialReference:a.spatialReference},p=o?Object(E.b)(f,this.spatialReference):f){e.next=14;break}return e.abrupt("return",{candidates:[]});case 14:return e.next=16,Object(g.a)(Object(m.a)(a),null,{signal:r});case 16:return d=e.sent[0],e.next=19,Object(g.a)(Object(m.a)(p),null,{signal:r});case 19:if(y=e.sent[0],!Object(h.i)(d)&&!Object(h.i)(y)){e.next=22;break}return e.abrupt("return",{candidates:[]});case 22:return b=new Y(this._searchFeatures(this._getQueryBBoxes(y.toJSON())),null,this),e.next=25,this._reschedule((function(){return b.executeObjectIdsQuery(u)}),r);case 25:return b=e.sent,e.next=28,this._reschedule((function(){return b.executeTimeQuery(u)}),r);case 28:return b=e.sent,e.next=31,this._reschedule((function(){return b.executeAttributesQuery(u)}),r);case 31:return b=e.sent,v=d.toJSON(),j=o?Object(E.b)(v,this.spatialReference):v,O=o?Math.max(p.xmax-p.xmin,p.ymax-p.ymin)/2:i,e.abrupt("return",b.createSnappingResponse(Object(n.a)(Object(n.a)({},t),{},{point:j,distance:O}),a.spatialReference));case 34:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForLatestObservations",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,r,n,a,i=this,u=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1?u[1]:void 0,this.timeInfo&&this.timeInfo.trackIdField){e.next=4;break}throw new l.a(ee,"Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:this.timeInfo});case 4:return a=Object(f.a)(t),e.prev=5,e.next=8,this._schedule((function(){return Object(Q.d)(a,i.definitionExpression,i.spatialReference)}),r);case 8:return a=e.sent,e.next=11,this._reschedule((function(){return i._checkQuerySupport(a)}),r);case 11:return a=e.sent,e.next=14,this._reschedule((function(){return i._executeGeometryQuery(a,r)}),r);case 14:return n=e.sent,e.next=17,this._reschedule((function(){return n.executeAggregateIdsQuery(a)}),r);case 17:return n=e.sent,e.next=20,this._reschedule((function(){return n.executeObjectIdsQuery(a)}),r);case 20:return n=e.sent,e.next=23,this._reschedule((function(){return n.executeTimeQuery(a)}),r);case 23:return n=e.sent,e.next=26,this._reschedule((function(){return n.executeAttributesQuery(a)}),r);case 26:return n=e.sent,e.next=29,this._reschedule((function(){return n.filterLatest()}),r);case 29:n=e.sent,e.next=37;break;case 32:if(e.prev=32,e.t0=e.catch(5),e.t0===Q.a){e.next=36;break}throw e.t0;case 36:n=new Y([],null,this);case 37:return e.abrupt("return",n.createQueryResponse(a));case 38:case"end":return e.stop()}}),e,this,[[5,32]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForSummaryStatistics",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,r,n,a,i=this,u=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1?u[1]:void 0,n=u.length>2?u[2]:void 0,t=Object(f.a)(t),e.prev=4,e.next=7,this._schedule((function(){return Object(Q.d)(t,i.definitionExpression,i.spatialReference)}),n);case 7:return t=e.sent,e.next=10,this._reschedule((function(){return i._checkSummaryStatisticsSupport(t,r)}),n);case 10:return t=e.sent,e.next=13,this._reschedule((function(){return i._executeGeometryQuery(t,n)}),n);case 13:return a=e.sent,e.next=16,this._reschedule((function(){return a.executeAggregateIdsQuery(t)}),n);case 16:return a=e.sent,e.next=19,this._reschedule((function(){return a.executeObjectIdsQuery(t)}),n);case 19:return a=e.sent,e.next=22,this._reschedule((function(){return a.executeTimeQuery(t)}),n);case 22:return a=e.sent,e.next=25,this._reschedule((function(){return a.executeAttributesQuery(t)}),n);case 25:a=e.sent,e.next=33;break;case 28:if(e.prev=28,e.t0=e.catch(4),e.t0===Q.a){e.next=32;break}throw e.t0;case 32:a=new Y([],null,this);case 33:return e.abrupt("return",a.createSummaryStatisticsResponse(t,r));case 34:case"end":return e.stop()}}),e,this,[[4,28]])})));return function(){return e.apply(this,arguments)}}()},{key:"_schedule",value:function(){var e=Object(u.a)(s.a.mark((function e(t,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._frameQueue?this._frameQueue.push(t,r):t());case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_reschedule",value:function(){var e=Object(u.a)(s.a.mark((function e(t,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._frameQueue?this._frameQueue.unshift(t,r):t());case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"running",get:function(){return this._frameQueue.length>0}},{key:"runTask",value:function(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null}},{key:"_getAll",value:function(){if(!this._allItems){var e=[];this.featureStore.forEach((function(t){return e.push(t)})),this._allItems=new Y(e,null,this)}return this._allItems}},{key:"_executeGeometryQuery",value:function(){var e=Object(u.a)(s.a.mark((function e(t,r){var n,i,o,c,l,f,p,d,y,b,v,m,g,j,O,_,w,k,S,I,F,T,R,N=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.geometry,i=t.outSR,o=t.spatialRel,c=t.returnGeometry,l=t.returnCentroid,f=c||l,p=Object(x.l)(i)&&!Object(x.d)(this.spatialReference,i),!(d=this._geometryQueryCache?p&&f?JSON.stringify({geometry:n,spatialRelationship:o,outSpatialReference:i}):JSON.stringify({geometry:n,spatialRelationship:o}):null)){e.next=5;break}if(y=this._geometryQueryCache.get(d),Object(h.k)(y)){e.next=5;break}return e.abrupt("return",y);case 5:if(b=function(){var e=Object(u.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p||!f){e.next=5;break}return e.next=3,t.project(i);case 3:return r=e.sent,e.abrupt("return",(d&&N._geometryQueryCache.put(d,r,r.size||1),r));case 5:return e.abrupt("return",(d&&N._geometryQueryCache.put(d,t,t.size||1),t));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n){e.next=8;break}return e.abrupt("return",b(this._getAll()));case 8:if(v=this.featureAdapter,"esriSpatialRelDisjoint"!==o){e.next=22;break}if((m=this._searchFeatures(this._getQueryBBoxes(n))).length){e.next=13;break}return e.abrupt("return",b(this._getAll()));case 13:O=new Set,_=Object(a.a)(m);try{for(_.s();!(w=_.n()).done;)k=w.value,O.add(v.getObjectId(k))}catch(M){_.e(M)}finally{_.f()}return e.next=18,this._reschedule((function(){var e=0;g=new Array(O.size),N.featureStore.forEach((function(t){return g[e++]=t})),j=O}),r);case 18:return e.next=20,this._reschedule(Object(u.a)(s.a.mark((function e(){var t,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(W.c)(o,n,N.geometryType,N.hasZ,N.hasM);case 2:return t=e.sent,a=function(e){return!j.has(v.getObjectId(e))||t(v.getGeometry(e))},e.t0=Y,e.next=7,N._runSpatialFilter(g,a,r);case 7:return e.t1=e.sent,e.t2=n,e.t3=N,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3));case 11:case"end":return e.stop()}}),e)}))),r);case 20:return S=e.sent,e.abrupt("return",b(S));case 22:if((I=this._searchFeatures(this._getQueryBBoxes(n))).length){e.next=26;break}return F=new Y([],n,this),e.abrupt("return",(d&&this._geometryQueryCache.put(d,F,F.size||1),F));case 26:if(!this._canExecuteSoloPass(n,t)){e.next=28;break}return e.abrupt("return",b(new Y(I,n,this)));case 28:return e.next=30,Object(W.c)(o,n,this.geometryType,this.hasZ,this.hasM);case 30:return T=e.sent,e.next=33,this._runSpatialFilter(I,(function(e){return T(v.getGeometry(e))}),r);case 33:return R=e.sent,e.abrupt("return",b(new Y(R,n,this)));case 35:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_runSpatialFilter",value:function(){var e=Object(u.a)(s.a.mark((function e(t,r,n){var a,i,o,c=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t);case 2:if(this._budget){e.next=4;break}return e.abrupt("return",t.filter((function(e){return r(e)})));case 4:return a=0,i=new Array,o=function(){var e=Object(u.a)(s.a.mark((function e(){var u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a<t.length)){e.next=10;break}if(u=t[a],r(u)&&i.push(u),e.t0=c._budget.done,!e.t0){e.next=7;break}return e.next=7,c._reschedule((function(){return o()}),n);case 7:++a;case 8:e.next=0;break;case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this._reschedule((function(){return o()}),n).then((function(){return i})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_canExecuteSoloPass",value:function(e,t){var r=this.geometryType,n=t.spatialRel;return Object(W.a)(e)&&("esriSpatialRelEnvelopeIntersects"===n||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===n||"esriSpatialRelContains"===n||"esriSpatialRelWithin"===n))}},{key:"_getQueryBBoxes",value:function(e){if(Object(W.a)(e)){if(Object(m.d)(e))return[Object(b.j)(e.xmin,e.ymin,e.xmax,e.ymax)];if(Object(m.g)(e))return e.rings.map((function(e){return Object(b.j)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[Object(v.a)(Object(b.e)(),e)]}},{key:"_searchFeatures",value:function(e){var t,r=Object(a.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.featureStore.forEachInBounds(n,(function(e){te.add(e)}))}}catch(u){r.e(u)}finally{r.f()}var i=new Array(te.size),s=0;return te.forEach((function(e){return i[s++]=e})),te.clear(),i}},{key:"_checkSummaryStatisticsSupport",value:function(){var e=Object(u.a)(s.a.mark((function e(t,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text||t.outStatistics||t.groupByFieldsForStatistics||t.having||t.orderByFields)){e.next=2;break}throw new l.a(ee,"Unsupported query options",{query:t});case 2:return e.abrupt("return",Promise.all([this._checkAttributesQuerySupport(t),this._checkSummaryStatisticsParamsSupport(r),Object(W.b)(t,this.geometryType,this.spatialReference),Object(E.a)(this.spatialReference,t.outSR)]).then((function(){return t})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_checkSummaryStatisticsParamsSupport",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var r,n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],!t.valueExpression){e.next=7;break}return e.next=4,Object(D.e)();case 4:n=e.sent,a=n.arcadeUtils,r=a.extractFieldNames(t.valueExpression);case 7:if(t.field&&r.push(t.field),t.normalizationField&&r.push(t.normalizationField),r.length){e.next=9;break}throw new l.a(ee,"params should have at least a field or valueExpression",{params:t});case 9:R(this.fieldsIndex,r,"params contains missing fields");case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkQuerySupport",value:function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text)){e.next=2;break}throw new l.a(ee,"Unsupported query options",{query:t});case 2:return e.abrupt("return",Promise.all([this._checkAttributesQuerySupport(t),this._checkStatisticsQuerySupport(t),Object(W.b)(t,this.geometryType,this.spatialReference),Object(E.a)(this.spatialReference,t.outSR)]).then((function(){return t})));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkAttributesQuerySupport",value:function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues,a=e.outStatistics,i=a?a.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})):[];if(r&&r.length>0){var s=" asc",u=" desc",o=r.map((function(e){var t=e.toLowerCase();return t.indexOf(s)>-1?t.split(s)[0]:t.indexOf(u)>-1?t.split(u)[0]:e})).filter((function(e){return-1===i.indexOf(e)}));R(this.fieldsIndex,o,"orderByFields contains missing fields")}if(t&&t.length>0)R(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new l.a(ee,"outFields should be specified for returnDistinctValues",{query:e});!function(e,t){if(!t)return!0;var r=w.get(t,e);if(!r)throw new l.a(k,"invalid SQL expression",{where:t});if(!r.isStandardized)throw new l.a(k,"where clause is not standard",{where:t});R(e,r.fieldNames,"where clause contains missing fields")}(this.fieldsIndex,e.where)}},{key:"_checkStatisticsQuerySupport",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var r,n,i,u,o,c,f,h,p,d,y;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.outStatistics,n=t.groupByFieldsForStatistics,i=t.having,u=n&&n.length,o=r&&r.length,!i){e.next=5;break}if(u&&o){e.next=4;break}throw new l.a(ee,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:t});case 4:F(this.fieldsIndex,i,r);case 5:if(!o){e.next=34;break}if(r.every((function(e){return"exceedslimit"!==e.statisticType}))){e.next=8;break}return e.abrupt("return");case 8:c=r.map((function(e){return e.onStatisticField})),R(this.fieldsIndex,c,"onStatisticFields contains missing fields"),u&&R(this.fieldsIndex,n,"groupByFieldsForStatistics contains missing fields"),f=Object(a.a)(r),e.prev=11,f.s();case 13:if((h=f.n()).done){e.next=26;break}if(p=h.value,d=p.onStatisticField,"percentile_disc"!==(y=p.statisticType)&&"percentile_cont"!==y||!("statisticParameters"in p)){e.next=22;break}if(p.statisticParameters){e.next=20;break}throw new l.a(ee,"statisticParamters should be set for percentile type",{definition:p,query:t});case 20:e.next=24;break;case 22:if("count"===y||!d||!M(d,this.fieldsIndex)){e.next=24;break}throw new l.a(ee,"outStatistics contains non-numeric fields",{definition:p,query:t});case 24:e.next=13;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(11),f.e(e.t0);case 31:return e.prev=31,f.f(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[11,28,31,34]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ie=Object(y.b)(),se=Object(y.b)()},811:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(2),a=r(4),i=r(19),s=r(863),u={minX:0,minY:0,maxX:0,maxY:0};var o=function(){function e(){var t=this;Object(n.a)(this,e),this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new s.a(9,Object(i.a)("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(t._indexInvalid){var e=new Array(t._idByBounds.size),r=0;t._idByBounds.forEach((function(t,n){e[r++]=n})),t._indexInvalid=!1,t._index.clear(),t._index.load(e)}else t._boundsToLoad.length&&(t._index.load(t._boundsToLoad.filter((function(e){return t._idByBounds.has(e)}))),t._boundsToLoad.length=0)}}return Object(a.a)(e,[{key:"clear",value:function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}},{key:"delete",value:function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}},{key:"forEachInBounds",value:function(e,t){var r=this;this._loadIndex(),function(e,t,r){u.minX=t[0],u.minY=t[1],u.maxX=t[2],u.maxY=t[3],e.search(u,r)}(this._index,e,(function(e){return t(r._idByBounds.get(e))}))}},{key:"get",value:function(e){return this._boundsById.get(e)}},{key:"has",value:function(e){return this._boundsById.has(e)}},{key:"invalidateIndex",value:function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}},{key:"set",value:function(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}]),e}()},813:function(e,t,r){"use strict";r.d(t,"a",(function(){return R})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return T})),r.d(t,"d",(function(){return F}));var n=r(22),a=r(7),i=r.n(a),s=r(21),u=r(29),o=r(731),c=r(681),l=i.a.mark(y),f=i.a.mark(b),h=i.a.mark(v),p={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function d(e){return p[e]}function y(e){var t,r,n;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.t0=e.type,a.next="Feature"===a.t0?3:"FeatureCollection"===a.t0?6:25;break;case 3:return a.next=5,e;case 5:return a.abrupt("break",25);case 6:t=Object(s.a)(e.features),a.prev=7,t.s();case 9:if((r=t.n()).done){a.next=17;break}if(n=r.value,a.t1=n,!a.t1){a.next=15;break}return a.next=15,n;case 15:a.next=9;break;case 17:a.next=22;break;case 19:a.prev=19,a.t2=a.catch(7),t.e(a.t2);case 22:return a.prev=22,t.f(),a.finish(22);case 25:case"end":return a.stop()}}),l,null,[[7,19,22,25]])}function b(e){var t,r,n,a,u,o,c,l,h;return i.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(e){i.next=2;break}return i.abrupt("return",null);case 2:i.t0=e.type,i.next="Point"===i.t0?5:"LineString"===i.t0||"MultiPoint"===i.t0?8:"MultiLineString"===i.t0||"Polygon"===i.t0?10:"MultiPolygon"===i.t0?27:58;break;case 5:return i.next=7,e.coordinates;case 7:return i.abrupt("break",58);case 8:return i.delegateYield(e.coordinates,"t1",9);case 9:return i.abrupt("break",58);case 10:t=Object(s.a)(e.coordinates),i.prev=11,t.s();case 13:if((r=t.n()).done){i.next=18;break}return n=r.value,i.delegateYield(n,"t2",16);case 16:i.next=13;break;case 18:i.next=23;break;case 20:i.prev=20,i.t3=i.catch(11),t.e(i.t3);case 23:return i.prev=23,t.f(),i.finish(23);case 26:return i.abrupt("break",58);case 27:a=Object(s.a)(e.coordinates),i.prev=28,a.s();case 30:if((u=a.n()).done){i.next=50;break}o=u.value,c=Object(s.a)(o),i.prev=33,c.s();case 35:if((l=c.n()).done){i.next=40;break}return h=l.value,i.delegateYield(h,"t4",38);case 38:i.next=35;break;case 40:i.next=45;break;case 42:i.prev=42,i.t5=i.catch(33),c.e(i.t5);case 45:return i.prev=45,c.f(),i.finish(45);case 48:i.next=30;break;case 50:i.next=55;break;case 52:i.prev=52,i.t6=i.catch(28),a.e(i.t6);case 55:return i.prev=55,a.f(),i.finish(55);case 58:case"end":return i.stop()}}),f,null,[[11,20,23,26],[28,52,55,58],[33,42,45,48]])}function v(e){var t,r,n,a,u,l,f,p,y,b,v,m,g,x=arguments;return i.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:t=x.length>1&&void 0!==x[1]?x[1]:{},r=t.geometryType,n=t.objectIdField,a=Object(s.a)(e),i.prev=3,a.s();case 5:if((u=a.n()).done){i.next=18;break}if(l=u.value,p=l.geometry,y=l.properties,b=l.id,!p||d(p.type)===r){i.next=10;break}return i.abrupt("continue",16);case 10:return m=null!=(f=(v=y||{})[n])?f:null,n&&null!=b&&!v[n]&&(v[n]=m=b),g=new o.b(p?j(new c.a,p,t):null,v,null,m),i.next=16,g;case 16:i.next=5;break;case 18:i.next=23;break;case 20:i.prev=20,i.t0=i.catch(3),a.e(i.t0);case 23:return i.prev=23,a.f(),i.finish(23);case 26:case"end":return i.stop()}}),h,null,[[3,20,23,26]])}function m(e){var t,r=Object(s.a)(e);try{for(r.s();!(t=r.n()).done;){if(t.value.length>2)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}function g(e){for(var t=0,r=0;r<e.length;r++){var n=e[r],a=e[(r+1)%e.length];t+=n[0]*a[1]-a[0]*n[1]}return t<=0}function x(e){var t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]||e.push(t),e}function j(e,t,r){switch(t.type){case"LineString":case"MultiPoint":return function(e,t,r){return w(e,t.coordinates,r),e}(e,t,r);case"MultiLineString":return function(e,t,r){var n,a=Object(s.a)(t.coordinates);try{for(a.s();!(n=a.n()).done;){w(e,n.value,r)}}catch(i){a.e(i)}finally{a.f()}return e}(e,t,r);case"MultiPolygon":return function(e,t,r){var n,a=Object(s.a)(t.coordinates);try{for(a.s();!(n=a.n()).done;){var i=n.value;O(e,i[0],r);for(var u=1;u<i.length;u++)_(e,i[u],r)}}catch(o){a.e(o)}finally{a.f()}return e}(e,t,r);case"Point":return function(e,t,r){return S(e,t.coordinates,r),e}(e,t,r);case"Polygon":return function(e,t,r){var n=t.coordinates;O(e,n[0],r);for(var a=1;a<n.length;a++)_(e,n[a],r);return e}(e,t,r)}}function O(e,t,r){var n=x(t);!function(e){return!g(e)}(n)?w(e,n,r):k(e,n,r)}function _(e,t,r){var n=x(t);!function(e){return g(e)}(n)?w(e,n,r):k(e,n,r)}function w(e,t,r){var n,a=Object(s.a)(t);try{for(a.s();!(n=a.n()).done;){S(e,n.value,r)}}catch(i){a.e(i)}finally{a.f()}e.lengths.push(t.length)}function k(e,t,r){for(var n=t.length-1;n>=0;n--)S(e,t[n],r);e.lengths.push(t.length)}function S(e,t,r){var a=Object(n.a)(t,3),i=a[0],s=a[1],u=a[2];e.coords.push(i,s),r.hasZ&&e.coords.push(u||0)}function I(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function F(e){if(!e)throw new u.a("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new u.a("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});var t=e.crs;if(t){var r="string"==typeof t?t:"name"===t.type?t.properties.name:"EPSG"===t.type?t.properties.code:null,n=new RegExp(".*(CRS84H?|4326)$","i");if(!r||!n.test(r))throw new u.a("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}}function T(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=[],i=new Set,u=new Set,o=!1,c=Number.NEGATIVE_INFINITY,l=null,f=!1,h=n.geometryType,p=void 0===h?null:h,v=!1,g=Object(s.a)(y(e));try{var x=function(){var e=r.value,n=e.geometry,s=e.properties,h=e.id;if((!n||(p||(p=d(n.type)),d(n.type)===p))&&(o||(o=m(b(n))),f||(f=null!=h)&&("number"===(t=typeof h)&&(l=Object.keys(s).filter((function(e){return s[e]===h})))),f&&"number"===t&&null!=h&&(c=Math.max(c,h),l.length>1?l=l.filter((function(e){return s[e]===h})):1===l.length&&(l=s[l[0]]===h?l:[])),!v&&s)){var y=!0;for(var g in s)if(!i.has(g)){var x=s[g];if(null!=x){var j=I(x);"unknown"!==j?(u.delete(g),i.add(g),a.push({name:g,alias:g,type:j})):u.add(g)}else y=!1,u.add(g)}v=y}};for(g.s();!(r=g.n()).done;)x()}catch(k){g.e(k)}finally{g.f()}var j=l&&1===l.length&&l[0]||null;if(j){var O,_=Object(s.a)(a);try{for(_.s();!(O=_.n()).done;){var w=O.value;w.name===j&&(w.type="esriFieldTypeOID")}}catch(k){_.e(k)}finally{_.f()}}return{fields:a,geometryType:p,hasZ:o,maxObjectId:Math.max(0,c),objectIdFieldName:j,objectIdFieldType:t,unknownFields:Array.from(u)}}function R(e,t){return Array.from(v(y(e),t))}},819:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(345),a=r(25),i=(r(65),r(123),r(5));function s(e,t){s=function(e,t){return new c(e,void 0,t)};var r=Object(a.a)(RegExp),u=RegExp.prototype,o=new WeakMap;function c(e,t,n){var a=r.call(this,e,t);return o.set(a,n||o.get(e)),a}function l(e,t){var r=o.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return Object(i.a)(c,r),c.prototype.exec=function(e){var t=u.exec.call(this,e);return t&&(t.groups=l(t,this)),t},c.prototype[Symbol.replace]=function(e,t){if("string"===typeof t){var r=o.get(this);return u[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"===typeof t){var a=this;return u[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!==Object(n.a)(e[e.length-1])&&e.push(l(e,a)),t.apply(this,e)}))}return u[Symbol.replace].call(this,e,t)},s.apply(this,arguments)}},831:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var n=r(21),a=r(2),i=r(4),s=r(29),u=r(184),o=r(15),c=r(11),l=r(240),f=r(333),h=r(680),p=r(811),d=r(758),y=r(731),b=r(681),v={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new y.b(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=Object(d.a)(new b.a,e.geometry,t.hasZ,t.hasM)),e.centroid}},m=function(){function e(t){Object(a.a)(this,e),this.geometryInfo=t,this._boundsStore=new p.a,this._featuresById=new Map,this._markedIds=new Set,this.events=new u.a,this.featureAdapter=v}return Object(i.a)(e,[{key:"geometryType",get:function(){return this.geometryInfo.geometryType}},{key:"hasM",get:function(){return this.geometryInfo.hasM}},{key:"hasZ",get:function(){return this.geometryInfo.hasZ}},{key:"numFeatures",get:function(){return this._featuresById.size}},{key:"fullBounds",get:function(){var e=this;if(!this.numFeatures)return null;var t=Object(f.e)(f.a);return this._featuresById.forEach((function(r){var n=e._boundsStore.get(r.objectId);n&&(t[0]=Math.min(n[0],t[0]),t[1]=Math.min(n[1],t[1]),t[2]=Math.max(n[2],t[2]),t[3]=Math.max(n[3],t[3]))})),t}},{key:"storeStatistics",get:function(){var e=0;return this._featuresById.forEach((function(t){Object(c.j)(t.geometry)&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}},{key:"add",value:function(e){this._add(e),this._emitChanged()}},{key:"addMany",value:function(e){var t,r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;this._add(a)}}catch(i){r.e(i)}finally{r.f()}this._emitChanged()}},{key:"clear",value:function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}},{key:"removeById",value:function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}},{key:"removeManyById",value:function(e){this._boundsStore.invalidateIndex();var t,r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=this._featuresById.get(a);i&&this._remove(i)}}catch(s){r.e(s)}finally{r.f()}this._emitChanged()}},{key:"forEachBounds",value:function(e,t,r){var a,i=Object(n.a)(e);try{for(i.s();!(a=i.n()).done;){var s=a.value,u=this._boundsStore.get(s.objectId);u&&t(Object(l.h)(r,u))}}catch(o){i.e(o)}finally{i.f()}}},{key:"getFeature",value:function(e){return this._featuresById.get(e)}},{key:"has",value:function(e){return this._featuresById.has(e)}},{key:"forEach",value:function(e){this._featuresById.forEach((function(t){return e(t)}))}},{key:"forEachInBounds",value:function(e,t){var r=this;this._boundsStore.forEachInBounds(e,(function(e){t(r._featuresById.get(e))}))}},{key:"startMarkingUsedFeatures",value:function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}},{key:"sweep",value:function(){var e=this,t=!1;this._featuresById.forEach((function(r,n){e._markedIds.has(n)||(t=!0,e._remove(r))})),this._markedIds.clear(),t&&this._emitChanged()}},{key:"_emitChanged",value:function(){this.events.emit("changed",void 0)}},{key:"_add",value:function(e){if(e){var t=e.objectId;if(null!=t){var r,n=this._featuresById.get(t);if(this._markedIds.add(t),n?(e.displayId=n.displayId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):Object(c.j)(this.onFeatureAdd)&&this.onFeatureAdd(e),Object(c.i)(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=Object(h.o)(Object(c.j)(r)?r:Object(f.e)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),Object(c.j)(r)&&this._boundsStore.set(t,r),this._featuresById.set(t,e)}else o.a.getLogger("esri.layers.graphics.data.FeatureStore").error(new s.a("featurestore:invalid-feature","feature id is missing",{feature:e}))}}},{key:"_remove",value:function(e){return Object(c.j)(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e}}]),e}()},894:function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return O})),r.d(t,"d",(function(){return v})),r.d(t,"e",(function(){return g}));var n=r(7),a=r.n(n),i=r(12),s=r(21),u=r(2),o=r(53),c=r(209),l=function e(){Object(u.a)(this,e),this.code=null,this.description=null},f=function e(t){Object(u.a)(this,e),this.error=new l,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=t};function h(e){return new f(e)}var p=function e(t){Object(u.a)(this,e),this.globalId=null,this.success=!0,this.objectId=this.uniqueId=t};function d(e){return new p(e)}var y,b=new Set;function v(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5?arguments[5]:void 0;for(var u in b.clear(),r){var o=e.get(u);if(o){var l=r[u],f=m(o,l);if(f!==l&&i&&i.push({name:"invalid-value-type",message:"attribute value was converted to match the field type",details:{field:o,originalValue:l,sanitizedValue:f}}),b.add(o.name),o&&(a||o.editable)){var p=Object(c.m)(o,f);if(p)return h(Object(c.n)(p,o,f));t[o.name]=f}}}if(n){var d,y=Object(s.a)(n);try{for(y.s();!(d=y.n()).done;){var v=d.value;if(!b.has(v.name))return h('missing required field "'.concat(v.name,'"'))}}catch(g){y.e(g)}finally{y.f()}}return null}function m(e,t){var r=t;return"string"==typeof t&&Object(c.i)(e)?r=parseFloat(t):null!=t&&Object(c.j)(e)&&"string"!=typeof t&&(r=String(t)),Object(c.l)(r)}function g(e,t){if(!e||!Object(o.l)(t))return e;if("rings"in e||"paths"in e){if(!y)throw new TypeError("geometry engine not loaded");return y.simplify(t,e)}return e}function x(){return j.apply(this,arguments)}function j(){return(j=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=y,e.t0){e.next=6;break}return e.next=4,Promise.all([r.e(9),r.e(19)]).then(r.bind(null,828));case 4:y=e.sent,e.t0=y;case 6:return e.abrupt("return",e.t0);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t){return _.apply(this,arguments)}function _(){return(_=Object(i.a)(a.a.mark((function e(t,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!Object(o.l)(t)||"esriGeometryPolygon"!==r&&"esriGeometryPolyline"!==r,e.t0){e.next=4;break}return e.next=4,x();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},895:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return u}));var n=r(7),a=r.n(n),i=r(21),s=a.a.mark(o);function u(e,t){var r,n=Object(i.a)(e.children);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(a.localName in t){var s=t[a.localName];if("function"==typeof s){var o=s(a);o&&u(a,o)}else u(a,s)}}}catch(c){n.e(c)}finally{n.f()}}function o(e,t){var r,n,u,c;return a.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:r=Object(i.a)(e.children),a.prev=1,r.s();case 3:if((n=r.n()).done){a.next=15;break}if(!((u=n.value).localName in t)){a.next=13;break}if("function"!=typeof(c=t[u.localName])){a.next=12;break}return a.next=10,c(u);case 10:a.next=13;break;case 12:return a.delegateYield(o(u,c),"t0",13);case 13:a.next=3;break;case 15:a.next=20;break;case 17:a.prev=17,a.t1=a.catch(1),r.e(a.t1);case 20:return a.prev=20,r.f(),a.finish(20);case 23:case"end":return a.stop()}}),s,null,[[1,17,20,23]])}},954:function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return Z})),r.d(t,"c",(function(){return V})),r.d(t,"d",(function(){return ie})),r.d(t,"e",(function(){return U})),r.d(t,"f",(function(){return $}));var n=r(7),a=r.n(n),i=r(13),s=r(22),u=r(21),o=r(23),c=r(819),l=r(12),f=(r(114),r(82)),h=r(29);function p(e,t){var r,n=Object(u.a)(e);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(null!=a&&t(a))return a}}catch(i){n.e(i)}finally{n.f()}}var d=r(11),y=r(30),b=r(27),v=r(750),m=r(53),g=r(236),x=r(813);function j(e){var t;return null!=(t=function(e){var t,r,n,a,i=O.exec(e);if(!i)return null;var s=i.groups,u=+s.year,o=+s.month-1,c=+s.day,l=+(null!=(t=s.hours)?t:"0"),f=+(null!=(r=s.minutes)?r:"0"),h=+(null!=(n=s.seconds)?n:"0");if(l>23)return null;if(f>59)return null;if(h>59)return null;var p,d=null!=(a=s.ms)?a:"0",y=d?+d.padEnd(3,"0").substring(0,3):0;if(s.isUTC)p=Date.UTC(u,o,c,l,f,h,y);else if(s.offsetSign){var b=+s.offsetHours,v=+s.offsetMinutes;p=6e4*("+"===s.offsetSign?-1:1)*(60*b+v)+Date.UTC(u,o,c,l,f,h,y)}else p=new Date(u,o,c,l,f,h,y).getTime();return Number.isNaN(p)?null:p}(e))?t:function(e){var t=new Date(e).getTime();return Number.isNaN(t)?null:t}(e)}var O=Object(c.a)(/^(?:(\x2D?[0-9]{4,})\x2D([0-9]{2})\x2D([0-9]{2}))(?:T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:\.([0-9]+))?)?(?:(Z)|(?:(\+|\x2D)([0-9]{2}):([0-9]{2})))?$/,{year:1,month:2,day:3,hours:4,minutes:5,seconds:6,ms:7,isUTC:8,offsetSign:9,offsetHours:10,offsetMinutes:11}),_=r(895),w=r(666),k=r(45),S=r(58),I="xlink:href",F="2.0.0",T="__esri_wfs_id__",R="wfs-layer:getWFSLayerTypeInfo-error",N="wfs-layer:empty-service",M="wfs-layer:feature-type-not-found",E="wfs-layer:malformed-json",P="wfs-layer:unknown-geometry-type",A="wfs-layer:unknown-field-type",C="wfs-layer:unsupported-spatial-reference",z="wfs-layer:unsupported-wfs-version";function V(e,t){return G.apply(this,arguments)}function G(){return(G=Object(l.a)(a.a.mark((function e(t,r){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Q,e.next=3,Object(f.default)(t,{responseType:"text",query:Object(i.a)({SERVICE:"WFS",REQUEST:"GetCapabilities",VERSION:F},null==r?void 0:r.customParameters),signal:null==r?void 0:r.signal});case 3:return e.t1=e.sent.data,n=(0,e.t0)(e.t1),e.abrupt("return",(B(t,n),n));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){var t=oe(e);(function(e){var t=e.firstElementChild.getAttribute("version");if(t&&t!==F)throw new h.a(z,"Unsupported WFS version ".concat(t,". Supported version: ").concat(F))})(t),le(t);var r=t.firstElementChild,n=new Map;return{operations:D(r),get featureTypes(){return Array.from(L(r,n))},readFeatureTypes:function(){return L(r,n)}}}var q=new Set(["json","application/json","geojson","application/json; subtype=geojson"]);function D(e){var t=!1,r={GetCapabilities:{url:""},DescribeFeatureType:{url:""},GetFeature:{url:"",outputFormat:null,supportsPagination:!1}};if(Object(_.b)(e,{OperationsMetadata:{Operation:function(e){switch(e.getAttribute("name")){case"GetCapabilities":return{DCP:{HTTP:{Get:function(e){r.GetCapabilities.url=e.getAttribute(I)}}}};case"DescribeFeatureType":return{DCP:{HTTP:{Get:function(e){r.DescribeFeatureType.url=e.getAttribute(I)}}}};case"GetFeature":return{DCP:{HTTP:{Get:function(e){r.GetFeature.url=e.getAttribute(I)}}},Parameter:function(e){if("outputFormat"===e.getAttribute("name"))return{AllowedValues:{Value:function(e){var t=e.textContent;q.has(t.toLowerCase())&&(r.GetFeature.outputFormat=t)}}}}}}},Constraint:function(e){switch(e.getAttribute("name")){case"KVPEncoding":return{DefaultValue:function(e){t="true"===e.textContent.toLowerCase()}};case"ImplementsResultPaging":return{DefaultValue:function(e){r.GetFeature.supportsPagination="true"===e.textContent.toLowerCase()}}}}}}),!t)throw new h.a("wfs-layer:kvp-encoding-not-supported","WFS service doesn't support key/value pair (KVP) encoding");if(Object(d.i)(r.GetFeature.outputFormat))throw new h.a("wfs-layer:geojson-not-supported","WFS service doesn't support GeoJSON output format");return r}function B(e,t){Object(b.v)(e)&&(Object(b.q)(e,t.operations.DescribeFeatureType.url,!0)&&(t.operations.DescribeFeatureType.url=Object(b.I)(t.operations.DescribeFeatureType.url)),Object(b.q)(e,t.operations.GetFeature.url,!0)&&(t.operations.GetFeature.url=Object(b.I)(t.operations.GetFeature.url)))}function L(e,t){return Object(_.a)(e,{FeatureTypeList:{FeatureType:function(e){var r;if(t.has(e))return t.get(e);var n={typeName:"undefined:undefined",name:"",title:"",description:"",extent:null,namespacePrefix:"",namespaceUri:"",supportedSpatialReferences:[]},a=new Set([4326]),i=function(e){var t,r,n=parseInt(null==(t=e.textContent.match(Object(c.a)(/([0-9]+$)/i,{wkid:1})))||null==(r=t.groups)?void 0:r.wkid,10);Number.isNaN(n)||a.add(n)};return Object(_.b)(e,{Name:function(e){var t=ce(e.textContent),r=t.name,a=t.prefix;n.typeName="".concat(a,":").concat(r),n.name=r,n.namespacePrefix=a,n.namespaceUri=e.lookupNamespaceURI(a)},Abstract:function(e){n.description=e.textContent},Title:function(e){n.title=e.textContent},WGS84BoundingBox:function(e){n.extent=function(e){var t,r,n,a,i,o=Object(u.a)(e.children);try{for(o.s();!(i=o.n()).done;){var c=i.value;switch(c.localName){case"LowerCorner":var l=c.textContent.split(" ").map((function(e){return Number.parseFloat(e)})),f=Object(s.a)(l,2);t=f[0],r=f[1];break;case"UpperCorner":var h=c.textContent.split(" ").map((function(e){return Number.parseFloat(e)})),p=Object(s.a)(h,2);n=p[0],a=p[1]}}}catch(d){o.e(d)}finally{o.f()}return{xmin:t,ymin:r,xmax:n,ymax:a,spatialReference:m.b}}(e)},DefaultSRS:i,DefaultCRS:i,OtherSRS:i,OtherCRS:i}),n.title||(n.title=n.name),(r=n.supportedSpatialReferences).push.apply(r,Object(o.a)(a)),t.set(e,n),n}}})}function Z(e,t,r){return p(e,(function(e){return r?e.name===t&&e.namespaceUri===r:e.typeName===t||e.name===t}))}function U(e,t,r){return Y.apply(this,arguments)}function Y(){return Y=Object(l.a)(a.a.mark((function e(t,r,n){var i,s,u,o,c,l,f,h,p,d,y,b=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=b.length>3&&void 0!==b[3]?b[3]:{},e.next=3,J(t,r,n,i);case 3:return u=e.sent,o=u.featureType,c=u.extent,e.next=8,X(t,o.typeName,i);case 8:return l=e.sent,f=l.fields,h=l.geometryType,p=l.swapXY,d=l.objectIdField,y=l.geometryField,e.abrupt("return",{url:t.operations.GetCapabilities.url,name:o.name,namespaceUri:o.namespaceUri,fields:f,geometryField:y,geometryType:h,objectIdField:d,spatialReference:null!=(s=i.spatialReference)?s:k.a.WGS84,extent:c,swapXY:p,wfsCapabilities:t,customParameters:i.customParameters});case 15:case"end":return e.stop()}}),e)}))),Y.apply(this,arguments)}function J(e,t,r){return W.apply(this,arguments)}function W(){return W=Object(l.a)(a.a.mark((function e(t,r,n){var s,u,o,c,l,f,p=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=p.length>3&&void 0!==p[3]?p[3]:{},u=s.spatialReference,o=void 0===u?k.a.WGS84:u,c=t.readFeatureTypes(),l=r?Z(c,r,n):c.next().value,!Object(d.i)(l)){e.next=4;break}throw r?new h.a(M,"The type '".concat(r,"' could not be found in the service")):new h.a(N,"The service is empty");case 4:if(f=new S.a(Object(i.a)(Object(i.a)({},l.extent),{},{spatialReference:o})),Object(m.d)(o,m.b)){e.next=15;break}return e.prev=6,e.next=9,Object(v.d)(m.b,o,void 0,s);case 9:f=Object(v.h)(f,m.b),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(6),new h.a(C,"Projection not supported");case 15:return e.abrupt("return",{extent:f,spatialReference:o,featureType:l});case 16:case"end":return e.stop()}}),e,null,[[6,12]])}))),W.apply(this,arguments)}function X(e,t){return H.apply(this,arguments)}function H(){return H=Object(l.a)(a.a.mark((function e(t,r){var n,u,o,c,l,f,p,b,v,m,g=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=g.length>2&&void 0!==g[2]?g[2]:{},e.next=3,Object(y.j)([te(t.operations.DescribeFeatureType.url,r,n),K(t,r,n)]);case 3:if(u=e.sent,o=Object(s.a)(u,2),c=o[0],l=o[1],!c.error&&!l.error){e.next=9;break}throw new h.a(R,"An error occurred while getting info about the feature type '".concat(r,"'"),{error:c.error||l.error});case 9:if(f=c.value,p=f.fields,b=f.errors,v=c.value.geometryType||l.value.geometryType,m=l.value.swapXY,!Object(d.i)(v)){e.next=12;break}throw new h.a(P,"The geometry type could not be determined for type '".concat(r),{typeName:r,geometryType:v,fields:p,errors:b});case 12:return e.abrupt("return",Object(i.a)(Object(i.a)({},$(p)),{},{geometryType:v,swapXY:m}));case 13:case"end":return e.stop()}}),e)}))),H.apply(this,arguments)}function $(e){var t,r=e.find((function(e){return"geometry"===e.type})),n=e.find((function(e){return"oid"===e.type}));return e=e.filter((function(e){return"geometry"!==e.type})),n||(n=new w.a({name:T,type:"oid",alias:T}),e.unshift(n)),{geometryField:null!=(t=null==r?void 0:r.name)?t:null,objectIdField:n.name,fields:e}}function K(e,t){return ee.apply(this,arguments)}function ee(){return ee=Object(l.a)(a.a.mark((function e(t,r){var n,u,o,c,l,h,p,d,y,b,v,m,j,O,_=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=_.length>2&&void 0!==_[2]?_[2]:{},c=!1,e.next=4,Promise.all([ie(t.operations.GetFeature.url,r,t.operations.GetFeature.outputFormat,Object(i.a)(Object(i.a)({},n),{},{count:1})),Object(f.default)(t.operations.GetFeature.url,{responseType:"text",query:ue(r,void 0,Object(i.a)(Object(i.a)({},n),{},{count:1})),signal:null==n?void 0:n.signal})]);case 4:if(l=e.sent,h=Object(s.a)(l,2),p=h[0],d=h[1],!(y="FeatureCollection"===p.type&&(null==(u=p.features[0])?void 0:u.geometry))){e.next=22;break}e.t0=(o=g.a.fromJSON(Object(x.b)(y.type)),y.type),e.next="Point"===e.t0?13:"LineString"===e.t0||"MultiPoint"===e.t0?15:"MultiLineString"===e.t0||"Polygon"===e.t0?17:"MultiPolygon"===e.t0?19:20;break;case 13:return b=y.coordinates,e.abrupt("break",20);case 15:return b=y.coordinates[0],e.abrupt("break",20);case 17:return b=y.coordinates[0][0],e.abrupt("break",20);case 19:b=y.coordinates[0][0][0];case 20:(v=/<[^>]*pos[^>]*> *(-?\d+(?:\.\d+)?) (-?\d+(?:\.\d+)?)/.exec(d.data))&&(m=b[0].toFixed(3),j=b[1].toFixed(3),O=parseFloat(v[1]).toFixed(3),m===parseFloat(v[2]).toFixed(3)&&j===O&&(c=!0));case 22:return e.abrupt("return",{geometryType:o,swapXY:c});case 23:case"end":return e.stop()}}),e)}))),ee.apply(this,arguments)}function te(e,t,r){return re.apply(this,arguments)}function re(){return(re=Object(l.a)(a.a.mark((function e(t,r,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=ne,e.t1=r,e.next=4,Object(f.default)(t,{responseType:"text",query:Object(i.a)({SERVICE:"WFS",REQUEST:"DescribeFeatureType",VERSION:F,TYPENAME:r},null==n?void 0:n.customParameters),signal:null==n?void 0:n.signal});case 4:return e.t2=e.sent.data,e.abrupt("return",(0,e.t0)(e.t1,e.t2));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e,t){var r=ce(e).name,n=oe(t);le(n);var a=p(Object(_.a)(n.firstElementChild,{element:function(e){return{name:e.getAttribute("name"),typeName:ce(e.getAttribute("type")).name}}}),(function(e){return e.name===r}));if(Object(d.j)(a)){var i=p(Object(_.a)(n.firstElementChild,{complexType:function(e){return e}}),(function(e){return e.getAttribute("name")===a.typeName}));if(Object(d.j)(i))return function(e){var t,r,n,a,i=[],s=[],o=Object(_.a)(e,{complexContent:{extension:{sequence:{element:function(e){return e}}}}}),c=Object(u.a)(o);try{for(c.s();!(a=c.n()).done;){var l=a.value,f=l.getAttribute("name");if(f){var p=void 0,d=void 0;if(l.hasAttribute("type")?p=ce(l.getAttribute("type")).name:Object(_.b)(l,{simpleType:{restriction:function(e){return p=ce(e.getAttribute("base")).name,{maxLength:function(e){d=+e.getAttribute("value")}}}}}),p){var y="true"===l.getAttribute("nillable"),b=!1;switch(p.toLowerCase()){case"integer":case"nonpositiveinteger":case"negativeinteger":case"long":case"int":case"short":case"byte":case"nonnegativeinteger":case"unsignedlong":case"unsignedint":case"unsignedshort":case"unsignedbyte":case"positiveinteger":s.push(new w.a({name:f,alias:f,type:"integer",nullable:y}));break;case"float":case"double":case"decimal":s.push(new w.a({name:f,alias:f,type:"double",nullable:y}));break;case"boolean":case"string":case"gyearmonth":case"gyear":case"gmonthday":case"gday":case"gmonth":case"anyuri":case"qname":case"notation":case"normalizedstring":case"token":case"language":case"idrefs":case"entities":case"nmtoken":case"nmtokens":case"name":case"ncname":case"id":case"idref":case"entity":case"duration":case"time":s.push(new w.a({name:f,alias:f,type:"string",nullable:y,length:null!=(t=d)?t:255}));break;case"datetime":case"date":s.push(new w.a({name:f,alias:f,type:"date",nullable:y,length:null!=(r=d)?r:36}));break;case"pointpropertytype":n="point",b=!0;break;case"multipointpropertytype":n="multipoint",b=!0;break;case"curvepropertytype":case"multicurvepropertytype":case"multilinestringpropertytype":n="polyline",b=!0;break;case"surfacepropertytype":case"multisurfacepropertytype":case"multipolygonpropertytype":n="polygon",b=!0;break;case"geometrypropertytype":case"multigeometrypropertytype":b=!0,i.push(new h.a(P,"geometry type '".concat(p,"' is not supported"),{type:(new XMLSerializer).serializeToString(e)}));break;default:i.push(new h.a(A,"Unknown field type '".concat(p,"'"),{type:(new XMLSerializer).serializeToString(e)}))}b&&s.push(new w.a({name:f,alias:f,type:"geometry",nullable:y}))}}}}catch(x){c.e(x)}finally{c.f()}for(var v=0,m=s;v<m.length;v++){var g=m[v];if("integer"===g.type&&!g.nullable&&ae.has(g.name.toLowerCase())){g.type="oid";break}}return{geometryType:n,fields:s,errors:i}}(i)}throw new h.a(M,"Type '".concat(e,"' not found in document"),{document:(new XMLSerializer).serializeToString(n)})}var ae=new Set(["objectid","fid"]);function ie(e,t,r,n){return se.apply(this,arguments)}function se(){return(se=Object(l.a)(a.a.mark((function e(t,r,n,i){var s,u,o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.default)(t,{responseType:"text",query:ue(r,n,i),signal:null==i?void 0:i.signal});case 2:if(s=e.sent,u=(u=s.data).replace(/": +(-?\d+),(\d+)(,)?/g,'": $1.$2$3'),e.prev=5,null==i||null==(o=i.dateFields)||!o.length){e.next=9;break}return c=new Set(i.dateFields),e.abrupt("return",JSON.parse(u,(function(e,t){return c.has(e)?j(t):t})));case 9:return e.abrupt("return",JSON.parse(u));case 12:throw e.prev=12,e.t0=e.catch(5),new h.a(E,"Error while parsing the\xa0response",{response:u,error:e.t0});case 15:case"end":return e.stop()}}),e,null,[[5,12]])})))).apply(this,arguments)}function ue(e,t,r){return Object(i.a)({SERVICE:"WFS",REQUEST:"GetFeature",VERSION:F,TYPENAMES:e,OUTPUTFORMAT:t,SRSNAME:"EPSG:4326",STARTINDEX:null==r?void 0:r.startIndex,COUNT:null==r?void 0:r.count},null==r?void 0:r.customParameters)}function oe(e){return(new DOMParser).parseFromString(e.trim(),"text/xml")}function ce(e){var t=e.split(":"),r=Object(s.a)(t,2),n=r[0],a=r[1];return{prefix:a?n:"",name:null!=a?a:n}}function le(e){var t,r;if(Object(_.b)(e.firstElementChild,{Exception:function(e){return t=e.getAttribute("exceptionCode"),{ExceptionText:function(e){r=e.textContent}}}}),t)throw new h.a("wfs-layer:".concat(t),r)}}}]);
//# sourceMappingURL=56.9adda5c8.chunk.js.map