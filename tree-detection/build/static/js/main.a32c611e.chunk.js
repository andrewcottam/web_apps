(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[32],{454:function(e,t,s){},455:function(e,t,s){},610:function(e,t){function s(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}s.keys=function(){return[]},s.resolve=s,e.exports=s,s.id=610},611:function(e,t,s){"use strict";s.r(t);var a=s(3),i=s.n(a),r=s(258),n=s.n(r),o=(s(454),s(455),s(22)),c=s(2),l=s(4),h=s(8),d=s(5),p=s(6),u=s(324),m=s.n(u),_=s(656),b=s(657),g=s(423),v=s.n(g),f=s(329),y=s.n(f),w=s(427),j=s(125),x=s(17),k=function(e){Object(d.a)(s,e);var t=Object(p.a)(s);function s(e){var a;return Object(c.a)(this,s),(a=t.call(this,e)).state={feature_collection:null},a}return Object(l.a)(s,[{key:"componentDidUpdate",value:function(e){var t=this;this.props.map&&!this.masks_layer&&Object(j.loadModules)(["esri/layers/GraphicsLayer","esri/Graphic","esri/geometry/Polygon","esri/geometry/Point"]).then((function(e){var s=Object(o.a)(e,4),a=s[0],i=s[1],r=s[2],n=s[3];t.masks_layer=new a({visible:!1}),t.boxes_layer=new a({visible:!1}),t.scores_layer=new a({visible:!1}),t.areas_layer=new a({visible:!1}),t.sub_layers=[t.masks_layer,t.boxes_layer,t.scores_layer,t.areas_layer],t.props.map.addMany(t.sub_layers),t.Graphic=i,t.Polygon=r,t.Point=n})),this.props.visible!==e.visible&&(this.sub_layers.forEach((function(e){t.props.visible||(e.visible=t.props.visible)})),this.props.visible&&(this.props.map.reorder(this.masks_layer,this.props.view.allLayerViews.length-1),this.props.map.reorder(this.boxes_layer,this.props.view.allLayerViews.length-1),this.props.map.reorder(this.scores_layer,this.props.view.allLayerViews.length-1),this.props.map.reorder(this.areas_layer,this.props.view.allLayerViews.length-1),this.boxes_layer.visible=this.props.show_boxes,this.masks_layer.visible=this.props.show_masks,this.scores_layer.visible=this.props.show_scores,this.areas_layer.visible=this.props.show_areas)),this.props.show_boxes!==e.show_boxes&&(this.boxes_layer.visible=this.props.show_boxes),this.props.show_masks!==e.show_masks&&(this.masks_layer.visible=this.props.show_masks),this.props.show_scores!==e.show_scores&&(this.scores_layer.visible=this.props.show_scores),this.props.show_areas!==e.show_areas&&(this.areas_layer.visible=this.props.show_areas),this.props.area_range_value!==e.area_range_value&&this.filter(this.features,"area",this.props.area_range_value[0],this.props.area_range_value[1]),this.props.score_range_value!==e.score_range_value&&this.filter(this.features,"score",this.props.score_range_value[0],this.props.score_range_value[1])}},{key:"filter",value:function(e,t,s,a){var i,r=e.filter((function(e){return e.properties[t]>=s&&e.properties[t]<=a})).map((function(e){return e.properties.id}));this.sub_layers.forEach((function(e){e.graphics.forEach((function(e){i=!!r.includes(e.id),e.visible=i}))}))}},{key:"createPolygon",value:function(e){var t={type:"polygon",rings:e};return new this.Polygon(t)}},{key:"createPolygonGraphic",value:function(e,t,s,a,i,r){var n=s.concat([a]),o={type:"simple-fill",color:s.concat([i]),outline:{color:n,width:r}},c=this.createPolygon(t);return new this.Graphic({id:e.properties.id,geometry:c,symbol:o})}},{key:"createMaskGraphic",value:function(e,t){return this.createPolygonGraphic(e,e.geometry.coordinates,t,.5,.3,.5)}},{key:"createBoundingBoxGraphic",value:function(e,t){var s=this.createPolygon(e.geometry.coordinates).extent,a=[[s.xmin,s.ymin],[s.xmin,s.ymax],[s.xmax,s.ymax],[s.xmax,s.ymin],[s.xmin,s.ymin]];return this.createPolygonGraphic(e,a,t,.5,0,2)}},{key:"createTextGraphic",value:function(e,t,s,a,i){var r,n,o,c=t.geometry.extent;switch(i){case"ul":r=new this.Point({type:"point",latitude:c.ymax,longitude:c.xmin}),n=9,o=-7;break;case"ur":r=new this.Point({type:"point",latitude:c.ymax,longitude:c.xmax}),n=-14,o=-7}var l={type:"text",color:s,haloColor:"black",haloSize:"4px",text:a,xoffset:n,yoffset:o,font:{size:8}};return new this.Graphic({id:e.properties.id,geometry:r,symbol:l})}},{key:"createAllGraphics",value:function(e){var t=e.properties.color.split(","),s=this.createMaskGraphic(e,t);this.masks_layer.add(s);var a=this.createBoundingBoxGraphic(e,t);this.boxes_layer.add(a),t=[255,255,255];var i=this.createTextGraphic(e,a,t,parseFloat(e.properties.score.toFixed(2))+"%","ul");this.scores_layer.add(i);var r=this.createTextGraphic(e,a,t,parseInt(e.properties.area,10)+"m2","ur");this.areas_layer.add(r)}},{key:"addFeaturesAsGraphics",value:function(e){var t=this;this.features=e,this.already_rendered||(e.forEach((function(e){t.createAllGraphics(e)})),this.already_rendered=!0)}},{key:"removeAllGraphics",value:function(){this.sub_layers&&this.sub_layers.forEach((function(e){e.removeAll()})),this.already_rendered=!1}},{key:"render",value:function(){var e=this.props.feature_collection;return(!e||e&&0===e.length)&&this.removeAllGraphics(),e&&e.features&&e.features.length>0&&e.features[0].hasOwnProperty("geometry")&&this.Graphic&&this.addFeaturesAsGraphics(e.features),Object(x.jsx)("div",{})}}]),s}(a.Component),O=function(e){Object(d.a)(s,e);var t=Object(p.a)(s);function s(){return Object(c.a)(this,s),t.apply(this,arguments)}return Object(l.a)(s,[{key:"componentDidUpdate",value:function(e){var t=this;this.props.map&&!this.layer&&Object(j.loadModules)(["esri/config","esri/request","esri/layers/BaseDynamicLayer","dojo/_base/lang","dojo/io-query","dojo/dom-style","dojo/request","esri/core/watchUtils"]).then((function(e){var s=Object(o.a)(e,8),a=s[0],i=s[1],r=s[2],n=(s[3],s[4],s[5],s[6],s[7]);a.request.trustedServers.push("https://labs.restor.eco:8081"),a.request.trustedServers.push("https://d50eafb1ad8c430796ecbee59f964ec3.vfs.cloud9.eu-central-1.amazonaws.com:8081");var c=r.createSubclass({properties:{mapUrl:null,mapParameters:null},constructor:function(e){var t=this;n.whenTrue(e.view,"stationary",(function(e){t.visible&&t.set_blob(void 0)}))},getImageUrl:function(e,t,s){var a=this._prepareQuery(this.mapParameters,e,t,s),i=this._joinUrlVariables(a);return this.mapUrl+"?"+i},_prepareQuery:function(e,t,s,a){var i={width:s,height:a,wkid:t.spatialReference.isWebMercator?3857:t.spatialReference.wkid,xmin:t.xmin,xmax:t.xmax,ymin:t.ymin,ymax:t.ymax};return this._replace({},e,i)},_replace:function(e,t,s){return Object.keys(t).forEach((function(a){e[a]=Object.keys(s).reduce((function(e,t){return e.replace("{"+t+"}",s[t])}),t[a])})),e},_joinUrlVariables:function(e){return Object.keys(e).reduce((function(t,s){return t+(t?"&":"")+s+"="+e[s]}),"")},set_blob:function(e){this.blob=e,this.blob_set&&this.blob_set(e)},fetchImageFromGEE:function(e,t,s){var a=this,r=this.getImageUrl(e,t,s);return i(r,{responseType:"image"}).then((function(e){return a.context.drawImage(e.data,0,0,t,s),a.canvas.toBlob((function(e){a.set_blob(e)})),a.canvas}))},fetchImageDataFromCache:function(){if(this.canvas)return this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height)},imageToBlackAndWhite:function(){if(this.canvas){this.get_black_and_white_image=!0;for(var e=this.fetchImageDataFromCache(),t=0;t<this.canvas.height;t++)for(var s=0;s<this.canvas.width;s++){var a=4*t*this.canvas.width+4*s,i=(e.data[a]+e.data[a+1]+e.data[a+2])/3;e.data[a]=i,e.data[a+1]=i,e.data[a+2]=i}this.canvas.getContext("2d").putImageData(e,0,0),this.refresh()}},fetchImage:function(e,t,s){return this.canvas||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=s),this.get_black_and_white_image?this.canvas:this.fetchImageFromGEE(e,t,s)}});t.layer=new c({mapUrl:"https://google-earth-engine-server-ny43uciwwa-oc.a.run.app/ogc",mapParameters:{service:"WMS",request:"GetMap",format:"image/png",transparent:"TRUE",styles:"",version:"1.3.0",layers:t.props.layers,width:"{width}",height:"{height}",srs:"EPSG:{wkid}",bbox:"{xmin},{ymin},{xmax},{ymax}",bands:t.props.bands},view:t.props.view,blob_set:t.props.blob_set,visible:!1,tcd_layer:!0,copyright:t.props.copyright}),t.props.map.add(t.layer)})),this.props.visible!==e.visible&&(this.layer.visible=this.props.visible)}},{key:"render",value:function(){return Object(x.jsx)("div",{})}}]),s}(a.Component),S=O,C=function(e){Object(d.a)(s,e);var t=Object(p.a)(s);function s(){return Object(c.a)(this,s),t.apply(this,arguments)}return Object(l.a)(s,[{key:"getLayer",value:function(){}},{key:"componentDidUpdate",value:function(e){var t=this;if(this.props.map&&!this.layer&&Object(j.loadModules)(["esri/layers/WebTileLayer","esri/layers/support/TileInfo","esri/core/watchUtils"]).then((function(e){var s=Object(o.a)(e,3),a=s[0],i=s[1],r=s[2];t.WaybackTileInfo=i.create({scales:[591657527.591555,295828763.7957775,147914381.89788875,73957190.94894437,36978595.47447219,18489297.737236094,9244648.868618047,4622324.434309023,2311162.2171545117,1155581.1085772559,577790.5542886279,288895.27714431396,144447.63857215698,72223.81928607849,36111.909643039246,18055.954821519623,9027.977410759811,4513.988705379906]}),t.waybackLayer=a.createSubclass({constructor:function(e){var t=this;r.whenTrue(e.view,"stationary",(function(s){t.visible&&t.set_blob(void 0),t.updating_handler=r.whenFalse(e.view,"updating",(function(e){t.visible&&(t.blob||t.create_blob())}))})),r.whenFalse(e.view,"stationary",(function(e){t.updating_handler&&t.updating_handler.remove()}))},create_blob:function(){var e=this;this.view.takeScreenshot({layers:[this]}).then((function(t){var s=t.data.data[3];255!==s&&console.error("The tiled layer has not loaded properly before being sent for TCD. Results may be affected. Alpha value of "+s);var a=t.data.width,i=t.data.height,r=document.createElement("canvas");r.width=a,r.height=i,r.getContext("2d").putImageData(t.data,0,0),r.toBlob((function(t){e.set_blob(t)}))}))},set_blob:function(e){this.blob=e,this.blob_set&&this.blob_set(e)},imageToBlackAndWhite:function(){this.get_black_and_white_image=!0;for(var e=this.fetchImageDataFromCache(),t=0;t<this.canvas.height;t++)for(var s=0;s<this.canvas.width;s++){var a=4*t*this.canvas.width+4*s,i=(e.data[a]+e.data[a+1]+e.data[a+2])/3;e.data[a]=i,e.data[a+1]=i,e.data[a+2]=i}this.canvas.getContext("2d").putImageData(e,0,0),this.refresh()}})})),this.props.visible!==e.visible&&this.layer&&(this.layer.visible=this.props.visible),this.props.urlTemplate!==e.urlTemplate){this.layer=new this.waybackLayer({urlTemplate:this.props.urlTemplate,view:this.props.view,blob_set:this.props.blob_set,visible:!0,tcd_layer:!0,copyright:this.props.copyright,id:"tcd_layer"}),"https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/8249/{level}/{row}/{col}"===this.props.urlTemplate&&(this.layer.tileInfo=this.WaybackTileInfo);var s=this.props.map.findLayerById("tcd_layer");s&&this.props.map.remove(s),this.props.map.add(this.layer,0)}}},{key:"render",value:function(){return Object(x.jsx)("div",{})}}]),s}(a.Component),T=C,E=s(640),N=s(418),I=s(118),M=s(419),G=s(644),L=s(428),A=s(21);var P=s(658),D=function(e){Object(d.a)(s,e);var t=Object(p.a)(s);function s(){return Object(c.a)(this,s),t.apply(this,arguments)}return Object(l.a)(s,[{key:"render",value:function(){return Object(x.jsxs)("div",{className:"checkbox_container",children:[Object(x.jsx)("input",{className:"checkbox",id:this.props.id,type:"checkbox",checked:this.props.checked,onChange:this.props.onChange.bind(this),disabled:this.props.disabled}),Object(x.jsx)("label",{for:this.props.id,className:"checkbox_label",children:this.props.label})]})}}]),s}(i.a.Component),U=D,W=s(652),F=s(659),B=s(653),z=s(654),R=function(e){Object(d.a)(s,e);var t=Object(p.a)(s);function s(){return Object(c.a)(this,s),t.apply(this,arguments)}return Object(l.a)(s,[{key:"getHistogram",value:function(e){if(this.props.feature_collection&&this.props.feature_collection.features){var t=function(e){var t,s=1/0,a=-1/0;if(e.sort(),1===e.length)s=0,a=e[0],t=2;else if(2===e.length)s=e[0],t=((a=e[1])-s)/2;else{t=25;var i,r=Object(A.a)(e);try{for(r.s();!(i=r.n()).done;){var n=i.value;n<s?s=n:n>a&&(a=n)}}catch(p){r.e(p)}finally{r.f()}}var o,c=Math.ceil((a-s+1)/t),l=new Array(c).fill(0),h=Object(A.a)(e);try{for(h.s();!(o=h.n()).done;){var d=o.value;l[Math.floor((d-s)/t)]++}}catch(p){h.e(p)}finally{h.f()}return{histogram:l,size:t}}(this.props.feature_collection.features.map((function(e){return e.properties.area})));return t.histogram.map((function(e,s){return{area:(s+1)*t.size,count:e}}))}}},{key:"get_slider_values",value:function(e,t,s,a){var i=e.map((function(e){return e.properties[t]})),r=parseInt(i.sort((function(e,t){return e-t}))[i.length-1],10)+1;return{max:r,marks:[{value:0,label:"0"+a},{value:r/2,label:s},{value:r,label:r+a}]}}},{key:"render",value:function(){if(this.props.feature_collection&&this.props.feature_collection.features){var e=this.get_slider_values(this.props.feature_collection.features,"area","Tree crown area","m2"),t=this.props.feature_collection.features.length>0&&this.props.feature_collection.features[0].hasOwnProperty("properties")&&this.props.feature_collection.features[0].properties.hasOwnProperty("area"),s=t?this.getHistogram(this.props.feature_collection):[],a=t?Object(x.jsxs)(E.a,{width:600,height:355,data:s,margin:{top:5,right:20,left:10,bottom:5},style:{left:"-32px"},children:[Object(x.jsx)(N.a,{dataKey:"area",type:"number",tick:{fontSize:14},axisLine:{strokeWidth:2},children:Object(x.jsx)(I.a,{value:"Canopy area (m2)",offset:0,position:"insideBottom",style:{fontSize:17,fill:"rgba(0, 0, 0, 0.87)"}})}),Object(x.jsx)(M.a,{tick:{fontSize:14},axisLine:{strokeWidth:2},children:Object(x.jsx)(I.a,{value:"Count",angle:"-90",style:{fontSize:17,fill:"rgba(0, 0, 0, 0.87)"}})}),Object(x.jsx)(G.a,{stroke:"#f5f5f5"}),Object(x.jsx)(L.a,{dataKey:"count",barSize:20,fill:"#1976d2",isAnimationActive:!1})]}):null,i="static_image"!==this.props.mode&&this.props.feature_collection.features.length>0?Object(x.jsxs)(P.a,{sx:{width:200},className:"controls_container",children:[Object(x.jsx)(F.a,{children:Object(x.jsx)(B.a,{control:Object(x.jsx)(z.a,{checked:this.props.show_crowns,size:"small",onChange:this.props.changeCrowns}),label:""})}),Object(x.jsxs)("div",{children:[Object(x.jsx)("div",{className:"checkbox",children:Object(x.jsx)(U,{id:"show_boxes_cb",label:"Boxes",checked:this.props.show_boxes,size:"small",onChange:this.props.changeBoxes,disabled:!this.props.show_crowns})}),Object(x.jsx)("div",{className:"checkbox",children:Object(x.jsx)(U,{id:"show_masks_cb",label:"Masks",checked:this.props.show_masks,size:"small",onChange:this.props.changeMasks,disabled:!this.props.show_crowns})}),Object(x.jsxs)("div",{className:"checkbox",children:[Object(x.jsx)(U,{id:"show_scores_cb",label:"Scores",checked:this.props.show_scores,size:"small",onChange:this.props.changeScores,disabled:!this.props.show_crowns}),Object(x.jsx)("span",{className:"slider_container",children:Object(x.jsx)(W.a,{value:this.props.score_range_value,onChange:this.props.change_score_range,step:.01,valueLabelDisplay:"auto",size:"small",max:1,style:{display:this.props.show_crowns&&this.props.show_scores?"block":"none",marginBottom:"0px"}})})]}),Object(x.jsxs)("div",{className:"checkbox",children:[Object(x.jsx)(U,{id:"show_areas_cb",label:"Areas",checked:this.props.show_areas,size:"small",onChange:this.props.changeAreas,disabled:!this.props.show_crowns}),Object(x.jsx)("span",{className:"slider_container",children:Object(x.jsx)(W.a,{value:this.props.area_range_value,onChange:this.props.change_area_range,valueLabelDisplay:"auto",size:"small",max:e.max,style:{display:this.props.show_crowns&&this.props.show_areas?"block":"none",marginBottom:"0px"}})})]})]})]}):null;return Object(x.jsxs)("div",{className:"tree_crown_outer",children:[Object(x.jsxs)("div",{className:"trees_detected",children:[Object(x.jsx)("div",{className:"trees_detected_count",children:this.props.feature_collection.features.length}),Object(x.jsx)("span",{className:"trees_detected_count2",children:" trees detected"})]}),a,Object(x.jsx)("div",{className:"center"}),i]})}return Object(x.jsx)("div",{})}}]),s}(a.Component),V=R,q=s(424),J=function(e){Object(d.a)(s,e);var t=Object(p.a)(s);function s(e){var a;return Object(c.a)(this,s),(a=t.call(this,e)).state={image_url:null,detecting_tree_crowns:!1,getting_dynamic_image:!1,status_text:"",mode:"static_image",show_crowns:!0,show_boxes:!0,show_masks:!0,show_scores:!0,show_areas:!0,area_range_value:[0,800],score_range_value:[0,800],gee_copyright:"\xa9 2014 WWF Aerial Survey of the Congo. WWF/NASA JPL/KfW/BMUB/BMZ",wms_copyright:"Imagery from OpenAerialMap. Maxar Products. WorldView2 \xa9 2021 Maxar Technologies.",lng:112.84350452926209,lat:-8.054735059174224,wms_endpoint:""},a.handleMapLoad=a.handleMapLoad.bind(Object(h.a)(a)),a.area_threshold=1e3,a}return Object(l.a)(s,[{key:"setModel",value:function(e){var t="cambridge"===e?"Alejandro Coca-Castro, Matt Allen, 2021 Tree crown detection (The Enviromental AI Book). http://acocac.github.io/environmental-ai-book/forest/modelling/forest-modelling-treecrown_deepforest.html Online; accessed Mon Nov 01 2021":"Restor Tree Detection model 2023";this.setState({model:e,model_copyright:t}),this.SERVER="localhost"===document.location.hostname?"http://localhost:8081":"https://"+e+"---tree-detection-server-ny43uciwwa-oc.a.run.app",this.GET_INSTANCES_IMAGE_ENDPOINT=this.SERVER+"/getInstancesImage",this.GET_INSTANCES_ENDPOINT=this.SERVER+"/getInstances"}},{key:"componentDidMount",value:function(){var e=this;Object(j.loadModules)(["esri/core/watchUtils","esri/geometry/support/webMercatorUtils"]).then((function(t){var s=Object(o.a)(t,2),a=s[0],i=s[1];e.watchUtils=a,e.webMercatorUtils=i})),this.setModel("cambridge")}},{key:"handleMapLoad",value:function(e,t){var s=this;this.setState({map:e,view:t}),this.watchUtils.whenTrue(t,"stationary",(function(){t.extent&&(s.ul=[t.extent.xmin,t.extent.ymax],s.lr=[t.extent.xmax,t.extent.ymin]),s.searchWidget||(s.searchWidget=new q.a({view:t}),t.ui.add(s.searchWidget,{position:"top-right",index:2}))}))}},{key:"changeToGeeImage",value:function(){var e=this;this.state.view.goTo({center:[22.624934,-1.781699],zoom:19}).then((function(t){e.setState({mode:"gee_layer",status_text:"Getting image from Google Earth Engine..",feature_collection:void 0})}))}},{key:"changeToMaxarImage",value:function(){var e=this;this.state.view.goTo({center:[112.84350452926209,-8.054735059174224],zoom:18}).then((function(t){e.setState({mode:"webtile_layer",status_text:"Getting image from OpenAerialMap..",feature_collection:void 0,wms_endpoint:"https://tiles.openaerialmap.org/61b94e69b26de1000596d605/1/61b94e69b26de1000596d607/{z}/{x}/{y}",wms_copyright:"Imagery from OpenAerialMap. Maxar Products. WorldView2 \xa9 2021 Maxar Technologies."})}))}},{key:"changeToWaybackImage",value:function(){var e=this;this.state.view.goTo({center:[-2.503135,10.064652],zoom:18}).then((function(t){e.setState({mode:"webtile_layer",status_text:"Getting image from Wayback..",feature_collection:void 0,wms_endpoint:"https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/8249/{level}/{row}/{col}",wms_copyright:"ESRI Wayback"})}))}},{key:"startTCD",value:function(){this.setState({detecting_tree_crowns:!0,feature_collection:void 0})}},{key:"openFilePicker",value:function(e){this.setState({mode:"static_image"}),this.inputElement.click()}},{key:"imageChosen",value:function(e){this.raw_image_url=URL.createObjectURL(e.target.files[0]),this.selectedFile=e.target.files[0],this.setState({image_url:this.raw_image_url},this.processImage)}},{key:"processImage",value:function(e){var t=this;this.startTCD();var s=new FormData;s.append("data",this.selectedFile),m.a.post(this.GET_INSTANCES_IMAGE_ENDPOINT,s,{withCredentials:!0}).then((function(e){t.classified_image_url=t.SERVER+"/outputs/"+e.data.instances_image,t.active_image_is_classified=!0,t.setState({image_url:t.classified_image_url});var s=t.filterFeatures(e.data.feature_collection);t.fc=s}))}},{key:"imageLoaded",value:function(e){"blob:"!==e.currentTarget.src.substr(0,5)&&this.setState({detecting_tree_crowns:!1,feature_collection:this.fc})}},{key:"switchImages",value:function(){this.active_image_is_classified?this.setState({image_url:this.raw_image_url}):this.setState({image_url:this.classified_image_url}),this.active_image_is_classified=!this.active_image_is_classified}},{key:"blob_set",value:function(e){var t=!e;this.setState({getting_dynamic_image:t}),e||this.setState({feature_collection:void 0}),this.blob=e}},{key:"processDynamicImage",value:function(){var e=this;return new Promise((function(t,s){e.startTCD();var a=new FormData;a.append("data",e.blob);var i=e.webMercatorUtils.xyToLngLat(e.state.view.extent.xmin,e.state.view.extent.ymax),r=e.webMercatorUtils.xyToLngLat(e.state.view.extent.xmax,e.state.view.extent.ymin);a.append("ul",i),a.append("lr",r),m.a.post(e.GET_INSTANCES_ENDPOINT,a,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}}).then((function(s){var a=e.filterFeatures(s.data.instances_geojson);e.setState({feature_collection:a,detecting_tree_crowns:!1}),t(s)}))}))}},{key:"filterFeatures",value:function(e){var t=this;return e.features=e.features.filter((function(e){return e.properties.area<t.area_threshold})),e}},{key:"downloadInstances",value:function(){var e=new File([JSON.stringify(this.state.feature_collection)],"tree_crowns.geojson",{type:"text/plain"}),t=document.createElement("a"),s=URL.createObjectURL(e);t.href=s,t.download=e.name,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(s)}},{key:"changeCrowns",value:function(e){this.setState({show_crowns:e.nativeEvent.srcElement.checked})}},{key:"changeBoxes",value:function(e){this.setState({show_boxes:e.nativeEvent.srcElement.checked})}},{key:"changeMasks",value:function(e){this.setState({show_masks:e.nativeEvent.srcElement.checked})}},{key:"changeScores",value:function(e){this.setState({show_scores:e.nativeEvent.srcElement.checked})}},{key:"changeAreas",value:function(e){this.setState({show_areas:e.nativeEvent.srcElement.checked})}},{key:"change_area_range",value:function(e,t){this.setState({area_range_value:t})}},{key:"change_score_range",value:function(e,t){this.setState({score_range_value:t})}},{key:"changeModel",value:function(e){this.setModel(e)}},{key:"render",value:function(){var e=this;return Object(x.jsxs)("div",{className:"maindiv",children:[Object(x.jsx)("table",{children:Object(x.jsx)("tbody",{children:Object(x.jsxs)("tr",{children:[Object(x.jsxs)("td",{className:"imageCell",children:[Object(x.jsx)("input",{ref:function(t){return e.inputElement=t},type:"file",onChange:this.imageChosen.bind(this),style:{display:"none"}}),Object(x.jsx)("img",{src:this.state.image_url,className:"image",alt:"drone",style:{width:"700px",height:"700px",display:this.state.image_url&&"static_image"===this.state.mode?"block":"none"},onLoad:this.imageLoaded.bind(this)}),Object(x.jsxs)(w.a,{className:"esri_map",onLoad:this.handleMapLoad,mapProperties:{basemap:{portalItem:{id:"96cff8b8e48d45548833f19e29f09943"}}},viewProperties:{center:[this.state.lng,this.state.lat],zoom:19},style:{height:"static_image"===this.state.mode?1:700},children:[Object(x.jsx)(S,{detecting_tree_crowns:this.state.detecting_tree_crowns,blob_set:this.blob_set.bind(this),visible:"gee_layer"===this.state.mode,layers:"WWF/carbon-maps/raw-data/imagery",bands:"b1,b2,b3",copyright:this.state.gee_copyright}),Object(x.jsx)(T,{detecting_tree_crowns:this.state.detecting_tree_crowns,blob_set:this.blob_set.bind(this),visible:"webtile_layer"===this.state.mode,urlTemplate:this.state.wms_endpoint,copyright:this.state.wms_copyright}),Object(x.jsx)(k,{feature_collection:this.state.feature_collection,visible:"static_image"!==this.state.mode&&this.state.show_crowns,show_boxes:this.state.show_boxes,show_masks:this.state.show_masks,show_scores:this.state.show_scores,show_areas:this.state.show_areas,area_range_value:this.state.area_range_value,score_range_value:this.state.score_range_value})]}),Object(x.jsx)("div",{className:"imageBackground"}),Object(x.jsxs)("div",{className:"status_box",style:{display:this.state.detecting_tree_crowns?"block":"none"},children:[Object(x.jsx)(y.a,{sx:{fontSize:60},className:"spin"}),Object(x.jsx)("div",{className:"status_text",children:"Detecting trees.."}),Object(x.jsx)("div",{className:"geeLoading",style:{display:"static_image"!==this.state.mode&&this.state.getting_dynamic_image?"block":"none"},children:this.state.status_text})]}),Object(x.jsxs)("div",{className:"status_box",style:{display:"static_image"!==this.state.mode&&this.state.getting_dynamic_image?"block":"none"},children:[Object(x.jsx)(y.a,{sx:{fontSize:60},className:"spin",style:{color:"gray"}}),Object(x.jsx)("div",{className:"geeLoading",children:this.state.status_text})]})]}),Object(x.jsx)("td",{className:"buttonCell",children:Object(x.jsxs)("div",{children:[Object(x.jsx)(_.a,{variant:"contained",type:"file",onClick:this.openFilePicker.bind(this),disabled:this.state.getting_dynamic_image||this.state.detecting_tree_crowns,title:"Upload drone image for tree detection",children:"Drone"}),Object(x.jsx)("span",{className:"span"}),Object(x.jsx)(_.a,{variant:"contained",onClick:this.changeToGeeImage.bind(this),disabled:this.state.getting_dynamic_image||this.state.detecting_tree_crowns,title:"Use aerial imagery from Google Earth Engine for tree detection",children:"Aerial"}),Object(x.jsx)("span",{className:"span"}),Object(x.jsx)(_.a,{variant:"contained",onClick:this.changeToMaxarImage.bind(this),disabled:this.state.getting_dynamic_image||this.state.detecting_tree_crowns,title:"Use Maxar WorldView2 imagery for tree detection",children:"Satelllite"}),Object(x.jsx)("span",{className:"span"}),Object(x.jsx)(_.a,{variant:"contained",onClick:this.changeToWaybackImage.bind(this),disabled:this.state.getting_dynamic_image||this.state.detecting_tree_crowns,title:"Use ESRI Wayback for tree detection",children:"Wayback"}),Object(x.jsx)("span",{className:"span"}),Object(x.jsx)(_.a,{variant:"contained",onClick:this.processDynamicImage.bind(this),disabled:"static_image"===this.state.mode||this.state.getting_dynamic_image||this.state.detecting_tree_crowns,color:"error",title:"Start tree detection on the imagery",children:"Go"}),Object(x.jsx)("span",{className:"span"}),Object(x.jsx)(b.a,{"aria-label":"delete",color:"primary",onClick:this.downloadInstances.bind(this),disabled:!this.state.feature_collection,title:"Download the detected trees as Geojson",children:Object(x.jsx)(v.a,{})}),Object(x.jsx)(V,{mode:this.state.mode,feature_collection:this.state.feature_collection,changeCrowns:this.changeCrowns.bind(this),changeBoxes:this.changeBoxes.bind(this),changeMasks:this.changeMasks.bind(this),changeScores:this.changeScores.bind(this),changeAreas:this.changeAreas.bind(this),show_crowns:this.state.show_crowns,show_boxes:this.state.show_boxes,show_masks:this.state.show_masks,show_scores:this.state.show_scores,show_areas:this.state.show_areas,change_area_range:this.change_area_range.bind(this),area_range_value:this.state.area_range_value,score_range_value:this.state.score_range_value,change_score_range:this.change_score_range.bind(this)})]})})]})})}),Object(x.jsxs)("div",{className:"model",children:[Object(x.jsxs)("span",{className:"modelname",children:[Object(x.jsx)("label",{htmlFor:"model",children:"Tree detection model: \xa0"}),Object(x.jsxs)("select",{name:"model",id:"model",onChange:function(t){return e.changeModel(t.target.value)},value:this.state.model,children:[Object(x.jsx)("option",{value:"cambridge",children:"Cambridge"}),Object(x.jsx)("option",{value:"restor",children:"Restor"})]})]}),Object(x.jsx)("span",{className:"citation",children:this.state.model_copyright})]})]})}}]),s}(a.Component);var K=function(){return Object(x.jsx)("div",{className:"App",children:Object(x.jsx)(J,{})})},H=function(e){e&&e instanceof Function&&s.e(125).then(s.bind(null,1084)).then((function(t){var s=t.getCLS,a=t.getFID,i=t.getFCP,r=t.getLCP,n=t.getTTFB;s(e),a(e),i(e),r(e),n(e)}))};n.a.render(Object(x.jsx)(i.a.StrictMode,{children:Object(x.jsx)(K,{})}),document.getElementById("root")),H()}},[[611,33,34]]]);
//# sourceMappingURL=main.a32c611e.chunk.js.map