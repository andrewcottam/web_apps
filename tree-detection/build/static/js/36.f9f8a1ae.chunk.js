(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[36,5,7,16,24,62,98,115],{1057:function(e,t,r){"use strict";r.r(t),r.d(t,"constructAssociationMetaDataFeatureSetFromUrl",(function(){return ne})),r.d(t,"constructFeatureSet",(function(){return te})),r.d(t,"constructFeatureSetFromPortalItem",(function(){return pe})),r.d(t,"constructFeatureSetFromRelationship",(function(){return ae})),r.d(t,"constructFeatureSetFromUrl",(function(){return ee})),r.d(t,"convertToFeatureSet",(function(){return de})),r.d(t,"createFeatureSetCollectionFromMap",(function(){return oe})),r.d(t,"createFeatureSetCollectionFromService",(function(){return ue})),r.d(t,"getPortal",(function(){return le})),r.d(t,"initialiseMetaDataCache",(function(){return Y})),r.d(t,"lookupUser",(function(){return ce}));var n=r(13),a=r(2),i=r(4),s=r(5),o=r(6),u=r(21),l=r(83),c=r(82),d=r(921),p=r(859),f=r(210),h=r(737),y=r(922),b=r(860),v=r(741),m=r(734),g=r(861),O=r(707),j=r(761),_=r(818),w=r(736);var S=function(){function e(){Object(a.a)(this,e)}return Object(i.a)(e,[{key:"clone",value:function(){var t=new e;return t.field=this.field,t.tofieldname=this.tofieldname,t.typeofstat=this.typeofstat,t.workingexpr=this.workingexpr,t}},{key:"toStatisticsName",value:function(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}],[{key:"parseStatField",value:function(t,r,n){var a=new e;a.field=t;var i=w.WhereClause.create(r,n),s=function(e){if("function"===e.parseTree.type){if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(e.parseTree.args.value.length>1)throw new Error("Statistic does not have 1 or 0 Parameters");var t=w.WhereClause.create(Object(j.j)(e.parseTree.args.value[0],O.a.Standardised,e.parameters),e.fieldsIndex);return{name:e.parseTree.name,expr:t}}return null}(i);if(null===s)throw new Error("Invalid Statistic Function");var o=s.name.toUpperCase().trim();if("MIN"===o){if(a.typeofstat="MIN",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("MAX"===o){if(a.typeofstat="MAX",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("COUNT"===o)a.typeofstat="COUNT",a.workingexpr=s.expr;else if("STDEV"===o){if(a.typeofstat="STDDEV",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("SUM"===o){if(a.typeofstat="SUM",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("MEAN"===o){if(a.typeofstat="AVG",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("AVG"===o){if(a.typeofstat="AVG",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else{if("VAR"!==o)throw new Error("Invalid Statistic Function");if(a.typeofstat="VAR",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}return a}}]),e}(),k=r(842),x=r(30),F=r(45),I=r(666),T=r(672);function E(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}var C=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e))._decodedStatsfield=[],n._decodedGroupbyfield=[],n._candosimplegroupby=!0,n.phsyicalgroupbyfields=[],n.objectIdField="ROW__ID",n._internalObjectIdField="ROW__ID",n._adaptedFields=[],n.declaredClass="esri.arcade.featureset.actions.Aggregate",n._uniqueIds=1,n._maxQuery=10,n._maxProcessing=10,n._parent=e.parentfeatureset,n._config=e,n}return Object(i.a)(r,[{key:"isTable",value:function(){return!0}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._getFilteredSet("",null,null,null,e).then((function(e){return t._wset=e,t._wset})):Object(x.t)(this._wset)}},{key:"_isInFeatureSet",value:function(){return O.b.InFeatureSet}},{key:"nextUniqueName",value:function(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;var t="T"+this._uniqueIds.toString();return e[t]=1,t}},{key:"convertToEsriFieldType",value:function(e){return e}},{key:"_initialiseFeatureSet",value:function(){var e={},t=!1,r=1,n=this._parent?this._parent.getFieldsIndex():new T.a([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){for(var a=!1,i=0;i<this._config.groupbyfields.length;i++)if(this._config.groupbyfields[i].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}if(!1===a)for(var s=0;s<this._config.statsfields.length;s++)if(this._config.statsfields[s].name.toLowerCase()===this.objectIdField.toLowerCase()){a=!0;break}!1===a?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}var o,l=Object(u.a)(this._config.statsfields);try{for(l.s();!(o=l.n()).done;){var c=o.value,d=new S;d.field=c.name,d.tofieldname=c.name,d.workingexpr=c.expression instanceof w.WhereClause?c.expression:w.WhereClause.create(c.expression,n),d.typeofstat=E(c.statistic),this._decodedStatsfield.push(d)}}catch(B){l.e(B)}finally{l.f()}this._decodedGroupbyfield=[];var p,f=Object(u.a)(this._config.groupbyfields);try{for(f.s();!(p=f.n()).done;){var h=p.value,b={name:h.name,singlefield:null,tofieldname:h.name,expression:h.expression instanceof w.WhereClause?h.expression:w.WhereClause.create(h.expression,n)};this._decodedGroupbyfield.push(b)}}catch(B){f.e(B)}finally{f.f()}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";var v,m=Object(u.a)(this._parent.fields);try{for(m.s();!(v=m.n()).done;){e[v.value.name.toUpperCase()]=1}}catch(B){m.e(B)}finally{m.f()}this.types=null}else this.geometryType=O.m.point,this.typeIdField="",this.types=null,this.spatialReference=new F.a({wkid:4326});this.fields=[];var g=new S;g.field=this.nextUniqueName(e),g.tofieldname=this.objectIdField,g.workingexpr=w.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex()),g.typeofstat="MIN",this._decodedStatsfield.push(g);var _,k=Object(u.a)(this._decodedGroupbyfield);try{for(k.s();!(_=k.n()).done;){var x=_.value,C=new I.a;if(x.name=this.nextUniqueName(e),C.name=x.tofieldname,C.alias=C.name,Object(j.c)(x.expression)){var R=this._parent.getField(Object(j.i)(x.expression,O.a.Standardised));if(!R)throw new Error("Field is not present for Aggregation");x.name=R.name,x.singlefield=R.name,this.phsyicalgroupbyfields.push(R.name),C.type=R.type}else{C.type=this.convertToEsriFieldType(Object(j.f)(x.expression,this._parent.fields));var N=new I.a;N.name=x.name,N.alias=N.name,this.phsyicalgroupbyfields.push(x.name),this._adaptedFields.push(new y.d(N,x.expression)),this._candosimplegroupby=!1}this.fields.push(C)}}catch(B){k.e(B)}finally{k.f()}if(this._adaptedFields.length>0){var P,D=Object(u.a)(this._parent.fields);try{for(D.s();!(P=D.n()).done;){var A=P.value;this._adaptedFields.push(new y.c(A))}}catch(B){D.e(B)}finally{D.f()}}for(var L=0;L<this._decodedStatsfield.length;L++){var M=new I.a,q=null,G=this._decodedStatsfield[L];G.field=this.nextUniqueName(e),G.tofieldname===this.objectIdField&&(this._internalObjectIdField=G.field),M.name=G.tofieldname,M.alias=M.name;var V=null!==G.workingexpr&&Object(j.c)(G.workingexpr)?Object(j.i)(G.workingexpr,O.a.Standardised):"";switch(this._decodedStatsfield[L].typeofstat){case"SUM":if(""!==V){if(!(q=this._parent.getField(V)))throw new Error("Field is not present for Aggregation");M.type=q.type}else M.type="double";break;case"MIN":case"MAX":if(""!==V){if(!(q=this._parent.getField(V)))throw new Error("Field is not present for Aggregation");M.type=q.type}else M.type="double";break;case"COUNT":M.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==V&&!(q=this._parent.getField(V)))throw new Error("Field is not present for Aggregation");M.type="double"}this.fields.push(M)}}},{key:"_canDoAggregates",value:function(){return Object(x.t)(!1)}},{key:"_getFeatures",value:function(e,t,r,n){var a=this;-1!==t&&this._featureCache[t];var i=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(e,i)?this._expandPagedSet(e,i,0,0,n).then((function(){return a._getFeatures(e,t,r,n)})):Object(x.t)("success")}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;if(""!==e)return Object(x.t)(new m.a([],[],!0,null));var s=null,o={ordered:!1,nowhereclause:!1};return this._ensureLoaded().then((function(){if(null!==r)for(var e=0;e<i._decodedStatsfield.length;e++)if(!0===Object(j.h)(r,i._decodedStatsfield[e].tofieldname)){o.nowhereclause=!0,r=null;break}if(null!==n){o.ordered=!0;for(var t=0;t<i._decodedStatsfield.length;t++)if(!0===n.scanForField(i._decodedStatsfield[t].tofieldname)){n=null,o.ordered=!1;break}if(null!==n){var a,s=Object(u.a)(i._decodedGroupbyfield);try{for(s.s();!(a=s.n()).done;){var l=a.value;if(null===l.singlefield&&!0===n.scanForField(l.tofieldname)){n=null,o.ordered=!1;break}}}catch(c){s.e(c)}finally{s.f()}}}return!1===i._candosimplegroupby?Object(x.t)(!1):i._parent._canDoAggregates(i.phsyicalgroupbyfields,i._decodedStatsfield,"",null,null)})).then((function(e){if(e){var t=null;r&&(t=i._reformulateWhereClauseWithoutGroupByFields(r));var u=null;return n&&(u=i._reformulateOrderClauseWithoutGroupByFields(n)),i._parent._getAggregatePagesDataSourceDefinition(i.phsyicalgroupbyfields,i._decodedStatsfield,"",null,t,u,i._internalObjectIdField).then((function(e){return i._checkCancelled(a),s=!0===o.nowhereclause?new m.a(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===o.ordered&&e._ordered,i._clonePageDefinition(e.pagesDefinition)):new m.a(e._candidates.slice(0),e._known.slice(0),!0===o.ordered&&e._ordered,i._clonePageDefinition(e.pagesDefinition))}))}var l=i._parent;if(i._adaptedFields.length>0&&(l=new y.a({parentfeatureset:i._parent,adaptedFields:i._adaptedFields,extraFilter:null})),!0===o.nowhereclause)s=new m.a(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:i._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new b.a({parentfeatureset:l,orderbyclause:new g.a(i.phsyicalgroupbyfields.join(",")+","+i._parent.objectIdField+" ASC")})}});else{var c=l;if(null!==r){var d=null;r&&(d=i._reformulateWhereClauseWithoutGroupByFields(r)),c=new p.a({parentfeatureset:c,whereclause:d})}s=new m.a(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:i._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new b.a({parentfeatureset:c,orderbyclause:new g.a(i.phsyicalgroupbyfields.join(",")+","+i._parent.objectIdField+" ASC")})}})}return s}))}},{key:"_reformulateWhereClauseWithoutStatsFields",value:function(e){var t,r=Object(u.a)(this._decodedStatsfield);try{for(r.s();!(t=r.n()).done;){var n=t.value;e=Object(j.g)(e,n.tofieldname,Object(j.i)(n.workingexpr,O.a.Standardised),this._parent.getFieldsIndex())}}catch(a){r.e(a)}finally{r.f()}return e}},{key:"_reformulateWhereClauseWithoutGroupByFields",value:function(e){var t,r=Object(u.a)(this._decodedGroupbyfield);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.tofieldname!==n.name&&(e=Object(j.g)(e,n.tofieldname,Object(j.i)(n.expression,O.a.Standardised),this._parent.getFieldsIndex()))}}catch(a){r.e(a)}finally{r.f()}return e}},{key:"_reformulateOrderClauseWithoutGroupByFields",value:function(e){var t,r=[],n=Object(u.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.tofieldname!==a.name&&r.push({field:a.tofieldname,newfield:a.name})}}catch(i){n.e(i)}finally{n.f()}return r.length>0?e.replaceFields(r):e}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}},{key:"_refineSetBlock",value:function(e,t,r){var n=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQuery))return this._expandPagedSet(e,this._maxQuery,0,0,r).then((function(){return n._refineSetBlock(e,t,r)}));this._checkCancelled(r);e._candidates.length;return this._refineKnowns(e,t),e._candidates.length,e._candidates.length,Object(x.t)(e)}catch(a){return Object(x.s)(a)}}},{key:"_expandPagedSet",value:function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}},{key:"_getPhysicalPage",value:function(e,t,r){var n=this;return!0===e.pagesDefinition.aggregatefeaturesetpagedefinition?Object(x.c)((function(t,a){n._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]).then((function(e){t(e)}),a)})):this._getAgregagtePhysicalPage(e,t,r).then((function(e){var t,r=Object(u.a)(e);try{for(r.s();!(t=r.n()).done;){var a,i=t.value,s={geometry:i.geometry,attributes:{}},o=Object(u.a)(n._decodedGroupbyfield);try{for(o.s();!(a=o.n()).done;){var l=a.value;s.attributes[l.tofieldname]=i.attributes[l.name]}}catch(h){o.e(h)}finally{o.f()}var c,d=Object(u.a)(n._decodedStatsfield);try{for(d.s();!(c=d.n()).done;){var p=c.value;s.attributes[p.tofieldname]=i.attributes[p.field]}}catch(h){d.e(h)}finally{d.f()}n._featureCache[s.attributes[n.objectIdField]]=new f.a(s)}}catch(h){r.e(h)}finally{r.f()}return e.length}))}},{key:"_sequentialGetPhysicalItem",value:function(e,t,r,n){var a=this;return Object(x.c)((function(i,s){null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?i(n.length):a._nextAggregateItem(e,t,r,n,(function(s){null===s?i(n.length):(t-=1,i(a._sequentialGetPhysicalItem(e,t,r,n)))}),s)}))}},{key:"_nextAggregateItem",value:function(e,t,r,n,a,i){var s=this;try{Object(h.q)(e.pagesDefinition.internal.iterator.next()).then((function(o){if(null===o)if(null!==e.pagesDefinition.internal.workingItem){var u=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(u),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(u.attributes[s.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,a(null)}else e.pagesDefinition.internal.fullyResolved=!0,a(null);else{var l=s._generateAggregateHash(o);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[o],id:l};else{if(l!==e.pagesDefinition.internal.workingItem.id){var c=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(c),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(c.attributes[s.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[o],id:l},void a(c)}e.pagesDefinition.internal.workingItem.features.push(o)}s._nextAggregateItem(e,t,r,n,a,i)}}),i)}catch(o){i(o)}}},{key:"_calculateFieldStat",value:function(e,t,r){for(var n=[],a=0;a<e.features.length;a++)if(null!==t.workingexpr){var i=t.workingexpr.calculateValue(e.features[a]);null!==i&&n.push(i)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=Object(_.a)("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=Object(_.a)("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=Object(_.a)("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VAR":r.attributes[t.tofieldname]=Object(_.a)("var",n,-1);break;case"STDDEV":r.attributes[t.tofieldname]=Object(_.a)("stddev",n,-1);break;case"AVG":r.attributes[t.tofieldname]=Object(_.a)("avg",n,-1)}return!0}},{key:"_calculateAndAppendAggregateItem",value:function(e){var t,r={attributes:{},geometry:null},n=Object(u.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var a=t.value,i=a.singlefield?e.features[0].attributes[a.singlefield]:a.expression.calculateValue(e.features[0]);r.attributes[a.tofieldname]=i}}catch(p){n.e(p)}finally{n.f()}var s,o=Object(u.a)(this._decodedStatsfield);try{for(o.s();!(s=o.n()).done;){var l=s.value;this._calculateFieldStat(e,l,r)}}catch(p){o.e(p)}finally{o.f()}for(var c=[],d=0;d<this._decodedStatsfield.length;d++)c.push(this._calculateFieldStat(e,this._decodedStatsfield[d],r));return this._featureCache[r.attributes[this.objectIdField]]=new f.a({attributes:r.attributes,geometry:r.geometry}),r}},{key:"_generateAggregateHash",value:function(e){var t,r="",n=Object(u.a)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var a=t.value,i=a.singlefield?e.attributes[a.singlefield]:a.expression.calculateValue(e);r+=null==i?":":":"+i.toString()}}catch(s){n.e(s)}finally{n.f()}return Object(k.a)(r,k.b.String)}},{key:"_stat",value:function(){return Object(x.t)({calculated:!1})}},{key:"getFeatureByObjectId",value:function(){return Object(x.t)(null)}}],[{key:"registerAction",value:function(){v.a._featuresetFunctions.groupby=function(e,t){return new r({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}]),r}(v.a),R=r(888),N=r(923),P=r(855),D=r(62),A=r(735),L=r(680),M=r(769),q=r(668),G=r(670),V=r(714),B=r(908),U=r(722),J=r(767),W=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",n._removeGeometry=!1,n._overrideFields=null,n.formulaCredential=null,n._pageJustIds=!1,n._requestStandardised=!1,n._useDefinitionExpression=!0,e.spatialReference&&(n.spatialReference=e.spatialReference),n._transparent=!0,n._maxProcessing=1e3,n._layer=e.layer,n._wset=null,void 0!==e.outFields&&(n._overrideFields=e.outFields),void 0!==e.includeGeometry&&(n._removeGeometry=!1===e.includeGeometry),n}return Object(i.a)(r,[{key:"_maxQueryRate",value:function(){return O.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(e){this._pageJustIds=e}},{key:"convertQueryToLruCacheKey",value:function(e){var t=Object(O.q)(e.toJSON());return Object(k.a)(t,k.b.String)}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=Object(x.c)((function(t,r){try{if(!0===e._layer.loaded)return e._initialiseFeatureSet(),void t(e);e._layer.when().then((function(){try{e._initialiseFeatureSet(),t(e)}catch(n){r(n)}}),r),e._layer.load()}catch(n){r(n)}}))),this._loadPromise}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{var e,t=[],r=Object(u.a)(this.fields);try{for(r.s();!(e=r.n()).done;){var n=e.value;if("oid"===n.type)t.push(n);else{var a,i=Object(u.a)(this._layer.outFields);try{for(i.s();!(a=i.n()).done;){if(a.value.toLowerCase()===n.name.toLowerCase()){t.push(n);break}}}catch(m){i.e(m)}finally{i.f()}}}}catch(m){r.e(m)}finally{r.f()}this.fields=t}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var s,o=[],l=[],c=Object(u.a)(this.fields);try{for(c.s();!(s=c.n()).done;){var d=s.value;if("oid"===d.type)o.push(d),l.push(d.name);else{var p,f=Object(u.a)(this._overrideFields);try{for(f.s();!(p=f.n()).done;){if(p.value.toLowerCase()===d.name.toLowerCase()){o.push(d),l.push(d.name);break}}}catch(m){f.e(m)}finally{f.f()}}}}catch(m){c.e(m)}finally{c.f()}this.fields=o,this._overrideFields=l}if(this._layer.source&&this._layer.source.sourceJSON){var h=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=O.a.StandardisedNoInterval,null!=h&&h>=10.61&&(this._databaseType=O.a.Standardised)):null!=h&&(h>=10.5&&(this._databaseType=O.a.StandardisedNoInterval,this._requestStandardised=!0),h>=10.61&&(this._databaseType=O.a.Standardised))}this.objectIdField=this._layer.objectIdField;var y,b=Object(u.a)(this.fields);try{for(b.s();!(y=b.n()).done;){var v=y.value;"global-id"===v.type&&(this.globalIdField=v.name)}}catch(m){b.e(m)}finally{b.f()}this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}},{key:"_isInFeatureSet",value:function(){return O.b.InFeatureSet}},{key:"_refineSetBlock",value:function(e){return Object(x.t)(e)}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,null,e)})).then((function(e){return t._wset=e,e})):Object(x.t)(this._wset)}},{key:"_runDatabaseProbe",value:function(e){var t=this;return Object(x.c)((function(r,n){try{t._ensureLoaded().then((function(){try{var a=new G.a;a.where=e.replace("OBJECTID",t._layer.objectIdField),t._layer.queryObjectIds(a).then((function(){r(!0)}),(function(){try{r(!1)}catch(e){n(e)}}))}catch(i){n(i)}}))}catch(a){n(a)}}))}},{key:"_canUsePagination",value:function(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}},{key:"_cacheableFeatureSetSourceKey",value:function(){return this._layer.url}},{key:"pbfSupportedForQuery",value:function(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode}},{key:"queryPBF",value:function(e){return e.quantizationParameters={mode:"edit"},Object(U.executeQueryPBF)(this._layer.parsedUrl,e,new M.b({})).then((function(e){return q.default.fromJSON(Object(L.g)(e.data)).unquantize()}))}},{key:"gdbVersion",get:function(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion?this._layer.gdbVersion:"SDE.DEFAULT":""}},{key:"nativeCapabilities",value:function(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}},{key:"executeQuery",value:function(e,t){var r=this,n=new B.a({url:this._layer.parsedUrl.path}),a="execute"===t&&this.pbfSupportedForQuery(e),i=null;if(this.recentlyUsedQueries){var s=this.convertQueryToLruCacheKey(e);null===(i=this.recentlyUsedQueries.getFromCache(s))&&(i=!0!==a?n[t](e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(s,i),i=i.catch((function(e){throw r.recentlyUsedQueries.removeFromCache(s),e})))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===i&&(i=!0!==a?n[t](e):this.queryPBF(e)),i}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this.databaseType().then((function(s){if(i.isTable()&&t&&null!==e&&""!==e)return new m.a([],[],!0,null);if(i._canUsePagination())return i._getFilteredSetUsingPaging(e,t,r,n,a);var o="",u=!1;null!==n&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(o=n.constructClause(),u=!0);var l=new G.a;return l.where=null===r?null===t?"1=1":"":Object(j.i)(r,s),i._requestStandardised&&(l.sqlFormat="standard"),l.spatialRelationship=i._makeRelationshipEnum(e),l.outSpatialReference=i.spatialReference,l.orderByFields=""!==o?o.split(","):null,l.geometry=null===t?null:t,l.relationParameter=i._makeRelationshipParam(e),i.executeQuery(l,"executeForIds").then((function(e){return null===e&&(e=[]),i._checkCancelled(a),new m.a([],e,u,null)}))}))}},{key:"_expandPagedSet",value:function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}},{key:"_getFilteredSetUsingPaging",value:function(e,t,r,n,a){var i=this;try{var s="",o=!1;return null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(s=n.constructClause(),o=!0),this.databaseType().then((function(n){var u=null===r?null===t?"1=1":"":Object(j.i)(r,n);i._layer.definitionExpression&&i._useDefinitionExpression&&(u=""!==u?"(("+i._layer.definitionExpression+") AND ("+u+"))":i._layer.definitionExpression);var l=i._maxQueryRate(),c=i._layer.capabilities.query.maxRecordCount;void 0!==c&&c<l&&(l=c);var d=null;if(!0===i._pageJustIds)d=new m.a([],["GETPAGES"],o,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:i._layer.objectIdField,resultRecordCount:l,resultOffset:0,geometry:null===t?null:t,where:u,orderByFields:s,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{var p=!0;!0===i._removeGeometry&&(p=!1);var f=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i._layer.outFields?i._layer.outFields:["*"]);d=new m.a([],["GETPAGES"],o,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:f.join(","),resultRecordCount:l,resultOffset:0,geometry:null===t?null:t,where:u,orderByFields:s,returnGeometry:p,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return i._expandPagedSet(d,l,0,1,a).then((function(){return d}))}))}catch(u){return Object(x.s)(u)}}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}},{key:"_getPhysicalPage",value:function(e,t,r){var n=this;try{var a=e.pagesDefinition.internal.lastRetrieved,i=a,s=e.pagesDefinition.internal.lastPage,o=new G.a;return this._requestStandardised&&(o.sqlFormat="standard"),o.spatialRelationship=e.pagesDefinition.spatialRel,o.relationParameter=e.pagesDefinition.relationParam,o.outFields=e.pagesDefinition.outFields.split(","),o.num=e.pagesDefinition.resultRecordCount,o.start=e.pagesDefinition.internal.lastPage,o.geometry=e.pagesDefinition.geometry,o.where=e.pagesDefinition.where,o.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,o.returnGeometry=e.pagesDefinition.returnGeometry,o.outSpatialReference=this.spatialReference,this.executeQuery(o,"execute").then((function(t){if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==s)return"done";for(var o=0;o<t.features.length;o++)e.pagesDefinition.internal.set[i+o]=t.features[o].attributes[n._layer.objectIdField];if(!1===n._pageJustIds)for(var u=0;u<t.features.length;u++)n._featureCache[t.features[u].attributes[n._layer.objectIdField]]=t.features[u];return(void 0===t.exceededTransferLimit&&t.features.length!==e.pagesDefinition.resultRecordCount||!1===t.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+t.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"}))}catch(u){return Object(x.s)(u)}}},{key:"_fieldsIncludingObjectId",value:function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.indexOf("*")>-1)return t;var r,n=!1,a=Object(u.a)(t);try{for(a.s();!(r=a.n()).done;){if(r.value.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}}}catch(i){a.e(i)}finally{a.f()}return!1===n&&t.push(this.objectIdField),t}},{key:"_getFeatures",value:function(e,t,r,n){var a=this,i=[];try{if(-1!==t&&void 0===this._featureCache[t]&&i.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate()))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,n).then((function(){return a._getFeatures(e,t,r,n)}));for(var s=0,o=e._lastFetchedIndex;o<e._known.length;o++){if(e._lastFetchedIndex+=1,s++,void 0===this._featureCache[e._known[o]]){var u=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){var l=this._layer._mode;if(void 0!==l._featureMap[e._known[o]]){var c=l._featureMap[e._known[o]];null!==c&&(u=!0,this._featureCache[e._known[o]]=c)}}if(!1===u&&(e._known[o]!==t&&i.push(e._known[o]),i.length>=this._maxProcessingRate()-1))break}if(s>=r&&0===i.length)break}if(0===i.length)return Object(x.t)("success");try{var d=new G.a;return this._requestStandardised&&(d.sqlFormat="standard"),d.objectIds=i,d.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),d.returnGeometry=!0,!0===this._removeGeometry&&(d.returnGeometry=!1),d.outSpatialReference=this.spatialReference,this.executeQuery(d,"execute").then((function(e){if(a._checkCancelled(n),void 0!==e.error)return Object(x.s)(new Error(e.error));for(var t=0;t<e.features.length;t++)a._featureCache[e.features[t].attributes[a._layer.objectIdField]]=e.features[t];return"success"}))}catch(p){return Object(x.s)(p)}}catch(p){return Object(x.s)(p)}}},{key:"_getDistinctPages",value:function(e,t,r,n,a,i,s,o,u){var l=this;return this._ensureLoaded().then((function(){return l.databaseType()})).then((function(c){for(var d=r.parseTree.column,p=0;p<l._layer.fields.length;p++)if(l._layer.fields[p].name.toLowerCase()===d.toLowerCase()){d=l._layer.fields[p].name;break}var f=new G.a;l._requestStandardised&&(f.sqlFormat="standard");var h=null===i?null===a?"1=1":"":Object(j.i)(i,c);return l._layer.definitionExpression&&l._useDefinitionExpression&&(h=""!==h?"(("+l._layer.definitionExpression+") AND ("+h+"))":l._layer.definitionExpression),f.where=h,f.spatialRelationship=l._makeRelationshipEnum(n),f.relationParameter=l._makeRelationshipParam(n),f.geometry=null===a?null:a,f.returnDistinctValues=!0,f.returnGeometry=!1,f.outFields=[d],l.executeQuery(f,"execute").then((function(c){if(l._checkCancelled(u),!c.hasOwnProperty("features"))return Object(x.s)(new Error("Unnexected Result querying statistics from layer"));for(var p=!1,f=0;f<l._layer.fields.length;f++)if(l._layer.fields[f].name===d){"date"===l._layer.fields[f].type&&(p=!0);break}for(var h=0;h<c.features.length;h++){if(p){var y=c.features[h].attributes[d];null!==y?o.push(new Date(y)):o.push(y)}else o.push(c.features[h].attributes[d]);if(o.length>=s)break}return 0===c.features.length?o:c.features.length===l._layer.capabilities.query.maxRecordCount&&o.length<s?l._getDistinctPages(e+c.features.length,t,r,n,a,i,s,o,u).then((function(e){return{calculated:!0,result:e}})):o}))}))}},{key:"_distinctStat",value:function(e,t,r,n,a,i,s){return this._getDistinctPages(0,e,t,r,n,a,i,[],s).then((function(e){return{calculated:!0,result:e}}))}},{key:"isTable",value:function(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType}},{key:"_countstat",value:function(e,t,r,n){var a=this;return this.databaseType().then((function(e){var i=new G.a;if(a._requestStandardised&&(i.sqlFormat="standard"),a.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};var s=null===n?null===r?"1=1":"":Object(j.i)(n,e);return a._layer.definitionExpression&&a._useDefinitionExpression&&(s=""!==s?"(("+a._layer.definitionExpression+") AND ("+s+"))":a._layer.definitionExpression),i.where=s,i.where=s,i.spatialRelationship=a._makeRelationshipEnum(t),i.relationParameter=a._makeRelationshipParam(t),i.geometry=null===r?null:r,i.returnGeometry=!1,a.executeQuery(i,"executeForCount").then((function(e){return{calculated:!0,result:e}}))}))}},{key:"_stats",value:function(e,t,r,n,a,i,s){var o=this;return this._ensureLoaded().then((function(){var u=o._layer.capabilities&&o._layer.capabilities.query&&!0===o._layer.capabilities.query.supportsSqlExpression,l=o._layer.capabilities&&o._layer.capabilities.query&&!0===o._layer.capabilities.query.supportsStatistics,c=o._layer.capabilities&&o._layer.capabilities.query&&!0===o._layer.capabilities.query.supportsDistinct;return"count"===e?c?o._countstat(e,r,n,a):{calculated:!1}:!1===l||!1===Object(j.c)(t)&&!1===u||!1===t.isStandardized?""!==r||null!==a?{calculated:!1}:o._manualStat(e,t,i,s):"distinct"===e?!1===c?""!==r||null!==a?{calculated:!1}:o._manualStat(e,t,i,s):o._distinctStat(e,t,r,n,a,i,s):o.databaseType().then((function(i){if(o.isTable()&&n&&null!==r&&""!==r)return{calculated:!0,result:null};var s=new G.a;o._requestStandardised&&(s.sqlFormat="standard");var u=null===a?null===n?"1=1":"":Object(j.i)(a,i);o._layer.definitionExpression&&o._useDefinitionExpression&&(u=""!==u?"(("+o._layer.definitionExpression+") AND ("+u+"))":o._layer.definitionExpression),s.where=u,s.spatialRelationship=o._makeRelationshipEnum(r),s.relationParameter=o._makeRelationshipParam(r),s.geometry=null===n?null:n;var l=new V.a;l.statisticType=Object(_.c)(e),l.onStatisticField=Object(j.i)(t,i),l.outStatisticFieldName="ARCADE_STAT_RESULT",s.returnGeometry=!1;var c="ARCADE_STAT_RESULT";return s.outStatistics=[l],o.executeQuery(s,"execute").then((function(e){if(!e.hasOwnProperty("features")||0===e.features.length)return Object(x.s)(new Error("Unnexected Result querying statistics from layer"));for(var t=!1,r=0;r<e.fields.length;r++)if("ARCADE_STAT_RESULT"===e.fields[r].name.toUpperCase()){c=e.fields[r].name,"date"===e.fields[r].type&&(t=!0);break}if(t){var n=e.features[0].attributes[c];return null!==n&&(n=new Date(e.features[0].attributes[c])),{calculated:!0,result:n}}return{calculated:!0,result:e.features[0].attributes[c]}}))}))}))}},{key:"_stat",value:function(e,t,r,n,a,i,s){return this._stats(e,t,r,n,a,i,s)}},{key:"_canDoAggregates",value:function(e,t){var r=this;return this._ensureLoaded().then((function(){var e=!1,n=r._layer.capabilities&&r._layer.capabilities.query&&!0===r._layer.capabilities.query.supportsSqlExpression;if(void 0!==r._layer.capabilities&&null!==r._layer.capabilities.query&&!0===r._layer.capabilities.query.supportsStatistics&&!0===r._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(var a=0;a<t.length-1;a++)null!==t[a].workingexpr&&(!1===t[a].workingexpr.isStandardized||!1===Object(j.c)(t[a].workingexpr)&&!1===n)&&(e=!1);return!1!==e}))}},{key:"_makeRelationshipEnum",value:function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}},{key:"_makeRelationshipParam",value:function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,s){var o=this;return this._ensureLoaded().then((function(){return o.databaseType()})).then((function(u){var l="",c=!1,d=!1;null!==i&&o._layer.capabilities&&o._layer.capabilities.query&&!0===o._layer.capabilities.query.supportsOrderBy&&(l=i.constructClause(),d=!0),o._layer.capabilities&&o._layer.capabilities.query&&!1===o._layer.capabilities.query.supportsPagination&&(d=!1,c=!0,l=o._layer.objectIdField);for(var p=[],f=0;f<t.length;f++){var h=new V.a;h.onStatisticField=null!==t[f].workingexpr?Object(j.i)(t[f].workingexpr,u):"",h.outStatisticFieldName=t[f].field,h.statisticType=t[f].toStatisticsName(),p.push(h)}""===l&&(l=e.join(","));var y=o._maxQueryRate(),b=o._layer.capabilities.query.maxRecordCount;void 0!==b&&b<y&&(y=b);var v=null===a?null===n?"1=1":"":Object(j.i)(a,u);return o._layer.definitionExpression&&o._useDefinitionExpression&&(v=""!==v?"(("+o._layer.definitionExpression+") AND ("+v+"))":o._layer.definitionExpression),new m.a([],["GETPAGES"],d,{groupbypage:!0,spatialRel:o._makeRelationshipEnum(r),relationParam:o._makeRelationshipParam(r),outFields:["*"],useOIDpagination:c,generatedOid:s,resultRecordCount:y,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:p,geometry:null===n?null:n,where:v,orderByFields:l,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}))}},{key:"_getAgregagtePhysicalPage",value:function(e,t,r){var n=this;try{var a=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(a=""!==a?"("+a+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());var i=e.pagesDefinition.internal.lastRetrieved,s=i,o=e.pagesDefinition.internal.lastPage,u=new G.a;return this._requestStandardised&&(u.sqlFormat="standard"),u.where=a,u.spatialRelationship=e.pagesDefinition.spatialRel,u.relationParameter=e.pagesDefinition.relationParam,u.outFields=e.pagesDefinition.outFields,u.outStatistics=e.pagesDefinition.outStatistics,u.geometry=e.pagesDefinition.geometry,u.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,u.num=e.pagesDefinition.resultRecordCount,u.start=e.pagesDefinition.internal.lastPage,u.returnGeometry=e.pagesDefinition.returnGeometry,u.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,this.isTable()&&u.geometry&&u.spatialRelationship?Object(x.t)([]):this.executeQuery(u,"execute").then((function(t){if(n._checkCancelled(r),!t.hasOwnProperty("features"))return Object(x.s)(new Error("Unnexected Result querying aggregates from layer"));var a=[];if(e.pagesDefinition.internal.lastPage!==o)return[];for(var u=0;u<t.features.length;u++)e.pagesDefinition.internal.set[s+u]=t.features[u].attributes[e.pagesDefinition.generatedOid];for(var l=0;l<t.features.length;l++)a.push(new f.a({attributes:t.features[l].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===t.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=t.features[t.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===t.exceededTransferLimit&&t.features.length!==e.pagesDefinition.resultRecordCount||!1===t.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=i+t.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,a}))}catch(l){return Object(x.s)(l)}}},{key:"relationshipMetaData",value:function(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]}},{key:"serviceUrl",value:function(){return Object(O.i)(this._layer.parsedUrl.path)}},{key:"queryAttachments",value:function(e,t,r,n,a){var i=this;if(this._layer.capabilities.data.supportsAttachment&&this._layer.capabilities.operations.supportsQueryAttachments){var s={objectIds:[e],returnMetadata:a};return(t&&t>0||r&&r>0)&&(s.size=[t&&t>0?t:0,r&&r>0?r:t+1]),n&&n.length>0&&(s.attachmentTypes=n),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:s,method:"attachments"}),this._layer.queryAttachments(s).then((function(t){var r=[];return t&&t[e]&&t[e].forEach((function(t){var n=i._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+t.id.toString(),s=null;a&&t.exifInfo&&(s=J.a.convertJsonToArcade(t.exifInfo,!0)),r.push(new P.a(t.id,t.name,t.contentType,t.size,n,s))})),r}))}return Object(x.t)([])}},{key:"queryRelatedFeatures",value:function(e){var t={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields.join(","),returnGeometry:e.returnGeometry.toString()};return void 0!==e.resultOffset&&null!==e.resultOffset&&(t.resultOffset=e.resultOffset.toString()),void 0!==e.resultRecordCount&&null!==e.resultRecordCount&&(t.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(t.orderByFields=e.orderByFields.join(",")),e.objectIds.length>0&&(t.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(t.outSR=JSON.stringify(e.outSpatialReference.toJSON())),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preRequestCallback({layer:this._layer,queryPayload:t,method:"relatedrecords",url:this._layer.parsedUrl.path+"/queryRelatedRecords"}),Object(c.default)(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:t}).then((function(e){if(e.data){var t={},r=e.data;if(r&&r.relatedRecordGroups){var n,a=r.spatialReference,i=Object(u.a)(r.relatedRecordGroups);try{for(i.s();!(n=i.n()).done;){var s,o=n.value,l=o.objectId,c=[],d=Object(u.a)(o.relatedRecords);try{for(d.s();!(s=d.n()).done;){var p=s.value;p.geometry&&(p.geometry.spatialReference=a);var h=new f.a({geometry:p.geometry?Object(D.a)(p.geometry):null,attributes:p.attributes});c.push(h)}}catch(y){d.e(y)}finally{d.f()}t[l]={features:c,exceededTransferLimit:!0===r.exceededTransferLimit}}}catch(y){i.e(y)}finally{i.f()}}return t}return Object(x.s)("Invalid Request")}))}},{key:"getFeatureByObjectId",value:function(e,t){var r=new B.a({url:this._layer.parsedUrl.path}),n=new G.a;return n.outFields=t,n.returnGeometry=!1,n.outSpatialReference=this.spatialReference,n.where=this.objectIdField+"="+e.toString(),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:n,method:"execute"}),r.execute(n).then((function(e){return 1===e.features.length?e.features[0]:null}))}},{key:"getIdentityUser",value:function(){var e=this;return this.load().then((function(){var t,r=null==(t=l.b)?void 0:t.findCredential(e._layer.url);return r?r.userId:null}))}},{key:"getOwningSystemUrl",value:function(){var e=this;return this.load().then((function(){var t,r=null==(t=l.b)?void 0:t.findServerInfo(e._layer.url);if(r)return Object(x.t)(r.owningSystemUrl);var n=e._layer.url,a=n.toLowerCase().indexOf("/rest/services");return(n=a>-1?n.substring(0,a):n)?(n+="/rest/info",Object(x.c)((function(e,t){Object(c.default)(n,{query:{f:"json"}}).then((function(t){var r="";t.data&&t.data.owningSystemUrl&&(r=t.data.owningSystemUrl),e(r)}),(function(t){e("")}))}))):Object(x.t)("")}))}},{key:"getDataSourceFeatureSet",value:function(){var e=new r({layer:this._layer,spatialReference:this.spatialReference,outFields:this._overrideFields,includeGeometry:!this._removeGeometry,lrucache:this.recentlyUsedQueries,interceptor:this.featureSetQueryInterceptor});return e._useDefinitionExpression=!1,e}}],[{key:"create",value:function(e,t,n,a,i){return new r({layer:new A.default({url:e,outFields:null===t?["*"]:t}),spatialReference:n,lrucache:a,interceptor:i})}}]),r}(v.a),Q=r(926),z=r(729),H=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",n._findObjectId=-1,n._requestStandardised=!1,n._removeGeometry=!1,n._overrideFields=null,n.featureObjectId=null,n.relatedLayer=null,n.relationship=null,e.spatialReference&&(n.spatialReference=e.spatialReference),n._transparent=!0,n._maxProcessing=1e3,n._layer=e.layer,n._wset=null,n._findObjectId=e.objectId,n.featureObjectId=e.objectId,n.relationship=e.relationship,n.relatedLayer=e.relatedLayer,void 0!==e.outFields&&(n._overrideFields=e.outFields),void 0!==e.includeGeometry&&(n._removeGeometry=!1===e.includeGeometry),n}return Object(i.a)(r,[{key:"_maxQueryRate",value:function(){return O.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=Object(x.c)((function(t,r){Object(x.b)([e._layer.load(),e.relatedLayer.load()]).then((function(){e._initialiseFeatureSet(),t(e)}),r)}))),this._loadPromise}},{key:"nativeCapabilities",value:function(){return this.relatedLayer.nativeCapabilities()}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this.relatedLayer.geometryType,this.fields=this.relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var e,t=[],r=[],n=Object(u.a)(this.fields);try{for(n.s();!(e=n.n()).done;){var a=e.value;if("oid"===a.type)t.push(a),r.push(a.name);else{var i,s=Object(u.a)(this._overrideFields);try{for(s.s();!(i=s.n()).done;){if(i.value.toLowerCase()===a.name.toLowerCase()){t.push(a),r.push(a.name);break}}}catch(l){s.e(l)}finally{s.f()}}}}catch(l){n.e(l)}finally{n.f()}this.fields=t,this._overrideFields=r}var o=this._layer.nativeCapabilities();o&&(this._databaseType=o.databaseType,this._requestStandardised=o.requestStandardised),this.objectIdField=this.relatedLayer.objectIdField,this.globalIdField=this.relatedLayer.globalIdField,this.hasM=this.relatedLayer.supportsM,this.hasZ=this.relatedLayer.supportsZ,this.typeIdField=this.relatedLayer.typeIdField,this.types=this.relatedLayer.types}},{key:"databaseType",value:function(){var e=this;return this.relatedLayer.databaseType().then((function(){return e._databaseType=e.relatedLayer._databaseType,e._databaseType}))}},{key:"isTable",value:function(){return this.relatedLayer.isTable()}},{key:"_isInFeatureSet",value:function(){return O.b.InFeatureSet}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,null,e)})).then((function(e){return t._wset=e,e})):Object(x.t)(this._wset)}},{key:"_changeFeature",value:function(e){var t,r={},n=Object(u.a)(this.fields);try{for(n.s();!(t=n.n()).done;){var a=t.value;r[a.name]=e.attributes[a.name]}}catch(i){n.e(i)}finally{n.f()}return new f.a({geometry:!0===this._removeGeometry?null:e.geometry,attributes:r})}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this.databaseType().then((function(){if(i.isTable()&&t&&null!==e&&""!==e)return new m.a([],[],!0,null);var s=i._layer.nativeCapabilities();if(!1===s.canQueryRelated)return new m.a([],[],!0,null);if(s.capabilities.queryRelated&&s.capabilities.queryRelated.supportsPagination)return i._getFilteredSetUsingPaging(e,t,r,n,a);var o="",u=!1;null!==n&&s.capabilities&&s.capabilities.queryRelated&&!0===s.capabilities.queryRelated.supportsOrderBy&&(o=n.constructClause(),u=!0);var l=new z.a;l.objectIds=[i._findObjectId];var c=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i.relatedLayer.fields?i.relatedLayer.fields.map((function(e){return e.name})):["*"]);l.outFields=c,l.relationshipId=i.relationship.id,l.where="1=1";var d=!0;return!0===i._removeGeometry&&(d=!1),l.returnGeometry=d,i._requestStandardised&&(l.sqlFormat="standard"),l.outSpatialReference=i.spatialReference,l.orderByFields=""!==o?o.split(","):null,s.source.queryRelatedFeatures(l).then((function(n){i._checkCancelled(a);for(var s=n[i._findObjectId]?n[i._findObjectId].features:[],o=[],l=0;l<s.length;l++)i._featureCache[s[l].attributes[i._layer.objectIdField]]=s[l],o.push(s[l].attributes[i._layer.objectIdField]);var c=t&&null!==e&&""!==e,d=null!=r;return new m.a(c||d?o:[],c||d?[]:o,u,null)}))}))}},{key:"_fieldsIncludingObjectId",value:function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.indexOf("*")>-1)return t;var r,n=!1,a=Object(u.a)(t);try{for(a.s();!(r=a.n()).done;){if(r.value.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}}}catch(i){a.e(i)}finally{a.f()}return!1===n&&t.push(this.objectIdField),t}},{key:"_getFilteredSetUsingPaging",value:function(e,t,r,n,a){var i=this;try{var s="",o=!1,u=this._layer.nativeCapabilities();return null!==n&&u&&u.capabilities.queryRelated&&!0===u.capabilities.queryRelated.supportsOrderBy&&(s=n.constructClause(),o=!0),this.databaseType().then((function(){var n=i._maxQueryRate(),l=u.capabilities.query.maxRecordCount;void 0!==l&&l<n&&(n=l);var c,d=t&&null!==e&&""!==e,p=null!=r,f=!0;!0===i._removeGeometry&&(f=!1);var h=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i.relatedLayer.fields?i.relatedLayer.fields.map((function(e){return e.name})):["*"]);return c=new m.a(d||p?["GETPAGES"]:[],d||p?[]:["GETPAGES"],o,{outFields:h.join(","),resultRecordCount:n,resultOffset:0,objectIds:[i._findObjectId],where:"1=1",orderByFields:s,returnGeometry:f,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),i._expandPagedSet(c,n,0,0,a).then((function(){return c}))}))}catch(l){return Object(x.s)(l)}}},{key:"_expandPagedSet",value:function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}},{key:"_getPhysicalPage",value:function(e,t,r){var n=this;try{var a=e.pagesDefinition.internal.lastRetrieved,i=a,s=e.pagesDefinition.internal.lastPage,o=this._layer.nativeCapabilities(),u=new z.a;return!0===this._requestStandardised&&(u.sqlFormat="standard"),u.relationshipId=this.relationship.id,u.objectIds=e.pagesDefinition.objectIds,u.resultOffset=e.pagesDefinition.internal.lastPage,u.resultRecordCount=e.pagesDefinition.resultRecordCount,u.outFields=e.pagesDefinition.outFields.split(","),u.where=e.pagesDefinition.where,u.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,u.returnGeometry=e.pagesDefinition.returnGeometry,u.outSpatialReference=this.spatialReference,o.source.queryRelatedFeatures(u).then((function(t){if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==s)return 0;for(var o=t[n._findObjectId]?t[n._findObjectId].features:[],u=0;u<o.length;u++)e.pagesDefinition.internal.set[i+u]=o[u].attributes[n._layer.objectIdField];for(var l=0;l<o.length;l++)n._featureCache[o[l].attributes[n._layer.objectIdField]]=o[l];var c=!t[n._findObjectId]||!1===t[n._findObjectId].exceededTransferLimit;return o.length!==e.pagesDefinition.resultRecordCount&&c&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+o.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,o.length}))}catch(l){return Object(x.s)(l)}}},{key:"_getFeatures",value:function(e,t,r,n){var a=this,i=[];-1!==t&&void 0===this._featureCache[t]&&i.push(t);var s=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,s))return this._expandPagedSet(e,s,0,0,n).then((function(){return a._getFeatures(e,t,r,n)}));for(var o=0,u=e._lastFetchedIndex;u<e._known.length&&(++o<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[u]&&void 0===this._featureCache[e._known[u]]&&(e._known[u]!==t&&i.push(e._known[u]),i.length>r)))&&!(o>=r&&0===i.length);u++);return 0===i.length?Object(x.t)("success"):Object(x.s)(new Error("Unaccounted for Features. Not in Feature Collection"))}},{key:"_refineSetBlock",value:function(e,t,r){return Object(x.t)(e)}},{key:"_stat",value:function(e,t,r,n,a,i,s){return Object(x.t)({calculated:!1})}},{key:"gdbVersion",get:function(){return this.relatedLayer.gdbVersion}},{key:"_canDoAggregates",value:function(e,t,r,n,a){return Object(x.t)(!1)}},{key:"relationshipMetaData",value:function(){return this.relatedLayer.relationshipMetaData()}},{key:"serviceUrl",value:function(){return this.relatedLayer.serviceUrl()}},{key:"queryAttachments",value:function(e,t,r,n,a){return this.relatedLayer.queryAttachments(e,t,r,n,a)}},{key:"getFeatureByObjectId",value:function(e,t){return this.relatedLayer.getFeatureByObjectId(e,t)}},{key:"getOwningSystemUrl",value:function(){return this.relatedLayer.getOwningSystemUrl()}},{key:"getIdentityUser",value:function(){return this.relatedLayer.getIdentityUser()}},{key:"getDataSourceFeatureSet",value:function(){return this.relatedLayer}}]),r}(v.a),K=r(841),Z=r(85),$=r(334);function Y(){null===K.a.applicationCache&&(K.a.applicationCache=new K.a)}function X(e,t){if(K.a.applicationCache){var r=K.a.applicationCache.getLayerInfo(e);if(r)return r.then((function(r){return Object(x.t)(new A.default({url:e,outFields:t,sourceJSON:r}))}));var n=new A.default({url:e,outFields:t}),a=Object(x.c)((function(e,t){n.load().then((function(){e(n.sourceJSON)}),(function(e){t(e)}))}));return K.a.applicationCache&&(K.a.applicationCache.setLayerInfo(e,a),a=a.catch((function(t){throw K.a.applicationCache.clearLayerInfo(e),t}))),a.then((function(){return Object(x.t)(n)}))}return Object(x.t)(new A.default({url:e,outFields:t}))}function ee(e,t,r,n,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return X(e,["*"]).then((function(e){return Object(x.t)(te(e,t,r,n,a,i))}))}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return!0===e._hasMemorySource()?new Q.a({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a,interceptor:i}):new W({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a,interceptor:i})}function re(e){if(null!==K.a.applicationCache){var t=K.a.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=Object(c.default)(e,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return t.layers||(t.layers=[]),t.tables||(t.tables=[]),Object(x.t)(t)}return Object(x.t)({layers:[],tables:[]})}));return null!==K.a.applicationCache&&(K.a.applicationCache.setLayerInfo(e,r),r=r.catch((function(t){throw K.a.applicationCache.clearLayerInfo(e),t}))),r}function ne(e,t){var r={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null};return re(e).then((function(n){if(r.metadata=n,n.controllerDatasetLayers&&void 0!==n.controllerDatasetLayers.utilityNetworkLayerId&&null!==n.controllerDatasetLayers.utilityNetworkLayerId){if(n.layers){var a,i=Object(u.a)(n.layers);try{for(i.s();!(a=i.n()).done;){var s=a.value;r.layerNameLkp[s.id]=s.name}}catch(f){i.e(f)}finally{i.f()}}if(n.tables){var o,l=Object(u.a)(n.tables);try{for(l.s();!(o=l.n()).done;){var d=o.value;r.layerNameLkp[d.id]=d.name}}catch(f){l.e(f)}finally{l.f()}}var p=n.controllerDatasetLayers.utilityNetworkLayerId;return r.networkId=p,function(e,t){var r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==K.a.applicationCache){var n=K.a.applicationCache.getLayerInfo(r);if(null!==n)return n}var a=Object(c.default)(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}}).then((function(e){if(e.data){var t=e.data;if(t.layerDataElements&&t.layerDataElements[0])return t.layerDataElements[0]}throw new Error("Not Found")}));return null!==K.a.applicationCache&&(K.a.applicationCache.setLayerInfo(r,a),a=a.catch((function(e){throw K.a.applicationCache.clearLayerInfo(r),e}))),a}(e,p).then((function(n){if(n){r.queryelem=n,r.queryelem&&r.queryelem.dataElement&&void 0!==r.queryelem.dataElement.schemaGeneration&&(r.unVersion=r.queryelem.dataElement.schemaGeneration),r.lkp={},r.queryelem.dataElement.domainNetworks||(r.queryelem.dataElement.domainNetworks=[]);var a,i=Object(u.a)(r.queryelem.dataElement.domainNetworks);try{for(i.s();!(a=i.n()).done;){var s,o=a.value,l=Object(u.a)(o.edgeSources?o.edgeSources:[]);try{for(l.s();!(s=l.n()).done;){var d=s.value,h={layerId:d.layerId,sourceId:d.sourceId,className:r.layerNameLkp[d.layerId]?r.layerNameLkp[d.layerId]:null};h.className&&(r.lkp[h.className]=h)}}catch(f){l.e(f)}finally{l.f()}var y,b=Object(u.a)(o.junctionSources?o.junctionSources:[]);try{for(b.s();!(y=b.n()).done;){var v=y.value,m={layerId:v.layerId,sourceId:v.sourceId,className:r.layerNameLkp[v.layerId]?r.layerNameLkp[v.layerId]:null};m.className&&(r.lkp[m.className]=m)}}catch(f){b.e(f)}finally{b.f()}}}catch(f){i.e(f)}finally{i.f()}if(r.queryelem.dataElement.terminalConfigurations){var g,O=Object(u.a)(r.queryelem.dataElement.terminalConfigurations);try{for(O.s();!(g=O.n()).done;){var j,_=g.value,S=Object(u.a)(_.terminals);try{for(S.s();!(j=S.n()).done;){var k=j.value;r.terminals.push({terminalId:k.terminalId,terminalName:k.terminalName})}}catch(f){S.e(f)}finally{S.f()}}}catch(f){O.e(f)}finally{O.f()}}return function(e){if(null!==K.a.applicationCache){var t=K.a.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=Object(c.default)(e,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return Object(x.t)(t)}return Object(x.t)(null)}));return null!==K.a.applicationCache&&(K.a.applicationCache.setLayerInfo(e,r),r=r.catch((function(t){throw K.a.applicationCache.clearLayerInfo(e),t}))),r}(e+"/"+p).then((function(n){if(n.systemLayers&&void 0!==n.systemLayers.associationsTableId&&null!==n.systemLayers.associationsTableId){var a=[];return r.unVersion>=4&&(a.push("STATUS"),a.push("PERCENTALONG")),ee(e+"/"+n.systemLayers.associationsTableId.toString(),t,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID"].concat(a),!1,null,null).then((function(e){return e.load()})).then((function(e){return r.unVersion>=4?(e=e.filter(w.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",e.getFieldsIndex()))).load():e})).then((function(e){return{lkp:r.lkp,associations:e,unVersion:r.unVersion,terminals:r.terminals}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}function ae(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=e.serviceUrl();return u?ee(u="/"===u.charAt(u.length-1)?u+t.relatedTableId.toString():u+"/"+t.relatedTableId.toString(),n,a,i,s,o).then((function(u){return new H({layer:e,relatedLayer:u,relationship:t,objectId:r,spatialReference:n,outFields:a,includeGeometry:i,lrucache:s,interceptor:o})})):null}p.a.registerAction(),C.registerAction(),b.a.registerAction(),R.a.registerAction(),N.a.registerAction();var ie=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(a.a)(this,r),(n=t.call(this))._map=e,n._overridespref=i,n.lrucache=s,n.interceptor=o,n._instantLayers=[],n}return Object(i.a)(r,[{key:"makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=te(e,this._overridespref,null===r?["*"]:r,t,this.lrucache,this.interceptor);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}},{key:"featureSetByName",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((function(){try{return t.featureSetByName(e,r,a)}catch(i){return Object(x.s)(i)}}));null===a&&(a=["*"]),a=(a=a.slice(0)).sort();for(var i=JSON.stringify(a),s=0;s<this._instantLayers.length;s++){var o=this._instantLayers[s];if(o.opitem.title===e&&o.includeGeometry===r&&o.outFields===i)return this.resolvePromise(this._instantLayers[s].featureset)}var u=this._map.layers.find((function(t){return t instanceof A.default&&t.title===e}));if(u)return this.resolvePromise(this.makeAndAddFeatureSet(u,r,a));if(this._map.tables){var l=this._map.tables.find((function(t){return!!(t.title&&t.title===e||t.title&&t.title===e)}));if(l){if(l instanceof A.default)return this.resolvePromise(this.makeAndAddFeatureSet(l,r,a));if(l._materializedTable);else{var c=l.outFields?l:Object(n.a)(Object(n.a)({},l),{},{outFields:["*"]});l._materializedTable=new A.default(c)}return l._materializedTable.load().then((function(){return t.resolvePromise(t.makeAndAddFeatureSet(l._materializedTable,r,a))}))}}return this.resolvePromise(null)}},{key:"featureSetById",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["*"];if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((function(){try{return t.featureSetById(e,r,a)}catch(i){return Object(x.s)(i)}}));null===a&&(a=["*"]),a=(a=a.slice(0)).sort();for(var i=JSON.stringify(a),s=0;s<this._instantLayers.length;s++){var o=this._instantLayers[s];if(o.opitem.id===e&&o.includeGeometry===r&&o.outFields===i)return this.resolvePromise(this._instantLayers[s].featureset)}var u=this._map.layers.find((function(t){return t instanceof A.default&&t.id===e}));if(u)return this.resolvePromise(this.makeAndAddFeatureSet(u,r,a));if(this._map.tables){var l=this._map.tables.find((function(t){return t.id===e}));if(l){if(l instanceof A.default)return this.resolvePromise(this.makeAndAddFeatureSet(l,r,a));if(l._materializedTable);else{var c=Object(n.a)(Object(n.a)({},l),{},{outFields:["*"]});l._materializedTable=new A.default(c)}return l._materializedTable.load().then((function(){return t.resolvePromise(t.makeAndAddFeatureSet(l._materializedTable,r,a))}))}}return this.resolvePromise(null)}}]),r}(d.a),se=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(a.a)(this,r),(n=t.call(this))._url=e,n._overridespref=i,n.lrucache=s,n.interceptor=o,n.metadata=null,n._instantLayers=[],n}return Object(i.a)(r,[{key:"url",get:function(){return this._url}},{key:"makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=te(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}},{key:"_loadMetaData",value:function(){var e=this;return re(this._url).then((function(t){return e.metadata=t,t}))}},{key:"load",value:function(){return this._loadMetaData()}},{key:"clone",value:function(){return new r(this._url,this._overridespref,this.lrucache,this.interceptor)}},{key:"featureSetByName",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=["*"]),n=(n=n.slice(0)).sort();for(var a=JSON.stringify(n),i=0;i<this._instantLayers.length;i++){var s=this._instantLayers[i];if(s.opitem.title===e&&s.includeGeometry===r&&s.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}return this._loadMetaData().then((function(a){var i,s=null,o=Object(u.a)(a.layers?a.layers:[]);try{for(o.s();!(i=o.n()).done;){var l=i.value;l.name===e&&(s=l)}}catch(f){o.e(f)}finally{o.f()}if(!s){var c,d=Object(u.a)(a.tables?a.tables:[]);try{for(d.s();!(c=d.n()).done;){var p=c.value;p.name===e&&(s=p)}}catch(f){d.e(f)}finally{d.f()}}return s?X(t._url+"/"+s.id,["*"]).then((function(e){return t.makeAndAddFeatureSet(e,r,n)})):t.resolvePromise(null)}))}},{key:"featureSetById",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["*"];null===n&&(n=["*"]),n=(n=n.slice(0)).sort();var a=JSON.stringify(n);e=null!=e?e.toString():"";for(var i=0;i<this._instantLayers.length;i++){var s=this._instantLayers[i];if(s.opitem.id===e&&s.includeGeometry===r&&s.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}return this._loadMetaData().then((function(a){var i,s=null,o=Object(u.a)(a.layers?a.layers:[]);try{for(o.s();!(i=o.n()).done;){var l=i.value;null!==l.id&&void 0!==l.id&&l.id.toString()===e&&(s=l)}}catch(f){o.e(f)}finally{o.f()}if(!s){var c,d=Object(u.a)(a.tables?a.tables:[]);try{for(d.s();!(c=d.n()).done;){var p=c.value;null!==p.id&&void 0!==p.id&&p.id.toString()===e&&(s=p)}}catch(f){d.e(f)}finally{d.f()}}return s?X(t._url+"/"+s.id,["*"]).then((function(e){return t.makeAndAddFeatureSet(e,r,n)})):t.resolvePromise(null)}))}}]),r}(d.a);function oe(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new ie(e,t,r,n)}function ue(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new se(e,t,r,n)}function le(e,t){return null===e?t:new Z.a({url:e.field("url")})}function ce(e,t,r){return l.b.findCredential(e.restUrl)?"loaded"===e.loadStatus&&""===t&&e.user&&e.user.sourceJSON&&!1===r?Object(x.t)(e.user.sourceJSON):""===t?Object(c.default)(e.restUrl+"/community/self",{responseType:"json",query:Object(n.a)({f:"json"},!1===r?{}:{returnUserLicenseTypeExtensions:!0})}).then((function(e){if(e.data){var t=e.data;if(t&&t.username)return Object(x.t)(t)}return Object(x.t)(null)})):Object(c.default)(e.restUrl+"/community/users/"+t,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return t.error?null:Object(x.t)(t)}return Object(x.t)(null)})):Object(x.t)(null)}function de(e,t,r,n,a){if(null===e)return null;if(e instanceof A.default){switch(t){case"datasource":return te(e,a,e.outFields,!0,r,n).getDataSourceFeatureSet();case"parent":case"root":return te(e,a,e.outFields,!0,r,n)}return null}if(e instanceof v.a)switch(t){case"datasource":return e.getDataSourceFeatureSet();case"parent":return e;case"root":return e.getRootFeatureSet()}return null}function pe(e,t,r,n,a,i,s){var o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(K.a.applicationCache){var u=K.a.applicationCache.getLayerInfo(e+":"+i.url);if(u)return u.then((function(e){try{var u=new A.default({url:Object(O.i)(e.url)+"/"+t,outFields:["*"]});return Object(x.t)(te(u,r,n,a,s,o))}catch(i){return Object(x.s)(i)}}),(function(e){return Object(x.s)(e)}))}return Object(x.c)((function(u,l){var c=new $.default({id:e,portal:i}).load();K.a.applicationCache&&K.a.applicationCache.setLayerInfo(e+":"+i.url,c),c.then((function(e){try{var c=new A.default({url:Object(O.i)(e.url)+"/"+t,outFields:["*"]});u(te(c,r,n,a,s,o))}catch(i){l(i)}}),(function(t){K.a.applicationCache&&K.a.applicationCache.clearLayerInfo(e+":"+i.url),l(t)}))}))}},667:function(e,t,r){"use strict";r.d(t,"a",(function(){return j}));var n=r(21),a=r(2),i=r(4),s=r(83),o=r(29),u=r(122),l=r(11),c=r(30),d=r(674),p=r(296),f={statsWorker:function(){return r.e(99).then(r.bind(null,787))},geometryEngineWorker:function(){return Promise.all([r.e(9),r.e(82)]).then(r.bind(null,788))},CSVSourceWorker:function(){return Promise.all([r.e(4),r.e(5),r.e(6),r.e(8),r.e(59)]).then(r.bind(null,803))},EdgeProcessingWorker:function(){return Promise.all([r.e(12),r.e(81)]).then(r.bind(null,797))},ElevationSamplerWorker:function(){return Promise.all([r.e(4),r.e(8),r.e(12),r.e(20),r.e(111)]).then(r.bind(null,789))},FeatureServiceSnappingSourceWorker:function(){return Promise.all([r.e(4),r.e(5),r.e(6),r.e(8),r.e(51)]).then(r.bind(null,798))},GeoJSONSourceWorker:function(){return Promise.all([r.e(4),r.e(5),r.e(6),r.e(8),r.e(58)]).then(r.bind(null,790))},LercWorker:function(){return r.e(89).then(r.bind(null,791))},MemorySourceWorker:function(){return Promise.all([r.e(4),r.e(5),r.e(6),r.e(8),r.e(57)]).then(r.bind(null,792))},PBFDecoderWorker:function(){return Promise.all([r.e(6),r.e(65)]).then(r.bind(null,800))},Pipeline:function(){return Promise.all([r.e(2),r.e(4),r.e(5),r.e(6),r.e(39)]).then(r.bind(null,795))},PointCloudWorker:function(){return Promise.all([r.e(4),r.e(27),r.e(75)]).then(r.bind(null,799))},RasterWorker:function(){return r.e(63).then(r.bind(null,793))},SceneLayerWorker:function(){return r.e(121).then(r.bind(null,804))},WFSSourceWorker:function(){return Promise.all([r.e(4),r.e(5),r.e(6),r.e(8),r.e(56)]).then(r.bind(null,794))},WorkerTileHandler:function(){return Promise.all([r.e(26),r.e(23),r.e(93)]).then(r.bind(null,796))}},h=d.a.CLOSE,y=d.a.ABORT,b=d.a.INVOKE,v=d.a.RESPONSE,m=d.a.OPEN_PORT,g=d.a.ON,O=function(){function e(t){Object(a.a)(this,e),this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}return Object(i.a)(e,[{key:"push",value:function(e){e.type===d.a.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}},{key:"clear",value:function(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}},{key:"_process",value:function(){this._timer=null;var e,t=Object(n.a)(this._invokeMessages);try{for(t.s();!(e=t.n()).done;){var r=e.value;this._cancelledJobIds.has(r.jobId)||this._invoke(r)}}catch(a){t.e(a)}finally{t.f()}this._cancelledJobIds.clear(),this._invokeMessages.length=0}}]),e}(),j=function(){function e(t,r){var n=this;Object(a.a)(this,e),this._port=t,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new O((function(e){return n._onInvokeMessage(e)})),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}return Object(i.a)(e,[{key:"close",value:function(){this._post({type:h}),this._close()}},{key:"isBusy",value:function(){return this._outJobs.size>0}},{key:"invoke",value:function(e,t,r){var n=this,a=r&&r.signal,i=r&&r.transferList;if(!this._port)return Promise.reject(new o.a("worker:port-closed","Cannot call invoke('".concat(e,"'), port is closed"),{methodName:e,data:t}));var s=Object(d.b)();return new Promise((function(r,o){var u=Object(c.r)(a,(function(){var e,t=n._outJobs.get(s);t&&(n._outJobs.delete(s),null==(e=t.abortHandle)||e.remove(),n._post({type:y,jobId:s}),o(Object(c.e)()))})),l={resolve:r,reject:o,abortHandle:u,debugInfo:e};n._outJobs.set(s,l),n._post({type:b,jobId:s,methodName:e,abortable:null!=a},t,i)}))}},{key:"on",value:function(e,t){var r=new MessageChannel;function n(e){t(e.data)}return this._port.postMessage({type:d.a.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",n),r.port1.start(),{remove:function(){r.port1.postMessage({type:d.a.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",n)}}}},{key:"openPort",value:function(){var e=new MessageChannel;return this._post({type:m,port:e.port2}),e.port1}},{key:"_close",value:function(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((function(e){var t;null==(t=e.abortHandle)||t.remove(),e.reject(Object(c.e)("Worker closing, aborting job calling '".concat(e.debugInfo,"'")))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}},{key:"_onMessage",value:function(e){var t=this;Object(l.j)(this._schedule)?this._schedule((function(){return t._processMessage(e)})):this._processMessage(e)}},{key:"_processMessage",value:function(e){var t=Object(d.d)(e);if(t)switch(t.type){case v:this._onResponseMessage(t);break;case b:this._invokeQueue.push(t);break;case y:this._onAbortMessage(t);break;case h:this._onCloseMessage();break;case m:this._onOpenPortMessage(t);break;case g:this._onOnMessage(t)}}},{key:"_onAbortMessage",value:function(e){var t=this._inJobs,r=e.jobId,n=t.get(r);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),t.delete(r))}},{key:"_onCloseMessage",value:function(){var t=this._client;this._close(),t&&"destroy"in t&&e.clients.get(this)===t&&t.destroy(),e.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}},{key:"_onInvokeMessage",value:function(e){var t,r=this,n=e.methodName,a=e.jobId,i=e.data,s=e.abortable?Object(c.d)():null,o=this._inJobs,u=this._client,l=u[n];try{if(!l&&n&&-1!==n.indexOf("."))for(var p=n.split("."),f=0;f<p.length-1;f++)l=(u=u[p[f]])[p[f+1]];if("function"!=typeof l)throw new TypeError("".concat(n," is not a function"));t=l.call(u,i,{client:this,signal:s?s.signal:null})}catch(h){return void this._post({type:v,jobId:a,error:Object(d.e)(h)})}Object(c.p)(t)?(o.set(a,{controller:s,promise:t}),t.then((function(e){o.has(a)&&(o.delete(a),r._post({type:v,jobId:a},e))}),(function(e){o.has(a)&&(o.delete(a),Object(c.m)(e)||r._post({type:v,jobId:a,error:Object(d.e)(e||{message:"Error encountered at method ".concat(n)})}))}))):this._post({type:v,jobId:a},t)}},{key:"_onOpenPortMessage",value:function(t){new e(t.port,{client:this._client})}},{key:"_onOnMessage",value:function(e){var t=e.port,r=this._client.on(e.eventType,(function(e){t.postMessage(e)})),n=Object(u.c)(e.port,"message",(function(e){Object(d.d)(e).type===d.a.CLOSE&&(n.remove(),r.remove(),t.close())}))}},{key:"_onResponseMessage",value:function(e){var t,r=e.jobId,n=e.error,a=e.data,i=this._outJobs;if(i.has(r)){var s=i.get(r);i.delete(r),null==(t=s.abortHandle)||t.remove(),n?s.reject(o.a.fromJSON(JSON.parse(n))):s.resolve(a)}}},{key:"_post",value:function(e,t,r){return Object(d.c)(this._port,e,t,r)}}],[{key:"connect",value:function(t){var r,n=new MessageChannel;r="function"==typeof t?new t:"default"in t&&"function"==typeof t.default?new t.default:t;var a=new e(n.port1,{channel:n,client:r});return"object"==typeof r&&"remoteClient"in r&&(r.remoteClient=a),e.clients.set(a,r),n.port2}},{key:"loadWorker",value:function(e){var t=f[e];return t?t():Promise.resolve(null)}}]),e}();j.kernelInfo={revision:p.b,version:s.d,buildDate:p.a},j.clients=new Map},668:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return S}));var n=r(22),a=r(21),i=r(2),s=r(4),o=r(5),u=r(6),l=r(0),c=r(114),d=r(210),p=r(42),f=r(26),h=r(11),y=r(1),b=(r(19),r(14),r(15),r(57)),v=r(10),m=r(43),g=r(45),O=r(62),j=r(666),_=new p.a({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null}),w=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).displayFieldName=null,n.exceededTransferLimit=!1,n.features=[],n.fields=null,n.geometryType=null,n.hasM=!1,n.hasZ=!1,n.queryGeometry=null,n.spatialReference=null,n}return Object(s.a)(r,[{key:"readFeatures",value:function(e,t){for(var r=g.a.fromJSON(t.spatialReference),n=[],a=0;a<e.length;a++){var i=e[a],s=d.a.fromJSON(i),o=i.geometry&&i.geometry.spatialReference;Object(h.j)(s.geometry)&&!o&&(s.geometry.spatialReference=r),n.push(s)}return n}},{key:"writeGeometryType",value:function(e,t,r,n){if(e)_.write(e,t,r,n);else{var i=this.features;if(i){var s,o=Object(a.a)(i);try{for(o.s();!(s=o.n()).done;){var u=s.value;if(u&&Object(h.j)(u.geometry))return void _.write(u.geometry.type,t,r,n)}}catch(l){o.e(l)}finally{o.f()}}}}},{key:"readQueryGeometry",value:function(e,t){if(!e)return null;var r=!!e.spatialReference,n=Object(O.a)(e);return!r&&t.spatialReference&&(n.spatialReference=g.a.fromJSON(t.spatialReference)),n}},{key:"writeSpatialReference",value:function(e,t){if(e)t.spatialReference=e.toJSON();else{var r=this.features;if(r){var n,i=Object(a.a)(r);try{for(i.s();!(n=i.n()).done;){var s=n.value;if(s&&Object(h.j)(s.geometry)&&s.geometry.spatialReference)return void(t.spatialReference=s.geometry.spatialReference.toJSON())}}catch(o){i.e(o)}finally{i.f()}}}}},{key:"toJSON",value:function(e){var t=this.write(null);if(t.features&&Array.isArray(e)&&e.length>0)for(var r=0;r<t.features.length;r++){var n=t.features[r];if(n.geometry){var a=e&&e[r];n.geometry=a&&a.toJSON()||n.geometry}}return t}},{key:"quantize",value:function(e){for(var t=Object(n.a)(e.scale,2),r=t[0],a=t[1],i=Object(n.a)(e.translate,2),s=i[0],o=i[1],u=this.features,l=this._getQuantizationFunction(this.geometryType,(function(e){return Math.round((e-s)/r)}),(function(e){return Math.round((o-e)/a)})),c=0,d=u.length;c<d;c++)l(Object(h.q)(u[c].geometry))||(u.splice(c,1),c--,d--);return this.transform=e,this}},{key:"unquantize",value:function(){var e=this.geometryType,t=this.features,r=this.transform;if(!r)return this;var i,s=Object(n.a)(r.translate,2),o=s[0],u=s[1],l=Object(n.a)(r.scale,2),c=l[0],d=l[1],p=this._getHydrationFunction(e,(function(e){return e*c+o}),(function(e){return u-e*d})),f=Object(a.a)(t);try{for(f.s();!(i=f.n()).done;){var y=i.value.geometry;Object(h.j)(y)&&p(y)}}catch(b){f.e(b)}finally{f.f()}return this.transform=null,this}},{key:"_quantizePoints",value:function(e,t,r){for(var n,a,i=[],s=0,o=e.length;s<o;s++){var u=e[s];if(s>0){var l=t(u[0]),c=r(u[1]);l===n&&c===a||(i.push([l-n,c-a]),n=l,a=c)}else n=t(u[0]),a=r(u[1]),i.push([n,a])}return i.length>0?i:null}},{key:"_getQuantizationFunction",value:function(e,t,r){var n=this;return"point"===e?function(e){return e.x=t(e.x),e.y=r(e.y),e}:"polyline"===e||"polygon"===e?function(e){for(var a=Object(O.g)(e)?e.rings:e.paths,i=[],s=0,o=a.length;s<o;s++){var u=a[s],l=n._quantizePoints(u,t,r);l&&i.push(l)}return i.length>0?(Object(O.g)(e)?e.rings=i:e.paths=i,e):null}:"multipoint"===e?function(e){var a=n._quantizePoints(e.points,t,r);return a.length>0?(e.points=a,e):null}:"extent"===e?function(e){return e}:null}},{key:"_getHydrationFunction",value:function(e,t,r){return"point"===e?function(e){e.x=t(e.x),e.y=r(e.y)}:"polyline"===e||"polygon"===e?function(e){for(var n,a,i=Object(O.g)(e)?e.rings:e.paths,s=0,o=i.length;s<o;s++)for(var u=i[s],l=0,c=u.length;l<c;l++){var d=u[l];l>0?(n+=d[0],a+=d[1]):(n=d[0],a=d[1]),d[0]=t(n),d[1]=r(a)}}:"extent"===e?function(e){e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"multipoint"===e?function(e){for(var n,a,i=e.points,s=0,o=i.length;s<o;s++){var u=i[s];s>0?(n+=u[0],a+=u[1]):(n=u[0],a=u[1]),u[0]=t(n),u[1]=r(a)}}:void 0}}]),r}(f.a);Object(l.a)([Object(y.b)({type:String,json:{write:!0}})],w.prototype,"displayFieldName",void 0),Object(l.a)([Object(y.b)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],w.prototype,"exceededTransferLimit",void 0),Object(l.a)([Object(y.b)({type:[d.a],json:{write:!0}})],w.prototype,"features",void 0),Object(l.a)([Object(b.a)("features")],w.prototype,"readFeatures",null),Object(l.a)([Object(y.b)({type:[j.a],json:{write:!0}})],w.prototype,"fields",void 0),Object(l.a)([Object(y.b)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:_.read}}})],w.prototype,"geometryType",void 0),Object(l.a)([Object(m.a)("geometryType")],w.prototype,"writeGeometryType",null),Object(l.a)([Object(y.b)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],w.prototype,"hasM",void 0),Object(l.a)([Object(y.b)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],w.prototype,"hasZ",void 0),Object(l.a)([Object(y.b)({types:c.a,json:{write:!0}})],w.prototype,"queryGeometry",void 0),Object(l.a)([Object(b.a)("queryGeometry")],w.prototype,"readQueryGeometry",null),Object(l.a)([Object(y.b)({type:g.a,json:{write:!0}})],w.prototype,"spatialReference",void 0),Object(l.a)([Object(m.a)("spatialReference")],w.prototype,"writeSpatialReference",null),Object(l.a)([Object(y.b)({json:{write:!0}})],w.prototype,"transform",void 0),(w=Object(l.a)([Object(v.a)("esri.rest.support.FeatureSet")],w)).prototype.toJSON.isDefaultToJSON=!0,w||(w={});var S=w},669:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(42),a=Object(n.b)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0})},670:function(e,t,r){"use strict";r.d(t,"a",(function(){return E}));var n,a=r(2),i=r(4),s=r(5),o=r(6),u=r(0),l=r(114),c=r(665),d=r(42),p=r(26),f=r(18),h=r(11),y=r(1),b=r(97),v=(r(19),r(15),r(31)),m=r(10),g=r(43),O=r(14),j=r(62),_=r(673),w=r(717),S=r(714),k=r(45),x=r(48),F=new d.a({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),I=new d.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),T=n=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).aggregateIds=null,n.cacheHint=void 0,n.datumTransformation=null,n.distance=void 0,n.dynamicDataSource=void 0,n.formatOf3DObjects=null,n.gdbVersion=null,n.geometry=null,n.geometryPrecision=void 0,n.groupByFieldsForStatistics=null,n.having=null,n.historicMoment=null,n.maxAllowableOffset=void 0,n.maxRecordCountFactor=1,n.multipatchOption=null,n.num=void 0,n.objectIds=null,n.orderByFields=null,n.outFields=null,n.outSpatialReference=null,n.outStatistics=null,n.parameterValues=null,n.pixelSize=null,n.quantizationParameters=null,n.rangeValues=null,n.relationParameter=null,n.resultType=null,n.returnCentroid=!1,n.returnDistinctValues=!1,n.returnExceededLimitFeatures=!0,n.returnGeometry=!1,n.returnQueryGeometry=!1,n.returnM=void 0,n.returnZ=void 0,n.sourceSpatialReference=null,n.spatialRelationship="intersects",n.start=void 0,n.sqlFormat=null,n.text=null,n.timeExtent=null,n.timeReferenceUnknownClient=!1,n.units=null,n.where=null,n}return Object(i.a)(r,[{key:"castDatumTransformation",value:function(e){return"number"==typeof e||"object"==typeof e?e:null}},{key:"writeHistoricMoment",value:function(e,t){t.historicMoment=e&&e.getTime()}},{key:"writeParameterValues",value:function(e,t){if(e){var r={};for(var n in e){var a=e[n];Array.isArray(a)?r[n]=a.map((function(e){return e instanceof Date?e.getTime():e})):a instanceof Date?r[n]=a.getTime():r[n]=a}t.parameterValues=r}}},{key:"writeStart",value:function(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}},{key:"writeWhere",value:function(e,t){t.where=e||"1=1"}},{key:"clone",value:function(){return new n(Object(f.a)({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,datumTransformation:this.datumTransformation,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:Object(h.j)(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}}],[{key:"from",value:function(e){return Object(O.d)(n,e)}}]),r}(p.a);T.MAX_MAX_RECORD_COUNT_FACTOR=5,Object(u.a)([Object(y.b)({json:{write:!0}})],T.prototype,"aggregateIds",void 0),Object(u.a)([Object(y.b)({type:Boolean,json:{write:!0}})],T.prototype,"cacheHint",void 0),Object(u.a)([Object(y.b)({json:{write:!0}})],T.prototype,"datumTransformation",void 0),Object(u.a)([Object(b.a)("datumTransformation")],T.prototype,"castDatumTransformation",null),Object(u.a)([Object(y.b)({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],T.prototype,"distance",void 0),Object(u.a)([Object(y.b)({type:_.a,json:{write:!0}})],T.prototype,"dynamicDataSource",void 0),Object(u.a)([Object(y.b)({type:String,json:{write:!0}})],T.prototype,"formatOf3DObjects",void 0),Object(u.a)([Object(y.b)({type:String,json:{write:!0}})],T.prototype,"gdbVersion",void 0),Object(u.a)([Object(y.b)({types:l.a,json:{read:j.a,write:!0}})],T.prototype,"geometry",void 0),Object(u.a)([Object(y.b)({type:Number,json:{write:!0}})],T.prototype,"geometryPrecision",void 0),Object(u.a)([Object(y.b)({type:[String],json:{write:!0}})],T.prototype,"groupByFieldsForStatistics",void 0),Object(u.a)([Object(y.b)({type:String,json:{write:!0}})],T.prototype,"having",void 0),Object(u.a)([Object(y.b)({type:Date})],T.prototype,"historicMoment",void 0),Object(u.a)([Object(g.a)("historicMoment")],T.prototype,"writeHistoricMoment",null),Object(u.a)([Object(y.b)({type:Number,json:{write:!0}})],T.prototype,"maxAllowableOffset",void 0),Object(u.a)([Object(y.b)({type:Number,cast:function(e){return e<1?1:e>n.MAX_MAX_RECORD_COUNT_FACTOR?n.MAX_MAX_RECORD_COUNT_FACTOR:e},json:{write:{overridePolicy:function(e){return{enabled:e>1}}}}})],T.prototype,"maxRecordCountFactor",void 0),Object(u.a)([Object(y.b)({type:["xyFootprint"],json:{write:!0}})],T.prototype,"multipatchOption",void 0),Object(u.a)([Object(y.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],T.prototype,"num",void 0),Object(u.a)([Object(y.b)({json:{write:!0}})],T.prototype,"objectIds",void 0),Object(u.a)([Object(y.b)({type:[String],json:{write:!0}})],T.prototype,"orderByFields",void 0),Object(u.a)([Object(y.b)({type:[String],json:{write:!0}})],T.prototype,"outFields",void 0),Object(u.a)([Object(y.b)({type:k.a,json:{name:"outSR",write:!0}})],T.prototype,"outSpatialReference",void 0),Object(u.a)([Object(y.b)({type:[S.a],json:{write:{enabled:!0,overridePolicy:function(){return{enabled:Object(h.j)(this.outStatistics)&&this.outStatistics.length>0}}}}})],T.prototype,"outStatistics",void 0),Object(u.a)([Object(y.b)({json:{write:!0}})],T.prototype,"parameterValues",void 0),Object(u.a)([Object(g.a)("parameterValues")],T.prototype,"writeParameterValues",null),Object(u.a)([Object(y.b)({type:x.a,json:{write:!0}})],T.prototype,"pixelSize",void 0),Object(u.a)([Object(y.b)({type:w.a,json:{write:!0}})],T.prototype,"quantizationParameters",void 0),Object(u.a)([Object(y.b)({type:[Object],json:{write:!0}})],T.prototype,"rangeValues",void 0),Object(u.a)([Object(y.b)({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy:function(){return{enabled:"relation"===this.spatialRelationship}}}}})],T.prototype,"relationParameter",void 0),Object(u.a)([Object(y.b)({type:String,json:{write:!0}})],T.prototype,"resultType",void 0),Object(u.a)([Object(y.b)({type:Boolean,json:{default:!1,write:!0}})],T.prototype,"returnCentroid",void 0),Object(u.a)([Object(y.b)({type:Boolean,json:{default:!1,write:!0}})],T.prototype,"returnDistinctValues",void 0),Object(u.a)([Object(y.b)({type:Boolean,json:{default:!0,write:!0}})],T.prototype,"returnExceededLimitFeatures",void 0),Object(u.a)([Object(y.b)({type:Boolean,json:{write:!0}})],T.prototype,"returnGeometry",void 0),Object(u.a)([Object(y.b)({type:Boolean,json:{default:!1,write:!0}})],T.prototype,"returnQueryGeometry",void 0),Object(u.a)([Object(y.b)({type:Boolean,json:{default:!1,write:!0}})],T.prototype,"returnM",void 0),Object(u.a)([Object(y.b)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],T.prototype,"returnZ",void 0),Object(u.a)([Object(y.b)({type:k.a,json:{write:!0}})],T.prototype,"sourceSpatialReference",void 0),Object(u.a)([Object(v.a)(F,{ignoreUnknown:!1,name:"spatialRel"})],T.prototype,"spatialRelationship",void 0),Object(u.a)([Object(y.b)({type:Number,json:{read:{source:"resultOffset"}}})],T.prototype,"start",void 0),Object(u.a)([Object(g.a)("start"),Object(g.a)("num")],T.prototype,"writeStart",null),Object(u.a)([Object(y.b)({type:String,json:{write:!0}})],T.prototype,"sqlFormat",void 0),Object(u.a)([Object(y.b)({type:String,json:{write:!0}})],T.prototype,"text",void 0),Object(u.a)([Object(y.b)({type:c.a,json:{write:!0}})],T.prototype,"timeExtent",void 0),Object(u.a)([Object(y.b)({type:Boolean,json:{default:!1,write:!0}})],T.prototype,"timeReferenceUnknownClient",void 0),Object(u.a)([Object(v.a)(I,{ignoreUnknown:!1}),Object(y.b)({json:{write:{overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],T.prototype,"units",void 0),Object(u.a)([Object(y.b)({type:String,json:{write:{overridePolicy:function(e){return{enabled:null!=e||this.start>0}}}}})],T.prototype,"where",void 0),Object(u.a)([Object(g.a)("where")],T.prototype,"writeWhere",null);var E=T=n=Object(u.a)([Object(m.a)("esri.rest.support.Query")],T)},672:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(21),a=r(2),i=r(4);function s(e){return"date"===e.type||"esriFieldTypeDate"===e.type}var o=function(){function e(t){if(Object(a.a)(this,e),this.fields=t,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this.dateFields=[],t){var r,i=[],o=Object(n.a)(t);try{for(o.s();!(r=o.n()).done;){var l=r.value,c=l&&l.name;if(c){var d=u(c);this._fieldsMap.set(c,l),this._fieldsMap.set(d,l),i.push(d),s(l)&&(this.dateFields.push(l),this._dateFieldsSet.add(l))}}}catch(p){o.e(p)}finally{o.f()}i.sort(),this.uid=i.join(",")}}return Object(i.a)(e,[{key:"destroy",value:function(){this._fieldsMap.clear()}},{key:"has",value:function(e){return null!=this.get(e)}},{key:"get",value:function(e){return null!=e?this._fieldsMap.get(e)||this._fieldsMap.get(u(e)):void 0}},{key:"isDateField",value:function(e){return this._dateFieldsSet.has(this.get(e))}},{key:"normalizeFieldName",value:function(e){var t=this.get(e);if(t)return t.name}}]),e}();function u(e){return e.toLowerCase().trim()}},673:function(e,t,r){"use strict";r.d(t,"a",(function(){return A}));var n,a,i=r(2),s=r(4),o=r(5),u=r(6),l=r(0),c=r(42),d=r(26),p=r(1),f=(r(19),r(97)),h=(r(15),r(31)),y=r(57),b=r(10),v=r(14),m=r(212),g=r(666),O=r(711),j=(r(114),r(45)),_=r(236),w=n=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).type="query-table",n}return Object(s.a)(r,[{key:"clone",value:function(){var e,t=this.workspaceId,r=this.query,a=this.oidFields,i=this.spatialReference,s=this.geometryType,o={workspaceId:t,query:r,oidFields:a,spatialReference:null!=(e=null==i?void 0:i.clone())?e:void 0,geometryType:s};return new n(o)}}]),r}(d.a);Object(l.a)([Object(h.a)({queryTable:"query-table"})],w.prototype,"type",void 0),Object(l.a)([Object(p.b)({type:String,json:{write:!0}})],w.prototype,"workspaceId",void 0),Object(l.a)([Object(p.b)({type:String,json:{write:!0}})],w.prototype,"query",void 0),Object(l.a)([Object(p.b)({type:String,json:{write:!0}})],w.prototype,"oidFields",void 0),Object(l.a)([Object(p.b)({type:j.a,json:{write:!0}})],w.prototype,"spatialReference",void 0),Object(l.a)([Object(h.a)(_.a)],w.prototype,"geometryType",void 0),w=n=Object(l.a)([Object(b.a)("esri.layers.support.source.QueryTableDataSource")],w);var S,k=a=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).type="raster",n}return Object(s.a)(r,[{key:"clone",value:function(){var e=this.workspaceId,t=this.dataSourceName;return new a({workspaceId:e,dataSourceName:t})}}]),r}(d.a);Object(l.a)([Object(h.a)({raster:"raster"})],k.prototype,"type",void 0),Object(l.a)([Object(p.b)({type:String,json:{write:!0}})],k.prototype,"dataSourceName",void 0),Object(l.a)([Object(p.b)({type:String,json:{write:!0}})],k.prototype,"workspaceId",void 0),k=a=Object(l.a)([Object(b.a)("esri.layers.support.source.RasterDataSource")],k);var x,F,I=S=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).type="table",n}return Object(s.a)(r,[{key:"clone",value:function(){var e=this.workspaceId,t=this.gdbVersion,r=this.dataSourceName;return new S({workspaceId:e,gdbVersion:t,dataSourceName:r})}}]),r}(d.a);Object(l.a)([Object(h.a)({table:"table"})],I.prototype,"type",void 0),Object(l.a)([Object(p.b)({type:String,json:{write:!0}})],I.prototype,"workspaceId",void 0),Object(l.a)([Object(p.b)({type:String,json:{write:!0}})],I.prototype,"gdbVersion",void 0),Object(l.a)([Object(p.b)({type:String,json:{write:!0}})],I.prototype,"dataSourceName",void 0),I=S=Object(l.a)([Object(b.a)("esri.layers.support.source.TableDataSource")],I);var T=Object(c.b)()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"}),E=x=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).type="join-table",n}return Object(s.a)(r,[{key:"readLeftTableSource",value:function(e,t,r){return R()(e,t,r)}},{key:"castLeftTableSource",value:function(e){return Object(v.k)(P(),e)}},{key:"readRightTableSource",value:function(e,t,r){return R()(e,t,r)}},{key:"castRightTableSource",value:function(e){return Object(v.k)(P(),e)}},{key:"clone",value:function(){var e,t,r=this.leftTableKey,n=this.rightTableKey,a=this.leftTableSource,i=this.rightTableSource,s=this.joinType,o={leftTableKey:r,rightTableKey:n,leftTableSource:null!=(e=null==a?void 0:a.clone())?e:void 0,rightTableSource:null!=(t=null==i?void 0:i.clone())?t:void 0,joinType:s};return new x(o)}}]),r}(d.a);Object(l.a)([Object(h.a)({joinTable:"join-table"})],E.prototype,"type",void 0),Object(l.a)([Object(p.b)({type:String,json:{write:!0}})],E.prototype,"leftTableKey",void 0),Object(l.a)([Object(p.b)({type:String,json:{write:!0}})],E.prototype,"rightTableKey",void 0),Object(l.a)([Object(p.b)({json:{write:!0}})],E.prototype,"leftTableSource",void 0),Object(l.a)([Object(y.a)("leftTableSource")],E.prototype,"readLeftTableSource",null),Object(l.a)([Object(f.a)("leftTableSource")],E.prototype,"castLeftTableSource",null),Object(l.a)([Object(p.b)({json:{write:!0}})],E.prototype,"rightTableSource",void 0),Object(l.a)([Object(y.a)("rightTableSource")],E.prototype,"readRightTableSource",null),Object(l.a)([Object(f.a)("rightTableSource")],E.prototype,"castRightTableSource",null),Object(l.a)([Object(h.a)(T)],E.prototype,"joinType",void 0),E=x=Object(l.a)([Object(b.a)("esri.layers.support.source.JoinTableDataSource")],E);var C=null;function R(){return C||(C=Object(m.b)({types:P()})),C}var N=null;function P(){return N||(N={key:"type",base:null,typeMap:{"data-layer":A,"map-layer":O.a}}),N}var D={key:"type",base:null,typeMap:{"join-table":E,"query-table":w,raster:k,table:I}},A=F=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).type="data-layer",n}return Object(s.a)(r,[{key:"clone",value:function(){var e=this.fields,t=this.dataSource;return new F({fields:e,dataSource:t})}}]),r}(d.a);Object(l.a)([Object(h.a)({dataLayer:"data-layer"})],A.prototype,"type",void 0),Object(l.a)([Object(p.b)({type:[g.a],json:{write:!0}})],A.prototype,"fields",void 0),Object(l.a)([Object(p.b)({types:D,json:{write:!0}})],A.prototype,"dataSource",void 0),(A=F=Object(l.a)([Object(b.a)("esri.layers.support.source.DataLayerSource")],A)).from=Object(v.m)(A)},674:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return u}));var n,a,i=r(19);(a=n||(n={}))[a.HANDSHAKE=0]="HANDSHAKE",a[a.OPEN=1]="OPEN",a[a.OPENED=2]="OPENED",a[a.RESPONSE=3]="RESPONSE",a[a.INVOKE=4]="INVOKE",a[a.ABORT=5]="ABORT",a[a.CLOSE=6]="CLOSE",a[a.OPEN_PORT=7]="OPEN_PORT",a[a.ON=8]="ON";var s=0;function o(){return s++}function u(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function l(e,t,r,a){var i;t.type!==n.OPEN_PORT?t.type===n.INVOKE||t.type===n.RESPONSE?(!function(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}(r)?(i=d(a),t.data=r):(i=d(r.transferList),t.data=r.result),i?e.postMessage(t,i):e.postMessage(t)):e.postMessage(t):e.postMessage(t,[t.port])}function c(e){if(!e)return null;var t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function d(e){if(!e||!e.length)return null;if(Object(i.a)("esri-workers-arraybuffer-transfer"))return e;var t=e.filter((function(e){return!function(e){return e instanceof ArrayBuffer||e&&e.constructor&&"ArrayBuffer"===e.constructor.name}(e)}));return t.length?t:null}},675:function(e,t,r){"use strict";r.d(t,"a",(function(){return I}));var n,a=r(2),i=r(4),s=r(5),o=r(6),u=r(0),l=r(332),c=r(42),d=r(26),p=r(18),f=r(1),h=(r(14),r(19),r(15),r(57)),y=r(10),b=r(43),v=r(693),m=n=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).expression=null,e.title=null,e.value=null,e}return Object(i.a)(r,[{key:"readExpression",value:function(e,t){return t.value?Object(v.a)(t.value):e}},{key:"writeExpression",value:function(e,t,r){null!=this.value&&(e=Object(v.a)(this.value)),t[r]=e}},{key:"clone",value:function(){return new n({expression:this.expression,title:this.title,value:this.value})}}]),r}(d.a);Object(u.a)([Object(f.b)({type:String,json:{write:{allowNull:!0}}})],m.prototype,"expression",void 0),Object(u.a)([Object(h.a)("expression",["expression","value"])],m.prototype,"readExpression",null),Object(u.a)([Object(b.a)("expression")],m.prototype,"writeExpression",null),Object(u.a)([Object(f.b)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],m.prototype,"title",void 0),Object(u.a)([Object(f.b)({json:{read:!1,write:!1}})],m.prototype,"value",void 0);var g,O=m=n=Object(u.a)([Object(y.a)("esri.layers.support.LabelExpressionInfo")],m),j=r(725),_=r(753),w=new c.a({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function S(e){return!e||"service"!==e.origin&&!k(e.layer)}function k(e){return"map-image"===(null==e?void 0:e.type)}function x(e){var t,r;return!!k(e)&&!(null==(t=e.capabilities)||null==(r=t.exportMap)||!r.supportsArcadeExpressionForLabeling)}var F=g=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).type="label",n.name=null,n.deconflictionStrategy="static",n.labelExpression=null,n.labelExpressionInfo=null,n.labelPlacement=null,n.maxScale=0,n.minScale=0,n.symbol=j.a,n.useCodedValues=void 0,n.where=null,n}return Object(i.a)(r,[{key:"readLabelExpression",value:function(e,t){var r=t.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e}},{key:"writeLabelExpression",value:function(e,t,r){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)e=Object(v.f)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){var n=Object(v.e)(this.labelExpressionInfo.expression);n&&(e="["+n+"]")}null!=e&&(t[r]=e)}},{key:"writeLabelExpressionInfo",value:function(e,t,r,n){if(null==e&&null!=this.labelExpression&&S(n))e=new O({expression:this.getLabelExpressionArcade()});else if(!e)return;var a=e.toJSON(n);a.expression&&(t[r]=a)}},{key:"writeMaxScale",value:function(e,t){(e||this.minScale)&&(t.maxScale=e)}},{key:"writeMinScale",value:function(e,t){(e||this.maxScale)&&(t.minScale=e)}},{key:"getLabelExpression",value:function(){return Object(v.b)(this)}},{key:"getLabelExpressionArcade",value:function(){return Object(v.c)(this)}},{key:"getLabelExpressionSingleField",value:function(){return Object(v.d)(this)}},{key:"hash",value:function(){return JSON.stringify(this)}},{key:"clone",value:function(){return new g({deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:Object(p.a)(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:Object(p.a)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}}],[{key:"evaluateWhere",value:function(e,t){var r=function(e,t,r){switch(t){case"=":return e==r;case"<>":return e!=r;case">":return e>r;case">=":return e>=r;case"<":return e<r;case"<=":return e<=r}return!1};try{if(null==e)return!0;var n=e.split(" ");if(3===n.length)return r(t[n[0]],n[1],n[2]);if(7===n.length){var a=r(t[n[0]],n[1],n[2]),i=n[3],s=r(t[n[4]],n[5],n[6]);switch(i){case"AND":return a&&s;case"OR":return a||s}}return!1}catch(o){console.log("Error.: can't parse = "+e)}}}]),r}(d.a);Object(u.a)([Object(f.b)({type:String,json:{write:!0}})],F.prototype,"name",void 0),Object(u.a)([Object(f.b)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],F.prototype,"deconflictionStrategy",void 0),Object(u.a)([Object(f.b)({type:String,json:{write:{overridePolicy:function(e,t,r){return this.labelExpressionInfo&&"service"===(null==r?void 0:r.origin)&&x(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],F.prototype,"labelExpression",void 0),Object(u.a)([Object(h.a)("labelExpression")],F.prototype,"readLabelExpression",null),Object(u.a)([Object(b.a)("labelExpression")],F.prototype,"writeLabelExpression",null),Object(u.a)([Object(f.b)({type:O,json:{write:{overridePolicy:function(e,t,r){return function(e){return S(e)||x(e.layer)}(r)?{allowNull:!0}:{enabled:!1}}}}})],F.prototype,"labelExpressionInfo",void 0),Object(u.a)([Object(b.a)("labelExpressionInfo")],F.prototype,"writeLabelExpressionInfo",null),Object(u.a)([Object(f.b)({type:w.apiValues,json:{type:w.jsonValues,read:w.read,write:w.write}})],F.prototype,"labelPlacement",void 0),Object(u.a)([Object(f.b)({type:Number})],F.prototype,"maxScale",void 0),Object(u.a)([Object(b.a)("maxScale")],F.prototype,"writeMaxScale",null),Object(u.a)([Object(f.b)({type:Number})],F.prototype,"minScale",void 0),Object(u.a)([Object(b.a)("minScale")],F.prototype,"writeMinScale",null),Object(u.a)([Object(f.b)({types:l.g,json:{origins:{"web-scene":{types:l.h,write:_.b,default:null}},write:_.b,default:null}})],F.prototype,"symbol",void 0),Object(u.a)([Object(f.b)({type:Boolean,json:{write:!0}})],F.prototype,"useCodedValues",void 0),Object(u.a)([Object(f.b)({type:String,json:{write:!0}})],F.prototype,"where",void 0);var I=F=g=Object(u.a)([Object(y.a)("esri.layers.support.LabelClass")],F)},676:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return v})),r.d(t,"d",(function(){return j})),r.d(t,"e",(function(){return f})),r.d(t,"f",(function(){return h})),r.d(t,"g",(function(){return m})),r.d(t,"h",(function(){return g})),r.d(t,"i",(function(){return b})),r.d(t,"j",(function(){return O}));var n=r(22),a=r(11),i=r(27),s=r(87),o={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},u=Object.values(o),l=new RegExp("^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(".concat(u.join("|"),"))(?:\\/(?:layers\\/)?(\\d+))?"),"i"),c=new RegExp("^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(".concat(u.join("|"),"))(?:\\/(?:layers\\/)?(\\d+))?"),"i"),d=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function p(e){return!!l.test(e)}function f(e){var t=Object(i.J)(e),r=t.path.match(l)||t.path.match(c);if(!r)return null;var a=Object(n.a)(r,5),s=a[1],u=a[2],d=a[3],p=a[4],f=u.indexOf("/");return{title:y(-1!==f?u.slice(f+1):u),serverType:o[d.toLowerCase()],sublayer:null!=p&&""!==p?parseInt(p,10):null,url:{path:s}}}function h(e){var t=Object(i.J)(e).path.match(d);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function y(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function b(e,t){var r=[];if(e){var n=f(e);Object(a.j)(n)&&n.title&&r.push(n.title)}if(t){var i=y(t);r.push(i)}if(2===r.length){if(-1!==r[0].toLowerCase().indexOf(r[1].toLowerCase()))return r[0];if(-1!==r[1].toLowerCase().indexOf(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function v(e){if(!e)return!1;var t=-1!==(e=e.toLowerCase()).indexOf(".arcgis.com/"),r=-1!==e.indexOf("//services")||-1!==e.indexOf("//tiles")||-1!==e.indexOf("//features");return t&&r}function m(e,t){return e?Object(i.H)(Object(i.G)(e,t)):e}function g(e){var t=e.url;if(!t)return{url:t};t=Object(i.G)(t,e.logger);var r,n=Object(i.J)(t),s=f(n.path);if(Object(a.j)(s))null!=s.sublayer&&null==e.layer.layerId&&(r=s.sublayer),t=s.url.path;else if(e.nonStandardUrlAllowed){var o=h(n.path);Object(a.j)(o)&&(t=o.serviceUrl,r=o.sublayerId)}return{url:Object(i.H)(t),layerId:r}}function O(e,t,r,n,a){Object(s.f)(t,n,"url",a),n.url&&null!=e.layerId&&(n.url=Object(i.y)(n.url,r,e.layerId.toString()))}function j(e){if(!e)return!1;var t=e.toLowerCase(),r=-1!==t.indexOf("/services/"),n=-1!==t.indexOf("/mapserver/wmsserver"),a=-1!==t.indexOf("/imageserver/wmsserver"),i=-1!==t.indexOf("/wmsserver");return r&&(n||a||i)}},678:function(e,t,r){"use strict";r.d(t,"a",(function(){return y}));var n,a=r(2),i=r(4),s=r(5),o=r(6),u=r(0),l=r(26),c=r(692),d=r(1),p=(r(19),r(14),r(15),r(10)),f=r(669),h=n=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).value=0,n.unit="milliseconds",n}return Object(i.a)(r,[{key:"toMilliseconds",value:function(){return Object(c.a)(this.value,this.unit,"milliseconds")}},{key:"clone",value:function(){return new n({value:this.value,unit:this.unit})}}]),r}(l.a);Object(u.a)([Object(d.b)({type:Number,json:{write:!0},nonNullable:!0})],h.prototype,"value",void 0),Object(u.a)([Object(d.b)({type:f.a.apiValues,json:{type:f.a.jsonValues,read:f.a.read,write:f.a.write},nonNullable:!0})],h.prototype,"unit",void 0);var y=h=n=Object(u.a)([Object(p.a)("esri.TimeInterval")],h)},683:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(135),a=r(70),i={inches:Object(n.b)(1,"meters","inches"),feet:Object(n.b)(1,"meters","feet"),"us-feet":Object(n.b)(1,"meters","us-feet"),yards:Object(n.b)(1,"meters","yards"),miles:Object(n.b)(1,"meters","miles"),"nautical-miles":Object(n.b)(1,"meters","nautical-miles"),millimeters:Object(n.b)(1,"meters","millimeters"),centimeters:Object(n.b)(1,"meters","centimeters"),decimeters:Object(n.b)(1,"meters","decimeters"),meters:Object(n.b)(1,"meters","meters"),kilometers:Object(n.b)(1,"meters","kilometers"),"decimal-degrees":1/Object(n.i)(1,"meters",a.a.radius)}},685:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n=r(21),a=r(2),i=r(4),s=r(185),o=r(15),u=r(30),l=r(667),c=o.a.getLogger("esri.core.workers.Connection"),d=function(){function e(){Object(a.a)(this,e),this._clients=new Array,this._clientPromises=new Array,this._clientIdx=0}return Object(i.a)(e,[{key:"destroy",value:function(){this.close()}},{key:"closed",get:function(){return!this._clients||!this._clients.length}},{key:"open",value:function(e,t){var r=this;return new Promise((function(n,a){var i=!0,s=function(e){Object(u.v)(t.signal),i&&(i=!1,e())};r._clients.length=e.length,r._clientPromises.length=e.length;for(var o=function(i){var o=e[i];Object(u.p)(o)?r._clientPromises[i]=o.then((function(e){return r._clients[i]=new l.a(e,t),s(n),r._clients[i]}),(function(){return s(a),null})):(r._clients[i]=new l.a(o,t),r._clientPromises[i]=Promise.resolve(r._clients[i]),s(n))},c=0;c<e.length;++c)o(c)}))}},{key:"broadcast",value:function(e,t,r){for(var n=new Array(this._clientPromises.length),a=0;a<this._clientPromises.length;++a){var i=this._clientPromises[a];n[a]=i.then((function(n){return n.invoke(e,t,r)}))}return n}},{key:"close",value:function(){var e,t=Object(n.a)(this._clientPromises);try{for(t.s();!(e=t.n()).done;){e.value.then((function(e){return e.close()}))}}catch(r){t.e(r)}finally{t.f()}this._clients.length=0,this._clientPromises.length=0}},{key:"getAvailableClient",value:function(){for(var e,t=0;t<this._clients.length;++t){var r=this._clients[t];if(r){if(!r.isBusy())return Promise.resolve(r)}else(e=e||[]).push(this._clientPromises[t])}return e?Promise.race(e):(this._clientIdx=(this._clientIdx+1)%this._clients.length,Promise.resolve(this._clients[this._clientIdx]))}},{key:"invoke",value:function(e,t,r){var n=null;return Array.isArray(r)?(c.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:r}):n=r,this.closed?Promise.reject(new Error("Connection closed")):this.getAvailableClient().then((function(r){return r.invoke(e,t,n)}))}},{key:"on",value:function(e,t){var r=this;return Promise.all(this._clientPromises).then((function(){return Object(s.a)(r._clients.map((function(r){return r.on(e,t)})))}))}},{key:"openPorts",value:function(){var e=this;return new Promise((function(t){for(var r=new Array(e._clientPromises.length),n=r.length,a=function(a){e._clientPromises[a].then((function(e){r[a]=e.openPort(),0==--n&&t(r)}))},i=0;i<e._clientPromises.length;++i)a(i)}))}},{key:"test",get:function(){return{numClients:this._clients.length}}}]),e}()},686:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return M}));var n,a=r(23),i=r(13),s=r(22),o=r(7),u=r.n(o),l=r(21),c=r(12),d=r(2),p=r(4),f=r(77),h=r(65),y=r(5),b=r(6),v=r(0),m=r(46),g=r(82),O=r(29),j=r(18),_=r(15),w=r(712),S=r(11),k=r(30),x=r(109),F=r(1),I=(r(14),r(19),r(10)),T=r(43),E=r(209),C=r(663),R=r(684),N=r(237),P=r(186),D=_.a.getLogger("esri.renderers.DictionaryRenderer"),A={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}},L=n=function(e){Object(y.a)(r,e);var t=Object(b.a)(r);function r(e){var n;return Object(d.a)(this,r),(n=t.call(this,e))._ongoingRequests=new Map,n._symbolCache=new w.a(100),n.config=null,n.fieldMap=null,n.scaleExpression=null,n.scaleExpressionTitle=null,n.url=null,n.type="dictionary",n}return Object(p.a)(r,[{key:"writeData",value:function(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}},{key:"writeVisualVariables",value:function(e,t,n,a){null!=a&&a.origin||Object(f.a)(Object(h.a)(r.prototype),"writeVisualVariables",this).call(this,e,t,n,a)}},{key:"clone",value:function(){return new n({config:Object(j.a)(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:Object(j.a)(this.fieldMap),url:Object(j.a)(this.url),visualVariables:Object(j.a)(this.visualVariables)})}},{key:"getSymbolAsync",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){var n,a,i,s,o,c,d,p,f,h,y,b,v,g,O,j,_,w,F,I,T,E,C,R,N,P,D=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r)),e.prev=1,e.next=4,this._dictionaryPromise;case 4:n=e.sent,e.next=11;break;case 7:if(e.prev=7,e.t0=e.catch(1),!Object(k.m)(e.t0)){e.next=11;break}return e.abrupt("return",(this._dictionaryPromise=null,null));case 11:if(a={},this.fieldMap){i=Object(l.a)(this._symbolFields);try{for(i.s();!(s=i.n()).done;)o=s.value,(c=this.fieldMap[o])&&null!==t.attributes[c]&&void 0!==t.attributes[c]?(d=""+t.attributes[c],a[o]=d):a[o]=""}catch(u){i.e(u)}finally{i.f()}}if((p=n(a,r))&&"string"==typeof p){e.next=16;break}return e.abrupt("return",null);case 16:if(f=Object(x.b)(p).toString(),!(h=this._symbolCache.get(f))){e.next=19;break}return e.abrupt("return",(h.catch((function(){D._symbolCache.pop(f)})),h));case 19:y=p.split(";"),b=[],v=[],g=Object(l.a)(y);try{for(g.s();!(O=g.n()).done;)if((j=O.value)&&0!==j.length)if(-1===j.indexOf("po:"))if(-1!==j.indexOf("|")){_=Object(l.a)(j.split("|"));try{for(_.s();!(w=_.n()).done;)F=w.value,this._itemNames.has(F)&&b.push(F)}catch(u){_.e(u)}finally{_.f()}}else this._itemNames.has(j)&&b.push(j);else 3===(I=j.substr(3).split("|")).length&&(T=I[0],E=I[1],C=I[2],"DashTemplate"===E?C=C.split(" ").map((function(e){return Number(e)})):"Color"===E?(R=new m.a(C).toRgba(),C=[R[0],R[1],R[2],255*R[3]]):C=Number(C),v.push({primitiveName:T,propertyName:E,value:C}))}catch(u){g.e(u)}finally{g.f()}return N=!Object(S.j)(t.geometry)||!t.geometry.hasZ&&"point"===t.geometry.type,P=this._cimPartsToCIMSymbol(b,v,N,r),e.abrupt("return",(this._symbolCache.put(f,P,1),P));case 24:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"collectRequiredFields",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.collectVVRequiredFields(t,r);case 2:if(e.t0=this.scaleExpression,!e.t0){e.next=6;break}return e.next=6,Object(E.a)(t,r,this.scaleExpression);case 6:for(n in this.fieldMap)a=this.fieldMap[n],r.has(a)&&t.add(a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"arcadeRequired",get:function(){return!0}},{key:"fetchResources",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var r,n,a,o,c,d,p,f,h,y,b,v,m,j,_,w,k,x=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._dictionaryPromise){e.next=2;break}return e.abrupt("return",this._dictionaryPromise);case 2:if(this.url){e.next=4;break}return e.abrupt("return",void D.error("no valid URL!"));case 4:return r=Object(S.j)(t)?t.abortOptions:null,n=Object(g.default)(this.url+"/resources/styles/dictionary-info.json",Object(i.a)({responseType:"json",query:{f:"json"}},r)),e.next=8,Promise.all([n,Object(N.e)()]);case 8:if(a=e.sent,o=Object(s.a)(a,1),c=o[0].data){e.next=13;break}throw this._dictionaryPromise=null,new O.a("esri.renderers.DictionaryRenderer","Bad dictionary data!");case 13:if(d=c.expression,p=c.authoringInfo,this._refSymbolUrlTemplate=this.url+"/"+c.cimRefTemplateUrl,this._itemNames=new Set(c.itemsNames),this._symbolFields=p.symbol,f={},this.config)for(y in h=this.config)f[y]=h[y];if(p.configuration){b=Object(l.a)(p.configuration);try{for(b.s();!(v=b.n()).done;)m=v.value,f.hasOwnProperty(m.name)||(f[m.name]=m.value)}catch(u){b.e(u)}finally{b.f()}}if(j=[],Object(S.j)(t)&&t.fields&&this.fieldMap){_=Object(l.a)(this._symbolFields);try{for(k=function(){var e=w.value,r=x.fieldMap[e],n=t.fields.filter((function(e){return e.name===r}));n.length>0&&j.push(Object(i.a)(Object(i.a)({},n[0]),{},{name:e}))},_.s();!(w=_.n()).done;)k()}catch(u){_.e(u)}finally{_.f()}}return e.abrupt("return",(this._dictionaryPromise=Object(N.b)(d,Object(S.j)(t)?t.spatialReference:null,j,f).then((function(e){var t={scale:0};return function(r,n){var a=e.repurposeFeature({geometry:null,attributes:r});return t.scale=Object(S.j)(n)?n.scale:void 0,e.evaluate({$feature:a,$view:t})}})).catch((function(e){return D.error("Creating dictinoary expression failed:",e),null})),this._dictionaryPromise));case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSymbol",value:function(){return null}},{key:"getSymbols",value:function(){return[]}},{key:"getAttributeHash",value:function(){return this.visualVariables&&this.visualVariables.reduce((function(e,t){return e+t.getAttributeHash()}),"")}},{key:"getMeshHash",value:function(){return"".concat(this.url,"-").concat(JSON.stringify(this.fieldMap))}},{key:"getSymbolFields",value:function(){return this._symbolFields}},{key:"_getSymbolPart",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._ongoingRequests.has(t)){e.next=2;break}return e.abrupt("return",this._ongoingRequests.get(t).then((function(e){return e.data})));case 2:return n=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),a=Object(g.default)(n,Object(i.a)({responseType:"json",query:{f:"json"}},r)),this._ongoingRequests.set(t,a),e.prev=4,e.next=7,a;case 7:return e.abrupt("return",e.sent.data);case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",(this._ongoingRequests.delete(t),Promise.reject(e.t0)));case 13:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_combineSymbolParts",value:function(e,t,r){if(!e||0===e.length)return null;var n=Object(i.a)({},e[0]);if(e.length>1){n.symbolLayers=[];var s,o=Object(l.a)(e);try{for(o.s();!(s=o.n()).done;){var u,c=s.value;(u=n.symbolLayers).unshift.apply(u,Object(a.a)(c.symbolLayers))}}catch(d){o.e(d)}finally{o.f()}}return r&&(n.callout=A),{type:"CIMSymbolReference",symbol:n,primitiveOverrides:t}}},{key:"_cimPartsToCIMSymbol",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r,n,a){var i,s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=new Array(t.length),s=0;s<t.length;s++)i[s]=this._getSymbolPart(t[s],a);return e.next=4,Promise.all(i);case 4:return o=e.sent,e.abrupt("return",new P.a({data:this._combineSymbolParts(o,r,n)}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()}]),r}(Object(R.a)(C.a));Object(v.a)([Object(F.b)({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],L.prototype,"config",void 0),Object(v.a)([Object(F.b)({type:Object,json:{write:!0}})],L.prototype,"fieldMap",void 0),Object(v.a)([Object(F.b)({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],L.prototype,"scaleExpression",void 0),Object(v.a)([Object(T.a)("scaleExpression")],L.prototype,"writeData",null),Object(v.a)([Object(F.b)({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy:function(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],L.prototype,"scaleExpressionTitle",void 0),Object(v.a)([Object(F.b)({type:String,json:{write:!0}})],L.prototype,"url",void 0),Object(v.a)([Object(T.a)("visualVariables")],L.prototype,"writeVisualVariables",null);var M=L=n=Object(v.a)([Object(I.a)("esri.renderers.DictionaryRenderer")],L)},687:function(e,t,r){"use strict";r.d(t,"a",(function(){return O}));var n,a=r(7),i=r.n(a),s=r(12),o=r(2),u=r(4),l=r(5),c=r(6),d=r(0),p=r(18),f=r(1),h=(r(14),r(19),r(15),r(31)),y=r(10),b=r(663),v=r(684),m=r(765),g=n=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).description=null,n.label=null,n.symbol=null,n.type="simple",n}return Object(u.a)(r,[{key:"collectRequiredFields",value:function(){var e=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.collectSymbolFields(t,r),this.collectVVRequiredFields(t,r)]);case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"collectSymbolFields",value:function(){var e=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.getSymbols().map((function(e){return e.collectRequiredFields(t,r)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSymbol",value:function(e,t){return this.symbol}},{key:"getSymbolAsync",value:function(){var e=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.symbol);case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSymbols",value:function(){return this.symbol?[this.symbol]:[]}},{key:"getAttributeHash",value:function(){return this.visualVariables&&this.visualVariables.reduce((function(e,t){return e+t.getAttributeHash()}),"")}},{key:"getMeshHash",value:function(){return this.getSymbols().reduce((function(e,t){return e+JSON.stringify(t)}),"")}},{key:"arcadeRequired",get:function(){return this.arcadeRequiredForVisualVariables}},{key:"clone",value:function(){return new n({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:Object(p.a)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}}]),r}(Object(v.a)(b.a));Object(d.a)([Object(f.b)({type:String,json:{write:!0}})],g.prototype,"description",void 0),Object(d.a)([Object(f.b)({type:String,json:{write:!0}})],g.prototype,"label",void 0),Object(d.a)([Object(f.b)(m.b)],g.prototype,"symbol",void 0),Object(d.a)([Object(h.a)({simple:"simple"})],g.prototype,"type",void 0);var O=g=n=Object(d.a)([Object(y.a)("esri.renderers.SimpleRenderer")],g)},688:function(e,t,r){"use strict";r.d(t,"a",(function(){return A}));var n,a=r(21),i=r(7),s=r.n(i),o=r(12),u=r(2),l=r(4),c=r(5),d=r(6),p=r(0),f=r(46),h=r(18),y=r(61),b=r(14),v=(r(19),r(15)),m=r(31),g=r(1),O=r(10),j=r(209),_=r(663),w=r(684),S=r(26),k=r(97),x=v.a.getLogger("esri.renderers.support.AttributeColorInfo"),F=n=function(e){Object(c.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).color=null,n.field=null,n.label=null,n.valueExpression=null,n.valueExpressionTitle=null,n}return Object(l.a)(r,[{key:"castField",value:function(e){return null==e?e:"function"==typeof e?(x.error(".field: field must be a string value"),null):Object(b.l)(e)}},{key:"getAttributeHash",value:function(){return"".concat(this.field,"-").concat(this.valueExpression)}},{key:"clone",value:function(){return new n({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}}]),r}(S.a);Object(p.a)([Object(g.b)({type:f.a,json:{type:[Number],write:!0}})],F.prototype,"color",void 0),Object(p.a)([Object(g.b)({type:String,json:{write:!0}})],F.prototype,"field",void 0),Object(p.a)([Object(k.a)("field")],F.prototype,"castField",null),Object(p.a)([Object(g.b)({type:String,json:{write:!0}})],F.prototype,"label",void 0),Object(p.a)([Object(g.b)({type:String,json:{write:!0}})],F.prototype,"valueExpression",void 0),Object(p.a)([Object(g.b)({type:String,json:{write:!0}})],F.prototype,"valueExpressionTitle",void 0);var I,T=F=n=Object(p.a)([Object(O.a)("esri.renderers.support.AttributeColorInfo")],F),E=I=function(e){Object(c.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(u.a)(this,r),(e=t.apply(this,arguments)).unit=null,e}return Object(l.a)(r,[{key:"clone",value:function(){return new I({unit:this.unit})}}]),r}(S.a);Object(p.a)([Object(g.b)({type:String,json:{write:!0}})],E.prototype,"unit",void 0);var C,R=E=I=Object(p.a)([Object(O.a)("esri.renderers.support.DotDensityLegendOptions")],E),N=r(166),P=r(98),D=C=function(e){Object(c.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).attributes=null,n.backgroundColor=new f.a([0,0,0,0]),n.blendDots=!0,n.dotBlendingEnabled=!0,n.dotShape="square",n.dotSize=1,n.legendOptions=null,n.outline=new P.a,n.dotValue=null,n.referenceDotValue=null,n.referenceScale=null,n.seed=1,n.type="dot-density",n}return Object(l.a)(r,[{key:"calculateDotValue",value:function(e){if(null==this.referenceScale)return this.dotValue;var t=e/this.referenceScale*this.dotValue;return t<1?1:t}},{key:"getSymbol",value:function(){return new N.a({outline:this.outline})}},{key:"getSymbolAsync",value:function(){var e=Object(o.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getSymbol());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSymbols",value:function(){return[this.getSymbol()]}},{key:"getAttributeHash",value:function(){return this.attributes&&this.attributes.reduce((function(e,t){return e+t.getAttributeHash()}),"")}},{key:"getMeshHash",value:function(){return JSON.stringify(this.outline)}},{key:"clone",value:function(){return new C({attributes:Object(h.a)(this.attributes),backgroundColor:Object(h.a)(this.backgroundColor),dotBlendingEnabled:Object(h.a)(this.dotBlendingEnabled),dotShape:Object(h.a)(this.dotShape),dotSize:Object(h.a)(this.dotSize),dotValue:Object(h.a)(this.dotValue),legendOptions:Object(h.a)(this.legendOptions),outline:Object(h.a)(this.outline),referenceScale:Object(h.a)(this.referenceScale),visualVariables:Object(h.a)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}},{key:"getControllerHash",value:function(){return"".concat(this.attributes.map((function(e){return e.field||e.valueExpression||""})),"-").concat(this.outline&&JSON.stringify(this.outline.toJSON())||"")}},{key:"collectRequiredFields",value:function(){var e=Object(o.a)(s.a.mark((function e(t,r){var n,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.collectVVRequiredFields(t,r);case 2:n=Object(a.a)(this.attributes),e.prev=3,n.s();case 5:if((i=n.n()).done){e.next=14;break}if(o=i.value,e.t0=o.valueExpression,!e.t0){e.next=11;break}return e.next=11,Object(j.a)(t,r,o.valueExpression);case 11:o.field&&t.add(o.field);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(3),n.e(e.t1);case 19:return e.prev=19,n.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[3,16,19,22]])})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Object(w.a)(_.a));Object(p.a)([Object(g.b)({type:[T],json:{write:!0}})],D.prototype,"attributes",void 0),Object(p.a)([Object(g.b)({type:f.a,json:{write:!0}})],D.prototype,"backgroundColor",void 0),Object(p.a)([Object(g.b)({type:Boolean}),Object(y.a)("dotBlendingEnabled")],D.prototype,"blendDots",void 0),Object(p.a)([Object(g.b)({type:Boolean,json:{write:!0}})],D.prototype,"dotBlendingEnabled",void 0),Object(p.a)([Object(g.b)({type:String,json:{write:!1}})],D.prototype,"dotShape",void 0),Object(p.a)([Object(g.b)({type:Number,json:{write:!1}})],D.prototype,"dotSize",void 0),Object(p.a)([Object(g.b)({type:R,json:{write:!0}})],D.prototype,"legendOptions",void 0),Object(p.a)([Object(g.b)({type:P.a,json:{default:null,write:!0}})],D.prototype,"outline",void 0),Object(p.a)([Object(g.b)({type:Number,json:{write:!0}})],D.prototype,"dotValue",void 0),Object(p.a)([Object(g.b)({type:Number}),Object(y.a)("dotValue")],D.prototype,"referenceDotValue",void 0),Object(p.a)([Object(g.b)({type:Number,json:{write:!0}})],D.prototype,"referenceScale",void 0),Object(p.a)([Object(g.b)({type:Number,json:{write:!0}})],D.prototype,"seed",void 0),Object(p.a)([Object(m.a)({dotDensity:"dot-density"})],D.prototype,"type",void 0);var A=D=C=Object(p.a)([Object(O.a)("esri.renderers.DotDensityRenderer")],D)},689:function(e,t,r){"use strict";r.d(t,"a",(function(){return S}));var n,a=r(7),i=r.n(a),s=r(12),o=r(2),u=r(4),l=r(5),c=r(6),d=r(0),p=r(46),f=r(18),h=r(1),y=(r(14),r(19),r(15),r(31)),b=r(10),v=r(209),m=r(663),g=r(26),O=n=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).color=null,n.ratio=null,n}return Object(u.a)(r,[{key:"clone",value:function(){return new n({color:this.color,ratio:this.ratio})}}]),r}(g.a);Object(d.a)([Object(h.b)({type:p.a,json:{write:!0}})],O.prototype,"color",void 0),Object(d.a)([Object(h.b)({type:Number,json:{write:!0}})],O.prototype,"ratio",void 0);var j,_=O=n=Object(d.a)([Object(b.a)("esri.renderers.support.HeatmapColorStop")],O),w=j=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).blurRadius=10,n.colorStops=[new _({ratio:0,color:new p.a("rgba(255, 140, 0, 0)")}),new _({ratio:.75,color:new p.a("rgba(255, 140, 0, 1)")}),new _({ratio:.9,color:new p.a("rgba(255, 0,   0, 1)")})],n.field=null,n.fieldOffset=0,n.maxPixelIntensity=100,n.minPixelIntensity=0,n.type="heatmap",n}return Object(u.a)(r,[{key:"collectRequiredFields",value:function(){var e=Object(s.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=this.field)&&"string"==typeof n&&Object(v.b)(t,r,n);case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getAttributeHash",value:function(){return null}},{key:"getMeshHash",value:function(){return"".concat(JSON.stringify(this.colorStops),".").concat(this.blurRadius,".").concat(this.field)}},{key:"clone",value:function(){return new j({blurRadius:this.blurRadius,colorStops:Object(f.a)(this.colorStops),field:this.field,maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity})}}]),r}(m.a);Object(d.a)([Object(h.b)({type:Number,json:{write:!0}})],w.prototype,"blurRadius",void 0),Object(d.a)([Object(h.b)({type:[_],json:{write:!0}})],w.prototype,"colorStops",void 0),Object(d.a)([Object(h.b)({type:String,json:{write:!0}})],w.prototype,"field",void 0),Object(d.a)([Object(h.b)({type:Number,json:{write:{overridePolicy:function(e,t,r){return{enabled:null==r}}}}})],w.prototype,"fieldOffset",void 0),Object(d.a)([Object(h.b)({type:Number,json:{write:!0}})],w.prototype,"maxPixelIntensity",void 0),Object(d.a)([Object(h.b)({type:Number,json:{write:!0}})],w.prototype,"minPixelIntensity",void 0),Object(d.a)([Object(y.a)({heatmap:"heatmap"})],w.prototype,"type",void 0);var S=w=j=Object(d.a)([Object(b.a)("esri.renderers.HeatmapRenderer")],w)},691:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return d}));var n=r(700),a=r(686),i=r(688),s=r(689),o=r(663),u=r(687),l=r(701),c={key:"type",base:o.a,typeMap:{heatmap:s.a,simple:u.a,"unique-value":l.a,"class-breaks":n.a,"dot-density":i.a,dictionary:a.default},errorContext:"renderer"},d={key:"type",base:o.a,typeMap:{simple:u.a,"unique-value":l.a,"class-breaks":n.a},errorContext:"renderer"}},693:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return d}));var n=r(109),a="__begin__",i="__end__",s=new RegExp(a,"ig"),o=new RegExp(i,"ig"),u=new RegExp("^"+a,"i"),l=new RegExp(i+"$","i"),c='"';function d(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function p(e){var t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):null!=e.labelExpression&&(t.expression=function(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}(e.labelExpression),t.type="conventional"),t}function f(e){var t=p(e);if(!t)return null;switch(t.type){case"conventional":return y(t.expression);case"arcade":return t.expression}return null}function h(e){var t=p(e);if(!t)return null;switch(t.type){case"conventional":return function(e){var t=e.match(b);return t&&t[1].trim()||null}(t.expression);case"arcade":return O(t.expression)}return null}function y(e){var t;return e?(t=Object(n.c)(e,(function(e){return a+'$feature["'+e+'"]'+i})),t=u.test(t)?t.replace(u,""):c+t,t=(t=l.test(t)?t.replace(l,""):t+c).replace(s,'" + ').replace(o,' + "')):t='""',t}var b=/^\s*\{([^}]+)\}\s*$/i;var v=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,m=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,g=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function O(e){if(!e)return null;var t=v.exec(e)||m.exec(e);return t?t[1]||t[3]:(t=g.exec(e))?t[2]:null}},694:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r(19);function n(e){}},696:function(e,t,r){"use strict";r.d(t,"a",(function(){return C})),r.d(t,"b",(function(){return N}));var n=r(7),a=r.n(n),i=r(22),s=r(12),o=r(21),u=r(68),l=r(29),c=r(15),d=r(11),p=r(108),f=r(107),h=r(732),y=r(53),b=r(71),v=r(13),m=(r(114),r(82)),g=r(27),O=r(62);function j(e,t,r,n){return _.apply(this,arguments)}function _(){return(_=Object(s.a)(a.a.mark((function e(t,r,n,i){var s,o,u,l,c,d,p,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="string"==typeof t?Object(g.J)(t):t,o=r[0].spatialReference,u=Object(v.a)(Object(v.a)({},i),{},{query:Object(v.a)(Object(v.a)({},s.query),{},{f:"json",sr:JSON.stringify(o),target:JSON.stringify({geometryType:Object(O.c)(r[0]),geometries:r}),cutter:JSON.stringify(n)})}),e.next=5,Object(m.default)(s.path+"/cut",u);case 5:return l=e.sent,c=l.data,d=c.cutIndexes,p=c.geometries,f=void 0===p?[]:p,e.abrupt("return",{cutIndexes:d,geometries:f.map((function(e){var t=Object(O.a)(e);return t.spatialReference=o,t}))});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t,r){return S.apply(this,arguments)}function S(){return(S=Object(s.a)(a.a.mark((function e(t,r,n){var i,s,o,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="string"==typeof t?Object(g.J)(t):t,s=r[0].spatialReference,o=Object(O.c)(r[0]),u=Object(v.a)(Object(v.a)({},n),{},{query:Object(v.a)(Object(v.a)({},i.query),{},{f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(k(r))})}),e.t0=x,e.next=4,Object(m.default)(i.path+"/simplify",u);case 4:return e.t1=e.sent.data,e.t2=o,e.t3=s,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return{geometryType:Object(O.c)(e[0]),geometries:e.map((function(e){return e.toJSON()}))}}function x(e,t,r){var n=Object(O.b)(t);return e.map((function(e){var t=n.fromJSON(e);return t.spatialReference=r,t}))}var F=c.a.getLogger("esri.geometry.support.normalizeUtils");function I(e,t,r){if(t){var n=function(e,t){if(!(e instanceof f.a||e instanceof p.a)){var r="straightLineDensify: the input geometry is neither polyline nor polygon";throw F.error(r),new l.a(r)}var n,a=Object(h.b)(e),i=[],s=Object(o.a)(a);try{for(s.s();!(n=s.n()).done;){var u=n.value,c=[];i.push(c),c.push([u[0][0],u[0][1]]);for(var d=0;d<u.length-1;d++){var y=u[d][0],b=u[d][1],v=u[d+1][0],m=u[d+1][1],g=Math.sqrt((v-y)*(v-y)+(m-b)*(m-b)),O=(m-b)/g,j=(v-y)/g,_=g/t;if(_>1){for(var w=1;w<=_-1;w++){var S=w*t,k=j*S+y,x=O*S+b;c.push([k,x])}var I=(g+Math.floor(_-1)*t)/2,T=j*I+y,E=O*I+b;c.push([T,E])}c.push([v,m])}}}catch(C){s.e(C)}finally{s.f()}return function(e){return"polygon"===e.type}(e)?new p.a({rings:i,spatialReference:e.spatialReference}):new f.a({paths:i,spatialReference:e.spatialReference})}(e,1e6);e=Object(b.e)(n,!0)}return r&&(e=Object(h.e)(e,r)),e}function T(e,t,r){if(Array.isArray(e)){var n=e[0];if(n>t){var a=Object(h.d)(n,t);e[0]=n+a*(-2*t)}else if(n<r){var i=Object(h.d)(n,r);e[0]=n+i*(-2*r)}}else{var s=e.x;if(s>t){var o=Object(h.d)(s,t);e=e.clone().offset(o*(-2*t),0)}else if(s<r){var u=Object(h.d)(s,r);e=e.clone().offset(u*(-2*r),0)}}return e}function E(e,t){for(var r=-1,n=function(n){for(var a=t.cutIndexes[n],i=t.geometries[n],s=Object(h.b)(i),u=function(e){var t=s[e];t.some((function(r){if(r[0]<180)return!0;for(var n=0,a=0;a<t.length;a++){var s=t[a][0];n=s>n?s:n}n=Number(n.toFixed(9));for(var o=-360*Object(h.d)(n,180),u=0;u<t.length;u++){var l=i.getPoint(e,u);i.setPoint(e,u,l.clone().offset(o,0))}return!0}))},l=0;l<s.length;l++)u(l);if(a===r){if(function(e){return"polygon"===e[0].type}(e)){var c,d=Object(o.a)(Object(h.b)(i));try{for(d.s();!(c=d.n()).done;){var p=c.value;e[a]=e[a].addRing(p)}}catch(v){d.e(v)}finally{d.f()}}else if(function(e){return"polyline"===e[0].type}(e)){var f,y=Object(o.a)(Object(h.b)(i));try{for(y.s();!(f=y.n()).done;){var b=f.value;e[a]=e[a].addPath(b)}}catch(v){y.e(v)}finally{y.f()}}}else r=a,e[a]=i},a=0;a<t.cutIndexes.length;a++)n(a);return e}function C(e,t,r){return R.apply(this,arguments)}function R(){return(R=Object(s.a)(a.a.mark((function e(t,r,n){var i,s,l,c,v,m,g,O,_,S,k,x,F,R,N,P,D,A,L,M,q,G,V,B,U,J,W,Q,z,H,K,Z,$,Y,X,ee,te,re,ne,ae;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)){e.next=2;break}return e.abrupt("return",C([t],r));case 2:i=r?r.url:u.a.geometryServiceUrl,S=0,k=[],x=[],F=Object(o.a)(t);try{for(F.s();!(R=F.n()).done;)N=R.value,Object(d.i)(N)?x.push(N):(s||(s=N.spatialReference,l=Object(y.e)(s),c=s.isWebMercator,g=c?102100:4326,v=h.a[g].maxX,m=h.a[g].minX,O=h.a[g].plus180Line,_=h.a[g].minus180Line),l?"mesh"===N.type?x.push(N):"point"===N.type?x.push(T(N.clone(),v,m)):"multipoint"===N.type?((P=N.clone()).points=P.points.map((function(e){return T(e,v,m)})),x.push(P)):"extent"===N.type?(D=N.clone()._normalize(!1,!1,l),x.push(D.rings?new p.a(D):D)):N.extent?(A=N.extent,L=Object(h.d)(A.xmin,m)*(2*v),M=0===L?N.clone():Object(h.e)(N.clone(),L),A.offset(L,0),A.intersects(O)&&A.xmax!==v?(S=A.xmax>S?A.xmax:S,M=I(M,c),k.push(M),x.push("cut")):A.intersects(_)&&A.xmin!==m?(S=A.xmax*(2*v)>S?A.xmax*(2*v):S,M=I(M,c,360),k.push(M),x.push("cut")):x.push(M)):x.push(N.clone()):x.push(N))}catch(a){F.e(a)}finally{F.f()}for(q=Object(h.d)(S,v),G=-90,V=q,B=new f.a;q>0;)U=360*q-180,B.addPath([[U,G],[U,-1*G]]),G*=-1,q--;if(!(k.length>0&&V>0)){e.next=28;break}return e.t0=E,e.t1=k,e.next=15,j(i,k,B,n);case 15:for(e.t2=e.sent,J=(0,e.t0)(e.t1,e.t2),W=[],Q=[],z=0;z<x.length;z++)"cut"!==(H=x[z])?Q.push(H):(K=J.shift(),Z=t[z],Object(d.j)(Z)&&"polygon"===Z.type&&Z.rings&&Z.rings.length>1&&K.rings.length>=Z.rings.length?(W.push(K),Q.push("simplify")):Q.push(c?Object(b.b)(K):K));if(W.length){e.next=22;break}return e.abrupt("return",Q);case 22:return e.next=24,w(i,W,n);case 24:for($=e.sent,Y=[],X=0;X<Q.length;X++)"simplify"!==(ee=Q[X])?Y.push(ee):Y.push(c?Object(b.b)($.shift()):$.shift());return e.abrupt("return",Y);case 28:for(te=[],re=0;re<x.length;re++)"cut"!==(ne=x[re])?te.push(ne):(ae=k.shift(),te.push(!0===c?Object(b.b)(ae):ae));return e.abrupt("return",Promise.resolve(te));case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t){var r=Object(y.e)(t);if(r){var n=Object(i.a)(r.valid,2),a=n[0],s=n[1],o=s-a;if(e<a)for(;e<a;)e+=o;if(e>s)for(;e>s;)e-=o}return e}},697:function(e,t,r){"use strict";r.d(t,"a",(function(){return F}));var n=r(7),a=r.n(n),i=r(12),s=r(2),o=r(4),u=r(8),l=r(5),c=r(6),d=r(0),p=r(15),f=r(30),h=r(1),y=(r(19),r(14),r(10)),b=r(21),v=r(52),m=r(215),g=new v.a,O=new WeakMap;function j(e){_(e)&&g.push(e)}function _(e){return e&&"object"==typeof e&&"refreshInterval"in e&&"refresh"in e}function w(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:w(t,e%t):0}var S=0,k=0;function x(){var e,t=Date.now(),r=Object(b.a)(g);try{for(r.s();!(e=r.n()).done;){var n,a=e.value;if(a.refreshInterval)t-(null!=(n=O.get(a))?n:0)+5>=6e4*a.refreshInterval&&(O.set(a,t),a.refresh(t))}}catch(i){r.e(i)}finally{r.f()}}Object(m.a)((function(){var e,t=Date.now(),r=0,n=Object(b.a)(g);try{for(n.s();!(e=n.n()).done;){var a=e.value;r=w(Math.round(6e4*a.refreshInterval),r),a.refreshInterval?O.get(a)||O.set(a,t):O.delete(a)}}catch(i){n.e(i)}finally{n.f()}if(r!==k){if(k=r,clearInterval(S),0===k)return void(S=0);S=setInterval(x,k)}}));var F=function(e){var t=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;Object(s.a)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).refreshInterval=0,e.refreshTimestamp=0,e._debounceHasDataChanged=Object(f.i)((function(){return e.hasDataChanged()})),e.when().then((function(){j(Object(u.a)(e))}),(function(){})),e}return Object(o.a)(r,[{key:"destroy",value:function(){var e;_(e=this)&&g.includes(e)&&g.remove(e)}},{key:"refreshParameters",get:function(){return{_ts:this.refreshTimestamp||null}}},{key:"refresh",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();Object(f.l)(this._debounceHasDataChanged()).then((function(r){r&&(e._set("refreshTimestamp",t),e.emit("refresh"))}),(function(t){p.a.getLogger(e.declaredClass).error(t)}))}},{key:"hasDataChanged",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),r}(e);return Object(d.a)([Object(h.b)({type:Number,cast:function(e){return e>=.1?e:e<=0?0:.1},json:{write:!0,origins:{"web-document":{write:!0}}}})],t.prototype,"refreshInterval",void 0),Object(d.a)([Object(h.b)({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),Object(d.a)([Object(h.b)()],t.prototype,"refreshParameters",null),t=Object(d.a)([Object(y.a)("esri.layers.mixins.RefreshableLayer")],t),t}},698:function(e,t,r){"use strict";r.d(t,"a",(function(){return w}));var n,a=r(2),i=r(4),s=r(5),o=r(6),u=r(0),l=r(665),c=r(678),d=r(26),p=r(18),f=r(11),h=r(1),y=(r(14),r(19),r(15),r(57)),b=r(10),v=r(43),m=n=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).respectsDaylightSaving=!1,n.timezone=null,n}return Object(i.a)(r,[{key:"readRespectsDaylightSaving",value:function(e,t){return void 0!==t.respectsDaylightSaving?t.respectsDaylightSaving:void 0!==t.respectDaylightSaving&&t.respectDaylightSaving}},{key:"clone",value:function(){var e=this.respectsDaylightSaving,t=this.timezone;return new n({respectsDaylightSaving:e,timezone:t})}}]),r}(d.a);Object(u.a)([Object(h.b)({type:Boolean,json:{write:!0}})],m.prototype,"respectsDaylightSaving",void 0),Object(u.a)([Object(y.a)("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],m.prototype,"readRespectsDaylightSaving",null),Object(u.a)([Object(h.b)({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],m.prototype,"timezone",void 0);var g,O=m=n=Object(u.a)([Object(b.a)("esri.layers.support.TimeReference")],m),j=r(669),_=g=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).cumulative=!1,n.endField=null,n.fullTimeExtent=null,n.hasLiveData=!1,n.interval=null,n.startField=null,n.timeReference=null,n.trackIdField=null,n.useTime=!0,n}return Object(i.a)(r,[{key:"readFullTimeExtent",value:function(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||2!==t.timeExtent.length)return null;var r=new Date(t.timeExtent[0]),n=new Date(t.timeExtent[1]);return new l.a({start:r,end:n})}},{key:"writeFullTimeExtent",value:function(e,t){e&&Object(f.j)(e.start)&&Object(f.j)(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}},{key:"readInterval",value:function(e,t){return t.timeInterval&&t.timeIntervalUnits?new c.a({value:t.timeInterval,unit:j.a.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new c.a({value:t.defaultTimeInterval,unit:j.a.fromJSON(t.defaultTimeIntervalUnits)}):null}},{key:"writeInterval",value:function(e,t){if(e){var r=e.toJSON();t.timeInterval=r.value,t.timeIntervalUnits=r.unit}else t.timeInterval=null,t.timeIntervalUnits=null}},{key:"clone",value:function(){var e=this.cumulative,t=this.endField,r=this.hasLiveData,n=this.interval,a=this.startField,i=this.timeReference,s=this.fullTimeExtent,o=this.trackIdField,u=this.useTime;return new g({cumulative:e,endField:t,hasLiveData:r,interval:n,startField:a,timeReference:Object(p.a)(i),fullTimeExtent:Object(p.a)(s),trackIdField:o,useTime:u})}}]),r}(d.a);Object(u.a)([Object(h.b)({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],_.prototype,"cumulative",void 0),Object(u.a)([Object(h.b)({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],_.prototype,"endField",void 0),Object(u.a)([Object(h.b)({type:l.a,json:{write:{enabled:!0,allowNull:!0}}})],_.prototype,"fullTimeExtent",void 0),Object(u.a)([Object(y.a)("fullTimeExtent",["timeExtent"])],_.prototype,"readFullTimeExtent",null),Object(u.a)([Object(v.a)("fullTimeExtent")],_.prototype,"writeFullTimeExtent",null),Object(u.a)([Object(h.b)({type:Boolean,json:{write:!0}})],_.prototype,"hasLiveData",void 0),Object(u.a)([Object(h.b)({type:c.a,json:{write:{enabled:!0,allowNull:!0}}})],_.prototype,"interval",void 0),Object(u.a)([Object(y.a)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],_.prototype,"readInterval",null),Object(u.a)([Object(v.a)("interval")],_.prototype,"writeInterval",null),Object(u.a)([Object(h.b)({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],_.prototype,"startField",void 0),Object(u.a)([Object(h.b)({type:O,json:{write:{enabled:!0,allowNull:!0}}})],_.prototype,"timeReference",void 0),Object(u.a)([Object(h.b)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],_.prototype,"trackIdField",void 0),Object(u.a)([Object(h.b)({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],_.prototype,"useTime",void 0);var w=_=g=Object(u.a)([Object(b.a)("esri.layers.support.TimeInfo")],_)},702:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l}));var n=r(21),a=r(11),i=r(135),s=r(53);function o(e,t,r){if(Object(a.i)(t)||Object(a.i)(r)||r.vcsWkid||Object(s.d)(t,r))return null;var o=Object(i.e)(t)/Object(i.e)(r);if(1===o)return null;switch(e){case"point":case"esriGeometryPoint":return function(e){return function(e,t){e&&null!=e.z&&(e.z*=t)}(e,o)};case"polyline":case"esriGeometryPolyline":return function(e){return function(e,t){if(e){var r,a=Object(n.a)(e.paths);try{for(a.s();!(r=a.n()).done;){var i,s=r.value,o=Object(n.a)(s);try{for(o.s();!(i=o.n()).done;){var u=i.value;u.length>2&&(u[2]*=t)}}catch(l){o.e(l)}finally{o.f()}}}catch(l){a.e(l)}finally{a.f()}}}(e,o)};case"polygon":case"esriGeometryPolygon":return function(e){return function(e,t){if(e){var r,a=Object(n.a)(e.rings);try{for(a.s();!(r=a.n()).done;){var i,s=r.value,o=Object(n.a)(s);try{for(o.s();!(i=o.n()).done;){var u=i.value;u.length>2&&(u[2]*=t)}}catch(l){o.e(l)}finally{o.f()}}}catch(l){a.e(l)}finally{a.f()}}}(e,o)};case"multipoint":case"esriGeometryMultipoint":return function(e){return function(e,t){if(e){var r,a=Object(n.a)(e.points);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.length>2&&(i[2]*=t)}}catch(s){a.e(s)}finally{a.f()}}}(e,o)};default:return null}}function u(e,t,r){if(null==e.hasM||e.hasZ){var a,i=Object(n.a)(t);try{for(i.s();!(a=i.n()).done;){var s,o=a.value,u=Object(n.a)(o);try{for(u.s();!(s=u.n()).done;){var l=s.value;l.length>2&&(l[2]*=r)}}catch(c){u.e(c)}finally{u.f()}}}catch(c){i.e(c)}finally{i.f()}}}function l(e,t,r){if((e||t)&&r){var n=Object(i.e)(r);c(e,r,n),c(t,r,n)}}function c(e,t,r){if(e){var a,i=Object(n.a)(e);try{for(i.s();!(a=i.n()).done;){d(a.value.geometry,t,r)}}catch(s){i.e(s)}finally{i.f()}}}function d(e,t,r){if(!Object(a.i)(e)&&e.spatialReference&&!Object(s.d)(e.spatialReference,t)){var o=Object(i.e)(e.spatialReference)/r;if(1!==o)if("x"in e)null!=e.z&&(e.z*=o);else if("rings"in e)u(e,e.rings,o);else if("paths"in e)u(e,e.paths,o);else if("points"in e&&(null==e.hasM||e.hasZ)){var l,c=Object(n.a)(e.points);try{for(c.s();!(l=c.n()).done;){var d=l.value;d.length>2&&(d[2]*=o)}}catch(p){c.e(p)}finally{c.f()}}}}},703:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return u})),r.d(t,"f",(function(){return c})),r.d(t,"g",(function(){return l}));var n=[252,146,31,255],a={type:"esriSMS",style:"esriSMSCircle",size:6,color:n,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},i={type:"esriSLS",style:"esriSLSSolid",width:.75,color:n},s={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},o={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},u={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},l={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},c={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},705:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n=r(2),a=r(5),i=r(6),s=r(0),o=r(26),u=r(1),l=(r(19),r(14),r(15),r(10)),c=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(){var e;return Object(n.a)(this,r),(e=t.apply(this,arguments)).type=null,e}return r}(o.a);Object(s.a)([Object(u.b)({type:["selection","cluster"],readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0);var d=c=Object(s.a)([Object(l.a)("esri.layers.support.FeatureReduction")],c)},710:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r(2),a=r(4),i=r(5),s=r(6),o=r(0),u=r(15),l=r(11),c=r(1),d=(r(19),r(14),r(10)),p=r(676),f=function(e){var t=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(a.a)(r,[{key:"title",get:function(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){var e=Object(p.e)(this.url);if(Object(l.j)(e)&&e.title)return e.title}return this._get("title")||""},set:function(e){this._set("title",e)}},{key:"url",set:function(e){this._set("url",Object(p.g)(e,u.a.getLogger(this.declaredClass)))}}]),r}(e);return Object(o.a)([Object(c.b)()],t.prototype,"title",null),Object(o.a)([Object(c.b)({type:String})],t.prototype,"url",null),t=Object(o.a)([Object(d.a)("esri.layers.mixins.ArcGISService")],t)}},711:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var n,a=r(2),i=r(4),s=r(5),o=r(6),u=r(0),l=r(26),c=r(1),d=(r(19),r(14)),p=(r(15),r(31)),f=r(10),h=n=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).type="map-layer",n}return Object(i.a)(r,[{key:"clone",value:function(){var e=this.mapLayerId,t=this.gdbVersion;return new n({mapLayerId:e,gdbVersion:t})}}]),r}(l.a);Object(u.a)([Object(p.a)({mapLayer:"map-layer"})],h.prototype,"type",void 0),Object(u.a)([Object(c.b)({type:d.a,json:{write:!0}})],h.prototype,"mapLayerId",void 0),Object(u.a)([Object(c.b)({type:String,json:{write:!0}})],h.prototype,"gdbVersion",void 0),h=n=Object(u.a)([Object(f.a)("esri.layers.support.source.MapLayerSource")],h)},712:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(2),a=r(4),i=r(708),s=function(){function e(t,r){Object(n.a)(this,e),this._storage=new i.b,this._storage.maxSize=t,r&&this._storage.registerRemoveFunc("",r)}return Object(a.a)(e,[{key:"put",value:function(e,t,r){this._storage.put(e,t,r,1)}},{key:"pop",value:function(e){return this._storage.pop(e)}},{key:"get",value:function(e){return this._storage.get(e)}},{key:"clear",value:function(){this._storage.clearAll()}},{key:"destroy",value:function(){this._storage.destroy()}},{key:"maxSize",get:function(){return this._storage.maxSize},set:function(e){this._storage.maxSize=e}}]),e}()},713:function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var n=r(2),a=r(4),i=r(5),s=r(6),o=r(0),u=r(42),l=r(26),c=r(18),d=r(1),p=(r(14),r(19),r(15),r(10)),f=r(43),h=new u.a({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"}),y=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).name=null,a.description=null,a.drawingTool=null,a.prototype=null,a.thumbnail=null,a}return Object(a.a)(r,[{key:"writeDrawingTool",value:function(e,t){t.drawingTool=h.toJSON(e)}},{key:"writePrototype",value:function(e,t){t.prototype=Object(c.c)(Object(c.a)(e),!0)}},{key:"writeThumbnail",value:function(e,t){t.thumbnail=Object(c.c)(Object(c.a)(e))}}]),r}(l.a);Object(o.a)([Object(d.b)({json:{write:!0}})],y.prototype,"name",void 0),Object(o.a)([Object(d.b)({json:{write:!0}})],y.prototype,"description",void 0),Object(o.a)([Object(d.b)({json:{read:h.read,write:h.write}})],y.prototype,"drawingTool",void 0),Object(o.a)([Object(f.a)("drawingTool")],y.prototype,"writeDrawingTool",null),Object(o.a)([Object(d.b)({json:{write:!0}})],y.prototype,"prototype",void 0),Object(o.a)([Object(f.a)("prototype")],y.prototype,"writePrototype",null),Object(o.a)([Object(d.b)({json:{write:!0}})],y.prototype,"thumbnail",void 0),Object(o.a)([Object(f.a)("thumbnail")],y.prototype,"writeThumbnail",null);var b=y=Object(o.a)([Object(p.a)("esri.layers.support.FeatureTemplate")],y)},714:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var n,a=r(2),i=r(4),s=r(5),o=r(6),u=r(0),l=r(42),c=r(26),d=r(18),p=r(1),f=(r(14),r(19),r(15),r(10)),h=r(43),y=new l.a({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete"}),b=n=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).maxPointCount=void 0,n.maxRecordCount=void 0,n.maxVertexCount=void 0,n.onStatisticField=null,n.outStatisticFieldName=null,n.statisticType=null,n.statisticParameters=null,n}return Object(i.a)(r,[{key:"writeStatisticParameters",value:function(e,t){"percentile-continuous"!==this.statisticType&&"percentile-discrete"!==this.statisticType||(t.statisticParameters=Object(d.a)(e))}},{key:"clone",value:function(){return new n({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:Object(d.a)(this.statisticParameters)})}}]),r}(c.a);Object(u.a)([Object(p.b)({type:Number,json:{write:!0}})],b.prototype,"maxPointCount",void 0),Object(u.a)([Object(p.b)({type:Number,json:{write:!0}})],b.prototype,"maxRecordCount",void 0),Object(u.a)([Object(p.b)({type:Number,json:{write:!0}})],b.prototype,"maxVertexCount",void 0),Object(u.a)([Object(p.b)({type:String,json:{write:!0}})],b.prototype,"onStatisticField",void 0),Object(u.a)([Object(p.b)({type:String,json:{write:!0}})],b.prototype,"outStatisticFieldName",void 0),Object(u.a)([Object(p.b)({type:String,json:{read:{source:"statisticType",reader:y.read},write:{target:"statisticType",writer:y.write}}})],b.prototype,"statisticType",void 0),Object(u.a)([Object(p.b)({type:Object})],b.prototype,"statisticParameters",void 0),Object(u.a)([Object(h.a)("statisticParameters")],b.prototype,"writeStatisticParameters",null);var v=b=n=Object(u.a)([Object(f.a)("esri.rest.support.StatisticDefinition")],b)},715:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return u}));r(19);var n=r(29),a=r(66),i=r(165),s=r(212),o=r(691);function u(e,t,r,i){var s=function(e,t){return e?function(e,t){if(!t||"web-scene"!==t.origin)return!0;switch(e.type){case"simple":case"unique-value":case"class-breaks":return!0;default:return!1}}(e,t)?e.write({},t):(t.messages&&t.messages.push(new n.a("renderer:unsupported","Renderer of type '".concat(e.declaredClass,"' are not supported in scenes."),{renderer:e,context:t})),null):null}(e,i);s&&Object(a.c)(r,s,t)}function l(e,t){return d(e,null,t)}var c=Object(s.b)({types:o.a});function d(e,t,r){return e?e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type?(r&&r.messages&&r.messages.push(new i.a("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null):c(e,t,r):null}},717:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var n,a=r(2),i=r(4),s=r(5),o=r(6),u=r(0),l=(r(114),r(42)),c=r(26),d=r(18),p=r(1),f=(r(14),r(19),r(15),r(10)),h=r(58),y=new l.a({upperLeft:"upper-left",lowerLeft:"lower-left"}),b=n=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).extent=null,n.mode="view",n.originPosition="upper-left",n.tolerance=1,n}return Object(i.a)(r,[{key:"clone",value:function(){return new n(Object(d.a)({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}}]),r}(c.a);Object(u.a)([Object(p.b)({type:h.a,json:{write:{overridePolicy:function(){return{enabled:"view"===this.mode}}}}})],b.prototype,"extent",void 0),Object(u.a)([Object(p.b)({type:["view","edit"],json:{write:!0}})],b.prototype,"mode",void 0),Object(u.a)([Object(p.b)({type:String,json:{read:y.read,write:y.write}})],b.prototype,"originPosition",void 0),Object(u.a)([Object(p.b)({type:Number,json:{write:{overridePolicy:function(){return{enabled:"view"===this.mode}}}}})],b.prototype,"tolerance",void 0);var v=b=n=Object(u.a)([Object(f.a)("esri.rest.support.QuantizationParameters")],b)},719:function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var n=r(2),a=r(4),i=r(5),s=r(6),o=r(0),u=r(665),l=r(678),c=r(1),d=(r(19),r(14),r(15),r(57)),p=r(10),f=r(698),h=r(209),y=r(669);var b=function(e){var t=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(){var e;return Object(n.a)(this,r),(e=t.apply(this,arguments)).timeExtent=null,e.timeOffset=null,e.useViewTime=!0,e}return Object(a.a)(r,[{key:"readOffset",value:function(e,t){var r=t.timeInfo.exportOptions;if(!r)return null;var n=r.timeOffset,a=y.a.fromJSON(r.timeOffsetUnits);return n&&a?new l.a({value:n,unit:a}):null}},{key:"timeInfo",set:function(e){Object(h.f)(e,this.fieldsIndex),this._set("timeInfo",e)}}]),r}(e);return Object(o.a)([Object(c.b)({type:u.a,json:{write:!1}})],t.prototype,"timeExtent",void 0),Object(o.a)([Object(c.b)({type:l.a})],t.prototype,"timeOffset",void 0),Object(o.a)([Object(d.a)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),Object(o.a)([Object(c.b)({value:null,type:f.a,json:{write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),Object(o.a)([Object(c.b)({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=Object(o.a)([Object(p.a)("esri.layers.mixins.TemporalLayer")],t),t}},720:function(e,t,r){"use strict";r.d(t,"a",(function(){return x}));var n,a=r(2),i=r(4),s=r(5),o=r(6),u=r(0),l=r(114),c=r(665),d=r(42),p=r(26),f=r(18),h=r(1),y=r(14),b=(r(19),r(15),r(10)),v=r(43),m=r(62),g=n=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).groupByFields=void 0,n.topCount=void 0,n.orderByFields=void 0,n}return Object(i.a)(r,[{key:"clone",value:function(){return new n({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}}]),r}(p.a);Object(u.a)([Object(h.b)({type:[String],json:{write:!0}})],g.prototype,"groupByFields",void 0),Object(u.a)([Object(h.b)({type:Number,json:{write:!0}})],g.prototype,"topCount",void 0),Object(u.a)([Object(h.b)({type:[String],json:{write:!0}})],g.prototype,"orderByFields",void 0);var O,j=g=n=Object(u.a)([Object(b.a)("esri.rest.support.TopFilter")],g),_=r(45),w=new d.a({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),S=new d.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),k=O=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).cacheHint=void 0,n.distance=void 0,n.geometry=null,n.geometryPrecision=void 0,n.maxAllowableOffset=void 0,n.num=void 0,n.objectIds=null,n.orderByFields=null,n.outFields=null,n.outSpatialReference=null,n.resultType=null,n.returnGeometry=!1,n.returnM=void 0,n.returnZ=void 0,n.start=void 0,n.spatialRelationship="intersects",n.timeExtent=null,n.topFilter=void 0,n.units=null,n.where="1=1",n}return Object(i.a)(r,[{key:"writeStart",value:function(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}},{key:"clone",value:function(){return new O(Object(f.a)({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}}]),r}(p.a);Object(u.a)([Object(h.b)({type:Boolean,json:{write:!0}})],k.prototype,"cacheHint",void 0),Object(u.a)([Object(h.b)({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],k.prototype,"distance",void 0),Object(u.a)([Object(h.b)({types:l.a,json:{read:m.a,write:!0}})],k.prototype,"geometry",void 0),Object(u.a)([Object(h.b)({type:Number,json:{write:!0}})],k.prototype,"geometryPrecision",void 0),Object(u.a)([Object(h.b)({type:Number,json:{write:!0}})],k.prototype,"maxAllowableOffset",void 0),Object(u.a)([Object(h.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],k.prototype,"num",void 0),Object(u.a)([Object(h.b)({json:{write:!0}})],k.prototype,"objectIds",void 0),Object(u.a)([Object(h.b)({type:[String],json:{write:!0}})],k.prototype,"orderByFields",void 0),Object(u.a)([Object(h.b)({type:[String],json:{write:!0}})],k.prototype,"outFields",void 0),Object(u.a)([Object(h.b)({type:_.a,json:{read:{source:"outSR"},write:{target:"outSR"}}})],k.prototype,"outSpatialReference",void 0),Object(u.a)([Object(h.b)({type:String,json:{write:!0}})],k.prototype,"resultType",void 0),Object(u.a)([Object(h.b)({json:{write:!0}})],k.prototype,"returnGeometry",void 0),Object(u.a)([Object(h.b)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],k.prototype,"returnM",void 0),Object(u.a)([Object(h.b)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],k.prototype,"returnZ",void 0),Object(u.a)([Object(h.b)({type:Number,json:{read:{source:"resultOffset"}}})],k.prototype,"start",void 0),Object(u.a)([Object(v.a)("start"),Object(v.a)("num")],k.prototype,"writeStart",null),Object(u.a)([Object(h.b)({type:String,json:{read:{source:"spatialRel",reader:w.read},write:{target:"spatialRel",writer:w.write}}})],k.prototype,"spatialRelationship",void 0),Object(u.a)([Object(h.b)({type:c.a,json:{write:!0}})],k.prototype,"timeExtent",void 0),Object(u.a)([Object(h.b)({type:j,json:{write:!0}})],k.prototype,"topFilter",void 0),Object(u.a)([Object(h.b)({type:String,json:{read:S.read,write:{writer:S.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],k.prototype,"units",void 0),Object(u.a)([Object(h.b)({type:String,json:{write:!0}})],k.prototype,"where",void 0),(k=O=Object(u.a)([Object(b.a)("esri.rest.support.TopFeaturesQuery")],k)).from=Object(y.m)(k);var x=k},721:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var n=r(2),a=r(5),i=r(6),s=r(0),o=r(1),u=(r(19),r(14),r(15),r(10)),l=function(e){var t=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(){var e;return Object(n.a)(this,r),(e=t.apply(this,arguments)).customParameters=null,e}return r}(e);return Object(s.a)([Object(o.b)({type:Object,json:{write:{overridePolicy:function(e){return{enabled:!!(e&&Object.keys(e).length>0)}}}}})],t.prototype,"customParameters",void 0),t=Object(s.a)([Object(u.a)("esri.layers.mixins.CustomParametersMixin")],t)}},722:function(e,t,r){"use strict";r.r(t),r.d(t,"executeQuery",(function(){return v})),r.d(t,"executeQueryForCount",(function(){return w})),r.d(t,"executeQueryForExtent",(function(){return S})),r.d(t,"executeQueryForIds",(function(){return _})),r.d(t,"executeQueryPBF",(function(){return g})),r.d(t,"executeQueryPBFBuffer",(function(){return j})),r.d(t,"queryToQueryStringParameters",(function(){return b})),r.d(t,"runQuery",(function(){return k}));var n=r(7),a=r.n(n),i=r(13),s=r(12),o=r(82),u=r(11),l=r(27),c=r(62),d=r(696),p=r(782),f=r(723),h=r(757),y="Layer does not support extent calculation.";function b(e,t){var r=e.geometry,n=e.toJSON(),a=n;if(Object(u.j)(r)&&(a.geometry=JSON.stringify(r),a.geometryType=Object(c.c)(r),a.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),n.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(a.objectIds=n.objectIds.join(",")),n.orderByFields&&(a.orderByFields=n.orderByFields.join(",")),!n.outFields||!n.returnDistinctValues&&(null!=t&&t.returnCountOnly||null!=t&&t.returnExtentOnly||null!=t&&t.returnIdsOnly)?delete a.outFields:-1!==n.outFields.indexOf("*")?a.outFields="*":a.outFields=n.outFields.join(","),n.outSR?a.outSR=n.outSR.wkid||JSON.stringify(n.outSR):r&&(n.returnGeometry||n.returnCentroid)&&(a.outSR=a.inSR),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(a.outStatistics=JSON.stringify(n.outStatistics)),n.pixelSize&&(a.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(a.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.parameterValues&&(a.parameterValues=JSON.stringify(n.parameterValues)),n.rangeValues&&(a.rangeValues=JSON.stringify(n.rangeValues)),n.dynamicDataSource&&(a.layer=JSON.stringify({source:n.dynamicDataSource}),delete n.dynamicDataSource),n.timeExtent){var i=n.timeExtent,s=i.start,o=i.end;null==s&&null==o||(a.time=s===o?s:"".concat(null==s?"null":s,",").concat(null==o?"null":o)),delete n.timeExtent}return a}function v(e,t,r,n){return m.apply(this,arguments)}function m(){return(m=Object(s.a)(a.a.mark((function e(t,r,n,i){var s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(u.j)(r.timeExtent)||!r.timeExtent.isEmpty){e.next=4;break}e.t0={data:{features:[]}},e.next=7;break;case 4:return e.next=6,k(t,r,"json",i);case 6:e.t0=e.sent;case 7:return s=e.t0,e.abrupt("return",(Object(f.a)(r,n,s.data),s));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t,r,n){return O.apply(this,arguments)}function O(){return(O=Object(s.a)(a.a.mark((function e(t,r,n,i){var s,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(u.j)(r.timeExtent)||!r.timeExtent.isEmpty){e.next=2;break}return e.abrupt("return",Promise.resolve({data:n.createFeatureResult()}));case 2:return e.next=4,j(t,r,i);case 4:return s=e.sent,o=s,e.abrupt("return",(o.data=Object(p.a)(s.data,n),o));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t,r){return k(e,t,"pbf",r)}function _(e,t,r){return Object(u.j)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):k(e,t,"json",r,{returnIdsOnly:!0})}function w(e,t,r){return Object(u.j)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):k(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function S(e,t,r){return Object(u.j)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):k(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(y);if(t.hasOwnProperty("count"))throw new Error(y);return e}))}function k(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s="string"==typeof e?Object(l.J)(e):e,c=t.geometry?[t.geometry]:[];return n.responseType="pbf"===r?"array-buffer":"json",Object(d.a)(c,null,n).then((function(e){var c=e&&e[0];Object(u.j)(c)&&((t=t.clone()).geometry=c);var d=Object(h.a)(Object(i.a)(Object(i.a)(Object(i.a)({},s.query),{},{f:r},a),b(t,a)));return Object(o.default)(Object(l.y)(s.path,"query"),Object(i.a)(Object(i.a)({},n),{},{query:Object(i.a)(Object(i.a)({},d),n.query)}))}))}},723:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(21),a=r(702);function i(e,t,r){if(r&&r.features&&r.hasZ){var i=Object(a.a)(r.geometryType,t,e.outSpatialReference);if(i){var s,o=Object(n.a)(r.features);try{for(o.s();!(s=o.n()).done;){i(s.value.geometry)}}catch(u){o.e(u)}finally{o.f()}}}}},724:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(2),a=r(4),i=r(5),s=r(6),o=r(0),u=r(1),l=(r(19),r(14),r(15),r(10));var c=function(e){var t=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(a.a)(r,[{key:"apiKey",get:function(){var e;return this._isOverridden("apiKey")?this._get("apiKey"):function(e){return"portalItem"in e}(this)?null==(e=this.portalItem)?void 0:e.apiKey:null},set:function(e){null!=e?this._override("apiKey",e):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}}]),r}(e);return Object(o.a)([Object(u.b)({type:String})],t.prototype,"apiKey",null),t=Object(o.a)([Object(l.a)("esri.layers.mixins.APIKeyMixin")],t)}},725:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return c}));r(19),r(11);var n=r(166),a=r(98),i=r(143),s=r(136),o=r(703),u=(i.a.fromJSON(o.a),a.a.fromJSON(o.c),n.a.fromJSON(o.b),s.a.fromJSON(o.d));var l=i.a.fromJSON(o.e),c=a.a.fromJSON(o.g),d=n.a.fromJSON(o.f)},727:function(e,t,r){"use strict";r.d(t,"a",(function(){return te}));var n=r(13),a=r(7),i=r.n(a),s=r(12),o=r(29),u=r(19),l=r(30),c=r(685),d=r(667),p=r(2),f=r(4),h=r(83),y=r(15),b=r(674),v=r(54),m=r(68),g=(r(243),r(27)),O=r(21),j={};function _(e){var t,r={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:Object(n.a)({},e.has),map:Object(n.a)({},e.map),packages:e.packages&&e.packages.concat()||[],paths:Object(n.a)({},e.paths)};return e.hasOwnProperty("async")||(r.async=!0),e.hasOwnProperty("isDebug")||(r.isDebug=!1),e.baseUrl||(r.baseUrl=j.baseUrl),null==(t=j.packages)||t.forEach((function(e){!function(e,t){var r,n=Object(O.a)(e);try{for(n.s();!(r=n.n()).done;)if(r.value.name===t.name)return}catch(a){n.e(a)}finally{n.f()}e.push(t)}(r.packages,e)})),r}var w,S,k=r(37),x=function e(){var t=this;Object(p.a)(this,e);var r=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((function(e){t[e]=function(){return r[e].apply(r,arguments)}}))},F=k.a.MutationObserver||k.a.WebKitMutationObserver,I=function(){var e;if(k.a.process&&k.a.process.nextTick)e=function(e){k.a.process.nextTick(e)};else if(k.a.Promise)e=function(e){k.a.Promise.resolve().then(e)};else if(F){var t=[],r=document.createElement("div");new F((function(){for(;t.length>0;)t.shift()()})).observe(r,{attributes:!0}),e=function(e){t.push(e),r.setAttribute("queueStatus","1")}}return e}(),T=function(){var e=k.a.MessageEvent;try{new e("message",{data:null})}catch(t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.data,n=t.bubbles,a=void 0!==n&&n,i=t.cancelable,s=void 0!==i&&i,o=document.createEvent("Event");return o.initEvent(e,a,s),o.data=r,o}}return function(t,r){return new e(t,r)}}(),E=function(){function e(){Object(p.a)(this,e),this._dispatcher=new x,this._workerPostMessage({type:b.a.HANDSHAKE})}return Object(f.a)(e,[{key:"terminate",value:function(){}},{key:"onmessage",get:function(){return this._onmessageHandler},set:function(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}},{key:"onmessageerror",get:function(){return this._onmessageerrorHandler},set:function(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}},{key:"onerror",get:function(){return this._onerrorHandler},set:function(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}},{key:"postMessage",value:function(e){var t=this;I((function(){t._workerMessageHandler(T("message",{data:e}))}))}},{key:"dispatchEvent",value:function(e){return this._dispatcher.dispatchEvent(e)}},{key:"addEventListener",value:function(e,t,r){this._dispatcher.addEventListener(e,t,r)}},{key:"removeEventListener",value:function(e,t,r){this._dispatcher.removeEventListener(e,t,r)}},{key:"_workerPostMessage",value:function(e){var t=this;I((function(){t.dispatchEvent(T("message",{data:e}))}))}},{key:"_workerMessageHandler",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r,n,a,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=Object(b.d)(t))||r.type!==b.a.OPEN){e.next=13;break}return n=r.modulePath,a=r.jobId,e.next=5,d.a.loadWorker(n);case 5:if(s=e.sent,e.t0=s,e.t0){e.next=11;break}return e.next=10,import(n);case 10:s=e.sent;case 11:o=d.a.connect(s),this._workerPostMessage({type:b.a.OPENED,jobId:a,data:o});case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),C=r(75),R=r(296),N=y.a.getLogger("esri.core.workers"),P=b.a.HANDSHAKE,D='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});',A="Failed to create Worker. Fallback to execute module in main thread";function L(){return M.apply(this,arguments)}function M(){return(M=Object(s.a)(i.a.mark((function e(){var t,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(u.a)("esri-workers")){e.next=2;break}return e.abrupt("return",q(new E));case 2:if(!w&&!S)try{t=D.replace('"{CONFIGURATION}"',"'".concat(V(),"'")),w=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(n){S=n||{}}if(w)try{r=new Worker(w,{name:"esri-worker-"+B++})}catch(n){N.warn(A,S),r=new E}else N.warn(A,S),r=new E;return e.abrupt("return",q(r));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return G.apply(this,arguments)}function G(){return(G=Object(s.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){function r(a){var i=Object(b.d)(a);i&&i.type===P&&(t.removeEventListener("message",r),t.removeEventListener("error",n),e(t))}function n(e){e.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",n),N.warn("Failed to create Worker. Fallback to execute module in main thread",e),(t=new E).addEventListener("message",r),t.addEventListener("error",n)}t.addEventListener("message",r),t.addEventListener("error",n)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){var e;if(null!=m.a.default){var t=Object(n.a)({},m.a);delete t.default,e=JSON.parse(JSON.stringify(t))}else e=JSON.parse(JSON.stringify(m.a));e.assetsPath=Object(g.z)(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=Object(C.b)(),e.has={"csp-restrictions":Object(u.a)("csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":Object(u.a)("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":Object(u.a)("esri-2d-query-centroid-enabled"),"featurelayer-pbf":Object(u.a)("featurelayer-pbf"),"featurelayer-simplify-thresholds":Object(u.a)("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":Object(u.a)("featurelayer-simplify-payload-size-factors"),"esri-atomics":Object(u.a)("esri-atomics"),"esri-shared-array-buffer":Object(u.a)("esri-shared-array-buffer"),"esri-tiles-debug":Object(u.a)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":Object(u.a)("esri-workers-arraybuffer-transfer"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=Object(g.z)(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=Object(g.z)(e.workers.workerPath):e.workers.workerPath=Object(g.z)(Object(v.a)("esri/core/workers/RemoteClient.js"));var r=m.a.workers.loaderConfig,a=_({baseUrl:null==r?void 0:r.baseUrl,locale:Object(C.b)(),has:Object(n.a)({"csp-restrictions":Object(u.a)("csp-restrictions"),"dojo-test-sniff":0,"host-webworker":1},null==r?void 0:r.has),map:Object(n.a)({},null==r?void 0:r.map),paths:Object(n.a)({},null==r?void 0:r.paths),packages:(null==r?void 0:r.packages)||[]}),i={version:h.d,buildDate:R.a,revision:R.b};return JSON.stringify({esriConfig:e,loaderConfig:a,kernelInfo:i})}var B=0,U=y.a.getLogger("esri.core.workers"),J=b.a.ABORT,W=b.a.INVOKE,Q=b.a.OPEN,z=b.a.OPENED,H=b.a.RESPONSE,K=function(){function e(t,r){Object(p.a)(this,e),this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=r,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",(function(e){e.preventDefault(),U.error(e)}))}return Object(f.a)(e,[{key:"terminate",value:function(){this.worker.terminate()}},{key:"open",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r,n,a,s=this,o=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:{},n=r.signal,a=Object(b.b)(),e.abrupt("return",new Promise((function(e,r){var i={resolve:e,reject:r,abortHandle:Object(l.r)(n,(function(){s._outJobs.delete(a),s._post({type:J,jobId:a})}))};s._outJobs.set(a,i),s._post({type:Q,jobId:a,modulePath:t})})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_onMessage",value:function(e){var t=Object(b.d)(e);if(t)switch(t.type){case z:this._onOpenedMessage(t);break;case H:this._onResponseMessage(t);break;case J:this._onAbortMessage(t);break;case W:this._onInvokeMessage(t)}}},{key:"_onAbortMessage",value:function(e){var t=this._inJobs,r=e.jobId,n=t.get(r);n&&(n.controller&&n.controller.abort(),t.delete(r))}},{key:"_onInvokeMessage",value:function(e){var t,r=this,n=e.methodName,a=e.jobId,i=e.data,s=e.abortable?Object(l.d)():null,o=this._inJobs,u=h.e[n];try{if("function"!=typeof u)throw new TypeError("".concat(n," is not a function"));t=u.call(null,i,{signal:s?s.signal:null})}catch(c){return void this._post({type:H,jobId:a,error:Object(b.e)(c)})}Object(l.p)(t)?(o.set(a,{controller:s,promise:t}),t.then((function(e){o.has(a)&&(o.delete(a),r._post({type:H,jobId:a},e))}),(function(e){o.has(a)&&(o.delete(a),e||(e={message:"Error encountered at method"+n}),Object(l.m)(e)||r._post({type:H,jobId:a,error:Object(b.e)(e||{message:"Error encountered at method ".concat(n)})}))}))):this._post({type:H,jobId:a},t)}},{key:"_onOpenedMessage",value:function(e){var t,r=e.jobId,n=e.data,a=this._outJobs.get(r);a&&(this._outJobs.delete(r),null==(t=a.abortHandle)||t.remove(),a.resolve(n))}},{key:"_onResponseMessage",value:function(e){var t,r=e.jobId,n=e.error,a=e.data,i=this._outJobs.get(r);i&&(this._outJobs.delete(r),null==(t=i.abortHandle)||t.remove(),n?i.reject(o.a.fromJSON(JSON.parse(n))):i.resolve(a))}},{key:"_post",value:function(e,t,r){return Object(b.c)(this.worker,e,t,r)}}],[{key:"create",value:function(){var t=Object(s.a)(i.a.mark((function t(r){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,L();case 2:return n=t.sent,t.abrupt("return",new e(n,r));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}(),Z=Object(u.a)("esri-workers-debug")?1:Object(u.a)("host-browser")?navigator.hardwareConcurrency-1:0;Z||(Z=Object(u.a)("safari")&&Object(u.a)("mac")||Object(u.a)("trident")?7:2);var $=0,Y=[];function X(e,t){return ee.apply(this,arguments)}function ee(){return(ee=Object(s.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new c.a,e.next=3,n.open(t,r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){return re.apply(this,arguments)}function re(){return re=Object(s.a)(i.a.mark((function e(t){var r,a,s,c,p,f,h,y,b,v=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=v.length>1&&void 0!==v[1]?v[1]:{},"string"==typeof t){e.next=3;break}throw new o.a("workers:undefined-module","modulePath is missing");case 3:if(a=r.strategy||"distributed",Object(u.a)("host-webworker")&&!Object(u.a)("esri-workers")&&(a="local"),"local"!==a){e.next=16;break}return e.next=7,d.a.loadWorker(t);case 7:if(s=e.sent,e.t0=s,e.t0){e.next=13;break}return e.next=12,import(t);case 12:s=e.sent;case 13:return Object(l.v)(r.signal),c=r.client||s,e.abrupt("return",X([d.a.connect(s)],Object(n.a)(Object(n.a)({},r),{},{client:c})));case 16:return e.next=18,ae();case 18:if(Object(l.v)(r.signal),"dedicated"!==a){e.next=28;break}return p=$++%Z,e.t1=X,e.next=24,Y[p].open(t,r);case 24:return e.t2=e.sent,e.t3=[e.t2],e.t4=r,e.abrupt("return",(0,e.t1)(e.t3,e.t4));case 28:if(!(r.maxNumWorkers&&r.maxNumWorkers>0)){e.next=34;break}if(!((f=Math.min(r.maxNumWorkers,Z))<Z)){e.next=34;break}for(h=new Array(f),y=0;y<f;++y)b=$++%Z,h[y]=Y[b].open(t,r);return e.abrupt("return",X(h,r));case 34:return e.abrupt("return",X(Y.map((function(e){return e.open(t,r)})),r));case 35:case"end":return e.stop()}}),e)}))),re.apply(this,arguments)}var ne=null;function ae(){return ie.apply(this,arguments)}function ie(){return(ie=Object(s.a)(i.a.mark((function e(){var t,r,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ne){e.next=2;break}return e.abrupt("return",ne);case 2:for(Object(l.d)(),t=[],r=function(e){var r=K.create(e).then((function(t){return Y[e]=t,t}));t.push(r)},n=0;n<Z;n++)r(n);return e.abrupt("return",ne=Promise.all(t));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},728:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var n=r(21),a=r(15),i=r(666),s=r(672),o=r(209),u=a.a.getLogger("esri.layers.support.fieldProperties");function l(){return{fields:{type:[i.a],value:null},fieldsIndex:{readOnly:!0,get:function(){return new s.a(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){var e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;var t,r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;this.fieldsIndex.has(a)||u.error("field-attributes-layer:invalid-field","Invalid field ".concat(a," found in outFields"),{layer:this,outFields:e})}}catch(i){r.e(i)}finally{r.f()}return Object(o.d)(this.fieldsIndex,e)}}}}},729:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var n,a=r(2),i=r(4),s=r(5),o=r(6),u=r(0),l=(r(114),r(26)),c=r(18),d=r(1),p=r(14),f=(r(19),r(15),r(10)),h=r(43),y=r(673),b=r(45),v=n=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).dynamicDataSource=void 0,n.gdbVersion=null,n.geometryPrecision=void 0,n.historicMoment=null,n.maxAllowableOffset=void 0,n.objectIds=null,n.orderByFields=null,n.outFields=null,n.outSpatialReference=null,n.relationshipId=void 0,n.start=void 0,n.num=void 0,n.returnGeometry=!1,n.returnM=void 0,n.returnZ=void 0,n.where=null,n}return Object(i.a)(r,[{key:"_writeHistoricMoment",value:function(e,t){t.historicMoment=e&&e.getTime()}},{key:"writeStart",value:function(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}},{key:"clone",value:function(){return new n(Object(c.a)({dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}}]),r}(l.a);Object(u.a)([Object(d.b)({type:y.a,json:{write:!0}})],v.prototype,"dynamicDataSource",void 0),Object(u.a)([Object(d.b)({type:String,json:{write:!0}})],v.prototype,"gdbVersion",void 0),Object(u.a)([Object(d.b)({type:Number,json:{write:!0}})],v.prototype,"geometryPrecision",void 0),Object(u.a)([Object(d.b)({type:Date})],v.prototype,"historicMoment",void 0),Object(u.a)([Object(h.a)("historicMoment")],v.prototype,"_writeHistoricMoment",null),Object(u.a)([Object(d.b)({type:Number,json:{write:!0}})],v.prototype,"maxAllowableOffset",void 0),Object(u.a)([Object(d.b)({type:[Number],json:{write:!0}})],v.prototype,"objectIds",void 0),Object(u.a)([Object(d.b)({type:[String],json:{write:!0}})],v.prototype,"orderByFields",void 0),Object(u.a)([Object(d.b)({type:[String],json:{write:!0}})],v.prototype,"outFields",void 0),Object(u.a)([Object(d.b)({type:b.a,json:{read:{source:"outSR"},write:{target:"outSR"}}})],v.prototype,"outSpatialReference",void 0),Object(u.a)([Object(d.b)({json:{write:!0}})],v.prototype,"relationshipId",void 0),Object(u.a)([Object(d.b)({type:Number,json:{read:{source:"resultOffset"}}})],v.prototype,"start",void 0),Object(u.a)([Object(h.a)("start"),Object(h.a)("num")],v.prototype,"writeStart",null),Object(u.a)([Object(d.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],v.prototype,"num",void 0),Object(u.a)([Object(d.b)({json:{write:!0}})],v.prototype,"returnGeometry",void 0),Object(u.a)([Object(d.b)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],v.prototype,"returnM",void 0),Object(u.a)([Object(d.b)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],v.prototype,"returnZ",void 0),Object(u.a)([Object(d.b)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],v.prototype,"where",void 0),(v=n=Object(u.a)([Object(f.a)("esri.rest.support.RelationshipQuery")],v)).from=Object(p.m)(v);var m=v},732:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return l}));var n=r(21),a=r(107),i=r(45),s=r(62),o={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new a.a({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:i.a.WebMercator}),minus180Line:new a.a({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:i.a.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new a.a({paths:[[[180,-180],[180,180]]],spatialReference:i.a.WGS84}),minus180Line:new a.a({paths:[[[-180,-180],[-180,180]]],spatialReference:i.a.WGS84})}};function u(e,t){return Math.ceil((e-t)/(2*t))}function l(e,t){var r,a=c(e),i=Object(n.a)(a);try{for(i.s();!(r=i.n()).done;){var s,o=r.value,u=Object(n.a)(o);try{for(u.s();!(s=u.n()).done;){s.value[0]+=t}}catch(l){u.e(l)}finally{u.f()}}}catch(l){i.e(l)}finally{i.f()}return e}function c(e){return Object(s.g)(e)?e.rings:e.paths}function d(e){var t=(null==e?void 0:e.isWebMercator)?102100:4326;return[o[t].minX,o[t].maxX]}},733:function(e,t,r){"use strict";r.d(t,"a",(function(){return g}));var n=r(2),a=r(4),i=r(5),s=r(6),o=r(0),u=r(26),l=r(18),c=r(1),d=(r(14),r(19),r(15),r(57)),p=r(10),f=r(43),h=r(664),y=(r(660),r(661)),b=r(662),v=r(713),m=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).id=null,a.name=null,a.domains=null,a.templates=null,a}return Object(a.a)(r,[{key:"readDomains",value:function(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];switch(n.type){case"range":t[r]=b.a.fromJSON(n);break;case"codedValue":t[r]=h.a.fromJSON(n);break;case"inherited":t[r]=y.a.fromJSON(n)}}return t}},{key:"writeDomains",value:function(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]&&e[n].toJSON());Object(l.c)(r),t.domains=r}},{key:"readTemplates",value:function(e){return e&&e.map((function(e){return new v.a(e)}))}},{key:"writeTemplates",value:function(e,t){t.templates=e&&e.map((function(e){return e.toJSON()}))}}]),r}(u.a);Object(o.a)([Object(c.b)({json:{write:!0}})],m.prototype,"id",void 0),Object(o.a)([Object(c.b)({json:{write:!0}})],m.prototype,"name",void 0),Object(o.a)([Object(c.b)({json:{write:!0}})],m.prototype,"domains",void 0),Object(o.a)([Object(d.a)("domains")],m.prototype,"readDomains",null),Object(o.a)([Object(f.a)("domains")],m.prototype,"writeDomains",null),Object(o.a)([Object(c.b)({json:{write:!0}})],m.prototype,"templates",void 0),Object(o.a)([Object(d.a)("templates")],m.prototype,"readTemplates",null),Object(o.a)([Object(f.a)("templates")],m.prototype,"writeTemplates",null);var g=m=Object(o.a)([Object(p.a)("esri.layers.support.FeatureType")],m)},734:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(2),a=function e(t,r,a,i){Object(n.a)(this,e),this._candidates=null,this._known=null,this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=t,this._known=r,this._ordered=a,this.pagesDefinition=i}},735:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return ir}));var n=r(21),a=r(7),i=r.n(a),s=r(12),o=r(13),u=r(2),l=r(4),c=r(77),d=r(65),p=r(5),f=r(6),h=r(0),y=r(214),b=(r(700),r(686),r(688),r(689),r(663),r(687)),v=r(701),m=r(715),g=r(691),O=r(82),j=r(332),_=r(52),w=r(29),S=r(183),k=r(19),x=r(42),F=r(15),I=r(11),T=r(677),E=r(66),C=r(30);function R(e,t){return N.apply(this,arguments)}function N(){return(N=Object(s.a)(i.a.mark((function e(t,n){var a,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(5).then(r.bind(null,736));case 2:return a=e.sent,s=a.WhereClause,e.abrupt("return",s.create(t,n));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P,D=r(27),A=r(1),L=r(97),M=r(57),q=r(10),G=r(43),V=r(212),B=r(26),U=r(18),J=r(14),W=P=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).expression=null,n.name=null,n.returnType="boolean",n.title=null,n}return Object(l.a)(r,[{key:"clone",value:function(){return new P({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}}]),r}(B.a);Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],W.prototype,"expression",void 0),Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],W.prototype,"name",void 0),Object(h.a)([Object(A.b)({type:["boolean"],json:{write:!0}})],W.prototype,"returnType",void 0),Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],W.prototype,"title",void 0);var Q=W=P=Object(h.a)([Object(q.a)("esri.form.ExpressionInfo")],W),z=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).description=null,n.label=null,n.type=null,n.visibilityExpression=null,n}return r}(B.a);Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],z.prototype,"description",void 0),Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],z.prototype,"label",void 0),Object(h.a)([Object(A.b)()],z.prototype,"type",void 0),Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],z.prototype,"visibilityExpression",void 0);var H,K=z=Object(h.a)([Object(q.a)("esri.form.elements.Element")],z),Z=H=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).type=null,n}return Object(l.a)(r,[{key:"clone",value:function(){return new H({type:this.type})}}]),r}(B.a);Object(h.a)([Object(A.b)({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],Z.prototype,"type",void 0);var $,Y=Z=H=Object(h.a)([Object(q.a)("esri.form.elements.inputs.AttachmentInput")],Z),X=$=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).attachmentKeyword=null,n.editable=!0,n.input=null,n.type="attachment",n}return Object(l.a)(r,[{key:"clone",value:function(){return new $({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}}]),r}(K);Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],X.prototype,"attachmentKeyword",void 0),Object(h.a)([Object(A.b)({type:Boolean,json:{write:!0}})],X.prototype,"editable",void 0),Object(h.a)([Object(A.b)({type:Y,json:{read:{source:"inputType"},write:{target:"inputType"}}})],X.prototype,"input",void 0),Object(h.a)([Object(A.b)({type:["attachment"],json:{read:!1,write:!0}})],X.prototype,"type",void 0);var ee=X=$=Object(h.a)([Object(q.a)("esri.form.elements.AttachmentElement")],X),te=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).type=null,n}return r}(B.a);Object(h.a)([Object(A.b)()],te.prototype,"type",void 0);var re=te=Object(h.a)([Object(q.a)("esri.form.elements.inputs.Input")],te),ne=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).maxLength=null,n.minLength=0,n}return r}(re);Object(h.a)([Object(A.b)({type:Number,json:{write:!0}})],ne.prototype,"maxLength",void 0),Object(h.a)([Object(A.b)({type:Number,json:{write:!0}})],ne.prototype,"minLength",void 0);var ae,ie=ne=Object(h.a)([Object(q.a)("esri.form.elements.inputs.TextInput")],ne),se=ae=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).type="barcode-scanner",n}return Object(l.a)(r,[{key:"clone",value:function(){return new ae({maxLength:this.maxLength,minLength:this.minLength})}}]),r}(ie);Object(h.a)([Object(A.b)({type:["barcode-scanner"],json:{read:!1,write:!0}})],se.prototype,"type",void 0);var oe,ue=se=ae=Object(h.a)([Object(q.a)("esri.form.elements.inputs.BarcodeScannerInput")],se),le=oe=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).noValueOptionLabel=null,n.showNoValueOption=!1,n.type="combo-box",n}return Object(l.a)(r,[{key:"clone",value:function(){return new oe({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}}]),r}(re);Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],le.prototype,"noValueOptionLabel",void 0),Object(h.a)([Object(A.b)({type:Boolean,json:{write:!0}})],le.prototype,"showNoValueOption",void 0),Object(h.a)([Object(A.b)({type:["combo-box"],json:{read:!1,write:!0}})],le.prototype,"type",void 0);var ce,de=le=oe=Object(h.a)([Object(q.a)("esri.form.elements.inputs.ComboBoxInput")],le);function pe(e){return null!=e?new Date(e):null}function fe(e){return e?e.getTime():null}var he=ce=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).includeTime=!1,n.max=null,n.min=null,n.type="datetime-picker",n}return Object(l.a)(r,[{key:"readMax",value:function(e,t){return pe(t.max)}},{key:"writeMax",value:function(e,t){t.max=fe(e)}},{key:"readMin",value:function(e,t){return pe(t.min)}},{key:"writeMin",value:function(e,t){t.min=fe(e)}},{key:"clone",value:function(){return new ce({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}}]),r}(re);Object(h.a)([Object(A.b)({type:Boolean,json:{write:!0}})],he.prototype,"includeTime",void 0),Object(h.a)([Object(A.b)({type:Date,json:{type:Number,write:!0}})],he.prototype,"max",void 0),Object(h.a)([Object(M.a)("max")],he.prototype,"readMax",null),Object(h.a)([Object(G.a)("max")],he.prototype,"writeMax",null),Object(h.a)([Object(A.b)({type:Date,json:{type:Number,write:!0}})],he.prototype,"min",void 0),Object(h.a)([Object(M.a)("min")],he.prototype,"readMin",null),Object(h.a)([Object(G.a)("min")],he.prototype,"writeMin",null),Object(h.a)([Object(A.b)({type:["datetime-picker"],json:{read:!1,write:!0}})],he.prototype,"type",void 0);var ye,be=he=ce=Object(h.a)([Object(q.a)("esri.form.elements.inputs.DateTimePickerInput")],he),ve=ye=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).noValueOptionLabel=null,n.showNoValueOption=!1,n.type="radio-buttons",n}return Object(l.a)(r,[{key:"clone",value:function(){return new ye({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}}]),r}(re);Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],ve.prototype,"noValueOptionLabel",void 0),Object(h.a)([Object(A.b)({type:Boolean,json:{write:!0}})],ve.prototype,"showNoValueOption",void 0),Object(h.a)([Object(A.b)({type:["radio-buttons"],json:{read:!1,write:!0}})],ve.prototype,"type",void 0);var me,ge=ve=ye=Object(h.a)([Object(q.a)("esri.form.elements.inputs.RadioButtonsInput")],ve),Oe=me=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).offValue=null,n.onValue=null,n.type="switch",n}return Object(l.a)(r,[{key:"clone",value:function(){return new me({offValue:this.offValue,onValue:this.onValue})}}]),r}(re);Object(h.a)([Object(A.b)({type:[String,Number],json:{write:!0}})],Oe.prototype,"offValue",void 0),Object(h.a)([Object(A.b)({type:[String,Number],json:{write:!0}})],Oe.prototype,"onValue",void 0),Object(h.a)([Object(A.b)({type:["switch"],json:{read:!1,write:!0}})],Oe.prototype,"type",void 0);var je,_e=Oe=me=Object(h.a)([Object(q.a)("esri.form.elements.inputs.SwitchInput")],Oe),we=je=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).type="text-area",n}return Object(l.a)(r,[{key:"clone",value:function(){return new je({maxLength:this.maxLength,minLength:this.minLength})}}]),r}(ie);Object(h.a)([Object(A.b)({type:["text-area"],json:{read:!1,write:!0}})],we.prototype,"type",void 0);var Se,ke=we=je=Object(h.a)([Object(q.a)("esri.form.elements.inputs.TextAreaInput")],we),xe=Se=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).type="text-box",n}return Object(l.a)(r,[{key:"clone",value:function(){return new Se({maxLength:this.maxLength,minLength:this.minLength})}}]),r}(ie);Object(h.a)([Object(A.b)({type:["text-box"],json:{read:!1,write:!0}})],xe.prototype,"type",void 0);var Fe,Ie={base:re,key:"type",typeMap:{"barcode-scanner":ue,"combo-box":de,"datetime-picker":be,"radio-buttons":ge,switch:_e,"text-area":ke,"text-box":xe=Se=Object(h.a)([Object(q.a)("esri.form.elements.inputs.TextBoxInput")],xe)}},Te=r(679),Ee=Fe=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).domain=null,n.editable=!0,n.fieldName=null,n.hint=null,n.input=null,n.requiredExpression=null,n.type="field",n}return Object(l.a)(r,[{key:"clone",value:function(){return new Fe({description:this.description,domain:this.domain,editable:this.editable,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,visibilityExpression:this.visibilityExpression})}}]),r}(K);Object(h.a)([Object(A.b)({types:Te.b,json:{read:{reader:Te.a},write:!0}})],Ee.prototype,"domain",void 0),Object(h.a)([Object(A.b)({type:Boolean,json:{write:!0}})],Ee.prototype,"editable",void 0),Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],Ee.prototype,"fieldName",void 0),Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],Ee.prototype,"hint",void 0),Object(h.a)([Object(A.b)({types:Ie,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Ee.prototype,"input",void 0),Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],Ee.prototype,"requiredExpression",void 0),Object(h.a)([Object(A.b)({type:String,json:{read:!1,write:!0}})],Ee.prototype,"type",void 0);var Ce,Re=Ee=Fe=Object(h.a)([Object(q.a)("esri.form.elements.FieldElement")],Ee),Ne=r(339),Pe=Ce=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).displayCount=null,n.displayType="list",n.editable=!0,n.orderByFields=null,n.relationshipId=null,n.type="relationship",n}return Object(l.a)(r,[{key:"clone",value:function(){return new Ce({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:Object(U.a)(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}}]),r}(K);Object(h.a)([Object(A.b)({type:Number,json:{write:!0}})],Pe.prototype,"displayCount",void 0),Object(h.a)([Object(A.b)({type:["list"],json:{write:!0}})],Pe.prototype,"displayType",void 0),Object(h.a)([Object(A.b)({type:Boolean,json:{write:!0}})],Pe.prototype,"editable",void 0),Object(h.a)([Object(A.b)({type:[Ne.a],json:{write:!0}})],Pe.prototype,"orderByFields",void 0),Object(h.a)([Object(A.b)({type:Number,json:{write:!0}})],Pe.prototype,"relationshipId",void 0),Object(h.a)([Object(A.b)({type:["relationship"],json:{read:!1,write:!0}})],Pe.prototype,"type",void 0);var De,Ae=Pe=Ce=Object(h.a)([Object(q.a)("esri.form.elements.RelationshipElement")],Pe);function Le(e){return{typesWithGroup:{base:K,key:"type",typeMap:{attachment:ee,field:Re,group:e,relationship:Ae}},typesWithoutGroup:{base:K,key:"type",typeMap:{attachment:ee,field:Re,relationship:Ae}}}}function Me(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)return null;var n=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((function(e){return n[e.type]})).map((function(e){return n[e.type].fromJSON(e)}))}function qe(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!e)return null;var n=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((function(e){return n[e.type]})).map((function(e){return e.toJSON()}))}function Ge(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e?e.map((function(e){return Object(J.k)(r?t.typesWithGroup:t.typesWithoutGroup,e)})):null}var Ve=De=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).elements=null,n.initialState="expanded",n.type="group",n}return Object(l.a)(r,[{key:"castElements",value:function(e){return Ge(e,Ue,!1)}},{key:"readElements",value:function(e,t){return Me(t.formElements,Ue,!1)}},{key:"writeElements",value:function(e,t){t.formElements=qe(e,Ue,!1)}},{key:"clone",value:function(){return new De({description:this.description,elements:Object(U.a)(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}}]),r}(K);Object(h.a)([Object(A.b)({json:{write:!0}})],Ve.prototype,"elements",void 0),Object(h.a)([Object(L.a)("elements")],Ve.prototype,"castElements",null),Object(h.a)([Object(M.a)("elements",["formElements"])],Ve.prototype,"readElements",null),Object(h.a)([Object(G.a)("elements")],Ve.prototype,"writeElements",null),Object(h.a)([Object(A.b)({type:["collapsed","expanded"],json:{write:!0}})],Ve.prototype,"initialState",void 0),Object(h.a)([Object(A.b)({type:String,json:{read:!1,write:!0}})],Ve.prototype,"type",void 0);var Be,Ue=Le(Ve=De=Object(h.a)([Object(q.a)("esri.form.elements.GroupElement")],Ve)),Je=Le(Ve),We=Be=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).description=null,n.elements=null,n.expressionInfos=null,n.title=null,n}return Object(l.a)(r,[{key:"castElements",value:function(e){return Ge(e,Je)}},{key:"readElements",value:function(e,t){return Me(t.formElements,Je)}},{key:"writeElements",value:function(e,t){t.formElements=qe(e,Je)}},{key:"clone",value:function(){return new Be({description:this.description,expressionInfos:Object(U.a)(this.expressionInfos),elements:Object(U.a)(this.elements),title:this.title})}}]),r}(B.a);Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],We.prototype,"description",void 0),Object(h.a)([Object(A.b)({json:{write:!0}})],We.prototype,"elements",void 0),Object(h.a)([Object(L.a)("elements")],We.prototype,"castElements",null),Object(h.a)([Object(M.a)("elements",["formElements"])],We.prototype,"readElements",null),Object(h.a)([Object(G.a)("elements")],We.prototype,"writeElements",null),Object(h.a)([Object(A.b)({type:[Q],json:{write:!0}})],We.prototype,"expressionInfos",void 0),Object(h.a)([Object(A.b)({type:String,json:{write:!0}})],We.prototype,"title",void 0);var Qe=We=Be=Object(h.a)([Object(q.a)("esri.form.FormTemplate")],We),ze=r(58),He=r(742),Ke=r(45),Ze=r(682),$e=(r(114),r(210)),Ye=r(142),Xe=r(242),et=r(727);var tt,rt=r(723),nt=r(702),at=r(668),it=r(108),st=r(236),ot=0,ut=F.a.getLogger("esri.layers.graphics.sources.MemorySource"),lt=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e))._idToClientGraphic=null,n.type="memory",n}return Object(l.a)(r,[{key:"load",value:function(e){var t=Object(I.j)(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}},{key:"destroy",value:function(){var e;null==(e=this._connection)||e.close(),this._connection=null}},{key:"workerGeometryType",get:function(){var e,t=null==(e=this.layer)?void 0:e.geometryType;return t?this._geometryTypeRequiresClientGraphicMapping(t)?"polygon":t:null}},{key:"applyEdits",value:function(e){var t=this;return this.load().then((function(){return t._applyEdits(e)}))}},{key:"openPorts",value:function(){var e=this;return this.load().then((function(){return e._connection.openPorts()}))}},{key:"queryFeatures",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r,a,s,o,u,l,c,d,p,f=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>1&&void 0!==f[1]?f[1]:{},e.next=3,this.load(r);case 3:return e.next=5,this._connection.invoke("queryFeatures",t?t.toJSON():null,r);case 5:if(a=e.sent,Object(rt.a)(t,this.layer.spatialReference,a),s=at.default.fromJSON(a),this._requiresClientGraphicMapping()){e.next=10;break}return e.abrupt("return",s);case 10:o=this.layer.objectIdField,u=Object(n.a)(s.features);try{for(u.s();!(l=u.n()).done;)c=l.value,d=c.attributes[o],(p=this._idToClientGraphic.get(d))&&(c.geometry=p.geometry)}catch(i){u.e(i)}finally{u.f()}return e.abrupt("return",(s.geometryType=this.layer.geometryType,s));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryFeaturesJSON",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r,n,a=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>1&&void 0!==a[1]?a[1]:{},!this._requiresClientGraphicMapping()){e.next=3;break}throw new w.a("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");case 3:return e.next=5,this.load(r);case 5:return e.next=7,this._connection.invoke("queryFeatures",t?t.toJSON():null,r);case 7:return n=e.sent,e.abrupt("return",(Object(rt.a)(t,this.layer.spatialReference,n),n));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.load(r).then((function(){return t._connection.invoke("queryFeatureCount",e?e.toJSON():null,r)}))}},{key:"queryObjectIds",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.load(r).then((function(){return t._connection.invoke("queryObjectIds",e?e.toJSON():null,r)}))}},{key:"queryExtent",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.load(r).then((function(){return t._connection.invoke("queryExtent",e?e.toJSON():null,r)})).then((function(e){return{count:e.count,extent:ze.a.fromJSON(e.extent)}}))}},{key:"querySnapping",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.load(r).then((function(){return t._connection.invoke("querySnapping",e,r)}))}},{key:"_applyEdits",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r,a,s,o,u,l,c,d,p,f,h,y,b,v,m,g,O;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._connection){e.next=2;break}throw new w.a("feature-layer-source:edit-failure","Memory source not loaded");case 2:return r=this.layer.objectIdField,a=null,s=[],o=[],e.next=7,Promise.all([this._prepareClientMapping(t.addFeatures,null),this._prepareClientMapping(t.updateFeatures,null)]);case 7:if(u=function(e){return"objectId"in e&&null!=e.objectId?e.objectId:"attributes"in e&&null!=e.attributes[r]?e.attributes[r]:null},t.addFeatures&&(a=this._prepareAddFeatures(t.addFeatures)),t.deleteFeatures){l=Object(n.a)(t.deleteFeatures);try{for(l.s();!(c=l.n()).done;)d=c.value,null!=(p=u(d))&&s.push(p)}catch(i){l.e(i)}finally{l.f()}}if(f=t.updateFeatures&&this._idToClientGraphic?new Map:null,t.updateFeatures){h=Object(n.a)(t.updateFeatures);try{for(h.s();!(y=h.n()).done;)b=y.value,o.push(this._serializeFeature(b)),f&&null!=(v=u(b))&&f.set(v,b)}catch(i){h.e(i)}finally{h.f()}}return Object(nt.b)(a?a.features:null,o,this.layer.spatialReference),e.next=14,this._connection.invoke("applyEdits",{adds:a?a.features:[],updates:o,deletes:s});case 14:return m=e.sent,g=m.fullExtent,O=m.featureEditResults,e.abrupt("return",(this.fullExtent=g,a&&a.finish(O.uidToObjectId),this._updateClientGraphicIds(f,O),this._createEditsResult(O)));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_prepareClientMapping",value:function(){var e=Object(s.a)(i.a.mark((function e(t,r){var a,s,o,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("mesh"===this.layerOrSourceGeometryType&&!Object(I.i)(t)){e.next=2;break}return e.abrupt("return");case 2:a=[],s=Object(n.a)(t);try{for(s.s();!(o=s.n()).done;)u=o.value.geometry,!Object(I.j)(u)||"mesh"!==u.type||u.hasExtent||u.loaded||a.push(u.load({signal:r}))}catch(i){s.e(i)}finally{s.f()}if(e.t0=a.length,!e.t0){e.next=9;break}return e.next=9,Promise.all(a);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_updateClientGraphicIds",value:function(e,t){if(this._idToClientGraphic){if(e){var r,a=Object(n.a)(t.updateResults);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i.success){var s=e.get(i.objectId);null!=s&&this._addIdToClientGraphic(s)}}}catch(c){a.e(c)}finally{a.f()}}var o,u=Object(n.a)(t.deleteResults);try{for(u.s();!(o=u.n()).done;){var l=o.value;l.success&&this._idToClientGraphic.delete(l.objectId)}}catch(c){u.e(c)}finally{u.f()}}}},{key:"_createEditsResult",value:function(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}},{key:"_createFeatureEditResult",value:function(e){var t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new w.a("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}},{key:"_prepareAddFeatures",value:function(e){for(var t=new Map,r=new Array(e.length),n=null,a=0;a<e.length;a++){var i=e[a],s=this._serializeFeature(i);!n&&Object(I.j)(i.geometry)&&(n=i.geometry.type),r[a]=s,t.set("".concat(s.uid),i)}var o=this;return{features:r,inferredGeometryType:n,finish:function(e){var r=o.sourceJSON.objectIdField;for(var n in e){var a=e[n],i=t.get(n);i&&(i.attributes||(i.attributes={}),-1===a?delete i.attributes[r]:i.attributes[r]=a,o._addIdToClientGraphic(i))}}}}},{key:"_addIdToClientGraphic",value:function(e){if(this._idToClientGraphic){var t=this.sourceJSON.objectIdField,r=e.attributes&&e.attributes[t];null!=r&&this._idToClientGraphic.set(r,e)}}},{key:"layerOrSourceGeometryType",get:function(){var e,t,r;return null!=(e=null==(t=this.layer)?void 0:t.geometryType)?e:null==(r=this.sourceJSON)?void 0:r.geometryType}},{key:"_requiresClientGraphicMapping",value:function(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}},{key:"_geometryRequiresClientGraphicMapping",value:function(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}},{key:"_geometryTypeRequiresClientGraphicMapping",value:function(e){return"mesh"===e||"multipatch"===e||"extent"===e}},{key:"_serializeFeature",value:function(e){var t=e.attributes,r=this._geometryForSerialization(e),n=(ot++).toString();return r?{uid:n,geometry:r.toJSON(),attributes:t}:{uid:n,attributes:t}}},{key:"_geometryForSerialization",value:function(e){var t=e.geometry;return Object(I.i)(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?it.a.fromExtent(t.extent):null:t}},{key:"_startWorker",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r,a,s,o,u,l,c,d,p,f,h,y,b,v,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(et.a)("MemorySourceWorker",{strategy:Object(k.a)("feature-layers-workers")?"dedicated":"local",signal:t});case 2:return this._connection=e.sent,r=this.layer,a=r.fields,s=r.spatialReference,o=r.objectIdField,u=r.hasM,l=r.hasZ,c=r.timeInfo,d="defaults"===this.layer.originOf("spatialReference"),e.next=6,this._prepareClientMapping(this.items,t);case 6:return p=this._prepareAddFeatures(this.items),this.on("before-changes",(function(e){ut.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),e.preventDefault()})),f={features:p.features,fields:a&&a.map((function(e){return e.toJSON()})),geometryType:st.c.toJSON(this.workerGeometryType),hasM:"mesh"!==this.layerOrSourceGeometryType&&u,hasZ:"mesh"===this.layerOrSourceGeometryType||l,objectIdField:o,spatialReference:d?null:s&&s.toJSON(),timeInfo:c?c.toJSON():null},e.next=11,this._connection.invoke("load",f,{signal:t});case 11:h=e.sent,y=Object(n.a)(h.warnings);try{for(y.s();!(b=y.n()).done;)v=b.value,ut.warn(v.message,{layer:this.layer,warning:v})}catch(i){y.e(i)}finally{y.f()}h.featureErrors.length&&ut.warn("Encountered ".concat(h.featureErrors.length," validation errors while loading features"),h.featureErrors),m=h.layerDefinition,this._geometryTypeRequiresClientGraphicMapping(p.inferredGeometryType)&&(m.geometryType=st.c.toJSON(p.inferredGeometryType)),this.sourceJSON=m,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),p.finish(h.assignedObjectIds);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(Ye.a.LoadableMixin(Object(Xe.b)(_.a)));Object(h.a)([(tt={Type:$e.a,ensureType:Object(J.m)($e.a)},function(e,t){e[t]=tt})],lt.prototype,"itemType",void 0),Object(h.a)([Object(A.b)()],lt.prototype,"type",void 0),Object(h.a)([Object(A.b)({constructOnly:!0})],lt.prototype,"layer",void 0),Object(h.a)([Object(A.b)({readOnly:!0})],lt.prototype,"workerGeometryType",null),Object(h.a)([Object(A.b)()],lt.prototype,"sourceJSON",void 0);var ct,dt=lt=Object(h.a)([Object(q.a)("esri.layers.graphics.sources.MemorySource")],lt),pt=r(724),ft=r(710),ht=r(730),yt=r(721),bt=r(709),vt=r(756),mt=r(699),gt=r(697),Ot=r(716),jt=r(719),_t=r(676),wt=r(671),St=ct=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){return Object(u.a)(this,r),t.call(this,e)}return Object(l.a)(r,[{key:"clone",value:function(){var e=this.name,t=this.fields,r=this.isAscending,n=this.isUnique,a=this.description;return new ct({name:e,fields:t,isAscending:r,isUnique:n,description:a})}}]),r}(B.a);Object(h.a)([Object(A.b)({constructOnly:!0})],St.prototype,"name",void 0),Object(h.a)([Object(A.b)({constructOnly:!0})],St.prototype,"fields",void 0),Object(h.a)([Object(A.b)({constructOnly:!0})],St.prototype,"isAscending",void 0),Object(h.a)([Object(A.b)({constructOnly:!0})],St.prototype,"isUnique",void 0),Object(h.a)([Object(A.b)({constructOnly:!0})],St.prototype,"description",void 0);St=ct=Object(h.a)([Object(q.a)("esri.layers.support.FeatureIndex")],St);var kt=r(746),xt=r(713),Ft=r(733),It=r(728),Tt=r(209),Et=r(135),Ct=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).shapeAreaField=null,n.shapeLengthField=null,n.units=null,n}return r}(B.a);Object(h.a)([Object(A.b)({type:String,json:{read:{source:"shapeAreaFieldName"}}})],Ct.prototype,"shapeAreaField",void 0),Object(h.a)([Object(A.b)({type:String,json:{read:{source:"shapeLengthFieldName"}}})],Ct.prototype,"shapeLengthField",void 0),Object(h.a)([Object(A.b)({type:String,json:{read:function(e){return Et.a.read(e)||Et.j.read(e)}}})],Ct.prototype,"units",void 0);var Rt=Ct=Object(h.a)([Object(q.a)("esri.layers.support.GeometryFieldsInfo")],Ct),Nt=r(675),Pt=r(740),Dt=r(745),At=new x.a({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Lt=new x.a({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"}),Mt=function(e){Object(p.a)(r,e);var t=Object(f.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).cardinality=null,n.composite=null,n.id=null,n.keyField=null,n.keyFieldInRelationshipTable=null,n.name=null,n.relatedTableId=null,n.relationshipTableId=null,n.role=null,n}return r}(B.a);Object(h.a)([Object(A.b)({json:{read:At.read,write:At.write}})],Mt.prototype,"cardinality",void 0),Object(h.a)([Object(A.b)({json:{read:!0,write:!0}})],Mt.prototype,"composite",void 0),Object(h.a)([Object(A.b)({json:{read:!0,write:!0}})],Mt.prototype,"id",void 0),Object(h.a)([Object(A.b)({json:{read:!0,write:!0}})],Mt.prototype,"keyField",void 0),Object(h.a)([Object(A.b)({json:{read:!0,write:!0}})],Mt.prototype,"keyFieldInRelationshipTable",void 0),Object(h.a)([Object(A.b)({json:{read:!0,write:!0}})],Mt.prototype,"name",void 0),Object(h.a)([Object(A.b)({json:{read:!0,write:!0}})],Mt.prototype,"relatedTableId",void 0),Object(h.a)([Object(A.b)({json:{read:!0,write:!0}})],Mt.prototype,"relationshipTableId",void 0),Object(h.a)([Object(A.b)({json:{read:Lt.read,write:Lt.write}})],Mt.prototype,"role",void 0);var qt=Mt=Object(h.a)([Object(q.a)("esri.layers.support.Relationship")],Mt),Gt=r(698),Vt=r(673),Bt=r(744),Ut=r(747),Jt=r(670),Wt=r(729),Qt=r(720),zt=r(755),Ht=new x.a({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Kt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},Zt="FeatureLayer",$t=F.a.getLogger("esri.layers.FeatureLayer");function Yt(e){return e&&e instanceof _.a}function Xt(e,t,r){return!!(e&&e.hasOwnProperty(t)?e[t]:r)}function er(e,t,r){return e&&e.hasOwnProperty(t)?e[t]:r}var tr=Object(It.a)();function rr(e,t,r){var n=!(null==r||!r.writeLayerSchema);return{enabled:n,ignoreOrigin:n}}var nr=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(u.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n)))._handles=new S.a,e.capabilities=null,e.charts=null,e.copyright=null,e.datesInUnknownTimezone=!1,e.displayField=null,e.definitionExpression=null,e.dynamicDataSource=null,e.editFieldsInfo=null,e.editingInfo=null,e.elevationInfo=null,e.featureReduction=null,e.fields=null,e.fieldsIndex=null,e.floorInfo=null,e.formTemplate=null,e.fullExtent=null,e.gdbVersion=null,e.geometryFieldsInfo=null,e.geometryType=null,e.hasM=void 0,e.hasZ=void 0,e.heightModelInfo=null,e.historicMoment=null,e.infoFor3D=null,e.isTable=!1,e.labelsVisible=!0,e.labelingInfo=null,e.layerId=void 0,e.legendEnabled=!0,e.minScale=0,e.maxScale=0,e.globalIdField=null,e.objectIdField=null,e.outFields=null,e.path=null,e.popupEnabled=!0,e.popupTemplate=null,e.relationships=null,e.sourceJSON=null,e.returnM=void 0,e.returnZ=void 0,e.screenSizePerspectiveEnabled=!0,e.serviceDefinitionExpression=null,e.spatialReference=Ke.a.WGS84,e.subtypeCode=null,e.templates=null,e.timeInfo=null,e.title=null,e.sublayerTitleMode="item-title",e.trackIdField=null,e.type="feature",e.typeIdField=null,e.types=null,e.indexes=new(_.a.ofType(St)),e.userIsAdmin=!1,e.version=void 0,e.visible=!0,e}return Object(l.a)(a,[{key:"destroy",value:function(){var e;null==(e=this.source)||e.destroy(),this._handles=Object(I.d)(this._handles)}},{key:"normalizeCtorArgs",value:function(e,t){return"string"==typeof e?Object(o.a)({url:e},t):e}},{key:"load",value:function(e){var t=this,r=Object(I.j)(e)?e.signal:null;if(!(this.portalItem&&this.portalItem.loaded&&this.source)){var n=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(C.u).then(Object(s.a)(i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.url||null!=t.layerId||!/FeatureServer|MapServer\/*$/i.test(t.url)){e.next=5;break}return e.next=3,t._fetchFirstLayerId(r);case 3:null!=(n=e.sent)&&(t.layerId=n);case 5:if(t.url||t._hasMemorySource()){e.next=7;break}throw new w.a("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");case 7:return e.t0=t,e.next=10,t.createGraphicsSource(r);case 10:return e.t1=e.sent,e.abrupt("return",e.t0._initLayerProperties.call(e.t0,e.t1));case 12:case"end":return e.stop()}}),e)})))).then((function(){return t.finishLoadEditablePortalLayer(e)}));return this.addResolvingPromise(n),Promise.resolve(this)}this.addResolvingPromise(this.createGraphicsSource(r).then((function(e){return t._initLayerProperties(e)})))}},{key:"readCapabilities",value:function(e,t){return t=t.layerDefinition||t,{attachment:this._readAttachmentCapabilities(t.attachmentProperties),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),editing:this._readEditingCapabilities(t)}}},{key:"createQueryVersion",get:function(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}},{key:"editingEnabled",get:function(){return!(this.loaded&&!this.capabilities.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)},set:function(e){null!=e?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}},{key:"readEditingEnabled",value:function(e,t){return this._readEditingEnabled(t,!1)}},{key:"readEditingEnabledFromWebMap",value:function(e,t,r){return this._readEditingEnabled(t,!0,r)}},{key:"writeEditingEnabled",value:function(e,t){this._writeEditingEnabled(e,t,!1)}},{key:"writeEditingEnabledToWebMap",value:function(e,t,r,n){this._writeEditingEnabled(e,t,!0,n)}},{key:"readEditingInfo",value:function(e,t){var r=t.editingInfo;return r?{lastEditDate:null!=r.lastEditDate?new Date(r.lastEditDate):null}:null}},{key:"readFeatureReduction",value:function(e,t){return Object(kt.b)(e,t)}},{key:"writeWebSceneFeatureReduction",value:function(e,t,r,n){Object(kt.d)(e,t,"layerDefinition.featureReduction",n)}},{key:"readIsTable",value:function(e,t){return"Table"===(t=t&&t.layerDefinition||t).type||!t.geometryType}},{key:"writeIsTable",value:function(e,t,r,n){null!=n&&n.writeLayerSchema&&Object(E.c)(r,e?"Table":"Feature Layer",t)}},{key:"readMinScale",value:function(e,t){return t.effectiveMinScale||e||0}},{key:"readMaxScale",value:function(e,t){return t.effectiveMaxScale||e||0}},{key:"readGlobalIdFieldFromService",value:function(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){var r,a=Object(n.a)(t.fields);try{for(a.s();!(r=a.n()).done;){var i=r.value;if("esriFieldTypeGlobalID"===i.type)return i.name}}catch(s){a.e(s)}finally{a.f()}}}},{key:"readObjectIdFieldFromService",value:function(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){var r,a=Object(n.a)(t.fields);try{for(a.s();!(r=a.n()).done;){var i=r.value;if("esriFieldTypeOID"===i.type)return i.name}}catch(s){a.e(s)}finally{a.f()}}}},{key:"parsedUrl",get:function(){var e=this.url?Object(D.J)(this.url):null;return null!=e&&(null!=this.dynamicDataSource?e.path=Object(D.y)(e.path,"dynamicLayer"):null!=this.layerId&&(e.path=Object(D.y)(e.path,this.layerId.toString()))),e}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(e){Object(Tt.e)(e,this.fieldsIndex),this._set("renderer",e)}},{key:"readRenderer",value:function(e,t,r){var n=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(n){var a=Object(m.b)(n,t,r)||void 0;return a||$t.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r}),a}if(t.defaultSymbol)return t.types&&t.types.length?new v.a({defaultSymbol:ar(t.defaultSymbol,t,r),field:t.typeIdField,uniqueValueInfos:t.types.map((function(e){return{id:e.id,symbol:ar(e.symbol,e,r)}}))}):new b.a({symbol:ar(t.defaultSymbol,t,r)})}},{key:"source",set:function(e){var t=this._get("source");t!==e&&(Yt(t)&&this._resetMemorySource(t),Yt(e)&&this._initMemorySource(e),this._set("source",e))}},{key:"castSource",value:function(e){return e?Array.isArray(e)||e instanceof _.a?new dt({layer:this,items:e}):e:null}},{key:"readSource",value:function(e,t){var r=at.default.fromJSON(t.featureSet);return new dt({layer:this,items:r&&r.features||[]})}},{key:"readServiceDefinitionExpression",value:function(e,t){return t.definitionQuery||t.definitionExpression}},{key:"readTemplates",value:function(e,t){var r=t.editFieldsInfo,n=r&&r.creatorField,a=r&&r.editorField;return e=e&&e.map((function(e){return xt.a.fromJSON(e)})),this._fixTemplates(e,n),this._fixTemplates(e,a),e}},{key:"readTitle",value:function(e,t){var r=t.layerDefinition&&t.layerDefinition.name||t.name,n=t.title||t.layerDefinition&&t.layerDefinition.title;if(r){var a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?Object(_t.i)(this.url,r):r;var i=r;if(!i&&this.url){var s=Object(_t.e)(this.url);Object(I.j)(s)&&(i=s.title)}if(!i)return;return"item-title-and-service-name"===this.sublayerTitleMode&&a&&a!==i&&(i=a+" - "+i),Object(_t.a)(i)}if("item-title"===this.sublayerTitleMode&&n)return n}},{key:"readTitleFromWebMap",value:function(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}},{key:"readTypeIdField",value:function(e,t){var r=(t=t.layerDefinition||t).typeIdField;if(r&&t.fields){r=r.toLowerCase();var n=t.fields.find((function(e){return e.name.toLowerCase()===r}));n&&(r=n.name)}return r}},{key:"readTypes",value:function(e,t){var r=this;e=(t=t.layerDefinition||t).types;var n=t.editFieldsInfo,a=n&&n.creatorField,i=n&&n.editorField;return e&&e.map((function(e){return e=Ft.a.fromJSON(e),r._fixTemplates(e.templates,a),r._fixTemplates(e.templates,i),e}))}},{key:"url",set:function(e){var t=Object(_t.h)({layer:this,url:e,nonStandardUrlAllowed:!0,logger:$t});this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}},{key:"writeUrl",value:function(e,t,r,n){Object(_t.j)(this,e,null,t,n)}},{key:"readVersion",value:function(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}},{key:"readVisible",value:function(e,t){return t.layerDefinition&&null!=t.layerDefinition.defaultVisibility?!!t.layerDefinition.defaultVisibility:null!=t.visibility?!!t.visibility:void 0}},{key:"addAttachment",value:function(e,t){var r=this;return this.load().then((function(){return r._checkAttachmentSupport(e)})).then((function(){if(!("addAttachment"in r.source))throw new w.a(Zt,"Layer source does not support addAttachment capability");return r.source.addAttachment(e,t)}))}},{key:"updateAttachment",value:function(e,t,r){var n=this;return this.load().then((function(){return n._checkAttachmentSupport(e)})).then((function(){if(!("updateAttachment"in n.source))throw new w.a(Zt,"Layer source does not support updateAttachment capability");return n.source.updateAttachment(e,t,r)}))}},{key:"applyEdits",value:function(){var e=Object(s.a)(i.a.mark((function e(t,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(28).then(r.bind(null,1091));case 2:return a=e.sent,e.next=5,this.load();case 5:return e.abrupt("return",a.applyEdits(this,this.source,t,n));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"on",value:function(e,t){return Object(c.a)(Object(d.a)(a.prototype),"on",this).call(this,e,t)}},{key:"createPopupTemplate",value:function(e){return Object(zt.a)(this,e)}},{key:"createGraphicsSource",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._hasMemorySource()){e.next=2;break}return e.abrupt("return",this.source.load({signal:t}));case 2:return e.next=4,Object(C.y)(Promise.all([r.e(6),r.e(24),r.e(73)]).then(r.bind(null,1092)),t);case 4:return n=e.sent,a=n.default,e.abrupt("return",new a({layer:this}).load({signal:t}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createQuery",value:function(){var e=new Jt.a,t=this.get("capabilities.data");e.dynamicDataSource=this.dynamicDataSource,e.gdbVersion=this.gdbVersion,e.historicMoment=this.historicMoment,e.returnGeometry=!0,t&&(t.supportsZ&&null!=this.returnZ&&(e.returnZ=this.returnZ),t.supportsM&&null!=this.returnM&&(e.returnM=this.returnM)),e.outFields=["*"],e.where=this.definitionExpression||"1=1";var r=this.timeOffset,n=this.timeExtent;return e.timeExtent=null!=r&&null!=n?n.offset(-r.value,r.unit):n||null,e.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null,e}},{key:"deleteAttachments",value:function(e,t){var r=this;return this.load().then((function(){return r._checkAttachmentSupport(e)})).then((function(){if(!("deleteAttachments"in r.source))throw new w.a(Zt,"Layer source does not support deleteAttachments capability");return r.source.deleteAttachments(e,t)}))}},{key:"fetchRecomputedExtents",value:function(e){var t=this;return this.load({signal:null==e?void 0:e.signal}).then((function(){if(t.source.fetchRecomputedExtents)return t.source.fetchRecomputedExtents(e);throw new w.a(Zt,"Layer source does not support fetchUpdates capability")}))}},{key:"getFeatureType",value:function(e){var t=this.typeIdField,r=this.types;if(!t||!e)return null;var n=e.attributes?e.attributes[t]:void 0;if(null==n)return null;var a=null;return r.some((function(e){var t=e.id;return null!=t&&(t.toString()===n.toString()&&(a=e),!!a)})),a}},{key:"getFieldDomain",value:function(e,t){var r=t&&t.feature,n=this.getFeatureType(r);if(n){var a=n.domains&&n.domains[e];if(a&&"inherited"!==a.type)return a}return this._getLayerDomain(e)}},{key:"getField",value:function(e){return this.fieldsIndex.get(e)}},{key:"queryAttachments",value:function(e,t){var r=this;return e=Ut.a.from(e),this.load().then((function(){if(!r.get("capabilities.data.supportsAttachment"))throw new w.a(Zt,"this layer doesn't support attachments");var t=e,n=t.attachmentTypes,a=t.objectIds,i=t.globalIds,s=t.num,o=t.size,u=t.start,l=t.where;if(!r.get("capabilities.operations.supportsQueryAttachments")){var c=a&&a.length>1,d=n&&n.length,p=i&&i.length,f=o&&o.length;if(c||d||p||f||s||u||l)throw new w.a(Zt,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(a&&a.length||l))throw new w.a(Zt,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in r.source))throw new w.a(Zt,"Layer source does not support queryAttachments capability",e);return r.source.queryAttachments(e)}))}},{key:"queryFeatures",value:function(e,t){var r=this;return this.load().then((function(){return r.source.queryFeatures(Jt.a.from(e)||r.createQuery(),t)})).then((function(e){if(null!=e&&e.features){var t,a=Object(n.a)(e.features);try{for(a.s();!(t=a.n()).done;){var i=t.value;i.layer=i.sourceLayer=r}}catch(s){a.e(s)}finally{a.f()}}return e}))}},{key:"queryObjectIds",value:function(e,t){var r=this;return this.load().then((function(){if(r.source.queryObjectIds)return r.source.queryObjectIds(Jt.a.from(e)||r.createQuery(),t);throw new w.a(Zt,"Layer source does not support queryObjectIds capability")}))}},{key:"queryFeatureCount",value:function(e,t){var r=this;return this.load().then((function(){if(r.source.queryFeatureCount)return r.source.queryFeatureCount(Jt.a.from(e)||r.createQuery(),t);throw new w.a(Zt,"Layer source does not support queryFeatureCount capability")}))}},{key:"queryExtent",value:function(e,t){var r=this;return this.load().then((function(){if(r.source.queryExtent)return r.source.queryExtent(Jt.a.from(e)||r.createQuery(),t);throw new w.a(Zt,"Layer source does not support queryExtent capability")}))}},{key:"queryRelatedFeatures",value:function(e,t){var r=this;return this.load().then((function(){if("queryRelatedFeatures"in r.source)return r.source.queryRelatedFeatures(Wt.a.from(e),t);throw new w.a(Zt,"Layer source does not support queryRelatedFeatures capability")}))}},{key:"queryRelatedFeaturesCount",value:function(e,t){var r=this;return this.load().then((function(){if("queryRelatedFeaturesCount"in r.source)return r.source.queryRelatedFeaturesCount(Wt.a.from(e),t);throw new w.a(Zt,"Layer source does not support queryRelatedFeaturesCount capability")}))}},{key:"queryTopFeatures",value:function(e,t){var r=this;return this.load().then((function(){if("queryTopFeatures"in r.source&&r.get("capabilities.query.supportsTopFeaturesQuery"))return r.source.queryTopFeatures(Qt.a.from(e),t).then((function(e){if(null!=e&&e.features){var t,a=Object(n.a)(e.features);try{for(a.s();!(t=a.n()).done;){var i=t.value;i.layer=i.sourceLayer=r}}catch(s){a.e(s)}finally{a.f()}}return e}));throw new w.a(Zt,"Layer source does not support queryTopFeatures capability")}))}},{key:"queryTopObjectIds",value:function(e,t){var r=this;return this.load().then((function(){if("queryTopObjectIds"in r.source&&r.get("capabilities.query.supportsTopFeaturesQuery"))return r.source.queryTopObjectIds(Qt.a.from(e),t);throw new w.a(Zt,"Layer source does not support queryTopObjectIds capability")}))}},{key:"queryTopFeaturesExtent",value:function(e,t){var r=this;return this.load().then((function(){if("queryTopExtents"in r.source&&r.get("capabilities.query.supportsTopFeaturesQuery"))return r.source.queryTopExtents(Qt.a.from(e),t);throw new w.a(Zt,"Layer source does not support queryTopExtents capability")}))}},{key:"queryTopFeatureCount",value:function(e,t){var r=this;return this.load().then((function(){if("queryTopCount"in r.source&&r.get("capabilities.query.supportsTopFeaturesQuery"))return r.source.queryTopCount(Qt.a.from(e),t);throw new w.a(Zt,"Layer source does not support queryFeatureCount capability")}))}},{key:"read",value:function(e,t){var r=e.featureCollection;if(r){var n=r.layers;n&&1===n.length&&(Object(c.a)(Object(d.a)(a.prototype),"read",this).call(this,n[0],t),null!=r.showLegend&&Object(c.a)(Object(d.a)(a.prototype),"read",this).call(this,{showLegend:r.showLegend},t))}Object(c.a)(Object(d.a)(a.prototype),"read",this).call(this,e,t),t&&"service"===t.origin&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}},{key:"write",value:function(e,t){var r,n,i=(t=Object(o.a)(Object(o.a)({},t),{},{writeLayerSchema:null!=(r=null==(n=t)?void 0:n.writeLayerSchema)?r:this._hasMemorySource()})).origin,s=t.layerContainerType,u=t.messages;if(this.isTable){if("web-scene"===i||"web-map"===i&&"tables"!==s)return u&&u.push(new w.a("layer:unsupported","Layer (".concat(this.title,", ").concat(this.id,") of type '").concat(this.declaredClass,"' using a Table source cannot be written to web scenes and web maps"),{layer:this})),null;if(this._hasMemorySource())return u&&u.push(new w.a("layer:unsupported","Layer (".concat(this.title,", ").concat(this.id,") of type '").concat(this.declaredClass,"' using an in-memory Table source cannot be written to web scenes and web maps"),{layer:this})),null}else if(this.loaded&&"web-map"===i&&"tables"===s)return u&&u.push(new w.a("layer:unsupported","Layer (".concat(this.title,", ").concat(this.id,") of type '").concat(this.declaredClass,"' using a non-table source cannot be written to tables in web maps"),{layer:this})),null;return Object(c.a)(Object(d.a)(a.prototype),"write",this).call(this,e,t)}},{key:"_readEditingEnabled",value:function(e,t,r){var n,a=null==(n=e.layerDefinition)?void 0:n.capabilities;return a?this._hasEditingCapability(a):(a=e.capabilities,t&&"web-map"===(null==r?void 0:r.origin)&&!this._hasMemorySource()&&a?this._hasEditingCapability(a):void 0)}},{key:"_hasEditingCapability",value:function(e){return e.toLowerCase().split(",").map((function(e){return e.trim()})).includes("editing")}},{key:"_writeEditingEnabled",value:function(e,t,r,n){if(!e){var a,i,s=null!=(a=this.capabilities)&&null!=(i=a.operations)&&i.supportsSync?"Query,Sync":"Query";Object(E.c)("layerDefinition.capabilities",s,t),!r||null!=n&&n.writeLayerSchema||(t.capabilities=s)}}},{key:"_checkAttachmentSupport",value:function(e){var t=e.attributes,r=this.objectIdField;return this.get("capabilities.data.supportsAttachment")?e?t?t[r]?void 0:Promise.reject(new w.a(Zt,"feature is missing the identifying attribute ".concat(r))):Promise.reject(new w.a(Zt,"'attributes' are required on a feature to query attachments")):Promise.reject(new w.a(Zt,"A feature is required to add/delete/update attachments")):Promise.reject(new w.a(Zt,"this layer doesn't support attachments"))}},{key:"_getLayerDomain",value:function(e){var t=this.fieldsIndex.get(e);return t?t.domain:null}},{key:"_fetchFirstLayerId",value:function(e){return Object(O.default)(this.url,{query:Object(o.a)(Object(o.a)({f:"json"},this.customParameters),{},{token:this.apiKey}),responseType:"json",signal:e}).then((function(e){var t=e.data;if(t)return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}))}},{key:"_initLayerProperties",value:function(){var e=Object(s.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this._set("source",t),t.sourceJSON&&(this.sourceJSON=t.sourceJSON,this.read(t.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Object(Tt.e)(this.renderer,this.fieldsIndex),Object(Tt.f)(this.timeInfo,this.fieldsIndex),Object(Bt.a)(this,{origin:"service"})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasDataChanged",value:function(){var e=Object(s.a)(i.a.mark((function e(){var t,r,n,a,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(t=this.source)||!t.refresh){e.next=13;break}return e.prev=1,e.next=4,null==(r=this.source)?void 0:r.refresh();case 4:if(n=e.sent,a=n.hasUpdates,s=n.updates,Object(I.j)(s)&&(this.sourceJSON=Object(o.a)(Object(o.a)({},this.sourceJSON),s),this.read(s,{origin:"service",url:this.parsedUrl})),!a){e.next=9;break}return e.abrupt("return",!0);case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(1);case 13:if(!this.definitionExpression){e.next=22;break}return e.prev=14,e.next=17,R(this.definitionExpression,this.fieldsIndex);case 17:return e.abrupt("return",e.sent.hasDateFunctions);case 20:e.prev=20,e.t1=e.catch(14);case 22:return e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e,this,[[1,11],[14,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"_verifyFields",value:function(){var e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||-1!==e.search(/\/FeatureServer\//i)||this.fields&&this.fields.some((function(e){return"geometry"===e.type}))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}},{key:"_fixTemplates",value:function(e,t){e&&e.forEach((function(e){var r=e.prototype&&e.prototype.attributes;r&&t&&delete r[t]}))}},{key:"_verifySource",value:function(){if(this._hasMemorySource()){if(this.url)throw new w.a("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new w.a("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}},{key:"_initMemorySource",value:function(e){var t=this;e.forEach((function(e){e.layer=t,e.sourceLayer=t})),this._handles.add([e.on("after-add",(function(e){e.item.layer=t,e.item.sourceLayer=t})),e.on("after-remove",(function(e){e.item.layer=null,e.item.sourceLayer=null}))],"fl-source")}},{key:"_resetMemorySource",value:function(e){e.forEach((function(e){e.layer=null,e.sourceLayer=null})),this._handles.remove("fl-source")}},{key:"_hasMemorySource",value:function(){return!(this.url||!this.source)}},{key:"_readAttachmentCapabilities",value:function(e){var t={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1};return e&&Array.isArray(e)&&e.forEach((function(e){var r=Kt[e.name];r&&(t[r]=!!e.isEnabled)})),t}},{key:"_readDataCapabilities",value:function(e){return{isVersioned:Xt(e,"isDataVersioned",!1),supportsAttachment:Xt(e,"hasAttachments",!1),supportsM:Xt(e,"hasM",!1),supportsZ:Xt(e,"hasZ",!1)}}},{key:"_readMetadataCapabilities",value:function(e){return{supportsAdvancedFieldProperties:Xt(e,"supportsFieldDescriptionProperty",!1)}}},{key:"_readOperationsCapabilities",value:function(e,t){var r=e?e.toLowerCase().split(",").map((function(e){return e.trim()})):[],n=r.includes("editing")&&!t.datesInUnknownTimezone,a=n&&r.includes("create"),i=n&&r.includes("delete"),s=n&&r.includes("update"),o=r.includes("changetracking");return n&&!(a||i||s)&&(a=i=s=!0),{supportsCalculate:Xt(t,"supportsCalculate",!1),supportsTruncate:Xt(t,"supportsTruncate",!1),supportsValidateSql:Xt(t,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:i,supportsEditing:n,supportsChangeTracking:o,supportsQuery:r.includes("query"),supportsQueryAttachments:Xt(t.advancedQueryCapabilities,"supportsQueryAttachments",!1),supportsResizeAttachments:Xt(t,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:s,supportsExceedsLimitStatistics:Xt(t,"supportsExceedsLimitStatistics",!1)}}},{key:"_readQueryCapabilities",value:function(e){var t,r=e.advancedQueryCapabilities,n=e.ownershipBasedAccessControlForFeatures,a=e.archivingInfo,i=null==(t=this.url)?void 0:t.includes("MapServer"),s=!Object(k.a)("mapserver-pbf-enabled")&&i&&this.version<10.81,o=(e.supportedQueryFormats||"").split(",").reduce((function(e,t){var r=t.toLowerCase().trim();return r&&e.add(r),e}),new Set);return{supportsStatistics:Xt(r,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Xt(r,"supportsPercentileStatistics",!1),supportsCentroid:Xt(r,"supportsReturningGeometryCentroid",!1),supportsDistance:Xt(r,"supportsQueryWithDistance",!1),supportsDistinct:Xt(r,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Xt(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Xt(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:Xt(r,"supportsHavingClause",!1),supportsOrderBy:Xt(r,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Xt(r,"supportsPagination",!1),supportsQuantization:Xt(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Xt(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Xt(e,"supportsReturningQueryGeometry",!1),supportsResultType:Xt(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Xt(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Xt(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Xt(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Xt(r,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Xt(n,"allowOthersToQuery",!0),supportsHistoricMoment:Xt(a,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!s&&o.has("pbf"),supportsDisjointSpatialRelationship:Xt(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:Xt(r,"supportsQueryWithCacheHint",!1),maxRecordCountFactor:er(e,"maxRecordCountFactor",void 0),maxRecordCount:er(e,"maxRecordCount",void 0),standardMaxRecordCount:er(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:er(e,"tileMaxRecordCount",void 0)}}},{key:"_readQueryRelatedCapabilities",value:function(e){var t=e.advancedQueryCapabilities,r=Xt(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Xt(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r}}},{key:"_readEditingCapabilities",value:function(e){var t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Xt(e,"allowGeometryUpdates",!0),supportsGlobalId:Xt(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Xt(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Xt(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Xt(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Xt(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Xt(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Xt(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Xt(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Xt(t,"allowOthersToUpdate",!0)}}}]),a}(Object(ht.a)(Object(vt.a)(Object(jt.a)(Object(Ot.a)(Object(gt.a)(Object(ft.a)(Object(bt.a)(Object(mt.a)(Object(T.a)(Object(yt.a)(Object(pt.a)(Ze.a))))))))))));Object(h.a)([Object(A.b)({readOnly:!0,json:{read:!1}})],nr.prototype,"capabilities",void 0),Object(h.a)([Object(M.a)("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],nr.prototype,"readCapabilities",null),Object(h.a)([Object(A.b)({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],nr.prototype,"charts",void 0),Object(h.a)([Object(A.b)({readOnly:!0})],nr.prototype,"createQueryVersion",null),Object(h.a)([Object(A.b)({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],nr.prototype,"copyright",void 0),Object(h.a)([Object(A.b)({type:Boolean})],nr.prototype,"datesInUnknownTimezone",void 0),Object(h.a)([Object(A.b)({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],nr.prototype,"displayField",void 0),Object(h.a)([Object(A.b)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],nr.prototype,"definitionExpression",void 0),Object(h.a)([Object(A.b)({types:j.e,readOnly:!0})],nr.prototype,"defaultSymbol",void 0),Object(h.a)([Object(A.b)({type:Vt.a})],nr.prototype,"dynamicDataSource",void 0),Object(h.a)([Object(A.b)({readOnly:!0})],nr.prototype,"editFieldsInfo",void 0),Object(h.a)([Object(A.b)({type:Boolean})],nr.prototype,"editingEnabled",null),Object(h.a)([Object(M.a)(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],nr.prototype,"readEditingEnabled",null),Object(h.a)([Object(M.a)("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],nr.prototype,"readEditingEnabledFromWebMap",null),Object(h.a)([Object(G.a)(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],nr.prototype,"writeEditingEnabled",null),Object(h.a)([Object(G.a)("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],nr.prototype,"writeEditingEnabledToWebMap",null),Object(h.a)([Object(A.b)({readOnly:!0})],nr.prototype,"editingInfo",void 0),Object(h.a)([Object(M.a)("editingInfo")],nr.prototype,"readEditingInfo",null),Object(h.a)([Object(A.b)(wt.b)],nr.prototype,"elevationInfo",void 0),Object(h.a)([Object(A.b)(kt.a)],nr.prototype,"featureReduction",void 0),Object(h.a)([Object(M.a)("featureReduction",["layerDefinition.featureReduction"])],nr.prototype,"readFeatureReduction",null),Object(h.a)([Object(G.a)("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:kt.c}})],nr.prototype,"writeWebSceneFeatureReduction",null),Object(h.a)([Object(A.b)(Object(o.a)(Object(o.a)({},tr.fields),{},{json:{read:{source:"layerDefinition.fields"},origins:{service:{read:!0},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:rr}}}}}))],nr.prototype,"fields",void 0),Object(h.a)([Object(A.b)(tr.fieldsIndex)],nr.prototype,"fieldsIndex",void 0),Object(h.a)([Object(A.b)({type:Dt.a,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],nr.prototype,"floorInfo",void 0),Object(h.a)([Object(A.b)({type:Qe,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],nr.prototype,"formTemplate",void 0),Object(h.a)([Object(A.b)({type:ze.a,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],nr.prototype,"fullExtent",void 0),Object(h.a)([Object(A.b)()],nr.prototype,"gdbVersion",void 0),Object(h.a)([Object(A.b)({readOnly:!0,type:Rt,json:{read:{source:"geometryProperties"}}})],nr.prototype,"geometryFieldsInfo",void 0),Object(h.a)([Object(A.b)({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Ht.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:rr,writer:function(e,t,r){var n=e?Ht.toJSON(e):null;n&&Object(E.c)(r,n,t)}}}},read:{source:"layerDefinition.geometryType",reader:Ht.read}}})],nr.prototype,"geometryType",void 0),Object(h.a)([Object(A.b)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],nr.prototype,"hasM",void 0),Object(h.a)([Object(A.b)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],nr.prototype,"hasZ",void 0),Object(h.a)([Object(A.b)({readOnly:!0,type:He.a})],nr.prototype,"heightModelInfo",void 0),Object(h.a)([Object(A.b)({type:Date})],nr.prototype,"historicMoment",void 0),Object(h.a)([Object(A.b)(wt.c)],nr.prototype,"id",void 0),Object(h.a)([Object(A.b)({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],nr.prototype,"infoFor3D",void 0),Object(h.a)([Object(A.b)({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],nr.prototype,"isTable",void 0),Object(h.a)([Object(M.a)("service","isTable",["type","geometryType"]),Object(M.a)("isTable",["layerDefinition.type","layerDefinition.geometryType"])],nr.prototype,"readIsTable",null),Object(h.a)([Object(G.a)("web-map","isTable")],nr.prototype,"writeIsTable",null),Object(h.a)([Object(A.b)(wt.d)],nr.prototype,"labelsVisible",void 0),Object(h.a)([Object(A.b)({type:[Nt.a],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:Pt.a},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:Pt.a},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],nr.prototype,"labelingInfo",void 0),Object(h.a)([Object(A.b)(wt.i)],nr.prototype,"opacity",void 0),Object(h.a)([Object(A.b)({type:Number,json:{origins:{service:{read:{source:"id"}}},read:!1}})],nr.prototype,"layerId",void 0),Object(h.a)([Object(A.b)(wt.e)],nr.prototype,"legendEnabled",void 0),Object(h.a)([Object(A.b)({type:["show","hide"]})],nr.prototype,"listMode",void 0),Object(h.a)([Object(A.b)(wt.g)],nr.prototype,"minScale",void 0),Object(h.a)([Object(M.a)("service","minScale",["minScale","effectiveMinScale"])],nr.prototype,"readMinScale",null),Object(h.a)([Object(A.b)(wt.f)],nr.prototype,"maxScale",void 0),Object(h.a)([Object(M.a)("service","maxScale",["maxScale","effectiveMaxScale"])],nr.prototype,"readMaxScale",null),Object(h.a)([Object(A.b)({type:String})],nr.prototype,"globalIdField",void 0),Object(h.a)([Object(M.a)("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),Object(M.a)("service","globalIdField",["globalIdField","fields"])],nr.prototype,"readGlobalIdFieldFromService",null),Object(h.a)([Object(A.b)({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:rr}}}}})],nr.prototype,"objectIdField",void 0),Object(h.a)([Object(M.a)("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),Object(M.a)("service","objectIdField",["objectIdField","fields"])],nr.prototype,"readObjectIdFieldFromService",null),Object(h.a)([Object(A.b)({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],nr.prototype,"operationalLayerType",void 0),Object(h.a)([Object(A.b)(tr.outFields)],nr.prototype,"outFields",void 0),Object(h.a)([Object(A.b)({readOnly:!0})],nr.prototype,"parsedUrl",null),Object(h.a)([Object(A.b)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],nr.prototype,"path",void 0),Object(h.a)([Object(A.b)(wt.j)],nr.prototype,"popupEnabled",void 0),Object(h.a)([Object(A.b)({type:y.a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],nr.prototype,"popupTemplate",void 0),Object(h.a)([Object(A.b)({readOnly:!0})],nr.prototype,"defaultPopupTemplate",null),Object(h.a)([Object(A.b)({type:[qt],readOnly:!0})],nr.prototype,"relationships",void 0),Object(h.a)([Object(A.b)({types:g.a,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:g.b,write:{target:"layerDefinition.drawingInfo.renderer",writer:m.c}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:function(e,t,r){return{ignoreOrigin:null==r?void 0:r.writeLayerSchema}},writer:m.c}}})],nr.prototype,"renderer",null),Object(h.a)([Object(M.a)("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Object(M.a)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],nr.prototype,"readRenderer",null),Object(h.a)([Object(A.b)()],nr.prototype,"sourceJSON",void 0),Object(h.a)([Object(A.b)({type:Boolean})],nr.prototype,"returnM",void 0),Object(h.a)([Object(A.b)({type:Boolean})],nr.prototype,"returnZ",void 0),Object(h.a)([Object(A.b)(wt.m)],nr.prototype,"screenSizePerspectiveEnabled",void 0),Object(h.a)([Object(A.b)()],nr.prototype,"source",null),Object(h.a)([Object(L.a)("source")],nr.prototype,"castSource",null),Object(h.a)([Object(M.a)("portal-item","source",["featureSet"]),Object(M.a)("web-map","source",["featureSet"])],nr.prototype,"readSource",null),Object(h.a)([Object(A.b)({readOnly:!0})],nr.prototype,"serviceDefinitionExpression",void 0),Object(h.a)([Object(M.a)("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],nr.prototype,"readServiceDefinitionExpression",null),Object(h.a)([Object(A.b)({type:Ke.a,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],nr.prototype,"spatialReference",void 0),Object(h.a)([Object(A.b)({type:Number})],nr.prototype,"subtypeCode",void 0),Object(h.a)([Object(A.b)({type:[xt.a]})],nr.prototype,"templates",void 0),Object(h.a)([Object(M.a)("templates",["editFieldsInfo","creatorField","editorField","templates"])],nr.prototype,"readTemplates",null),Object(h.a)([Object(A.b)({type:Gt.a})],nr.prototype,"timeInfo",void 0),Object(h.a)([Object(A.b)()],nr.prototype,"title",void 0),Object(h.a)([Object(M.a)("service","title",["name"]),Object(M.a)("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],nr.prototype,"readTitle",null),Object(h.a)([Object(M.a)("web-map","title",["layerDefinition.name","title"])],nr.prototype,"readTitleFromWebMap",null),Object(h.a)([Object(A.b)({type:String})],nr.prototype,"sublayerTitleMode",void 0),Object(h.a)([Object(A.b)({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],nr.prototype,"trackIdField",void 0),Object(h.a)([Object(A.b)({json:{read:!1}})],nr.prototype,"type",void 0),Object(h.a)([Object(A.b)({type:String})],nr.prototype,"typeIdField",void 0),Object(h.a)([Object(M.a)("service","typeIdField"),Object(M.a)("typeIdField",["layerDefinition.typeIdField"])],nr.prototype,"readTypeIdField",null),Object(h.a)([Object(A.b)({type:[Ft.a]})],nr.prototype,"types",void 0),Object(h.a)([Object(M.a)("service","types",["types"]),Object(M.a)("types",["layerDefinition.types"])],nr.prototype,"readTypes",null),Object(h.a)([Object(A.b)({readOnly:!0,json:{write:!1}})],nr.prototype,"serverGens",void 0),Object(h.a)([Object(A.b)({type:_.a.ofType(St),readOnly:!0})],nr.prototype,"indexes",void 0),Object(h.a)([Object(A.b)(wt.n)],nr.prototype,"url",null),Object(h.a)([Object(G.a)("url")],nr.prototype,"writeUrl",null),Object(h.a)([Object(A.b)({readOnly:!0})],nr.prototype,"userIsAdmin",void 0),Object(h.a)([Object(A.b)({json:{origins:{service:{read:!0}},read:!1}})],nr.prototype,"version",void 0),Object(h.a)([Object(M.a)("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],nr.prototype,"readVersion",null),Object(h.a)([Object(A.b)({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],nr.prototype,"visible",void 0),Object(h.a)([Object(M.a)("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],nr.prototype,"readVisible",null),nr=Object(h.a)([Object(q.a)("esri.layers.FeatureLayer")],nr);var ar=Object(V.b)({types:j.i}),ir=nr},736:function(e,t,r){"use strict";r.r(t),r.d(t,"WhereClause",(function(){return T})),r.d(t,"defaultAttributeAdapter",(function(){return U}));var n=r(22),a=r(23),i=r(21),s=r(2),o=r(4),u=r(19);var l={min:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.min.apply(Math,e[0])}},max:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.max.apply(Math,e[0])}},avg:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:c(e[0])}},sum:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}(e[0])}},stddev:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sqrt(d(e[0]))}},count:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].length}},var:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:d(e[0])}}};function c(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function d(e){var t,r=c(e),n=e.length,a=0,s=Object(i.a)(e);try{for(s.s();!(t=s.n()).done;){var o=t.value;a+=Math.pow(o-r,2)}}catch(u){s.e(u)}finally{s.f()}return n>1?a/(n-1):0}var p=r(109),f=function(){function e(){Object(s.a)(this,e),this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0}return Object(o.a)(e,[{key:"valueInMilliseconds",value:function(){return("-"===this.op?-1:1)*(1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}],[{key:"fixDefaults",value:function(e){if(null!==e.precision||null!==e.secondary)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}},{key:"createFromMilliseconds",value:function(t){var r=new e;return r.second=t/1e3,r}},{key:"createFromValueAndQualifer",value:function(t,r,n){var a=new e;if(a.op="-"===n?"-":"+","interval-period"===r.type){e.fixDefaults(r);var i=new RegExp("^[0-9]{1,}$");if("year"===r.period||"month"===r.period)throw new Error("Year-Month Intervals not supported");if(!i.test(t))throw new Error("Illegal Interval");a[r.period]=parseFloat(t)}else{if(e.fixDefaults(r.start),e.fixDefaults(r.end),"year"===r.start.period||"month"===r.start.period)throw new Error("Year-Month Intervals not supported");if("year"===r.end.period||"month"===r.end.period)throw new Error("Year-Month Intervals not supported");switch(r.start.period){case"day":switch(r.end.period){case"hour":if(!new RegExp("^[0-9]{1,} [0-9]{1,}$").test(t))throw new Error("Illegal Interval");a[r.start.period]=parseFloat(t.split(" ")[0]),a[r.end.period]=parseFloat(t.split(" ")[1]);break;case"minute":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$").test(t))throw new Error("Illegal Interval");a[r.start.period]=parseFloat(t.split(" ")[0]);var s=t.split(" ")[1].split(":");a.hour=parseFloat(s[0]),a.minute=parseFloat(s[1]);break;case"second":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");a[r.start.period]=parseFloat(t.split(" ")[0]);var o=t.split(" ")[1].split(":");a.hour=parseFloat(o[0]),a.minute=parseFloat(o[1]),a.second=parseFloat(o[2]);break;default:throw"Invalid Interval."}break;case"hour":switch(r.end.period){case"minute":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}$").test(t))throw new Error("Illegal Interval");a.hour=parseFloat(t.split(":")[0]),a.minute=parseFloat(t.split(":")[1]);break;case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");var u=t.split(":");a.hour=parseFloat(u[0]),a.minute=parseFloat(u[1]),a.second=parseFloat(u[2]);break;default:throw"Invalid Interval."}break;case"minute":if("second"!==r.end.period)throw"Invalid Interval.";if(!new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(t))throw new Error("Illegal Interval");var l=t.split(":");a.minute=parseFloat(l[0]),a.second=parseFloat(l[1]);break;default:throw"Invalid Interval."}}return a}}]),e}();function h(e,t){var r=v[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to ".concat(e.toUpperCase()));return r.evaluate(t)}var y,b,v={extract:{minParams:2,maxParams:2,evaluate:function(e){var t=Object(n.a)(e,2),r=t[0],a=t[1];if(null==a)return null;if(a instanceof Date)switch(r.toUpperCase()){case"SECOND":return a.getSeconds();case"MINUTE":return a.getMinutes();case"HOUR":return a.getHours();case"DAY":return a.getDate();case"MONTH":return a.getMonth()+1;case"YEAR":return a.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(e){if(2===e.length){var t=Object(n.a)(e,2),r=t[0],a=t[1];return null==r||null==a?null:r.toString().substring(a-1)}if(3===e.length){var i=Object(n.a)(e,3),s=i[0],o=i[1],u=i[2];return null==s||null==o||null==u?null:u<=0?"":s.toString().substring(o-1,o+u-1)}}},position:{minParams:2,maxParams:2,evaluate:function(e){var t=Object(n.a)(e,2),r=t[0],a=t[1];return null==r||null==a?null:a.indexOf(r)+1}},trim:{minParams:2,maxParams:3,evaluate:function(e){var t=3===e.length,r=t?e[1]:" ",n=t?e[2]:e[1];if(null==r||null==n)return null;var a="(".concat(Object(p.a)(r),")");switch(e[0]){case"BOTH":return n.replace(new RegExp("^".concat(a,"*|").concat(a,"*$"),"g"),"");case"LEADING":return n.replace(new RegExp("^".concat(a,"*"),"g"),"");case"TRAILING":return n.replace(new RegExp("".concat(a,"*$"),"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.abs(e[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.ceil(e[0])}},floor:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.floor(e[0])}},log:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])}},log10:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sin(e[0])}},cos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.cos(e[0])}},tan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.tan(e[0])}},asin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.asin(e[0])}},acos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.acos(e[0])}},atan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.atan(e[0])}},sign:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0]>0?1:e[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])}},mod:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:e[0]%e[1]}},round:{minParams:1,maxParams:2,evaluate:function(e){var t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:function(e){return null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(e){return"string"==typeof e[0]||e[0]instanceof String?e[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(e){for(var t="",r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toUpperCase()}}},m=(r(754),{exports:{}});b=function(){function e(t,r,n,a){this.message=t,this.expected=r,this.found=n,this.location=a,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}function t(t,r){r=void 0!==r?r:{};var n,a={},i={start:Qe},s=Qe,o=function(e,t){var r={type:"expr_list"},n=function(e,t,r){return function(e,t){for(var r=[e],n=0;n<t.length;n++)r.push(t[n][3]);return r}(e,t)}(e,t);return r.value=n,r},u=function(e,t){return yr(e,t)},l=Ve("!",!1),c=Ve("=",!1),d=Ve(">=",!1),p=Ve(">",!1),f=Ve("<=",!1),h=Ve("<>",!1),y=Ve("<",!1),b=Ve("!=",!1),v=function(e){return e[0]+" "+e[2]},m=Ve("+",!1),g=Ve("-",!1),O=Ve("*",!1),j=Ve("/",!1),_=function(e,t){return e+t.join("")},w=/^[A-Za-z_\x80-\uFFFF]/,S=Be([["A","Z"],["a","z"],"_",["\x80","\uffff"]],!1,!1),k=/^[A-Za-z0-9_]/,x=Be([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),F=/^[A-Za-z0-9_.\x80-\uFFFF]/,I=Be([["A","Z"],["a","z"],["0","9"],"_",".",["\x80","\uffff"]],!1,!1),T=Ve("@",!1),E=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},C=function(e,t){return{type:"interval-period",period:"second",precision:e,secondary:t}},R=function(e){return parseFloat(e)},N=Ve("'",!1),P=Ve("N'",!1),D="''",A=Ve("''",!1),L=/^[^']/,M=Be(["'"],!0,!1),q=function(e,t){return{type:"when_clause",operand:e,value:t}},G=Ve(".",!1),V=/^[0-9]/,B=Be([["0","9"]],!1,!1),U=/^[eE]/,J=Be(["e","E"],!1,!1),W=/^[+\-]/,Q=Be(["+","-"],!1,!1),z=Ve("NULL",!0),H=Ve("TRUE",!0),K=Ve("FALSE",!0),Z=Ve("IN",!0),$=Ve("IS",!0),Y=Ve("LIKE",!0),X=Ve("ESCAPE",!0),ee=Ve("NOT",!0),te=Ve("AND",!0),re=Ve("OR",!0),ne=Ve("BETWEEN",!0),ae=Ve("FROM",!0),ie=Ve("FOR",!0),se=Ve("SUBSTRING",!0),oe=Ve("EXTRACT",!0),ue=Ve("TRIM",!0),le=Ve("POSITION",!0),ce=Ve("TIMESTAMP",!0),de=Ve("DATE",!0),pe=Ve("LEADING",!0),fe=Ve("TRAILING",!0),he=Ve("BOTH",!0),ye=Ve("TO",!0),be=Ve("INTERVAL",!0),ve=Ve("YEAR",!0),me=Ve("MONTH",!0),ge=Ve("DAY",!0),Oe=Ve("HOUR",!0),je=Ve("MINUTE",!0),_e=Ve("SECOND",!0),we=Ve("CASE",!0),Se=Ve("END",!0),ke=Ve("WHEN",!0),xe=Ve("THEN",!0),Fe=Ve("ELSE",!0),Ie=Ve(",",!1),Te=Ve("(",!1),Ee=Ve(")",!1),Ce=/^[ \t\n\r]/,Re=Be([" ","\t","\n","\r"],!1,!1),Ne=Ve("`",!1),Pe=/^[^`]/,De=Be(["`"],!0,!1),Ae=0,Le=[{line:1,column:1}],Me=0,qe=[],Ge=0;if("startRule"in r){if(!(r.startRule in i))throw new Error("Can't start parsing from rule \""+r.startRule+'".');s=i[r.startRule]}function Ve(e,t){return{type:"literal",text:e,ignoreCase:t}}function Be(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Ue(e){var r,n=Le[e];if(n)return n;for(r=e-1;!Le[r];)r--;for(n={line:(n=Le[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Le[e]=n,n}function Je(e,t){var r=Ue(e),n=Ue(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function We(e){Ae<Me||(Ae>Me&&(Me=Ae,qe=[]),qe.push(e))}function Qe(){var e,t;return e=Ae,dr()!==a&&(t=He())!==a&&dr()!==a?e=t:(Ae=e,e=a),e}function ze(){var e,t,r,n,i,s,u,l;if(e=Ae,(t=He())!==a){for(r=[],n=Ae,(i=dr())!==a&&(s=ur())!==a&&(u=dr())!==a&&(l=He())!==a?n=i=[i,s,u,l]:(Ae=n,n=a);n!==a;)r.push(n),n=Ae,(i=dr())!==a&&(s=ur())!==a&&(u=dr())!==a&&(l=He())!==a?n=i=[i,s,u,l]:(Ae=n,n=a);r!==a?e=t=o(t,r):(Ae=e,e=a)}else Ae=e,e=a;return e}function He(){var e,t,r,n,i,s,o,l;if(e=Ae,(t=Ke())!==a){for(r=[],n=Ae,(i=dr())!==a&&(s=At())!==a&&(o=dr())!==a&&(l=Ke())!==a?n=i=[i,s,o,l]:(Ae=n,n=a);n!==a;)r.push(n),n=Ae,(i=dr())!==a&&(s=At())!==a&&(o=dr())!==a&&(l=Ke())!==a?n=i=[i,s,o,l]:(Ae=n,n=a);r!==a?e=t=u(t,r):(Ae=e,e=a)}else Ae=e,e=a;return e}function Ke(){var e,t,r,n,i,s,o,l;if(e=Ae,(t=Ze())!==a){for(r=[],n=Ae,(i=dr())!==a&&(s=Dt())!==a&&(o=dr())!==a&&(l=Ze())!==a?n=i=[i,s,o,l]:(Ae=n,n=a);n!==a;)r.push(n),n=Ae,(i=dr())!==a&&(s=Dt())!==a&&(o=dr())!==a&&(l=Ze())!==a?n=i=[i,s,o,l]:(Ae=n,n=a);r!==a?e=t=u(t,r):(Ae=e,e=a)}else Ae=e,e=a;return e}function Ze(){var e,r,n,i,s;return e=Ae,(r=Pt())===a&&(r=Ae,33===t.charCodeAt(Ae)?(n="!",Ae++):(n=a,0===Ge&&We(l)),n!==a?(i=Ae,Ge++,61===t.charCodeAt(Ae)?(s="=",Ae++):(s=a,0===Ge&&We(c)),Ge--,s===a?i=void 0:(Ae=i,i=a),i!==a?r=n=[n,i]:(Ae=r,r=a)):(Ae=r,r=a)),r!==a&&(n=dr())!==a&&(i=Ze())!==a?e=r=function(e){return function(e,t){return{type:"unary_expr",operator:"NOT",expr:t}}(0,e)}(i):(Ae=e,e=a),e===a&&(e=function(){var e,t,r;return e=Ae,(t=et())!==a&&dr()!==a?((r=function(){var e;return(e=function(){var e,t,r,n,i,s;if(e=[],t=Ae,(r=dr())!==a&&(n=$e())!==a&&(i=dr())!==a&&(s=et())!==a?t=r=[r,n,i,s]:(Ae=t,t=a),t!==a)for(;t!==a;)e.push(t),t=Ae,(r=dr())!==a&&(n=$e())!==a&&(i=dr())!==a&&(s=et())!==a?t=r=[r,n,i,s]:(Ae=t,t=a);else e=a;return e!==a&&(e=function(e){return{type:"arithmetic",tail:e}}(e)),e}())===a&&(e=function(){var e,t,r,n;return e=Ae,(t=Xe())!==a&&dr()!==a&&(r=lr())!==a&&dr()!==a&&(n=ze())!==a&&dr()!==a&&cr()!==a?e=t=function(e,t){return{op:e,right:t}}(t,n):(Ae=e,e=a),e===a&&(e=Ae,(t=Xe())!==a&&dr()!==a&&(r=lr())!==a&&dr()!==a&&(n=cr())!==a?e=t=function(e){return{op:e,right:{type:"expr_list",value:[]}}}(t):(Ae=e,e=a),e===a&&(e=Ae,(t=Xe())!==a&&dr()!==a&&(r=lt())!==a?e=t=function(e,t){return{op:e,right:t}}(t,r):(Ae=e,e=a))),e}())===a&&(e=function(){var e,t,r,n,i,s;return e=Ae,(t=Pt())!==a&&dr()!==a&&(r=Lt())!==a&&dr()!==a&&(n=et())!==a&&dr()!==a&&(i=Dt())!==a&&dr()!==a&&(s=et())!==a?e=t=function(e,t,r){return{op:"NOT"+e,right:{type:"expr_list",value:[t,r]}}}(r,n,s):(Ae=e,e=a),e===a&&(e=Ae,(t=Lt())!==a&&dr()!==a&&(r=et())!==a&&dr()!==a&&(n=Dt())!==a&&dr()!==a&&(i=et())!==a?e=t=function(e,t,r){return{op:e,right:{type:"expr_list",value:[t,r]}}}(t,r,i):(Ae=e,e=a)),e}())===a&&(e=function(){var e,t,r,n;return e=Ae,(t=Ct())!==a&&dr()!==a&&(r=Pt())!==a&&dr()!==a&&(n=et())!==a?e=t=function(e,t){return{op:e+"NOT",right:t}}(t,n):(Ae=e,e=a),e===a&&(e=Ae,(t=Ct())!==a&&dr()!==a&&(r=et())!==a?e=t=function(e,t){return{op:e,right:t}}(t,r):(Ae=e,e=a)),e}())===a&&(e=function(){var e,t,r,n;return e=Ae,(t=Ye())!==a&&dr()!==a&&(r=bt())!==a&&dr()!==a&&Nt()!==a&&dr()!==a&&(n=vt())!==a?e=t=function(e,t,r){return{op:e,right:t,escape:r.value}}(t,r,n):(Ae=e,e=a),e===a&&(e=Ae,(t=Ye())!==a&&dr()!==a&&(r=bt())!==a?e=t=function(e,t){return{op:e,right:t,escape:""}}(t,r):(Ae=e,e=a)),e}()),e}())===a&&(r=null),r!==a?e=t=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?yr(e,t.tail):hr(t.op,e,t.right,t.escape)}(t,r):(Ae=e,e=a)):(Ae=e,e=a),e}()),e}function $e(){var e;return">="===t.substr(Ae,2)?(e=">=",Ae+=2):(e=a,0===Ge&&We(d)),e===a&&(62===t.charCodeAt(Ae)?(e=">",Ae++):(e=a,0===Ge&&We(p)),e===a&&("<="===t.substr(Ae,2)?(e="<=",Ae+=2):(e=a,0===Ge&&We(f)),e===a&&("<>"===t.substr(Ae,2)?(e="<>",Ae+=2):(e=a,0===Ge&&We(h)),e===a&&(60===t.charCodeAt(Ae)?(e="<",Ae++):(e=a,0===Ge&&We(y)),e===a&&(61===t.charCodeAt(Ae)?(e="=",Ae++):(e=a,0===Ge&&We(c)),e===a&&("!="===t.substr(Ae,2)?(e="!=",Ae+=2):(e=a,0===Ge&&We(b)))))))),e}function Ye(){var e,t,r,n,i;return e=Ae,t=Ae,(r=Pt())!==a&&(n=dr())!==a&&(i=Rt())!==a?t=r=[r,n,i]:(Ae=t,t=a),t!==a&&(t=v(t)),(e=t)===a&&(e=Rt()),e}function Xe(){var e,t,r,n,i;return e=Ae,t=Ae,(r=Pt())!==a&&(n=dr())!==a&&(i=Et())!==a?t=r=[r,n,i]:(Ae=t,t=a),t!==a&&(t=v(t)),(e=t)===a&&(e=Et()),e}function et(){var e,t,r,n,i,s,o,l;if(e=Ae,(t=rt())!==a){for(r=[],n=Ae,(i=dr())!==a&&(s=tt())!==a&&(o=dr())!==a&&(l=rt())!==a?n=i=[i,s,o,l]:(Ae=n,n=a);n!==a;)r.push(n),n=Ae,(i=dr())!==a&&(s=tt())!==a&&(o=dr())!==a&&(l=rt())!==a?n=i=[i,s,o,l]:(Ae=n,n=a);r!==a?e=t=u(t,r):(Ae=e,e=a)}else Ae=e,e=a;return e}function tt(){var e;return 43===t.charCodeAt(Ae)?(e="+",Ae++):(e=a,0===Ge&&We(m)),e===a&&(45===t.charCodeAt(Ae)?(e="-",Ae++):(e=a,0===Ge&&We(g))),e}function rt(){var e,t,r,n,i,s,o,u;if(e=Ae,(t=at())!==a){for(r=[],n=Ae,(i=dr())!==a&&(s=nt())!==a&&(o=dr())!==a&&(u=at())!==a?n=i=[i,s,o,u]:(Ae=n,n=a);n!==a;)r.push(n),n=Ae,(i=dr())!==a&&(s=nt())!==a&&(o=dr())!==a&&(u=at())!==a?n=i=[i,s,o,u]:(Ae=n,n=a);r!==a?e=t=function(e,t){return yr(e,t)}(t,r):(Ae=e,e=a)}else Ae=e,e=a;return e}function nt(){var e;return 42===t.charCodeAt(Ae)?(e="*",Ae++):(e=a,0===Ge&&We(O)),e===a&&(47===t.charCodeAt(Ae)?(e="/",Ae++):(e=a,0===Ge&&We(j))),e}function at(){var e,t;return(e=function(){var e;return(e=vt())===a&&(e=function(){var e,t,r,n;return e=Ae,(t=function(){var e,t,r,n;return e=Ae,(t=jt())!==a&&(r=_t())!==a&&(n=wt())!==a?e=t=function(e,t,r){return parseFloat(e+t+r)}(t,r,n):(Ae=e,e=a),e===a&&(e=Ae,(t=jt())!==a&&(r=_t())!==a?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Ae=e,e=a),e===a&&(e=Ae,(t=jt())!==a&&(r=wt())!==a?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Ae=e,e=a),e===a&&(e=Ae,(t=jt())!==a&&(t=function(e){return parseFloat(e)}(t)),e=t))),e}())!==a?(r=Ae,Ge++,n=st(),Ge--,n===a?r=void 0:(Ae=r,r=a),r!==a?e=t=function(e){return{type:"number",value:e}}(t):(Ae=e,e=a)):(Ae=e,e=a),e}())===a&&(e=function(){var e,t;return e=Ae,(t=It())!==a&&(t={type:"bool",value:!0}),(e=t)===a&&(e=Ae,(t=Tt())!==a&&(t={type:"bool",value:!1}),e=t),e}())===a&&(e=function(){var e;return(e=Ft())!==a&&(e={type:"null",value:null}),e}())===a&&(e=function(){var e,t;return e=Ae,Wt()!==a&&dr()!==a&&(t=bt())!==a?e=function(e){return{type:"date",value:e.value}}(t):(Ae=e,e=a),e}())===a&&(e=function(){var e,t;return e=Ae,Jt()!==a&&dr()!==a&&(t=bt())!==a?e=function(e){return{type:"timestamp",value:e.value}}(t):(Ae=e,e=a),e}())===a&&(e=dt()),e}())===a&&(e=function(){var e,t,r;return e=Ae,Vt()!==a&&dr()!==a&&lr()!==a&&dr()!==a&&(t=function(){var e;return(e=$t())===a&&(e=Yt())===a&&(e=Xt())===a&&(e=er())===a&&(e=tr())===a&&(e=rr()),e}())!==a&&dr()!==a&&Mt()!==a&&dr()!==a&&(r=He())!==a&&dr()!==a&&cr()!==a?e=function(e,t){return{type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:e},t]}}}(t,r):(Ae=e,e=a),e}())===a&&(e=function(){var e,t,r,n,i,s,o,u;return e=Ae,Gt()!==a&&dr()!==a&&lr()!==a&&dr()!==a&&(t=He())!==a&&dr()!==a&&Mt()!==a&&dr()!==a&&(r=He())!==a&&dr()!==a?(n=Ae,(i=qt())!==a&&(s=dr())!==a&&(o=He())!==a&&(u=dr())!==a?n=i=[i,s,o,u]:(Ae=n,n=a),n===a&&(n=null),n!==a&&(i=cr())!==a?e=function(e,t,r){return{type:"function",name:"substring",args:{type:"expr_list",value:r?[e,t,r[2]]:[e,t]}}}(t,r,n):(Ae=e,e=a)):(Ae=e,e=a),e}())===a&&(e=function(){var e,t,r,n;return e=Ae,Bt()!==a&&dr()!==a&&lr()!==a&&dr()!==a?((t=ct())===a&&(t=null),t!==a&&dr()!==a&&(r=He())!==a&&dr()!==a&&Mt()!==a&&dr()!==a&&(n=He())!==a&&dr()!==a&&cr()!==a?e=function(e,t,r){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t,r]}}}(t,r,n):(Ae=e,e=a)):(Ae=e,e=a),e===a&&(e=Ae,Bt()!==a&&dr()!==a&&lr()!==a&&dr()!==a?((t=ct())===a&&(t=null),t!==a&&dr()!==a&&(r=He())!==a&&dr()!==a&&cr()!==a?e=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}}(t,r):(Ae=e,e=a)):(Ae=e,e=a)),e}())===a&&(e=function(){var e,t,r;return e=Ae,Ut()!==a&&dr()!==a&&lr()!==a&&dr()!==a&&(t=He())!==a&&dr()!==a&&Et()!==a&&dr()!==a&&(r=He())!==a&&dr()!==a&&cr()!==a?e=function(e,t){return{type:"function",name:"position",args:{type:"expr_list",value:[e,t]}}}(t,r):(Ae=e,e=a),e}())===a&&(e=function(){var e,t,r;return e=Ae,(t=fr())!==a&&dr()!==a&&lr()!==a&&dr()!==a?((r=ze())===a&&(r=null),r!==a&&dr()!==a&&cr()!==a?e=t=function(e,t){return{type:"function",name:e,args:t||{type:"expr_list",value:[]}}}(t,r):(Ae=e,e=a)):(Ae=e,e=a),e}())===a&&(e=function(){var e;return(e=function(){var e,t,r,n,i;if(e=Ae,nr()!==a)if(dr()!==a)if((t=He())!==a)if(dr()!==a){for(r=[],n=gt();n!==a;)r.push(n),n=gt();r!==a&&(n=dr())!==a&&(i=ar())!==a?e=function(e,t){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:null}}(t,r):(Ae=e,e=a)}else Ae=e,e=a;else Ae=e,e=a;else Ae=e,e=a;else Ae=e,e=a;if(e===a)if(e=Ae,nr()!==a)if(dr()!==a)if((t=He())!==a)if(dr()!==a){for(r=[],n=gt();n!==a;)r.push(n),n=gt();r!==a&&(n=dr())!==a&&(i=Ot())!==a&&dr()!==a&&ar()!==a?e=function(e,t,r){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:r.value}}(t,r,i):(Ae=e,e=a)}else Ae=e,e=a;else Ae=e,e=a;else Ae=e,e=a;else Ae=e,e=a;return e}())===a&&(e=function(){var e,t,r,n;if(e=Ae,nr()!==a)if(dr()!==a){for(t=[],r=mt();r!==a;)t.push(r),r=mt();t!==a&&(r=dr())!==a&&(n=ar())!==a?e=function(e){return{type:"case_expression",format:"searched",clauses:e,else:null}}(t):(Ae=e,e=a)}else Ae=e,e=a;else Ae=e,e=a;if(e===a)if(e=Ae,nr()!==a)if(dr()!==a){for(t=[],r=mt();r!==a;)t.push(r),r=mt();t!==a&&(r=dr())!==a&&(n=Ot())!==a&&dr()!==a&&ar()!==a?e=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}}(t,n):(Ae=e,e=a)}else Ae=e,e=a;else Ae=e,e=a;return e}()),e}())===a&&(e=function(){var e;return(e=function(){var e;return(e=function(){var e,t,r,n;if(e=Ae,(t=st())!==a){for(r=[],n=ut();n!==a;)r.push(n),n=ut();r!==a?e=t=_(t,r):(Ae=e,e=a)}else Ae=e,e=a;return e}())!==a&&(e=e),e}())!==a&&(e=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:e}}(e)),e}())===a&&(e=lt())===a&&(e=Ae,lr()!==a&&dr()!==a&&(t=He())!==a&&dr()!==a&&cr()!==a?e=function(e){return e.paren=!0,e}(t):(Ae=e,e=a)),e}function it(){var e,t,r,n;if(e=Ae,(t=st())!==a){for(r=[],n=ot();n!==a;)r.push(n),n=ot();r!==a?e=t=_(t,r):(Ae=e,e=a)}else Ae=e,e=a;return e}function st(){var e;return w.test(t.charAt(Ae))?(e=t.charAt(Ae),Ae++):(e=a,0===Ge&&We(S)),e}function ot(){var e;return k.test(t.charAt(Ae))?(e=t.charAt(Ae),Ae++):(e=a,0===Ge&&We(x)),e}function ut(){var e;return F.test(t.charAt(Ae))?(e=t.charAt(Ae),Ae++):(e=a,0===Ge&&We(I)),e}function lt(){var e,r,n;return e=Ae,64===t.charCodeAt(Ae)?(r="@",Ae++):(r=a,0===Ge&&We(T)),r!==a&&(n=it())!==a?e=r=[r,n]:(Ae=e,e=a),e!==a&&(e=function(e){return{type:"param",value:e[1]}}(e)),e}function ct(){var e;return(e=Qt())===a&&(e=zt())===a&&(e=Ht()),e}function dt(){var e,r,n,i;return e=Ae,Zt()!==a&&dr()!==a?(45===t.charCodeAt(Ae)?(r="-",Ae++):(r=a,0===Ge&&We(g)),r===a&&(43===t.charCodeAt(Ae)?(r="+",Ae++):(r=a,0===Ge&&We(m))),r!==a&&dr()!==a&&(n=bt())!==a&&dr()!==a&&(i=pt())!==a?e=function(e,t,r){return{type:"interval",value:t,qualifier:r,op:e}}(r,n,i):(Ae=e,e=a)):(Ae=e,e=a),e===a&&(e=Ae,Zt()!==a&&dr()!==a&&(r=bt())!==a&&dr()!==a&&(n=pt())!==a?e=function(e,t){return{type:"interval",value:e,qualifier:t,op:""}}(r,n):(Ae=e,e=a)),e}function pt(){var e,t,r;return e=Ae,(t=function(){var e,t,r;return e=Ae,(t=ft())!==a&&dr()!==a&&lr()!==a&&dr()!==a&&(r=yt())!==a&&dr()!==a&&cr()!==a?e=t=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}}(t,r):(Ae=e,e=a),e===a&&(e=Ae,(t=ft())!==a&&(t=E(t)),e=t),e}())!==a&&dr()!==a&&Kt()!==a&&dr()!==a&&(r=function(){var e,t,r,n;return e=Ae,(t=ft())!==a&&(t=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}}(t)),(e=t)===a&&(e=Ae,(t=rr())!==a&&dr()!==a&&lr()!==a&&dr()!==a&&(r=yt())!==a&&dr()!==a&&ur()!==a&&dr()!==a&&(n=ht())!==a&&dr()!==a&&cr()!==a?e=t=C(r,n):(Ae=e,e=a),e===a&&(e=Ae,(t=rr())!==a&&dr()!==a&&lr()!==a&&dr()!==a&&(r=yt())!==a&&dr()!==a&&cr()!==a?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(r):(Ae=e,e=a),e===a&&(e=Ae,(t=rr())!==a&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t))),e}())!==a?e=t=function(e,t){return{type:"interval-qualifier",start:e,end:t}}(t,r):(Ae=e,e=a),e===a&&(e=function(){var e,t,r,n;return e=Ae,(t=ft())!==a&&dr()!==a&&lr()!==a&&dr()!==a&&(r=ht())!==a&&dr()!==a&&cr()!==a?e=t=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}}(t,r):(Ae=e,e=a),e===a&&(e=Ae,(t=ft())!==a&&(t=E(t)),(e=t)===a&&(e=Ae,(t=rr())!==a&&dr()!==a&&lr()!==a&&dr()!==a&&(r=yt())!==a&&dr()!==a&&ur()!==a&&dr()!==a&&(n=ht())!==a&&dr()!==a&&cr()!==a?e=t=C(r,n):(Ae=e,e=a),e===a&&(e=Ae,(t=rr())!==a&&dr()!==a&&lr()!==a&&dr()!==a&&(r=ht())!==a&&dr()!==a&&cr()!==a?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(r):(Ae=e,e=a),e===a&&(e=Ae,(t=rr())!==a&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t)))),e}()),e}function ft(){var e,t;return e=Ae,(t=Xt())!==a&&(t={type:"string",value:"day"}),(e=t)===a&&(e=Ae,(t=er())!==a&&(t={type:"string",value:"hour"}),(e=t)===a&&(e=Ae,(t=tr())!==a&&(t={type:"string",value:"minute"}),(e=t)===a&&(e=Ae,(t=Yt())!==a&&(t={type:"string",value:"month"}),(e=t)===a&&(e=Ae,(t=$t())!==a&&(t={type:"string",value:"year"}),e=t)))),e}function ht(){var e;return(e=St())!==a&&(e=R(e)),e}function yt(){var e;return(e=St())!==a&&(e=R(e)),e}function bt(){var e;return(e=vt())===a&&(e=lt()),e}function vt(){var e,r,n,i,s;if(e=Ae,39===t.charCodeAt(Ae)?(r="'",Ae++):(r=a,0===Ge&&We(N)),r===a&&("N'"===t.substr(Ae,2)?(r="N'",Ae+=2):(r=a,0===Ge&&We(P))),r!==a){for(n=[],i=Ae,t.substr(Ae,2)===D?(s=D,Ae+=2):(s=a,0===Ge&&We(A)),s!==a&&(s="'"),(i=s)===a&&(L.test(t.charAt(Ae))?(i=t.charAt(Ae),Ae++):(i=a,0===Ge&&We(M)));i!==a;)n.push(i),i=Ae,t.substr(Ae,2)===D?(s=D,Ae+=2):(s=a,0===Ge&&We(A)),s!==a&&(s="'"),(i=s)===a&&(L.test(t.charAt(Ae))?(i=t.charAt(Ae),Ae++):(i=a,0===Ge&&We(M)));n!==a?(39===t.charCodeAt(Ae)?(i="'",Ae++):(i=a,0===Ge&&We(N)),i!==a?e=r=function(e){return{type:"string",value:e.join("")}}(n):(Ae=e,e=a)):(Ae=e,e=a)}else Ae=e,e=a;return e}function mt(){var e,t,r;return e=Ae,ir()!==a&&dr()!==a&&(t=He())!==a&&dr()!==a&&sr()!==a&&dr()!==a&&(r=He())!==a?e=q(t,r):(Ae=e,e=a),e}function gt(){var e,t,r;return e=Ae,ir()!==a&&dr()!==a&&(t=He())!==a&&dr()!==a&&sr()!==a&&dr()!==a&&(r=He())!==a?e=q(t,r):(Ae=e,e=a),e}function Ot(){var e,t;return e=Ae,or()!==a&&dr()!==a&&(t=He())!==a?e=function(e){return{type:"else_clause",value:e}}(t):(Ae=e,e=a),e}function jt(){var e,r,n;return(e=St())===a&&(e=Ae,45===t.charCodeAt(Ae)?(r="-",Ae++):(r=a,0===Ge&&We(g)),r===a&&(43===t.charCodeAt(Ae)?(r="+",Ae++):(r=a,0===Ge&&We(m))),r!==a&&(n=St())!==a?e=r=function(e,t){return e[0]+t}(r,n):(Ae=e,e=a)),e}function _t(){var e,r,n;return e=Ae,46===t.charCodeAt(Ae)?(r=".",Ae++):(r=a,0===Ge&&We(G)),r!==a?((n=St())===a&&(n=null),n!==a?e=r=function(e){return"."+(null!=e?e:"")}(n):(Ae=e,e=a)):(Ae=e,e=a),e}function wt(){var e,t,r;return e=Ae,(t=xt())!==a&&(r=St())!==a?e=t=function(e,t){return e+t}(t,r):(Ae=e,e=a),e}function St(){var e,t;if(e=[],(t=kt())!==a)for(;t!==a;)e.push(t),t=kt();else e=a;return e!==a&&(e=function(e){return e.join("")}(e)),e}function kt(){var e;return V.test(t.charAt(Ae))?(e=t.charAt(Ae),Ae++):(e=a,0===Ge&&We(B)),e}function xt(){var e,r,n;return e=Ae,U.test(t.charAt(Ae))?(r=t.charAt(Ae),Ae++):(r=a,0===Ge&&We(J)),r!==a?(W.test(t.charAt(Ae))?(n=t.charAt(Ae),Ae++):(n=a,0===Ge&&We(Q)),n===a&&(n=null),n!==a?e=r=function(e,t){return"e"+(null===t?"":t)}(0,n):(Ae=e,e=a)):(Ae=e,e=a),e}function Ft(){var e,r,n,i;return e=Ae,"null"===t.substr(Ae,4).toLowerCase()?(r=t.substr(Ae,4),Ae+=4):(r=a,0===Ge&&We(z)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r=[r,n]:(Ae=e,e=a)):(Ae=e,e=a),e}function It(){var e,r,n,i;return e=Ae,"true"===t.substr(Ae,4).toLowerCase()?(r=t.substr(Ae,4),Ae+=4):(r=a,0===Ge&&We(H)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r=[r,n]:(Ae=e,e=a)):(Ae=e,e=a),e}function Tt(){var e,r,n,i;return e=Ae,"false"===t.substr(Ae,5).toLowerCase()?(r=t.substr(Ae,5),Ae+=5):(r=a,0===Ge&&We(K)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r=[r,n]:(Ae=e,e=a)):(Ae=e,e=a),e}function Et(){var e,r,n,i;return e=Ae,"in"===t.substr(Ae,2).toLowerCase()?(r=t.substr(Ae,2),Ae+=2):(r=a,0===Ge&&We(Z)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="IN":(Ae=e,e=a)):(Ae=e,e=a),e}function Ct(){var e,r,n,i;return e=Ae,"is"===t.substr(Ae,2).toLowerCase()?(r=t.substr(Ae,2),Ae+=2):(r=a,0===Ge&&We($)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="IS":(Ae=e,e=a)):(Ae=e,e=a),e}function Rt(){var e,r,n,i;return e=Ae,"like"===t.substr(Ae,4).toLowerCase()?(r=t.substr(Ae,4),Ae+=4):(r=a,0===Ge&&We(Y)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="LIKE":(Ae=e,e=a)):(Ae=e,e=a),e}function Nt(){var e,r,n,i;return e=Ae,"escape"===t.substr(Ae,6).toLowerCase()?(r=t.substr(Ae,6),Ae+=6):(r=a,0===Ge&&We(X)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="ESCAPE":(Ae=e,e=a)):(Ae=e,e=a),e}function Pt(){var e,r,n,i;return e=Ae,"not"===t.substr(Ae,3).toLowerCase()?(r=t.substr(Ae,3),Ae+=3):(r=a,0===Ge&&We(ee)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="NOT":(Ae=e,e=a)):(Ae=e,e=a),e}function Dt(){var e,r,n,i;return e=Ae,"and"===t.substr(Ae,3).toLowerCase()?(r=t.substr(Ae,3),Ae+=3):(r=a,0===Ge&&We(te)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="AND":(Ae=e,e=a)):(Ae=e,e=a),e}function At(){var e,r,n,i;return e=Ae,"or"===t.substr(Ae,2).toLowerCase()?(r=t.substr(Ae,2),Ae+=2):(r=a,0===Ge&&We(re)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="OR":(Ae=e,e=a)):(Ae=e,e=a),e}function Lt(){var e,r,n,i;return e=Ae,"between"===t.substr(Ae,7).toLowerCase()?(r=t.substr(Ae,7),Ae+=7):(r=a,0===Ge&&We(ne)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="BETWEEN":(Ae=e,e=a)):(Ae=e,e=a),e}function Mt(){var e,r,n,i;return e=Ae,"from"===t.substr(Ae,4).toLowerCase()?(r=t.substr(Ae,4),Ae+=4):(r=a,0===Ge&&We(ae)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="FROM":(Ae=e,e=a)):(Ae=e,e=a),e}function qt(){var e,r,n,i;return e=Ae,"for"===t.substr(Ae,3).toLowerCase()?(r=t.substr(Ae,3),Ae+=3):(r=a,0===Ge&&We(ie)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="FOR":(Ae=e,e=a)):(Ae=e,e=a),e}function Gt(){var e,r,n,i;return e=Ae,"substring"===t.substr(Ae,9).toLowerCase()?(r=t.substr(Ae,9),Ae+=9):(r=a,0===Ge&&We(se)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="SUBSTRING":(Ae=e,e=a)):(Ae=e,e=a),e}function Vt(){var e,r,n,i;return e=Ae,"extract"===t.substr(Ae,7).toLowerCase()?(r=t.substr(Ae,7),Ae+=7):(r=a,0===Ge&&We(oe)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="EXTRACT":(Ae=e,e=a)):(Ae=e,e=a),e}function Bt(){var e,r,n,i;return e=Ae,"trim"===t.substr(Ae,4).toLowerCase()?(r=t.substr(Ae,4),Ae+=4):(r=a,0===Ge&&We(ue)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="TRIM":(Ae=e,e=a)):(Ae=e,e=a),e}function Ut(){var e,r,n,i;return e=Ae,"position"===t.substr(Ae,8).toLowerCase()?(r=t.substr(Ae,8),Ae+=8):(r=a,0===Ge&&We(le)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="POSITION":(Ae=e,e=a)):(Ae=e,e=a),e}function Jt(){var e,r,n,i;return e=Ae,"timestamp"===t.substr(Ae,9).toLowerCase()?(r=t.substr(Ae,9),Ae+=9):(r=a,0===Ge&&We(ce)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="TIMESTAMP":(Ae=e,e=a)):(Ae=e,e=a),e}function Wt(){var e,r,n,i;return e=Ae,"date"===t.substr(Ae,4).toLowerCase()?(r=t.substr(Ae,4),Ae+=4):(r=a,0===Ge&&We(de)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="DATE":(Ae=e,e=a)):(Ae=e,e=a),e}function Qt(){var e,r,n,i;return e=Ae,"leading"===t.substr(Ae,7).toLowerCase()?(r=t.substr(Ae,7),Ae+=7):(r=a,0===Ge&&We(pe)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="LEADING":(Ae=e,e=a)):(Ae=e,e=a),e}function zt(){var e,r,n,i;return e=Ae,"trailing"===t.substr(Ae,8).toLowerCase()?(r=t.substr(Ae,8),Ae+=8):(r=a,0===Ge&&We(fe)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="TRAILING":(Ae=e,e=a)):(Ae=e,e=a),e}function Ht(){var e,r,n,i;return e=Ae,"both"===t.substr(Ae,4).toLowerCase()?(r=t.substr(Ae,4),Ae+=4):(r=a,0===Ge&&We(he)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="BOTH":(Ae=e,e=a)):(Ae=e,e=a),e}function Kt(){var e,r,n,i;return e=Ae,"to"===t.substr(Ae,2).toLowerCase()?(r=t.substr(Ae,2),Ae+=2):(r=a,0===Ge&&We(ye)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="TO":(Ae=e,e=a)):(Ae=e,e=a),e}function Zt(){var e,r,n,i;return e=Ae,"interval"===t.substr(Ae,8).toLowerCase()?(r=t.substr(Ae,8),Ae+=8):(r=a,0===Ge&&We(be)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="INTERVAL":(Ae=e,e=a)):(Ae=e,e=a),e}function $t(){var e,r,n,i;return e=Ae,"year"===t.substr(Ae,4).toLowerCase()?(r=t.substr(Ae,4),Ae+=4):(r=a,0===Ge&&We(ve)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="YEAR":(Ae=e,e=a)):(Ae=e,e=a),e}function Yt(){var e,r,n,i;return e=Ae,"month"===t.substr(Ae,5).toLowerCase()?(r=t.substr(Ae,5),Ae+=5):(r=a,0===Ge&&We(me)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="MONTH":(Ae=e,e=a)):(Ae=e,e=a),e}function Xt(){var e,r,n,i;return e=Ae,"day"===t.substr(Ae,3).toLowerCase()?(r=t.substr(Ae,3),Ae+=3):(r=a,0===Ge&&We(ge)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="DAY":(Ae=e,e=a)):(Ae=e,e=a),e}function er(){var e,r,n,i;return e=Ae,"hour"===t.substr(Ae,4).toLowerCase()?(r=t.substr(Ae,4),Ae+=4):(r=a,0===Ge&&We(Oe)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="HOUR":(Ae=e,e=a)):(Ae=e,e=a),e}function tr(){var e,r,n,i;return e=Ae,"minute"===t.substr(Ae,6).toLowerCase()?(r=t.substr(Ae,6),Ae+=6):(r=a,0===Ge&&We(je)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="MINUTE":(Ae=e,e=a)):(Ae=e,e=a),e}function rr(){var e,r,n,i;return e=Ae,"second"===t.substr(Ae,6).toLowerCase()?(r=t.substr(Ae,6),Ae+=6):(r=a,0===Ge&&We(_e)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="SECOND":(Ae=e,e=a)):(Ae=e,e=a),e}function nr(){var e,r,n,i;return e=Ae,"case"===t.substr(Ae,4).toLowerCase()?(r=t.substr(Ae,4),Ae+=4):(r=a,0===Ge&&We(we)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="CASE":(Ae=e,e=a)):(Ae=e,e=a),e}function ar(){var e,r,n,i;return e=Ae,"end"===t.substr(Ae,3).toLowerCase()?(r=t.substr(Ae,3),Ae+=3):(r=a,0===Ge&&We(Se)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="END":(Ae=e,e=a)):(Ae=e,e=a),e}function ir(){var e,r,n,i;return e=Ae,"when"===t.substr(Ae,4).toLowerCase()?(r=t.substr(Ae,4),Ae+=4):(r=a,0===Ge&&We(ke)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="WHEN":(Ae=e,e=a)):(Ae=e,e=a),e}function sr(){var e,r,n,i;return e=Ae,"then"===t.substr(Ae,4).toLowerCase()?(r=t.substr(Ae,4),Ae+=4):(r=a,0===Ge&&We(xe)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="THEN":(Ae=e,e=a)):(Ae=e,e=a),e}function or(){var e,r,n,i;return e=Ae,"else"===t.substr(Ae,4).toLowerCase()?(r=t.substr(Ae,4),Ae+=4):(r=a,0===Ge&&We(Fe)),r!==a?(n=Ae,Ge++,i=ot(),Ge--,i===a?n=void 0:(Ae=n,n=a),n!==a?e=r="ELSE":(Ae=e,e=a)):(Ae=e,e=a),e}function ur(){var e;return 44===t.charCodeAt(Ae)?(e=",",Ae++):(e=a,0===Ge&&We(Ie)),e}function lr(){var e;return 40===t.charCodeAt(Ae)?(e="(",Ae++):(e=a,0===Ge&&We(Te)),e}function cr(){var e;return 41===t.charCodeAt(Ae)?(e=")",Ae++):(e=a,0===Ge&&We(Ee)),e}function dr(){var e,t;for(e=[],t=pr();t!==a;)e.push(t),t=pr();return e}function pr(){var e;return Ce.test(t.charAt(Ae))?(e=t.charAt(Ae),Ae++):(e=a,0===Ge&&We(Re)),e}function fr(){var e,r,n,i;if(e=Ae,(r=it())!==a&&(r=r),(e=r)===a)if(e=Ae,96===t.charCodeAt(Ae)?(r="`",Ae++):(r=a,0===Ge&&We(Ne)),r!==a){if(n=[],Pe.test(t.charAt(Ae))?(i=t.charAt(Ae),Ae++):(i=a,0===Ge&&We(De)),i!==a)for(;i!==a;)n.push(i),Pe.test(t.charAt(Ae))?(i=t.charAt(Ae),Ae++):(i=a,0===Ge&&We(De));else n=a;n!==a?(96===t.charCodeAt(Ae)?(i="`",Ae++):(i=a,0===Ge&&We(Ne)),i!==a?e=r=function(e){return e.join("")}(n):(Ae=e,e=a)):(Ae=e,e=a)}else Ae=e,e=a;return e}function hr(e,t,r,n){var a={type:"binary_expr",operator:e,left:t,right:r};return void 0!==n&&(a.escape=n),a}function yr(e,t){for(var r=e,n=0;n<t.length;n++)r=hr(t[n][1],r,t[n][3]);return r}if((n=s())!==a&&Ae===t.length)return n;throw n!==a&&Ae<t.length&&We({type:"end"}),function(t,r,n){return new e(e.buildMessage(t,r),t,r,n)}(qe,Me<t.length?t.charAt(Me):null,Me<t.length?Je(Me,Me+1):Je(Me,Me))}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+a(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?i(e.parts[t][0])+"-"+i(e.parts[t][1]):i(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function a(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return r[e.type](e)}return"Expected "+function(e){var t,r,n=new Array(e.length);for(t=0;t<e.length;t++)n[t]=s(e[t]);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+a(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:t}},(y=m).exports&&(y.exports=b());var g=function(){function e(){Object(s.a)(this,e)}return Object(o.a)(e,null,[{key:"parse",value:function(e){return m.exports.parse(e)}}]),e}(),O=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,j=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,_=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,w=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,S=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,k=new Set(["current_timestamp","current_date","current_time"]);function x(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function F(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"0",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"0",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"0",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"0",u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"0";if("+"===s||"-"===s){var l="".concat(x(parseInt(e,10),4),"-").concat(x(parseInt(t,10),2),"-").concat(x(parseInt(r,10),2)),c="";parseFloat(i)<10&&(c="0");var d="".concat(x(parseInt(n,10),2),":").concat(x(parseInt(a,10),2),":").concat(c+parseFloat(i).toString()),p="".concat(s).concat(x(parseInt(o,10),2),":").concat(x(parseInt(u,10),2));return new Date(l+"T"+d+p)}return new Date(parseInt(e,10),parseInt(t,10)-1,parseInt(r,10),parseInt(n,10),parseInt(a,10),parseFloat(i))}var I=function(){function e(){Object(s.a)(this,e)}return Object(o.a)(e,null,[{key:"makeBool",value:function(e){return R(e)}},{key:"featureValue",value:function(e,t,r,n){return B(e,t,r,n)}},{key:"equalsNull",value:function(e){return null===e}},{key:"applyLike",value:function(e,t,r){return M(e,t,r)}},{key:"ensureArray",value:function(e){return N(e)}},{key:"applyIn",value:function(e,t){return L(e,t)}},{key:"currentDate",value:function(){var e=new Date;return e.setHours(0,0,0,0),e}},{key:"makeSqlInterval",value:function(e,t,r){return f.createFromValueAndQualifer(e,t,r)}},{key:"convertInterval",value:function(e){return e instanceof f?e.valueInMilliseconds():e}},{key:"currentTimestamp",value:function(){return new Date}},{key:"compare",value:function(e,t,r){return G(e,t,r)}},{key:"calculate",value:function(e,t,r){return V(e,t,r)}},{key:"makeComparable",value:function(e){return q(e)}},{key:"evaluateFunction",value:function(e,t){return h(e,t)}},{key:"lookup",value:function(e,t){var r=t[e];return void 0===r?null:r}},{key:"between",value:function(e,t){return null==e||null==t[0]||null==t[1]?null:e>=t[0]&&e<=t[1]}},{key:"notbetween",value:function(e,t){return null==e||null==t[0]||null==t[1]?null:e<t[0]||e>t[1]}},{key:"ternaryNot",value:function(e){return P(e)}},{key:"ternaryAnd",value:function(e,t){return D(e,t)}},{key:"ternaryOr",value:function(e,t){return A(e,t)}}]),e}(),T=function(){function e(t,r){Object(s.a)(this,e),this.fieldsIndex=r,this.datefields={},this.parameters={},this._hasDateFunctions=void 0,this.parseTree=g.parse(t);var n=this.extractExpressionInfo(r),a=n.isStandardized,i=n.isAggregate,o=n.referencedFieldNames;this.referencedFieldNames=o,this.isStandardized=a,this.isAggregate=i}return Object(o.a)(e,[{key:"fieldNames",get:function(){return this.referencedFieldNames}},{key:"testSet",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U,n={},a=Object(i.a)(this.fieldNames);try{var s=function(){var a=t.value;n[a]=e.map((function(e){return r.getAttribute(e,a)}))};for(a.s();!(t=a.n()).done;)s()}catch(o){a.e(o)}finally{a.f()}return!!this.evaluateNode(this.parseTree,{attributes:n},U)}},{key:"calculateValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U,r=this.evaluateNode(this.parseTree,e,t);return r instanceof f?r.valueInMilliseconds()/864e5:r}},{key:"calculateValueCompiled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;return null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(u.a)("csp-restrictions")?this.calculateValue(e,t):(this.compileMe(),this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}},{key:"testFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;return!!this.evaluateNode(this.parseTree,e,t)}},{key:"testFeatureCompiled",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;return null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(u.a)("csp-restrictions")?this.testFeature(e,t):(this.compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}},{key:"hasDateFunctions",get:function(){var e=this;return null!=this._hasDateFunctions||(this._hasDateFunctions=!1,this.visitAll(this.parseTree,(function(t){"current_time"===t.type?e._hasDateFunctions=!0:"function"===t.type&&(e._hasDateFunctions=e._hasDateFunctions||k.has(t.name.toLowerCase()))}))),this._hasDateFunctions}},{key:"getFunctions",value:function(){var e=new Set;return this.visitAll(this.parseTree,(function(t){"function"===t.type&&e.add(t.name.toLowerCase())})),Array.from(e)}},{key:"getExpressions",value:function(){var e=new Map;return this.visitAll(this.parseTree,(function(t){if("function"===t.type){var r=t.name.toLowerCase(),n=t.args.value[0];if("column_ref"===n.type){var a=n.column,i="".concat(r,"-").concat(a);e.has(i)||e.set(i,{aggregateType:r,field:a})}}})),Object(a.a)(e.values())}},{key:"getVariables",value:function(){var e=new Set;return this.visitAll(this.parseTree,(function(t){"param"===t.type&&e.add(t.value.toLowerCase())})),Array.from(e)}},{key:"compileMe",value:function(){var e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",e).bind(I)}},{key:"extractExpressionInfo",value:function(e){var t=this,r=[],n=new Set,a=!0,i=!0;return this.visitAll(this.parseTree,(function(s){switch(s.type){case"column_ref":var o,u,c=e.get(s.column);c?o=u=c.name:o=(u=s.column).toLowerCase(),!c||"date"!==c.type&&"esriFieldTypeDate"!==c.type||(t.datefields[c.name]=1),n.has(o)||(n.add(o),r.push(u)),s.column=u;break;case"function":var d=s.name,p=s.args.value.length;a&&(a=function(e,t){var r=v[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(d,p)),i&&(i=function(e,t){var r=l[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(d,p))}})),{referencedFieldNames:Array.from(r),isStandardized:a,isAggregate:i}}},{key:"visitAll",value:function(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":var r,n=Object(i.a)(e.clauses);try{for(n.s();!(r=n.n()).done;){var a=r.value;this.visitAll(a,t)}}catch(l){n.e(l)}finally{n.f()}"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":var s,o=Object(i.a)(e.value);try{for(o.s();!(s=o.n()).done;){var u=s.value;this.visitAll(u,t)}}catch(l){o.e(l)}finally{o.f()}break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}}},{key:"evaluateNodeToJavaScript",value:function(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case_expression":var t="";if("simple"===e.format){var r="this.makeComparable("+this.evaluateNodeToJavaScript(e.operand)+")";t="( ";for(var n=0;n<e.clauses.length;n++)t+=" ("+r+" === this.makeComparable("+this.evaluateNodeToJavaScript(e.clauses[n].operand)+")) ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{t="( ";for(var a=0;a<e.clauses.length;a++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[a].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[a].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t;case"param":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expr_list":var s,o="[",u=Object(i.a)(e.value);try{for(u.s();!(s=u.n()).done;){var l=s.value;"["!==o&&(o+=","),o+=this.evaluateNodeToJavaScript(l)}}catch(c){u.e(c)}finally{u.f()}return o+="]";case"unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary_expr":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")"}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return JSON.stringify(e.value);case"date":return"(new Date("+C(e.value).getTime().toString()+"))";case"timestamp":return"(new Date("+E(e.value).getTime().toString()+"))";case"current_time":return"date"===e.mode?"this.currentDate()":"this.currentTimestamp()";case"column_ref":return"this.featureValue(feature,"+JSON.stringify(e.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+")"}throw new Error("Unsupported sql syntax "+e.type)}},{key:"evaluateNode",value:function(e,t,r){switch(e.type){case"interval":var n=this.evaluateNode(e.value,t,r);return f.createFromValueAndQualifer(n,e.qualifier,e.op);case"case_expression":if("simple"===e.format){for(var a=q(this.evaluateNode(e.operand,t,r)),s=0;s<e.clauses.length;s++)if(a===q(this.evaluateNode(e.clauses[s].operand,t,r)))return this.evaluateNode(e.clauses[s].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}else{for(var o=0;o<e.clauses.length;o++)if(R(this.evaluateNode(e.clauses[o].operand,t,r)))return this.evaluateNode(e.clauses[o].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":var u,c=[],d=Object(i.a)(e.value);try{for(d.s();!(u=d.n()).done;){var p=u.value;c.push(this.evaluateNode(p,t,r))}}catch(w){d.e(w)}finally{d.f()}return c;case"unary_expr":return P(this.evaluateNode(e.expr,t,r));case"binary_expr":switch(e.operator){case"AND":return D(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"OR":return A(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t,r);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t,r);case"IN":var y=N(this.evaluateNode(e.right,t,r));return L(this.evaluateNode(e.left,t,r),y);case"NOT IN":var b=N(this.evaluateNode(e.right,t,r));return P(L(this.evaluateNode(e.left,t,r),b));case"BETWEEN":var v=this.evaluateNode(e.left,t,r),m=this.evaluateNode(e.right,t,r);return null==v||null==m[0]||null==m[1]?null:v>=q(m[0])&&v<=q(m[1]);case"NOTBETWEEN":var g=this.evaluateNode(e.left,t,r),O=this.evaluateNode(e.right,t,r);return null==g||null==O[0]||null==O[1]?null:g<q(O[0])||g>q(O[1]);case"LIKE":return M(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape);case"NOT LIKE":return P(M(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return G(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"-":case"+":case"*":case"/":return V(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r))}case"null":case"bool":case"string":case"number":return e.value;case"date":return C(e.value);case"timestamp":return E(e.value);case"current_time":var j=new Date;return"date"===e.mode&&j.setHours(0,0,0,0),j;case"column_ref":return B(t,e.column,this.datefields,r);case"function":var _=this.evaluateNode(e.args,t,r);return this.isAggregate?function(e,t){var r=l[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to ".concat(e.toUpperCase()));return r.evaluate(t)}(e.name,_):h(e.name,_)}throw new Error("Unsupported sql syntax "+e.type)}}],[{key:"create",value:function(t,r){return new e(t,r)}}]),e}();function E(e){var t=j.exec(e);if(null!==t){var r=t,a=Object(n.a)(r,7);return F(a[1],a[2],a[3],a[4],a[5],a[6])}if(null!==(t=_.exec(e))){var i=t,s=Object(n.a)(i,10);return F(s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9])}if(null!==(t=w.exec(e))){var o=t,u=Object(n.a)(o,9);return F(u[1],u[2],u[3],u[4],u[5],"0",u[6],u[7],u[8])}if(null!==(t=S.exec(e))){var l=t,c=Object(n.a)(l,6);return F(c[1],c[2],c[3],c[4],c[5])}if(null!==(t=O.exec(e))){var d=t,p=Object(n.a)(d,4);return F(p[1],p[2],p[3])}throw new Error("SQL Invalid Timestamp")}function C(e){var t=O.exec(e);if(null===t)throw new Error("SQL Invalid Date");var r=Object(n.a)(t,4),a=r[1],i=r[2],s=r[3];return new Date(parseInt(a,10),parseInt(i,10)-1,parseInt(s,10))}function R(e){return!0===e}function N(e){return Array.isArray(e)?e:[e]}function P(e){return null!==e?!0!==e:null}function D(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function A(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function L(e,t){if(null==e)return null;var r,n=!1,a=Object(i.a)(t);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(null==s)n=null;else if(e===s){n=!0;break}}}catch(o){a.e(o)}finally{a.f()}return n}function M(e,t,r){if(null==e)return null;for(var n=t,a=r,i="",s="-[]/{}()*+?.\\^$|",o=0,u=0;u<n.length;u++){var l=n.charAt(u);switch(o){case 0:l===a?o=1:s.indexOf(l)>=0?i+="\\"+l:i+="%"===l?".*":"_"===l?".":l;break;case 1:s.indexOf(l)>=0?i+="\\"+l:i+=l,o=0}}return new RegExp("^"+i+"$").test(e)}function q(e){return e instanceof Date?e.valueOf():e}function G(e,t,r){if(null==t||null==r)return null;var n=q(t),a=q(r);switch(e){case"<>":return n!==a;case"=":return n===a;case">":return n>a;case"<":return n<a;case">=":return n>=a;case"<=":return n<=a}}function V(e,t,r){if(t instanceof f)if(r instanceof Date)switch(e){case"+":return new Date(t.valueInMilliseconds()+r.getTime());case"-":return t.valueInMilliseconds()-r.getTime();case"*":return t.valueInMilliseconds()*r.getTime();case"/":return t.valueInMilliseconds()/r.getTime()}else if(r instanceof f)switch(e){case"+":return f.createFromMilliseconds(t.valueInMilliseconds()+r.valueInMilliseconds());case"-":return f.createFromMilliseconds(t.valueInMilliseconds()-r.valueInMilliseconds());case"*":return t.valueInMilliseconds()*r.valueInMilliseconds();case"/":return t.valueInMilliseconds()/r.valueInMilliseconds()}else t=t.valueInMilliseconds();else if(r instanceof f)if(t instanceof Date)switch(e){case"+":return new Date(r.valueInMilliseconds()+t.getTime());case"-":return new Date(t.getTime()-r.valueInMilliseconds());case"*":return t.getTime()*r.valueInMilliseconds();case"/":return t.getTime()/r.valueInMilliseconds()}else r=r.valueInMilliseconds();else if(t instanceof Date&&"number"==typeof r)switch(r=24*r*60*60*1e3,t=t.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}else if(r instanceof Date&&"number"==typeof t)switch(t=24*t*60*60*1e3,r=r.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r}}function B(e,t,r,n){var a=n.getAttribute(e,t);return null!=a&&1===r[t]?new Date(a):a}var U={getAttribute:function(e,t){return(function(e){return e&&"object"==typeof e.attributes}(e)?e.attributes:e)[t]}}},739:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n,a=r(2),i=r(4),s=r(5),o=r(6),u=r(0),l=r(1),c=(r(19),r(14),r(15),r(10)),d=r(705),p=n=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).type="selection",n}return Object(i.a)(r,[{key:"clone",value:function(){return new n}}]),r}(d.a);Object(u.a)([Object(l.b)({type:["selection"]})],p.prototype,"type",void 0);var f=p=n=Object(u.a)([Object(c.a)("esri.layers.support.FeatureReductionSelection")],p)},740:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(675),a=/\[([^\[\]]+)\]/gi;function i(e,t,r){var i=this;return e?e.map((function(e){var s=new n.a;if(s.read(e,r),s.labelExpression){var o=t.fields||t.layerDefinition&&t.layerDefinition.fields||i.fields;s.labelExpression=s.labelExpression.replace(a,(function(e,t){return"[".concat(function(e,t){if(!t)return e;for(var r=e.toLowerCase(),n=0;n<t.length;n++){var a=t[n].name;if(a.toLowerCase()===r)return a}return e}(t,o),"]")}))}return s})):null}},741:function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var n=r(21),a=r(2),i=r(4),s=r(30),o=function(){function e(t,r){Object(a.a)(this,e),this._lastId=-1,this._progress=r,this._parent=t}return Object(i.a)(e,[{key:"reset",value:function(){this._lastId=-1}},{key:"nextBatch",value:function(e){var t=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((function(r){return t.nextBatch(e)}),(function(r){return t.nextBatch(e)}));var r={returnpromise:null,hasset:!1},n=[];return r.returnpromise=Object(s.c)((function(a,i){t._parent._getSet(t._progress).then((function(s){var o=s._known.length-1;if("GETPAGES"===s._known[s._known.length-1]&&(o-=1),t._lastId+e>o&&s._known.length>0&&"GETPAGES"===s._known[s._known.length-1])t._parent._expandPagedSet(s,t._parent._maxQueryRate(),0,0,t._progress).then((function(n){r.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e).then(a,i)}),(function(e){r.hasset=!0,t._parent._mainSetInUse=null,i(e)}));else{if(o>=t._lastId+e||0===s._candidates.length){for(var u=0;u<e;u++){var l=u+t._lastId+1;if(l>=s._known.length)break;n[u]=s._known[l]}return t._lastId+=n.length,0===n.length&&(r.hasset=!0,t._parent._mainSetInUse=null,a([])),void t._parent._getFeatureBatch(n,t._progress).then((function(e){r.hasset=!0,t._parent._mainSetInUse=null,a(e)}),(function(e){r.hasset=!0,t._parent._mainSetInUse=null,i(e)}))}t._parent._refineSetBlock(s,t._parent._maxProcessingRate(),t._progress).then((function(){r.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e).then(a,i)}),(function(e){r.hasset=!0,t._parent._mainSetInUse=null,i(e)}))}}),(function(e){r.hasset=!0,t._parent._mainSetInUse=null,i(e)}))})),!1===r.hasset&&(this._parent._mainSetInUse=r.returnpromise,r.hasset=!0),r.returnpromise}},{key:"next",value:function(){var e=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((function(t){return e.next()}),(function(t){return e.next()}));var t={returnpromise:null,hasset:!1};return t.returnpromise=Object(s.c)((function(r,n){e._parent._getSet(e._progress).then((function(a){e._lastId<a._known.length-1?"GETPAGES"===a._known[e._lastId+1]?e._parent._expandPagedSet(a,e._parent._maxQueryRate(),0,0,e._progress).then((function(r){return t.hasset=!0,e._parent._mainSetInUse=null,e.next()})).then(r,n):(e._lastId+=1,e._parent._getFeature(a,a._known[e._lastId],e._progress).then((function(n){t.hasset=!0,e._parent._mainSetInUse=null,r(n)}),(function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)}))):a._candidates.length>0?e._parent._refineSetBlock(a,e._parent._maxProcessingRate(),e._progress).then((function(){t.hasset=!0,e._parent._mainSetInUse=null,e.next().then(r,n)}),(function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)})):(t.hasset=!0,e._parent._mainSetInUse=null,r(null))}),(function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)}))})),!1===t.hasset&&(this._parent._mainSetInUse=t.returnpromise,t.hasset=!0),t.returnpromise}},{key:"count",value:function(){var e=this;return-1!==this._parent._totalCount?Object(s.t)(this._parent._totalCount):this._parent._getSet(this._progress).then((function(t){return e._refineAllSets(t)})).then((function(t){return e._parent._totalCount=t._known.length,Object(s.t)(e._parent._totalCount)}))}},{key:"_refineAllSets",value:function(e){var t=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,1,this._progress).then((function(r){return t._refineAllSets(e)})).then((function(e){return Object(s.t)(e)})):e._candidates.length>0?"GETPAGES"===e._known[e._candidates.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,2,this._progress).then((function(r){return t._refineAllSets(e)})).then((function(e){return Object(s.t)(e)})):this._parent._refineSetBlock(e,this._parent._maxProcessingRate(),this._progress).then((function(e){return e._candidates.length>0?t._refineAllSets(e):Object(s.t)(e)})):Object(s.t)(e)}}]),e}(),u=r(734),l=r(707),c=r(841),d=r(818),p=r(736),f=r(805),h=r(45),y=r(672),b=function(){function e(t){Object(a.a)(this,e),this.recentlyUsedQueries=null,this.featureSetQueryInterceptor=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=l.a.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=[],this.types=null,this.fields=null,this.geometryType="",this.objectIdField="",this.globalIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,t&&t.lrucache&&(this.recentlyUsedQueries=t.lrucache),t&&t.interceptor&&(this.featureSetQueryInterceptor=t.interceptor)}return Object(i.a)(e,[{key:"optimisePagingFeatureQueries",value:function(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)}},{key:"_hasMemorySource",value:function(){return!0}},{key:"prop",value:function(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)}},{key:"end",value:function(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent}},{key:"_ensureLoaded",value:function(){return this.load()}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=Object(s.c)((function(t,r){if(!0===e._parent.loaded)return e._initialiseFeatureSet(),void t(e);e._parent.load().then((function(){try{e._initialiseFeatureSet(),t(e)}catch(n){r(n)}}),r)}))),this._loadPromise}},{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new h.a({wkid:4326}),this.geometryType=l.m.point)}},{key:"getField",value:function(e,t){var r;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some((function(t){return t&&t.name.toLowerCase()===e&&(r=t),!!r}))),r}},{key:"getFieldsIndex",value:function(){return null===this._fieldsIndex&&(this._fieldsIndex=new y.a(this.fields)),this._fieldsIndex}},{key:"_maxProcessingRate",value:function(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())}},{key:"_maxQueryRate",value:function(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery}},{key:"_checkCancelled",value:function(e){if(null!==e&&e.aborted)throw new Error("Operation has been cancelled.")}},{key:"nativeCapabilities",value:function(){return this._parent.nativeCapabilities()}},{key:"_canDoAggregates",value:function(e,t,r,n,a){return null===this._parent?Object(s.t)(!1):this._parent._canDoAggregates(e,t,r,n,a)}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,o){return null===this._parent?Object(s.s)(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,a,i,o)}},{key:"_getAgregagtePhysicalPage",value:function(e,t,r){return null===this._parent?Object(s.s)(new Error("Should never be called")):this._parent._getAgregagtePhysicalPage(e,t,r)}},{key:"databaseType",value:function(){var e=this;if(this._databaseType===l.a.NotEvaluated){if(null!==c.a.applicationCache){var t=c.a.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==t)return t}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed;var r=[{thetype:l.a.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:l.a.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:l.a.StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}],n=Object(s.c)((function(t,n){e._getDatabaseTypeImpl(r,0).then((function(r){e._databaseType=r,t(e._databaseType)}),(function(e){n(e)}))}));return null!==c.a.applicationCache&&(c.a.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),n),n=n.catch((function(t){throw c.a.applicationCache.clearDatabaseType(e._cacheableFeatureSetSourceKey()),t}))),this._databaseTypeProbed=n,this._databaseTypeProbed}return Object(s.t)(this._databaseType)}},{key:"_cacheableFeatureSetSourceKey",value:function(){return"MUSTBESET"}},{key:"_getDatabaseTypeImpl",value:function(e,t){var r=this;return t>=e.length?Object(s.t)(l.a.StandardisedNoInterval):this._runDatabaseProbe(e[t].testwhere).then((function(n){return!0===n?e[t].thetype:r._getDatabaseTypeImpl(e,t+1)}))}},{key:"_runDatabaseProbe",value:function(e){return null!==this._parent?this._parent._runDatabaseProbe(e):Object(s.s)(new Error("Not Implemented"))}},{key:"isTable",value:function(){return this._parent.isTable()}},{key:"_featureFromCache",value:function(e){if(void 0!==this._featureCache[e])return this._featureCache[e]}},{key:"_isInFeatureSet",value:function(e){return l.b.Unknown}},{key:"_getSet",value:function(e){throw new Error("Not implemented in abstract class")}},{key:"_getFeature",value:function(e,t,r){var n=this;try{return this._checkCancelled(r),void 0!==this._featureFromCache(t)?Object(s.t)(this._featureFromCache(t)):this._getFeatures(e,t,this._maxProcessingRate(),r).then((function(){return n._checkCancelled(r),void 0!==n._featureFromCache(t)?n._featureFromCache(t):Object(s.s)(new Error("Feature Not Found"))}))}catch(a){return Object(s.s)(a)}}},{key:"_getFeatureBatch",value:function(e,t){var r=this;try{this._checkCancelled(t);var a=new u.a([],e,!1,null),i=[];return this._getFeatures(a,-1,e.length,t).then((function(){r._checkCancelled(t);var a,s=Object(n.a)(e);try{for(s.s();!(a=s.n()).done;){var o=a.value;void 0!==r._featureFromCache(o)&&i.push(r._featureFromCache(o))}}catch(u){s.e(u)}finally{s.f()}return i}))}catch(o){return Object(s.s)(o)}}},{key:"_getFeatures",value:function(e,t,r,n){return Object(s.t)("success")}},{key:"_getFilteredSet",value:function(e,t,r,n,a){throw new Error("Not implemented in abstract class")}},{key:"_refineSetBlock",value:function(e,t,r){var n=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate()))return this._expandPagedSet(e,this._maxQueryRate(),0,0,r).then((function(){return n._refineSetBlock(e,t,r)}));this._checkCancelled(r);var a=e._candidates.length;this._refineKnowns(e,t);var i=a-e._candidates.length;return 0===e._candidates.length||i>=t?Object(s.t)(e):this._refineIfParentKnown(e,t-i,r).then((function(){if(n._checkCancelled(r),n._refineKnowns(e,t-i),(i=a-e._candidates.length)<t&&e._candidates.length>0){var s=t-i,o=n._prepareFetchAndRefineSet(e._candidates);return n._fetchAndRefineFeatures(o,o.length>s?s:e._candidates.length,r).then((function(){return n._checkCancelled(r),n._refineKnowns(e,t-i),e}))}return e}))}catch(o){return Object(s.s)(o)}}},{key:"_fetchAndRefineFeatures",value:function(e,t,r){return null}},{key:"_prepareFetchAndRefineSet",value:function(e){for(var t=[],r=0;r<e.length;r++)this._isPhysicalFeature(e[r])&&t.push(e[r]);return t}},{key:"_isPhysicalFeature",value:function(e){return null===this._parent||this._parent._isPhysicalFeature(e)}},{key:"_refineKnowns",value:function(e,t){var r=0,n=null,a=[];t=this._maxQueryRate();for(var i=0;i<e._candidates.length&&"GETPAGES"!==e._candidates[i];i++){var s=!1,o=this._candidateIdTransform(e._candidates[i]);o!==e._candidates[i]&&(s=!0);var u=this._isInFeatureSet(o);if(u===l.b.InFeatureSet)!0===s?e._known.indexOf(o)<0&&(e._known.push(o),r+=1):(e._known.push(e._candidates[i]),r+=1),null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i});else if(u===l.b.NotInFeatureSet)null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),r+=1;else if(u===l.b.Unknown&&(r+=1,!0===e._ordered))break;if(r>=t)break}null!==n&&a.push(n);for(var c=a.length-1;c>=0;c--)e._candidates.splice(a[c].start,a[c].end-a[c].start+1)}},{key:"_refineIfParentKnown",value:function(e,t,r){var n=new u.a([],[],e._ordered,null);return n._candidates=e._candidates.slice(0),this._parent._refineSetBlock(n,t,r)}},{key:"_candidateIdTransform",value:function(e){return this._parent._candidateIdTransform(e)}},{key:"_checkIfNeedToExpandKnownPage",value:function(e,t){if(null===e.pagesDefinition)return!1;for(var r=0,n=e._lastFetchedIndex;n<e._known.length;n++){if("GETPAGES"===e._known[n])return!0;if(void 0===this._featureCache[e._known[n]]&&(r+=1)>=t)break}return!1}},{key:"_checkIfNeedToExpandCandidatePage",value:function(e,t){if(null===e.pagesDefinition)return!1;for(var r=0,n=0;n<e._candidates.length;n++){if("GETPAGES"===e._candidates[n])return!0;if((r+=1)>=t)break}return!1}},{key:"_expandPagedSet",value:function(e,t,r,n,a){return null===this._parent?Object(s.s)(new Error("Parent Paging not implemented")):this._parent._expandPagedSet(e,t,r,n,a)}},{key:"_expandPagedSetFeatureSet",value:function(e,t,r,n,a){var i=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]&&(n=1),0===n&&e._candidates.length>0&&"GETPAGES"===e._candidates[e._candidates.length-1]&&(n=2),0===n?Object(s.t)("finished"):this._getPage(e,n,a).then((function(n){return r+n<t?i._expandPagedSet(e,t,r+n,0,a):"success"}))}},{key:"_getPage",value:function(e,t,r){var n=this,a=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){a.length=a.length-1;for(var i=0,o=0;o<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+o>=e.pagesDefinition.internal.set.length);o++)a[a.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+o],i++;e.pagesDefinition.resultOffset+=i;var u=!1;return!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(u=!0),!1===u&&a.push("GETPAGES"),Object(s.t)(i)}return this._getPhysicalPage(e,t,r).then((function(){return n._getPage(e,t,r)}))}},{key:"_getPhysicalPage",value:function(e,t,r){return null}},{key:"_clonePageDefinition",value:function(e){return null===this._parent?null:this._parent._clonePageDefinition(e)}},{key:"_first",value:function(e){return this.iterator(e).next()}},{key:"first",value:function(e){return this._first(e)}},{key:"calculateStatistic",value:function(e,t,r,n){var a=this;return this._ensureLoaded().then((function(){return a._stat(e,t,"",null,null,r,n).then((function(i){return!1===i.calculated?a._manualStat(e,t,r,n).then((function(e){return e.result})):i.result}))}))}},{key:"_manualStat",value:function(e,t,r,n){switch(e.toLowerCase()){case"count":return Object(d.b)(this,n).then((function(e){return{calculated:!0,result:e}}));case"distinct":return Object(d.d)(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"avg":case"mean":return Object(d.f)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"stdev":return Object(d.h)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"variance":return Object(d.j)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"sum":return Object(d.i)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"min":return Object(d.g)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"max":return Object(d.e)(this,t,n).then((function(e){return{calculated:!0,result:e}}));default:return Object(s.t)({calculated:!0,result:0})}}},{key:"_stat",value:function(e,t,r,n,a,i,s){var o=this;return this._parent._stat(e,t,r,n,a,i,s).then((function(u){return!1===u.calculated?null===a&&""===r&&null===n?o._manualStat(e,t,i,s):{calculated:!1}:u}))}},{key:"_unionAllGeomSelf",value:function(e){var t=this,r=this.iterator(this._defaultTracker(e)),n=[];return Object(s.c)((function(e,a){t._unionShapeInBatches(n,r,e,a)}))}},{key:"_unionAllGeom",value:function(e){var t=this;return Object(s.c)((function(r,n){var a=t.iterator(t._defaultTracker(e));t._unionShapeInBatches([],a,r,n)}))}},{key:"_unionShapeInBatches",value:function(e,t,r,n){var a=this;t.next().then((function(i){try{null!==i&&null!==i.geometry&&e.push(i.geometry),e.length>30||null===i&&e.length>1?Object(f.B)(e).then((function(s){try{null===i?r(s):(e=[s],a._unionShapeInBatches(e,t,r,n))}catch(o){n(o)}}),n):null===i?1===e.length?r(e[0]):r(null):a._unionShapeInBatches(e,t,r,n)}catch(s){n(s)}}),n)}},{key:"iterator",value:function(e){return new o(this,e)}},{key:"intersection",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e._featuresetFunctions.intersection.bind(this)(t,r)}},{key:"difference",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._featuresetFunctions.difference.bind(this)(t,r,n)}},{key:"symmetricDifference",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._featuresetFunctions.symmetricDifference.bind(this)(t,r,n)}},{key:"morphShape",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return e._featuresetFunctions.morphShape.bind(this)(t,r,n,a)}},{key:"morphShapeAndAttributes",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown";return e._featuresetFunctions.morphShapeAndAttributes.bind(this)(t,r,n)}},{key:"union",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e._featuresetFunctions.union.bind(this)(t,r)}},{key:"intersects",value:function(t){return e._featuresetFunctions.intersects.bind(this)(t)}},{key:"envelopeIntersects",value:function(t){return e._featuresetFunctions.envelopeIntersects.bind(this)(t)}},{key:"contains",value:function(t){return e._featuresetFunctions.contains.bind(this)(t)}},{key:"overlaps",value:function(t){return e._featuresetFunctions.overlaps.bind(this)(t)}},{key:"relate",value:function(t,r){return e._featuresetFunctions.relate.bind(this)(t,r)}},{key:"within",value:function(t){return e._featuresetFunctions.within.bind(this)(t)}},{key:"touches",value:function(t){return e._featuresetFunctions.touches.bind(this)(t)}},{key:"top",value:function(t){return e._featuresetFunctions.top.bind(this)(t)}},{key:"crosses",value:function(t){return e._featuresetFunctions.crosses.bind(this)(t)}},{key:"buffer",value:function(t,r,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return e._featuresetFunctions.buffer.bind(this)(t,r,n,a)}},{key:"filter",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e._featuresetFunctions.filter.bind(this)(t,r)}},{key:"orderBy",value:function(t){return e._featuresetFunctions.orderBy.bind(this)(t)}},{key:"dissolve",value:function(t,r){return e._featuresetFunctions.dissolve.bind(this)(t,r)}},{key:"groupby",value:function(t,r){return e._featuresetFunctions.groupby.bind(this)(t,r)}},{key:"reduce",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return Object(s.c)((function(a,i){t._reduceImpl(t.iterator(t._defaultTracker(n)),e,r,0,a,i,0)}))}},{key:"_reduceImpl",value:function(e,t,r,n,a,i,o){var u=this;try{if(++o>1e3)return void setTimeout((function(){o=0,u._reduceImpl(e,t,r,n,a,i,o)}));e.next().then((function(l){try{if(null===l)a(r);else{var c=t(r,l,n,u);Object(s.p)(c)?c.then((function(r){u._reduceImpl(e,t,r,n+1,a,i,o)}),i):u._reduceImpl(e,t,c,n+1,a,i,o)}}catch(d){i(d)}}),i)}catch(l){i(l)}}},{key:"removeField",value:function(t){return e._featuresetFunctions.removeField.bind(this)(t)}},{key:"addField",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e._featuresetFunctions.addField.bind(this)(t,r,n)}},{key:"sumArea",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,n=Object(l.e)(e);return this.reduce((function(e,r){return null===r.geometry?0:t?Object(f.l)(r.geometry,n).then((function(t){return e+t})):Object(f.u)(r.geometry,n).then((function(t){return e+t}))}),0,r)}},{key:"sumLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,n=Object(l.d)(e);return this.reduce((function(e,r){return null===r.geometry?0:t?Object(f.o)(r.geometry,n).then((function(t){return e+t})):Object(f.v)(r.geometry,n).then((function(t){return e+t}))}),0,r)}},{key:"_substituteVars",value:function(e,t){if(null!==t){var r={};for(var n in t)r[n.toLowerCase()]=t[n];e.parameters=r}}},{key:"distinct",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0;return this.load().then((function(){var i=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(i,n),t.calculateStatistic("distinct",i,r,t._defaultTracker(a))}))}},{key:"min",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("min",a,-1,t._defaultTracker(n))}))}},{key:"max",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("max",a,-1,t._defaultTracker(n))}))}},{key:"avg",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("avg",a,-1,t._defaultTracker(n))}))}},{key:"sum",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("sum",a,-1,t._defaultTracker(n))}))}},{key:"stdev",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("stdev",a,-1,t._defaultTracker(n))}))}},{key:"variance",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return this.load().then((function(){var a=p.WhereClause.create(e,t.getFieldsIndex());return t._substituteVars(a,r),t.calculateStatistic("variance",a,-1,t._defaultTracker(n))}))}},{key:"count",value:function(e){var t=this;return this.load().then((function(){return t.calculateStatistic("count",p.WhereClause.create("1",t.getFieldsIndex()),-1,t._defaultTracker(e))}))}},{key:"_defaultTracker",value:function(e){return e||{aborted:!1}}},{key:"forEach",value:function(e,t){var r=this;return Object(s.c)((function(n,a){r._forEachImpl(r.iterator(r._defaultTracker(t)),e,r,n,a,0)}))}},{key:"_forEachImpl",value:function(e,t,r,n,a,i){var o=this;try{if(++i>1e3)return void setTimeout((function(){i=0,o._forEachImpl(e,t,r,n,a,i)}),0);e.next().then((function(u){try{if(null===u)n(r);else{var l=t(u);null==l?o._forEachImpl(e,t,r,n,a,i):Object(s.p)(l)?l.then((function(){try{o._forEachImpl(e,t,r,n,a,i)}catch(u){a(u)}}),a):o._forEachImpl(e,t,r,n,a,i)}}catch(c){a(c)}}),a)}catch(u){a(u)}}},{key:"convertToJSON",value:function(e){for(var t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}},r=0;r<this.fields.length;r++)t.layerDefinition.fields.push(Object(l.h)(this.fields[r]));return this.reduce((function(e,r){var n={geometry:r.geometry&&r.geometry.toJSON(),attributes:{}};for(var a in r.attributes)n.attributes[a]=r.attributes[a];return t.featureSet.features.push(n),1}),0,e).then((function(){return t}))}},{key:"castToText",value:function(){return"object, FeatureSet"}},{key:"queryAttachments",value:function(e,t,r,n,a){return this._parent.queryAttachments(e,t,r,n,a)}},{key:"serviceUrl",value:function(){return this._parent.serviceUrl()}},{key:"subtypes",value:function(){return this.typeIdField?{subtypeField:this.typeIdField,subtypes:this.types?this.types.map((function(e){return{name:e.name,code:e.id}})):[]}:null}},{key:"relationshipMetaData",value:function(){return this._parent.relationshipMetaData()}},{key:"gdbVersion",get:function(){return this._parent?this._parent.gdbVersion:""}},{key:"schema",value:function(){var e,t=[],r=Object(n.a)(this.fields);try{for(r.s();!(e=r.n()).done;){var a=e.value;t.push(Object(l.h)(a))}}catch(i){r.e(i)}finally{r.f()}return{objectIdField:this.objectIdField,globalIdField:this.globalIdField,geometryType:void 0===l.n[this.geometryType]?"":l.n[this.geometryType],fields:t}}},{key:"convertToText",value:function(e,t){var r=this;return"schema"===e?this._ensureLoaded().then((function(){return JSON.stringify(r.schema())})):"featureset"===e?this._ensureLoaded().then((function(){var e=[];return r.reduce((function(t,r){var n={geometry:r.geometry?r.geometry.toJSON():null,attributes:r.attributes};return null!==n.geometry&&n.geometry.spatialReference&&delete n.geometry.spatialReference,e.push(n),1}),0,t).then((function(){var t=r.schema();return t.features=e,t.spatialReference=r.spatialReference.toJSON(),JSON.stringify(t)}))})):Object(s.t)(this.castToText())}},{key:"getFeatureByObjectId",value:function(e,t){return this._parent.getFeatureByObjectId(e,t)}},{key:"getOwningSystemUrl",value:function(){return this._parent.getOwningSystemUrl()}},{key:"getIdentityUser",value:function(){return this._parent.getIdentityUser()}},{key:"getRootFeatureSet",value:function(){return null!==this._parent?this._parent.getRootFeatureSet():this}},{key:"getDataSourceFeatureSet",value:function(){return null!==this._parent?this._parent.getDataSourceFeatureSet():this}}]),e}();b._featuresetFunctions={}},742:function(e,t,r){"use strict";r.d(t,"a",(function(){return x}));var n,a=r(13),i=r(2),s=r(4),o=r(77),u=r(65),l=r(5),c=r(6),d=r(0),p=r(137),f=r(42),h=r(26),y=r(135),b=r(165),v=r(1),m=(r(19),r(14),r(15),r(57)),g=r(10),O=r(43),j=Object(f.b)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),_=j.jsonValues.slice();Object(p.g)(_,"orthometric");var w=Object(f.b)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"}),S=n=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).heightModel="gravity-related-height",n.heightUnit="meters",n.vertCRS=null,n}return Object(s.a)(r,[{key:"writeHeightModel",value:function(e,t,r){return j.write(e,t,r)}},{key:"readHeightModel",value:function(e,t,r){return j.read(e)||(r&&r.messages&&r.messages.push(function(e,t){return new b.a("height-model:unsupported","Height model of value '".concat(e,"' is not supported"),t)}(e,{context:r})),null)}},{key:"readHeightUnit",value:function(e,t,r){return w.read(e)||(r&&r.messages&&r.messages.push(k(e,{context:r})),null)}},{key:"readHeightUnitService",value:function(e,t,r){return Object(y.k)(e)||w.read(e)||(r&&r.messages&&r.messages.push(k(e,{context:r})),null)}},{key:"readVertCRS",value:function(e,t){return t.vertCRS||t.ellipsoid||t.geoid}},{key:"clone",value:function(){return new n({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}},{key:"equals",value:function(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}},{key:"write",value:function(e,t){return t=Object(a.a)({origin:"web-scene"},t),Object(o.a)(Object(u.a)(r.prototype),"write",this).call(this,e,t)}}],[{key:"deriveUnitFromSR",value:function(e,t){var r=Object(y.g)(t);return new n({heightModel:e.heightModel,heightUnit:r,vertCRS:e.vertCRS})}},{key:"fromJSON",value:function(e){if(!e)return null;var t=new n;return t.read(e,{origin:"web-scene"}),t}}]),r}(h.a);function k(e,t){return new b.a("height-unit:unsupported","Height unit of value '".concat(e,"' is not supported"),t)}Object(d.a)([Object(v.b)({type:j.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:_,default:"ellipsoidal"}}}})],S.prototype,"heightModel",void 0),Object(d.a)([Object(O.a)("web-scene","heightModel")],S.prototype,"writeHeightModel",null),Object(d.a)([Object(m.a)(["web-scene","service"],"heightModel")],S.prototype,"readHeightModel",null),Object(d.a)([Object(v.b)({type:w.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:w.jsonValues,write:w.write}}}})],S.prototype,"heightUnit",void 0),Object(d.a)([Object(m.a)("web-scene","heightUnit")],S.prototype,"readHeightUnit",null),Object(d.a)([Object(m.a)("service","heightUnit")],S.prototype,"readHeightUnitService",null),Object(d.a)([Object(v.b)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],S.prototype,"vertCRS",void 0),Object(d.a)([Object(m.a)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],S.prototype,"readVertCRS",null);var x=S=n=Object(d.a)([Object(g.a)("esri.geometry.HeightModelInfo")],S)},744:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var n=r(7),a=r.n(n),i=r(12),s=r(295),o=r(30),u=r(165);function l(e,t,r){return c.apply(this,arguments)}function c(){return c=Object(i.a)(a.a.mark((function e(t,r,n){var i,l,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=t&&t.getAtOrigin&&t.getAtOrigin("renderer",r.origin))||"unique-value"!==i.type||!i.styleOrigin){e.next=6;break}return e.next=4,Object(s.c)(i.populateFromStyle());case 4:l=e.sent,Object(o.v)(n),!1===l.ok&&(c=l.error,r&&r.messages&&r.messages.push(new u.a("renderer:style-reference","Failed to create unique value renderer from style reference: ".concat(c.message),{error:c,context:r})),t.clear("renderer",r.origin));case 6:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}},745:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var n,a=r(2),i=r(4),s=r(5),o=r(6),u=r(0),l=r(52),c=r(26),d=r(1),p=(r(19),r(14),r(15),r(10)),f=n=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).floorField=null,n.viewAllMode=!1,n.viewAllLevelIds=new l.a,n}return Object(i.a)(r,[{key:"clone",value:function(){return new n({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}}]),r}(c.a);Object(u.a)([Object(d.b)({type:String,json:{write:!0}})],f.prototype,"floorField",void 0),Object(u.a)([Object(d.b)({json:{read:!1,write:!1}})],f.prototype,"viewAllMode",void 0),Object(u.a)([Object(d.b)({json:{read:!1,write:!1}})],f.prototype,"viewAllLevelIds",void 0);var h=f=n=Object(u.a)([Object(p.a)("esri.layers.support.LayerFloorInfo")],f)},746:function(e,t,r){"use strict";r.d(t,"a",(function(){return N})),r.d(t,"b",(function(){return C})),r.d(t,"c",(function(){return E})),r.d(t,"d",(function(){return R}));var n,a=r(29),i=r(66),s=r(705),o=r(2),u=r(4),l=r(5),c=r(6),d=r(0),p=r(214),f=r(332),h=r(26),y=r(18),b=r(44),v=r(1),m=(r(14),r(19),r(15),r(10)),g=n=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).statisticType=null,e.onStatisticField=null,e.onStatisticValueExpression=null,e}return Object(u.a)(r,[{key:"clone",value:function(){return new n({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}}]),r}(h.a);Object(d.a)([Object(v.b)({type:String,json:{write:!0}})],g.prototype,"statisticType",void 0),Object(d.a)([Object(v.b)({type:String,json:{write:!0}})],g.prototype,"onStatisticField",void 0),Object(d.a)([Object(v.b)({type:String,json:{write:!0}})],g.prototype,"onStatisticValueExpression",void 0);var O,j=g=n=Object(d.a)([Object(m.a)("esri.layers.support.OutStatistic")],g),_=O=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).name=null,e}return Object(u.a)(r,[{key:"clone",value:function(){return new O({name:this.name,outStatistic:this.outStatistic.clone()})}}]),r}(h.a);Object(d.a)([Object(v.b)({type:String,json:{write:!0}})],_.prototype,"name",void 0),Object(d.a)([Object(v.b)({type:j,json:{write:!0}})],_.prototype,"outStatistic",void 0);var w,S=_=O=Object(d.a)([Object(m.a)("esri.layers.support.AggregateField")],_),k=r(671),x=r(675),F=w=function(e){Object(l.a)(r,e);var t=Object(c.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e)).type="cluster",n.clusterRadius=Object(b.d)("80px"),n.clusterMinSize=Object(b.d)("12px"),n.clusterMaxSize=Object(b.d)("50px"),n.popupEnabled=!0,n.popupTemplate=null,n.symbol=null,n.labelingInfo=null,n.labelsVisible=!0,n.fields=null,n}return Object(u.a)(r,[{key:"clone",value:function(){return new w({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:Object(y.a)(this.labelingInfo),labelsVisible:this.labelsVisible,fields:Object(y.a)(this.fields),popupEnabled:this.popupEnabled,popupTemplate:Object(y.a)(this.popupTemplate)})}}]),r}(h.a);Object(d.a)([Object(v.b)({type:["cluster"],readOnly:!0,json:{write:!0}})],F.prototype,"type",void 0),Object(d.a)([Object(v.b)({type:Number,cast:function(e){return"auto"===e?e:Object(b.d)(e)},json:{write:!0}})],F.prototype,"clusterRadius",void 0),Object(d.a)([Object(v.b)({type:Number,cast:b.d,json:{write:!0}})],F.prototype,"clusterMinSize",void 0),Object(d.a)([Object(v.b)({type:Number,cast:b.d,json:{write:!0}})],F.prototype,"clusterMaxSize",void 0),Object(d.a)([Object(v.b)(k.j)],F.prototype,"popupEnabled",void 0),Object(d.a)([Object(v.b)({type:p.a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],F.prototype,"popupTemplate",void 0),Object(d.a)([Object(v.b)({types:f.f})],F.prototype,"symbol",void 0),Object(d.a)([Object(v.b)({type:[x.a],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],F.prototype,"labelingInfo",void 0),Object(d.a)([Object(v.b)(k.d)],F.prototype,"labelsVisible",void 0),Object(d.a)([Object(v.b)({type:[S],json:{write:!0}})],F.prototype,"fields",void 0);var I=F=w=Object(d.a)([Object(m.a)("esri.layers.support.FeatureReductionCluster")],F),T=r(739),E={key:"type",base:s.a,typeMap:{selection:T.a}};function C(e,t){var r=(t=t.layerDefinition||t).featureReduction;if(r)switch(r.type){case"selection":return T.a.fromJSON(r);case"cluster":return I.fromJSON(r)}return null}function R(e,t,r,n){var s=function(e,t,r){return e?"selection"!==e.type?(r.messages&&r.messages.push(new a.a("featureReduction:unsupported","FeatureReduction of type '".concat(e.declaredClass,"' are not supported in scenes."),{featureReduction:e,context:r})),null):e.write(t,r):null}(e,{},n);s&&Object(i.c)(r,s,t)}var N={types:{key:"type",base:s.a,typeMap:{selection:T.a,cluster:I}},json:{write:{target:"layerDefinition.featureReduction",allowNull:!0}}}},747:function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var n,a=r(2),i=r(4),s=r(5),o=r(6),u=r(0),l=r(26),c=r(18),d=r(1),p=r(14),f=(r(19),r(15),r(10)),h=r(43),y=n=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).attachmentTypes=null,n.attachmentsWhere=null,n.keywords=null,n.globalIds=null,n.name=null,n.num=null,n.objectIds=null,n.returnMetadata=!1,n.size=null,n.start=null,n.where=null,n}return Object(i.a)(r,[{key:"writeStart",value:function(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}},{key:"clone",value:function(){return new n(Object(c.a)({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}}]),r}(l.a);Object(u.a)([Object(d.b)({type:[String],json:{write:!0}})],y.prototype,"attachmentTypes",void 0),Object(u.a)([Object(d.b)({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],y.prototype,"attachmentsWhere",void 0),Object(u.a)([Object(d.b)({type:[String],json:{write:!0}})],y.prototype,"keywords",void 0),Object(u.a)([Object(d.b)({type:[Number],json:{write:!0}})],y.prototype,"globalIds",void 0),Object(u.a)([Object(d.b)({json:{write:!0}})],y.prototype,"name",void 0),Object(u.a)([Object(d.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],y.prototype,"num",void 0),Object(u.a)([Object(d.b)({type:[Number],json:{write:!0}})],y.prototype,"objectIds",void 0),Object(u.a)([Object(d.b)({type:Boolean,json:{default:!1,write:!0}})],y.prototype,"returnMetadata",void 0),Object(u.a)([Object(d.b)({type:[Number],json:{write:!0}})],y.prototype,"size",void 0),Object(u.a)([Object(d.b)({type:Number,json:{read:{source:"resultOffset"}}})],y.prototype,"start",void 0),Object(u.a)([Object(h.a)("start"),Object(h.a)("num")],y.prototype,"writeStart",null),Object(u.a)([Object(d.b)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],y.prototype,"where",void 0),(y=n=Object(u.a)([Object(f.a)("esri.rest.support.AttachmentQuery")],y)).from=Object(p.m)(y);var b=y},751:function(e,t,r){"use strict";r.d(t,"a",(function(){return S})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return v})),r.d(t,"d",(function(){return m})),r.d(t,"e",(function(){return g})),r.d(t,"f",(function(){return _})),r.d(t,"g",(function(){return y}));var n=r(21),a=r(22),i=r(46),s=r(210),o=r(694),u=r(15),l=r(11),c=r(683),d=r(704),p=u.a.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),f=new s.a,h=Math.PI,y=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function b(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"color"===e.type}))[0]:e;if(n)if("esri.renderers.visualVariables.ColorVariable"===n.declaredClass){var a="number"==typeof t,s=a?null:t,o=s&&s.attributes,u=a?t:null,c=n.field,d=n.cache,f=d.ipData,h=d.hasExpression,y=n.cache.compiledFunc;if(!c&&!h){var b=n.stops;return b&&b[0]&&b[0].color}if("number"!=typeof u)if(h){if(!Object(l.j)(r)||!Object(l.j)(r.arcade))return void p.error("Use of arcade expressions requires an arcade context");var v={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},m=r.arcade.arcadeUtils,g=m.getViewInfo(v),O=m.createExecContext(s,g);if(!y){var j=m.createSyntaxTree(n.valueExpression);y=m.createFunction(j),n.cache.compiledFunc=y}u=m.executeFunction(y,O)}else o&&(u=o[c]);var _=n.normalizationField,S=o?parseFloat(o[_]):void 0;if(null!=u&&(!_||a||!isNaN(S)&&0!==S)){isNaN(S)||a||(u/=S);var k=w(u,f);if(k){var x=k[0],F=k[1],I=x===F?n.stops[x].color:i.a.blendColors(n.stops[x].color,n.stops[F].color,k[2],Object(l.j)(r)?r.color:void 0);return new i.a(I)}}}else p.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable")}function v(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"opacity"===e.type}))[0]:e;if(n)if("esri.renderers.visualVariables.OpacityVariable"===n.declaredClass){var a="number"==typeof t,i=a?null:t,s=i&&i.attributes,o=a?t:null,u=n.field,c=n.cache,d=c.ipData,f=c.hasExpression,h=n.cache.compiledFunc;if(!u&&!f){var y=n.stops;return y&&y[0]&&y[0].opacity}if("number"!=typeof o)if(f){if(Object(l.i)(r)||Object(l.i)(r.arcade))return void p.error("Use of arcade expressions requires an arcade context");var b={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},v=r.arcade.arcadeUtils,m=v.getViewInfo(b),g=v.createExecContext(i,m);if(!h){var O=v.createSyntaxTree(n.valueExpression);h=v.createFunction(O),n.cache.compiledFunc=h}o=v.executeFunction(h,g)}else s&&(o=s[u]);var j=n.normalizationField,_=s?parseFloat(s[j]):void 0;if(null!=o&&(!j||a||!isNaN(_)&&0!==_)){isNaN(_)||a||(o/=_);var S=w(o,d);if(S){var k=S[0],x=S[1];if(k===x)return n.stops[k].opacity;var F=n.stops[k].opacity;return F+(n.stops[x].opacity-F)*S[2]}}}else p.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable")}function m(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"rotation"===e.type}))[0]:e;if(n){if("esri.renderers.visualVariables.RotationVariable"===n.declaredClass){var a=n.axis||"heading",i="heading"===a&&"arithmetic"===n.rotationType?90:0,s="heading"===a&&"arithmetic"===n.rotationType?-1:1,o="number"==typeof t?null:t,u=o&&o.attributes,c=n.field,d=n.cache.hasExpression,f=n.cache.compiledFunc,h=0;if(!c&&!d)return h;if(d){if(Object(l.i)(r)||Object(l.i)(r.arcade))return void p.error("Use of arcade expressions requires an arcade context");var y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},b=r.arcade.arcadeUtils,v=b.getViewInfo(y),m=b.createExecContext(o,v);if(!f){var g=b.createSyntaxTree(n.valueExpression);f=b.createFunction(g),n.cache.compiledFunc=f}h=b.executeFunction(f,m)}else u&&(h=u[c]||0);return h="number"!=typeof h||isNaN(h)?null:i+s*h}p.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable")}}function g(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((function(e){return"size"===e.type}))[0]:e;if(n){if("esri.renderers.visualVariables.SizeVariable"===n.declaredClass){var i=function(e,t,r,n,i){switch(t.transformationType){case"additive":return function(e,t,r,n){return e+(O(t.minSize,r,n)||t.minDataValue)}(e,t,r,n);case"constant":return function(e,t,r){var n=e.stops,a=n&&n.length&&n[0].size;return null==a&&(a=e.minSize),O(a,t,r)}(t,r,n);case"clamped-linear":return function(e,t,r,n){var a=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),i=O(t.minSize,r,n),s=O(t.maxSize,r,n),o=Object(l.j)(n)?n.shape:void 0;if(e<=t.minDataValue)return i;if(e>=t.maxDataValue)return s;if("area"===t.scaleBy&&o){var u="circle"===o,c=u?h*Math.pow(i/2,2):i*i,d=c+a*((u?h*Math.pow(s/2,2):s*s)-c);return u?2*Math.sqrt(d/h):Math.sqrt(d)}return i+a*(s-i)}(e,t,r,n);case"proportional":return function(e,t,r,n){var a=Object(l.j)(n)?n.shape:void 0,i=e/t.minDataValue,s=O(t.minSize,r,n),o=O(t.maxSize,r,n);return j("circle"===a?2*Math.sqrt(i*Math.pow(s/2,2)):"square"===a||"diamond"===a||"image"===a?Math.sqrt(i*Math.pow(s,2)):i*s,s,o)}(e,t,r,n);case"stops":return function(e,t,r,n,i){var s=w(e,i),o=Object(a.a)(s,3),u=o[0],l=o[1],c=o[2];if(u===l)return O(t.stops[u].size,r,n);var d=O(t.stops[u].size,r,n);return d+(O(t.stops[l].size,r,n)-d)*c}(e,t,r,n,i);case"real-world-size":return function(e,t,r,n){var a=(Object(l.j)(n)&&n.resolution?n.resolution:1)*c.a[t.valueUnit],i=O(t.minSize,r,n),s=O(t.maxSize,r,n),o=t.valueRepresentation;return j("area"===o?2*Math.sqrt(e/h)/a:"radius"===o||"distance"===o?2*e/a:e/a,i,s)}(e,t,r,n);case"identity":return e;case"unknown":return null}}(function(e,t,r){var n="number"==typeof t,a=n?null:t,i=a&&a.attributes,s=n?t:null,o=e.cache.isScaleDriven,u=e.cache.compiledFunc;if(o){var c=Object(l.j)(r)?r.scale:void 0,f=Object(l.j)(r)?r.view:void 0;s=null==c||"3d"===f?function(e){var t=null,r=null,n=e.stops;return n?(t=n[0].value,r=n[n.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):c}else if(!n)switch(e.inputValueType){case"expression":if(Object(l.i)(r)||Object(l.i)(r.arcade))return void p.error("Use of arcade expressions requires an arcade context");var h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,b=y.getViewInfo(h),v=y.createExecContext(a,b);if(!u){var m=y.createSyntaxTree(e.valueExpression);u=y.createFunction(m),e.cache.compiledFunc=u}s=y.executeFunction(u,v);break;case"field":i&&(s=i[e.field]);break;case"unknown":s=null}if(!Object(d.d)(s))return null;if(n||!e.normalizationField)return s;var g=i?parseFloat(i[e.normalizationField]):null;return Object(d.d)(g)&&0!==g?s/g:null}(n,t,r),n,t,r,n.cache.ipData);return null==i||isNaN(i)?0:i}p.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable")}}function O(e,t,r){return null==e?null:Object(d.c)(e)?g(e,t,r):Object(d.d)(e)?e:null}function j(e,t,r){return Object(d.d)(r)&&e>r?r:Object(d.d)(t)&&e<t?t:e}function _(e,t,r){if(!(e.cache.isScaleDriven&&"3d"===r||t))return null;var n={scale:t,view:r},a=O(e.minSize,f,n),i=O(e.maxSize,f,n);if(null!=a||null!=i){if(a>i){var s=i;i=a,a=s}return{minSize:a,maxSize:i}}}function w(e,t){if(t){var r=0,n=t.length-1;return t.some((function(t,a){return e<t?(n=a,!0):(r=a,!1)})),[r,n,(e-t[r])/(t[n]-t[r])]}}function S(e,t,r){var a,i=["proportional","proportional","proportional"],s=Object(n.a)(e);try{for(s.s();!(a=s.n()).done;){var u=a.value,l=u.useSymbolValue?"symbol-value":g(u,t,r);switch(u.axis){case"width":i[0]=l;break;case"depth":i[1]=l;break;case"height":i[2]=l;break;case"width-and-depth":i[0]=l,i[1]=l;break;case"all":case void 0:case null:i[0]=l,i[1]=l,i[2]=l;break;default:Object(o.a)(u.axis)}}}catch(c){s.e(c)}finally{s.f()}return i}},756:function(e,t,r){"use strict";r.d(t,"a",(function(){return g}));var n,a=r(2),i=r(5),s=r(6),o=r(0),u=r(66),l=r(1),c=(r(19),r(14),r(15),r(10)),d=r(4),p=r(42),f=r(26),h=new p.a({asc:"ascending",desc:"descending"}),y=n=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).field=null,e.valueExpression=null,e.order="ascending",e}return Object(d.a)(r,[{key:"clone",value:function(){return new n({field:this.field,valueExpression:this.valueExpression,order:this.order})}}]),r}(f.a);Object(o.a)([Object(l.b)({type:String,json:{write:!0}})],y.prototype,"field",void 0),Object(o.a)([Object(l.b)({type:String,json:{write:!0}})],y.prototype,"valueExpression",void 0),Object(o.a)([Object(l.b)({type:h.apiValues,json:{read:h.read,write:h.write}})],y.prototype,"order",void 0);var b=y=n=Object(o.a)([Object(c.a)("esri.layers.support.OrderByInfo")],y);function v(e,t,r){if(!e)return null;var n=e.find((function(e){return!!e.field}));if(!n)return null;var a=new b;return a.read(n,r),[a]}function m(e,t,r,n){var a=e.find((function(e){return!!e.field}));a&&Object(u.c)(r,[a.toJSON()],t)}var g=function(e){var t=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).orderBy=null,e}return r}(e);return Object(o.a)([Object(l.b)({type:[b],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:v},write:{target:"layerDefinition.orderBy",writer:m}}})],t.prototype,"orderBy",void 0),t=Object(o.a)([Object(c.a)("esri.layers.mixins.OrderedLayer")],t)}},757:function(e,t,r){"use strict";function n(e){var t={};for(var r in e)if("declaredClass"!==r){var a=e[r];if(null!=a&&"function"!=typeof a)if(Array.isArray(a)){t[r]=[];for(var i=0;i<a.length;i++)t[r][i]=n(a[i])}else"object"==typeof a?a.toJSON&&(t[r]=JSON.stringify(a)):t[r]=a}return t}r.d(t,"a",(function(){return n}))},761:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return w})),r.d(t,"c",(function(){return O})),r.d(t,"d",(function(){return f})),r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return y})),r.d(t,"g",(function(){return l})),r.d(t,"h",(function(){return g})),r.d(t,"i",(function(){return o})),r.d(t,"j",(function(){return u})),r.d(t,"k",(function(){return p}));var n=r(21),a=r(707),i=r(736),s=r(884);function o(e,t){return d(e.parseTree,t,e.parameters)}function u(e,t,r){return d(e,t,r)}function l(e,t,r,n){return i.WhereClause.create(d(e.parseTree,a.a.Standardised,e.parameters,t,r),n)}function c(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"AND";return i.WhereClause.create("(("+o(e,a.a.Standardised)+")"+r+"("+o(t,a.a.Standardised)+"))",e.fieldsIndex)}function d(e,t,r){var a,i,s,o,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;switch(e.type){case"interval":return w(d(e.value,t,r,u,l),e.qualifier,e.op);case"case_expression":var c=" CASE ";"simple"===e.format&&(c+=d(e.operand,t,r,u,l));for(var y=0;y<e.clauses.length;y++)c+=" WHEN "+d(e.clauses[y].operand,t,r,u,l)+" THEN "+d(e.clauses[y].value,t,r,u,l);return null!==e.else&&(c+=" ELSE "+d(e.else,t,r,u,l)),c+=" END ";case"param":var b=r[e.value.toLowerCase()];if("string"==typeof b)return"'"+r[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(b instanceof Date)return f(b,t);if(b instanceof Array){for(var v=[],m=0;m<b.length;m++)"string"==typeof b[m]?v.push("'"+b[m].toString().replace(/'/g,"''")+"'"):b[m]instanceof Date?v.push(f(b[m],t)):v.push(b[m].toString());return v}return b.toString();case"expr_list":i=[];var g,O=Object(n.a)(e.value);try{for(O.s();!(g=O.n()).done;){var j=g.value;i.push(d(j,t,r,u,l))}}catch(S){O.e(S)}finally{O.f()}return i;case"unary_expr":return" ( NOT "+d(e.expr,t,r,u,l)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+d(e.left,t,r,u,l)+" AND "+d(e.right,t,r,u,l)+") ";case"OR":return" ("+d(e.left,t,r,u,l)+" OR "+d(e.right,t,r,u,l)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+d(e.left,t,r,u,l)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+d(e.left,t,r,u,l)+" IS NOT NULL )";case"IN":return a=[],"expr_list"===e.right.type?(a=d(e.right,t,r,u,l)," ("+d(e.left,t,r,u,l)+" IN ("+a.join(",")+")) "):(o=d(e.right,t,r,u,l))instanceof Array?" ("+d(e.left,t,r,u,l)+" IN ("+o.join(",")+")) ":" ("+d(e.left,t,r,u,l)+" IN ("+o+")) ";case"NOT IN":return a=[],"expr_list"===e.right.type?(a=d(e.right,t,r,u,l)," ("+d(e.left,t,r,u,l)+" NOT IN ("+a.join(",")+")) "):(o=d(e.right,t,r,u,l))instanceof Array?" ("+d(e.left,t,r,u,l)+" NOT IN ("+o.join(",")+")) ":" ("+d(e.left,t,r,u,l)+" NOT IN ("+o+")) ";case"BETWEEN":return s=d(e.right,t,r,u,l)," ("+d(e.left,t,r,u,l)+" BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"NOTBETWEEN":return s=d(e.right,t,r,u,l)," ("+d(e.left,t,r,u,l)+" NOT BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"LIKE":return""!==e.escape?" ("+d(e.left,t,r,u,l)+" LIKE "+d(e.right,t,r,u,l)+" ESCAPE '"+e.escape+"') ":" ("+d(e.left,t,r,u,l)+" LIKE "+d(e.right,t,r,u,l)+") ";case"NOT LIKE":return""!==e.escape?" ("+d(e.left,t,r,u,l)+" NOT LIKE "+d(e.right,t,r,u,l)+" ESCAPE '"+e.escape+"') ":" ("+d(e.left,t,r,u,l)+" NOT LIKE "+d(e.right,t,r,u,l)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+d(e.left,t,r,u,l)+" "+e.operator+" "+d(e.right,t,r,u,l)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return f(e.value,t);case"number":return e.value.toString();case"current_time":return h("date"===e.mode,t);case"column_ref":return u&&u.toLowerCase()===e.column.toLowerCase()?"("+l+")":e.column;case"function":var _=d(e.args,t,r,u,l);return p(e.name,_,t)}throw new Error("Unsupported sql syntax "+e.type)}function p(e,t,r){switch(e.toLowerCase().trim()){case"abs":if(1!==t.length)throw new Error("Invalid Parameter for call to ABS");return"abs("+t[0]+")";case"ceiling":case"ceil":if(1!==t.length)throw new Error("Invalid Parameter for call to CEILING");switch(r){case a.a.Standardised:case a.a.StandardisedNoInterval:}return"CEILING("+t[0]+")";case"floor":if(1!==t.length)throw new Error("Invalid Parameter for call to Floor");return"FLOOR("+t[0]+")";case"log":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG");return"LOG("+t[0]+")";case"log10":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG10");return"LOG10("+t[0]+")";case"power":if(2!==t.length)throw new Error("Invalid Parameter for call to POWER");return"POWER("+t[0]+","+t[1]+")";case"round":if(2===t.length)return"ROUND("+t[0]+","+t[1]+")";if(1===t.length)return"ROUND("+t[0]+")";throw new Error("Invalid Parameter for call to ROUND");case"truncate":if(t.length<1||t.length>2)throw new Error("Invalid Parameter for TRUNCATE function");return r===a.a.SqlServer?"ROUND("+t[0]+(1===t.length?"0":","+t[1])+",1)":"TRUNCATE("+t[0]+(1===t.length?")":","+t[1]+")");case"char_length":case"len":if(1!==t.length)throw new Error("Invalid Parameter for CHAR_LENGTH function");switch(r){case a.a.SqlServer:return"LEN("+t[0]+")";case a.a.Oracle:return"LENGTH("+t[0]+")";default:return"CHAR_LENGTH("+t[0]+")"}case"concat":if(t.length<1)throw new Error("Invalid Parameter for CONCAT function");for(var n="CONCAT(",i=0;i<t.length;i++)0!==i&&(n+=","),n+=t[i];return n+=")";case"lower":case"lcase":if(1!==t.length)throw new Error("Invalid Parameter for Lower function");return"LOWER("+t[0]+")";case"upper":case"ucase":if(1!==t.length)throw new Error("Invalid Parameter for Upper function");return"UPPER("+t[0]+")";case"substring":var s="";switch(r){case a.a.Oracle:return s="SUBSTR("+t[0]+","+t[1],3===t.length&&(s+=","+t[2]),s+=")";case a.a.SqlServer:return s=3===t.length?"SUBSTRING("+t[0]+","+t[1]+","+t[2]+")":"SUBSTRING("+t[0]+",  "+t[1]+", LEN("+t[0]+") - "+t[1]+")";default:return s="SUBSTRING("+t[0]+" FROM "+t[1],3===t.length&&(s+=" FOR "+t[2]),s+=")"}case"extract":return"EXTRACT("+t[0].replace(/\'/g,"")+" FROM "+t[1]+")"}throw new Error("Function Not Recognised")}function f(e,t){var r=s.DateTime.fromJSDate(e),n=0===r.hour&&0===r.minute&&0===r.second&&0===r.millisecond;switch(t){case a.a.FILEGDB:case a.a.Standardised:case a.a.StandardisedNoInterval:return"date '".concat(n?r.toFormat("yyyy-LL-dd"):r.toFormat("yyyy-LL-dd HH:mm:ss"),"'");case a.a.Oracle:return n?"TO_DATE('".concat(r.toFormat("yyyy-LL-dd"),"','YYYY-MM-DD')"):"TO_DATE('".concat(r.toFormat("yyyy-LL-dd HH:mm:ss"),"','YYYY-MM-DD HH24:MI:SS')");case a.a.SqlServer:return"'".concat(r.toFormat(n?"yyyy-LL-dd":"yyyy-LL-dd HH:mm:ss"),"'");case a.a.PGDB:return"#".concat(r.toFormat(n?"LL-dd-yyyy":"LL-dd-yyyy HH:mm:ss"),"#");case a.a.Postgres:return"TIMESTAMP '".concat(r.toFormat(n?"yyyy-LL-dd":"yyyy-LL-dd HH:mm:ss"),"'");default:return"date '".concat(r.toFormat("yyyy-LL-dd HH:mm:ss"),"'")}}function h(e,t){switch(t){case a.a.FILEGDB:case a.a.Standardised:case a.a.StandardisedNoInterval:case a.a.Oracle:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP";case a.a.SqlServer:return e?"CAST(GETDATE() AS DATE)":"GETDATE()";case a.a.PGDB:case a.a.Postgres:default:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP"}}function y(e,t){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={},s={},o={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",oid:"integer",long:"integer","small-integer":"integer",integer:"integer",single:"double",double:"double",date:"date",string:"string"},u=Object(n.a)(t);try{for(u.s();!(r=u.n()).done;){var l=r.value,c=o[l.type];i[l.name.toLowerCase()]=void 0===c?"":c}}catch(f){u.e(f)}finally{u.f()}for(var d in a){var p=o[a[d]];s[d.toLowerCase()]=void 0===p?"":p}switch(b(i,e.parseTree,e.parameters,s)){case"double":case"double":return"double";case"integer":return"integer";case"date":return"date";case"string":return"string"}return""}function b(e,t,r,a){var i;switch(t.type){case"interval":return"integer";case"case_expression":var s=[];if("simple"===t.format){for(var o=0;o<t.clauses.length;o++)s.push(b(e,t.clauses[o].value,r,a));null!==t.else&&s.push(b(e,t.else,r,a))}else{for(var u=0;u<t.clauses.length;u++)s.push(b(e,t.else,r,a));null!==t.else&&s.push(b(e,t.else,r,a))}return m(s);case"param":var l=a[t.value.toLowerCase()];if(void 0===l&&r){var c=r[t.value.toLowerCase()];if(void 0===c)return"";if(null===c)return"";if("string"==typeof c||c instanceof String)return"string";if("boolean"==typeof c)return"boolean";if(c instanceof Date)return"date";if("number"==typeof c)return c%1==0?"integer":"double"}return void 0===l?"":l;case"expr_list":var d,p=[],f=Object(n.a)(t.value);try{for(f.s();!(d=f.n()).done;){var h=d.value;p.push(b(e,h,r,a))}}catch(g){f.e(g)}finally{f.f()}return p;case"unary_expr":return"boolean";case"binary_expr":switch(t.operator){case"AND":case"OR":case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"IS":case"ISNOT":if("null"!==t.right.type)throw new Error("Unsupported RHS for IS");return"boolean";case"*":case"-":case"+":case"/":return m([b(e,t.left,r,a),b(e,t.right,r,a)]);default:throw new Error("Not Supported Operator "+t.operator)}case"null":return"";case"bool":return"boolean";case"string":return"string";case"number":return null===t.value?"":t.value%1==0?"integer":"double";case"date":case"timestamp":case"current_time":return"date";case"column_ref":var y=e[t.column.toLowerCase()];return void 0===y?"":y;case"function":switch(t.name.toLowerCase()){case"position":case"extract":case"char_length":return"integer";case"round":case"round":return(i=b(e,t.args,r,a))instanceof Array?i.length>0?i[0]:"":i;case"sign":return(i=b(e,t.args,r,a))instanceof Array&&(i=m(i)),"integer"===i||"double"===i?i:"double";case"ceiling":case"floor":case"abs":var v=b(e,t.args,r,a);return v instanceof Array?m(v):v;case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"power":case"truncate":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string"}return""}throw new Error("Unsupported sql syntax "+t.type)}var v={boolean:1,string:2,integer:3,double:4,date:5};function m(e){if(e){var t,r="",a=Object(n.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;""!==i&&(r=""===r||v[r]<v[i]?i:r)}}catch(s){a.e(s)}finally{a.f()}return r}return""}function g(e,t){return j(e.parseTree,t)}function O(e){return"column_ref"===e.parseTree.type}function j(e,t){if(null==e)return!1;switch(e.type){case"when_clause":return j(e.operand,t)||j(e.value,t);case"case_expression":var r,a=Object(n.a)(e.clauses);try{for(a.s();!(r=a.n()).done;){if(j(r.value,t))return!0}}catch(o){a.e(o)}finally{a.f()}return!("simple"!==e.format||!j(e.operand,t))||!(null===e.else||!j(e.else,t));case"param":case"null":case"bool":case"date":case"timestamp":case"string":case"number":return!1;case"expr_list":var i,s=Object(n.a)(e.value);try{for(s.s();!(i=s.n()).done;){if(j(i.value,t))return!0}}catch(o){s.e(o)}finally{s.f()}return!1;case"unary_expr":return j(e.expr,t);case"binary_expr":return j(e.left,t)||j(e.right,t);case"column_ref":return t.toLowerCase()===e.column.toLowerCase();case"function":return j(e.args,t)}return!1}function _(e){var t="";return t+=e.period.toUpperCase()}function w(e,t,r){return"INTERVAL "+r+" "+e+" "+("interval-period"===t.type?_(t):_(t.start)+" TO "+_(t.end))}},766:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(2),a=r(4),i=r(19),s=r(145),o=4294967296,u=Object(i.a)("esri-text-decoder")?new TextDecoder("utf-8"):null,l=Object(i.a)("safari")||Object(i.a)("ios")?6:Object(i.a)("ff")?12:32,c=function(){function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t?t.byteLength:0;Object(n.a)(this,e),this._tag=0,this._dataType=99,this.init(t,r,a,i)}return Object(a.a)(e,[{key:"init",value:function(e,t,r,n){this._data=e,this._dataView=t,this._pos=r,this._end=n}},{key:"clone",value:function(){return new e(this._data,this._dataView,this._pos,this._end)}},{key:"pos",value:function(){return this._pos}},{key:"move",value:function(e){this._pos=e}},{key:"nextTag",value:function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}},{key:"next",value:function(){if(this._pos===this._end)return!1;var e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}},{key:"empty",value:function(){return this._pos>=this._end}},{key:"tag",value:function(){return this._tag}},{key:"getInt32",value:function(){return this._decodeVarint()}},{key:"getInt64",value:function(){return this._decodeVarint()}},{key:"getUInt32",value:function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}},{key:"getUInt64",value:function(){return this._decodeVarint()}},{key:"getSInt32",value:function(){var e=this.getUInt32();return e>>>1^-(1&e)|0}},{key:"getSInt64",value:function(){return this._decodeSVarint()}},{key:"getBool",value:function(){var e=0!==this._data[this._pos];return this._skip(1),e}},{key:"getEnum",value:function(){return this._decodeVarint()}},{key:"getFixed64",value:function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getUint32(t+4,!0)*o;return this._skip(8),r}},{key:"getSFixed64",value:function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getInt32(t+4,!0)*o;return this._skip(8),r}},{key:"getDouble",value:function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}},{key:"getFixed32",value:function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}},{key:"getSFixed32",value:function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}},{key:"getFloat",value:function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}},{key:"getString",value:function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r}},{key:"getBytes",value:function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r}},{key:"getLength",value:function(){return this._getLengthUnsafe()}},{key:"processMessageWithArgs",value:function(e,t,r,n){var a=this.getMessage(),i=e(a,t,r,n);return a.release(),i}},{key:"processMessage",value:function(e){var t=this.getMessage(),r=e(t);return t.release(),r}},{key:"getMessage",value:function(){var t=this._getLength(),r=e.pool.acquire();return r.init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),r}},{key:"release",value:function(){e.pool.release(this)}},{key:"dataType",value:function(){return this._dataType}},{key:"skip",value:function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}}},{key:"skipLen",value:function(e){this._skip(e)}},{key:"_skip",value:function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}},{key:"_decodeVarint",value:function(){var e,t=this._data,r=this._pos,n=0;if(this._end-r>=10)do{if(n|=127&(e=t[r++]),0==(128&e))break;if(n|=(127&(e=t[r++]))<<7,0==(128&e))break;if(n|=(127&(e=t[r++]))<<14,0==(128&e))break;if(n|=(127&(e=t[r++]))<<21,0==(128&e))break;if(n+=268435456*(127&(e=t[r++])),0==(128&e))break;if(n+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(n+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(n+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(n+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(n+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var a=1;r!==this._end&&0!=(128&(e=t[r]));)++r,n+=(127&e)*a,a*=128;if(r===this._end)throw new Error("Varint overrun!");++r,n+=e*a}return this._pos=r,n}},{key:"_decodeSVarint",value:function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2}},{key:"_getLength",value:function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()}},{key:"_getLengthUnsafe",value:function(){return this.getUInt32()}},{key:"_toString",value:function(e,t,r){if((r=Math.min(this._end,r))-t>l&&u){var n=e.subarray(t,r);return u.decode(n)}for(var a="",i="",s=t;s<r;++s){var o=e[s];128&o?i+="%"+o.toString(16):(a+=decodeURIComponent(i)+String.fromCharCode(o),i="")}return i.length&&(a+=decodeURIComponent(i)),a}},{key:"_toBytes",value:function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)}}]),e}();c.pool=new s.a(c,null,(function(e){e._data=null,e._dataView=null}))},769:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return p}));var n=r(21),a=r(2),i=r(4),s=r(135),o=r(53),u=r(731),l=r(773),c=r(681),d=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],p=function(){function e(t){Object(a.a)(this,e),this.options=t,this.geometryTypes=d,this._coordinatePtr=0,this._vertexDimension=0}return Object(i.a)(e,[{key:"createFeatureResult",value:function(){return new l.a}},{key:"prepareFeatures",value:function(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}},{key:"finishFeatureResult",value:function(e){if(e&&e.features&&e.hasZ&&this.options.sourceSpatialReference&&e.spatialReference&&!Object(o.d)(e.spatialReference,this.options.sourceSpatialReference)&&!e.spatialReference.vcsWkid){var t=Object(s.e)(this.options.sourceSpatialReference)/Object(s.e)(e.spatialReference);if(1!==t){var r,a=Object(n.a)(e.features);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(Object(u.c)(i))for(var l=i.geometry.coords,c=2;c<l.length;c+=3)l[c]*=t}}catch(d){a.e(d)}finally{a.f()}}}}},{key:"addFeature",value:function(e,t){e.features.push(t)}},{key:"createFeature",value:function(){return new u.b}},{key:"createSpatialReference",value:function(){return{wkid:0}}},{key:"createGeometry",value:function(){return new c.a}},{key:"addField",value:function(e,t){e.fields.push(t)}},{key:"allocateCoordinates",value:function(e){e.coords.length=e.lengths.reduce((function(e,t){return e+t}),0)*this._vertexDimension,this._coordinatePtr=0}},{key:"addCoordinate",value:function(e,t){e.coords[this._coordinatePtr++]=t}},{key:"addCoordinatePoint",value:function(e,t){e.coords.push(t)}},{key:"addLength",value:function(e,t){e.lengths.push(t)}},{key:"addQueryGeometry",value:function(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}},{key:"createPointGeometry",value:function(){return new c.a}}]),e}()},778:function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return S}));var n=r(29),a=r(11),i=r(766),s=r(681),o=r(769),u=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],l=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],c=["upperLeft","lowerLeft"];function d(e){return e>=u.length?null:u[e]}function p(e){return e>=l.length?null:l[e]}function f(e){return e>=c.length?null:c[e]}function h(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function y(e,t,r){for(var n=t.createPointGeometry(r);e.next();)if(3===e.tag())for(var a=e.getUInt32(),i=e.pos()+a,s=0;e.pos()<i;)t.addCoordinatePoint(n,e.getSInt64(),s++);else e.skip();return n}function b(e,t,r){for(var n=t.createGeometry(r),a=2+(r.hasZ?1:0)+(r.hasM?1:0);e.next();)switch(e.tag()){case 2:for(var i=e.getUInt32(),s=e.pos()+i,o=0;e.pos()<s;)t.addLength(n,e.getUInt32(),o++);break;case 3:var u=e.getUInt32(),l=e.pos()+u,c=0;for(t.allocateCoordinates(n);e.pos()<l;)t.addCoordinate(n,e.getSInt64(),c),++c===a&&(c=0);break;default:e.skip()}return n}function v(e){for(var t=new s.a,r="esriGeometryPoint";e.next();)switch(e.tag()){case 2:for(var n=e.getUInt32(),a=e.pos()+n;e.pos()<a;)t.lengths.push(e.getUInt32());break;case 3:for(var i=e.getUInt32(),u=e.pos()+i;e.pos()<u;)t.coords.push(e.getSInt64());break;case 1:r=o.a[e.getEnum()];break;default:e.skip()}return{queryGeometry:t,queryGeometryType:r}}function m(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function g(e){for(var t={type:d(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=d(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=p(e.getEnum());break;default:e.skip();break;case 6:t.defaultValue=e.getString()}return t}function O(e){for(var t={};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.isSystemMaintained=e.getBool();break;default:e.skip()}return t}function j(e,t,r,n){for(var a=t.createFeature(r),i=0;e.next();)switch(e.tag()){case 1:var s=n[i++].name;a.attributes[s]=e.processMessage(m);break;case 2:a.geometry=e.processMessageWithArgs(b,t,r);break;case 4:a.centroid=e.processMessageWithArgs(y,t,r);break;default:e.skip()}return a}function _(e){for(var t=[1,1,1,1];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function w(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function S(e){for(var t={originPosition:f(0)};e.next();)switch(e.tag()){case 1:t.originPosition=f(e.getEnum());break;case 2:t.scale=e.processMessage(_);break;case 3:t.translate=e.processMessage(w);break;default:e.skip()}return t}function k(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function x(e,t){for(var r=t.createSpatialReference();e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function F(e,t){var r=t.createFeatureResult();r.geometryType=h(t,0);for(var n=!1;e.next();)switch(e.tag()){case 1:r.objectIdFieldName=e.getString();break;case 3:r.globalIdFieldName=e.getString();break;case 4:r.geohashFieldName=e.getString();break;case 5:r.geometryProperties=e.processMessage(k);break;case 7:r.geometryType=h(t,e.getEnum());break;case 8:r.spatialReference=e.processMessageWithArgs(x,t);break;case 10:r.hasZ=e.getBool();break;case 11:r.hasM=e.getBool();break;case 12:r.transform=e.processMessage(S);break;case 9:var a=e.getBool();r.exceededTransferLimit=a;break;case 13:t.addField(r,e.processMessage(g));break;case 15:n||(t.prepareFeatures(r),n=!0),t.addFeature(r,e.processMessageWithArgs(j,t,r,r.fields));break;case 2:r.uniqueIdField=e.processMessage(O);break;default:e.skip()}return t.finishFeatureResult(r),r}function I(e,t){for(var r={},n=null;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(v);break;case 1:r.featureResult=e.processMessageWithArgs(F,t);break;default:e.skip()}return Object(a.j)(n)&&r.featureResult&&t.addQueryGeometry(r,n),r}function T(e,t){try{for(var r=new i.a(new Uint8Array(e),new DataView(e)),a={};r.next();)2===r.tag()?a.queryResult=r.processMessageWithArgs(I,t):r.skip();return a}catch(s){throw new n.a("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:s})}}},782:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(21),a=r(778);function i(e,t){var r=Object(a.a)(e,t),i=r.queryResult.featureResult,s=r.queryResult.queryGeometry,o=r.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){var u,l=i.objectIdFieldName,c=Object(n.a)(i.features);try{for(c.s();!(u=c.n()).done;){var d=u.value;d.attributes&&(d.objectId=d.attributes[l])}}catch(p){c.e(p)}finally{c.f()}}return i&&(i.queryGeometry=s,i.queryGeometryType=o),i}},805:function(e,t,r){"use strict";r.d(t,"a",(function(){return J})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return j})),r.d(t,"d",(function(){return _})),r.d(t,"e",(function(){return g})),r.d(t,"f",(function(){return X})),r.d(t,"g",(function(){return P})),r.d(t,"h",(function(){return I})),r.d(t,"i",(function(){return w})),r.d(t,"j",(function(){return S})),r.d(t,"k",(function(){return $})),r.d(t,"l",(function(){return ie})),r.d(t,"m",(function(){return Q})),r.d(t,"n",(function(){return te})),r.d(t,"o",(function(){return se})),r.d(t,"p",(function(){return M})),r.d(t,"q",(function(){return k})),r.d(t,"r",(function(){return C})),r.d(t,"s",(function(){return B})),r.d(t,"t",(function(){return T})),r.d(t,"u",(function(){return ne})),r.d(t,"v",(function(){return ae})),r.d(t,"w",(function(){return E})),r.d(t,"x",(function(){return K})),r.d(t,"y",(function(){return R})),r.d(t,"z",(function(){return A})),r.d(t,"A",(function(){return x})),r.d(t,"B",(function(){return G})),r.d(t,"C",(function(){return F}));r(13);var n,a=r(7),i=r.n(a),s=r(12),o=(r(114),r(727)),u=(r(48),r(62));function l(e){var t;return Array.isArray(e)?null==(t=e[0])?void 0:t.spatialReference:null==e?void 0:e.spatialReference}function c(e){return e?Array.isArray(e)?e.map(c):e.toJSON?e.toJSON():e:e}function d(e){return Array.isArray(e)?e.map((function(e){return Object(u.a)(e)})):Object(u.a)(e)}function p(e,t){var r;return Array.isArray(e)?r=e:((r=[]).push(e),null!=t&&r.push(t)),r}function f(){return h.apply(this,arguments)}function h(){return(h=Object(s.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n||(n=Object(o.a)("geometryEngineWorker",{strategy:"distributed"})),n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t){return b.apply(this,arguments)}function b(){return(b=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return e.abrupt("return",e.sent.invoke("executeGEOperation",{operation:t,parameters:c(r)}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t){return m.apply(this,arguments)}function m(){return(m=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,y("clip",[l(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t){return O.apply(this,arguments)}function O(){return(O=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,y("cut",[l(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t){return y("contains",[l(e),e,t])}function _(e,t){return y("crosses",[l(e),e,t])}function w(e,t,r){return y("distance",[l(e),e,t,r])}function S(e,t){return y("equals",[l(e),e,t])}function k(e,t){return y("intersects",[l(e),e,t])}function x(e,t){return y("touches",[l(e),e,t])}function F(e,t){return y("within",[l(e),e,t])}function I(e,t){return y("disjoint",[l(e),e,t])}function T(e,t){return y("overlaps",[l(e),e,t])}function E(e,t,r){return y("relate",[l(e),e,t,r])}function C(e){return y("isSimple",[l(e),e])}function R(e){return N.apply(this,arguments)}function N(){return(N=Object(s.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,y("simplify",[l(t),t]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t){return D.apply(this,arguments)}function D(){return(D=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,y("difference",[l(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t){return L.apply(this,arguments)}function L(){return(L=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,y("symmetricDifference",[l(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,t){return q.apply(this,arguments)}function q(){return(q=Object(s.a)(i.a.mark((function e(t,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,y("intersect",[l(t),t,r]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){return V.apply(this,arguments)}function V(){return V=Object(s.a)(i.a.mark((function e(t){var r,n,a=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:null,n=p(t,r),e.t0=d,e.next=5,y("union",[l(n),n]);case 5:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 7:case"end":return e.stop()}}),e)}))),V.apply(this,arguments)}function B(e,t,r,n,a,i){return U.apply(this,arguments)}function U(){return U=Object(s.a)(i.a.mark((function e(t,r,n,a,s,o){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,y("offset",[l(t),t,r,n,a,s,o]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)}))),U.apply(this,arguments)}function J(e,t,r){return W.apply(this,arguments)}function W(){return W=Object(s.a)(i.a.mark((function e(t,r,n){var a,s,o=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]&&o[3],s=[l(t),t,r,n,a],e.t0=d,e.next=5,y("buffer",s);case 5:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 7:case"end":return e.stop()}}),e)}))),W.apply(this,arguments)}function Q(e,t,r,n,a,i){return z.apply(this,arguments)}function z(){return z=Object(s.a)(i.a.mark((function e(t,r,n,a,s,o){var u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=[l(t),t,r,n,a,s,o],e.t0=d,e.next=4,y("geodesicBuffer",u);case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}}),e)}))),z.apply(this,arguments)}function H(e){return"xmin"in e?e.center:"x"in e?e:e.extent.center}function K(e,t,r){return Z.apply(this,arguments)}function Z(){return Z=Object(s.a)(i.a.mark((function e(t,r,n){var a,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}throw new Error("Illegal Argument Exception");case 2:return s=t.spatialReference,n=null!=(a=n)?a:H(t),e.t0=t.constructor,e.next=7,y("rotate",[s,t,r,n]);case 7:return e.t1=e.sent,o=e.t0.fromJSON.call(e.t0,e.t1),e.abrupt("return",(o.spatialReference=s,o));case 10:case"end":return e.stop()}}),e)}))),Z.apply(this,arguments)}function $(e,t,r,n){return Y.apply(this,arguments)}function Y(){return Y=Object(s.a)(i.a.mark((function e(t,r,n,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,y("generalize",[l(t),t,r,n,a]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)}))),Y.apply(this,arguments)}function X(e,t,r){return ee.apply(this,arguments)}function ee(){return(ee=Object(s.a)(i.a.mark((function e(t,r,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=d,e.next=3,y("densify",[l(t),t,r,n]);case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e,t,r){return re.apply(this,arguments)}function re(){return re=Object(s.a)(i.a.mark((function e(t,r,n){var a,s=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>3&&void 0!==s[3]?s[3]:0,e.t0=d,e.next=4,y("geodesicDensify",[l(t),t,r,n,a]);case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}}),e)}))),re.apply(this,arguments)}function ne(e,t){return y("planarArea",[l(e),e,t])}function ae(e,t){return y("planarLength",[l(e),e,t])}function ie(e,t,r){return y("geodesicArea",[l(e),e,t,r])}function se(e,t,r){return y("geodesicLength",[l(e),e,t,r])}},818:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return O})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return w})),r.d(t,"e",(function(){return y})),r.d(t,"f",(function(){return b})),r.d(t,"g",(function(){return h})),r.d(t,"h",(function(){return m})),r.d(t,"i",(function(){return g})),r.d(t,"j",(function(){return v}));var n=r(737),a=r(707),i=r(761),s=r(30);function o(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function u(e){for(var t=o(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/e.length}function l(e){for(var t=o(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/(e.length-1)}function c(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function d(e,t){for(var r=[],n={},i=[],s=0;s<e.length;s++){if(void 0!==e[s]&&null!==e[s]){var o=e[s];if(Object(a.j)(o)||Object(a.k)(o))void 0===n[o]&&(r.push(o),n[o]=1);else{for(var u=!1,l=0;l<i.length;l++)!0===Object(a.g)(i[l],o)&&(u=!0);!1===u&&(i.push(o),r.push(o))}}if(r.length>=t&&-1!==t)return r}return r}function p(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""}function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;switch(e.toLowerCase()){case"distinct":return d(t,r);case"avg":case"mean":return o(t);case"min":return Math.min.apply(Math,t);case"sum":return c(t);case"max":return Math.max.apply(Math,t);case"stdev":case"stddev":return Math.sqrt(u(t));case"var":case"variance":return u(t);case"count":return t.length}return 0}function h(e,t,r){return j(e,t,r,!0).then((function(e){return 0===e.length?null:Math.min.apply(Math,e)}))}function y(e,t,r){return j(e,t,r,!0).then((function(e){return 0===e.length?null:Math.max.apply(Math,e)}))}function b(e,t,r){var n="";return!1===Object(i.c)(t)&&(n=Object(i.f)(t,e.fields,null)),j(e,t,r,!0).then((function(e){if(0===e.length)return null;var t=o(e);return null===t?t:"integer"===n?function(e){return e=+e,isFinite(e)?e-e%1||(e<0?-0:0===e?e:0):e}(t):t}))}function v(e,t,r){return j(e,t,r,!0).then((function(e){return 0===e.length?null:l(e)}))}function m(e,t,r){return j(e,t,r,!0).then((function(e){return 0===e.length?null:Math.sqrt(l(e))}))}function g(e,t,r){return j(e,t,r,!0).then((function(e){return 0===e.length?null:c(e)}))}function O(e,t){try{return e.iterator(t).count()}catch(r){return Object(s.s)(r)}}function j(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{var a=e.iterator(r);return Object(s.c)((function(e,r){_(a,[],t,n,e,r)}))}catch(i){return Object(s.s)(i)}}function _(e,t,r,a,i,s){Object(n.q)(e.next().then((function(n){try{if(null!==n){var o=r.calculateValue(n);return null===o?!1===a&&(t[t.length]=o):t[t.length]=o,_(e,t,r,a,i,s)}i(t)}catch(u){s(u)}}),s))}function w(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return S(e,t,r,n)}function S(e,t,r,n){try{return k(e.iterator(n),{},[],t,r)}catch(a){return Object(s.s)(a)}}function k(e,t,r,n,a){return e.next().then((function(i){if(null!==i){var s=n.calculateValue(i);return null!=s&&void 0===t[s]&&(r.push(s),t[s]=1),r.length>=a&&-1!==a?r:k(e,t,r,n,a)}return r}))}},841:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(2),a=r(4),i=function(){function e(){Object(n.a)(this,e),this._databaseTypeMetaData={},this._layerInfo={}}return Object(a.a)(e,[{key:"clearDatabaseType",value:function(e){void 0===this._databaseTypeMetaData[e]&&delete this._databaseTypeMetaData[e]}},{key:"getDatabaseType",value:function(e){return"MUSTBESET"===e||void 0===this._databaseTypeMetaData[e]?null:this._databaseTypeMetaData[e]}},{key:"setDatabaseType",value:function(e,t){this._databaseTypeMetaData[e]=t}},{key:"getLayerInfo",value:function(e){return void 0===this._layerInfo[e]?null:this._layerInfo[e]}},{key:"setLayerInfo",value:function(e,t){this._layerInfo[e]=t}},{key:"clearLayerInfo",value:function(e){void 0!==this._layerInfo[e]&&delete this._layerInfo[e]}}]),e}();i.applicationCache=null},842:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return n}));var n={Base64:0,Hex:1,String:2,Raw:3};function a(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function i(e){for(var t=[],r=0,n=8*e.length;r<n;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function s(e){for(var t=[],r=0,n=32*e.length;r<n;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}function o(e){for(var t="0123456789abcdef",r=[],n=0,a=4*e.length;n<a;n++)r.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return r.join("")}function u(e){for(var t=[],r=0,n=4*e.length;r<n;r+=3)for(var a=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255,i=0;i<4;i++)8*r+6*i>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>6*(3-i)&63));return t.join("")}function l(e,t,r,n,i,s){return a(function(e,t){return e<<t|e>>>32-t}(a(a(t,e),a(n,s)),i),r)}function c(e,t,r,n,a,i,s){return l(t&r|~t&n,e,t,a,i,s)}function d(e,t,r,n,a,i,s){return l(t&n|r&~n,e,t,a,i,s)}function p(e,t,r,n,a,i,s){return l(t^r^n,e,t,a,i,s)}function f(e,t,r,n,a,i,s){return l(r^(t|~n),e,t,a,i,s)}function h(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,n=-271733879,i=-1732584194,s=271733878,o=0;o<e.length;o+=16){var u=r,l=n,h=i,y=s;r=c(r,n,i,s,e[o+0],7,-680876936),s=c(s,r,n,i,e[o+1],12,-389564586),i=c(i,s,r,n,e[o+2],17,606105819),n=c(n,i,s,r,e[o+3],22,-1044525330),r=c(r,n,i,s,e[o+4],7,-176418897),s=c(s,r,n,i,e[o+5],12,1200080426),i=c(i,s,r,n,e[o+6],17,-1473231341),n=c(n,i,s,r,e[o+7],22,-45705983),r=c(r,n,i,s,e[o+8],7,1770035416),s=c(s,r,n,i,e[o+9],12,-1958414417),i=c(i,s,r,n,e[o+10],17,-42063),n=c(n,i,s,r,e[o+11],22,-1990404162),r=c(r,n,i,s,e[o+12],7,1804603682),s=c(s,r,n,i,e[o+13],12,-40341101),i=c(i,s,r,n,e[o+14],17,-1502002290),r=d(r,n=c(n,i,s,r,e[o+15],22,1236535329),i,s,e[o+1],5,-165796510),s=d(s,r,n,i,e[o+6],9,-1069501632),i=d(i,s,r,n,e[o+11],14,643717713),n=d(n,i,s,r,e[o+0],20,-373897302),r=d(r,n,i,s,e[o+5],5,-701558691),s=d(s,r,n,i,e[o+10],9,38016083),i=d(i,s,r,n,e[o+15],14,-660478335),n=d(n,i,s,r,e[o+4],20,-405537848),r=d(r,n,i,s,e[o+9],5,568446438),s=d(s,r,n,i,e[o+14],9,-1019803690),i=d(i,s,r,n,e[o+3],14,-187363961),n=d(n,i,s,r,e[o+8],20,1163531501),r=d(r,n,i,s,e[o+13],5,-1444681467),s=d(s,r,n,i,e[o+2],9,-51403784),i=d(i,s,r,n,e[o+7],14,1735328473),r=p(r,n=d(n,i,s,r,e[o+12],20,-1926607734),i,s,e[o+5],4,-378558),s=p(s,r,n,i,e[o+8],11,-2022574463),i=p(i,s,r,n,e[o+11],16,1839030562),n=p(n,i,s,r,e[o+14],23,-35309556),r=p(r,n,i,s,e[o+1],4,-1530992060),s=p(s,r,n,i,e[o+4],11,1272893353),i=p(i,s,r,n,e[o+7],16,-155497632),n=p(n,i,s,r,e[o+10],23,-1094730640),r=p(r,n,i,s,e[o+13],4,681279174),s=p(s,r,n,i,e[o+0],11,-358537222),i=p(i,s,r,n,e[o+3],16,-722521979),n=p(n,i,s,r,e[o+6],23,76029189),r=p(r,n,i,s,e[o+9],4,-640364487),s=p(s,r,n,i,e[o+12],11,-421815835),i=p(i,s,r,n,e[o+15],16,530742520),r=f(r,n=p(n,i,s,r,e[o+2],23,-995338651),i,s,e[o+0],6,-198630844),s=f(s,r,n,i,e[o+7],10,1126891415),i=f(i,s,r,n,e[o+14],15,-1416354905),n=f(n,i,s,r,e[o+5],21,-57434055),r=f(r,n,i,s,e[o+12],6,1700485571),s=f(s,r,n,i,e[o+3],10,-1894986606),i=f(i,s,r,n,e[o+10],15,-1051523),n=f(n,i,s,r,e[o+1],21,-2054922799),r=f(r,n,i,s,e[o+8],6,1873313359),s=f(s,r,n,i,e[o+15],10,-30611744),i=f(i,s,r,n,e[o+6],15,-1560198380),n=f(n,i,s,r,e[o+13],21,1309151649),r=f(r,n,i,s,e[o+4],6,-145523070),s=f(s,r,n,i,e[o+11],10,-1120210379),i=f(i,s,r,n,e[o+2],15,718787259),n=f(n,i,s,r,e[o+9],21,-343485551),r=a(r,u),n=a(n,l),i=a(i,h),s=a(s,y)}return[r,n,i,s]}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Hex,r=t||n.Base64,a=h(i(e),8*e.length);switch(r){case n.Raw:return a;case n.Hex:return o(a);case n.String:return s(a);case n.Base64:return u(a)}}},843:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n=r(2),a=r(4),i=r(5),s=r(6),o=r(741),u=r(734),l=r(707),c=r(30),d=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).declaredClass="esri.layers.featureset.sources.Empty",a._maxProcessing=1e3,a._wset=new u.a([],[],!1,null),a._parent=e.parentfeatureset,a._databaseType=l.a.Standardised,a}return Object(a.a)(r,[{key:"_getSet",value:function(){return Object(c.t)(this._wset)}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"_isInFeatureSet",value:function(){return l.b.NotInFeatureSet}},{key:"_getFeature",value:function(){return Object(c.s)(new Error("No Feature Found in EmptySet"))}},{key:"queryAttachments",value:function(){return Object(c.t)([])}},{key:"_getFeatures",value:function(){return Object(c.t)("success")}},{key:"_featureFromCache",value:function(){return null}},{key:"_fetchAndRefineFeatures",value:function(){return Object(c.s)(new Error("Fetch and Refine should not be called in this featureset"))}},{key:"_getFilteredSet",value:function(){return Object(c.t)(new u.a([],[],!1,null))}},{key:"_stat",value:function(e,t,r,n,a,i,s){return this._manualStat(e,t,i,s)}},{key:"_canDoAggregates",value:function(){return Object(c.t)(!1)}}]),r}(o.a)},847:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(7),a=r.n(n),i=r(13),s=r(12),o=r(80),u=r(722),l=r(670);function c(e,t,r){return d.apply(this,arguments)}function d(){return d=Object(s.a)(a.a.mark((function e(t,r,n){var s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=Object(o.c)(t),e.abrupt("return",Object(u.executeQueryForCount)(s,l.a.from(r),Object(i.a)({},n)).then((function(e){return e.data.count})));case 2:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}},848:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(7),a=r.n(n),i=r(13),s=r(12),o=r(80),u=r(722),l=r(670);function c(e,t,r){return d.apply(this,arguments)}function d(){return d=Object(s.a)(a.a.mark((function e(t,r,n){var s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=Object(o.c)(t),e.abrupt("return",Object(u.executeQueryForIds)(s,l.a.from(r),Object(i.a)({},n)).then((function(e){return e.data.objectIds})));case 2:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}},849:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return f}));var n=r(13),a=r(7),i=r.n(a),s=r(12),o=r(80),u=r(722),l=r(668),c=r(670);function d(e,t,r){return p.apply(this,arguments)}function p(){return p=Object(s.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t,r,n);case 2:return a=e.sent,e.abrupt("return",l.default.fromJSON(a));case 4:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}function f(e,t,r){return h.apply(this,arguments)}function h(){return h=Object(s.a)(i.a.mark((function e(t,r,a){var s,l,d,p,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=Object(o.c)(t),l=Object(n.a)({},a),d=c.a.from(r),e.next=5,Object(u.executeQuery)(s,d,d.sourceSpatialReference,l);case 5:return p=e.sent,f=p.data,e.abrupt("return",f);case 8:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}},852:function(e,t,r){"use strict";r.d(t,"a",(function(){return y}));var n,a=r(2),i=r(4),s=r(5),o=r(6),u=r(0),l=r(26),c=r(1),d=(r(19),r(14)),p=(r(15),r(10));var f={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}},h=n=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).contentType=null,n.exifInfo=null,n.id=null,n.globalId=null,n.keywords=null,n.name=null,n.parentGlobalId=null,n.parentObjectId=null,n.size=null,n.url=null,n}return Object(i.a)(r,[{key:"orientationInfo",get:function(){var e=function(e){var t=e.exifInfo,r=e.exifName,n=e.tagName;if(!t||!r||!n)return null;var a=t.find((function(e){return e.name===r}));return a?function(e){var t=e.tagName,r=e.tags;if(!r||!t)return null;var n=r.find((function(e){return e.name===t}));return n&&n.value||null}({tagName:n,tags:a.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:this.exifInfo});return f[e]||null}},{key:"clone",value:function(){return new n({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}}]),r}(l.a);Object(u.a)([Object(c.b)({type:String})],h.prototype,"contentType",void 0),Object(u.a)([Object(c.b)()],h.prototype,"exifInfo",void 0),Object(u.a)([Object(c.b)({readOnly:!0})],h.prototype,"orientationInfo",null),Object(u.a)([Object(c.b)({type:d.a})],h.prototype,"id",void 0),Object(u.a)([Object(c.b)({type:String})],h.prototype,"globalId",void 0),Object(u.a)([Object(c.b)({type:String})],h.prototype,"keywords",void 0),Object(u.a)([Object(c.b)({type:String})],h.prototype,"name",void 0),Object(u.a)([Object(c.b)({json:{read:!1}})],h.prototype,"parentGlobalId",void 0),Object(u.a)([Object(c.b)({json:{read:!1}})],h.prototype,"parentObjectId",void 0),Object(u.a)([Object(c.b)({type:d.a})],h.prototype,"size",void 0),Object(u.a)([Object(c.b)({json:{read:!1}})],h.prototype,"url",void 0);var y=h=n=Object(u.a)([Object(p.a)("esri.layers.support.AttachmentInfo")],h)},859:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var n=r(2),a=r(4),i=r(5),s=r(6),o=r(741),u=r(734),l=r(707),c=r(761),d=r(30),p=r(736),f=r(45),h=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e)).declaredClass="esri.arcade.featureset.actions.AttributeFilter",a._maxProcessing=1e3,a._parent=e.parentfeatureset,e.whereclause instanceof p.WhereClause?(a._whereclause=e.whereclause,a._whereClauseFunction=null):(a._whereClauseFunction=e.whereclause,a._whereclause=null),a}return Object(a.a)(r,[{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new f.a({wkid:4326}),this.geometryType=l.m.point)}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getFilteredSet("",null,t._whereclause,null,e)})).then((function(r){return t._checkCancelled(e),null!==t._whereClauseFunction?t._wset=new u.a(r._candidates.slice(0).concat(r._known.slice(0)),[],r._ordered,t._clonePageDefinition(r.pagesDefinition)):t._wset=new u.a(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset})):Object(d.t)(this._wset)}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);return t===l.b.NotInFeatureSet?t:void 0===(t=this._idstates[e])?l.b.Unknown:t}},{key:"_getFeature",value:function(e,t,r){return this._parent._getFeature(e,t,r)}},{key:"_getFeatures",value:function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}},{key:"_featureFromCache",value:function(e){return this._parent._featureFromCache(e)}},{key:"executeWhereClause",value:function(e){return this._whereclause.testFeature(e)}},{key:"executeWhereClauseDeferred",value:function(e){if(null!==this._whereClauseFunction)try{var t=this._whereClauseFunction(e);return Object(d.p)(t)?t:Object(d.t)(t)}catch(r){return Object(d.s)(r)}return Object(d.t)(this.executeWhereClause(e))}},{key:"_fetchAndRefineFeatures",value:function(e,t,r){var n=this,a=new u.a([],e,!1,null),i=Math.min(t,e.length);return this._parent._getFeatures(a,-1,i,r).then((function(){if(n._checkCancelled(r),null==n._whereClauseFunction){for(var a=0;a<i;a++){var s=n._parent._featureFromCache(e[a]);!0===n.executeWhereClause(s)?n._idstates[e[a]]=l.b.InFeatureSet:n._idstates[e[a]]=l.b.NotInFeatureSet}return"success"}for(var o=[],u=0;u<i;u++){var c=n._parent._featureFromCache(e[u]);o.push(n.executeWhereClauseDeferred(c))}return Object(d.b)(o).then((function(r){for(var a=0;a<t;a++)!0===r[a]?n._idstates[e[a]]=l.b.InFeatureSet:n._idstates[e[a]]=l.b.NotInFeatureSet;return"success"}))}))}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return null!==this._whereClauseFunction||(null!==r?null!==this._whereclause&&(r=Object(c.a)(this._whereclause,r)):r=this._whereclause),this._ensureLoaded().then((function(){return i._parent._getFilteredSet(e,t,r,n,a)})).then((function(e){return i._checkCancelled(a),null!==i._whereClauseFunction?new u.a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,i._clonePageDefinition(e.pagesDefinition)):new u.a(e._candidates.slice(0),e._known.slice(0),e._ordered,i._clonePageDefinition(e.pagesDefinition))}))}},{key:"_stat",value:function(e,t,r,n,a,i,s){var o=this;if(null!==this._whereClauseFunction)return null===a&&""===r&&null===n?this._manualStat(e,t,i,s):Object(d.t)({calculated:!1});var u=this._whereclause;return null!==a&&null!==this._whereclause&&(u=Object(c.a)(this._whereclause,a)),this._parent._stat(e,t,r,n,u,i,s).then((function(u){return!1===u.calculated?null===a&&""===r&&null===n?o._manualStat(e,t,i,s):{calculated:!1}:u}))}},{key:"_canDoAggregates",value:function(e,t,r,n,a){return null!==this._whereClauseFunction?Object(d.t)(!1):(null!==a?null!==this._whereclause&&(a=Object(c.a)(this._whereclause,a)):a=this._whereclause,null===this._parent?Object(d.t)(!1):this._parent._canDoAggregates(e,t,r,n,a))}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,s){return null===this._parent?Object(d.s)(new Error("Should never be called")):(null!==a?null!==this._whereclause&&(a=Object(c.a)(this._whereclause,a)):a=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,a,i,s))}}],[{key:"registerAction",value:function(){o.a._featuresetFunctions.filter=function(e){if("function"==typeof e)return new r({parentfeatureset:this,whereclause:e});var t=null;return e instanceof p.WhereClause&&(t=e),new r({parentfeatureset:this,whereclause:t})}}}]),r}(o.a)},860:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r(21),a=r(2),i=r(4),s=r(5),o=r(6),u=r(737),l=r(741),c=r(734),d=r(861),p=r(30),f=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e))._orderbyclause=null,n.declaredClass="esri.arcade.featureset.actions.OrderBy",n._maxProcessing=100,n._orderbyclause=e.orderbyclause,n._parent=e.parentfeatureset,n}return Object(i.a)(r,[{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,t._orderbyclause,e)})).then((function(r){return t._checkCancelled(e),t._wset=r,t._wset})):Object(p.t)(this._wset)}},{key:"manualOrderSet",value:function(e,t){var r=this;return this.getIdColumnDictionary(e,[],-1,t).then((function(e){r._orderbyclause.order(e);for(var t=new c.a([],[],!0,null),n=0;n<e.length;n++)t._known.push(e[n].id);return t}))}},{key:"getIdColumnDictionary",value:function(e,t,r,a){var i=this;if(r<e._known.length-1){var s=this._maxQueryRate();if("GETPAGES"===e._known[r+1])return Object(u.q)(this._parent._expandPagedSet(e,s,0,0,a)).then((function(){return i.getIdColumnDictionary(e,t,r,a)}));for(var o=r+1,l=[];o<e._known.length&&"GETPAGES"!==e._known[o];)l.push(e._known[o]),o++;return r+=l.length,Object(u.q)(this._parent._getFeatureBatch(l,a)).then((function(s){i._checkCancelled(a);var o,u=Object(n.a)(s);try{for(u.s();!(o=u.n()).done;){var l=o.value;t.push({id:l.attributes[i.objectIdField],feature:l})}}catch(c){u.e(c)}finally{u.f()}return i.getIdColumnDictionary(e,t,r,a)}))}return e._candidates.length>0?Object(u.q)(this._refineSetBlock(e,this._maxProcessingRate(),a)).then((function(){return i._checkCancelled(a),i.getIdColumnDictionary(e,t,r,a)})):Object(p.t)(t)}},{key:"_isInFeatureSet",value:function(e){return this._parent._isInFeatureSet(e)}},{key:"_getFeatures",value:function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}},{key:"_featureFromCache",value:function(e){if(void 0===this._featureCache[e]){var t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]}},{key:"_fetchAndRefineFeatures",value:function(){return Object(p.s)(new Error("Fetch and Refine should not be called in this featureset"))}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this._ensureLoaded().then((function(){return i._parent._getFilteredSet(e,t,r,null===n?i._orderbyclause:n,a)})).then((function(e){i._checkCancelled(a);var n=new c.a(e._candidates.slice(0),e._known.slice(0),e._ordered,i._clonePageDefinition(e.pagesDefinition)),s=!0;return e._candidates.length>0&&(s=!1),!1===n._ordered?i.manualOrderSet(n,a).then((function(e){return!1===s&&(null===t&&null===r||(e=new c.a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,i._clonePageDefinition(e.pagesDefinition)))),e})):n}))}}],[{key:"registerAction",value:function(){l.a._featuresetFunctions.orderBy=function(e){return""===e?this:new r({parentfeatureset:this,orderbyclause:new d.a(e)})}}}]),r}(l.a)},861:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(21),a=r(2),i=r(4);function s(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}var o=function(){function e(t){Object(a.a)(this,e);var r=t.split(",");this._fields=[],this._directions=[];for(var n=0;n<r.length;n++){var i=r[n].match(/\S+/g);this._fields.push(i[0]),2===i.length?"asc"===i[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}return Object(i.a)(e,[{key:"constructClause",value:function(){for(var e="",t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e}},{key:"order",value:function(e){var t=this;e.sort((function(e,r){for(var n=0;n<t._fields.length;n++){var a,i=t.featureValue(e.feature,t._fields[n],n),o=t.featureValue(r.feature,t._fields[n],n);if(0!==(a=1===t._directions[n]?s(i,o):-1*s(i,o)))return a}return 0}))}},{key:"scanForField",value:function(e){for(var t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1}},{key:"replaceFields",value:function(t){for(var r="",a=0;a<this._fields.length;a++){0!==a&&(r+=",");var i,s=this._fields[a],o=Object(n.a)(t);try{for(o.s();!(i=o.n()).done;){var u=i.value;if(s.toLowerCase()===u.field.toLowerCase()){s=u.newfield;break}}}catch(l){o.e(l)}finally{o.f()}r+=s,1===this._directions[a]?r+=" ASC":r+=" DESC"}return new e(r)}},{key:"featureValue",value:function(e,t,r){var n=e.attributes[t];if(void 0!==n)return n;for(var a in e.attributes)if(t.toLowerCase()===a.toLowerCase())return this._fields[r]=a,e.attributes[a];return null}}]),e}()},862:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return d}));var n=r(13),a=r(21),i=r(83),s=r(82),o=r(27),u=r(852),l=r(757);function c(e){var t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function d(e,t){var r,n={},s=Object(a.a)(e);try{for(s.s();!(r=s.n()).done;){var l,c=r.value,d=c.parentObjectId,p=c.parentGlobalId,f=c.attachmentInfos,h=Object(a.a)(f);try{for(h.s();!(l=h.n()).done;){var y=l.value,b=y.id,v=Object(o.b)(Object(i.a)("".concat(t,"/").concat(d,"/attachments/").concat(b))),m=u.a.fromJSON(y);m.set({url:v,parentObjectId:d,parentGlobalId:p}),n[d]?n[d].push(m):n[d]=[m]}}catch(g){h.e(g)}finally{h.f()}}}catch(g){s.e(g)}finally{s.f()}return n}function p(e,t,r){var a={query:Object(l.a)(Object(n.a)(Object(n.a)({},e.query),{},{f:"json"},c(t)))};return r&&(a=Object(n.a)(Object(n.a)(Object(n.a)({},r),a),{},{query:Object(n.a)(Object(n.a)({},r.query),a.query)})),Object(s.default)(e.path+"/queryAttachments",a)}},888:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r(2),a=r(4),i=r(5),s=r(6),o=r(843),u=r(741),l=r(734),c=r(707),d=r(30),p=r(805),f=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._relation="",a._relationGeom=null,a._relationString="",a.declaredClass="esri.arcade.featureset.actions.SpatialFilter",a._relationString=e.relationString,a._parent=e.parentfeatureset,a._maxProcessing=40,a._relation=e.relation,a._relationGeom=e.relationGeom,a}return Object(a.a)(r,[{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getFilteredSet("esriSpatialRelRelation"!==t._relation?t._relation:t._relation+":"+t._relationString,t._relationGeom,null,null,e)})).then((function(r){return t._checkCancelled(e),t._wset=new l.a(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset})):Object(d.t)(this._wset)}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);return t===c.b.NotInFeatureSet?t:void 0===(t=this._idstates[e])?c.b.Unknown:t}},{key:"_getFeature",value:function(e,t,r){return this._parent._getFeature(e,t,r)}},{key:"_getFeatures",value:function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}},{key:"_featureFromCache",value:function(e){return this._parent._featureFromCache(e)}},{key:"executeSpatialRelationTest",value:function(e){if(null===e.geometry)return Object(d.t)(!1);switch(this._relation){case"esriSpatialRelEnvelopeIntersects":var t=Object(c.p)(this._relationGeom),r=Object(c.p)(e.geometry);return Object(p.q)(t,r);case"esriSpatialRelIntersects":return Object(p.q)(this._relationGeom,e.geometry);case"esriSpatialRelContains":return Object(p.c)(this._relationGeom,e.geometry);case"esriSpatialRelOverlaps":return Object(p.t)(this._relationGeom,e.geometry);case"esriSpatialRelWithin":return Object(p.C)(this._relationGeom,e.geometry);case"esriSpatialRelTouches":return Object(p.A)(this._relationGeom,e.geometry);case"esriSpatialRelCrosses":return Object(p.d)(this._relationGeom,e.geometry);case"esriSpatialRelRelation":return Object(p.w)(this._relationGeom,e.geometry,this._relationString)}}},{key:"_fetchAndRefineFeatures",value:function(e,t,r){var n=this,a=new l.a([],e,!1,null),i=Math.min(t,e.length);return this._parent._getFeatures(a,-1,i,r).then((function(){n._checkCancelled(r);for(var t=[],a=0;a<i;a++){var s=n._parent._featureFromCache(e[a]);t.push(n.executeSpatialRelationTest(s))}return Object(d.b)(t)})).then((function(r){for(var a=0;a<t;a++)!0===r[a]?n._idstates[e[a]]=c.b.InFeatureSet:n._idstates[e[a]]=c.b.NotInFeatureSet;return"success"}))}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this._ensureLoaded().then((function(){return i._parent._getFilteredSet("esriSpatialRelRelation"!==i._relation?i._relation:i._relation+":"+i._relationString,i._relationGeom,r,n,a)})).then((function(e){return i._checkCancelled(a),null!==t?new l.a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,i._clonePageDefinition(e.pagesDefinition)):new l.a(e._candidates.slice(0),e._known.slice(0),e._ordered,i._clonePageDefinition(e.pagesDefinition))}))}},{key:"_stat",value:function(e,t,r,n,a,i,s){var o=this;return""!==r?Object(d.t)({calculated:!1}):this._parent._stat(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,i,s).then((function(u){return!1===u.calculated?null===a&&""===r&&null===n?o._manualStat(e,t,i,s):{calculated:!1}:u}))}},{key:"_canDoAggregates",value:function(e,t,r,n,a){return""!==r||null!==n||null===this._parent?Object(d.t)(!1):this._parent._canDoAggregates(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a)}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,s){return null===this._parent?Object(d.s)(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,i,s)}}],[{key:"registerAction",value:function(){u.a._featuresetFunctions.intersects=function(e){return null==e?new o.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:e})},u.a._featuresetFunctions.envelopeIntersects=function(e){return null==e?new o.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:e})},u.a._featuresetFunctions.contains=function(e){return null==e?new o.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:e})},u.a._featuresetFunctions.overlaps=function(e){return null==e?new o.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:e})},u.a._featuresetFunctions.within=function(e){return null==e?new o.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:e})},u.a._featuresetFunctions.touches=function(e){return null==e?new o.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:e})},u.a._featuresetFunctions.crosses=function(e){return null==e?new o.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:e})},u.a._featuresetFunctions.relate=function(e,t){return null==e?new o.a({parentfeatureset:this}):new r({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:e,relationString:t})}}}]),r}(u.a)},908:function(e,t,r){"use strict";r.d(t,"a",(function(){return _e}));var n=r(21),a=r(7),i=r.n(a),s=r(13),o=r(12),u=r(2),l=r(4),c=r(5),d=r(6),p=r(0),f=r(29),h=r(19),y=r(11),b=r(30),v=r(1),m=(r(14),r(15),r(10)),g=r(673),O=r(80),j=r(862),_=r(747);function w(){return(w=Object(o.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(O.c)(t),e.abrupt("return",Object(j.a)(a,_.a.from(r),Object(s.a)({},n)).then((function(e){return Object(j.b)(e.data.attachmentGroups,a.path)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=r(847),k=(r(114),r(722)),x=r(670),F=r(58);function I(){return(I=Object(o.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(O.c)(t),e.abrupt("return",Object(k.executeQueryForExtent)(a,x.a.from(r),Object(s.a)({},n)).then((function(e){return{count:e.data.count,extent:F.a.fromJSON(e.data.extent)}})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=r(848),E=r(849),C=r(694),R=r(680),N=r(702);function P(e,t){return t}function D(e,t,r,n){switch(r){case 0:return q(e,t+n,0);case 1:return"lowerLeft"===e.originPosition?q(e,t+n,1):function(e,t,r){var n=e.translate,a=e.scale;return n[r]-t*a[r]}(e,t+n,1)}}function A(e,t,r,n){return 2===r?q(e,t,2):D(e,t,r,n)}function L(e,t,r,n){return 2===r?q(e,t,3):D(e,t,r,n)}function M(e,t,r,n){return 3===r?q(e,t,3):A(e,t,r,n)}function q(e,t,r){var n=e.translate,a=e.scale;return n[r]+t*a[r]}var G=function(){function e(t){Object(u.a)(this,e),this.options=t,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=P,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}return Object(l.a)(e,[{key:"createFeatureResult",value:function(){return{fields:[],features:[]}}},{key:"finishFeatureResult",value:function(e){if(this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,e.hasZ){var t=Object(N.a)(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(t){var r,a=Object(n.a)(e.features);try{for(a.s();!(r=a.n()).done;){t(r.value.geometry)}}catch(i){a.e(i)}finally{a.f()}}}}},{key:"createSpatialReference",value:function(){return{}}},{key:"addField",value:function(e,t){e.fields.push(t);var r=e.fields.map((function(e){return e.name}));this.AttributesConstructor=function(){var e,t=Object(n.a)(r);try{for(t.s();!(e=t.n()).done;){this[e.value]=null}}catch(a){t.e(a)}finally{t.f()}}}},{key:"addFeature",value:function(e,t){e.features.push(t)}},{key:"prepareFeatures",value:function(e){var t=this;switch(this.transform=e.transform,this.options.applyTransform&&e.transform&&(this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"esriGeometryPoint":this.addCoordinate=function(e,r,n){return t.addCoordinatePoint(e,r,n)},this.createGeometry=function(e){return t.createPointGeometry(e)};break;case"esriGeometryPolygon":this.addCoordinate=function(e,r,n){return t.addCoordinatePolygon(e,r,n)},this.createGeometry=function(e){return t.createPolygonGeometry(e)};break;case"esriGeometryPolyline":this.addCoordinate=function(e,r,n){return t.addCoordinatePolyline(e,r,n)},this.createGeometry=function(e){return t.createPolylineGeometry(e)};break;case"esriGeometryMultipoint":this.addCoordinate=function(e,r,n){return t.addCoordinateMultipoint(e,r,n)},this.createGeometry=function(e){return t.createMultipointGeometry(e)};break;default:Object(C.a)(e.geometryType)}}},{key:"createFeature",value:function(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this.AttributesConstructor}}},{key:"allocateCoordinates",value:function(){}},{key:"addLength",value:function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)}},{key:"addQueryGeometry",value:function(e,t){var r=t.queryGeometry,n=t.queryGeometryType,a=Object(R.w)(r.clone(),r,!1,!1,this.transform),i=Object(R.h)(a,n,!1,!1);e.queryGeometryType=n,e.queryGeometry=Object(s.a)({},i)}},{key:"createPointGeometry",value:function(e){var t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}},{key:"addCoordinatePoint",value:function(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}},{key:"transformPathLikeValue",value:function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)}},{key:"addCoordinatePolyline",value:function(e,t,r){this.dehydratedAddPointsCoordinate(e.paths,t,r)}},{key:"addCoordinatePolygon",value:function(e,t,r){this.dehydratedAddPointsCoordinate(e.rings,t,r)}},{key:"addCoordinateMultipoint",value:function(e,t,r){0===r&&e.points.push([]);var n=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(n)}},{key:"createPolygonGeometry",value:function(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}},{key:"createPolylineGeometry",value:function(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}},{key:"createMultipointGeometry",value:function(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}},{key:"dehydratedAddPointsCoordinate",value:function(e,t,r){0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var n=this.transformPathLikeValue(t,r),a=e[e.length-1];0===r&&(this.coordinateBufferPtr=0,this.coordinateBuffer=new Array(this.vertexDimension),a.push(this.coordinateBuffer)),this.coordinateBuffer[this.coordinateBufferPtr++]=n}},{key:"deriveApplyTransform",value:function(e){var t=e.hasZ,r=e.hasM;return t&&r?M:t?A:r?L:D}}]),e}(),V=r(668);function B(e,t,r){return U.apply(this,arguments)}function U(){return(U=Object(o.a)(i.a.mark((function e(t,r,n){var a,o,u,l,c,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(O.c)(t),o=Object(s.a)({},n),u=x.a.from(r),l=!u.quantizationParameters,e.next=6,Object(k.executeQueryPBF)(a,u,new G({sourceSpatialReference:u.sourceSpatialReference,applyTransform:l}),o);case 6:return c=e.sent,d=c.data,e.abrupt("return",d);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var J=r(82),W=r(757);function Q(e,t){var r=e.toJSON();return r.objectIds&&(r.objectIds=r.objectIds.join(",")),r.orderByFields&&(r.orderByFields=r.orderByFields.join(",")),!r.outFields||null!=t&&t.returnCountOnly?delete r.outFields:-1!==r.outFields.indexOf("*")?r.outFields="*":r.outFields=r.outFields.join(","),r.outSpatialReference&&(r.outSR=r.outSR.wkid||JSON.stringify(r.outSR.toJSON()),delete r.outSpatialReference),r.dynamicDataSource&&(r.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r}function z(e,t,r){return H.apply(this,arguments)}function H(){return(H=Object(o.a)(i.a.mark((function e(t,r,a){var o,u,l,c,d,p,f,h,y,b;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(t,r,a);case 2:o=e.sent,u=o.data,l=u.geometryType,c=u.spatialReference,d={},p=Object(n.a)(u.relatedRecordGroups);try{for(p.s();!(f=p.n()).done;)if(h=f.value,y={fields:void 0,objectIdFieldName:void 0,geometryType:l,spatialReference:c,hasZ:!!u.hasZ,hasM:!!u.hasM,features:h.relatedRecords},null!=h.objectId)d[h.objectId]=y;else for(b in h)h.hasOwnProperty(b)&&"relatedRecords"!==b&&(d[h[b]]=y)}catch(i){p.e(i)}finally{p.f()}return e.abrupt("return",Object(s.a)(Object(s.a)({},o),{},{data:d}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e,t,r){return Z.apply(this,arguments)}function Z(){return(Z=Object(o.a)(i.a.mark((function e(t,r,a){var o,u,l,c,d,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(t,r,a,{returnCountOnly:!0});case 2:o=e.sent,u=o.data,l={},c=Object(n.a)(u.relatedRecordGroups);try{for(c.s();!(d=c.n()).done;)null!=(p=d.value).objectId&&(l[p.objectId]=p.count)}catch(i){c.e(i)}finally{c.f()}return e.abrupt("return",Object(s.a)(Object(s.a)({},o),{},{data:l}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){return Y.apply(this,arguments)}function Y(){return Y=Object(o.a)(i.a.mark((function e(t,r){var n,a,o,u=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>2&&void 0!==u[2]?u[2]:{},a=u.length>3?u[3]:void 0,o=Object(W.a)(Object(s.a)(Object(s.a)(Object(s.a)({},t.query),{},{f:"json"},a),Q(r,a))),e.abrupt("return",Object(J.default)(t.path+"/queryRelatedRecords",Object(s.a)(Object(s.a)({},n),{},{query:Object(s.a)(Object(s.a)({},n.query),o)})));case 4:case"end":return e.stop()}}),e)}))),Y.apply(this,arguments)}var X=r(729);function ee(){return(ee=Object(o.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=X.a.from(r),a=Object(O.c)(t),e.abrupt("return",z(a,r,n).then((function(e){var t=e.data,r={};return Object.keys(t).forEach((function(e){return r[e]=V.default.fromJSON(t[e])})),r})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(){return(te=Object(o.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=X.a.from(r),a=Object(O.c)(t),e.abrupt("return",K(a,r,Object(s.a)({},n)).then((function(e){return e.data})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var re=r(27),ne=r(62),ae=r(696),ie=r(723),se="Layer does not support extent calculation.";function oe(e,t){var r,n,a=e.geometry,i=e.toJSON(),s=i;if(Object(y.j)(a)&&(s.geometry=JSON.stringify(a),s.geometryType=Object(ne.c)(a),s.inSR=a.spatialReference.wkid||JSON.stringify(a.spatialReference)),null!=(r=i.topFilter)&&r.groupByFields&&(s.topFilter.groupByFields=i.topFilter.groupByFields.join(",")),null!=(n=i.topFilter)&&n.orderByFields&&(s.topFilter.orderByFields=i.topFilter.orderByFields.join(",")),i.topFilter&&(s.topFilter=JSON.stringify(s.topFilter)),i.objectIds&&(s.objectIds=i.objectIds.join(",")),i.orderByFields&&(s.orderByFields=i.orderByFields.join(",")),i.outFields&&!(null!=t&&t.returnCountOnly||null!=t&&t.returnExtentOnly||null!=t&&t.returnIdsOnly)?-1!==i.outFields.indexOf("*")?s.outFields="*":s.outFields=i.outFields.join(","):delete s.outFields,i.outSR?s.outSR=i.outSR.wkid||JSON.stringify(i.outSR):a&&i.returnGeometry&&(s.outSR=s.inSR),i.returnGeometry&&delete i.returnGeometry,i.timeExtent){var o=i.timeExtent,u=o.start,l=o.end;null==u&&null==l||(s.time=u===l?u:"".concat(null==u?"null":u,",").concat(null==l?"null":l)),delete i.timeExtent}return s}function ue(e,t,r,n){return le.apply(this,arguments)}function le(){return(le=Object(o.a)(i.a.mark((function e(t,r,n,a){var s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye(t,r,"json",a);case 2:return s=e.sent,e.abrupt("return",(Object(ie.a)(r,n,s.data),s));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e,t,r){return de.apply(this,arguments)}function de(){return(de=Object(o.a)(i.a.mark((function e(t,r,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(y.j)(r.timeExtent)&&r.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):ye(t,r,"json",n,{returnIdsOnly:!0}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e,t,r){return fe.apply(this,arguments)}function fe(){return(fe=Object(o.a)(i.a.mark((function e(t,r,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(y.j)(r.timeExtent)&&r.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):ye(t,r,"json",n,{returnExtentOnly:!0,returnCountOnly:!0}).then((function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(se);if(t.hasOwnProperty("count"))throw new Error(se);return e})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e,t,r){return Object(y.j)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):ye(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function ye(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i="string"==typeof e?Object(re.J)(e):e,o=t.geometry?[t.geometry]:[];return n.responseType="pbf"===r?"array-buffer":"json",Object(ae.a)(o,null,n).then((function(e){var o=e&&e[0];Object(y.j)(o)&&((t=t.clone()).geometry=o);var u=Object(W.a)(Object(s.a)(Object(s.a)(Object(s.a)({},i.query),{},{f:r},a),oe(t,a)));return Object(J.default)(Object(re.y)(i.path,"queryTopFeatures"),Object(s.a)(Object(s.a)({},n),{},{query:Object(s.a)(Object(s.a)({},u),n.query)}))}))}var be=r(720);function ve(){return(ve=Object(o.a)(i.a.mark((function e(t,r,n,a){var o,u,l,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Object(O.c)(t),u=Object(s.a)({},a),e.next=4,ue(o,be.a.from(r),n,u);case 4:return l=e.sent,c=l.data,e.abrupt("return",V.default.fromJSON(c));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(){return(me=Object(o.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(O.c)(t),e.next=3,ce(a,be.a.from(r),Object(s.a)({},n));case 3:return e.abrupt("return",e.sent.data.objectIds);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(){return(ge=Object(o.a)(i.a.mark((function e(t,r,n){var a,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(O.c)(t),e.next=3,pe(a,be.a.from(r),Object(s.a)({},n));case 3:return o=e.sent,e.abrupt("return",{count:o.data.count,extent:F.a.fromJSON(o.data.extent)});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(){return(Oe=Object(o.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(O.c)(t),e.next=3,he(a,be.a.from(r),Object(s.a)({},n));case 3:return e.abrupt("return",e.sent.data.count);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var je=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var r;return Object(u.a)(this,a),(r=t.call(this,e)).dynamicDataSource=null,r.fieldsIndex=null,r.format="json",r.gdbVersion=null,r.infoFor3D=null,r.sourceSpatialReference=null,r}return Object(l.a)(a,[{key:"execute",value:function(e,t){var r=this;return this.executeJSON(e,t).then((function(n){return r.featureSetFromJSON(e,n,t)}))}},{key:"executeJSON",value:function(){var e=Object(o.a)(i.a.mark((function e(t,r){var n,a,o,u,l,c,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Object(s.a)(Object(s.a)({},this.requestOptions),r),o=this._normalizeQuery(t),u=null!=(null==(n=t.outStatistics)?void 0:n[0]),l=Object(h.a)("featurelayer-pbf-statistics"),c=!u||l,"pbf"!==this.format||!c){e.next=13;break}return e.prev=2,e.next=5,B(this.url,o,a);case 5:d=e.sent,e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(2),"query:parsing-pbf"===e.t0.name){e.next=12;break}throw e.t0;case 12:this.format="json";case 13:if(e.t1="json"!==this.format&&c,e.t1){e.next=18;break}return e.next=17,Object(E.b)(this.url,o,a);case 17:d=e.sent;case 18:return this._normalizeFields(d.fields),e.abrupt("return",d);case 20:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"featureSetFromJSON",value:function(){var e=Object(o.a)(i.a.mark((function e(t,n,a){var s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._queryIs3DObjectFormat(t)&&Object(y.j)(this.infoFor3D)&&n.features&&n.features.length){e.next=2;break}return e.abrupt("return",V.default.fromJSON(n));case 2:return e.next=4,Object(b.y)(Promise.all([r.e(4),r.e(12),r.e(20),r.e(74)]).then(r.bind(null,1105)),a);case 4:return s=e.sent,o=s.meshFeatureSetFromJSON,e.abrupt("return",o(t,this.infoFor3D,n));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"executeForCount",value:function(e,t){var r=Object(s.a)(Object(s.a)({},this.requestOptions),t),n=this._normalizeQuery(e);return Object(S.a)(this.url,n,r)}},{key:"executeForExtent",value:function(e,t){var r=Object(s.a)(Object(s.a)({},this.requestOptions),t),n=this._normalizeQuery(e);return function(e,t,r){return I.apply(this,arguments)}(this.url,n,r)}},{key:"executeForIds",value:function(e,t){var r=Object(s.a)(Object(s.a)({},this.requestOptions),t),n=this._normalizeQuery(e);return Object(T.a)(this.url,n,r)}},{key:"executeRelationshipQuery",value:function(e,t){e=X.a.from(e);var r=Object(s.a)(Object(s.a)({},this.requestOptions),t);return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),function(e,t,r){return ee.apply(this,arguments)}(this.url,e,r)}},{key:"executeRelationshipQueryForCount",value:function(e,t){e=X.a.from(e);var r=Object(s.a)(Object(s.a)({},this.requestOptions),t);return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),function(e,t,r){return te.apply(this,arguments)}(this.url,e,r)}},{key:"executeAttachmentQuery",value:function(e,t){var r=Object(s.a)(Object(s.a)({},this.requestOptions),t);return function(e,t,r){return w.apply(this,arguments)}(this.url,e,r)}},{key:"executeTopFeaturesQuery",value:function(e,t){var r=Object(s.a)(Object(s.a)({},this.requestOptions),t);return function(e,t,r,n){return ve.apply(this,arguments)}(this.parsedUrl,e,this.sourceSpatialReference,r)}},{key:"executeForTopIds",value:function(e,t){var r=Object(s.a)(Object(s.a)({},this.requestOptions),t);return function(e,t,r){return me.apply(this,arguments)}(this.parsedUrl,e,r)}},{key:"executeForTopExtents",value:function(e,t){var r=Object(s.a)(Object(s.a)({},this.requestOptions),t);return function(e,t,r){return ge.apply(this,arguments)}(this.parsedUrl,e,r)}},{key:"executeForTopCount",value:function(e,t){var r=Object(s.a)(Object(s.a)({},this.requestOptions),t);return function(e,t,r){return Oe.apply(this,arguments)}(this.parsedUrl,e,r)}},{key:"_normalizeQuery",value:function(e){var t=x.a.from(e);if(t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&((t=t===e?t.clone():t).gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?g.a.from(e.dynamicDataSource):this.dynamicDataSource),Object(y.j)(this.infoFor3D)&&this._queryIs3DObjectFormat(e)){(t=t===e?t.clone():t).formatOf3DObjects=null;var r,a=Object(n.a)(this.infoFor3D.queryFormats);try{for(a.s();!(r=a.n()).done;){var i=r.value;if("3D_glb"===i.id){t.formatOf3DObjects=i.id;break}"3D_gltf"!==i.id||t.formatOf3DObjects||(t.formatOf3DObjects=i.id)}}catch(w){a.e(w)}finally{a.f()}if(!t.formatOf3DObjects)throw new f.a("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(Object(y.i)(t.outFields)||!t.outFields.includes("*")){t=t===e?t.clone():t,Object(y.i)(t.outFields)&&(t.outFields=[]);var s=this.infoFor3D.transformFieldRoles,o=s.originX,u=s.originY,l=s.originZ,c=s.translationX,d=s.translationY,p=s.translationZ,h=s.scaleX,b=s.scaleY,v=s.scaleZ,m=s.rotationX,O=s.rotationY,j=s.rotationZ,_=s.rotationDeg;t.outFields.push(o,u,l,c,d,p,h,b,v,m,O,j,_)}}return t}},{key:"_normalizeFields",value:function(e){if(Object(y.j)(this.fieldsIndex)&&Object(y.j)(e)){var t,r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=this.fieldsIndex.get(a.name);i&&Object.assign(a,i.toJSON())}}catch(s){r.e(s)}finally{r.f()}}}},{key:"_queryIs3DObjectFormat",value:function(e){return Object(y.j)(this.infoFor3D)&&e.returnGeometry&&"xyFootprint"!==e.multipatchOption&&!e.outStatistics}}]),a}(r(340).a);Object(p.a)([Object(v.b)({type:g.a})],je.prototype,"dynamicDataSource",void 0),Object(p.a)([Object(v.b)()],je.prototype,"fieldsIndex",void 0),Object(p.a)([Object(v.b)()],je.prototype,"format",void 0),Object(p.a)([Object(v.b)()],je.prototype,"gdbVersion",void 0),Object(p.a)([Object(v.b)()],je.prototype,"infoFor3D",void 0),Object(p.a)([Object(v.b)()],je.prototype,"sourceSpatialReference",void 0);var _e=je=Object(p.a)([Object(m.a)("esri.tasks.QueryTask")],je)},921:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(2),a=r(4),i=r(30),s=function(){function e(){Object(n.a)(this,e),this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}return Object(a.a)(e,[{key:"add",value:function(e,t,r){this._layerById[t]=r,this._layerByName[e]=r}},{key:"featureSetByName",value:function(e){return void 0===this._layerByName[e]?this.resolvePromise(null):this.resolvePromise(this._layerByName[e])}},{key:"featureSetById",value:function(e){return void 0===this._layerById[e]?this.resolvePromise(null):this.resolvePromise(this._layerById[e])}},{key:"castToText",value:function(){return"object, FeatureSetCollection"}},{key:"resolvePromise",value:function(e){return Object(i.t)(e)}}]),e}()},922:function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return g})),r.d(t,"c",(function(){return m})),r.d(t,"d",(function(){return j})),r.d(t,"e",(function(){return O}));var n=r(21),a=r(5),i=r(6),s=r(2),o=r(4),u=r(210),l=r(886),c=r(741),d=r(734),p=r(707),f=r(761),h=r(30),y=r(736),b=r(45),v=function(){function e(t){Object(s.a)(this,e),this.field=t,this.sqlRewritable=!1}return Object(o.a)(e,[{key:"postInitialization",value:function(e,t){}}]),e}(),m=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e){var n;return Object(s.a)(this,r),(n=t.call(this,e)).sqlRewritable=!0,n}return Object(o.a)(r,[{key:"extractValue",value:function(e){return e.attributes[this.field.name]}},{key:"rewriteSql",value:function(e){return{rewritten:this.sqlRewritable,where:e}}}]),r}(v),g=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e,n,a){var i;return Object(s.a)(this,r),(i=t.call(this,Object(p.c)(e))).originalField=e,i.sqlRewritable=!0,i.field.name=n,i.field.alias=a,i}return Object(o.a)(r,[{key:"rewriteSql",value:function(e,t){return{rewritten:this.sqlRewritable,where:Object(f.g)(e,this.field.name,this.originalField.name,t.getFieldsIndex())}}},{key:"extractValue",value:function(e){return e.attributes[this.originalField.name]}}]),r}(v),O=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e,n,a){var i;for(var o in Object(s.a)(this,r),(i=t.call(this,e)).codefield=n,i.lkp=a,i.reverseLkp={},a)i.reverseLkp[a[o]]=o;return i.sqlRewritable=!0,i}return Object(o.a)(r,[{key:"rewriteSql",value:function(e,t){var n=this.evaluateNodeToWhereClause(e.parseTree,p.a.Standardised,this.field.name,this.codefield instanceof y.WhereClause?Object(f.i)(this.codefield,p.a.Standardised):this.codefield,e.parameters);return n.indexOf(r.BADNESS)>=0?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:y.WhereClause.create(n,t._parent.getFieldsIndex())}}},{key:"evaluateNodeToWhereClause",value:function(e,t){var a,i,s,o,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4?arguments[4]:void 0;switch(e.type){case"interval":return Object(f.b)(this.evaluateNodeToWhereClause(e.value,t,u,l,c),e.qualifier,e.op);case"case_expression":var d=" CASE ";"simple"===e.format&&(d+=this.evaluateNodeToWhereClause(e.operand,t,u,r.BADNESS,c));for(var p=0;p<e.clauses.length;p++)d+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[p].operand,t,u,r.BADNESS,c)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[p].value,t,u,r.BADNESS,c);return null!==e.else&&(d+=" ELSE "+this.evaluateNodeToWhereClause(e.else,t,u,r.BADNESS,c)),d+=" END ";case"param":var h=c[e.value.toLowerCase()];if("string"==typeof h)return"'"+c[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(h instanceof Date)return Object(f.d)(h,t);if(h instanceof Array){for(var y=[],b=0;b<h.length;b++)"string"==typeof h[b]?y.push("'"+h[b].toString().replace(/'/g,"''")+"'"):h[b]instanceof Date?y.push(Object(f.d)(h[b],t)):y.push(h[b].toString());return y}return h.toString();case"expr_list":i=[];var v,m=Object(n.a)(e.value);try{for(m.s();!(v=m.n()).done;){var g=v.value;i.push(this.evaluateNodeToWhereClause(g,t,u,l,c))}}catch(C){m.e(C)}finally{m.f()}return i;case"unary_expr":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,t,u,r.BADNESS,c)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,t,u,l,c)+" AND "+this.evaluateNodeToWhereClause(e.right,t,u,l,c)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,t,u,l,c)+" OR "+this.evaluateNodeToWhereClause(e.right,t,u,l,c)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,u,l,c)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,u,l,c)+" IS NOT NULL )";case"IN":if(a=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){var O,j=[],_=!0,w=Object(n.a)(e.right.value);try{for(w.s();!(O=w.n()).done;){var S=O.value;if("string"!==S.type){_=!1;break}if(void 0===this.lkp[S.value]){_=!1;break}j.push(this.lkp[S.value].toString())}}catch(C){w.e(C)}finally{w.f()}if(_)return" ("+this.evaluateNodeToWhereClause(e.left,t,u,l,c)+" IN ("+j.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,u,l,c)," ("+this.evaluateNodeToWhereClause(e.left,t,u,l,c)+" IN ("+a.join(",")+")) "}return(o=this.evaluateNodeToWhereClause(e.right,t,u,l,c))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,u,l,c)+" IN ("+o.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,u,l,c)+" IN ("+o+")) ";case"NOT IN":if(a=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){var k,x=[],F=!0,I=Object(n.a)(e.right.value);try{for(I.s();!(k=I.n()).done;){var T=k.value;if("string"!==T.type){F=!1;break}if(void 0===this.lkp[T.value]){F=!1;break}x.push(this.lkp[T.value].toString())}}catch(C){I.e(C)}finally{I.f()}if(F)return" ("+this.evaluateNodeToWhereClause(e.left,t,u,l,c)+" NOT IN ("+x.join(",")+")) "}return a=this.evaluateNodeToWhereClause(e.right,t,u,l,c)," ("+this.evaluateNodeToWhereClause(e.left,t,u,l,c)+" NOT IN ("+a.join(",")+")) "}return(o=this.evaluateNodeToWhereClause(e.right,t,u,l,c))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,u,l,c)+" NOT IN ("+o.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,u,l,c)+" NOT IN ("+o+")) ";case"BETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,u,r.BADNESS,c)," ("+this.evaluateNodeToWhereClause(e.left,t,u,r.BADNESS,c)+" BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"NOTBETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,u,r.BADNESS,c)," ("+this.evaluateNodeToWhereClause(e.left,t,u,r.BADNESS,c)+" NOT BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,u,r.BADNESS,c)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,u,r.BADNESS,c)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,u,r.BADNESS,c)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,u,r.BADNESS,c)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,u,r.BADNESS,c)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,u,r.BADNESS,c)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,u,r.BADNESS,c)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,u,r.BADNESS,c)+") ";case"<>":case"=":if("column_ref"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+l+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column_ref"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+l+") ";return" ("+this.evaluateNodeToWhereClause(e.left,t,u,r.BADNESS,c)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,u,r.BADNESS,c)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,t,u,r.BADNESS,c)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,u,r.BADNESS,c)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return Object(f.d)(e.value,t);case"number":return e.value.toString();case"current_time":return Object(f.e)("date"===e.mode,t);case"column_ref":return u&&u.toLowerCase()===e.column.toLowerCase()?"("+l+")":e.column;case"function":var E=this.evaluateNodeToWhereClause(e.args,t,u,r.BADNESS,c);return Object(f.k)(e.name,E,t)}throw new Error("Unsupported sql syntax "+e.type)}},{key:"extractValue",value:function(e){return this.codefield instanceof y.WhereClause?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:this.reverseLkp[e.attributes[this.codefield]]}}]),r}(v);O.BADNESS="_!!!_BAD_LKP_!!!!";var j=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e,n){var a;return Object(s.a)(this,r),(a=t.call(this,e)).sql=n,a}return Object(o.a)(r,[{key:"rewriteSql",value:function(e,t){return{rewritten:!0,where:Object(f.g)(e,this.field.name,Object(f.i)(this.sql,p.a.Standardised),t.getFieldsIndex())}}},{key:"extractValue",value:function(e){return this.sql.calculateValueCompiled(e)}}]),r}(v),_=function(e){Object(a.a)(r,e);var t=Object(i.a)(r);function r(e){var n;return Object(s.a)(this,r),(n=t.call(this,e))._calcFunc=null,n.declaredClass="esri.arcade.featureset.actions.Adapted",n.adaptedFields=null,n._extraFilter=null,n._extraFilter=e.extraFilter,n._parent=e.parentfeatureset,n._maxProcessing=30,n.adaptedFields=e.adaptedFields,n}return Object(o.a)(r,[{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new b.a({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=p.m.point,this.typeIdField="",this.types=null),this.fields=[];var e,t=Object(n.a)(this.adaptedFields);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.postInitialization(this,this._parent),this.fields.push(r.field)}}catch(a){t.e(a)}finally{t.f()}}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._extraFilter?t._getFilteredSet("",null,null,null,e):t._parent._getSet(e)})).then((function(r){return t._checkCancelled(e),t._wset=new d.a(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset})):Object(h.t)(this._wset)}},{key:"_isInFeatureSet",value:function(e){return this._parent._isInFeatureSet(e)}},{key:"_getFeatures",value:function(e,t,r,a){var i=this,s=[];-1!==t&&void 0===this._featureCache[t]&&s.push(t);var o=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,o))return this._expandPagedSet(e,o,0,0,a).then((function(){return i._getFeatures(e,t,r,a)}));for(var c=0,p=e._lastFetchedIndex;p<e._known.length&&(++c<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[p]]&&(e._known[p]!==t&&s.push(e._known[p]),s.length>=o)));p++);if(0===s.length)return Object(h.t)("success");e=new d.a([],s,e._ordered,null);var f=Math.min(s.length,r);return this._parent._getFeatures(e,-1,f,a).then((function(){i._checkCancelled(a);for(var e=[],t=0;t<f;t++){var r=i._parent._featureFromCache(s[t]);void 0!==r&&e.push({geometry:r.geometry,attributes:r.attributes,id:s[t]})}for(var o=0,c=e;o<c.length;o++){var d,p=c[o],h=[],y=Object(n.a)(i.adaptedFields);try{for(y.s();!(d=y.n()).done;){var b=d.value;h[b.field.name]=b.extractValue(p)}}catch(v){y.e(v)}finally{y.f()}i._featureCache[p.id]=new u.a({attributes:h,geometry:Object(l.a)(p.geometry)})}return"success"}))}},{key:"_fetchAndRefineFeatures",value:function(){return Object(h.s)(new Error("Fetch and Refine should not be called in this featureset"))}},{key:"_getFilteredSet",value:function(e,t,r,a,i){var s,o=this,u=this.reformulateWithoutAdaptions(r);s=u.cannot,r=u.where;var l=!1;if(null!==a){l=!0;var c,p=[],h=Object(n.a)(this.adaptedFields);try{for(h.s();!(c=h.n()).done;){var y=c.value;if(!(y instanceof m)&&!0===a.scanForField(y.field.name)){if(!(y instanceof g)){a=null,l=!1;break}p.push({field:y.field.name,newfield:y.originalField.name})}}}catch(b){h.e(b)}finally{h.f()}a&&p.length>0&&(a=a.replaceFields(p))}return null!==r?null!==this._extraFilter&&(r=Object(f.a)(this._extraFilter,r)):r=this._extraFilter,this._ensureLoaded().then((function(){return o._parent._getFilteredSet(e,t,r,a,i)})).then((function(e){return o._checkCancelled(i),!0===s?new d.a(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===l&&e._ordered,o._clonePageDefinition(e.pagesDefinition)):new d.a(e._candidates.slice(0),e._known.slice(0),!0===l&&e._ordered,o._clonePageDefinition(e.pagesDefinition))}))}},{key:"reformulateWithoutAdaptions",value:function(e){var t={cannot:!1,where:e};if(null!==e){var r,a=Object(n.a)(this.adaptedFields);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(!0===Object(f.h)(e,i.field.name)){var s=i.rewriteSql(e,this);if(!0!==s.rewritten){t.cannot=!0,t.where=null;break}t.where=s.where}}}catch(o){a.e(o)}finally{a.f()}}return t}},{key:"_stat",value:function(e,t,r,n,a,i,s){var o=this,u=!1,l=this.reformulateWithoutAdaptions(t);return u=l.cannot,t=l.where,l=this.reformulateWithoutAdaptions(a),u=u||l.cannot,null!==(a=l.where)?null!==this._extraFilter&&(a=Object(f.a)(this._extraFilter,a)):a=this._extraFilter,!0===u?null===a&&""===r&&null===n?this._manualStat(e,t,i,s):Object(h.t)({calculated:!1}):this._parent._stat(e,t,r,n,a,i,s).then((function(u){return!1===u.calculated?null===a&&""===r&&null===n?o._manualStat(e,t,i,s):{calculated:!1}:u}))}},{key:"_canDoAggregates",value:function(e,t,r,a,i){if(null===this._parent)return Object(h.t)(!1);for(var s=0;s<e.length;s++){var o,u=Object(n.a)(this.adaptedFields);try{for(u.s();!(o=u.n()).done;){var l=o.value;if(e[s].toLowerCase()===l.field.name.toLowerCase()&&!(l instanceof m))return Object(h.t)(!1)}}catch(g){u.e(g)}finally{u.f()}}for(var c=[],d=0;d<t.length;d++){var p=t[d];if(null!==p.workingexpr){var y=this.reformulateWithoutAdaptions(p.workingexpr);if(y.cannot)return Object(h.t)(!1);var b=p.clone();b.workingexpr=y.where,c.push(b)}else c.push(p)}var v=this.reformulateWithoutAdaptions(i);return v.cannot?Object(h.t)(!1):(null!==(i=v.where)?null!==this._extraFilter&&(i=Object(f.a)(this._extraFilter,i)):i=this._extraFilter,this._parent._canDoAggregates(e,c,r,a,i))}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,r,n,a,i,s){if(null===this._parent)return Object(h.s)(new Error("Should never be called"));for(var o=[],u=0;u<t.length;u++){var l=t[u];if(null!==l.workingexpr){var c=this.reformulateWithoutAdaptions(l.workingexpr);if(c.cannot)return Object(h.s)(new Error("Should never be called"));var d=l.clone();d.workingexpr=c.where,o.push(d)}else o.push(l)}var p=this.reformulateWithoutAdaptions(a);return p.cannot?Object(h.s)(new Error("Should never be called")):(null!==(a=p.where)?null!==this._extraFilter&&(a=Object(f.a)(this._extraFilter,a)):a=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(e,o,r,n,a,i,s))}}],[{key:"findField",value:function(e,t){var r,a=Object(n.a)(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i.name.toLowerCase()===t.toString().toLowerCase())return i}}catch(s){a.e(s)}finally{a.f()}return null}}]),r}(c.a)},923:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n=r(2),a=r(4),i=r(5),s=r(6),o=r(741),u=r(734),l=r(707),c=r(30),d=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(n.a)(this,r),(a=t.call(this,e))._topnum=0,a.declaredClass="esri.arcade.featureset.actions.Top",a._countedin=0,a._maxProcessing=100,a._topnum=e.topnum,a._parent=e.parentfeatureset,a}return Object(a.a)(r,[{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getSet(e)})).then((function(e){return t._wset=new u.a(e._candidates.slice(0),e._known.slice(0),!1,t._clonePageDefinition(e.pagesDefinition)),t._setKnownLength(t._wset)>t._topnum&&(t._wset._known=t._wset._known.slice(0,t._topnum)),t._setKnownLength(t._wset)>=t._topnum&&(t._wset._candidates=[]),t._wset})):Object(c.t)(this._wset)}},{key:"_setKnownLength",value:function(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);if(t===l.b.NotInFeatureSet)return t;var r=this._idstates[e];return r===l.b.InFeatureSet||r===l.b.NotInFeatureSet?r:t===l.b.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=l.b.InFeatureSet,this._countedin++,l.b.InFeatureSet):(this._idstates[e]=l.b.NotInFeatureSet,l.b.NotInFeatureSet):l.b.Unknown}},{key:"_expandPagedSet",value:function(e,t,r,n,a){var i=this;if(null===this._parent)return Object(c.s)(new Error("Parent Paging not implemented"));if(t>this._topnum&&(t=this._topnum),this._countedin>=this._topnum&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset){var s=e._known.length;return s>0&&"GETPAGES"===e._known[s-1]&&(e._known.length=s-1),(s=e._candidates.length)>0&&"GETPAGES"===e._candidates[s-1]&&(e._candidates.length=s-1),Object(c.t)("success")}return this._parent._expandPagedSet(e,t,r,n,a).then((function(t){return i._setKnownLength(e)>i._topnum&&(e._known.length=i._topnum),i._setKnownLength(e)>=i._topnum&&(e._candidates.length=0),t}))}},{key:"_getFeatures",value:function(e,t,r,n){var a=this,i=[],s=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,s))return this._expandPagedSet(e,s,0,0,n).then((function(){return a._getFeatures(e,t,r,n)}));-1!==t&&void 0===this._featureCache[t]&&i.push(t);for(var o=0,l=e._lastFetchedIndex;l<e._known.length&&(++o<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[l]]&&(e._known[l]!==t&&i.push(e._known[l]),i.length>s)));l++);if(0===i.length)return Object(c.t)("success");var d=new u.a([],i,!1,null),p=Math.min(i.length,r);return this._parent._getFeatures(d,-1,p,n).then((function(){for(var e=0;e<p;e++){var t=a._parent._featureFromCache(i[e]);void 0!==t&&(a._featureCache[i[e]]=t)}return"success"}))}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this;return this._ensureLoaded().then((function(){return i._getSet(a)})).then((function(e){return new u.a(e._candidates.slice(0).concat(e._known.slice(0)),[],!1,i._clonePageDefinition(e.pagesDefinition))}))}},{key:"_refineKnowns",value:function(e,t){for(var r=0,n=null,a=[],i=0;i<e._candidates.length;i++){var s=this._isInFeatureSet(e._candidates[i]);if(s===l.b.InFeatureSet){if(e._known.push(e._candidates[i]),r+=1,null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),e._known.length>=this._topnum)break}else if(s===l.b.NotInFeatureSet)null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),r+=1;else if(s===l.b.Unknown)break;if(r>=t)break}null!==n&&a.push(n);for(var o=a.length-1;o>=0;o--)e._candidates.splice(a[o].start,a[o].end-a[o].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])}},{key:"_stat",value:function(){return Object(c.t)({calculated:!1})}},{key:"_canDoAggregates",value:function(){return Object(c.t)(!1)}}],[{key:"registerAction",value:function(){o.a._featuresetFunctions.top=function(e){return new r({parentfeatureset:this,topnum:e})}}}]),r}(o.a)},926:function(e,t,r){"use strict";r.d(t,"a",(function(){return g}));var n=r(21),a=r(2),i=r(4),s=r(5),o=r(6),u=r(210),l=r(741),c=r(734),d=r(707),p=r(761),f=r(30),h=r(84),y=r(735),b=r(733),v=r(666),m=r(670),g=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",n._removeGeometry=!1,n._overrideFields=null,n._forceIsTable=!1,e.spatialReference&&(n.spatialReference=e.spatialReference),n._transparent=!0,n._maxProcessing=1e3,n._layer=e.layer,n._wset=null,!0===e.isTable&&(n._forceIsTable=!0),void 0!==e.outFields&&(n._overrideFields=e.outFields),void 0!==e.includeGeometry&&(n._removeGeometry=!1===e.includeGeometry),n}return Object(i.a)(r,[{key:"_maxQueryRate",value:function(){return d.f}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=Object(f.c)((function(t,r){if(!0===e._layer.loaded)return e._initialiseFeatureSet(),void t(e);e._layer.when().then((function(){try{e._initialiseFeatureSet(),t(e)}catch(n){r(n)}}),r),e._layer.load()}))),this._loadPromise}},{key:"gdbVersion",get:function(){return""}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{var e,t=[],r=Object(n.a)(this.fields);try{for(r.s();!(e=r.n()).done;){var a=e.value;if("oid"===a.type)t.push(a);else{var i,s=Object(n.a)(this._layer.outFields);try{for(s.s();!(i=s.n()).done;){if(i.value.toLowerCase()===a.name.toLowerCase()){t.push(a);break}}}catch(m){s.e(m)}finally{s.f()}}}}catch(m){r.e(m)}finally{r.f()}this.fields=t}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var o,u=[],l=[],c=Object(n.a)(this.fields);try{for(c.s();!(o=c.n()).done;){var p=o.value;if("oid"===p.type)u.push(p),l.push(p.name);else{var f,h=Object(n.a)(this._overrideFields);try{for(h.s();!(f=h.n()).done;){if(f.value.toLowerCase()===p.name.toLowerCase()){u.push(p),l.push(p.name);break}}}catch(m){h.e(m)}finally{h.f()}}}}catch(m){c.e(m)}finally{c.f()}this.fields=u,this._overrideFields=l}this.objectIdField=this._layer.objectIdField;var y,b=Object(n.a)(this.fields);try{for(b.s();!(y=b.n()).done;){var v=y.value;"global-id"===v.type&&(this.globalIdField=v.name)}}catch(m){b.e(m)}finally{b.f()}this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=d.a.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}},{key:"isTable",value:function(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}},{key:"_isInFeatureSet",value:function(){return d.b.InFeatureSet}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._getFilteredSet("",null,null,null,e)})).then((function(e){return t._wset=e,e})):Object(f.t)(this._wset)}},{key:"_changeFeature",value:function(e){var t,r={},a=Object(n.a)(this.fields);try{for(a.s();!(t=a.n()).done;){var i=t.value;r[i.name]=e.attributes[i.name]}}catch(s){a.e(s)}finally{a.f()}return new u.a({geometry:!0===this._removeGeometry?null:e.geometry,attributes:r})}},{key:"_getFilteredSet",value:function(e,t,r,n,a){var i=this,s="",o=!1;if(null!==n&&(s=n.constructClause(),o=!0),this.isTable()&&t&&null!==e&&""!==e){var u=new c.a([],[],!0,null);return Object(f.t)(u)}var l=new m.a;return l.where=null===r?null===t?"1=1":"":Object(p.i)(r,d.a.Standardised),l.spatialRelationship=this._makeRelationshipEnum(e),l.outSpatialReference=this.spatialReference,l.orderByFields=""!==s?s.split(","):null,l.geometry=null===t?null:t,l.returnGeometry=!0,l.relationParameter=this._makeRelationshipParam(e),this._layer.queryFeatures(l).then((function(e){if(null===e)return new c.a([],[],o,null);i._checkCancelled(a);var t=[];return e.features.forEach((function(e){var r=e.attributes[i._layer.objectIdField];t.push(r),i._featureCache[r]=i._changeFeature(e)})),new c.a([],t,o,null)}))}},{key:"_makeRelationshipEnum",value:function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}},{key:"_makeRelationshipParam",value:function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""}},{key:"_queryAllFeatures",value:function(){var e=this;if(this._wset)return Object(f.t)(this._wset);var t=new m.a;return t.where="1=1",this._ensureLoaded().then((function(){if(e._layer.source&&e._layer.source.items){var r=[];return e._layer.source.items.forEach((function(t){var n=t.attributes[e._layer.objectIdField];r.push(n),e._featureCache[n]=e._changeFeature(t)})),e._wset=new c.a([],r,!1,null),e._wset}return e._layer.queryFeatures(t).then((function(t){var r=[];return t.features.forEach((function(t){var n=t.attributes[e._layer.objectIdField];r.push(n),e._featureCache[n]=e._changeFeature(t)})),e._wset=new c.a([],r,!1,null),e._wset}))}))}},{key:"_getFeatures",value:function(e,t,r){var n=[];-1!==t&&void 0===this._featureCache[t]&&n.push(t);for(var a=e._lastFetchedIndex;a<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[a]]&&(e._known[a]!==t&&n.push(e._known[a]),n.length>r)));a++);return 0===n.length?Object(f.t)("success"):Object(f.s)(new Error("Unaccounted for Features. Not in Feature Collection"))}},{key:"_refineSetBlock",value:function(e){return Object(f.t)(e)}},{key:"_stat",value:function(){return Object(f.t)({calculated:!1})}},{key:"_canDoAggregates",value:function(){return Object(f.t)(!1)}},{key:"relationshipMetaData",value:function(){return[]}},{key:"nativeCapabilities",value:function(){return{title:this._layer.title,canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}},{key:"queryAttachments",value:function(){return Object(f.t)([])}},{key:"getFeatureByObjectId",value:function(e){var t=new m.a;return t.where=this.objectIdField+"="+e.toString(),this._layer.queryFeatures(t).then((function(e){return 1===e.features.length?e.features[0]:null}))}},{key:"getOwningSystemUrl",value:function(){return Object(f.t)("")}},{key:"getIdentityUser",value:function(){return Object(f.t)("")}}],[{key:"_cloneAttr",value:function(e){var t={};for(var r in e)t[r]=e[r];return t}},{key:"create",value:function(e,t){var a=e.layerDefinition.objectIdField,i=e.layerDefinition.typeIdField?e.layerDefinition.typeIdField:"",s=[];if(e.layerDefinition.types){var o,u=Object(n.a)(e.layerDefinition.types);try{for(u.s();!(o=u.n()).done;){var l=o.value;s.push(b.a.fromJSON(l))}}catch(M){u.e(M)}finally{u.f()}}var c=e.layerDefinition.geometryType;void 0===c&&(c=e.featureSet.geometryType||"");var d=e.featureSet.features,p=t.toJSON();if(""===a||void 0===a){var f,m=!1,g=Object(n.a)(e.layerDefinition.fields);try{for(g.s();!(f=g.n()).done;){var O=f.value;if("oid"===O.type||"esriFieldTypeOID"===O.type){a=O.name,m=!0;break}}}catch(M){g.e(M)}finally{g.f()}if(!1===m){for(var j="FID",_=!0,w=0;_;){var S,k=!0,x=Object(n.a)(e.layerDefinition.fields);try{for(x.s();!(S=x.n()).done;){if(S.value.name===j){k=!1;break}}}catch(M){x.e(M)}finally{x.f()}!0===k?_=!1:j="FID"+(++w).toString()}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:j,alias:j});for(var F=[],I=0;I<d.length;I++)F.push({geometry:e.featureSet.features[I].geometry,attributes:e.featureSet.features[I].attributes?this._cloneAttr(e.featureSet.features[I].attributes):{}}),F[I].attributes[j]=I;d=F,a=j}}var T,E=[],C=Object(n.a)(e.layerDefinition.fields);try{for(C.s();!(T=C.n()).done;){var R=T.value;R instanceof v.a?E.push(R):E.push(v.a.fromJSON(R))}}catch(M){C.e(M)}finally{C.f()}var N=c;switch(N){case"esriGeometryPoint":N="point";break;case"esriGeometryPolyline":N="polyline";break;case"esriGeometryPolygon":N="polygon";break;case"esriGeometryExtent":N="extent";break;case"esriGeometryMultipoint":N="multipoint"}var P,D=Object(n.a)(d);try{for(D.s();!(P=D.n()).done;){var A=P.value;A.geometry&&A.geometry instanceof h.a==0&&(A.geometry.type=N,void 0===A.geometry.spatialReference&&(A.geometry.spatialReference=p))}}catch(M){D.e(M)}finally{D.f()}var L={outFields:["*"],source:d,fields:E,types:s,typeIdField:i,objectIdField:a,spatialReference:t};return L.geometryType=N||"point",new r({layer:new y.default(L),spatialReference:t,isTable:null===N||""===N})}}]),r}(l.a)}}]);
//# sourceMappingURL=36.f9f8a1ae.chunk.js.map