(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[114],{1112:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return O}));var r=i(7),s=i.n(r),n=i(12),a=i(21),u=i(2),o=i(4),l=i(29),h=i(15),c=i(11),d=i(333),f=i(244),p=i(802),y=i(762),v=i(748),_=i(670),b=i(1021),m=h.a.getLogger("esri.views.2d.layers.features.support.whereUtils"),w={getAttribute:function(e,t){return e.field(t)}};function I(e,t){return k.apply(this,arguments)}function k(){return(k=Object(n.a)(s.a.mark((function e(t,r){var n,a,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(i.bind(null,736));case 2:return n=e.sent,e.prev=3,(a=n.WhereClause.create(t,r)).isStandardized||(u=new l.a("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",a),m.error(u)),e.abrupt("return",(function(e){var t=e.readArcadeFeature();return a.testFeature(t,w)}));case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",(m.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),function(e){return!0}));case 12:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}var x=h.a.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter"),O=function(){function e(t){Object(u.a)(this,e),this._geometryBounds=Object(d.e)(),this._idToVisibility=new Map,this._serviceInfo=t}return Object(o.a)(e,[{key:"hash",get:function(){return this._hash}},{key:"check",value:function(e){return this._applyFilter(e)}},{key:"clear",value:function(){var e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}},{key:"invalidate",value:function(){var e=this;this._idToVisibility.forEach((function(t,i){e._idToVisibility.set(i,0)}))}},{key:"setKnownIds",value:function(e){var t,i=Object(a.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._idToVisibility.set(r,1)}}catch(s){i.e(s)}finally{i.f()}}},{key:"setTrue",value:function(e){var t=this,i=[],r=[],s=new Set(e);return this._idToVisibility.forEach((function(e,n){var a=!!(1&t._idToVisibility.get(n)),u=s.has(n);!a&&u?i.push(n):a&&!u&&r.push(n),t._idToVisibility.set(n,u?3:0)})),{show:i,hide:r}}},{key:"createQuery",value:function(){var e=this.geometry,t=this.spatialRel,i=this.where,r=this.timeExtent,s=this.objectIds;return _.a.fromJSON({geometry:e,spatialRel:t,where:i,timeExtent:r,objectIds:s})}},{key:"update",value:function(){var e=Object(n.a)(s.a.mark((function e(t,i){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._hash=JSON.stringify(t),e.next=3,Object(v.e)(t,null,i);case 3:return r=e.sent,e.next=6,Promise.all([this._setGeometryFilter(r),this._setIdFilter(r),this._setAttributeFilter(r),this._setTimeFilter(r)]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_setAttributeFilter",value:function(){var e=Object(n.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.where){e.next=2;break}return e.abrupt("return",(this._clause=null,void(this.where=null)));case 2:return e.next=4,I(t.where,this._serviceInfo.fieldsIndex);case 4:this._clause=e.sent,this.where=t.where;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setIdFilter",value:function(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}},{key:"_setGeometryFilter",value:function(){var e=Object(n.a)(s.a.mark((function e(t){var i,r,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.geometry){e.next=2;break}return e.abrupt("return",(this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null)));case 2:return i=t.geometry,r=t.spatialRel||"esriSpatialRelIntersects",e.next=6,Object(p.c)(r,i,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);case 6:n=e.sent,Object(f.a)(this._geometryBounds,i),this._spatialQueryOperator=n,this.geometry=i,this.spatialRel=r;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setTimeFilter",value:function(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=Object(y.b)(this._serviceInfo.timeInfo,e.timeExtent,b.b);else{var t=new l.a("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);x.error(t)}}},{key:"_applyFilter",value:function(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}},{key:"_filterByExpression",value:function(e){return!this.where||this._clause(e)}},{key:"_filterById",value:function(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}},{key:"_filterByGeometry",value:function(e){if(!this.geometry)return!0;var t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}},{key:"_filterByTime",value:function(e){return!Object(c.j)(this._timeOperator)||this._timeOperator(e)}},{key:"_resetAllHiddenIds",value:function(){var e=this,t=[];return this._idToVisibility.forEach((function(i,r){1&i||(e._idToVisibility.set(r,1),t.push(r))})),t}}]),e}()}}]);
//# sourceMappingURL=114.10ecbcd8.chunk.js.map