<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>Example Planet 3m cached monthly and daily imagery</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.css' rel='stylesheet' />
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        .mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
            display: none;
        }

        .mapboxgl-popup-content {
            padding: 10px;
            color: #666666;
            font-family: 'MuseoSans';
            font-weight: 500;
            font-size: 1.325rem;
            line-height: 2rem;
            margin-top: 1.875rem;
            margin-bottom: 0.625rem;
            text-decoration: none;
        }
        .mapboxgl-popup-content a{
            text-decoration: none;
            color: #666666;
        }
    </style>
</head>

<body>

    <div id='map'></div>
    <script>
        /*global mapboxgl*/
        mapboxgl.accessToken = 'pk.eyJ1IjoiYmxpc2h0ZW4iLCJhIjoiMEZrNzFqRSJ9.0QBRA2HxTb8YHErUFRMPZg'; //this is my access token
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v9',
            zoom: 12,
            center: [-175.1029, -21.2]
        });

        map.on('click', function() {
            // map.addLayer({
            //     'id': 'planet_xyz_layer3',
            //     'type': 'raster',
            //     'source': {
            //         type: 'raster',
            //         tiles: ['https://tiles.planet.com/basemaps/v1/planet-tiles/global_monthly_2018_05_mosaic/gmap/{z}/{x}/{y}.png?api_key=33b3bd5bbd5e4e5db1a65c44d223d46a'],
            //         tileSize: 256
            //     },
            //     'layout': {
            //         'visibility': 'visible'
            //     }
            // });
        });

        map.on('load', function() {
            //commented out for now as it no longer seems to work 26/06/2018
            // map.addLayer({
            //     "id": "jrc_vector_tiles",
            //     "type": "fill",
            //     "source": {
            //         "type": "vector",
            //         "tiles": ["https://lrmadmin.ies.jrc.it/geoserver/gwc/service/wmts?layer=dopa:dopa_geoserver_wdpa_master&tilematrixset=EPSG:900913&Service=WMTS&Request=GetTile&Version=1.0.0&Format=application/x-protobuf;type=mapbox-vector&TileMatrix=EPSG:900913:{z}&TileCol={x}&TileRow={y}"],
            //         "minzoom": 3,
            //         "maxzoom": 14
            //     },
            //     "source-layer": "dopa_geoserver_wdpa_master",
            //     "paint": {
            //         "fill-color": "rgba(99, 148, 69, 0.5)"
            //     }
            // });

            //this will only work for 14 days from 26/06/2018 as I have a free trial period

            //mosaic from april 2018
            //commented out for now as it no longer seems to work 13/08/2019
            // map.addLayer({
            //     'id': 'planet_xyz_layer1',
            //     'type': 'raster',
            //     'source': {
            //         type: 'raster',
            //         tiles: ['https://tiles.planet.com/basemaps/v1/planet-tiles/global_monthly_2018_04_mosaic/gmap/{z}/{x}/{y}.png?api_key=33b3bd5bbd5e4e5db1a65c44d223d46a'],
            //         tileSize: 256
            //     }
            // });

            //scene from 17/06/2018
            //commented out for now as it no longer seems to work 13/08/2019
            // map.addLayer({
            //     'id': 'planet_xyz_layer2',
            //     'type': 'raster',
            //     'source': {
            //         type: 'raster',
            //         tiles: ['https://tiles1.planet.com/data/v1/PSScene3Band/20180617_001913_1042/{z}/{x}/{y}.png?api_key=33b3bd5bbd5e4e5db1a65c44d223d46a'],
            //         tileSize: 256
            //     }
            // });

            // map.addLayer({
            //     "id": "torricelli_proposed_pa",
            //     "type": "fill",
            //     "source": {
            //         type: 'vector',
            //         url: 'mapbox://blishten.Torricelli_Proposed_PA'
            //     },
            //     "source-layer": "Torricelli_Proposed_PA",
            //     "paint": {
            //         "fill-color": "rgba(99, 148, 69, 0.2)",
            //         "fill-outline-color": "rgba(99, 148, 69, 0.6)"
            //     }
            // });
            // map.addLayer({
            //     "id": "country-hig",
            //     "type": "fill",
            //     "source": {
            //         "type": "vector",
            //         "tiles": ["https://geospatial.jrc.ec.europa.eu/geoserver/gwc/service/wmts?layer=dopa_explorer_2:mt_120_country_budget_project_geo&tilematrixset=EPSG:900913&Service=WMTS&Request=GetTile&Version=1.0.0&Format=application/x-protobuf;type=mapbox-vector&TileMatrix=EPSG:900913:{z}&TileCol={x}&TileRow={y}"]
            //     },
            //     "source-layer": "mt_120_country_budget_project_geo",
            //     'paint': {
            //         'fill-color': '#FF0000',
            //         'fill-opacity': 0.9
            //     },
            //     "filter": ["in", "iso2", "PG"]
            // }, 'waterway-label');
            // map.addLayer({
            //     "id": "kinabalu",
            //     "type": "fill",
            //     "source": {
            //         "type": "vector",
            //         "tiles": ["https://geospatial.jrc.ec.europa.eu/geoserver/gwc/service/wmts?layer=marxan:kinabalu&tilematrixset=EPSG:900913&Service=WMTS&Request=GetTile&Version=1.0.0&Format=application/x-protobuf;type=mapbox-vector&TileMatrix=EPSG:900913:{z}&TileCol={x}&TileRow={y}"]
            //     },
            //     "source-layer": "kinabalu",
            //     'paint': {
            //         'fill-color': '#FF0000',
            //         'fill-opacity': 0.9
            //     }
            // });
            // map.addLayer({
            //   'id': "fiji-tileset",
            //   'type': "fill",
            //   'source': {
            //     'type': "vector",
            //     'url': "mapbox://blishten.5fd6kcyk"
            //   },
            //   'source-layer': "fiji-afx5la",
            //   'paint': {
            //     'fill-color': "rgba(100, 40, 220, 0.3)",
            //     'fill-outline-color': "rgba(255, 0, 0, 0.5)"
            //   }
            // });
            // map.addLayer({
            //   'id': "cross-meridian-line",
            //   'type': "line",
            //   'source': {
            //     'type': "vector",
            //     'url': "mapbox://blishten.7p2ffnvs"
            //   },
            //   'source-layer': "meridian_2-89oi94",
            //   'paint': {
            //     'line-color': "rgba(255,0,0,1)",
            //     'line-width': 2
            //   }
            // });
            map.addLayer({
                "id": "wdpa_aug_2019_polygons",
                "type": "fill",
                "source": {
                    "type": "vector",
                    "tiles": ["https://geospatial.jrc.ec.europa.eu/geoserver/gwc/service/wmts?layer=marxan:wdpa_aug_2019_polygons&tilematrixset=EPSG:900913&Service=WMTS&Request=GetTile&Version=1.0.0&Format=application/x-protobuf;type=mapbox-vector&TileMatrix=EPSG:900913:{z}&TileCol={x}&TileRow={y}"]
                },
                "source-layer": "wdpa_aug_2019_polygons",
                "paint": {
                    'fill-color': "rgba(100, 100, 100, 0.2)",
                    'fill-outline-color': "rgba(20, 20, 20, 0.2)"
                }
            });
            map.addLayer({
                "id": "wdpa_sep_2019_polygons",
                "type": "fill",
                "source": {
                    "type": "vector",
                    "tiles": ["https://geospatial.jrc.ec.europa.eu/geoserver/gwc/service/wmts?layer=marxan:wdpa_sep_2019_polygons&tilematrixset=EPSG:900913&Service=WMTS&Request=GetTile&Version=1.0.0&Format=application/x-protobuf;type=mapbox-vector&TileMatrix=EPSG:900913:{z}&TileCol={x}&TileRow={y}"]
                },
                "source-layer": "wdpa_sep_2019_polygons",
                "paint": {
                    "fill-color": {
                        "type": "categorical",
                        "property": "marine",
                        "stops": [
                            ["0", "rgba(99,148,69, 0.2)"],
                            ["1", "rgba(63,127,191, 0.2)"],
                            ["2", "rgba(63,127,191, 0.2)"]
                        ]
                    },
                    "fill-outline-color": {
                        "type": "categorical",
                        "property": "marine",
                        "stops": [
                            ["0", "rgba(99,148,69, 0.2)"],
                            ["1", "rgba(63,127,191, 0.2)"],
                            ["2", "rgba(63,127,191, 0.2)"]
                        ]
                    }
                }
            });
        });

        var popup = new mapboxgl.Popup({});

        map.on('mouseenter', 'wdpa_sep_2019_polygons', function(e) {
            map.getCanvas().style.cursor = 'pointer';
            var coordinates = e.lngLat;
            while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
            }
            popup.setLngLat(coordinates)
                .setHTML("<div><a href='https://www.protectedplanet.net/" + e.features[0].properties.wdpaid + "' target='_blank'>" + e.features[0].properties.name + " (" + e.features[0].properties.iucn_cat + ")</a></div>")
                .addTo(map);
        });

        map.on('mouseleave', 'wdpa_sep_2019_polygons', function() {
            // setTimeout(function(){
            //     map.getCanvas().style.cursor = '';
            //     popup.remove();
            // }, 5000);            
        });
        map.addControl(new mapboxgl.NavigationControl());
    </script>

</body>

</html>
